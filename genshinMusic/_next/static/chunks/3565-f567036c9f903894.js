"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3565],{66834:function(e,t,s){s.d(t,{x:function(){return r}});var i=s(85893),n=s(17544),o=s(21820),a=s.n(o);function r(e){let{selected:t,onChange:s,style:o,children:r,className:l}=e;return(0,i.jsxs)("select",{className:"".concat(a().select," ").concat(null!=l?l:""),style:{width:"100%",padding:"0.3rem",...o},onChange:e=>{s(e.target.value),e.target.blur()},value:t,children:[r,n.T_.map(e=>(0,i.jsx)("option",{children:e},e))]})}},19502:function(e,t,s){s.d(t,{P:function(){return l}});var i=s(85893),n=s(92634),o=s(21820),a=s.n(o),r=s(67294);function l(e){let{onChange:t,value:s,children:o,style:l}=e,[c]=(0,n.F)(),d=(0,r.useCallback)(e=>{t(e),e.target.blur()},[t]);return(0,i.jsx)("select",{onChange:d,value:s,className:a().select,style:{backgroundImage:"url(\"data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' height='24' viewBox='0 0 24 24' width='24' fill='".concat(c.getText("primary").hex().replace("#","%23"),"'><path d='M0 0h24v24H0z' fill='none'/><path d='M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z'/></svg>\")"),...l},children:o})}},23565:function(e,t,s){s.r(t),s.d(t,{default:function(){return e3}});var i=s(85893),n=s(67294),o=s(78773),a=s(17544);function r(e){let{className:t}=e;return(0,i.jsx)("svg",{width:"194.40327mm",height:"290.853mm",viewBox:"0 0 194.40327 290.85299",xmlns:"http://www.w3.org/2000/svg",className:t,style:{fill:"currentcolor"},children:(0,i.jsxs)("g",{children:[(0,i.jsx)("rect",{width:"50.962246",height:"290.853",x:"143.44104",y:"2.4868996e-14",rx:"15.05095",ry:"17.061689"}),(0,i.jsx)("path",{d:"m 42.968955,90.42652 c -2.198688,0 -3.96875,1.770063 -3.96875,3.96875 v 35.03145 H 3.9687499 C 1.7700625,129.42672 0,131.19678 0,133.39547 v 24.0621 c 0,2.19869 1.7700625,3.96875 3.9687499,3.96875 H 39.000205 v 35.03145 c 0,2.19869 1.770062,3.96875 3.96875,3.96875 h 24.062613 c 2.198687,0 3.968749,-1.77006 3.968749,-3.96875 v -35.03145 h 35.030933 c 2.19869,0 3.96875,-1.77006 3.96875,-3.96875 v -24.0621 c 0,-2.19869 -1.77006,-3.96875 -3.96875,-3.96875 H 71.000317 V 94.39527 c 0,-2.198687 -1.770062,-3.96875 -3.968749,-3.96875 z"}),(0,i.jsx)("rect",{width:"7.8557625",height:"1.5711526",x:"57.085205",y:"139.30885",rx:"3.96875"})]})})}function l(e){let{className:t}=e;return(0,i.jsx)("svg",{width:"194.40327mm",height:"290.853mm",viewBox:"0 0 194.40327 290.85299",xmlns:"http://www.w3.org/2000/svg",className:t,style:{fill:"currentcolor"},children:(0,i.jsxs)("g",{children:[(0,i.jsx)("rect",{width:"50.962246",height:"290.853",x:"143.44104",y:"2.4868996e-14",rx:"15.05095",ry:"17.061689"}),(0,i.jsx)("rect",{width:"110.35661",height:"35.805271",x:"0",y:"127.52386",rx:"3.96875"})]})})}var c=s(87481),d=s(92452),h=s(39324),m=s(61748),u=s(12120),g=s(53179),p=s(54233),x=s(68949),y=s(13042),v=s(31555),f=s(46335),b=s(66834),j=s(51797),w=s(74550),_=s(19502),k=s(10694);function C(e){let{onChange:t,value:s,delay:o=800,step:a=1,style:r,placeholder:l,className:c}=e,[d,h]=(0,n.useState)("".concat(s)),m=(0,w.Z)(d,o);return(0,n.useEffect)(()=>{let e=Number(m);Number.isFinite(e)?t(e):h("0")},[m,t]),(0,n.useEffect)(()=>{h("".concat(s))},[s]),(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end"},className:c,children:[(0,i.jsx)("button",{onClick:()=>h("".concat(Number(d)-a)),className:"midi-btn-small",style:r,children:"-"}),(0,i.jsx)("input",{type:"text",placeholder:l,value:d,onChange:e=>h(e.target.value),className:"midi-input",style:{margin:"0 0.3rem",...r}}),(0,i.jsx)("button",{onClick:()=>h("".concat(Number(d)+a)),className:"midi-btn-small",style:r,children:"+"})]})}var S=s(82860),N=s(11090),R=s(67421);function T(e){var t;let{data:s,index:a,onChange:r,theme:l,instruments:c}=e,{t:d}=(0,R.$G)(["composer","common"]),[m,u]=(0,n.useState)(!1),g={backgroundColor:l.layer("menu_background",.15).toString()},[p,x]=(0,n.useState)("".concat(null!==(t=s.localOffset)&&void 0!==t?t:"")),y=(0,w.Z)(p,600);(0,n.useEffect)(()=>{let e=parseInt(y),t=Number.isFinite(e)?e:null;x("".concat(null!=t?t:"")),r(a,{localOffset:t})},[y,r,a]),(0,n.useEffect)(()=>{var e;x("".concat(null!==(e=s.localOffset)&&void 0!==e?e:""))},[s.localOffset]);let v=(0,n.useCallback)(e=>{r(a,{maxScaling:Math.max(0,e)})},[r,a]);return(0,i.jsxs)(S.s,{gap:"0.5rem",className:"midi-track-column",style:g,children:[(0,i.jsxs)("div",{className:"midi-track-wrapper",children:[(0,i.jsxs)("div",{className:"midi-track-center",children:[(0,i.jsx)("input",{type:"checkbox",onChange:()=>r(a,{selected:!s.selected}),checked:s.selected}),"".concat(s.name," "),"(",s.track.notes.length,","," ".concat(s.track.instrument.family),")"]}),(0,i.jsxs)("div",{className:"midi-track-center",children:[(0,i.jsx)(_.P,{onChange:e=>r(a,{layer:Number(e.target.value)}),value:s.layer,className:"midi-select",style:{marginLeft:"0.2rem",paddingRight:"1.5rem"},children:c.map((e,t)=>(0,i.jsxs)("option",{value:t,children:[e.alias||(0,h.yX)(e.name)," - ","Layer ".concat(t+1)]},t))}),(0,i.jsx)(o.p4t,{size:22,color:m?"var(--secondary)":"var(--primary)",onClick:()=>u(!m),cursor:"pointer"})]})]}),(0,i.jsxs)(S.s,{padding:"0.4rem",gap:"0.2rem",style:{display:m?"flex":"none",borderTop:"solid 0.1rem var(--secondary)"},children:[(0,i.jsxs)(N.X,{align:"center",justify:"between",children:[(0,i.jsxs)("div",{className:(0,k.h)(!0),children:[(0,i.jsx)(k.u,{children:d("midi_parser.local_note_offset_description")}),d("midi_parser.local_note_offset")]}),(0,i.jsxs)(N.X,{gap:"0.3rem",children:[(0,i.jsx)("button",{onClick:()=>x("".concat(Number(p)-1)),className:"midi-btn-small",children:"-"}),(0,i.jsx)("input",{type:"text",value:p,placeholder:"No offset",className:"midi-input",style:{width:"4rem"},onChange:e=>x(e.target.value)}),(0,i.jsx)("button",{onClick:()=>x("".concat(Number(p)+1)),className:"midi-btn-small",children:"+"})]})]}),(0,i.jsxs)(N.X,{align:"center",justify:"between",children:[(0,i.jsxs)("div",{className:(0,k.h)(!0),children:[(0,i.jsx)(k.u,{children:d("midi_parser.max_octave_scaling_description")}),d("midi_parser.max_octave_scaling")]}),(0,i.jsx)(C,{value:s.maxScaling,placeholder:"No scaling",onChange:v})]}),(0,i.jsxs)(N.X,{align:"center",justify:"between",children:[(0,i.jsx)("div",{children:d("common:instrument")}),(0,i.jsx)("div",{children:s.track.instrument.name})]}),(0,i.jsxs)(N.X,{align:"center",justify:"between",children:[(0,i.jsx)("div",{children:d("midi_parser.number_of_notes")}),(0,i.jsx)("div",{children:s.track.notes.length})]}),(0,i.jsxs)(N.X,{align:"center",justify:"between",children:[(0,i.jsx)("div",{children:d("midi_parser.accidentals")}),(0,i.jsx)("div",{children:s.numberOfAccidentals})]}),(0,i.jsxs)(N.X,{align:"center",justify:"between",children:[(0,i.jsxs)("div",{children:[d("midi_parser.out_of_range"),"(",s.outOfRangeBounds.upper+s.outOfRangeBounds.lower,")"]}),(0,i.jsxs)(N.X,{style:{width:"fit-content"},children:[(0,i.jsxs)(N.X,{style:{marginRight:"0.4rem"},children:[(0,i.jsx)(o.ZTc,{style:{marginRight:"0.2rem"}}),s.outOfRangeBounds.upper]}),(0,i.jsxs)(N.X,{children:[(0,i.jsx)(o.NWQ,{style:{marginRight:"0.2rem"}}),s.outOfRangeBounds.lower]})]})]})]})]})}let M=null;class A extends n.Component{componentDidMount(){this.dispose=(0,x.N7)(p.f6.state.data,()=>{this.setState({theme:{...p.f6}})})}componentWillUnmount(){this.dispose()}render(){let{handleFile:e,editTrack:t,state:s,changeBpm:n,changeOffset:o,changePitch:a}=this,{tracks:r,fileName:l,bpm:d,offset:h,pitch:m,accidentals:u,outOfRange:g,totalNotes:p,includeAccidentals:x,theme:v,ignoreEmptytracks:w}=s,{functions:_,data:k,t:R}=this.props,{changeMidiVisibility:M}=_,A={backgroundColor:v.layer("primary",.2).toString(),color:v.getText("primary").toString()};return(0,i.jsx)(j.P,{className:"floating-midi",size:"1.2rem",isRelative:!1,offset:"0.1rem",children:(0,i.jsxs)(S.s,{className:"floating-midi-content",gap:"0.3rem",children:[(0,i.jsxs)(N.X,{className:"separator-border",align:"center",style:{width:"100%"},children:[(0,i.jsx)(c.G,{onPick:e,as:"buffer",children:(0,i.jsx)("button",{className:"midi-btn",style:{...A,whiteSpace:"nowrap"},children:R("midi_parser.open_midi_audio_file")})}),(0,i.jsx)("div",{style:{margin:"0 0.5rem"},className:"text-ellipsis",children:l}),(0,i.jsx)("button",{className:"midi-btn",style:{marginLeft:"auto",...A},onClick:()=>M(!1),children:R("common:close")})]}),(0,i.jsxs)(N.X,{justify:"between",align:"center",children:[(0,i.jsxs)("div",{style:{marginRight:"0.5rem"},children:[R("common:bpm"),":"]}),(0,i.jsx)(C,{value:d,onChange:n,delay:600,style:A,step:5})]}),(0,i.jsxs)(N.X,{justify:"between",align:"center",children:[(0,i.jsxs)("div",{className:"row flex-centered",children:[(0,i.jsxs)("span",{style:{marginRight:"0.5rem"},children:[R("midi_parser.global_note_offset"),": "]}),(0,i.jsx)(f.k,{buttonStyle:{width:"1.2rem",height:"1.2rem"},children:R("midi_parser.global_note_offset_description")})]}),(0,i.jsx)(C,{value:h,onChange:o,delay:600,style:A,step:1})]}),(0,i.jsxs)(N.X,{justify:"between",align:"center",children:[(0,i.jsxs)("div",{style:{marginRight:"0.5rem"},children:[R("common:pitch"),":"]}),(0,i.jsx)(b.x,{style:{width:"5rem",...A},selected:m,onChange:a})]}),(0,i.jsxs)(N.X,{justify:"between",align:"center",children:[(0,i.jsxs)(N.X,{align:"center",children:[(0,i.jsxs)("div",{style:{marginRight:"0.5rem"},children:[R("midi_parser.include_accidentals"),":"]}),(0,i.jsx)(y.Z,{checked:x,onChange:this.toggleAccidentals,styleOuter:A})]}),(0,i.jsxs)(N.X,{align:"center",children:[(0,i.jsxs)("div",{style:{marginRight:"0.5rem"},children:[R("midi_parser.ignore_empty_tracks"),":"]}),(0,i.jsx)(y.Z,{checked:w,onChange:e=>this.setState({ignoreEmptytracks:e}),styleOuter:A})]})]}),r.length>0&&(0,i.jsx)(S.s,{className:"separator-border",style:{width:"100%"},children:(0,i.jsxs)(S.s,{style:{width:"100%"},children:[(0,i.jsx)("div",{style:{textAlign:"center"},children:R("midi_parser.select_midi_tracks")}),r.map((e,s)=>!(w&&0===e.track.notes.length)&&(0,i.jsx)(T,{data:e,instruments:k.instruments,index:s,onChange:t,theme:v},s))]})}),r.length>0&&(0,i.jsx)("table",{children:(0,i.jsxs)("tbody",{children:[(0,i.jsxs)("tr",{children:[(0,i.jsxs)("td",{children:[R("midi_parser.total_notes"),":"]}),(0,i.jsx)("td",{}),(0,i.jsx)("td",{children:p})]}),(0,i.jsxs)("tr",{children:[(0,i.jsxs)("td",{children:[R("midi_parser.accidentals"),":"]}),(0,i.jsx)("td",{}),(0,i.jsx)("td",{children:u})]}),(0,i.jsxs)("tr",{children:[(0,i.jsxs)("td",{children:[R("midi_parser.out_of_range"),":"]}),(0,i.jsx)("td",{}),(0,i.jsx)("td",{children:g})]})]})})]})})}constructor(e){super(e),this.warnedOfExperimental=!1,this.handleFile=async e=>{try{if(0===e.length)return;let t=e[0],s=t.file.name;if((0,h.kG)(s)){let e=await this.extractAudio(t);this.parseAudioToMidi(e,s)}else if((0,h.Zj)(s)){let e=await this.extractAudio(t);this.parseAudioToMidi(e,s)}else{let e=new d.Midi(t.data);return this.mandleMidiFile(e,s)}}catch(e){console.error(e),g.kg.hidePill(),g.kg.error(this.props.t("logs:error_opening_file"))}},this.extractAudio=async e=>{let t=new AudioContext({sampleRate:22050}),s=await new Promise((s,i)=>{t.decodeAudioData(e.data,s,i)});return t.close(),s},this.parseAudioToMidi=async(e,t)=>{this.warnedOfExperimental||g.kg.warn(this.props.t("midi_parser.audio_conversion_warning")),this.warnedOfExperimental=!0;let i=[],n=[],o="".concat(a.GW,"/assets/audio-midi-model.json");g.kg.showPill("".concat(this.props.t("midi_parser.detecting_notes"),"..."));let{BasicPitch:r,noteFramesToTime:l,outputToNotesPoly:c}=await (null===M&&(M=Promise.all([s.e(864),s.e(904),s.e(2723),s.e(5974),s.e(3132),s.e(4460),s.e(5744)]).then(s.bind(s,47808)).then(e=>e)),M),m=new r(o),u=e.getChannelData(0);await m.evaluateModel(u,(e,t)=>{i.push(...e),n.push(...t)},e=>{g.kg.showPill("".concat(this.props.t("midi_parser.detecting_notes"),": ").concat(Math.floor(100*e),"%..."))}),g.kg.showPill(this.props.t("midi_parser.converting_audio_to_midi")),await (0,h.gw)(300);let p=l(c(i,n,.5,.3,11,!0,3e3,0,!0)),x=new d.Midi,y=x.addTrack();p.forEach(e=>{y.addNote({midi:e.pitchMidi,time:e.startTimeSeconds,duration:e.durationSeconds,velocity:e.amplitude})}),g.kg.hidePill(),this.mandleMidiFile(x,t)},this.mandleMidiFile=(e,t)=>{try{var s,i;let n=null===(s=e.header.tempos[0])||void 0===s?void 0:s.bpm,o=null===(i=e.header.keySignatures[0])||void 0===i?void 0:i.key,r=e.tracks.map((e,t)=>({track:e,selected:!0,layer:0,name:e.name||"Track n.".concat(t+1),numberOfAccidentals:0,maxScaling:0,outOfRangeBounds:{lower:0,upper:0},localOffset:null}));this.setState({tracks:r,fileName:t,bpm:Math.floor(4*n)||220,offset:0,pitch:a.T_.includes(o)?o:"C"},()=>{this.state.tracks.length&&this.convertMidi()})}catch(e){console.error(e),g.kg.error(this.props.t("midi_parser.error_is_file_midi"))}},this.convertMidi=()=>{let{tracks:e,bpm:t,offset:s,includeAccidentals:i,pitch:n}=this.state,o=e.filter(e=>e.selected),a=[],r=0,l=0,c=0;o.forEach(e=>{e.numberOfAccidentals=0,e.outOfRangeBounds.upper=0,e.outOfRangeBounds.lower=0,e.track.notes.forEach(t=>{var n;c++;let o=m.LG.fromMidi(e.layer,Math.floor(1e3*t.time),t.midi-(null!==(n=e.localOffset)&&void 0!==n?n:s),e.maxScaling);o.data.isAccidental&&(r++,e.numberOfAccidentals++),-1!==o.data.note?(i||!o.data.isAccidental)&&a.push(o):(l++,-1===o.data.outOfRangeBound&&e.outOfRangeBounds.lower++,1===o.data.outOfRangeBound&&e.outOfRangeBounds.upper++)})});let d=a.sort((e,t)=>e.time-t.time),p=Math.floor(6e4/t),x=[];for(;d.length>0;){let e=[d.shift()],t=0;for(let s=0;s<d.length;s++)e[0].time>d[s].time-p/9&&t++;x.push([...e,...d.splice(0,t)])}let y=[],f=0;x.forEach(e=>{let t=e[0];if(!t)return;let s=Math.floor((t.time-f-p)/p),i=new m.dF;f=t.time,s>-1&&Array(s).fill(0).forEach(()=>y.push(new m.dF)),i.notes=e.map(e=>{let t=new v.u;return t.set(e.layer,!0),new m.Ws(e.data.note,t)}),y.push(i)}),y.forEach(e=>{let t=(0,h.l3)(e);e.notes=t.map(e=>(e[0].layer=(0,h.UV)(e),e[0]))});let b=new u.l("Untitled");b.columns=y,b.bpm=t,b.instruments=[],b.instruments=this.props.data.instruments.map(e=>e.clone()),b.pitch=n;let j=this.props.data.selectedColumn;if(b.selected=j<b.columns.length?j:0,0===b.columns.length)return g.kg.warn(this.props.t("midi_parser.there_are_no_notes"));this.props.functions.loadSong(b),this.setState({accidentals:r,totalNotes:c,outOfRange:l})},this.editTrack=(e,t)=>{let s=this.state.tracks;Object.assign(s[e],t),this.setState({tracks:s},()=>{this.state.tracks.length>0&&this.convertMidi()})},this.changeOffset=e=>{Number.isInteger(e)||(e=0),this.state.offset!==e&&this.setState({offset:e},()=>{this.state.tracks.length>0&&this.convertMidi()})},this.changePitch=e=>{this.props.functions.changePitch(e),this.setState({pitch:e})},this.toggleAccidentals=()=>{this.setState({includeAccidentals:!this.state.includeAccidentals},()=>{this.state.tracks.length>0&&this.convertMidi()})},this.changeBpm=e=>{Number.isInteger(e)||(e=0),this.state.bpm!==e&&this.setState({bpm:e},()=>{this.state.tracks.length>0&&this.convertMidi()})},this.state={fileName:"",bpm:220,tracks:[],offset:0,pitch:"C",ignoreEmptytracks:!1,accidentals:0,outOfRange:0,totalNotes:0,includeAccidentals:!0,theme:p.f6},this.dispose=()=>{}}}var P=s(48043),L=s(92088),E=s(48506),O=(0,n.memo)(function(e){let{data:t,functions:s}=e,{t:a}=(0,R.$G)(["composer","common"]),[r,l]=(0,n.useState)("all"),{toggleTools:c,copyColumns:d,eraseColumns:h,pasteColumns:m,deleteColumns:u,resetSelection:g,undo:p,moveNotesBy:x}=s,{isToolsVisible:y,hasCopiedColumns:v,layer:f,selectedColumns:b,undoHistory:w}=t,_="all"===r?"all":f;return(0,i.jsx)(j.P,{className:"floating-tools ".concat(y?"floating-tools tools-visible":""),size:"1.2rem",isRelative:!1,offset:"0.1rem",children:(0,i.jsxs)("div",{className:"floating-tools-content",children:[(0,i.jsxs)("div",{className:"tools-buttons-grid",children:[(0,i.jsxs)(I,{area:"a",disabled:v,onClick:()=>d(_),active:v,tooltip:a("tools.copy_notes"),style:{flexDirection:"column",justifyContent:"center"},tooltipPosition:"bottom",children:[(0,i.jsx)(o.esY,{className:"tools-icon",size:24}),a("common:copy")]}),(0,i.jsxs)(I,{disabled:!v,onClick:()=>m(!1,_),tooltip:a("tools.paste_copied_notes"),area:"b",tooltipPosition:"bottom",children:[(0,i.jsx)(o.VGm,{className:"tools-icon"}),"all"===r?a("tools.paste_all_layers"):a("tools.paste_in_layer_n",{layer_number:f+1})]}),(0,i.jsxs)(I,{disabled:!v,onClick:()=>m(!0,_),tooltip:a("tools.insert_copied_notes"),area:"c",children:[(0,i.jsx)(E.ODP,{className:"tools-icon",style:{strokeWidth:"3px"}}),"all"===r?a("tools.insert_all_layers"):a("tools.insert_in_layer_n",{layer_number:f+1})]}),(0,i.jsxs)(I,{disabled:v,onClick:()=>h(_),tooltip:a("tools.erase_all_selected_notes"),area:"d",children:[(0,i.jsx)(o.arg,{className:"tools-icon"}),a("common:erase")]}),(0,i.jsxs)(I,{disabled:v||"all"!==_,onClick:u,tooltip:a("tools.delete_selected_columns"),area:"f",children:[(0,i.jsx)(o.Xm5,{className:"tools-icon",color:"var(--red)"}),a("common:delete")]}),(0,i.jsxs)(I,{disabled:v,tooltip:a("tools.move_notes_up_description"),area:"e",onClick:()=>x(1,_),children:[(0,i.jsx)(o.$Pg,{className:"tools-icon"}),a("tools.move_notes_up")]}),(0,i.jsxs)(I,{disabled:v,tooltip:a("tools.move_notes_down_description"),onClick:()=>x(-1,_),area:"g",children:[(0,i.jsx)(o.iUH,{className:"tools-icon"}),a("tools.move_notes_down")]})]}),(0,i.jsxs)("div",{className:"tools-right column",children:[(0,i.jsxs)(P.J,{style:{marginBottom:"0.2rem"},className:(0,k.h)(!0),toggled:"all"===r,onClick:()=>l("all"),children:[(0,i.jsx)(L.L_o,{style:{marginRight:"0.2rem"},size:16}),a("tools.all_layers"),(0,i.jsx)(k.u,{style:{left:0},children:a("tools.all_layers_description")})]}),(0,i.jsxs)(P.J,{style:{marginBottom:"0.2rem"},className:(0,k.h)(!0),toggled:"layer"===r,onClick:()=>l("layer"),children:[(0,i.jsx)(L.yo,{style:{marginRight:"0.2rem"},size:16}),a("tools.only_layer"),(0,i.jsx)("span",{style:{minWidth:"0.6rem",marginLeft:"0.2rem"},children:f+1}),(0,i.jsx)(k.u,{style:{left:0},children:a("tools.select_layer_description")})]}),(0,i.jsx)(P.J,{style:{marginBottom:"0.2rem",justifyContent:"center"},onClick:g,disabled:b.length<=1&&!v,toggled:v,children:a("tools.clear_selection")}),(0,i.jsxs)("div",{className:"row",style:{flex:"1",alignItems:"flex-end"},children:[(0,i.jsx)(P.J,{style:{flex:"1",justifyContent:"center"},disabled:0===w.length,onClick:p,children:a("common:undo")}),(0,i.jsx)(P.J,{onClick:c,style:{marginLeft:"0.2rem",flex:"1",justifyContent:"center"},children:a("common:ok")})]})]})]})})},(e,t)=>e.data.isToolsVisible===t.data.isToolsVisible&&e.data.hasCopiedColumns===t.data.hasCopiedColumns&&e.data.layer===t.data.layer&&e.data.selectedColumns===t.data.selectedColumns&&e.data.undoHistory===t.data.undoHistory);function I(e){let{disabled:t,onClick:s,active:n,style:o,children:a,tooltip:r,area:l,tooltipPosition:c}=e;return(0,i.jsxs)("button",{disabled:t,onClick:s,className:"flex-centered tools-button ".concat(n?"tools-button-highlighted":""," ").concat((0,k.h)(r)),style:{gridArea:l,...o},children:[a,r&&(0,i.jsx)(k.u,{position:c||"top",children:r})]})}var H=s(67274),B=s(79317);let F=new Map(Array(16).fill(0).map((e,t)=>{let s=t.toString(2).split("").map(e=>parseInt(e)).reverse();return[t,"".concat(a.Al.noteComposer," ").concat(s.map((e,t)=>1===e?"layer-".concat(t+1):"").join(" "))]})),D={note_background:p.f6.get("note_background").desaturate(.6).toString(),isAccentDefault:p.f6.isDefault("accent")};var z=(0,n.memo)(function(e){var t,s;let{data:o,layer:r,instrument:l,clickAction:c,noteText:d,noteImage:m,theme:u}=e,[g,x]=(0,n.useState)(D);(0,n.useEffect)(()=>{let e=p.f6.get("note_background").desaturate(.6);x({note_background:e.isDark()?e.lighten(.45).toString():e.darken(.18).toString(),isAccentDefault:p.f6.isDefault("accent")})},[u]);let y=null!==(s=F.get(r))&&void 0!==s?s:a.Al.noteComposer;return(0,i.jsx)("button",{onPointerDown:e=>{(0,h.PF)(e),c(o)},className:"button-hitbox",onContextMenu:h.PF,children:(0,i.jsxs)("div",{className:y,children:["Genshin"===a.iC&&(0,i.jsx)(H.Z,{fill:g.note_background,className:"genshin-border"}),(0,i.jsx)(B.Z,{name:m,color:g.isAccentDefault?null===(t=a.as[l])||void 0===t?void 0:t.fill:void 0,background:"var(--note-background)"}),(0,i.jsx)("div",{className:"layer-3-ball-bigger"}),(0,i.jsx)("div",{className:"layer-4-line"}),(0,i.jsx)("div",{className:"Sky"===a.iC?"note-name-sky":"note-name",children:d})]})})},(e,t)=>e.noteText===t.noteText&&e.clickAction===t.clickAction&&e.noteImage===t.noteImage&&e.noteText===t.noteText&&e.layer===t.layer&&e.instrument===t.instrument),X=s(92634),V=s(82446);function J(e){let{data:t,functions:s}=e,{t:n}=(0,R.$G)("composer"),{keyboard:r,isPlaying:l,noteNameType:c,currentColumn:d,pitch:h,currentLayer:m,isRecordingAudio:u}=t,{handleClick:g,handleTempoChanger:p}=s,[x]=(0,X.F)();if(void 0===r)return(0,i.jsx)("div",{className:"composer-keyboard-wrapper",style:{marginBottom:"4rem"},children:(0,i.jsx)("h1",{children:n("error_with_this_layer")})});if(u)return(0,i.jsxs)("div",{className:"composer-keyboard-wrapper",style:{marginBottom:"4rem",flexDirection:"column",alignItems:"center"},children:[(0,i.jsxs)(V.h,{children:[n("recording_audio"),"..."]}),(0,i.jsx)(P.J,{onClick:()=>s.startRecordingAudio(!1),toggled:!0,children:n("stop_recording_audio")})]});let y="keyboard";return 15===r.notes.length&&(y+=" keyboard-5"),14===r.notes.length&&(y+=" keyboard-5"),8===r.notes.length&&(y+=" keyboard-4"),6===r.notes.length&&(y+=" keyboard-3"),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{className:"composer-keyboard-wrapper",children:[t.settings.useKeyboardSideButtons.value&&(0,i.jsx)("button",{onPointerDown:()=>s.selectColumnFromDirection(-1),className:"keyboard-column-selection-buttons ".concat(t.isPlaying?"":"keyboard-column-selection-buttons-visible"),style:{paddingRight:"0.5rem",justifyContent:"flex-end",visibility:t.isPlaying?"hidden":"visible"},children:(0,i.jsx)(o.bUI,{})}),(0,i.jsxs)("div",{className:y,children:[0===r.notes.length?(0,i.jsx)("div",{className:"loading",children:"Loading..."}):null,r.notes.map((e,s)=>{try{let n=d.notes.findIndex(e=>e.index===s);return(0,i.jsx)(z,{layer:n>=0?d.notes[n].layer.toLayerStatus(m,t.instruments):0,data:e,theme:x,noteText:r.getNoteText(s,c,h),instrument:r.name,noteImage:e.noteImage,clickAction:g},e.index)}catch(e){return"Err"}})]}),t.settings.useKeyboardSideButtons.value&&(0,i.jsx)("button",{onPointerDown:()=>s.selectColumnFromDirection(1),className:"keyboard-column-selection-buttons ".concat(t.isPlaying?"":"keyboard-column-selection-buttons-visible"),style:{paddingLeft:"0.5rem",justifyContent:"flex-start",visibility:t.isPlaying?"hidden":"visible"},children:(0,i.jsx)(o.Dli,{})})]}),(0,i.jsxs)("div",{className:"tempo-changers-wrapper ".concat(l?"tempo-changers-wrapper-hidden":""),children:[(0,i.jsx)("div",{className:"bottom-right-text",children:n("tempo")}),a.nq.map(e=>(0,i.jsx)("button",{onClick:()=>p(e),style:{...1===e.changer?{backgroundColor:x.get("primary").toString(),color:x.getText("primary").toString()}:{backgroundColor:"#"+e.color.toString(16)},outline:t.currentColumn.tempoChanger===e.id?"3px ".concat(x.get("composer_accent").toString()," solid"):"unset",outlineOffset:"-3px"},children:e.text},e.id))]})]})}var U=s(78810),W=s(63805),Z=s.n(W),G=s(6767),q=s.n(G),$=s(57564),Q=s(43531);$.Xd.LINE_SCALE_MODE=$.F4.NORMAL;let{horizontalLineBreak:Y,standards:K,layersCombination:ee,breakpoints:et}=a.CACHE_DATA;class es{constructor({width:e,height:t,margin:s=4,timelineHeight:i=30,app:n,breakpointsApp:o,colors:r}){this.destroy=()=>{this.cache.columns.forEach(e=>e.destroy(!0)),this.cache.standard.forEach(e=>e.destroy(!0)),this.cache.columnsLarger.forEach(e=>e.destroy(!0)),this.cache.standardLarger.forEach(e=>e.destroy(!0)),this.cache.breakpoints.forEach(e=>e.destroy(!0)),Object.values(this.cache.notes).forEach(e=>e.destroy(!0)),this.app=null,this.breakpointsApp=null},this.generate=()=>{a.nq.forEach(e=>{let t=this.drawColumn(e,1);t&&this.cache.columns.push(t)}),this.colors.bars.forEach(e=>{let t=this.drawColumn(e,1);t&&this.cache.standard.push(t)}),this.colors.bars.forEach(e=>{let t=this.drawColumn(e,3);t&&this.cache.standardLarger.push(t)}),ee.forEach(e=>{let t=this.noteWidth,s=this.noteHeight,i=this.noteWidth>20?3:2,n=new v.u(e),o=new $.K3;if(n.test(0)&&o.beginFill(new(q())(this.colors.mainLayer).rgbNumber()).lineStyle(1,new(q())(this.colors.mainLayer).rgbNumber()).drawRoundedRect(this.margin/2-.25,this.margin/2,Math.ceil(t-this.margin),Math.ceil(s-this.margin),i).endFill(),n.test(1)&&o.lineStyle(4===this.margin?3:2,new(q())(this.colors.secondLayer).rgbNumber()).drawRoundedRect(this.margin/2-.25,this.margin/2,Math.ceil(t-this.margin),Math.ceil(s-this.margin),i).endFill(),n.test(2)&&o.beginFill(new(q())(this.colors.secondLayer).rgbNumber()).lineStyle(1,new(q())(this.colors.secondLayer).rgbNumber()).drawCircle(t/2-.25,s/2,s/3-.5).endFill(),n.test(3)){let e=4===this.margin?3:2;o.lineStyle(e,new(q())(this.colors.secondLayer).darken(.15).rgbNumber()).moveTo(this.margin/2+.5,s/2).lineTo(t-this.margin+.5,s/2).endFill()}if(!this.app)return;let a=this.app.renderer.generateTexture(o,{resolution:2,scaleMode:Q.aH$.LINEAR,region:new Q.AeJ(0,0,this.noteWidth,this.noteHeight)});this.cache.notes[e]=a,o.destroy(!0)}),a.nq.forEach(e=>{let t=this.drawColumn(e,2);t&&this.cache.columnsLarger.push(t)}),et.forEach(e=>{let t=new $.K3,s=this.timelineHeight/6;if("short"===e.type){if(t.beginFill(this.colors.accent.rgbNumber()),t.drawCircle(s,this.timelineHeight/2,s).endFill(),!this.breakpointsApp)return;let e=this.breakpointsApp.renderer.generateTexture(t,{scaleMode:Q.aH$.LINEAR,resolution:2,region:new Q.AeJ(0,0,2*s,this.timelineHeight)});this.cache.breakpoints.push(e),t.destroy(!0)}else{if(t.beginFill(this.colors.accent.rgbNumber()).moveTo(0,this.height).lineTo(this.noteWidth/2,this.height).lineTo(0,this.height-this.noteHeight).endFill(),t.beginFill(this.colors.accent.rgbNumber()).moveTo(this.width,this.height).lineTo(this.noteWidth/2,this.height).lineTo(this.width,this.height-this.noteHeight).endFill(),t.beginFill(this.colors.accent.rgbNumber()).moveTo(0,0).lineTo(this.noteWidth/2,0).lineTo(0,this.noteHeight).endFill(),t.beginFill(this.colors.accent.rgbNumber()).moveTo(this.width,0).lineTo(this.noteWidth/2,0).lineTo(this.width,this.noteHeight).endFill(),!this.app)return;let e=this.app.renderer.generateTexture(t,{scaleMode:Q.aH$.LINEAR,resolution:2});this.cache.breakpoints.push(e),t.destroy(!0)}})},this.drawColumn=(e,t)=>{var s;let i=new $.K3;i.beginFill(e.color),i.drawRect(0,0,this.width,this.height),i.lineStyle(t,3355443).moveTo(this.width,0).lineTo(this.width,this.height),i.lineStyle(1,3355443);for(let e=1;e<3;e++){let t=this.noteHeight*Y*e;i.moveTo(0,t),i.lineTo(this.width,t)}if(!this.app)return;let n=this.app.renderer.generateTexture(i,{scaleMode:Q.aH$.LINEAR,resolution:(null===(s=window)||void 0===s?void 0:s.devicePixelRatio)||1,region:new Q.AeJ(0,0,this.width,this.height)});return i.destroy(!0),n},this.cache={columns:[],notes:{},standard:[],columnsLarger:[],standardLarger:[],breakpoints:[]},this.width=e,this.height=t,this.timelineHeight=i,this.margin=s,this.noteWidth=this.width,this.noteHeight=this.height/a.WO,this.colors=r,this.app=n,this.breakpointsApp=o,this.generate()}}var ei=s(97411);function en(e){let{notes:t,index:s,sizes:n,cache:o,instruments:r,backgroundCache:l,isBreakpoint:c,isSelected:d,isToolsSelected:h,currentLayer:m}=e;return(0,i.jsxs)(U.W2,{eventMode:"static",x:n.width*s,children:[(0,i.jsxs)(U.jy,{texture:l,children:[(d||h)&&(0,i.jsx)(U.jy,{texture:h&&!d?o.standard[3]:o.standard[2],alpha:h&&!d?.4:.8,zIndex:1}),c&&(0,i.jsx)(U.jy,{texture:o.breakpoints[1]})]}),t.map(e=>{let t=e.layer.toLayerStatus(m,r);return 0===t?null:(0,i.jsx)(U.jy,{texture:o.notes[t],y:a.zW[e.index]*n.height/a.WO},e.index)})]})}function eo(e){let{onClick:t,children:s,tooltip:n,style:o,ariaLabel:a}=e;return(0,i.jsxs)("button",{className:"timeline-button ".concat((0,k.h)(n)),onClick:t,style:o,"aria-label":a,children:[s,n&&(0,i.jsx)(k.u,{children:n})]})}var ea=s(7374);let er=(0,n.memo)(function(e){let{breakpoints:t,texture:s,columns:n,width:o}=e;return t.map(e=>(0,i.jsx)(U.jy,{texture:s,interactive:!1,anchor:[.5,0],x:o/(n-1)*e},e))},(e,t)=>e.breakpoints===t.breakpoints&&e.texture===t.texture&&e.width===t.width&&e.columns===t.columns);class el extends n.Component{componentDidMount(){var e,t,s,i,n;let{numberOfColumnsPerCanvas:o}=this.state,r=document.body.getBoundingClientRect(),l=(0,h.VN)(.85*r.width-45),c=(0,h.VN)(.45*r.height);"Sky"===a.iC&&(c=(0,h.VN)(.95*c)),this.setState({width:Math.floor(l),height:Math.floor(c),stageOptions:{backgroundColor:p.f6.get("primary").rgbNumber(),autoDensity:!0,resolution:null!==(i=window.devicePixelRatio)&&void 0!==i?i:1.4},timelineOptions:{backgroundAlpha:0,autoDensity:!0,resolution:null!==(n=window.devicePixelRatio)&&void 0!==n?n:1.4},numberOfColumnsPerCanvas:o,column:{width:(0,h.VN)(l/o),height:c},timelineHeight:Z()()?25:30},()=>{window.addEventListener("resize",this.recalculateCacheAndSizes),this.recalculateCacheAndSizes()}),window.addEventListener("pointerup",this.resetPointerDown),window.addEventListener("blur",this.resetPointerDown);let d=(0,ea.JZ)("composer","composer_canvas",e=>{let{shortcut:t}=e,{name:s}=t;"next_breakpoint"===s&&this.handleBreakpoints(1),"previous_breakpoint"===s&&this.handleBreakpoints(-1)});null===(s=this.notesStageRef)||void 0===s||null===(t=s.current)||void 0===t||null===(e=t._canvas)||void 0===e||e.addEventListener("wheel",this.handleWheel);let m=(0,X.B)(this.handleThemeChange);this.cleanup.push(m,d)}componentWillUnmount(){var e,t,s,i;window.removeEventListener("pointerup",this.resetPointerDown),window.removeEventListener("blur",this.resetPointerDown),window.removeEventListener("resize",this.recalculateCacheAndSizes),this.cacheRecalculateDebounce&&clearTimeout(this.cacheRecalculateDebounce),null===(s=this.notesStageRef)||void 0===s||null===(t=s.current)||void 0===t||null===(e=t._canvas)||void 0===e||e.removeEventListener("wheel",this.handleWheel),this.cleanup.forEach(e=>e()),null===(i=this.state.cache)||void 0===i||i.destroy(),this.notesStageRef=null,this.breakpointsStageRef=null}generateCache(e,t,s,i){var n,o;let a={l:p.f6.get("primary"),d:p.f6.get("primary")};return(a.l=.05>a.l.luminosity()?a.l.lighten(.4):a.l.lighten(.1),a.d=.05>a.d.luminosity()?a.d.lighten(.15):a.d.darken(.03),(null===(n=this.notesStageRef)||void 0===n?void 0:n.current)&&(null===(o=this.breakpointsStageRef)||void 0===o?void 0:o.current))?new es({width:e,height:t,margin:s,timelineHeight:i,app:this.notesStageRef.current.app,breakpointsApp:this.breakpointsStageRef.current.app,colors:{accent:p.f6.get("composer_accent").rotate(20).darken(.5),mainLayer:p.f6.get("composer_main_layer"),secondLayer:p.f6.get("composer_secondary_layer"),bars:[{color:a.l.rgbNumber()},{color:a.d.rgbNumber()},{color:p.f6.get("composer_accent").rgbNumber()},{color:p.f6.get("composer_accent").negate().rgbNumber()}]}}):null}render(){var e;let{width:t,timelineHeight:s,height:n,theme:a,numberOfColumnsPerCanvas:r,stageOptions:l}=this.state,{data:c,functions:d}=this.props,h=null===(e=this.state.cache)||void 0===e?void 0:e.cache,m=this.state.column,u=-((c.selected-r/2+1)*m.width),g=Number(c.settings.beatMarks.value),p=0===g?12:4*g,x=t/c.columns.length,y=Math.floor(x*(t/m.width+1)),v=x*c.selected-r/2*x,f=c.breakpoints.includes(c.selected),b=a.sideButtons.rgb,{t:j}=this.props;return(0,i.jsxs)("div",{className:"canvas-wrapper "+(c.inPreview?"canvas-wrapper-in-preview":""),style:{width:t,backgroundColor:h?"unset":a.main.backgroundHex},children:[(0,i.jsxs)("div",{className:"canvas-relative",children:[(0,i.jsx)(U.Hf,{width:t,height:n,raf:!1,onMount:this.recalculateCacheAndSizes,style:{opacity:a.main.backgroundOpacity},renderOnComponentChange:!0,options:l,ref:this.notesStageRef,children:h&&!c.isRecordingAudio&&(0,i.jsx)(U.W2,{x:u,eventMode:"static",pointerdown:this.handleClickStage,pointerup:this.handleClickStageUp,pointermove:this.handleStageSlide,interactiveChildren:!1,hitArea:this.testStageHitarea,children:c.columns.map((e,t)=>{if(!function(e,t,s){let i=s/2+2;return t-i<e&&e<t+i}(t,c.selected,r))return null;let s=(t+1)%4==0?h.columnsLarger:h.columns,n=(t+1)%4==0?h.standardLarger:h.standard,o=0===e.tempoChanger?n[Number(t%(2*p)>=p)]:s[e.tempoChanger];return(0,i.jsx)(en,{cache:h,notes:e.notes,index:t,sizes:m,instruments:c.song.instruments,currentLayer:c.currentLayer,backgroundCache:o,isToolsSelected:c.selectedColumns.includes(t),isSelected:t===c.selected,isBreakpoint:c.breakpoints.includes(t)},t)})})}),!c.settings.useKeyboardSideButtons.value&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("button",{onPointerDown:()=>d.selectColumn(c.selected-1),className:"canvas-buttons ".concat(c.isPlaying?"":"canvas-buttons-visible"),style:{left:"0",paddingRight:"0.5rem",justifyContent:"flex-start",background:"linear-gradient(90deg, rgba(".concat(b,",0.80) 30%, rgba(").concat(b,",0.30) 80%, rgba(").concat(b,",0) 100%)")},children:(0,i.jsx)(o.bUI,{})}),(0,i.jsx)("button",{onPointerDown:()=>d.selectColumn(c.selected+1),className:"canvas-buttons ".concat(c.isPlaying?"":"canvas-buttons-visible"),style:{right:"0",paddingLeft:"0.5rem",justifyContent:"flex-end",background:"linear-gradient(270deg, rgba(".concat(b,",0.80) 30%, rgba(").concat(b,",0.30) 80%, rgba(").concat(b,",0) 100%)")},children:(0,i.jsx)(o.Dli,{})})]})]}),(0,i.jsx)("div",{className:"timeline-wrapper-bg row",children:(0,i.jsxs)("div",{className:"timeline-wrapper",style:{height:this.state.timelineHeight},children:[(0,i.jsx)(eo,{onClick:()=>this.handleBreakpoints(-1),tooltip:j("previous_breakpoint"),style:{backgroundColor:a.timeline.hex},ariaLabel:j("previous_breakpoint"),children:(0,i.jsx)(ei.c,{icon:o.qSR,size:16})}),(0,i.jsx)(eo,{onClick:()=>this.handleBreakpoints(1),tooltip:j("next_breakpoint"),style:{marginLeft:0,backgroundColor:a.timeline.hex},ariaLabel:j("next_breakpoint"),children:(0,i.jsx)(ei.c,{icon:o.Nqc,size:16})}),(0,i.jsx)("div",{className:"timeline-scroll",style:{backgroundColor:a.timeline.hex},children:(0,i.jsxs)(U.Hf,{width:t,height:s,options:this.state.timelineOptions,raf:!1,ref:this.breakpointsStageRef,renderOnComponentChange:!0,children:[h&&(0,i.jsxs)(U.W2,{width:t,height:s,eventMode:"static",pointerdown:this.handleClickDown,pointerup:this.handleClickUp,pointermove:this.handleSliderSlide,interactiveChildren:!1,hitArea:this.testTimelineHitarea,children:[(0,i.jsx)(U.TC,{draw:e=>{e.clear(),e.beginFill(a.timeline.hexNumber),e.drawRect(0,0,t,s)}}),c.selectedColumns.length?(0,i.jsx)(U.TC,{draw:e=>{let t=c.selectedColumns[0]||0,i=c.selectedColumns[c.selectedColumns.length-1],n=t*x;e.clear(),e.beginFill(a.timeline.selected,.6),e.drawRect(n,0,i*x-n,s)}}):null,(0,i.jsx)(er,{breakpoints:c.breakpoints,texture:h.breakpoints[0],width:t,columns:c.columns.length})]}),(0,i.jsx)(U.TC,{draw:e=>{e.clear(),e.lineStyle(3,a.timeline.border,.8),e.drawRoundedRect(0,0,y,s-3,6)},x:v,y:1.5})]})}),(0,i.jsx)(eo,{onClick:d.toggleBreakpoint,style:{backgroundColor:a.timeline.hex},tooltip:j(f?"remove_breakpoint":"add_breakpoint"),ariaLabel:j(f?"remove_breakpoint":"add_breakpoint"),children:(0,i.jsx)(ei.c,{icon:f?o.wbB:o.EIY,size:16})})]})})]})}constructor(e){super(e),this.cleanup=[],this.resetPointerDown=()=>{this.stageSelected=!1,this.sliderSelected=!1,this.stagePreviousPositon=0},this.handleThemeChange=()=>{this.setState({stageOptions:{...this.state.stageOptions,backgroundColor:p.f6.get("primary").rgbNumber()},theme:{timeline:{hex:p.f6.layer("primary",.1).hex(),hexNumber:p.f6.layer("primary",.1).rgbNumber(),selected:p.f6.get("composer_accent").negate().rgbNumber(),border:p.f6.get("composer_accent").rgbNumber()},sideButtons:{hex:p.f6.get("primary").darken(.08).hex(),rgb:(0,h.nA)(p.f6.get("primary").darken(.08)).join(",")},main:{background:p.f6.get("primary").rgbNumber(),backgroundHex:p.f6.get("primary").hexa(),backgroundOpacity:Math.max(p.f6.get("primary").alpha(),.8)}}},()=>{var e;this.recalculateCacheAndSizes(),(null===(e=this.notesStageRef)||void 0===e?void 0:e.current)&&(this.notesStageRef.current.app.renderer.background.color=this.state.theme.main.background)})},this.recalculateCacheAndSizes=()=>{this.cacheRecalculateDebounce&&clearTimeout(this.cacheRecalculateDebounce),this.cacheRecalculateDebounce=setTimeout(()=>{var e,t;if(!(null===(e=this.notesStageRef)||void 0===e?void 0:e.current)||!(null===(t=this.breakpointsStageRef)||void 0===t?void 0:t.current))return;let s=document.body.getBoundingClientRect(),{numberOfColumnsPerCanvas:i}=this.state,{inPreview:n}=this.props.data,o=(0,h.VN)(.85*s.width-45),r=(0,h.VN)(.45*s.height);"Sky"===a.iC&&(r=(0,h.VN)(.95*r)),n&&(o=(0,h.VN)(o*(s.width<900?.8:.55)),r=(0,h.VN)(r*(s.width<900?.8:.6)));let l=(0,h.VN)(o/i),c=this.state.cache;this.setState({width:Math.floor(o),height:Math.floor(r),column:{width:l,height:r},cache:this.generateCache(l,r,Z()()?2:4,Z()()?25:30)},()=>{setTimeout(()=>{null==c||c.destroy()},500)})},50)},this.handleWheel=e=>{this.props.functions.selectColumn(this.props.data.selected+Math.sign(e.deltaY),!0)},this.handleClick=(e,t)=>{let s=e.globalX,{width:i,numberOfColumnsPerCanvas:n}=this.state,{data:o}=this.props;if(this.stageXMovement=0,this.stageMovementAmount=0,"up"===t&&(this.sliderSelected=!1),"down-slider"===t){this.sliderSelected=!0;let t=i/o.columns.length,a=t*(n+1),r=t*o.selected-n/2*t;this.onSlider=s>r&&s<r+a,this.sliderOffset=r+a/2-s,this.throttleScroll=Number.MAX_SAFE_INTEGER,this.handleSliderSlide(e)}"down-stage"===t&&(this.stagePreviousPositon=s,this.stageSelected=!0)},this.handleClickStage=e=>{this.handleClick(e,"down-stage")},this.handleClickStageUp=e=>{if(this.stageSelected=!1,0===this.stageMovementAmount){let t=this.state.numberOfColumnsPerCanvas/2*this.state.column.width,s=Math.floor((e.globalX-t)/this.state.column.width+1);if(0===s)return;let{data:i,functions:n}=this.props,o=i.selected+Math.round(s);n.selectColumn((0,h.uZ)(o,0,i.columns.length-1))}},this.handleClickDown=e=>{this.handleClick(e,"down-slider")},this.handleClickUp=e=>{this.handleClick(e,"up")},this.handleStageSlide=e=>{let t=e.globalX,s=this.stagePreviousPositon-t;if(this.stagePreviousPositon=t,this.stageSelected){let e=this.state.column.width,{data:t,functions:i}=this.props;this.stageXMovement+=s;let n=(this.stageXMovement-this.stageMovementAmount*e)/e;if(1>Math.abs(n))return;this.stageMovementAmount+=Math.round(n);let o=t.selected+Math.round(n);i.selectColumn((0,h.uZ)(o,0,t.columns.length-1),!0)}},this.handleBreakpoints=e=>{let{selected:t,columns:s,breakpoints:i}=this.props.data,n=1===e?i.filter(e=>e>t).sort((e,t)=>e-t):i.filter(e=>e<t).sort((e,t)=>t-e);0!==n.length&&s.length>=n[0]&&n[0]>=0&&this.props.functions.selectColumn(n[0])},this.handleSliderSlide=e=>{let t=e.globalX;if(this.sliderSelected){if(this.throttleScroll++<4)return;let{width:e,column:s}=this.state,{data:i}=this.props;this.hasSlided=!0,this.throttleScroll=0;let n=s.width*i.columns.length,o=Math.floor((this.onSlider?t+this.sliderOffset:t)/e*n/s.width);this.props.functions.selectColumn((0,h.uZ)(o,0,i.columns.length-1),!0)}},this.testStageHitarea={contains:(e,t)=>{if(this.stageSelected)return!0;let s=this.state.column.width*this.props.data.columns.length;return!(e<0)&&!(e>s)&&!(t<0)&&!(t>this.state.height)}},this.testTimelineHitarea={contains:(e,t)=>!!this.sliderSelected||!(e<0)&&!(e>this.state.width)&&!(t<0)&&!(t>this.state.timelineHeight)};let t=Number(this.props.data.settings.columnsPerCanvas.value);this.state={width:Math.floor(300),height:Math.floor(150),numberOfColumnsPerCanvas:t,stageOptions:{backgroundColor:p.f6.get("primary").rgbNumber(),autoDensity:!0,resolution:1.4},timelineOptions:{backgroundAlpha:0,autoDensity:!0,resolution:1.4},column:{width:(0,h.VN)(300/t),height:150},timelineHeight:30,currentBreakpoint:-1,theme:{timeline:{hex:p.f6.layer("primary",.1).toString(),hexNumber:p.f6.layer("primary",.1).rgbNumber(),selected:p.f6.get("composer_accent").negate().rgbNumber(),border:p.f6.get("composer_accent").rgbNumber()},sideButtons:{hex:p.f6.get("primary").darken(.08).toString(),rgb:(0,h.nA)(p.f6.get("primary").darken(.08)).join(",")},main:{background:p.f6.get("primary").rgbNumber(),backgroundHex:p.f6.get("primary").toString(),backgroundOpacity:p.f6.get("primary").alpha()}},cache:null},this.notesStageRef=(0,n.createRef)(),this.breakpointsStageRef=(0,n.createRef)(),this.stageSelected=!1,this.sliderSelected=!1,this.hasSlided=!1,this.stagePreviousPositon=0,this.stageMovementAmount=0,this.sliderOffset=0,this.stageXMovement=0,this.throttleScroll=0,this.onSlider=!1,this.cacheRecalculateDebounce=0}}var ec=s(54135),ed=s(20027),eh=s(45610),em=s(33297),eu=s(17678),eg=s(52461),ep=s(31602),ex=s(86998),ey=s(86087),ev=s(6340),ef=s(40398),eb=s(24104),ej=s(21249),ew=s(12293),e_=s(89867),ek=s(85565),eC=s(41664),eS=s.n(eC),eN=s(5323),eR=s(99962),eT=s(71823),eM=s(95616);let eA=["vsrg"];function eP(e){let{data:t,functions:s,theme:a,folders:r}=e,{t:l}=(0,R.$G)(["composer","common","menu","logs","settings"]),{removeSong:c,toggleMenu:d,renameSong:h,loadSong:m,downloadSong:u}=s,p={backgroundColor:a.layer("primary",.15).toString()},[x,y]=(0,n.useState)(!1),[v,f]=(0,n.useState)(t.name);return((0,n.useEffect)(()=>{f(t.name)},[t.name]),"vsrg"===t.type)?(0,i.jsx)("div",{className:"row",children:l("menu:invalid_song")}):(0,i.jsxs)("div",{className:"song-row",children:[(0,i.jsxs)("div",{className:"song-name ".concat((0,k.h)(!0)),onClick:async()=>{if(x)return;g.kg.showPill(l("logs:loading_song"));let e=await ek.v.getOneSerializedFromStorable(t);if(g.kg.hidePill(),!e)return g.kg.error(l("logs:could_not_find_song"));m(e),d(!1)},children:[x?(0,i.jsx)("input",{className:"song-name-input ".concat(x?"song-rename":""),disabled:!x,onChange:e=>f(e.target.value),style:{width:"100%",color:"var(--primary-text)"},value:v}):(0,i.jsx)("div",{style:{marginLeft:"0.3rem"},children:v}),(0,i.jsx)(k.u,{children:x?l("menu:song_name"):l("menu:open_in_composer")})]}),(0,i.jsx)("div",{className:"song-buttons-wrapper",children:(0,i.jsxs)(eg.Rk,{Icon:o.LCi,ignoreClickOutside:x,style:p,tooltip:l("settings:more_options"),onClose:()=>y(!1),children:[(0,i.jsxs)(P.J,{className:"row row-centered",style:{padding:"0.4rem"},onClick:()=>{x&&(h(v,t.id),y(!1)),y(!x)},children:[(0,i.jsx)(o.tU3,{style:{marginRight:"0.4rem"}}),(0,i.jsx)(eg.Qr,{text:x?l("common:save"):l("common:rename")})]}),(0,i.jsxs)(eg.tc,{style:{padding:"0 0.4rem"},children:[(0,i.jsx)(o.$nz,{style:{marginRight:"0.4rem"}}),(0,i.jsxs)("select",{className:"dropdown-select",value:t.folderId||"_None",onChange:async e=>{let s=e.target.value,i=await ek.v.getOneSerializedFromStorable(t);if(!i)return g.kg.error(l("logs:could_not_find_song"));ev.k.addSongToFolder(i,"_None"!==s?s:null)},children:[(0,i.jsx)("option",{value:"_None",children:l("common:none")}),r.map(e=>(0,i.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,i.jsxs)(eg.tc,{style:{width:"100%"},onClick:async()=>{(null==t?void 0:t.type)==="recorded"&&g.kg.warn(l("logs:converting_recorded_to_composed_warning"));let e=await ek.v.getOneSerializedFromStorable(t);if(!e)return g.kg.error(l("logs:could_not_find_song"));m(e),d(!1)},children:[(0,i.jsx)(o.fmQ,{style:{marginRight:"0.4rem"},size:14}),(0,i.jsx)(eg.Qr,{text:l("common:edit_song")})]}),(0,i.jsxs)(eg.tc,{onClick:async()=>{let e=await ek.v.getOneSerializedFromStorable(t);if(!e)return g.kg.error(l("logs:could_not_find_song"));u(e,"song")},children:[(0,i.jsx)(o.aBF,{style:{marginRight:"0.4rem"}}),(0,i.jsx)(eg.Qr,{text:l("common:download")})]}),("recorded"===t.type||"composed"===t.type)&&(0,i.jsxs)(eg.tc,{onClick:async()=>{u(await ek.v.fromStorableSong(t),"midi")},children:[(0,i.jsx)(o.aBF,{style:{marginRight:"0.4rem"},size:14}),(0,i.jsx)(eg.Qr,{text:l("common:download_midi")})]}),(0,i.jsxs)(eg.tc,{onClick:async()=>{let e=await ek.v.fromStorableSong(t),s=e.clone();s.name="".concat(e.name," - (clone)"),await ev.k.addSong(s),g.kg.log(l("logs:cloned_song",{song_name:t.name}))},children:[(0,i.jsx)(o.d_e,{style:{marginRight:"0.4rem"}}),(0,i.jsx)(eg.Qr,{text:l("composer:clone_song")})]}),(0,i.jsxs)(eg.tc,{onClick:()=>c(t.name,t.id),children:[(0,i.jsx)(o.Xm5,{color:"#ed4557",style:{marginRight:"0.4rem"}}),(0,i.jsx)(eg.Qr,{text:l("common:delete")})]})]})})]})}var eL=(0,n.memo)(function(e){let{data:t,functions:s,inPreview:a}=e,{t:r}=(0,R.$G)(["composer","common","menu","logs","settings","confirm","question","tutorials"]),[l,d]=(0,n.useState)(!1),[m,u]=(0,n.useState)(!1),{IS_MIDI_AVAILABLE:p}=(0,eN.Z)(),[x]=(0,eb.n)(),[y]=(0,ey.j)(),[v,b]=(0,n.useState)("Settings"),{loadSong:j,changePage:w,renameSong:_,handleSettingChange:k,changeVolume:C,createNewSong:S,changeMidiVisibility:N,updateThisSong:T,downloadSong:M}=s,[A]=(0,X.F)(),L=(0,ew.ZP)(e=>{Z()()?u(!1):d(!1)},{active:l&&m,ignoreFocusable:!0});(0,n.useEffect)(()=>(ej.w.register("Escape",()=>{u(!1)},{id:"composer_menu"}),()=>ej.w.unregisterById("composer_menu")),[]);let E=(0,n.useCallback)(e=>{"boolean"!=typeof e&&(e=void 0),u(t=>void 0!==e?e:!t)},[]),O=(0,n.useCallback)(async(e,t)=>{await (0,ep.jH)(r("confirm:delete_song",{song_name:e}))&&(await ev.k.removeSong(t),em.Z.userSongs("delete",{page:"composer"}))},[r]),I=(0,n.useCallback)(async()=>{let e=await (0,ep.cJ)(r("question:enter_folder_name"));e&&ef.p.createFolder(e)},[r]),H=(0,n.useCallback)(async e=>{for(let t of e)try{let e=Array.isArray(t.data)?t.data:[t.data];await e_.bV.importAndLog(e)}catch(e){console.error(e),e&&console.error(e),g.kg.error(r("logs:error_importing_invalid_format"),8e3)}},[r]);return(0,i.jsxs)(eR.q,{style:a?{position:"absolute"}:{},ref:L,open:l,setOpen:d,current:v,setCurrent:b,visible:m,children:[(0,i.jsx)("div",{className:"hamburger",onClick:()=>u(!m),children:(0,i.jsx)(ei.c,{icon:o.Fm7})}),(0,i.jsxs)(eR.V,{children:[(0,i.jsx)(ec.j,{onClick:()=>E(),className:"close-menu",ariaLabel:r("menu:close_menu"),children:(0,i.jsx)(ei.c,{icon:o.aHS,className:"icon"})}),(0,i.jsx)(ec.j,{onClick:T,className:t.hasChanges?"not-saved":"",ariaLabel:"Save",style:{marginTop:"auto"},children:(0,i.jsx)(ei.c,{icon:o.TvB,className:"icon"})}),(0,i.jsx)(ec.s,{id:"Songs",ariaLabel:r("menu:open_songs_menu"),children:(0,i.jsx)(ei.c,{icon:o.HcQ,className:"icon"})}),(0,i.jsx)(ec.s,{id:"Settings",ariaLabel:r("menu:open_settings_menu"),children:(0,i.jsx)(ei.c,{icon:o.p4t,className:"icon"})}),(0,i.jsx)(ec.j,{onClick:()=>w("Home"),ariaLabel:"Open home menu",style:{border:"solid 0.1rem var(--secondary)"},children:(0,i.jsx)(ei.c,{icon:o.xng,className:"icon"})})]}),(0,i.jsxs)(ed.f,{style:a?{position:"absolute"}:{},children:[(0,i.jsxs)(ed.G,{id:"Songs",children:[(0,i.jsxs)("div",{className:"songs-buttons-wrapper",children:[(0,i.jsx)(f.k,{children:(0,i.jsxs)("ul",{children:[(0,i.jsxs)("li",{children:[r("tutorials:composer.li_1")," "]}),(0,i.jsxs)("li",{children:[r("tutorials:composer.li_2")," "]}),(0,i.jsxs)("li",{children:[r("tutorials:composer.li_3")," "]}),(0,i.jsxs)("li",{children:[r("tutorials:composer.li_4")," "]}),(0,i.jsxs)("li",{children:[r("tutorials:composer.li_5")," "]}),(0,i.jsxs)("li",{children:[r("tutorials:composer.li_6")," "]})]})}),(0,i.jsx)(P.J,{onClick:()=>{N(!0),E()},style:{marginLeft:"auto"},children:r("create_from_midi_or_audio")}),(0,i.jsx)(P.J,{onClick:S,children:r("create_new_song")})]}),(0,i.jsx)(eu.G,{songs:x,exclude:eA,SongComponent:eP,style:{marginTop:"0.6rem"},onCreateFolder:I,componentProps:{theme:A,folders:y,functions:{loadSong:j,removeSong:O,toggleMenu:E,downloadSong:M,renameSong:_}}}),(0,i.jsx)("div",{className:"row",style:{justifyContent:"flex-end",gap:"0.2rem"},children:(0,i.jsx)(c.G,{onPick:H,onError:(e,t)=>{if(e&&console.error(e),(null==t?void 0:t.length)>0){let e=t[0].name;if((0,h.SZ)(e))g.kg.warn(r("warning_opening_midi_importer"),6e3);else{if(!((0,h.kG)(e)||(0,h.Zj)(e)))return g.kg.error(r("error_importing_file_invalid_format"),8e3);g.kg.warn(r("warning_opening_audio_importer"),6e3)}N(!0),E()}else g.kg.error(r("error_importing_file_invalid_format_audio_video"),8e3)},as:"json",multiple:!0,children:(0,i.jsx)(P.J,{children:r("menu:import_song_sheet")})})}),(0,i.jsx)("div",{className:"songs-buttons-wrapper",style:{marginTop:"auto"},children:(0,i.jsx)(P.J,{style:{marginTop:"0.5rem"},className:"record-btn",onClick:()=>{d(!1),setTimeout(()=>{s.startRecordingAudio(!t.isRecordingAudio)},300)},toggled:t.isRecordingAudio,children:t.isRecordingAudio?r("stop_recording_audio"):r("start_recording_audio")})})]}),(0,i.jsxs)(ed.G,{id:"Settings",children:[(0,i.jsx)(ex.A,{settings:t.settings,onUpdate:k,changeVolume:C}),(0,i.jsx)(eM.Z,{background:"var(--secondary)",height:"0.1rem",verticalMargin:"0.5rem"}),(0,i.jsxs)("div",{className:"settings-row-wrap",children:[r("settings:select_language")," ",(0,i.jsx)(eT.s,{})]}),(0,i.jsxs)("div",{className:"settings-row-wrap",children:[p&&(0,i.jsx)(eS(),{href:"/keybinds",children:(0,i.jsx)(P.J,{style:{width:"fit-content"},children:r("menu:connect_midi_keyboard")})}),(0,i.jsx)(eS(),{href:"/theme",onClick:e=>e.preventDefault(),children:(0,i.jsx)(P.J,{onClick:()=>w("theme"),style:{width:"fit-content"},children:r("menu:change_app_theme")})})]}),(0,i.jsx)(eh.Z,{})]})]})]})},(e,t)=>e.data.settings===t.data.settings&&e.data.hasChanges===t.data.hasChanges&&e.data.isRecordingAudio===t.data.isRecordingAudio),eE=s(83679),eO=s(8344),eI=s(40569),eH=s(23935),eB=s(80331),eF=s(92761);function eD(e){let{children:t,tooltip:s,onClick:n,style:o,ariaLabel:a}=e;return(0,i.jsxs)("button",{className:"tool ".concat((0,k.h)(s)),onClick:n,style:o,"aria-label":a,children:[t,s&&(0,i.jsx)(k.u,{children:s})]})}var ez=s(80219),eX=s(8285),eV=s(19075),eJ=s(21820),eU=s.n(eJ);let eW=["circle","border","line"];function eZ(e){var t;let{instrument:s,onChange:n,onDelete:a,onClose:r,onChangePosition:l,currentLayer:c,instruments:d}=e,{t:h}=(0,R.$G)(["instrument_settings","common","instruments"]),m=(0,ew.ZP)(r,{active:!0,ignoreFocusable:!0});return s?(0,i.jsxs)("div",{className:"floating-instrument-settings box-shadow",ref:m,children:[(0,i.jsxs)("div",{className:"row space-between",children:[h("layer_name"),(0,i.jsx)("input",{type:"text",maxLength:50,className:"input",style:{width:"7.4rem"},value:s.alias,onChange:e=>n(s.set({alias:e.target.value})),placeholder:h("instruments:".concat(s.name))})]}),(0,i.jsxs)("div",{className:"row space-between",style:{marginTop:"0.4rem"},children:[h("common:instrument"),(0,i.jsx)(eV.O,{style:{width:"8rem"},selected:s.name,onChange:e=>n(s.set({name:e}))})]}),(0,i.jsxs)("div",{className:"row space-between",style:{marginTop:"0.4rem"},children:[h("common:pitch"),(0,i.jsx)(b.x,{style:{padding:"0.3rem",width:"8rem"},selected:s.pitch,onChange:e=>n(s.set({pitch:e})),children:(0,i.jsx)("option",{value:"",children:h("use_song_pitch")})})]}),(0,i.jsxs)("div",{className:"row space-between",style:{marginTop:"0.4rem"},children:[h("common:reverb"),(0,i.jsxs)(_.P,{style:{padding:"0.3rem",width:"8rem"},onChange:e=>{var t;n(s.set({reverbOverride:"Unset"===(t=e.target.value)?null:"On"===t}))},value:null===(t=s.reverbOverride)?"Unset":t?"On":"Off",children:[(0,i.jsx)("option",{value:"On",children:h("common:on")}),(0,i.jsx)("option",{value:"Off",children:h("common:off")}),(0,i.jsx)("option",{value:"Unset",children:h("use_song_reverb")})]})]}),(0,i.jsxs)("div",{className:"row space-between",style:{marginTop:"0.4rem"},children:[h("note_icon"),(0,i.jsx)("select",{className:eU().select,style:{padding:"0.3rem",width:"8rem"},value:s.icon,onChange:e=>{n(s.set({icon:e.target.value})),e.target.blur()},children:eW.map(e=>(0,i.jsx)("option",{value:e,children:h("common:".concat(e))},e))})]}),(0,i.jsxs)("div",{className:"row",style:{marginTop:"1rem",alignItems:"center"},children:[h("volume"),(0,i.jsxs)("span",{style:{marginLeft:"0.4rem",width:"3rem",...s.volume>100&&{color:"hsl(0, ".concat(-40+s.volume,"%, 61%)"),marginLeft:"0.4rem"}},children:[s.volume,"%"]}),(0,i.jsx)(f.k,{buttonStyle:{width:"1.2rem",height:"1.2rem"},width:10,children:h("volume_high_warning")})]}),(0,i.jsxs)("div",{className:"row",children:[(0,i.jsx)("input",{type:"range",style:{flex:"1",opacity:s.muted?"0.6":"1"},min:0,max:125,value:s.volume,onChange:e=>n(s.set({volume:Number(e.target.value)}))}),(0,i.jsx)(P.J,{className:"flex-centered",toggled:s.muted,style:{padding:0,minWidth:"unset",width:"1.6rem",height:"1.6rem",borderRadius:"2rem"},onClick:()=>{(0!==s.volume||s.muted)&&n(s.set({muted:!s.muted}))},children:s.muted||0===s.volume?(0,i.jsx)(o.xZH,{}):(0,i.jsx)(o.rxG,{})})]}),(0,i.jsxs)("div",{className:"row space-between",style:{marginTop:"1rem"},children:[(0,i.jsxs)(P.J,{onClick:()=>l(-1),disabled:0===c,className:"flex-centered",style:{padding:"0.5rem",flex:"1",marginRight:"0.4rem"},children:[(0,i.jsx)(o.ZTc,{style:{marginRight:"0.2rem"}})," ",h("move_up")]}),(0,i.jsxs)(P.J,{onClick:()=>l(1),disabled:c===d.length-1,className:"flex-centered",style:{padding:"0.5rem",flex:"1"},children:[(0,i.jsx)(o.NWQ,{style:{marginRight:"0.2rem"}})," ",h("move_down")]})]}),(0,i.jsxs)("div",{className:"row space-between",style:{marginTop:"0.4rem"},children:[(0,i.jsxs)(P.J,{className:"row-centered",style:{padding:"0.4rem",width:"fit-content"},onClick:a,children:[(0,i.jsx)(o.Xm5,{color:"var(--red)",style:{marginRight:"0.3rem"}}),h("common:delete")]}),(0,i.jsx)(P.J,{onClick:r,style:{padding:"0.4rem",width:"fit-content"},children:h("common:ok")})]})]}):(0,i.jsx)("div",{className:"floating-instrument-settings  box-shadow",children:h("no_instrument_selected")})}let eG=(0,n.memo)(function(e){let{instruments:t,onInstrumentAdd:s,onInstrumentChange:a,onInstrumentDelete:r,selected:l,onLayerSelect:c,onChangePosition:d}=e,{t:h}=(0,R.$G)(),[m]=(0,X.F)(),[u,g]=(0,n.useState)(!1),p=(0,n.useCallback)(()=>{g(!1)},[]);return(0,i.jsxs)(i.Fragment,{children:[u&&(0,i.jsx)(eZ,{instrument:t[l],currentLayer:l,instruments:t,onChange:e=>a(e,l),onDelete:()=>{r(l),p()},onChangePosition:d,onClose:p}),(0,i.jsxs)("div",{className:"column instruments-button-wrapper",children:[t.map((e,t)=>(0,i.jsx)(eq,{theme:m,instrument:e,isSelected:t===l,onEditClick:()=>g(!u),onClick:()=>c(t),onVisibleToggle:s=>a(e.set({visible:s}),t)},e.name+t)),(0,i.jsx)("div",{style:{minHeight:"1rem"}}),(0,i.jsx)(P.J,{onClick:e=>{s(),setTimeout(()=>{var t;null===(t=e.target)||void 0===t||t.scrollIntoView()},50)},ariaLabel:h("common:add_new_instrument"),className:"new-instrument-button flex-centered",children:(0,i.jsx)(o.wEH,{size:16,color:"var(--icon-color)"})})]})]})},(e,t)=>e.instruments===t.instruments&&e.selected===t.selected);function eq(e){let{instrument:t,onClick:s,isSelected:a,theme:r,onEditClick:l,onVisibleToggle:c}=e,{t:d}=(0,R.$G)("instruments"),h=(0,n.useRef)(null);(0,n.useEffect)(()=>{a&&h.current&&h.current.scrollIntoView({behavior:"auto",block:"nearest"})},[a,h]);let m=r.getText("primary");return m=m.isDark()?m.lighten(.2):m.darken(.15),(0,i.jsxs)("div",{ref:h,className:"instrument-button flex-centered ".concat(a?"instrument-button-selected":""),style:a?{backgroundColor:r.get("primary").mix(r.get("accent")).toString()}:{},children:[!a&&(0,i.jsxs)("div",{className:"row",style:{position:"absolute",gap:"0.2rem",top:"0.2rem",left:"0.3rem"},children:[!t.visible&&(0,i.jsx)(o.tgn,{color:m.hex(),size:14}),t.muted&&(0,i.jsx)(o.xZH,{color:m.hex(),size:14})]}),!a&&(0,i.jsxs)("div",{style:{position:"absolute",top:"0.4rem",right:"0.4rem",height:"fit-content"},children:["circle"===t.icon&&(0,i.jsx)(o.gbA,{size:8,style:{display:"block"},color:m.hex()}),"border"===t.icon&&(0,i.jsx)(eX.orY,{size:12,style:{display:"block",marginRight:"-2px",marginTop:"-2px",strokeWidth:"2px"},color:m.hex()}),"line"===t.icon&&(0,i.jsx)(o.iFH,{size:8,style:{display:"block"},color:m.hex()})]}),(0,i.jsx)(P.J,{onClick:s,style:{backgroundColor:"transparent",width:"100%"},className:"flex-grow flex-centered instrument-name-button",children:(0,i.jsx)("span",{className:"text-ellipsis",style:{width:"6rem"},children:t.alias||d(t.name)})}),a&&(0,i.jsxs)("div",{className:"instrument-settings",children:[(0,i.jsx)(P.J,{onClick:()=>l(),ariaLabel:"Settings",className:"flex-centered",children:(0,i.jsx)(o.p4t,{size:15})}),(0,i.jsx)(P.J,{onClick:()=>c(!t.visible),ariaLabel:t.visible?"Hide":"Show",className:"flex-centered",children:t.visible?(0,i.jsx)(o.dSq,{size:16}):(0,i.jsx)(o.tgn,{size:16})})]})]})}var e$=s(23441),eQ=s(11163),eY=s(47103),eK=s(47008),e0=s(28682),e1=s(19116),e2=s(16351);class e6 extends n.Component{get currentInstrument(){return this.state.layers[this.state.layer]}componentDidMount(){this.mounted=!0;let e=ez.j.getComposerSettings(),t=(0,ea.JZ)("composer","composer_shortcuts",this.handleShortcut),s=(0,ea.JP)("composer_shortcuts_keyboard",this.handleKeyboardShortcut);this.cleanup.push(s,t),this.setState({settings:e}),this.init(e),this.broadcastChannel=window.BroadcastChannel?new BroadcastChannel(a.iC+"_composer"):null,this.broadcastChannel&&this.broadcastChannel.addEventListener("message",e=>{this.state.settings.syncTabs.value&&["play","stop"].includes(null==e?void 0:e.data)&&this.togglePlay("play"===e.data)}),this.unblock=e=>{if(0!==this.changes)throw this.changePage(e),this.props.router.events.emit("routeChangeError"),"routeChange aborted.";this.props.router.events.off("routeChangeStart",this.unblock),this.props.router.push((0,h.k8)(e))},this.props.router.events.on("routeChangeStart",this.unblock),"localhost"!==window.location.hostname&&window.addEventListener("beforeunload",this.handleUnload)}componentWillUnmount(){var e,t;let{state:s}=this,{layers:i}=s;this.mounted=!1,eF.n.clear(),i.forEach(e=>e.dispose()),null===(t=this.broadcastChannel)||void 0===t||null===(e=t.close)||void 0===e||e.call(t),s.isPlaying=!1,this.props.router.events.off("routeChangeStart",this.unblock),this.cleanup.forEach(e=>e()),ej.w.unregisterById("composer"),eB.mP.removeListener(this.handleMidi),eF.n.isRecording&&eF.n.stopRecording(),"localhost"!==window.location.hostname&&window.removeEventListener("beforeunload",this.handleUnload)}render(){var e;let{isMidiVisible:t,song:s,isPlaying:n,copiedColumns:a,settings:c,isRecordingAudio:d,isToolsVisible:m,layer:u,selectedColumns:g,layers:p,undoHistory:x}=this.state,y=(0,h.wU)(s.columns,c.bpm.value,s.selected),{t:v}=this.props;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e$.d,{text:"".concat(v("home:composer_name")," - ").concat(s.name),description:"Create or edit songs with the composer, using up to 52 layers, tempo changers, multiple instruments and pitches. You can also convert a MIDI, video or audio into a sheet."}),t&&(0,i.jsx)(A,{t:v,functions:this,data:{instruments:s.instruments,selectedColumn:s.selected}}),(0,i.jsxs)("div",{className:"composer-grid appear-on-mount",children:[(0,i.jsxs)("div",{className:"column composer-left-control",children:[(0,i.jsx)(P.J,{className:"flex-centered",style:{height:"3rem",minHeight:"3rem",borderRadius:"0.3rem",backgroundColor:"var(--primary-darken-10)"},onClick:e=>{if(this.togglePlay(),c.syncTabs.value){var t,s;null===(s=this.broadcastChannel)||void 0===s||null===(t=s.postMessage)||void 0===t||t.call(s,n?"stop":"play")}},ariaLabel:v(n?"common:pause":"common:play"),children:(0,i.jsx)(ei.Z,{children:n?(0,i.jsx)(o.Wh,{size:18,color:"var(--icon-color)"},"pause"):(0,i.jsx)(o.gmG,{size:18,color:"var(--icon-color)"},"play")})}),(0,i.jsx)(eG,{instruments:s.instruments,selected:u,onLayerSelect:this.changeLayer,onInstrumentAdd:this.addInstrument,onInstrumentChange:this.editInstrument,onInstrumentDelete:this.removeInstrument,onChangePosition:this.switchLayerPosition})]}),(0,i.jsx)("div",{className:"top-panel-composer",style:{gridArea:"b"},children:(0,i.jsxs)("div",{className:"row",style:{height:"fit-content",width:"100%"},children:[(0,i.jsx)(el,{functions:this,t:this.props.t,data:{inPreview:this.props.inPreview,isRecordingAudio:d,currentLayer:u,isPlaying:n,song:s,settings:c,selectedColumns:g,columns:s.columns,selected:s.selected,breakpoints:s.breakpoints}},c.columnsPerCanvas.value),(0,i.jsxs)("div",{className:"buttons-composer-wrapper-right",children:[(0,i.jsx)(eD,{onClick:()=>this.addColumns(1,s.selected),tooltip:v("composer:add_column"),ariaLabel:v("composer:add_column"),children:(0,i.jsx)(ei.c,{icon:r,className:"tool-icon"})}),(0,i.jsx)(eD,{onClick:()=>this.removeColumns(1,s.selected),tooltip:v("composer:remove_column"),ariaLabel:v("composer:remove_column"),children:(0,i.jsx)(ei.c,{icon:l,className:"tool-icon"})}),(0,i.jsx)(eD,{onClick:()=>this.addColumns(4*Number(c.beatMarks.value),"end"),tooltip:v("composer:add_new_page"),ariaLabel:v("composer:add_new_page"),children:(0,i.jsx)(ei.c,{icon:o.wEH,size:16})}),(0,i.jsx)(eD,{onClick:this.toggleTools,tooltip:v("composer:open_tools"),ariaLabel:v("composer:open_tools"),children:(0,i.jsx)(ei.c,{icon:o.CP_,size:16})})]})]})}),(0,i.jsx)(J,{functions:this,data:{isPlaying:n,settings:c,isRecordingAudio:d,currentLayer:u,instruments:s.instruments,keyboard:p[u],currentColumn:s.selectedColumn,pitch:(null===(e=s.instruments[u])||void 0===e?void 0:e.pitch)||c.pitch.value,noteNameType:c.noteNameType.value}})]}),(0,i.jsx)(eL,{data:{isRecordingAudio:d,settings:c,hasChanges:this.changes>0},functions:this,inPreview:this.props.inPreview}),(0,i.jsx)(O,{data:{isToolsVisible:m,layer:u,hasCopiedColumns:a.length>0,selectedColumns:g,undoHistory:x},functions:this}),(0,i.jsxs)("div",{className:"song-info",children:[(0,i.jsx)("div",{className:"text-ellipsis",children:s.name}),(0,i.jsxs)("div",{children:[(0,h.dH)(y.current),"/",(0,h.dH)(y.total)]})]})]})}constructor(e){var t;super(e),t=this,this.unblock=()=>{},this.cleanup=[],this.init=async e=>{await this.syncInstruments(),eF.n.setReverb(e.reverb.value),eB.mP.addListener(this.handleMidi),a.nq.forEach((e,t)=>{ej.w.registerNumber(t+1,()=>this.handleTempoChanger(e),{id:"composer_keyboard"})});try{let{songId:e}=this.props;if(!e)return;let t=await ek.v.getSongById(e);if(!t)return;this.loadSong(t)}catch(e){console.log("Error loading song"),console.error(e)}},this.handleKeyboardShortcut=e=>{let{shortcut:t,event:s}=e;if(s.repeat)return;let{isPlaying:i}=this.state;if(i||s.shiftKey){let e=this.currentInstrument.getNoteFromCode(t.name);null!==e&&this.handleClick(e)}},this.handleShortcut=e=>{let{shortcut:t,event:s}=e,{isPlaying:i,layer:n,layers:o,settings:a,song:r}=this.state,{name:l}=t;if("next_column"!==l||i||this.selectColumn(r.selected+1),"previous_column"!==l||i||this.selectColumn(r.selected-1),"remove_column"!==l||i||this.removeColumns(1,r.selected),"add_column"!==l||i||this.addColumns(1,r.selected),"previous_layer"===l){let e=n-1;e>=0&&this.changeLayer(e)}if("next_layer"===l){let e=n+1;e<o.length&&this.changeLayer(e)}if("toggle_play"===l){var c,d,h,m;if(s.repeat)return;(null===(c=s.target)||void 0===c?void 0:c.tagName)==="BUTTON"&&(null===(d=s.target)||void 0===d||d.blur()),s.preventDefault(),this.togglePlay(),a.syncTabs.value&&(null===(m=this.broadcastChannel)||void 0===m||null===(h=m.postMessage)||void 0===h||h.call(m,i?"play":"stop"))}},this.handleUnload=e=>{e.preventDefault(),e.returnValue=""},this.handleAutoSave=()=>{this.changes++,this.changes>5&&this.state.settings.autosave.value&&"Untitled"!==this.state.song.name&&this.updateSong(this.state.song)},this.handleMidi=e=>{let[t,s,i]=e;if(!this.mounted)return;let{song:n,layer:o}=this.state;if(eB.mP.isDown(t)&&0!==i){eB.mP.getNotesOfMIDIevent(s).forEach(e=>{this.handleClick(this.currentInstrument.notes[e.index])});let e=eB.mP.settings.shortcuts.find(e=>e.midi===s);if(!e)return;switch(e.type){case"toggle_play":this.togglePlay();break;case"next_column":this.selectColumn(n.selected+1);break;case"previous_column":this.selectColumn(n.selected-1);break;case"add_column":this.addColumns(1,n.selected);break;case"remove_column":this.removeColumns(1,n.selected);break;case"change_layer":{let e=o+1;e>=this.state.layers.length&&(e=0),this.changeLayer(e)}}}},this.updateSettings=e=>{ez.j.updateComposerSettings(void 0!==e?e:this.state.settings)},this.handleSettingChange=e=>{let{data:t,key:s}=e,{song:i,settings:n}=this.state;n[s]={...n[s],value:t.value},t.songSetting&&(i[s]=t.value),"reverb"===s&&eF.n.setReverb(t.value),this.setState({settings:{...n},song:i},this.updateSettings)},this.addInstrument=()=>{let{song:e}=this.state,t=eK.X.get().IS_UMA_MODE;if(e.instruments.length>=v.u.MAX_LAYERS&&!t)return g.kg.error(this.props.t("composer:cant_add_more_than_n_layers",{max_layers:v.u.MAX_LAYERS}));e.addInstrument(a.BX[0]),this.setState({song:e}),this.syncInstruments(e)},this.removeInstrument=async e=>{var t;let{song:s,layers:i}=this.state;if(i.length<=1)return g.kg.warn(this.props.t("composer:cant_remove_all_layers"));await (0,ep.jH)(this.props.t("composer:confirm_layer_remove",{layer_name:null!==(t=s.instruments[e].alias)&&void 0!==t?t:e2.WV.t("instruments."+s.instruments[e].name)}))&&(s.removeInstrument(e),this.syncInstruments(s),this.setState({song:s,layer:Math.max(0,e-1)}))},this.editInstrument=(e,t)=>{let{song:s}=this.state;s.instruments[t]=e.clone(),s.instruments=[...s.instruments],this.syncInstruments(s),this.setState({song:s})},this.syncInstruments=async e=>{let{layers:t}=this.state;e||(e=this.state.song),t.splice(e.instruments.length).forEach(e=>{eF.n.disconnect(e.endNode),e.dispose()});let s=e.instruments.map(async(e,s)=>{if(void 0===t[s]){let i=new eE.Yx(e.name);return(t[s]=i,await i.load(eF.n.getAudioContext())||g.kg.error(this.props.t("logs:error_loading_instrument")),this.mounted)?(eF.n.connect(i.endNode,e.reverbOverride),i.changeVolume(e.volume),i):i.dispose()}if(t[s].name===e.name)return t[s].changeVolume(e.volume),eF.n.setReverbOfNode(t[s].endNode,e.reverbOverride),t[s];{let i=t[s];eF.n.disconnect(i.endNode),i.dispose();let n=new eE.Yx(e.name);return(t[s]=n,await n.load(eF.n.getAudioContext())||g.kg.error(this.props.t("logs:error_loading_instrument")),this.mounted)?(eF.n.connect(n.endNode,e.reverbOverride),n.changeVolume(e.volume),n):n.dispose()}});if(!this.mounted)return;let i=await Promise.all(s);this.setState({layers:i})},this.changeVolume=e=>{let t=this.state.settings,s=Number(e.key.split("layer")[1])-1;t[e.key]={...t[e.key],volume:e.value},this.state.layers[s].changeVolume(e.value),this.setState({settings:{...t}},this.updateSettings)},this.startRecordingAudio=async e=>{if(!this.mounted)return;if(!e)return this.setState({isRecordingAudio:!1}),this.togglePlay(!1);eF.n.startRecording(),this.setState({isRecordingAudio:!0}),await (0,h.gw)(300),await this.togglePlay(!0);let t=this.state.settings.lookaheadTime.value/1e3+.3;if(await (0,h.gw)(Math.max(500,t)),!this.mounted)return;this.setState({isRecordingAudio:!1});let s=await eF.n.stopRecording();if(!s)return;let i=await (0,ep.cJ)(this.props.t("question:ask_song_name_cancellable"));try{i&&await eO.Z.downloadBlob(s.data,i+".wav")}catch(e){console.error(e),g.kg.error(this.props.t("logs:error_downloading_audio"))}},this.playSound=(e,t,s)=>{let i=this.state.layers[e],n=null==i?void 0:i.notes[t];if(void 0===n||this.state.song.instruments[e].muted)return;let o=this.state.song.instruments[e].pitch||this.state.settings.pitch.value;i.play(n.index,o,s)},this.changePitch=e=>{let{settings:t}=this.state;t.pitch={...t.pitch,value:e},this.setState({settings:{...t}},this.updateSettings)},this.handleClick=e=>{let{song:t,layer:s}=this.state,i=t.selectedColumn,n=i.getNoteIndex(e.index);if(null===n)i.addNote(e.index).setLayer(s,!0);else{let e=i.notes[n];e.toggleLayer(s),e.layer.isEmpty()&&i.removeAtIndex(n)}this.setState({song:t}),this.handleAutoSave(),this.playSound(s,e.index)},this.renameSong=async(e,t)=>{let{song:s}=this.state;await ev.k.renameSong(t,e),this.state.song.id===t&&(s.name=e,this.setState({song:s}))},this.addSong=async e=>{let t=await ev.k.addSong(e);return e.id=t,e},this.updateSong=async e=>{if("Untitled"===e.name){let t=await (0,ep.cJ)(this.props.t("question:ask_song_name_cancellable"));return null!==t&&!!this.mounted&&(e.name=t,this.changes=0,this.setState({}),await this.addSong(e),!0)}return new Promise(async t=>{let s=await ek.v.getSongById(e.id);if(s)e.folderId=s.folderId,await ev.k.updateSong(e),console.log("song saved:",e.name),this.changes=0,this.setState({});else{if(e.name.includes("- Composed")){let s=await (0,ep.cJ)(this.props.t("composer:ask_song_name_for_composed_song_version"));return null===s?t(!1):(e.name=s,this.addSong(e),t(!0))}console.log("song doesn't exist"),e.name="Untitled",this.updateSong(e)}t(!0)})},this.updateThisSong=async()=>{this.updateSong(this.state.song)},this.askForSongUpdate=async()=>await (0,ep.jH)(this.props.t("question:unsaved_song_save",{song_name:this.state.song.name}),!0),this.createNewSong=async()=>{if("Untitled"!==this.state.song.name&&this.changes>0){let e=await this.askForSongUpdate();if(null===e)return;e&&await this.updateSong(this.state.song)}let e=await (0,ep.cJ)(this.props.t("question:ask_song_name_cancellable"));if(null===e)return;let t=new u.l(e,[a.BX[0],a.BX[0],a.BX[0]]);if(this.changes=0,!this.mounted)return;let s=await this.addSong(t);this.mounted&&(this.setState({song:s,layer:0}),em.Z.songEvent({type:"create"}))},this.loadSong=async e=>{try{let t=this.state,s=null;if(e instanceof u.l)s=e;else{if("recorded"===e.type){let t=eH.M.deserialize(e);t.bpm=400,s=t.toComposedSong(4),s.name+=" - Composed"}"composed"===e.type&&(s=u.l.deserialize(e))}if(!s)return;if(0!==this.changes){let e=t.settings.autosave.value&&"Untitled"!==t.song.name;if(!e&&t.song.columns.length>0){let s=await (0,ep.jH)(this.props.t("question:unsaved_song_save",{song_name:t.song.name}),!0);if(null===s)return;e=s}e&&await this.updateSong(t.song)}let i=this.state.settings;if(i.bpm={...i.bpm,value:s.bpm},i.pitch={...i.pitch,value:s.pitch},i.reverb={...i.reverb,value:s.reverb},eF.n.setReverb(s.reverb),!this.mounted)return;e.id&&null===this.state.song.id&&this.setState({isMidiVisible:!1}),this.changes=0,console.log("song loaded"),this.setState({layer:0,song:s,settings:{...i},selectedColumns:[]},()=>this.syncInstruments())}catch(e){console.error(e),g.kg.error(this.props.t("logs:error_loading_song"))}},this.addColumns=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"end";return new Promise(i=>{let{song:n}=t.state;n.addColumns(e,s),1===e&&t.selectColumn(n.selected+1),t.handleAutoSave(),t.setState({song:n},i)})},this.removeColumns=(e,t)=>{let{song:s,settings:i}=this.state;s.columns.length<4*i.beatMarks.value||(s.removeColumns(e,t),s.columns.length<=s.selected&&this.selectColumn(s.selected-1),this.handleAutoSave(),this.setState({song:s}))},this.togglePlay=async e=>new Promise(t=>{let s="boolean"==typeof e?e:!this.state.isPlaying;this.setState({isPlaying:s},async()=>{this.state.isPlaying&&this.selectColumn(this.state.song.selected,!1,this.state.settings.lookaheadTime.value/1e3);let e=0,s=Date.now();for(;this.state.isPlaying;){let{song:t,settings:i}=this.state,n=t.selectedColumn.getTempoChanger().changer,o=Math.floor(6e4/i.bpm.value*n+e);if(s=Date.now(),await (0,h.gw)(o),!this.state.isPlaying||!this.mounted)break;e=s+o-Date.now();let a=i.lookaheadTime.value/1e3;this.handlePlaybackTick(Math.max(0,a+e/1e3))}t()})}),this.handlePlaybackTick=e=>{let t=this.state.song.selected+1;if(this.state.isPlaying&&t>this.state.song.columns.length-1)return this.togglePlay(!1);this.selectColumn(t,!1,e)},this.toggleBreakpoint=e=>{let{song:t}=this.state;t.toggleBreakpoint(e),this.validateBreakpoints(),this.setState({song:t})},this.handleTempoChanger=e=>{let{song:t,selectedColumns:s}=this.state;s.length?(this.addToHistory(),s.forEach(s=>{var i;null===(i=t.columns[s])||void 0===i||i.setTempoChanger(e)})):t.selectedColumn.setTempoChanger(e),this.handleAutoSave(),this.setState({song:t})},this.changePage=async e=>{let{song:t,settings:s}=this.state;if("Home"===e)return eI.I.open();if(0!==this.changes){if(s.autosave.value)await this.updateSong(t);else{let e=await (0,ep.jH)(this.props.t("question:unsaved_song_save",{song_name:t.name}),!0);if(null===e)return;if(e&&!await this.updateSong(t))return console.log("Blocking redirect")}}this.props.router.events.off("routeChangeStart",this.unblock),this.props.router.push((0,h.k8)(e))},this.selectColumn=(e,t,s)=>{let{song:i,isToolsVisible:n,layers:o,copiedColumns:a,isRecordingAudio:r}=this.state,l=this.state.selectedColumns;if(!(e<0)&&!(e>i.columns.length-1)){if(i.selected=e,n&&0===a.length){l.push(e);let t=Math.min(...l);l=Array(Math.max(...l)-t+1).fill(0).map((e,s)=>t+s)}this.setState({song:i,selectedColumns:l}),s=s?s+(r?250:0):0,t||i.selectedColumn.notes.forEach(e=>{o.forEach((t,i)=>{e.isLayerToggled(i)&&this.playSound(i,e.index,s)})})}},this.selectColumnFromDirection=e=>{this.selectColumn(this.state.song.selected+e)},this.changeLayer=e=>{this.setState({layer:e})},this.toggleTools=()=>{this.setState({isToolsVisible:!this.state.isToolsVisible,selectedColumns:this.state.isToolsVisible?[]:[this.state.song.selected],copiedColumns:[],undoHistory:[]})},this.resetSelection=()=>{this.setState({copiedColumns:[],selectedColumns:[this.state.song.selected]})},this.addToHistory=()=>{let{song:e,undoHistory:t,isToolsVisible:s}=this.state;s&&this.setState({undoHistory:[...t,e.clone().columns]})},this.undo=()=>{let{undoHistory:e,song:t}=this.state,s=e.pop();s&&(t.columns=s,t.selected=t.columns.length>t.selected?t.selected:t.columns.length-1,this.setState({undoHistory:[...e],song:t},()=>{setTimeout(()=>{this.mounted&&this.setState({})},100)}))},this.copyColumns=e=>{let{selectedColumns:t,song:s}=this.state,i=s.copyColumns(t,e);this.changes++,this.setState({selectedColumns:[],copiedColumns:i})},this.pasteColumns=async(e,t)=>{let{song:s,copiedColumns:i}=this.state;this.addToHistory(),"all"===t?s.pasteColumns(i,e):Number.isFinite(t)&&s.pasteLayer(i,e,t),this.syncInstruments(),this.changes++,this.setState({song:s})},this.eraseColumns=e=>{let{song:t,selectedColumns:s}=this.state;this.addToHistory(),t.eraseColumns(s,e),this.changes++,this.setState({song:t,selectedColumns:[t.selected]})},this.moveNotesBy=(e,t)=>{let{song:s,selectedColumns:i}=this.state;this.addToHistory(),s.moveNotesBy(i,e,t),this.changes++,this.setState({song:s})},this.switchLayerPosition=e=>{let{song:t,layer:s}=this.state,i=s+e;if(i<0||i>t.instruments.length-1)return;t.swapLayer(t.columns.length,0,s,i);let n=t.instruments[s];t.instruments[s]=t.instruments[i],t.instruments[i]=n,t.instruments=[...t.instruments],this.changes++,this.syncInstruments(),this.setState({song:t,layer:i})},this.deleteColumns=async()=>{let{song:e,selectedColumns:t}=this.state;this.addToHistory(),e.deleteColumns(t),this.changes++,this.setState({song:e,selectedColumns:[e.selected]},this.validateBreakpoints)},this.validateBreakpoints=()=>{let{song:e}=this.state;e.validateBreakpoints(),this.setState({song:e})},this.changeMidiVisibility=e=>{this.setState({isMidiVisible:e}),e&&em.Z.songEvent({type:"create_MIDI"})},this.downloadSong=async(e,t)=>{try{if(e.id===this.state.song.id&&(this.state.settings.autosave.value?(await this.updateSong(this.state.song),e=this.state.song.serialize()):await (0,ep.jH)(this.props.t("ask_download_of_current_song",{song_name:e.name}))&&(await this.updateSong(this.state.song),e=this.state.song.serialize())),"song"===t){let t=ek.v.parseSong(e);e.data.appName=a.iC;let s=e.name,i=["Sky"===a.iC&&(t instanceof u.l||t instanceof eH.M)?t.toOldFormat():t.serialize()];e_.bV.downloadSong(i,"".concat(s,".").concat(a.iC.toLowerCase(),"sheet")),g.kg.success(this.props.t("logs:song_downloaded")),em.Z.userSongs("download",{page:"composer"})}else if("midi"===t){let t=await (0,ep.jH)(this.props.t("menu:midi_download_warning")),s=ek.v.parseSong(e);if(s instanceof e0.Cz)throw Error("Can't convert Vsrg to MIDI");let i=s.toMidi();if(!t)return;e_.bV.downloadMidi(i),g.kg.success(this.props.t("logs:song_downloaded"))}}catch(e){console.log(e),g.kg.error(this.props.t("logs:error_downloading_song"))}};let s=ez.j.getDefaultComposerSettings();this.state={layers:[new eE.Yx(a.BX[1])],isPlaying:!1,song:new u.l("Untitled",[a.BX[0],a.BX[0],a.BX[0]]),settings:s,layer:0,selectedColumns:[],undoHistory:[],copiedColumns:[],isToolsVisible:!1,isMidiVisible:this.props.showMidi||!1,isRecordingAudio:!1,theme:p.f6},this.state.song.bpm=s.bpm.value,this.mounted=!1,this.changes=0,this.broadcastChannel=null}}function e3(e){var t;let{inPreview:s,songId:n}=e,o=(0,eQ.useRouter)(),{t:a}=(0,R.$G)(["composer","home","logs","question","common","menu"]),{songId:r,showMidi:l}=o.query;return(0,e1.o)("composer"),(0,i.jsx)(e6,{router:o,t:a,songId:null!==(t=null!=r?r:n)&&void 0!==t?t:null,showMidi:!!l,inPreview:null!=s&&s})}e3.getLayout=function(e){return(0,i.jsx)(eY.Z,{page:"Composer",children:e})}}}]);