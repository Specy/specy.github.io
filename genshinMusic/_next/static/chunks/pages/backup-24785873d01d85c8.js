(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4910],{65164:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/backup",function(){return n(85215)}])},42474:function(e,t,n){"use strict";n.d(t,{k:function(){return l}});var r=n(85893),o=n(39324),a=n(67294);function l(e){var t;let{options:n,selected:l,onChange:i}=e,s=(0,a.useRef)(null),c=n.find(e=>e.value===l),[d,u]=(0,a.useState)({width:0,left:0});return(0,a.useEffect)(()=>{var e;let t=null===(e=s.current)||void 0===e?void 0:e.querySelectorAll("button"),r=n.findIndex(e=>e.value===l);if(!t||r<0)return;let o=t[r].getBoundingClientRect(),a=s.current.getBoundingClientRect();u({width:o.width-3,left:o.left-a.left})},[s,n,l]),(0,r.jsxs)("div",{className:"multiple-option-slider",ref:s,style:{border:"solid 0.1rem ".concat(null!==(t=null==c?void 0:c.color)&&void 0!==t?t:"var(--accent)")},children:[n.map(e=>(0,r.jsx)("button",{onClick:()=>i(e.value),className:e===c?"multiple-options-selected":"",children:(0,o.kC)(e.text)},e.value)),(0,r.jsx)("div",{className:"multiple-option-slider-overlay",style:{width:"".concat(d.width,"px"),left:"".concat(d.left,"px"),backgroundColor:null==c?void 0:c.color}})]})}},87481:function(e,t,n){"use strict";n.d(t,{G:function(){return a}});var r=n(85893),o=n(67294);function a(e){let{children:t,onPick:n,style:a={},as:l,multiple:i=!1,onError:s}=e,c=(0,o.useRef)(null),d=(0,o.useCallback)(async e=>{var t;if(null===e.target.files)return;let r=Array.from(null!==(t=e.target.files)&&void 0!==t?t:[]);if("file"===l)return n(r.map(e=>({data:e,file:e})));let o=r.map(e=>new Promise((t,n)=>{let r=new FileReader;try{r.addEventListener("loadend",function(){try{let n=r.result;t({data:"json"===l?JSON.parse(n):n,file:e})}catch(e){n(e)}},{once:!0}),("text"===l||"json"===l)&&r.readAsText(e),"buffer"===l&&r.readAsArrayBuffer(e)}catch(e){n(e)}}));try{let e=await Promise.all(o);n(e)}catch(e){console.error(e),null==s||s(e,r)}null!==c.current&&(c.current.value="")},[l,n,s]);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("input",{type:"file",style:{display:"none"},ref:c,onChange:d,multiple:i}),(0,r.jsx)("div",{onClick:()=>{var e;return null===(e=c.current)||void 0===e?void 0:e.click()},style:a,children:t})]})}},24104:function(e,t,n){"use strict";n.d(t,{n:function(){return l}});var r=n(67294),o=n(68949),a=n(6340);function l(){let[e,t]=(0,r.useState)(a.k.songs);return(0,r.useEffect)(()=>(function(e){let t=(0,o.N7)(a.k.songs,()=>{e([...a.k.songs])});return e([...a.k.songs]),t})(e=>{t(e)}),[]),[e]}},85215:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return T}});var r=n(85893),o=n(48043),a=n(2816),l=n(23441),i=n(78773),s=n(67294),c=n(85565),d=n(35656),u=n(40398),f=n(26176),_=n(31602),g=n(53179),p=n(89867),h=n(16913),m=n(17544),k=n(87481),w=n(39324),y=n(24104),x=n(32362),v=n(19180),j=n(6340),b=n(80219),C=n(41664),N=n.n(C),L=n(93778),S=n(42474),E=n(92634),A=n(11090),J=n(82860),P=n(67421),R=n(19116);function T(){let{t:e}=(0,P.$G)(["backup","home","logs"]),[t]=(0,E.F)(),n={marginRight:"0.3rem",marginLeft:"-0.4rem"},[C]=(0,y.n)(),T=(0,x.ih)(v.N.themes);(0,R.o)("backup");let[D,z]=(0,s.useState)("json");async function X(){g.kg.showPill("".concat(e("validating_songs"),"..."));let t=await c.v.getSongs(),n=[];for(let r of t)try{c.v.parseSong(r)}catch(t){console.error(t),n.push(r),g.kg.error(e("error_validating_song",{song_name:null==r?void 0:r.name}))}return n.length>0&&!await (0,_.cJ)(e("confirm_after_songs_validation_error"))?null:(g.kg.hidePill(),[...t])}async function F(){g.kg.showPill("".concat(e("validating_folders"),"..."));let t=[],n=await f.b.getFolders();for(let r of n)try{h.g.deserialize(r)}catch(n){console.error(n),t.push(r),g.kg.error(e("error_validating_folder",{folder_name:null==r?void 0:r.name}))}return t.length>0&&!await (0,_.cJ)(e("confirm_after_folders_validation_error"))?null:(g.kg.hidePill(),[...n])}async function B(){g.kg.showPill("".concat(e("validating_themes"),"..."));let t=await d.a.getThemes();for(let e of t);return g.kg.hidePill(),[...t]}async function G(t){for(let r of t)try{let e=Array.isArray(r.data)?r.data:[r.data];await p.bV.importAndLog(e)}catch(t){var n;console.error(t),g.kg.error(e("logs:error_importing_file",{file_name:null==r?void 0:null===(n=r.file)||void 0===n?void 0:n.name}))}}async function V(){return"delete"!==await (0,_.cJ)(e("confirm_delete_songs_step_1"))?g.kg.warn(e("action_cancelled")):(await (0,w.gw)(200),await (0,_.jH)(e("confirm_delete_songs_step_2")))?void(await j.k._DANGEROUS_CLEAR_ALL_SONGS(),await u.p._DANGEROUS_CLEAR_ALL_FOLDERS(),g.kg.success(e("deleted_all_songs_notice"))):g.kg.warn(e("action_cancelled"))}async function M(){return"delete"!==await (0,_.cJ)(e("confirm_delete_themes_step_1"))?g.kg.warn(e("action_cancelled")):(await (0,w.gw)(200),await (0,_.jH)(e("confirm_delete_themes_step_2")))?void(await v.N._DANGEROUS_CLEAR_ALL_THEMES(),g.kg.success(e("deleted_all_themes_notice"))):g.kg.warn(e("action_cancelled"))}async function U(t,n){if("json"===D)p.bV.downloadFiles(t,n);else try{g.kg.showPill("".concat(e("zipping_files"),"..."));let r=await new Promise((e,r)=>{let o=t.map(e=>{let t=p.bV.getUnknownFileExtensionAndName(e);if(!t)return["unknown".concat(Math.floor(1e3*Math.random()),".").concat(e.type),(0,L.TD)(JSON.stringify(e))];let{name:n,extension:r}=t,o=Array.isArray(e)?e:[e];return["".concat(n,".").concat(r),(0,L.TD)(JSON.stringify(o))]});(0,L.$R)({["".concat(n)]:(0,L.TD)(JSON.stringify(t)),individualFiles:Object.fromEntries(o)},(t,o)=>{if(t)return r(t);p.bV.downloadBlob(new Blob([o]),"".concat(n,".zip")),e(o)})});return g.kg.hidePill(),r}catch(e){throw g.kg.hidePill(),e}}return(0,s.useEffect)(()=>()=>g.kg.hidePill(),[]),(0,r.jsxs)(a.k,{children:[(0,r.jsx)(l.d,{text:e("home:backup_name"),description:"Manage the backups in the app, download or import songs, themes, or all of them"}),(0,r.jsx)("h1",{style:{fontSize:"1.8rem"},children:e("transfer_from_other_domain")}),(0,r.jsxs)(A.X,{align:"center",gap:"1rem",style:{paddingLeft:"1.5rem"},children:[(0,r.jsx)("div",{children:e("transfer_data_notice")}),(0,r.jsx)(N(),{href:"/transfer",style:{marginLeft:"1rem"},children:(0,r.jsx)(o.J,{cssVar:"accent",style:{gap:"0.2rem"},children:e("transfer")})})]}),(0,r.jsxs)(A.X,{align:"center",gap:"1rem",style:{margin:"1rem 0",marginTop:"2rem"},children:[(0,r.jsx)("div",{style:{fontSize:"1.8rem"},children:e("backup_as")}),(0,r.jsx)(S.k,{options:[{value:"zip",color:t.getValue("accent").toString(),text:"zip"},{value:"json",color:t.getValue("accent").toString(),text:"json"}],selected:D,onChange:z})]}),(0,r.jsx)("div",{style:{paddingLeft:"1.5rem"},children:e("backup_advice")}),(0,r.jsxs)(A.X,{gap:"0.5rem",style:{marginTop:"1rem",paddingLeft:"1.5rem"},children:[(0,r.jsxs)(o.J,{tooltip:e("download_all_backup_tooltip"),className:"flex-centered",onClick:async()=>{let t=await X();if(!t)return;let n=await F();if(!n)return;let r=await B();if(!r)return;let o=[...t,...n,...r];if(0===o.length)return g.kg.warn(e("no_items_to_backup"));try{await U(o,"".concat(O(),"-all.").concat(m.iC.toLowerCase(),"backup")),g.kg.success(e("backup_downloaded")),b.j.setLastBackupWarningTime(Date.now())}catch(t){g.kg.error(e("backup_download_error"))}},children:[(0,r.jsx)(i.ZJh,{style:n}),e("download_all_backup")]}),(0,r.jsxs)(o.J,{tooltip:e("download_songs_tooltip"),className:"flex-centered",onClick:async()=>{let t=await X();if(!t)return;let n=await F();if(!n)return;let r=[...t,...n];if(0===r.length)return g.kg.warn(e("logs:no_songs_to_backup"));try{await U(r,"".concat(O(),"-songs.").concat(m.iC.toLowerCase(),"backup")),g.kg.success(e("downloaded_songs_notice")),b.j.setLastBackupWarningTime(Date.now())}catch(t){g.kg.error(e("backup_download_error")),console.error(t)}},children:[(0,r.jsx)(i.ZJh,{style:n}),e("download_songs_backup")]}),(0,r.jsxs)(o.J,{tooltip:e("download_themes_tooltip"),className:"flex-centered",onClick:async()=>{let t=await B();if(t){if(0===t.length)return g.kg.warn(e("no_themes_to_backup"));try{await U(t,"".concat(O(),"-themes.").concat(m.iC.toLowerCase(),"backup")),g.kg.success(e("downloaded_themes_notice"))}catch(t){g.kg.error(e("backup_download_error")),console.error(t)}}},children:[(0,r.jsx)(i.ZJh,{style:n}),e("download_themes_backup")]})]}),(0,r.jsx)("h1",{style:{fontSize:"1.8rem"},children:e("import_backup")}),(0,r.jsx)("div",{style:{paddingLeft:"1.5rem"},children:e("import_backup_description")}),(0,r.jsx)(A.X,{align:"center",children:(0,r.jsx)(k.G,{onPick:G,as:"json",onError:()=>g.kg.error(e("error_reading_file")),children:(0,r.jsxs)(o.J,{className:"flex-centered",tooltip:e("import_backup_tooltip"),style:{marginTop:"1rem",backgroundColor:"var(--accent)",color:"var(--accent-text)",padding:"0.8rem"},children:[(0,r.jsx)(i.Xur,{style:{...n,fontSize:"1rem",marginRight:"0.5rem"}}),e("import_backup")]})})}),(0,r.jsx)(J.s,{justify:"center",padding:"1rem",style:{flex:"1"},children:(0,r.jsxs)(J.s,{style:{width:"fit-content"},children:[(0,r.jsxs)("span",{children:[C.length," ",e("songs")]}),(0,r.jsxs)("span",{children:[T.length," ",e("themes")]})]})}),(0,r.jsx)("h1",{style:{fontSize:"1.8rem"},children:e("delete_data")}),(0,r.jsx)("div",{style:{paddingLeft:"1.5rem"},children:e("delete_data_description")}),(0,r.jsxs)(A.X,{gap:"0.5rem",style:{marginTop:"1rem",paddingLeft:"1.5rem"},children:[(0,r.jsxs)(o.J,{className:"flex-centered",tooltip:e("delete_songs_and_folders_tooltip"),tooltipPosition:"top",style:{backgroundColor:"var(--red-bg)",color:"var(--red-text)"},onClick:V,children:[(0,r.jsx)(i.Xm5,{style:n}),e("delete_songs_and_folders")]}),(0,r.jsxs)(o.J,{className:"flex-centered",tooltip:e("delete_themes_tooltip"),tooltipPosition:"top",style:{backgroundColor:"var(--red-bg)",color:"var(--red-text)"},onClick:M,children:[(0,r.jsx)(i.Xm5,{style:n}),e("delete_themes")]})]})]})}function O(){let e=new Date;return"".concat(e.getFullYear(),"-").concat(e.getMonth(),"-").concat(e.getDate())}}},function(e){e.O(0,[3778,2888,9774,179],function(){return e(e.s=65164)}),_N_E=e.O()}]);