(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6747],{37347:function(e){!function(){function t(e,t){document.addEventListener?e.addEventListener("scroll",t,!1):e.attachEvent("scroll",t)}function n(e){this.g=document.createElement("div"),this.g.setAttribute("aria-hidden","true"),this.g.appendChild(document.createTextNode(e)),this.h=document.createElement("span"),this.i=document.createElement("span"),this.m=document.createElement("span"),this.j=document.createElement("span"),this.l=-1,this.h.style.cssText="max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;",this.i.style.cssText="max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;",this.j.style.cssText="max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;",this.m.style.cssText="display:inline-block;width:200%;height:200%;font-size:16px;max-width:none;",this.h.appendChild(this.m),this.i.appendChild(this.j),this.g.appendChild(this.h),this.g.appendChild(this.i)}function s(e,t){e.g.style.cssText="max-width:none;min-width:20px;min-height:20px;display:inline-block;overflow:hidden;position:absolute;width:auto;margin:0;padding:0;top:-999px;white-space:nowrap;font-synthesis:none;font:"+t+";"}function i(e){var t=e.g.offsetWidth,n=t+100;return e.j.style.width=n+"px",e.i.scrollLeft=n,e.h.scrollLeft=e.h.scrollWidth+100,e.l!==t&&(e.l=t,!0)}function r(e,n){function s(){i(r)&&null!==r.g.parentNode&&n(r.l)}var r=e;t(e.h,s),t(e.i,s),i(e)}function a(e,t,n){t=t||{},n=n||window,this.family=e,this.style=t.style||"normal",this.weight=t.weight||"normal",this.stretch=t.stretch||"normal",this.context=n}var o=null,l=null,c=null,h=null;function u(e){return null===h&&(h=!!e.document.fonts),h}function d(e,t){var n=e.style,s=e.weight;if(null===c){var i=document.createElement("div");try{i.style.font="condensed 100px sans-serif"}catch(e){}c=""!==i.style.font}return[n,s,c?e.stretch:"","100px",t].join(" ")}a.prototype.load=function(e,t){var i=this,a=e||"BESbswy",c=0,h=t||3e3,m=(new Date).getTime();return new Promise(function(e,t){if(u(i.context)&&(g=i.context,null===l&&(l=!!(u(g)&&/Apple/.test(window.navigator.vendor))&&!!(g=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))(?:\.([0-9]+))/.exec(window.navigator.userAgent))&&603>parseInt(g[1],10)),!l)){var g,p,f=new Promise(function(e,t){!function n(){(new Date).getTime()-m>=h?t(Error(""+h+"ms timeout exceeded")):i.context.document.fonts.load(d(i,'"'+i.family+'"'),a).then(function(t){1<=t.length?e():setTimeout(n,25)},t)}()});Promise.race([new Promise(function(e,t){c=setTimeout(function(){t(Error(""+h+"ms timeout exceeded"))},h)}),f]).then(function(){clearTimeout(c),e(i)},t)}else p=function(){function l(){var t;(t=-1!=f&&-1!=v||-1!=f&&-1!=x||-1!=v&&-1!=x)&&((t=f!=v&&f!=x&&v!=x)||(null===o&&(o=!!(t=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))/.exec(window.navigator.userAgent))&&(536>parseInt(t[1],10)||536===parseInt(t[1],10)&&11>=parseInt(t[2],10))),t=o&&(f==b&&v==b&&x==b||f==y&&v==y&&x==y||f==j&&v==j&&x==j)),t=!t),t&&(null!==k.parentNode&&k.parentNode.removeChild(k),clearTimeout(c),e(i))}var u=new n(a),g=new n(a),p=new n(a),f=-1,v=-1,x=-1,b=-1,y=-1,j=-1,k=document.createElement("div");k.dir="ltr",s(u,d(i,"sans-serif")),s(g,d(i,"serif")),s(p,d(i,"monospace")),k.appendChild(u.g),k.appendChild(g.g),k.appendChild(p.g),i.context.document.body.appendChild(k),b=u.g.offsetWidth,y=g.g.offsetWidth,j=p.g.offsetWidth,function e(){if((new Date).getTime()-m>=h)null!==k.parentNode&&k.parentNode.removeChild(k),t(Error(""+h+"ms timeout exceeded"));else{var n=i.context.document.hidden;(!0===n||void 0===n)&&(f=u.g.offsetWidth,v=g.g.offsetWidth,x=p.g.offsetWidth,l()),c=setTimeout(e,50)}}(),r(u,function(e){f=e,l()}),s(u,d(i,'"'+i.family+'",sans-serif')),r(g,function(e){v=e,l()}),s(g,d(i,'"'+i.family+'",serif')),r(p,function(e){x=e,l()}),s(p,d(i,'"'+i.family+'",monospace'))},document.body?p():document.addEventListener?document.addEventListener("DOMContentLoaded",function e(){document.removeEventListener("DOMContentLoaded",e),p()}):document.attachEvent("onreadystatechange",function e(){("interactive"==document.readyState||"complete"==document.readyState)&&(document.detachEvent("onreadystatechange",e),p())})})},e.exports=a}()},40120:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/vsrg-composer",function(){return n(90045)}])},70560:function(e,t,n){"use strict";n.d(t,{A:function(){return o},s:function(){return a}});var s=n(85893),i=n(20557),r=n.n(i);function a(e){let{children:t}=e;return(0,s.jsx)("div",{className:"keyboard-key",children:t})}function o(e){let{shortcuts:t,className:n,style:i}=e;return(0,s.jsx)("table",{className:"".concat(r()["keys-table"]," ").concat(n),style:i,children:(0,s.jsx)("tbody",{children:Array.from(t.entries()).map(e=>{let[t,{name:n,description:i,holdable:r}]=e;return(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{children:(0,s.jsx)(a,{children:t})}),(0,s.jsxs)("td",{children:[null!=i?i:n,r&&(0,s.jsx)("span",{style:{fontSize:"0.8rem"},children:" (Holdable)"})]})]},n)})})})}},42474:function(e,t,n){"use strict";n.d(t,{k:function(){return a}});var s=n(85893),i=n(39324),r=n(67294);function a(e){let{options:t,selected:n,onChange:a}=e,o=(0,r.useRef)(null),l=t.find(e=>e.value===n),[c,h]=(0,r.useState)({width:0,left:0});return(0,r.useEffect)(()=>{var e;let s=null===(e=o.current)||void 0===e?void 0:e.querySelectorAll("button"),i=t.findIndex(e=>e.value===n);if(!s||i<0)return;let r=s[i].getBoundingClientRect(),a=o.current.getBoundingClientRect();h({width:r.width,left:r.left-a.left})},[o,t,n]),(0,s.jsxs)("div",{className:"multiple-option-slider",ref:o,children:[t.map(e=>(0,s.jsx)("button",{onClick:()=>a(e.value),className:e===l?"multiple-options-selected":"",children:(0,i.kC)(e.value)},e.value)),(0,s.jsx)("div",{className:"multiple-option-slider-overlay",style:{width:"".concat(c.width,"px"),left:"".concat(c.left,"px"),backgroundColor:null==l?void 0:l.color}})]})}},19075:function(e,t,n){"use strict";n.d(t,{O:function(){return u}});var s=n(85893),i=n(17544),r=n(21820),a=n.n(r),o=n(39324);let l=new Set(i.BX.filter(e=>e.includes("_")).map(e=>e.split("_")[0])),c={instruments:i.BX.filter(e=>!e.includes("_"))};for(let e of l)c[e]=i.BX.filter(t=>t.startsWith(e));let h=Object.entries(c);function u(e){let{selected:t,onChange:n,style:i,className:r}=e;return(0,s.jsx)("select",{className:"".concat(a().select," ").concat(r),style:{width:"100%",padding:"0.3rem",...i},onChange:e=>{n(e.target.value),e.target.blur()},value:t,children:1===h.length?(0,s.jsx)(s.Fragment,{children:c.instruments.map(e=>(0,s.jsx)("option",{value:e,children:e.replace("-"," ")},e))}):(0,s.jsx)(s.Fragment,{children:h.map(e=>{let[t,n]=e;return(0,s.jsx)("optgroup",{label:(0,o.kC)(t),children:n.map(e=>(0,s.jsx)("option",{value:e,children:e.replace("-"," ").replace("".concat(t,"_"),"")},e))},t)})})})}},66834:function(e,t,n){"use strict";n.d(t,{x:function(){return o}});var s=n(85893),i=n(17544),r=n(21820),a=n.n(r);function o(e){let{selected:t,onChange:n,style:r,children:o,className:l}=e;return(0,s.jsxs)("select",{className:"".concat(a().select," ").concat(null!=l?l:""),style:{width:"100%",padding:"0.3rem",...r},onChange:e=>{n(e.target.value),e.target.blur()},value:t,children:[o,i.T_.map(e=>(0,s.jsx)("option",{children:e},e))]})}},19502:function(e,t,n){"use strict";n.d(t,{P:function(){return l}});var s=n(85893),i=n(92634),r=n(21820),a=n.n(r),o=n(67294);function l(e){let{onChange:t,value:n,children:r,style:l}=e,[c]=(0,i.F)(),h=(0,o.useCallback)(e=>{t(e),e.target.blur()},[t]);return(0,s.jsx)("select",{onChange:h,value:n,className:a().select,style:{backgroundImage:"url(\"data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' height='24' viewBox='0 0 24 24' width='24' fill='".concat(c.getText("primary").hex().replace("#","%23"),"'><path d='M0 0h24v24H0z' fill='none'/><path d='M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z'/></svg>\")"),...l},children:r})}},84455:function(e,t,n){"use strict";n.d(t,{F:function(){return a}});var s=n(85893),i=n(41664),r=n.n(i);function a(e){let{href:t,children:n,style:i,...a}=e;return(0,s.jsx)(r(),{href:t,style:{display:"inline-block",textDecoration:"underline",color:"var(--accent)",...i},...a,children:n})}},40419:function(e,t,n){"use strict";n.d(t,{v:function(){return s}});class s{get fps(){return this.maxFps}changeMaxFps(e){this.maxFps=e,this.maxFpsInterval=1e3/e}setCallback(e){this.callback=e}start(e){this.stop(),this.startTime=Date.now(),this.nextTick=Date.now(),this.previousTickTime=0,this.duration=null!=e?e:Number.MAX_SAFE_INTEGER,this.tick()}stop(){clearTimeout(this.raf)}constructor(e,t){this.nextTick=0,this.maxFpsInterval=0,this.deltaTime=0,this.raf=0,this.duration=0,this.previousTickTime=0,this.tick=()=>{let e=Date.now();this.deltaTime=e-this.nextTick,this.deltaTime>=this.maxFpsInterval&&(this.nextTick=e-this.deltaTime%this.maxFpsInterval,this.callback(this.elapsed,e-this.previousTickTime),this.previousTickTime=e),this.elapsed=e-this.startTime,this.elapsed<this.duration&&(this.raf=setTimeout(this.tick,8))},this.callback=e,this.startTime=0,this.elapsed=0,this.maxFps=t,this.maxFpsInterval=1e3/t}}},74646:function(e,t,n){"use strict";n.d(t,{z:function(){return r}});var s=n(83679),i=n(92761);class r{setBasePitch(e){this.basePitch=e}destroy(){this.audioInstruments.forEach(e=>{i.n.disconnect(e.endNode),e.dispose()})}syncInstruments(e){return this.instruments=e,this.loadInstruments()}async loadInstruments(){let{instruments:e,audioInstruments:t}=this;return t.splice(e.length).forEach(e=>{i.n.disconnect(e.endNode),e.dispose()}),Promise.all(e.map(async(e,n)=>{if(void 0===t[n]){let r=new s.Yx(e.name);return t[n]=r,await r.load(i.n.getAudioContext()),i.n.connect(r.endNode,e.reverbOverride),r.changeVolume(e.volume),r}if(t[n].name===e.name)return t[n].changeVolume(e.volume),i.n.setReverbOfNode(t[n].endNode,e.reverbOverride),t[n];{let r=t[n];i.n.disconnect(r.endNode),r.dispose();let a=new s.Yx(e.name);return t[n]=a,await a.load(i.n.getAudioContext()),i.n.connect(a.endNode,e.reverbOverride),a.changeVolume(e.volume),a}}))}playNoteOfInstrument(e,t,n){let s=this.instruments[e];this.audioInstruments[e].play(t,null!=n?n:s.pitch||this.basePitch)}playNotesOfInstrument(e,t,n){t.forEach(t=>this.playNoteOfInstrument(e,t,n))}constructor(e){this.instruments=[],this.audioInstruments=[],this.basePitch="C",this.basePitch=e}}},90045:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return eD}});var s=n(85893),i=n(67294),r=n(48043),a=n(50746),o=n(20027),l=n(17678),c=n(54135),h=n(86998),u=n(31602),d=n(52461),m=n(46335),g=n(97411),p=n(10694),f=n(12293),v=n(86087),x=n(24104),b=n(92634),y=n(89867),j=n(85565),k=n(78773),w=n(40569),S=n(6340),C=n(11090);function T(e){let{data:t,onChange:n,onVisibilityChange:i,theme:a,style:o}=e,l=a.layer("menu_background",.2).desaturate(.5);return(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)(C.X,{align:"center",justify:"between",className:"track-modifier",style:{backgroundColor:l.hex(),...o},children:[(0,s.jsx)("span",{className:"text-ellipsis",children:t.alias}),(0,s.jsxs)(C.X,{align:"center",justify:"end",children:[(0,s.jsx)(r.J,{className:"flex-centered vsrg-track-modifier-button",onClick:()=>i(!t.hidden),children:t.hidden?(0,s.jsx)(k.tgn,{}):(0,s.jsx)(k.dSq,{})}),(0,s.jsx)(r.J,{className:"flex-centered vsrg-track-modifier-button",style:{marginLeft:"0.3rem"},onClick:()=>n(t.set({muted:!t.muted})),children:t.muted?(0,s.jsx)(k.xZH,{}):(0,s.jsx)(k.rxG,{})})]})]})})}var H=n(7374),N=n(32362),E=n(5323),O=n(70560),P=n(82860),_=n(84455),z=n(82446);function M(){let e=H.z5.getVsrgKeybinds(6),{IS_MOBILE:t}=(0,E.Z)(),[n]=(0,N.Kq)(H.z5.getShortcutMap("vsrg_composer"));return(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)(P.s,{children:[(0,s.jsx)(z.h,{type:"h2",children:"VSRG help"}),(0,s.jsxs)("p",{children:["To learn how to use this composer, visit the ",(0,s.jsx)(_.F,{href:"/blog/how-to-use-vsrg-composer",children:"VSRG composer guide"}),"! ",(0,s.jsx)("br",{}),"There will be written a simple explanation of every function and setting in the composer."]}),!t&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(z.h,{margin:"1rem 0",children:"VSRG Composer shortcuts"}),(0,s.jsxs)("p",{children:["The VSRG composer has some shortcuts you can use, if you want to change them, go to the ",(0,s.jsx)(_.F,{href:"/keybinds",children:"keybinds page"})]}),(0,s.jsx)(O.A,{shortcuts:n}),(0,s.jsxs)("div",{className:"row",style:{padding:"0.1rem",gap:"1rem",marginTop:"-0.1rem"},children:[(0,s.jsx)(O.s,{children:e.join("/")}),(0,s.jsx)("div",{children:" Add hit object (syncs to the registered keybinds)"})]})]})]})})}var R=n(53179),A=n(21820),I=n.n(A),L=n(17544),F=n(99962),D=(0,i.memo)(function(e){let{onSave:t,onSongOpen:n,settings:u,handleSettingChange:d,hasChanges:p,onCreateSong:y,setAudioSong:j,audioSong:S,trackModifiers:H,onTrackModifierChange:N}=e,[E,O]=(0,i.useState)(!1),[P,_]=(0,i.useState)(!1),[z,R]=(0,i.useState)("Settings"),[A]=(0,v.j)(),[L]=(0,x.n)(),[D]=(0,b.F)(),K=(0,f.ZP)(e=>{_(!1)},{active:E&&P,ignoreFocusable:!0});return(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)(F.q,{ref:K,current:z,setCurrent:R,open:E,setOpen:O,visible:P,children:[(0,s.jsx)("div",{className:"hamburger vsrg-hamburger",onClick:()=>_(!P),children:(0,s.jsx)(g.c,{icon:k.Fm7})}),(0,s.jsxs)(F.V,{children:[(0,s.jsx)(c.j,{onClick:()=>_(!P),className:"close-menu",ariaLabel:"Close menu",children:(0,s.jsx)(g.c,{icon:k.aHS,className:"icon"})}),(0,s.jsx)(c.j,{onClick:t,style:{marginTop:"auto"},className:p?"not-saved":"",ariaLabel:"Save",children:(0,s.jsx)(g.c,{icon:k.TvB,className:"icon"})}),(0,s.jsx)(c.s,{id:"Help",ariaLabel:"Help",children:(0,s.jsx)(g.c,{icon:k.g_g,className:"icon"})}),(0,s.jsx)(c.s,{id:"Songs",ariaLabel:"Song menu",children:(0,s.jsx)(g.c,{icon:k.HcQ,className:"icon"})}),(0,s.jsx)(c.s,{id:"Settings",ariaLabel:"Settings menu",children:(0,s.jsx)(g.c,{icon:k.p4t,className:"icon"})}),(0,s.jsx)(c.j,{onClick:w.I.open,ariaLabel:"Open home menu",style:{border:"solid 0.1rem var(--secondary)"},children:(0,s.jsx)(g.c,{icon:k.xng,className:"icon"})})]}),(0,s.jsxs)(o.f,{children:[(0,s.jsx)(o.G,{id:"Help",children:(0,s.jsx)(M,{})}),(0,s.jsxs)(o.G,{id:"Songs",children:[(0,s.jsx)("div",{className:"row",children:(0,s.jsx)(r.J,{onClick:y,children:"Create song"})}),(0,s.jsx)(l.G,{songs:L,exclude:["composed","recorded"],style:{marginTop:"0.6rem"},SongComponent:W,componentProps:{theme:D,folders:A,functions:{onClick:n,toggleMenu:_}}})]}),(0,s.jsxs)(o.G,{id:"Settings",children:[(0,s.jsx)(h.A,{settings:u,onUpdate:d}),(0,s.jsxs)("div",{className:"column vsrg-select-song-wrapper",children:[(0,s.jsxs)("h1",{className:"".concat(I()["settings-group-title"]," row-centered"),children:["Background Song",(0,s.jsx)(m.k,{buttonStyle:{width:"1.2rem",height:"1.2rem",marginLeft:"0.5rem"},children:"You can select one of your songs to be played on the background"})]}),null===S?(0,s.jsx)("span",{children:"No background song selected"}):(0,s.jsxs)("div",{className:"column vsrg-composer-selected-song",children:[(0,s.jsxs)("div",{className:"row",style:{borderBottom:"2px solid var(--secondary)",paddingBottom:"0.4rem",marginBottom:"0.4rem"},children:[(0,s.jsx)("span",{className:"song-name",style:{cursor:"default"},children:S.name}),(0,s.jsx)(a.v,{onClick:()=>j(null),ariaLabel:"Remove background song",tooltip:"Remove background song",style:{backgroundColor:"var(--red-bg)",margin:0},children:(0,s.jsx)(k.aHS,{})})]}),(0,s.jsxs)(C.X,{justify:"between",align:"center",children:[(0,s.jsx)("span",{children:"Pitch"}),(0,s.jsx)("span",{children:S.pitch})]}),(0,s.jsxs)(C.X,{justify:"between",align:"center",children:[(0,s.jsx)("span",{children:"BPM"}),(0,s.jsx)("span",{children:S.bpm})]}),(0,s.jsx)("span",{style:{marginTop:"0.4rem"},children:"Instrument modifiers"}),H.map((e,t)=>(0,s.jsx)(T,{theme:D,data:e,onChange:e=>N(e,t,!1),onVisibilityChange:n=>{N(e.set({hidden:n}),t,!0)}},t))]}),(0,s.jsx)(l.G,{songs:L,exclude:["vsrg"],style:{marginTop:"0.6rem"},SongComponent:B,componentProps:{onClick:j}})]})]})]})]})})},(e,t)=>e.settings===t.settings&&e.hasChanges===t.hasChanges&&e.audioSong===t.audioSong&&e.trackModifiers===t.trackModifiers);function B(e){let{data:t,onClick:n}=e;return(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)("div",{className:"song-row ".concat((0,p.h)(!0)),onClick:async()=>{let e=await j.v.getOneSerializedFromStorable(t);if(!e)return R.kg.error("Could not find song");n(e)},style:{cursor:"pointer"},children:[(0,s.jsx)("div",{className:"song-name",children:t.name}),(0,s.jsx)(p.u,{children:"Click to select as background song"})]})})}function W(e){let{data:t,functions:n,theme:r,folders:a}=e,{toggleMenu:o,onClick:l}=n,c={backgroundColor:r.layer("primary",.15).toString()},[h,m]=(0,i.useState)(!1),[g,f]=(0,i.useState)(t.name);return((0,i.useEffect)(()=>{f(t.name)},[t.name]),"vsrg"!==t.type)?(0,s.jsx)("div",{className:"row",children:"Invalid song"}):(0,s.jsxs)("div",{className:"song-row",children:[(0,s.jsxs)("div",{className:"song-name ".concat((0,p.h)(!0)),onClick:async()=>{if(h)return;let e=await j.v.fromStorableSong(t);if(!e)return R.kg.error("Could not find song");l(e),o(!1)},children:[h?(0,s.jsx)("input",{className:"song-name-input ".concat(h?"song-rename":""),disabled:!h,onChange:e=>f(e.target.value),style:{width:"100%",color:"var(--primary-text)"},value:g}):(0,s.jsx)("div",{style:{marginLeft:"0.3rem"},children:g}),(0,s.jsx)(p.u,{children:h?"Song name":"Play song"})]}),(0,s.jsx)("div",{className:"song-buttons-wrapper",children:(0,s.jsxs)(d.Rk,{Icon:k.LCi,style:c,ignoreClickOutside:h,tooltip:"More options",onClose:()=>m(!1),children:[(0,s.jsxs)(d.tc,{onClick:()=>{h&&(S.k.renameSong(t.id,g),m(!1)),m(!h)},children:[(0,s.jsx)(k.tU3,{style:{marginRight:"0.4rem"},size:14}),(0,s.jsx)(d.Qr,{text:h?"Save":"Rename"})]}),(0,s.jsxs)(d.tc,{style:{padding:"0 0.4rem"},children:[(0,s.jsx)(k.$nz,{style:{marginRight:"0.4rem"}}),(0,s.jsxs)("select",{className:"dropdown-select",value:t.folderId||"_None",onChange:async e=>{let n=e.target.value,s=await j.v.getOneSerializedFromStorable(t);if(!s)return R.kg.error("Could not find song");S.k.addSongToFolder(s,"_None"!==n?n:null)},children:[(0,s.jsx)("option",{value:"_None",children:"None"}),a.map(e=>(0,s.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,s.jsxs)(d.tc,{onClick:async()=>{let e=await j.v.getOneSerializedFromStorable(t);if(!e)return R.kg.error("Could not find song");y.bV.downloadSong(e,"".concat(t.name,".").concat(L.iC.toLowerCase(),"sheet"))},children:[(0,s.jsx)(k.aBF,{style:{marginRight:"0.4rem"},size:14}),(0,s.jsx)(d.Qr,{text:"Download"})]}),(0,s.jsxs)(d.tc,{onClick:async()=>{await (0,u.jH)("Are you sure you want to delete this song?")&&S.k.removeSong(t.id)},children:[(0,s.jsx)(k.Xm5,{color:"#ed4557",style:{marginRight:"0.4rem"},size:14}),(0,s.jsx)(d.Qr,{text:"Delete"})]})]})})]})}var K=n(19502),J=n(42474);let X=[{value:"tap",color:"var(--accent)"},{value:"hold",color:"#8569a9"},{value:"delete",color:"var(--red)"}],V=[1,2,4,8,16];function U(e){let{onSnapPointChange:t,onHitObjectTypeChange:n,selectedSnapPoint:i,isPlaying:a,togglePlay:o,selectedHitObjectType:l,vsrg:c,onScalingChange:h,scaling:u,tempoChanger:d,onTempoChangerChange:m}=e;return(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)("div",{className:"vsrg-bottom",children:[(0,s.jsx)(J.k,{options:X,selected:l,onChange:e=>{n(e)}}),(0,s.jsx)("div",{className:"vsrg-name text-ellipsis",children:c.name}),(0,s.jsx)("div",{className:"flex-centered",style:{flex:"1",padding:"0 1rem"},children:(0,s.jsx)("input",{type:"range",min:10,style:{width:"100%"},max:120,value:u,onPointerUp:e=>{var t;null===(t=e.target)||void 0===t||t.blur()},onChange:e=>h(parseInt(e.target.value))})}),(0,s.jsxs)("div",{className:"flex-centered",style:{height:"100%"},children:[(0,s.jsx)(K.P,{value:d,onChange:e=>m(Number(e.target.value)),style:{width:"5rem",height:"100%",borderRadius:"0.4rem",marginRight:"0.6rem"},children:L.zr.map(e=>(0,s.jsxs)("option",{value:e,children:[100*e,"%"]},e))}),(0,s.jsx)(K.P,{value:i,onChange:e=>{t(parseInt(e.target.value))},style:{width:"6rem",height:"100%",borderRadius:"0.4rem"},children:V.map(e=>(0,s.jsxs)("option",{value:e,children:["Snap: 1/",e]},e))}),(0,s.jsx)(r.J,{className:"vsrg-play-button flex-centered",onClick:o,children:a?(0,s.jsx)(k.Wh,{size:20}):(0,s.jsx)(k.gmG,{size:20})})]})]})})}var Z=n(6767),$=n.n(Z);function q(e){let{elements:t,perRow:n,onClick:i,selected:r}=e;return(0,s.jsx)(s.Fragment,{children:(0,s.jsx)("div",{className:"vsrg-keyboard",style:{gridTemplateColumns:"repeat(".concat(n,", 1fr)"),gridTemplateRows:"repeat(".concat(Math.ceil(t.length/n),", 1fr)"),opacity:r?1:.5,pointerEvents:r?"all":"none",cursor:r?"pointer":"not-allowed"},children:t.map(e=>(0,s.jsx)("button",{onClick:()=>i(e),style:(null==r?void 0:r.includes(e))?{backgroundColor:"var(--accent)"}:{}},e))})})}var Y=n(19075),G=n(66834),Q=n(55651);function ee(e){let{onChange:t,value:n,absolute:r=!0,style:a}=e,[o,l]=(0,i.useState)($()(n));function c(e){l($()(e))}return(0,i.useEffect)(()=>{l($()(n))},[n]),(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)("div",{className:"color-picker",style:{position:r?"absolute":"unset",...a},children:[(0,s.jsx)(Q.gW,{onChange:c,color:o.hex()}),(0,s.jsxs)("div",{className:"color-picker-row",children:[(0,s.jsxs)("div",{className:"color-picker-input",style:{backgroundColor:o.toString(),color:o.isDark()?L.kx.text.light:L.kx.text.dark},children:[(0,s.jsx)("div",{style:{fontFamily:"Arial"},children:"#"}),(0,s.jsx)(Q.ZE,{onChange:c,color:o.hex(),style:{color:o.isDark()?L.kx.text.light:L.kx.text.dark}})]}),(0,s.jsx)("button",{className:"color-picker-check",onClick:()=>{l($()(n)),null==t||t(n)},style:{backgroundColor:o.toString(),color:o.isDark()?L.kx.text.light:L.kx.text.dark},children:(0,s.jsx)(k.aHS,{size:16})}),(0,s.jsx)("button",{className:"color-picker-check",onClick:function(){null==t||t(o.toString())},style:{backgroundColor:o.toString(),color:o.isDark()?L.kx.text.light:L.kx.text.dark},children:(0,s.jsx)(k.l_A,{size:16})})]})]})})}class et{addEventListener(e,t){this.listeners.has(e)||this.listeners.set(e,[]),this.listeners.get(e).push(t)}removeEventListener(e,t){let n=this.listeners.get(e);if(!n)return;let s=n.findIndex(e=>e.id===t.id||e.callback===t.callback);-1!==s&&n.splice(s,1)}emitEvent(e,t){var n,s;[...null!==(n=this.listeners.get(e))&&void 0!==n?n:[],...null!==(s=this.listeners.get("ALL"))&&void 0!==s?s:[]].forEach(n=>n.callback(e,t))}constructor(){this.listeners=new Map}}let en=new et;function es(e){let{track:t,onSave:n,onDelete:a,onChange:o}=e,[l,c]=(0,i.useState)(!1);return t?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"vsrg-floating-settings box-shadow",children:[(0,s.jsxs)(C.X,{justify:"between",align:"center",children:["Track name",(0,s.jsx)("input",{type:"text",maxLength:50,className:"input",style:{width:"7.4rem"},value:t.instrument.alias,onChange:e=>{t.instrument.set({alias:e.target.value}),o(t)},placeholder:t.instrument.name})]}),(0,s.jsxs)(C.X,{justify:"between",align:"center",style:{marginTop:"0.4rem"},children:["Instrument",(0,s.jsx)(Y.O,{style:{width:"8rem"},selected:t.instrument.name,onChange:e=>{t.instrument.set({name:e}),o(t)}})]}),(0,s.jsxs)(C.X,{justify:"between",align:"center",style:{marginTop:"0.4rem"},children:["Pitch",(0,s.jsx)(G.x,{style:{width:"8rem"},selected:t.instrument.pitch,onChange:e=>{t.instrument.set({pitch:e}),o(t)},children:(0,s.jsx)("option",{value:"",children:"Use song pitch"})})]}),(0,s.jsxs)(C.X,{align:"center",style:{marginTop:"1rem"},children:["Volume",(0,s.jsxs)("span",{style:{marginLeft:"0.4rem",width:"3rem",...t.instrument.volume>100&&{color:"hsl(0, ".concat(-40+t.instrument.volume,"%, 61%)"),marginLeft:"0.4rem"}},children:[t.instrument.volume,"%"]}),(0,s.jsx)(m.k,{buttonStyle:{width:"1.2rem",height:"1.2rem"},width:10,children:"If you hear distortion, reduce the volume"})]}),(0,s.jsx)(C.X,{align:"center",children:(0,s.jsx)("input",{type:"range",style:{flex:"1"},min:0,max:125,value:t.instrument.volume,onChange:e=>{t.instrument.set({volume:parseInt(e.target.value)}),o(t)}})}),(0,s.jsx)(P.s,{children:(0,s.jsxs)(C.X,{justify:"between",align:"center",children:["Color",(0,s.jsx)(r.J,{onClick:()=>c(!0),ariaLabel:"Change color",style:{backgroundColor:t.color,color:$()(t.color).isDark()?"#fff":"#000"},children:"Change"})]})}),(0,s.jsxs)(C.X,{justify:"between",style:{marginTop:"0.4rem"},children:[(0,s.jsxs)(r.J,{className:"row-centered",style:{padding:"0.4rem",width:"fit-content"},onClick:a,children:[(0,s.jsx)(k.Xm5,{color:"var(--red)",style:{marginRight:"0.3rem"}}),"Delete"]}),(0,s.jsx)(r.J,{onClick:n,style:{padding:"0.4rem",width:"fit-content"},children:"Ok"})]})]}),l&&(0,s.jsx)(ee,{style:{right:"0.8rem",top:"0.5rem"},value:t.color,onChange:e=>{o(t.set({color:e})),c(!1),en.emitEvent("colorChange")}})]}):null}function ei(e){let{vsrg:t,selectedTrack:n,children:a,onTrackAdd:o,onTrackChange:l,onTrackSelect:c,onTrackDelete:h,onNoteSelect:u,onBreakpointChange:d,onBreakpointSelect:m,lastCreatedHitObject:p,selectedHitObject:f}=e,[v]=(0,b.F)(),[x,y]=(0,i.useState)([]),[j,w]=(0,i.useState)(!1),S=t.tracks[n];return(0,i.useEffect)(()=>{y(Array("Sky"===L.iC?15:21).fill(0).map((e,t)=>t))},[]),(0,s.jsxs)(s.Fragment,{children:[a,(0,s.jsxs)("div",{className:"vsrg-top-right ".concat(null!==p?"vsrg-top-right-disabled":""),children:[j&&(0,s.jsx)(es,{track:S,onSave:()=>w(!1),onDelete:()=>h(n),onChange:e=>l(e,n)}),(0,s.jsxs)(C.X,{align:"center",className:"vsrg-breakpoints-buttons",style:{marginBottom:"0.4rem"},children:[(0,s.jsx)(r.J,{style:{marginLeft:0},onClick:()=>m(-1),children:(0,s.jsx)(g.c,{icon:k.qSR})}),(0,s.jsx)(r.J,{onClick:()=>d(!0),children:(0,s.jsx)(g.c,{icon:k.iFH})}),(0,s.jsx)(r.J,{onClick:()=>d(!1),children:(0,s.jsx)(g.c,{icon:k.wEH})}),(0,s.jsx)(r.J,{onClick:()=>m(1),children:(0,s.jsx)(g.c,{icon:k.Nqc})})]}),(0,s.jsxs)("div",{className:"vsrg-track-wrapper column",children:[t.tracks.map((e,t)=>(0,s.jsx)(er,{track:e,selected:t===n,theme:v,onSettingsClick:()=>w(!j),onTrackClick:()=>c(t)},t)),(0,s.jsx)("div",{style:{width:"100%",height:"1.4rem"}}),(0,s.jsx)(r.J,{onClick:e=>{setTimeout(()=>{var t;o(),null===(t=e.target)||void 0===t||t.scrollIntoView()},50)},ariaLabel:"Add new instrument",className:"flex-centered",style:{marginTop:"auto",padding:"0.3rem"},children:(0,s.jsx)(k.wEH,{size:16,color:"var(--icon-color)"})})]}),(0,s.jsx)(q,{elements:x,selected:null==f?void 0:f.notes,perRow:"Sky"===L.iC?5:7,onClick:u})]})]})}function er(e){let{track:t,selected:n,theme:a,onSettingsClick:o,onTrackClick:l}=e,[c,h]=(0,i.useState)({background:"var(--primary)",text:"var(--primary-text)"}),[u,d]=(0,i.useState)({background:"var(--primary)",text:"var(--primary-text)"});return(0,i.useEffect)(()=>{let e=a.get("primary").mix(new($())(t.color),.3);h({background:e.toString(),text:e.isDark()?"var(--text-light)":"var(--text-dark)"});let n=new($())(t.color);d({background:n.toString(),text:n.isDark()?"rgb(220 219 216)":"rgb(55 55 55)"})},[a,t.color]),(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)("div",{className:"vsrg-track row-centered",style:{backgroundColor:n?c.background:"var(--primary)",color:n?c.text:"var(--primary-text)"},onClick:l,children:[(0,s.jsx)("span",{className:"text-ellipsis",style:{color:n?c.text:"var(--text-color)",paddingLeft:"0.6rem",paddingRight:"0.2rem",flex:1},children:t.instrument.alias||t.instrument.name}),(0,s.jsx)(r.J,{onClick:()=>n&&o(),style:{backgroundColor:u.background},className:"vsrg-track-left flex-centered",children:n&&(0,s.jsx)(k.p4t,{color:u.text})})]})})}var ea=n(28682),eo=n(78810),el=n(63805),ec=n.n(el),eh=n(40419),eu=n(54233),ed=n(57564),em=n(43531),eg=n(39324);ed.Xd.LINE_SCALE_MODE=ed.F4.NORMAL;class ep{generate(){let{app:e}=this;e&&(this.isMobile=ec()(),this.generateSnapPoints(e),this.generateTrackCache(e),this.generateTrails(e),this.generateSelectionRings(e),this.generateOthers(e))}getHitObjectCache(e){return this.textures.hitObjects[e]||this.textures.hitObjects["#FF0000"]}getHeldTrailCache(e){return this.textures.trails[e]||this.textures.trails["#FF0000"]}getHeldHitObjectCache(e){return this.textures.heldHitObjects[e]||this.textures.heldHitObjects["#FF0000"]}getSelectionRingsCache(e){return this.textures.selectionRings[e]||this.textures.selectionRings["#FF0000"]}generateOthers(e){let{sizes:t,colors:n,isHorizontal:s}=this,i=new ed.K3;i.beginFill(this.colors.background_plain[1]).drawRect(0,0,this.sizes.width,this.sizes.timelineSize).lineStyle(3,this.colors.secondary[1],1).moveTo(0,t.timelineSize).lineTo(this.sizes.width,t.timelineSize);let r=e.renderer.generateTexture(i,{resolution:1,scaleMode:em.aH$.LINEAR,region:new em.AeJ(0,0,this.sizes.width,this.sizes.timelineSize)});this.textures.timeline.square=r;let a=s?t.height/16:t.width/16,o=(0,eg.uZ)(t.timelineSize/4,8,100),l=new ed.K3;l.beginFill(n.accent[1]).moveTo(0,0).lineTo(o,0).lineTo(o/2,o).lineTo(0,0).moveTo(0,0).lineTo(o,0).lineTo(o/2,-o).lineTo(0,0).endFill().lineStyle(3,n.accent[1],1).moveTo(o/2,0).lineTo(o/2,t.timelineSize).lineStyle(0).beginFill(n.accent[1]).moveTo(0,t.timelineSize).lineTo(o,t.timelineSize).lineTo(o/2,t.timelineSize).lineTo(0,t.timelineSize).moveTo(0,t.timelineSize).lineTo(o,t.timelineSize).lineTo(o/2,t.timelineSize-o).lineTo(0,t.timelineSize);let c=t.timelineSize/2,h=new ed.K3;h.lineStyle(this.isMobile?2:3,n.secondary[1],1).drawCircle(t.timelineSize/2+1,t.timelineSize/2,c/2);let u=e.renderer.generateTexture(h,{resolution:1,scaleMode:em.aH$.LINEAR,region:new em.AeJ(0,0,t.timelineSize,t.timelineSize)});this.textures.timeline.note=u;let d=new ed.K3;d.lineStyle(12,n.accent[1],1).moveTo(0,0).lineTo(0,t.timelineSize);let m=e.renderer.generateTexture(d,{resolution:1,scaleMode:em.aH$.LINEAR,region:new em.AeJ(0,0,12,t.timelineSize)});this.textures.timeline.currentTime=m;let g=e.renderer.generateTexture(l,{resolution:2,scaleMode:em.aH$.LINEAR,region:new em.AeJ(0,0,o,t.timelineSize)});this.textures.timeline.thumb=g;let p=new ed.K3;p.beginFill(n.accent[1]).moveTo(0,0).lineTo(o,0).lineTo(o/2,o).lineTo(0,0).moveTo(0,0).lineTo(o,0).lineTo(o/2,-o).lineTo(0,0);let f=e.renderer.generateTexture(p,{resolution:1,scaleMode:em.aH$.LINEAR,region:new em.AeJ(0,0,o,o)});this.textures.timeline.breakpoint=f;let v=new ed.K3;if(v.beginFill(n.background_10[1]),s){v.drawRoundedRect(a/2,a/2,t.width/2-a,t.height/2-a,16);let n=e.renderer.generateTexture(v,{resolution:1,scaleMode:em.aH$.LINEAR,region:new em.AeJ(0,0,t.width/2,t.height/2)});this.textures.buttons.width=t.width/2,this.textures.buttons.height=t.height/2,this.textures.buttons.time=n}else{v.drawRoundedRect(a/2,a/2,t.width/2-a,t.height/3-a,8);let n=e.renderer.generateTexture(v,{resolution:1,scaleMode:em.aH$.LINEAR,region:new em.AeJ(0,0,t.width/2,t.height/3)});this.textures.buttons.width=t.width/2,this.textures.buttons.height=t.height/3,this.textures.buttons.time=n}i.destroy(!0),l.destroy(!0),h.destroy(!0),d.destroy(!0),p.destroy(!0),v.destroy(!0)}generateTrails(e){let{sizes:t,trackColors:n}=this,s=[...n,"#FF0000"],i=(0,eg.uZ)(t.keyHeight/2*t.scaling,t.keyHeight/(this.isMobile?3:4),100),r=i/2;s.forEach(t=>{let n=new ed.K3;this.isHorizontal?n.beginFill($()(t).rgbNumber()).drawRect(0,r/2,i,i-r):n.beginFill($()(t).rgbNumber()).drawRect(r/2,0,i-r,i);let s=e.renderer.generateTexture(n,{resolution:1,scaleMode:em.aH$.LINEAR,region:new em.AeJ(0,0,i,i)});this.textures.trails[t]=s}),this.textures.sizes.trail=i}generateSelectionRings(e){let{sizes:t,trackColors:n}=this,s=[...n,"#FF0000"],i=(0,eg.uZ)(t.keyHeight/1.5*t.scaling,t.keyHeight/(this.isMobile?1.2:2),150);s.forEach(t=>{let n=new ed.K3;n.lineStyle(3,$()(t).rgbNumber()).drawCircle(i/2,i/2,i/2-3);let s=e.renderer.generateTexture(n,{resolution:1,scaleMode:em.aH$.LINEAR,region:new em.AeJ(0,0,i,i)});this.textures.selectionRings[t]=s,n.destroy(!0)})}generateTrackCache(e){let{colors:t,sizes:n,trackColors:s}=this,i=(0,eg.uZ)(n.keyHeight/1.8*n.scaling,n.keyHeight/(this.isMobile?2:3.5),100);[...s,"#FF0000"].forEach(n=>{let s=new ed.K3,r=i/2;s.lineStyle(5,$()(n).rgbNumber()).beginFill(t.background_10[1]).drawCircle(r,r,r-5);let a=e.renderer.generateTexture(s,{resolution:2,scaleMode:em.aH$.LINEAR,region:new em.AeJ(0,0,i,i)});this.textures.hitObjects[n]=a,s.destroy(!0);let o=new ed.K3,l=.7*i,c=(i-l)/2;o.width=l,o.height=l,o.lineStyle(5,$()(n).rgbNumber()).beginFill(t.background_10[1]).drawRoundedRect(c,c,l,l,6);let h=e.renderer.generateTexture(o,{resolution:2,scaleMode:em.aH$.LINEAR,region:new em.AeJ(0,0,i,i)});this.textures.heldHitObjects[n]=h,o.destroy(!0)}),this.textures.sizes.hitObject=i}generateSnapPoints(e){let{colors:t,sizes:n,isHorizontal:s,playbarOffset:i}=this,r=new ed.K3,a=new ed.K3,o=new ed.K3;if(s){r.lineStyle(2,t.lineColor[1]).moveTo(0,0).lineTo(0,n.height);let s=e.renderer.generateTexture(r,{resolution:1,scaleMode:em.aH$.LINEAR,region:new em.AeJ(0,0,n.snapPointWidth,n.height)});a.lineStyle(4,t.secondary[1]).moveTo(0,0).lineTo(0,n.height);let l=e.renderer.generateTexture(a,{resolution:1,scaleMode:em.aH$.LINEAR,region:new em.AeJ(0,0,n.snapPointWidth,n.height)}),c=n.height/10;o.lineStyle(2,t.secondary[1]);for(let e=0;e<12;e++){let t=c*e-c;o.moveTo(i,t),o.lineTo(0,t+c)}let h=e.renderer.generateTexture(o,{resolution:1,scaleMode:em.aH$.LINEAR,region:new em.AeJ(0,0,i,n.height)});this.textures.snapPoints.size=n.snapPointWidth,this.textures.snapPoints.small=s,this.textures.snapPoints.large=l,this.textures.snapPoints.empty=h}else{r.lineStyle(2,t.lineColor[1]).moveTo(0,n.snapPointWidth).lineTo(n.width,n.snapPointWidth);let s=e.renderer.generateTexture(r,{resolution:1,scaleMode:em.aH$.LINEAR,region:new em.AeJ(0,0,n.width,n.snapPointWidth)});a.lineStyle(4,t.secondary[1]).moveTo(0,n.snapPointWidth).lineTo(n.width,n.snapPointWidth);let l=e.renderer.generateTexture(a,{resolution:1,scaleMode:em.aH$.LINEAR,region:new em.AeJ(0,0,n.width,n.snapPointWidth)}),c=n.width/20;o.lineStyle(2,t.secondary[1]);for(let e=0;e<22;e++){let t=c*e-c;o.moveTo(t,i),o.lineTo(t+c,0)}let h=e.renderer.generateTexture(o,{resolution:1,scaleMode:em.aH$.LINEAR,region:new em.AeJ(0,0,n.width,i)});this.textures.snapPoints.size=n.snapPointWidth,this.textures.snapPoints.large=l,this.textures.snapPoints.empty=h,this.textures.snapPoints.small=s}r.destroy(!0),a.destroy(!0),o.destroy(!0)}constructor({app:e,colors:t,sizes:n,trackColors:s,isHorizontal:i,playbarOffset:r}){this.isMobile=!1,this.destroy=()=>{var e,t,n,s;null===(e=this.textures.snapPoints.small)||void 0===e||e.destroy(!0),null===(t=this.textures.snapPoints.large)||void 0===t||t.destroy(!0),null===(n=this.textures.snapPoints.empty)||void 0===n||n.destroy(!0),Object.values(this.textures.hitObjects).forEach(e=>null==e?void 0:e.destroy(!0)),Object.values(this.textures.heldHitObjects).forEach(e=>null==e?void 0:e.destroy(!0)),Object.values(this.textures.trails).forEach(e=>null==e?void 0:e.destroy(!0)),Object.values(this.textures.selectionRings).forEach(e=>null==e?void 0:e.destroy(!0)),Object.values(this.textures.timeline).forEach(e=>null==e?void 0:e.destroy(!0)),null===(s=this.textures.buttons.time)||void 0===s||s.destroy(!0),this.app=null},this.textures={hitObjects:{},heldHitObjects:{},selectionRings:{},trails:{},buttons:{width:0,height:0,time:null},snapPoints:{size:0,small:null,large:null,empty:null},timeline:{breakpoint:null,currentTime:null,note:null,square:null,thumb:null},sizes:{hitObject:0,trail:0}},this.trackColors=s,this.colors=t,this.isHorizontal=i,this.playbarOffset=r,this.sizes=n,this.app=e,this.generate()}}var ef=n(37347),ev=n.n(ef);function ex(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],{testString:t,timeout:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{showErrors:s}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{showErrors:!1},[r,a]=(0,i.useState)(!1),o=JSON.stringify(e);return(0,i.useEffect)(()=>{Promise.all(JSON.parse(o).map(e=>{let{family:s,weight:i,style:r,stretch:a}=e;return new(ev())(s,{weight:i,style:r,stretch:a}).load(t,n)})).then(()=>a(!0)).catch(()=>{s&&console.error("An error occurred during font loading")})},[o,t,n,s]),r}let eb=new em.pn8({fontFamily:'"Source Sans Pro", Helvetica, sans-serif',fontSize:30,fill:"#ffffff"}),ey=[{family:"Bonobo"}],ej=(0,i.memo)(function(e){let{keys:t,sizes:n,colors:r,isHorizontal:a,onKeyDown:o,onKeyUp:l}=e,{PLAY_BAR_OFFSET:c}=(0,E.Z)(),[h,u]=(0,i.useState)(eb),d=ex(ey);(0,i.useEffect)(()=>{u(new em.pn8({fontFamily:d?'"Bonobo"':'"Source Sans Pro", Helvetica, sans-serif',fontSize:d?25:30,fill:r.lineColor[1]}))},[r,n,t,d]);let m=n.height/t.length,g=n.width/t.length;return(0,s.jsxs)(eo.W2,{x:0,y:n.timelineSize,children:[(0,s.jsx)(eo.TC,{draw:e=>{if(e.clear(),e.beginFill(r.background_plain[1]),a){e.drawRect(0,0,60,n.height),e.lineStyle(2,r.lineColor_10[1]);for(let s=0;s<t.length-1;s++)e.moveTo(0,m*(s+1)),e.lineTo(n.width,m*(s+1));e.lineStyle(2,r.secondary[1]),e.moveTo(59,0),e.lineTo(59,n.height)}else{e.drawRect(0,n.height-60,n.width,60),e.lineStyle(2,r.lineColor_10[1]);for(let s=0;s<t.length-1;s++)e.moveTo(g*(s+1),0),e.lineTo(g*(s+1),n.height);e.lineStyle(2,r.secondary[1]),e.moveTo(0,n.height-60),e.lineTo(n.width,n.height-60)}}}),(0,s.jsx)(eo.TC,{draw:e=>{if(e.clear(),e.lineStyle(6,r.accent[1]),a){e.moveTo(c+1,0),e.lineTo(c+1,n.height);for(let n=0;n<t.length;n++)e.drawCircle(c+1,m*(n+.5),4)}else{let s=n.height-c-1-n.timelineSize;e.moveTo(0,s),e.lineTo(n.width,s);for(let n=0;n<t.length;n++)e.drawCircle(g*(n+.5)+1,s,4)}}}),t.map((e,t)=>{let i=new em.AeJ(a?0:g*t,a?m*t:n.height-60,a?60:n.width,a?m:60);return(0,s.jsx)(eo.W2,{hitArea:i,eventMode:"static",pointerdown:()=>o(t),pointerup:()=>l(t),pointerupoutside:()=>l(t),children:(0,s.jsx)(eo.xv,{x:a?30:g*t+g/2,y:a?m*t+m/2:n.height-30,anchor:.5,text:"".concat(t+1),style:h})},e)})]})},(e,t)=>e.keys===t.keys&&e.sizes===t.sizes&&e.colors===t.colors&&e.isHorizontal===t.isHorizontal);function ek(e){let{track:t,sizes:n,keys:r,cache:a,isHorizontal:o,selectedHitObject:l,selectHitObject:c,trackIndex:h,timestamp:u}=e,{PLAY_BAR_OFFSET:d}=(0,E.Z)(),m=n.scaling,g=n.height/r,p=n.width/r,f=u-d/m-a.textures.sizes.hitObject,v=u+(o?n.width:n.height)/m-d+a.textures.sizes.hitObject;return(0,s.jsx)(s.Fragment,{children:t.hitObjects.map(e=>{if(f>e.timestamp+e.holdDuration||e.timestamp>v)return null;let r=o?e.timestamp*m:p*e.index+p/2,u=o?g*e.index+g/2:-(e.timestamp*m-n.height);return e.isHeld?(0,s.jsxs)(eo.W2,{eventMode:"static",pointerdown:t=>{c(e,h,(0,eg.Bq)(t.button))},children:[o?(0,s.jsx)(eo.jy,{texture:a.getHeldTrailCache(t.color),anchor:[0,.5],height:a.textures.sizes.trail,width:e.holdDuration*m,x:r,y:u}):(0,s.jsx)(eo.jy,{texture:a.getHeldTrailCache(t.color),anchor:L.$n,width:a.textures.sizes.trail,height:e.holdDuration*m,x:r,y:u}),(0,s.jsx)(eo.jy,{texture:a.getHeldHitObjectCache(t.color),anchor:.5,x:r,angle:45,y:u}),(0,s.jsx)(eo.jy,{texture:a.getHeldHitObjectCache(t.color),anchor:.5,x:o?(e.timestamp+e.holdDuration)*m:r,y:o?u:u-e.holdDuration*m}),e===l&&(0,s.jsx)(eo.jy,{texture:a.getSelectionRingsCache(t.color),anchor:.5,x:r,y:u})]},e.renderId):(0,s.jsxs)(i.Fragment,{children:[e===l&&(0,s.jsx)(eo.jy,{texture:a.getSelectionRingsCache(t.color),anchor:.5,x:r,y:u}),(0,s.jsx)(eo.jy,{texture:a.getHitObjectCache(t.color),eventMode:"static",pointerdown:t=>{c(e,h,(0,eg.Bq)(t.button))},anchor:.5,x:r,y:u})]},e.renderId)})})}let ew=[{family:"Bonobo"}];function eS(e){let{vsrg:t,sizes:n,snapPoint:r,timestamp:a,snapPoints:o,colors:l,cache:c,onSnapPointSelect:h,preventClick:u,isHorizontal:d,selectedHitObject:m,selectHitObject:g,onAddTime:p,onRemoveTime:f}=e,v=n.scaling,{PLAY_BAR_OFFSET:x}=(0,E.Z)(),b=a-(x+c.textures.snapPoints.size)/v,y=a+((d?n.width:n.height)-x)/v,j=c.textures.snapPoints.size,[k,w]=(0,i.useState)(eb),S=ex(ew);function C(e){if(u)return;let t=e.target;if(d){let s=e.globalY-n.timelineSize;h(t.x/v,Math.floor(s/n.keyHeight),(0,eg.Bq)(e.button))}else h(Math.abs(Math.floor(t.y-n.height+j)/v),Math.floor(t.x/n.keyWidth),(0,eg.Bq)(e.button))}return(0,i.useEffect)(()=>{w(new em.pn8({fontFamily:S?'"Bonobo"':'"Source Sans Pro", Helvetica, sans-serif',fontSize:S?25:30,fill:l.lineColor[1]}))},[S,l.lineColor]),(0,s.jsxs)(eo.W2,{x:d?-a*v+x:0,y:d?n.timelineSize:a*v-x,eventMode:"static",interactiveChildren:!0,children:[o.map((e,t)=>b>e||e>y?null:(0,s.jsx)(eo.jy,{eventMode:"static",pointertap:C,x:d?e*v:0,y:d?0:-(e*v-n.height+j),texture:t%r?c.textures.snapPoints.small:c.textures.snapPoints.large},e)),b<0&&(0,s.jsx)(eo.jy,{x:d?-x:0,y:d?0:n.height,texture:c.textures.snapPoints.empty}),t.tracks.map((e,i)=>(0,s.jsx)(ek,{track:e,cache:c,keys:t.keys,colors:l,sizes:n,timestamp:a,trackIndex:i,selectHitObject:g,selectedHitObject:m,isHorizontal:d},i)),a>=t.duration-(d?n.width:n.height)/v&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(eo.W2,{pointertap:p,eventMode:"static",x:d?t.duration*v:0,anchor:.5,y:d?0:-(t.duration*v-n.height+c.textures.buttons.height),children:[(0,s.jsx)(eo.jy,{texture:c.textures.buttons.time}),(0,s.jsx)(eo.xv,{x:c.textures.buttons.width/2,anchor:.5,y:c.textures.buttons.height/2,text:"Click to add time",style:k})]}),(0,s.jsxs)(eo.W2,{pointertap:f,eventMode:"static",x:d?t.duration*v:n.width/2,anchor:.5,y:d?n.height/2:-(t.duration*v-n.height+c.textures.buttons.height),children:[(0,s.jsx)(eo.jy,{texture:c.textures.buttons.time}),(0,s.jsx)(eo.xv,{x:c.textures.buttons.width/2,anchor:.5,y:c.textures.buttons.height/2,text:"Click to remove time",style:k})]})]})]})}let eC=(0,i.memo)(function(e){let{cache:t,breakpoints:n,sizes:i,duration:r}=e;return(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(eo.W2,{children:n.map(e=>(0,s.jsx)(eo.jy,{texture:t.textures.timeline.breakpoint,x:e/r*i.width},e))})})},(e,t)=>e.breakpoints===t.breakpoints&&e.cache===t.cache&&e.sizes===t.sizes&&e.duration===t.duration),eT=new em.AeJ(0,0,0,0);function eH(e){let{sizes:t,timestamp:n,song:r,cache:a,hidden:o,notes:l,onTimelineClick:c}=e,{PLAY_BAR_OFFSET:h}=(0,E.Z)(),[u,d]=(0,i.useState)(eT),[m,g]=(0,i.useState)(!1),p=n-(h+t.timelineSize)/t.scaling,f=n+(t.width-h+t.timelineSize)/t.scaling,v=(0,i.useCallback)(()=>g(!1),[]);(0,i.useEffect)(()=>{d(new em.AeJ(0,0,t.width,t.timelineSize))},[t]),(0,i.useEffect)(()=>{function e(){g(!1)}return window.addEventListener("blur",e),()=>window.removeEventListener("blur",e)},[]);let x=(0,i.useCallback)((e,n)=>{if(!m&&!0!==n)return;let s=e.globalX/t.width*r.duration;c((0,eg.uZ)(s,0,r.duration))},[t,r.duration,c,m]),b=(0,i.useCallback)(e=>{g(!0),x(e,!0)},[x]);if(o)return null;let y=n/r.duration;return(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)(eo.W2,{x:0,y:0,eventMode:"static",pointermove:x,pointerdown:b,pointerup:v,pointerupoutside:v,hitArea:u,children:[(0,s.jsx)(eo.jy,{x:0,y:0,texture:a.textures.timeline.square}),(0,s.jsx)(eo.W2,{x:-n*t.scaling+h,y:0,children:l.map((e,n)=>e.time<p||e.time>f?null:(0,s.jsx)(eo.jy,{x:e.time*t.scaling,anchor:L.Xu,texture:a.textures.timeline.note},n))}),(0,s.jsx)(eC,{breakpoints:r.breakpoints,cache:a,sizes:t,duration:r.duration}),(0,s.jsx)(eo.jy,{x:h-2,y:0,texture:a.textures.timeline.currentTime}),(0,s.jsx)(eo.jy,{y:0,x:y*t.width,texture:a.textures.timeline.thumb})]})})}var eN=n(47008);class eE extends i.Component{componentDidMount(){var e;this.toDispose.push((0,b.B)(this.handleThemeChange)),window.addEventListener("resize",this.calculateSizes),this.toDispose.push(()=>window.removeEventListener("resize",this.calculateSizes)),en.addEventListener("ALL",{callback:this.handleEvent,id:"vsrg-canvas-color-change"}),this.toDispose.push(()=>en.removeEventListener("ALL",{id:"vsrg-canvas-color-change"})),this.calculateSizes(),this.throttledEventLoop.setCallback(this.handleTick),this.throttledEventLoop.changeMaxFps(this.props.maxFps),this.throttledEventLoop.start(),window.addEventListener("blur",this.handleBlur),null===(e=this.state.cache)||void 0===e||e.destroy(),this.toDispose.push(()=>window.removeEventListener("blur",this.handleBlur)),this.handleThemeChange(eu.f6)}componentWillUnmount(){var e;this.toDispose.forEach(e=>e()),null===(e=this.state.cache)||void 0===e||e.destroy(),this.throttledEventLoop.stop()}render(){var e;let{canvasColors:t,sizes:n,cache:i,timestamp:r,preventClick:a}=this.state,{vsrg:o,isHorizontal:l,audioSong:c,snapPoint:h,snapPoints:u,selectedHitObject:d}=this.props;return(0,s.jsx)("div",{className:"vsrg-top-canvas-wrapper",ref:this.wrapperRef,children:this.wrapperRef.current&&(0,s.jsxs)(eo.Hf,{onMount:this.calculateSizes,ref:this.stageRef,raf:!1,width:n.rawWidth,height:n.rawHeight,onWheel:this.handleWheel,onPointerDown:this.setIsDragging,onPointerUp:this.setIsNotDragging,onPointerLeave:this.setIsNotDragging,onPointerMove:this.handleDrag,onContextMenu:e=>e.preventDefault(),options:{backgroundColor:t.background_plain[1],autoDensity:!1,resolution:(null===(e=window)||void 0===e?void 0:e.devicePixelRatio)||1},children:[i&&(0,s.jsx)(eS,{vsrg:o,cache:i,selectedHitObject:d,snapPoint:h,snapPoints:u,timestamp:r,preventClick:a,sizes:n,colors:t,isHorizontal:l,onAddTime:this.props.onAddTime,onRemoveTime:this.props.onRemoveTime,selectHitObject:this.selectHitObject,onSnapPointSelect:this.props.onSnapPointSelect}),(0,s.jsx)(ej,{isHorizontal:l,keys:L.CB[o.keys],sizes:n,colors:t,onKeyDown:this.props.onKeyDown,onKeyUp:this.props.onKeyUp}),i&&(0,s.jsx)(eH,{hidden:!1,notes:this.props.renderableNotes,cache:i,timestamp:r,onTimelineClick:this.setTimestamp,isHorizontal:l,song:o,audioSong:c,sizes:n,colors:t})]})})}constructor(e){super(e),this.wrapperRef=(0,i.createRef)(),this.stageRef=(0,i.createRef)(),this.toDispose=[],this.throttledEventLoop=new eh.v(()=>{},48),this.cumulativeScroll=0,this.handleEvent=(e,t)=>{"colorChange"===e&&this.generateCache(),"updateKeys"===e&&this.calculateSizes(),"updateOrientation"===e&&this.calculateSizes(),"snapPointChange"===e&&this.calculateSizes(),"tracksChange"===e&&this.generateCache(),"songLoad"===e&&this.calculateSizes(),"scaleChange"===e&&this.calculateSizes(),"maxFpsChange"===e&&this.throttledEventLoop.changeMaxFps(this.props.maxFps),"timestampChange"===e&&this.setTimestamp(t)},this.handleTick=(e,t)=>{if(this.props.isPlaying){let e=this.state.timestamp+t*this.props.tempoChanger;this.setTimestamp(e)}},this.handleBlur=()=>{this.setState({isPressing:!1})},this.calculateSizes=()=>{let{wrapperRef:e}=this;if(!e.current)return console.warn("no wrapper");let t=e.current.getBoundingClientRect(),{scaling:n}=this.props,s=ec()()?20:40,i=t.height-s,r={el:t,rawWidth:t.width,rawHeight:t.height,width:t.width,height:i,keyHeight:i/L.CB[this.props.vsrg.keys].length,keyWidth:t.width/L.CB[this.props.vsrg.keys].length,snapPointWidth:6e4/this.props.vsrg.bpm/this.props.snapPoint*n/100,scaling:n/100,timelineSize:s},a=e.current.querySelector("canvas");a&&(a.style.width="".concat(r.width,"px"),a.style.height="".concat(r.height+s,"px")),this.setState({sizes:r},this.generateCache)},this.handleWheel=e=>{if(this.props.scrollSnap){if(this.cumulativeScroll+=e.deltaY,100>Math.abs(this.cumulativeScroll))return;let{snapPoints:t}=this.props,n=t.findIndex(e=>e>this.state.timestamp),s=(n<0?t.length:n)-1+(this.cumulativeScroll<0?-1:1);if(this.cumulativeScroll=0,s<0||s>=t.length)return;let i=t[s];return this.setTimestamp(i)}let t=Math.min(Math.max(0,this.state.timestamp+e.deltaY/1.2),this.props.vsrg.duration);this.setState({timestamp:t},()=>{let{draggedHitObject:t,timestamp:n}=this.state;this.props.onTimestampChange(this.state.timestamp),t&&!(n<=0)&&this.props.dragHitObject(t.timestamp+e.deltaY/1.2)})},this.setIsDragging=e=>{let{sizes:t}=this.state;e.clientY-t.el.top>t.timelineSize&&this.setState({isPressing:!0,previousPosition:this.props.isHorizontal?e.clientX:-e.clientY})},this.setIsNotDragging=e=>{if(!this.state.isPressing)return;let t=this.state.draggedHitObject;this.setState({isPressing:!1,totalMovement:0,draggedHitObject:null},()=>{if(t&&this.props.releaseHitObject(),setTimeout(()=>this.setState({preventClick:!1}),200),this.props.scrollSnap){let{snapPoints:e}=this.props,t=e.findIndex(e=>e>this.state.timestamp);if(!t||t<0)return;let n=e[t],s=e[t-1];if(void 0===n||void 0===s)return;let i=(0,eg.uy)(this.state.timestamp,s,n);this.setTimestamp(i)}})},this.handleDrag=e=>{if(!this.state.isPressing)return;let{previousPosition:t,draggedHitObject:n,sizes:s,timestamp:i}=this.state,{isHorizontal:r,vsrg:a}=this.props,o=r?e.clientX:-e.clientY,l=Math.floor((r?e.clientY-s.el.top-s.timelineSize:e.clientX-s.el.left)/(r?s.keyHeight:s.keyWidth)),c=(t-o)/s.scaling,h=this.state.totalMovement+Math.abs(c);if(null!==n){let e=n.timestamp-c;return this.setState({previousPosition:o},()=>this.props.dragHitObject(Math.max(0,e),l))}let u=Math.min(Math.max(0,i+c),a.duration);this.setState({previousPosition:o,preventClick:h>50,totalMovement:h,timestamp:u},()=>this.props.onTimestampChange(this.state.timestamp))},this.generateCache=()=>{let{sizes:e,canvasColors:t,cache:n}=this.state,s=this.props.vsrg.tracks.map(e=>e.color);if(!this.stageRef.current)return;this.stageRef.current.app.renderer.background.color=t.background[0];let i=new ep({app:this.stageRef.current.app,sizes:e,colors:t,trackColors:s,isHorizontal:this.props.isHorizontal,playbarOffset:eN.X.get().PLAY_BAR_OFFSET}),r=this.state.cache;this.setState({cache:i},()=>{setTimeout(()=>{null==r||r.destroy()},500)})},this.selectHitObject=(e,t,n)=>{2!==n&&this.setState({draggedHitObject:e}),this.props.selectHitObject(e,t,n)},this.setTimestamp=e=>{this.setState({timestamp:e}),this.props.onTimestampChange(e)},this.handleThemeChange=e=>{let t=e.get("primary"),n=e.getText("primary"),s=n.darken(.5).desaturate(1),i=t.darken(.15),r=i.darken(.1),a=e.get("secondary"),o=e.get("accent");this.setState({canvasColors:{background_plain:[t.hex(),t.rgbNumber()],background:[i.hex(),i.rgbNumber()],background_10:[r.hex(),r.rgbNumber()],secondary:[a.hex(),a.rgbNumber()],lineColor:[n.hex(),n.rgbNumber()],lineColor_10:[s.hex(),s.rgbNumber()],accent:[o.hex(),o.rgbNumber()]}},this.generateCache)},this.state={canvasColors:{background_plain:["#000000",0],background:["#000000",0],background_10:["#000000",0],secondary:["#ffffff",16777215],lineColor:["#ffffff",16777215],lineColor_10:["#ffffff",16777215],accent:["#ffffff",16777215]},timestamp:0,sizes:{el:{...L.n},rawWidth:0,rawHeight:0,width:0,height:0,snapPointWidth:0,keyHeight:0,keyWidth:0,timelineSize:0,scaling:0},draggedHitObject:null,isPressing:!1,totalMovement:0,previousPosition:0,preventClick:!1,cache:null},this.wrapperRef=(0,i.createRef)(),this.stageRef=(0,i.createRef)()}}var eO=n(80219),eP=n(74646),e_=n(21249),ez=n(23935),eM=n(12120),eR=n(78581),eA=n(23441),eI=n(47103),eL=n(11163);class eF extends i.Component{componentDidMount(){let e=eO.j.getVsrgComposerSettings();this.setState({settings:e}),this.state.audioPlayer.setBasePitch(e.pitch.value),this.state.audioPlaybackPlayer.setBasePitch(e.pitch.value),this.mounted=!0;let t="vsrg-composer";this.calculateSnapPoints(),this.syncInstruments(),this.unblock=e=>{if(0!==this.changes)throw this.changePage(e),this.props.router.events.emit("routeChangeError"),"routeChange aborted.";this.props.router.events.off("routeChangeStart",this.unblock),this.props.router.push((0,eg.k8)(e))},this.props.router.events.on("routeChangeStart",this.unblock);let n=(0,H.JZ)("vsrg_composer","vsrg_composer",this.handleShortcut);this.cleanup.push(n),e_.w.listen(this.handleKeyboardDown,{id:t,type:"keydown"}),e_.w.listen(this.handleKeyboardUp,{id:t,type:"keyup"})}componentWillUnmount(){this.mounted=!1,e_.w.unregisterById("vsrg-composer"),this.props.router.events.off("routeChangeStart",this.unblock);let{audioPlaybackPlayer:e,audioPlayer:t}=this.state;e.destroy(),t.destroy(),this.cleanup.forEach(e=>e())}render(){var e;let{settings:t,selectedTrack:n,vsrg:i,lastCreatedHitObject:r,snapPoints:a,isPlaying:o,snapPoint:l,selectedHitObject:c,selectedType:h,audioSong:u,scaling:d,renderableNotes:m,tempoChanger:g}=this.state;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(eA.d,{text:"Vsrg Composer - ".concat(null!==(e=i.name)&&void 0!==e?e:"Unnamed"),description:"Create new VSRG songs using existing background songs and create your own beatmap for it."}),(0,s.jsx)(D,{trackModifiers:i.trackModifiers,hasChanges:this.changes>0,settings:t,audioSong:u,onTrackModifierChange:this.onTrackModifierChange,onSongOpen:this.onSongOpen,onSave:this.saveSong,onCreateSong:this.createNewSong,setAudioSong:this.setAudioSong,handleSettingChange:this.handleSettingChange}),(0,s.jsxs)("div",{className:"vsrg-page appear-on-mount",children:[(0,s.jsx)(ei,{vsrg:i,onBreakpointSelect:this.onBreakpointSelect,onBreakpointChange:this.onBreakpointChange,selectedHitObject:c,isHorizontal:!t.isVertical.value,selectedTrack:n,lastCreatedHitObject:r,onTrackAdd:this.addTrack,onTrackChange:this.onTrackChange,onTrackDelete:this.deleteTrack,onTrackSelect:this.selectTrack,onNoteSelect:this.onNoteSelect,children:(0,s.jsx)(eE,{vsrg:i,renderableNotes:m,onTimestampChange:this.onTimestampChange,selectedHitObject:c,isHorizontal:!t.isVertical.value,tempoChanger:g,scrollSnap:t.scrollSnap.value,maxFps:t.maxFps.value,scaling:d,audioSong:u,snapPoint:l,snapPoints:a,isPlaying:o,onRemoveTime:this.removeTime,onAddTime:this.addTime,onKeyDown:this.startHitObjectTap,onKeyUp:this.endHitObjectTap,dragHitObject:this.dragHitObject,releaseHitObject:this.releaseHitObject,selectHitObject:this.selectHitObject,onSnapPointSelect:this.onSnapPointSelect})}),(0,s.jsx)(U,{vsrg:i,scaling:d,tempoChanger:g,onTempoChangerChange:this.onTempoChangerChange,onScalingChange:this.onScalingChange,isPlaying:o,togglePlay:this.togglePlay,selectedSnapPoint:l,onSnapPointChange:this.onSnapPointChange,selectedHitObjectType:h,onHitObjectTypeChange:this.selectType})]})]})}constructor(e){super(e),this.lastTimestamp=0,this.changes=0,this.playbackTimestamp=0,this.mounted=!1,this.heldKeys=[],this.pressedDownHitObjects=[],this.unblock=()=>{},this.cleanup=[],this.addTrack=()=>{let{vsrg:e}=this.state;e.addTrack(),this.setState({vsrg:e},()=>en.emitEvent("tracksChange"))},this.handleShortcut=e=>{let{shortcut:t,event:n}=e,{name:s}=t;if("Space"===n.code){if(n.repeat&&"toggle_play"===s)return;if((0,eg.EB)(document.activeElement)){var i;null===(i=document.activeElement)||void 0===i||i.blur()}}let{vsrg:r,selectedTrack:a,selectedHitObject:o,snapPointDuration:l,settings:c}=this.state;if("set_tap_hand"===s&&this.setState({selectedType:"tap"}),"set_hold_hand"===s&&this.setState({selectedType:"hold"}),"set_delete_hand"===s&&this.setState({selectedType:"delete"}),"deselect"===s&&this.setState({selectedHitObject:null,lastCreatedHitObject:null}),"toggle_play"===s&&this.togglePlay(),"next_breakpoint"===s&&this.onBreakpointSelect(1),"previous_breakpoint"===s&&this.onBreakpointSelect(-1),"next_track"===s&&this.selectTrack(Math.min(this.state.vsrg.tracks.length-1,this.state.selectedTrack+1)),"previous_track"===s&&this.selectTrack(Math.max(0,this.state.selectedTrack-1)),"delete"===s){if(!o)return;r.removeHitObjectInTrackAtTimestamp(a,o.timestamp,o.index),this.setState({selectedHitObject:null,lastCreatedHitObject:null})}if("move_right"===s){if(!o)return;c.isVertical.value?o.index=(0,eg.uZ)(o.index+1,0,r.keys):o.timestamp=o.timestamp+l,this.releaseHitObject()}if("move_down"===s){if(!o)return;c.isVertical.value?o.timestamp=o.timestamp-l:o.index=(0,eg.uZ)(o.index+1,0,r.keys),this.releaseHitObject()}if("move_left"===s){if(!o)return;c.isVertical.value?o.index=(0,eg.uZ)(o.index-1,0,r.keys):o.timestamp=o.timestamp-l,this.releaseHitObject()}if("move_up"===s){if(!o)return;c.isVertical.value?o.timestamp=o.timestamp+l:o.index=(0,eg.uZ)(o.index-1,0,r.keys),this.releaseHitObject()}},this.updateSettings=e=>{eO.j.updateVsrgComposerSettings(void 0!==e?e:this.state.settings)},this.syncInstruments=()=>{let{vsrg:e,audioPlayer:t}=this.state;t.syncInstruments(e.tracks.map(e=>e.instrument))},this.syncAudioSongInstruments=()=>{let{audioSong:e,audioPlaybackPlayer:t}=this.state;null!==e&&(t.syncInstruments(e.instruments),t.basePitch=e.pitch)},this.handleKeyboardDown=e=>{var t;let{event:n,letter:s,shift:i}=e,{vsrg:r}=this.state;if(i)return;let a=null===(t=L.CB[r.keys])||void 0===t?void 0:t.indexOf(s);if(a>=0){if(n.repeat)return;this.startHitObjectTap(a)}},this.handleKeyboardUp=e=>{var t;let{letter:n}=e,{vsrg:s}=this.state,i=null===(t=L.CB[s.keys])||void 0===t?void 0:t.indexOf(n);i>=0&&this.endHitObjectTap(i)},this.startHitObjectTap=e=>{let{vsrg:t,selectedTrack:n,selectedType:s}=this.state;this.heldKeys[e]=!0,this.changes++;let i=this.findClosestSnapPoint(this.lastTimestamp);if("delete"===s)return t.removeHitObjectInTrackAtTimestamp(n,i,e),this.setState({vsrg:t,selectedHitObject:null});let r=t.createHitObjectInTrack(n,i,e);this.pressedDownHitObjects[e]=r,this.setState({vsrg:t,selectedHitObject:r})},this.endHitObjectTap=e=>{let{vsrg:t,selectedTrack:n}=this.state,s=this.pressedDownHitObjects[e];if(this.heldKeys[e]&&s){let e=this.findClosestSnapPoint(s.timestamp+s.holdDuration);t.setHeldHitObjectTail(n,s,e-s.timestamp)}this.heldKeys[e]=!1,this.pressedDownHitObjects[e]=void 0},this.handleSettingChange=e=>{let{settings:t,vsrg:n}=this.state,{data:s}=e;t[e.key]={...t[e.key],value:s.value},"keys"===e.key&&n.changeKeys(s.value),"bpm"===e.key&&(n.set({bpm:s.value}),this.calculateSnapPoints()),"difficulty"===e.key&&n.set({difficulty:s.value}),this.setState({settings:{...t}},()=>{this.updateSettings(),"keys"===e.key&&en.emitEvent("updateKeys"),"isVertical"===e.key&&en.emitEvent("updateOrientation"),"maxFps"===e.key&&en.emitEvent("maxFpsChange")})},this.changePage=async e=>{let{vsrg:t,settings:n}=this.state;if("Home"===e)return w.I.open();if(0!==this.changes){if(n.autosave.value)await this.saveSong();else{let e=await (0,u.jH)('You have unsaved changes to the song: "'.concat(t.name,'" do you want to save? UNSAVED CHANGES WILL BE LOST'),!1);if(null===e||e&&await this.saveSong()===null)return}}this.props.router.events.off("routeChangeStart",this.unblock),this.props.router.push((0,eg.k8)(e))},this.onSnapPointChange=e=>{let{vsrg:t}=this.state;t.set({snapPoint:e}),this.setState({snapPoint:e,vsrg:t},()=>{this.calculateSnapPoints(),en.emitEvent("snapPointChange")})},this.selectHitObject=(e,t,n)=>{let s=e.isHeld?"hold":"tap";if("delete"===this.state.selectedType||n===eR.u.Right){this.state.vsrg.removeHitObjectInTrack(t,e),this.setState({selectedHitObject:null,vsrg:this.state.vsrg});return}"hold"===this.state.selectedType&&n===eR.u.Left&&this.setState({selectedHitObject:e,lastCreatedHitObject:e,selectedType:s}),this.setState({selectedHitObject:e,selectedTrack:t,selectedType:s})},this.onSnapPointSelect=(e,t,n)=>{let{vsrg:s,selectedType:i,lastCreatedHitObject:r,selectedTrack:a,selectedHitObject:o}=this.state;if(this.changes++,e<0)return console.warn("Timestamp is less than 0");let l=s.getHitObjectsAt(e,t).find(e=>null!==e);if(n===eR.u.Unknown&&console.warn("unknown click type"),"tap"===i&&n===eR.u.Left){if(l)return this.setState({selectedHitObject:l});let n=s.createHitObjectInTrack(a,e,t);this.playHitObject(n,a),this.setState({selectedHitObject:n})}if("hold"===i&&n===eR.u.Left){if(null!==r)s.setHeldHitObjectTail(a,r,e-r.timestamp),this.setState({lastCreatedHitObject:null,selectedHitObject:null});else{if(l)return this.setState({selectedHitObject:l});let n=s.createHeldHitObject(a,e,t);this.setState({lastCreatedHitObject:n,selectedHitObject:n})}}("delete"===i||n===eR.u.Right)&&(s.removeHitObjectInTrackAtTimestamp(a,e,t),this.setState({selectedHitObject:null})),this.setState({vsrg:s})},this.selectTrack=e=>{this.setState({selectedTrack:e})},this.setAudioSong=e=>{let{vsrg:t}=this.state;if(this.changes++,null===e)return t.setAudioSong(null),this.setState({audioSong:null,renderableNotes:[]});let n=j.v.parseSong(e);if(n instanceof ez.M){t.setAudioSong(n),n.startPlayback(this.lastTimestamp),t.setDurationFromNotes(n.notes);let e=t.getRenderableNotes(n);this.setState({audioSong:n,renderableNotes:e},()=>{this.syncAudioSongInstruments(),this.calculateSnapPoints()})}if(n instanceof eM.l){let e=n.toRecordedSong(0);t.setDurationFromNotes(e.notes),e.startPlayback(this.lastTimestamp),t.setAudioSong(n);let s=t.getRenderableNotes(e);this.setState({audioSong:e,renderableNotes:s},()=>{this.syncAudioSongInstruments(),this.calculateSnapPoints()})}},this.askForSongUpdate=async()=>await (0,u.jH)('You have unsaved changes to the song: "'.concat(this.state.vsrg.name,'" do you want to save now?'),!1),this.createNewSong=async()=>{if("Untitled"!==this.state.vsrg.name&&this.changes>0){let e=await this.askForSongUpdate();if(null===e)return;e&&await this.saveSong()}let e=await (0,u.cJ)("Enter song name");if(e){let t=new ea.Cz(e);t.set({bpm:this.state.settings.bpm.value,keys:this.state.settings.keys.value,pitch:this.state.settings.pitch.value,snapPoint:this.state.snapPoint}),t.addTrack();let n=await S.k.addSong(t);t.set({id:n}),this.setState({vsrg:t,renderableNotes:[]},()=>{en.emitEvent("songLoad"),this.calculateSnapPoints(),this.syncInstruments()})}},this.calculateSnapPoints=()=>{let{vsrg:e,snapPoint:t}=this.state,n=e.duration/Math.floor(6e4/e.bpm)*t,s=e.duration/n,i=Array(Math.floor(n)).fill(0).map((e,t)=>t*s);this.setState({snapPoints:i,snapPointDuration:s})},this.dragHitObject=(e,t)=>{let{selectedHitObject:n,vsrg:s,settings:i}=this.state;null!==n&&(n.timestamp=e,void 0!==t&&t<i.keys.value&&(n.index=t),this.setState({vsrg:s,selectedHitObject:n}))},this.findClosestSnapPoint=e=>{let{snapPoints:t}=this.state;return t.reduce((t,n)=>Math.abs(n-e)<Math.abs(t-e)?n:t)},this.releaseHitObject=()=>{let{selectedHitObject:e,vsrg:t}=this.state;null!==e&&(e.timestamp=this.findClosestSnapPoint(e.timestamp),t.getHitObjectsBetween(e.timestamp,e.timestamp+e.holdDuration,e.index).forEach((n,s)=>n.forEach(n=>n!==e&&t.removeHitObjectInTrackAtTimestamp(s,n.timestamp,n.index))),this.changes++,this.setState({vsrg:t}))},this.onTrackChange=(e,t)=>{let{vsrg:n}=this.state;n.tracks[t]=e,this.setState({vsrg:n},this.syncInstruments)},this.onNoteSelect=e=>{let{selectedHitObject:t,audioPlayer:n,selectedTrack:s}=this.state;null==t||t.toggleNote(e),n.playNoteOfInstrument(s,e),this.setState({selectedHitObject:t})},this.togglePlay=()=>{let{isPlaying:e,vsrg:t,audioSong:n}=this.state;if(t.startPlayback(this.lastTimestamp),this.lastTimestamp>=t.duration)return this.setState({isPlaying:!1});n&&n.startPlayback(this.lastTimestamp),this.setState({isPlaying:!e})},this.playHitObject=(e,t)=>{let{audioPlayer:n}=this.state;n.playNotesOfInstrument(t,e.notes)},this.onTimestampChange=e=>{let{vsrg:t,isPlaying:n,audioSong:s,audioPlaybackPlayer:i,snapPointDuration:r}=this.state;if(this.lastTimestamp=e,n){if(this.lastTimestamp>=t.duration)return this.setState({isPlaying:!1});this.heldKeys.forEach((t,n)=>{if(t){let t=this.pressedDownHitObjects[n];if(!t)return;let s=e-t.timestamp;s>r&&(t.holdDuration=s,t.isHeld=!0)}}),s&&s.tickPlayback(e).forEach(e=>{e.layer.toArray().forEach((n,s)=>{0===n||t.trackModifiers[s].muted||i.playNoteOfInstrument(s,e.index)})}),t.tickPlayback(e).forEach((e,t)=>e.forEach(e=>this.playHitObject(e,t)))}},this.deleteTrack=async e=>{let{vsrg:t}=this.state;if(1===t.tracks.length)return R.kg.error("Cannot delete last track");await (0,u.jH)("Are you sure you want to remove this track? All notes will be deleted.")&&this.mounted&&(this.changes++,t.deleteTrack(e),this.setState({vsrg:t,selectedTrack:Math.max(0,e-1)},()=>en.emitEvent("tracksChange")))},this.onSongOpen=async e=>{let{settings:t,vsrg:n}=this.state;if(0!==this.changes){let e=t.autosave.value&&"Untitled"!==n.name;if(!e){let t=await (0,u.jH)('You have unsaved changes to the song: "'.concat(n.name,'" do you want to save? UNSAVED CHANGES WILL BE LOST'),!1);if(null===t)return;e=t}if(e&&await this.saveSong()===null)return}t.bpm={...t.bpm,value:e.bpm},t.keys={...t.keys,value:e.keys},t.pitch={...t.pitch,value:e.pitch},this.updateSettings(),this.changes++,this.setState({vsrg:e,snapPoint:e.snapPoint,selectedTrack:0,selectedHitObject:null,lastCreatedHitObject:null},async()=>{en.emitEvent("songLoad"),this.syncInstruments();let t=await S.k.getSongById(e.audioSongId);this.setAudioSong(t),this.calculateSnapPoints()})},this.addTime=()=>{let{vsrg:e}=this.state;e.duration+=1e3,this.calculateSnapPoints(),this.changes++,this.setState({vsrg:e})},this.removeTime=()=>{let{vsrg:e}=this.state;e.duration-=1e3,this.calculateSnapPoints(),this.changes++,this.setState({vsrg:e})},this.onScalingChange=e=>{this.setState({scaling:e},()=>en.emitEvent("scaleChange"))},this.saveSong=async()=>{let{vsrg:e}=this.state,t=null!==e.id?e.name:await (0,u.cJ)("Enter song name");if(null===t)return null;if(e.set({name:t}),null===e.id){let t=await S.k.addSong(e);e.set({id:t})}else S.k.updateSong(e);return this.changes=0,this.setState({vsrg:e}),e},this.onTrackModifierChange=(e,t,n)=>{let{vsrg:s,audioSong:i}=this.state;if(s.trackModifiers[t]=e,s.trackModifiers=[...s.trackModifiers],this.changes++,n&&i){let e=s.getRenderableNotes(i);return this.setState({renderableNotes:e,vsrg:s})}this.setState({vsrg:s})},this.onTempoChangerChange=e=>{this.setState({tempoChanger:e})},this.selectType=e=>{this.setState({selectedType:e,lastCreatedHitObject:null})},this.onBreakpointChange=e=>{let{vsrg:t}=this.state,n=this.findClosestSnapPoint(this.lastTimestamp);t.setBreakpoint(n,!e),this.setState({vsrg:t})},this.onBreakpointSelect=e=>{let{vsrg:t,isPlaying:n,audioSong:s}=this.state,i=t.getClosestBreakpoint(this.lastTimestamp,e);n&&(null==s||s.startPlayback(i),t.startPlayback(i)),en.emitEvent("timestampChange",i)};let t=eO.j.getDefaultVsrgComposerSettings();this.state={vsrg:new ea.Cz("Untitled"),audioPlayer:new eP.z(t.pitch.value),audioPlaybackPlayer:new eP.z(t.pitch.value),selectedTrack:0,snapPoint:1,snapPoints:[0],snapPointDuration:0,selectedHitObject:null,scaling:60,selectedType:"tap",isPlaying:!1,lastCreatedHitObject:null,settings:t,audioSong:null,renderableNotes:[],tempoChanger:1},this.state.vsrg.addTrack("DunDun"),this.state.vsrg.set({bpm:t.bpm.value,keys:t.keys.value}),this.mounted=!1}}function eD(){let e=(0,eL.useRouter)();return(0,s.jsx)(eF,{router:e})}eD.getLayout=function(e){return(0,s.jsx)(eI.Z,{page:"Composer",children:e})}},20557:function(e){e.exports={"help-icon":"HelpTab_help-icon__LZT3K","help-icon-wrapper":"HelpTab_help-icon-wrapper__765O_","help-title":"HelpTab_help-title__B5SPa","help-margin-left":"HelpTab_help-margin-left__5ibwm","help-img":"HelpTab_help-img__kRbW_","keys-table":"HelpTab_keys-table__JU_J5"}},55651:function(e,t,n){"use strict";n.d(t,{L_:function(){return B},ZE:function(){return X},gW:function(){return I}});var s=n(67294);function i(){return(i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e}).apply(this,arguments)}function r(e,t){if(null==e)return{};var n,s,i={},r=Object.keys(e);for(s=0;s<r.length;s++)t.indexOf(n=r[s])>=0||(i[n]=e[n]);return i}function a(e){var t=(0,s.useRef)(e),n=(0,s.useRef)(function(e){t.current&&t.current(e)});return t.current=e,n.current}var o=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=1),e>n?n:e<t?t:e},l=function(e){return"touches"in e},c=function(e){return e&&e.ownerDocument.defaultView||self},h=function(e,t,n){var s=e.getBoundingClientRect(),i=l(t)?function(e,t){for(var n=0;n<e.length;n++)if(e[n].identifier===t)return e[n];return e[0]}(t.touches,n):t;return{left:o((i.pageX-(s.left+c(e).pageXOffset))/s.width),top:o((i.pageY-(s.top+c(e).pageYOffset))/s.height)}},u=function(e){l(e)||e.preventDefault()},d=s.memo(function(e){var t=e.onMove,n=e.onKey,o=r(e,["onMove","onKey"]),d=(0,s.useRef)(null),m=a(t),g=a(n),p=(0,s.useRef)(null),f=(0,s.useRef)(!1),v=(0,s.useMemo)(function(){var e=function(e){u(e),(l(e)?e.touches.length>0:e.buttons>0)&&d.current?m(h(d.current,e,p.current)):n(!1)},t=function(){return n(!1)};function n(n){var s=f.current,i=c(d.current),r=n?i.addEventListener:i.removeEventListener;r(s?"touchmove":"mousemove",e),r(s?"touchend":"mouseup",t)}return[function(e){var t=e.nativeEvent,s=d.current;if(s&&(u(t),(!f.current||l(t))&&s)){if(l(t)){f.current=!0;var i=t.changedTouches||[];i.length&&(p.current=i[0].identifier)}s.focus(),m(h(s,t,p.current)),n(!0)}},function(e){var t=e.which||e.keyCode;t<37||t>40||(e.preventDefault(),g({left:39===t?.05:37===t?-.05:0,top:40===t?.05:38===t?-.05:0}))},n]},[g,m]),x=v[0],b=v[1],y=v[2];return(0,s.useEffect)(function(){return y},[y]),s.createElement("div",i({},o,{onTouchStart:x,onMouseDown:x,className:"react-colorful__interactive",ref:d,onKeyDown:b,tabIndex:0,role:"slider"}))}),m=function(e){return e.filter(Boolean).join(" ")},g=function(e){var t=e.color,n=e.left,i=e.top,r=m(["react-colorful__pointer",e.className]);return s.createElement("div",{className:r,style:{top:100*(void 0===i?.5:i)+"%",left:100*n+"%"}},s.createElement("div",{className:"react-colorful__pointer-fill",style:{backgroundColor:t}}))},p=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=Math.pow(10,t)),Math.round(n*e)/n},f=function(e){return C(v(e))},v=function(e){return"#"===e[0]&&(e=e.substring(1)),e.length<6?{r:parseInt(e[0]+e[0],16),g:parseInt(e[1]+e[1],16),b:parseInt(e[2]+e[2],16),a:4===e.length?p(parseInt(e[3]+e[3],16)/255,2):1}:{r:parseInt(e.substring(0,2),16),g:parseInt(e.substring(2,4),16),b:parseInt(e.substring(4,6),16),a:8===e.length?p(parseInt(e.substring(6,8),16)/255,2):1}},x=function(e){return S(k(e))},b=function(e){var t=e.s,n=e.v,s=e.a,i=(200-t)*n/100;return{h:p(e.h),s:p(i>0&&i<200?t*n/100/(i<=100?i:200-i)*100:0),l:p(i/2),a:p(s,2)}},y=function(e){var t=b(e);return"hsl("+t.h+", "+t.s+"%, "+t.l+"%)"},j=function(e){var t=b(e);return"hsla("+t.h+", "+t.s+"%, "+t.l+"%, "+t.a+")"},k=function(e){var t=e.h,n=e.s,s=e.v,i=e.a;t=t/360*6,n/=100,s/=100;var r=Math.floor(t),a=s*(1-n),o=s*(1-(t-r)*n),l=s*(1-(1-t+r)*n),c=r%6;return{r:p(255*[s,o,a,a,l,s][c]),g:p(255*[l,s,s,o,a,a][c]),b:p(255*[a,a,l,s,s,o][c]),a:p(i,2)}},w=function(e){var t=e.toString(16);return t.length<2?"0"+t:t},S=function(e){var t=e.r,n=e.g,s=e.b,i=e.a,r=i<1?w(p(255*i)):"";return"#"+w(t)+w(n)+w(s)+r},C=function(e){var t=e.r,n=e.g,s=e.b,i=e.a,r=Math.max(t,n,s),a=r-Math.min(t,n,s),o=a?r===t?(n-s)/a:r===n?2+(s-t)/a:4+(t-n)/a:0;return{h:p(60*(o<0?o+6:o)),s:p(r?a/r*100:0),v:p(r/255*100),a:i}},T=s.memo(function(e){var t=e.hue,n=e.onChange,i=m(["react-colorful__hue",e.className]);return s.createElement("div",{className:i},s.createElement(d,{onMove:function(e){n({h:360*e.left})},onKey:function(e){n({h:o(t+360*e.left,0,360)})},"aria-label":"Hue","aria-valuenow":p(t),"aria-valuemax":"360","aria-valuemin":"0"},s.createElement(g,{className:"react-colorful__hue-pointer",left:t/360,color:y({h:t,s:100,v:100,a:1})})))}),H=s.memo(function(e){var t=e.hsva,n=e.onChange,i={backgroundColor:y({h:t.h,s:100,v:100,a:1})};return s.createElement("div",{className:"react-colorful__saturation",style:i},s.createElement(d,{onMove:function(e){n({s:100*e.left,v:100-100*e.top})},onKey:function(e){n({s:o(t.s+100*e.left,0,100),v:o(t.v-100*e.top,0,100)})},"aria-label":"Color","aria-valuetext":"Saturation "+p(t.s)+"%, Brightness "+p(t.v)+"%"},s.createElement(g,{className:"react-colorful__saturation-pointer",top:1-t.v/100,left:t.s/100,color:y(t)})))}),N=function(e,t){if(e===t)return!0;for(var n in e)if(e[n]!==t[n])return!1;return!0},E=function(e,t){return e.toLowerCase()===t.toLowerCase()||N(v(e),v(t))};function O(e,t,n){var i=a(n),r=(0,s.useState)(function(){return e.toHsva(t)}),o=r[0],l=r[1],c=(0,s.useRef)({color:t,hsva:o});return(0,s.useEffect)(function(){if(!e.equal(t,c.current.color)){var n=e.toHsva(t);c.current={hsva:n,color:t},l(n)}},[t,e]),(0,s.useEffect)(function(){var t;N(o,c.current.hsva)||e.equal(t=e.fromHsva(o),c.current.color)||(c.current={hsva:o,color:t},i(t))},[o,e,i]),[o,(0,s.useCallback)(function(e){l(function(t){return Object.assign({},t,e)})},[])]}var P,_="undefined"!=typeof window?s.useLayoutEffect:s.useEffect,z=new Map,M=function(e){_(function(){var t=e.current?e.current.ownerDocument:document;if(void 0!==t&&!z.has(t)){var s=t.createElement("style");s.innerHTML='.react-colorful{position:relative;display:flex;flex-direction:column;width:200px;height:200px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:default}.react-colorful__saturation{position:relative;flex-grow:1;border-color:transparent;border-bottom:12px solid #000;border-radius:8px 8px 0 0;background-image:linear-gradient(0deg,#000,transparent),linear-gradient(90deg,#fff,hsla(0,0%,100%,0))}.react-colorful__alpha-gradient,.react-colorful__pointer-fill{content:"";position:absolute;left:0;top:0;right:0;bottom:0;pointer-events:none;border-radius:inherit}.react-colorful__alpha-gradient,.react-colorful__saturation{box-shadow:inset 0 0 0 1px rgba(0,0,0,.05)}.react-colorful__alpha,.react-colorful__hue{position:relative;height:24px}.react-colorful__hue{background:linear-gradient(90deg,red 0,#ff0 17%,#0f0 33%,#0ff 50%,#00f 67%,#f0f 83%,red)}.react-colorful__last-control{border-radius:0 0 8px 8px}.react-colorful__interactive{position:absolute;left:0;top:0;right:0;bottom:0;border-radius:inherit;outline:none;touch-action:none}.react-colorful__pointer{position:absolute;z-index:1;box-sizing:border-box;width:28px;height:28px;transform:translate(-50%,-50%);background-color:#fff;border:2px solid #fff;border-radius:50%;box-shadow:0 2px 4px rgba(0,0,0,.2)}.react-colorful__interactive:focus .react-colorful__pointer{transform:translate(-50%,-50%) scale(1.1)}.react-colorful__alpha,.react-colorful__alpha-pointer{background-color:#fff;background-image:url(\'data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill-opacity=".05"><path d="M8 0h8v8H8zM0 8h8v8H0z"/></svg>\')}.react-colorful__saturation-pointer{z-index:3}.react-colorful__hue-pointer{z-index:2}',z.set(t,s);var i=P||n.nc;i&&s.setAttribute("nonce",i),t.head.appendChild(s)}},[])},R=function(e){var t=e.className,n=e.colorModel,a=e.color,o=void 0===a?n.defaultColor:a,l=e.onChange,c=r(e,["className","colorModel","color","onChange"]),h=(0,s.useRef)(null);M(h);var u=O(n,o,l),d=u[0],g=u[1],p=m(["react-colorful",t]);return s.createElement("div",i({},c,{ref:h,className:p}),s.createElement(H,{hsva:d,onChange:g}),s.createElement(T,{hue:d.h,onChange:g,className:"react-colorful__last-control"}))},A={defaultColor:"000",toHsva:f,fromHsva:function(e){return x({h:e.h,s:e.s,v:e.v,a:1})},equal:E},I=function(e){return s.createElement(R,i({},e,{colorModel:A}))},L=function(e){var t=e.className,n=e.hsva,i=e.onChange,r={backgroundImage:"linear-gradient(90deg, "+j(Object.assign({},n,{a:0}))+", "+j(Object.assign({},n,{a:1}))+")"},a=m(["react-colorful__alpha",t]),l=p(100*n.a);return s.createElement("div",{className:a},s.createElement("div",{className:"react-colorful__alpha-gradient",style:r}),s.createElement(d,{onMove:function(e){i({a:e.left})},onKey:function(e){i({a:o(n.a+e.left)})},"aria-label":"Alpha","aria-valuetext":l+"%","aria-valuenow":l,"aria-valuemin":"0","aria-valuemax":"100"},s.createElement(g,{className:"react-colorful__alpha-pointer",left:n.a,color:j(n)})))},F=function(e){var t=e.className,n=e.colorModel,a=e.color,o=void 0===a?n.defaultColor:a,l=e.onChange,c=r(e,["className","colorModel","color","onChange"]),h=(0,s.useRef)(null);M(h);var u=O(n,o,l),d=u[0],g=u[1],p=m(["react-colorful",t]);return s.createElement("div",i({},c,{ref:h,className:p}),s.createElement(H,{hsva:d,onChange:g}),s.createElement(T,{hue:d.h,onChange:g}),s.createElement(L,{hsva:d,onChange:g,className:"react-colorful__last-control"}))},D={defaultColor:"0001",toHsva:f,fromHsva:x,equal:E},B=function(e){return s.createElement(F,i({},e,{colorModel:D}))},W=/^#?([0-9A-F]{3,8})$/i,K=function(e){var t=e.color,n=void 0===t?"":t,o=e.onChange,l=e.onBlur,c=e.escape,h=e.validate,u=e.format,d=e.process,m=r(e,["color","onChange","onBlur","escape","validate","format","process"]),g=(0,s.useState)(function(){return c(n)}),p=g[0],f=g[1],v=a(o),x=a(l),b=(0,s.useCallback)(function(e){var t=c(e.target.value);f(t),h(t)&&v(d?d(t):t)},[c,d,h,v]),y=(0,s.useCallback)(function(e){h(e.target.value)||f(c(n)),x(e)},[n,c,h,x]);return(0,s.useEffect)(function(){f(c(n))},[n,c]),s.createElement("input",i({},m,{value:u?u(p):p,spellCheck:"false",onChange:b,onBlur:y}))},J=function(e){return"#"+e},X=function(e){var t=e.prefixed,n=e.alpha,a=r(e,["prefixed","alpha"]),o=(0,s.useCallback)(function(e){return e.replace(/([^0-9A-F]+)/gi,"").substring(0,n?8:6)},[n]),l=(0,s.useCallback)(function(e){var t,s;return 3===(s=(t=W.exec(e))?t[1].length:0)||6===s||!!n&&4===s||!!n&&8===s},[n]);return s.createElement(K,i({},a,{escape:o,format:t?J:void 0,process:J,validate:l}))}}},function(e){e.O(0,[9569,584,5062,2888,9774,179],function(){return e(e.s=40120)}),_N_E=e.O()}]);