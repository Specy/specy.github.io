(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3358],{21880:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/keybinds",function(){return s(97510)}])},40208:function(e,t,s){"use strict";s.d(t,{h:function(){return n}});var r=s(85893),i=s(48043);function n(e){var t,s,n,a,o;return(0,r.jsx)(i.J,{...e,style:{width:null!==(t=e.size)&&void 0!==t?t:"2rem",height:null!==(s=e.size)&&void 0!==s?s:"2rem",minWidth:null!==(n=e.size)&&void 0!==n?n:"2rem",minHeight:null!==(a=e.size)&&void 0!==a?a:"2rem",...e.style},className:"icon-app-button flex-centered ".concat(null!==(o=e.className)&&void 0!==o?o:""),children:e.children})}},95616:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});var r=s(85893),i=s(21558),n=s.n(i);function a(e){let{background:t="var(--primary)",color:s="var(--primary-text)",height:i="0.3rem",style:a,className:o,children:c,pillBackground:d,verticalMargin:l="0.2rem",shadow:u=!1}=e,h="string"==typeof u?u:"shadow";return(0,r.jsxs)("div",{className:"".concat(n().separator," ").concat(o),style:{color:s,margin:"".concat(l," 0"),...a},children:[(0,r.jsx)("div",{className:n()["separator-part"],style:{backgroundColor:t,height:i,boxShadow:u?"0 0rem 0.6rem ".concat(h):void 0,borderTopLeftRadius:"0.6rem",borderBottomLeftRadius:"0.6rem"}}),c&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"".concat(n()["separator-content"]),style:{backgroundColor:d,boxShadow:u?"0 0rem 0.6rem ".concat(h):void 0,color:s,border:"solid 0.2rem ".concat(s)},children:c}),(0,r.jsx)("div",{className:n()["separator-part"],style:{height:i,backgroundColor:"var(--".concat(s,")"),boxShadow:u?"0 0rem 0.6rem ".concat(h):void 0,borderTopRightRadius:"0.6rem",borderBottomRightRadius:"0.6rem"}})]})]})}},74646:function(e,t,s){"use strict";s.d(t,{z:function(){return n}});var r=s(83679),i=s(92761);class n{setBasePitch(e){this.basePitch=e}destroy(){this.audioInstruments.forEach(e=>{i.n.disconnect(e.endNode),e.dispose()})}syncInstruments(e){return this.instruments=e,this.loadInstruments()}async loadInstruments(){let{instruments:e,audioInstruments:t}=this;return t.splice(e.length).forEach(e=>{i.n.disconnect(e.endNode),e.dispose()}),Promise.all(e.map(async(e,s)=>{if(void 0===t[s]){let n=new r.Yx(e.name);return t[s]=n,await n.load(i.n.getAudioContext()),i.n.connect(n.endNode,e.reverbOverride),n.changeVolume(e.volume),n}if(t[s].name===e.name)return t[s].changeVolume(e.volume),i.n.setReverbOfNode(t[s].endNode,e.reverbOverride),t[s];{let n=t[s];i.n.disconnect(n.endNode),n.dispose();let a=new r.Yx(e.name);return t[s]=a,await a.load(i.n.getAudioContext()),i.n.connect(a.endNode,e.reverbOverride),a.changeVolume(e.volume),a}}))}playNoteOfInstrument(e,t,s){let r=this.instruments[e];this.audioInstruments[e].play(t,null!=s?s:r.pitch||this.basePitch)}playNotesOfInstrument(e,t,s){t.forEach(t=>this.playNoteOfInstrument(e,t,s))}constructor(e){this.instruments=[],this.audioInstruments=[],this.basePitch="C",this.basePitch=e}}},97510:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return J}});var r=s(85893),i=s(17544),n=s(2816),a=s(67274),o=s(68949),c=s(67294),d=s(54233),l=s(79317),u=s(39324);function h(e){var t;let s,{data:n,noteText:h="A",handleClick:y,noteImage:g,clickClass:_="",noteClass:x="",noteRef:k}=e,[v,f]=(0,c.useState)(p());(0,c.useEffect)(()=>(0,o.N7)(d.f6.state.data,()=>{f(p())}),[]);let b=(t=n.status,s=i.Al.note,"clicked"===t&&(s+=" click-event ".concat(_)),s+" ".concat(x));return(0,r.jsx)("button",{onPointerDown:e=>{(0,u.PF)(e),y(n)},onContextMenu:u.PF,className:"button-hitbox-bigger",children:(0,r.jsxs)("div",{ref:k,className:b,style:{borderColor:m(n.status)},children:["Genshin"===i.iC&&(0,r.jsx)(a.Z,{className:"genshin-border",fill:m(n.status)}),g&&(0,r.jsx)(l.Z,{name:g,background:"clicked"===n.status?"var(--accent)":"var(--note-background)"}),(0,r.jsx)("div",{className:i.Al.noteName,style:{color:v},children:h})]})})}function m(e){return"clicked"===e?"transparent":"wrong"===e?"#d66969":"right"===e?"#358a55":"Genshin"===i.iC?"#eae5ce":"unset"}function p(){let e=d.f6.get("note_background");return"Genshin"!==i.iC?e.isDark()?i.kx.text.light:i.kx.text.dark:e.luminosity()>.65?i.kx.text.note:e.isDark()?i.kx.text.light:i.kx.text.dark}var y=s(23441),g=s(12293),_=s(32362),x=s(21249),k=s(7374),v=s(83679),f=s(53179),b=s(48043),j=s(78773),P=s(91849),S=s.n(P),N=s(40208),w=s(10694),C=s(11090),I=s(67421);function M(e){let{map:t,onChangeShortcut:s}=e,i=Array.from(t.entries()),[n,a]=(0,c.useState)(null);return(0,r.jsx)("div",{className:"column",style:{gap:"0.4rem"},children:i.sort((e,t)=>e[1].name<t[1].name?1:-1).map((e,t)=>{let[i,o]=e;return(0,r.jsx)(z,{mapKey:i,value:o,selected:n===i,setSelected:a,onChangeShortcut:(e,t)=>{s(i,e,t),a(null)}},t)})})}function z(e){let{mapKey:t,value:s,selected:i,setSelected:n,onChangeShortcut:a}=e,{t:o}=(0,I.$G)("shortcuts"),[d,l]=(0,c.useState)(t);return(0,c.useEffect)(()=>{if(i)return(0,k._T)("shortcut_".concat(s),e=>{let{keyCombo:t}=e;l(t.join("+"))})},[i,s]),(0,c.useEffect)(()=>{l(t)},[t,i]),(0,r.jsxs)("div",{className:(0,u.cn)("row ".concat(S()["shortcut-element"]),[i,S()["shortcut-element-selected"]],(0,w.h)(s.description)),children:[(0,r.jsxs)(C.X,{align:"center",gap:"0.4rem",children:[o("props.".concat(s.name)),s.holdable&&(0,r.jsxs)("div",{style:{fontSize:"0.8rem"},children:["(",o("holdable"),")"]})]}),(0,r.jsxs)(C.X,{gap:"0.4rem",children:[i&&(0,r.jsx)(N.h,{cssVar:"accent",onClick:()=>{a(d,s)},children:(0,r.jsx)(j.l_A,{})}),(0,r.jsx)(b.J,{className:S()["shortcut-button"],onClick:()=>n(t),children:d})]}),s.description&&(0,r.jsx)(w.u,{children:o("props.".concat(s.description))})]})}var A=s(5323),E=s(79613),K=s.n(E),T=s(21583),V=s.n(T);function O(e){let{status:t,onClick:s,type:i,selected:n,midi:a}=e,{t:o}=(0,I.$G)("keybinds");return(0,r.jsx)(b.J,{className:"".concat(V()["midi-shortcut"]," ").concat(V()[t]),toggled:n,onClick:()=>s(i),children:o("shortcuts.".concat(i))+" (".concat(-1===a?"N/A":a,")")})}var X=s(80331),B=s(92761),R=s(74646),U=s(61748),D=s(31602),L=s(82860),Z=s(95616);let q=new v.Yx;class F extends c.Component{componentDidMount(){this.init()}componentWillUnmount(){this.mounted=!1,this.state.audioPlayer.destroy(),X.mP.removeInputsListener(this.midiStateChange),X.mP.removeListener(this.handleMidi),B.n.clear()}render(){let{notes:e,currentPreset:t,presets:s,shortcuts:n,midiAccess:a,sources:o,selectedShortcut:c,selectedSource:d}=this.state,{t:l}=this.props;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(L.s,{gap:"1rem",children:[(0,r.jsxs)(C.X,{justify:"between",children:[(0,r.jsxs)("div",{children:[l("midi_status"),":"]}),(0,r.jsx)("div",{children:l("midi_access_".concat(a.status))})]}),(0,r.jsxs)(C.X,{gap:"1rem",align:"center",justify:"between",children:[l("connected_midi_devices"),":",(0,r.jsx)(C.X,{gap:"0.5rem",style:{flexWrap:"wrap"},children:o.length>0?o.map(e=>(0,r.jsxs)("div",{style:{borderRadius:"0.3rem",padding:"0.2rem 0.4rem",border:"solid 0.1rem var(--secondary)"},children:[e.name," - ",e.id]},e.id)):l("no_connected_devices")})]}),(0,r.jsx)(Z.Z,{height:"0.1rem",background:"var(--secondary)"}),(0,r.jsxs)(C.X,{justify:"between",gap:"0.5rem",children:[l("midi_layout_preset"),":",(0,r.jsxs)(C.X,{gap:"0.5rem",children:[(0,r.jsxs)("select",{className:"midi-select",style:{marginLeft:"0.5rem"},value:t,onChange:e=>{this.loadPreset(e.target.value)},children:[(0,r.jsx)("optgroup",{label:"App presents",children:i.eI.map(e=>(0,r.jsx)("option",{value:e.name,children:e.name},e.name))}),(0,r.jsx)("optgroup",{label:"Your presets",children:s.map(e=>(0,r.jsx)("option",{value:e.name,children:e.name},e.name))})]}),(0,r.jsxs)(b.J,{onClick:()=>this.deletePreset(t),className:"flex items-center",style:{gap:"0.5rem"},children:[(0,r.jsx)(j.Xm5,{}),l("delete_midi_preset")]}),(0,r.jsxs)(b.J,{onClick:this.createPreset,className:"flex items-center",style:{gap:"0.5rem"},children:[(0,r.jsx)(j.wEH,{}),l("create_midi_preset")]})]})]}),(0,r.jsx)("div",{style:{margin:"0.5rem 0"},children:l("midi_note_selection_description")})]}),(0,r.jsxs)("div",{className:V()["midi-setup-content"],children:[(0,r.jsx)("div",{className:"Genshin"===i.iC?"keyboard":"keyboard keyboard-5",style:{margin:"1.5rem 0",width:"fit-content"},children:e.map((e,t)=>{var s;return(0,r.jsx)(h,{handleClick:()=>this.handleClick(e),data:e,noteImage:null===(s=q.notes[t])||void 0===s?void 0:s.noteImage,noteText:e.midi<0?"N/A":String(e.midi)},t)})}),(0,r.jsxs)("div",{className:V()["midi-shortcuts-wrapper"],children:[(0,r.jsx)("h1",{children:l("midi_shortcuts")}),(0,r.jsx)("div",{className:V()["midi-shortcuts"],children:n.map(e=>(0,r.jsx)(O,{type:e.type,status:e.status,midi:e.midi,selected:c===e.type,onClick:this.handleShortcutClick},e.type))})]})]})]})}constructor(e){var t;super(e),t=this,this.init=async()=>{if(await this.loadInstrument(i.BX[0]),"requestMIDIAccess"in navigator){let e=await X.mP.init();if(e)this.setState({midiAccess:{status:"granted",midiAccess:e}});else{let e=await X.mP.requestAccess();e?this.setState({midiAccess:{status:"granted",midiAccess:e}}):this.setState({midiAccess:{status:"denied"}})}}else this.setState({midiAccess:{status:"unsupported"}});X.mP.addInputsListener(this.midiStateChange),X.mP.addListener(this.handleMidi),this.setState({sources:X.mP.inputs,notes:X.mP.notes,currentPreset:X.mP.settings.selectedPreset,shortcuts:X.mP.settings.shortcuts,presets:X.mP.getPresets()})},this.midiStateChange=e=>{this.mounted&&this.setState({sources:e})},this.deselectNotes=()=>{let{notes:e}=this.state;e.forEach(e=>{e.status=e.midi<0?"wrong":"right"}),this.setState({notes:e})},this.loadInstrument=async e=>{let{audioPlayer:t}=this.state;return(await t.syncInstruments([new U.WH({name:e})])).some(e=>!e)?f.kg.error("Error loading instrument"):this.mounted?void this.setState({audioPlayer:t}):t.destroy()},this.checkIfMidiIsUsed=(e,t)=>{let{shortcuts:s,notes:r}=this.state;return!!(s.find(t=>t.midi===e)&&["all","shortcuts"].includes(t)||r.find(t=>t.midi===e)&&["all","notes"].includes(t))},this.loadPreset=e=>{X.mP.loadPreset(e),this.setState({notes:X.mP.notes,currentPreset:e})},this.handleMidi=e=>{let[t,s,r]=e,{selectedNote:i,currentPreset:n,notes:a,selectedShortcut:o,shortcuts:c}=this.state;if(X.mP.isDown(t)&&0!==r){if(i){if(this.checkIfMidiIsUsed(s,"shortcuts"))return f.kg.warn(this.props.t("key_already_used"));if(this.deselectNotes(),X.mP.isPresetBuiltin(n))return f.kg.warn(this.props.t("cannot_edit_builtin_preset"));X.mP.updateNoteOfCurrentPreset(i.index,s,"right"),this.setState({selectedNote:null,notes:X.mP.notes})}if(o){let e=c.find(e=>e.type===o);if(this.checkIfMidiIsUsed(s,"all"))return f.kg.warn(this.props.t("key_already_used"));e&&(X.mP.updateShortcut(e.type,s,s<0?"wrong":"right"),this.setState({shortcuts:X.mP.settings.shortcuts}))}let e=c.find(e=>e.midi===s);e&&(X.mP.updateShortcut(e.type,s,"clicked"),setTimeout(()=>{X.mP.updateShortcut(e.type,s,s<0?"wrong":"right"),this.setState({shortcuts:X.mP.settings.shortcuts})},150),this.setState({shortcuts:X.mP.settings.shortcuts})),a.filter(e=>e.midi===s).forEach(e=>{this.handleClick(e,!0)})}},this.handleClick=function(e){let s=arguments.length>1&&void 0!==arguments[1]&&arguments[1],{notes:r}=t.state;s||t.deselectNotes(),e.status="clicked",s?(setTimeout(()=>{e.status=e.midi<0?"wrong":"right",t.setState({notes:r})},200),t.setState({notes:r,selectedShortcut:null})):t.setState({notes:r,selectedNote:e,selectedShortcut:null}),t.playSound(e)},this.handleShortcutClick=e=>{if(this.deselectNotes(),this.state.selectedShortcut===e)return this.setState({selectedShortcut:null,selectedNote:null});this.setState({selectedShortcut:e,selectedNote:null})},this.playSound=e=>{if(void 0===e)return;let{audioPlayer:t}=this.state;t.playNoteOfInstrument(0,e.index)},this.createPreset=async()=>{let{presets:e,notes:t}=this.state;for(;;){let t=await (0,D.cJ)(this.props.t("ask_preset_name"));if(!t)return;if(X.mP.isPresetBuiltin(t)||e.some(e=>e.name===t)){f.kg.warn(this.props.t("already_existing_preset"));continue}X.mP.createPreset({name:t,notes:this.state.notes.map(e=>-1)}),this.setState({presets:X.mP.getPresets()}),this.loadPreset(t);return}},this.deletePreset=async e=>{if(X.mP.isPresetBuiltin(e))return f.kg.warn(this.props.t("cannot_delete_builtin_preset"));await (0,D.jH)(this.props.t("confirm_delete_preset",{preset_name:e}))&&(X.mP.deletePreset(e),X.mP.loadPreset("default"),this.setState({presets:X.mP.getPresets(),notes:X.mP.notes,currentPreset:"default"}))},this.state={audioPlayer:new R.z("C"),notes:X.mP.notes,currentPreset:"default",midiAccess:{status:"pending"},shortcuts:X.mP.settings.shortcuts,presets:X.mP.getPresets(),selectedNote:null,selectedShortcut:null,sources:[],selectedSource:null},this.mounted=!0}}let G=(0,I.Zh)("keybinds")(F);var H=s(19116);let Q=new v.Yx;function J(){(0,H.o)("keybinds");let{t:e}=(0,I.$G)(["keybinds","home"]),[t]=(0,_.Kq)(k.z5.getShortcutMap("keyboard")),[s]=(0,_.Kq)(k.z5.getShortcutMap("composer")),[a]=(0,_.Kq)(k.z5.getShortcutMap("player")),[o]=(0,_.Kq)(k.z5.getShortcutMap("vsrg_composer")),[d]=(0,_.Kq)(k.z5.getShortcutMap("vsrg_player")),{IS_MOBILE:l}=(0,A.Z)(),[u,m]=(0,c.useState)({type:"",index:-1});(0,c.useEffect)(()=>(x.w.listen(t=>{let{letter:s,code:r}=t;if("Escape"===s)return m({type:"",index:-1});let{type:i,index:n}=u,a=Q.getNoteFromIndex(n);if("keyboard"===i&&-1!==n){let t=k.z5.setKeyboardKeybind(a.noteNames.keyboard,r);void 0!==t&&f.kg.warn(e("already_used_keybind",{note_name:t.name})),m({type:"",index:-1})}if(["k4","k6","k8"].includes(i)&&-1!==n){let e=Number(i.replace("k",""));k.z5.setVsrgKeybind(e,n,s),m({type:"",index:-1})}},{id:"keybinds"}),()=>x.w.unregisterById("keybinds")),[u]);let p=(0,_.ih)(k.z5.getVsrgKeybinds(4)),g=(0,_.ih)(k.z5.getVsrgKeybinds(6));return(0,r.jsxs)(n.k,{children:[(0,r.jsx)(y.d,{text:e("home:keybinds_or_midi_name"),description:"Change the app keyboard keybinds and MIDI input keys"}),(0,r.jsx)("h1",{children:e("midi_keybinds")}),(0,r.jsx)(G,{}),!l&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("h1",{children:e("keyboard_keybinds")}),(0,r.jsx)("div",{children:e("keyboard_keybinds_description")}),(0,r.jsx)("div",{className:"flex-centered",children:(0,r.jsx)("div",{className:"keyboard ".concat("Sky"===i.iC?"keyboard-5":""),style:{margin:"1rem 0"},children:Q.notes.map((e,t)=>{var s;let i=k.z5.getKeyOfShortcut("keyboard",e.noteNames.keyboard);return(0,r.jsx)(h,{data:{status:"keyboard"===u.type&&t===u.index?"clicked":""},noteImage:Q.notes[t].noteImage,noteText:i?null!==(s=x.w.getTextOfCode(i))&&void 0!==s?s:i:"???",handleClick:()=>{m({type:"keyboard",index:u.index===t?-1:t})}},t)})})}),(0,r.jsx)("h1",{children:e("composer_shortcuts")}),(0,r.jsx)("div",{className:"column",children:(0,r.jsx)(M,{map:s,onChangeShortcut:(e,t)=>{if(e===t)return;let s=k.z5.setShortcut("composer",e,t);s&&f.kg.warn('This shortcut is already used by the "'.concat(s,'" action'))}})}),(0,r.jsx)("h1",{children:e("player_shortcuts")}),(0,r.jsx)("div",{className:"column",children:(0,r.jsx)(M,{map:a,onChangeShortcut:(e,t)=>{if(e===t)return;let s=k.z5.setShortcut("player",e,t);s&&f.kg.warn('This shortcut is already used by the "'.concat(s,'" action'))}})}),(0,r.jsx)("h1",{children:e("vsrg_composer_shortcuts")}),(0,r.jsx)("div",{className:"column",children:(0,r.jsx)(M,{map:o,onChangeShortcut:(e,t)=>{if(e===t)return;let s=k.z5.setShortcut("vsrg_composer",e,t);s&&f.kg.warn('This shortcut is already used by the "'.concat(s,'" action'))}})}),(0,r.jsx)("h1",{children:e("vsrg_player_shortcuts")}),(0,r.jsx)("div",{className:"column",children:(0,r.jsx)(M,{map:d,onChangeShortcut:(e,t)=>{if(e===t)return;let s=k.z5.setShortcut("vsrg_player",e,t);s&&f.kg.warn('This shortcut is already used by the "'.concat(s,'" action'))}})}),(0,r.jsx)("h1",{children:e("vsrg_keybinds")}),(0,r.jsx)("div",{className:"column",style:{marginLeft:"1rem"},children:[p,g].map((e,t)=>(0,r.jsxs)(c.Fragment,{children:[(0,r.jsxs)("h2",{children:[e.length," keys"]}),(0,r.jsx)("div",{className:"row",children:e.map((t,s)=>(0,r.jsx)(Y,{letter:t,isActive:u.type==="k".concat(e.length)&&u.index===s,handleClick:t=>m({type:"k".concat(e.length),index:t?s:-1})},s))})]},t))})]})]})}function Y(e){let{letter:t,isActive:s,handleClick:i}=e,n=(0,g.ZP)(()=>i(!1),{ignoreFocusable:!0,active:s});return(0,r.jsx)("button",{className:K()["vsrg-player-key-circle"],ref:n,style:{width:"3.5rem",fontSize:"1rem",height:"3.5rem",margin:"0.4rem",border:"none",backgroundColor:s?"var(--accent)":"var(--primary)",color:s?"var(--accent-text)":"var(--primary-text)",cursor:"pointer"},onClick:()=>i(!s),children:t})}},21558:function(e){e.exports={separator:"separator_separator__0BMUz","separator-content":"separator_separator-content__VZtha","separator-part":"separator_separator-part__kAyrM"}},91849:function(e){e.exports={"shortcut-element":"ShortcutEditor_shortcut-element__SN6fA","shortcut-element-selected":"ShortcutEditor_shortcut-element-selected__qxw9I","shortcut-button":"ShortcutEditor_shortcut-button__QU0wv"}},21583:function(e){e.exports={"midi-setup-content":"MidiSetup_midi-setup-content__D7z1R","midi-shortcuts-wrapper":"MidiSetup_midi-shortcuts-wrapper__Pd8Nk","midi-shortcuts":"MidiSetup_midi-shortcuts__EHLMC","midi-shortcut":"MidiSetup_midi-shortcut__keQSQ",wrong:"MidiSetup_wrong__6ZeDw",right:"MidiSetup_right__TsMU2",clicked:"MidiSetup_clicked__PtROs",selected:"MidiSetup_selected__TH4ve","midi-setup-column":"MidiSetup_midi-setup-column__AU8KG"}},79613:function(e){e.exports={"vsrg-player-keyboard-circles":"VsrgPlayerKeyboard_vsrg-player-keyboard-circles__4z_Qj","vsrg-player-keyboard-control-left":"VsrgPlayerKeyboard_vsrg-player-keyboard-control-left__UjU4z","vsrg-player-keyboard-control-right":"VsrgPlayerKeyboard_vsrg-player-keyboard-control-right__Yr1TA","vsrg-player-key-circle":"VsrgPlayerKeyboard_vsrg-player-key-circle__lQmE_","vsrg-player-key-hitbox-circle":"VsrgPlayerKeyboard_vsrg-player-key-hitbox-circle__2QO9H","vsrg-player-key-hitbox-line":"VsrgPlayerKeyboard_vsrg-player-key-hitbox-line__jIQ3o","vsrg-player-key-line":"VsrgPlayerKeyboard_vsrg-player-key-line__N6vdc","vsrg-key-pressed":"VsrgPlayerKeyboard_vsrg-key-pressed__45fBC"}}},function(e){e.O(0,[2463,2888,9774,179],function(){return e(e.s=21880)}),_N_E=e.O()}]);