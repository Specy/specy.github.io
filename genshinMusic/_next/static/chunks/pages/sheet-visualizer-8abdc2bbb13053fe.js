(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9391],{66611:function(e,n,t){"use strict";t.d(n,{Z:function(){return FuzzySearch}});let Helper=class Helper{static getDescendantProperty(e,n,t=[]){let r,o,i,s,a,l;if(n){if(-1===(i=n.indexOf("."))?r=n:(r=n.slice(0,i),o=n.slice(i+1)),null!=(s=e[r])){if(o||"string"!=typeof s&&"number"!=typeof s){if("[object Array]"===Object.prototype.toString.call(s))for(a=0,l=s.length;a<l;a++)Helper.getDescendantProperty(s[a],o,t);else o&&Helper.getDescendantProperty(s,o,t)}else t.push(s)}}else t.push(e);return t}};let FuzzySearch=class FuzzySearch{constructor(e=[],n=[],t={}){Array.isArray(n)||(t=n,n=[]),this.haystack=e,this.keys=n,this.options=Object.assign({caseSensitive:!1,sort:!1},t)}search(e=""){if(""===e)return this.haystack;let n=[];for(let t=0;t<this.haystack.length;t++){let r=this.haystack[t];if(0===this.keys.length){let t=FuzzySearch.isMatch(r,e,this.options.caseSensitive);t&&n.push({item:r,score:t})}else for(let t=0;t<this.keys.length;t++){let o=Helper.getDescendantProperty(r,this.keys[t]),i=!1;for(let t=0;t<o.length;t++){let s=FuzzySearch.isMatch(o[t],e,this.options.caseSensitive);if(s){i=!0,n.push({item:r,score:s});break}}if(i)break}}return this.options.sort&&n.sort((e,n)=>e.score-n.score),n.map(e=>e.item)}static isMatch(e,n,t){e=String(e),n=String(n),t||(e=e.toLocaleLowerCase(),n=n.toLocaleLowerCase());let r=FuzzySearch.nearestIndexesFor(e,n);return!!r&&(e===n?1:r.length>1?2+(r[r.length-1]-r[0]):2+r[0])}static nearestIndexesFor(e,n){let t=n.split(""),r=[],o=FuzzySearch.indexesOfFirstLetter(e,n);return o.forEach((n,o)=>{let i=n+1;r[o]=[n];for(let n=1;n<t.length;n++){let s=t[n];if(-1===(i=e.indexOf(s,i))){r[o]=!1;break}r[o].push(i),i++}}),!!(r=r.filter(e=>!1!==e)).length&&r.sort((e,n)=>1===e.length?e[0]-n[0]:(e=e[e.length-1]-e[0])-(n=n[n.length-1]-n[0]))[0]}static indexesOfFirstLetter(e,n){let t=n[0];return e.split("").map((e,n)=>e===t&&n).filter(e=>!1!==e)}}},95891:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/sheet-visualizer",function(){return t(68569)}])},55457:function(e,n,t){"use strict";t.d(n,{P:function(){return Select}});var r=t(72253),o=t(91309),i=t(85893),s=t(18212),a=t(31611),l=t.n(a),u=t(67294);function Select(e){var n=e.onChange,t=e.value,a=e.children,c=e.style,h=(0,o._)((0,s.F)(),1)[0],m=(0,u.useCallback)(function(e){n(e),e.target.blur()},[n]);return(0,i.jsx)("select",{onChange:m,value:t,className:l().select,style:(0,r._)({backgroundImage:"url(\"data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' height='24' viewBox='0 0 24 24' width='24' fill='".concat(h.getText("primary").hex().replace("#","%23"),"'><path d='M0 0h24v24H0z' fill='none'/><path d='M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z'/></svg>\")")},c),children:a})}},47536:function(e,n,t){"use strict";t.d(n,{Z:function(){return Switch}});var r=t(91309),o=t(85893),i=t(18212),s=t(63326),a=t.n(s);function Switch(e){var n=e.checked,t=e.onChange,s=e.styleOuter,l=(0,r._)((0,i.F)(),1)[0];return(0,o.jsx)("button",{className:a()["switch-wrapper"],onClick:function(){return t(!n)},style:s||{},"aria-label":n?"Switch to off":"Switch to on",children:(0,o.jsx)("div",{className:"".concat(a()["switch-inner"]," ").concat(n?a()["switch-inner-on"]:""),style:{backgroundColor:(n?l.get("accent"):l.layer("primary",.4)).toString()}})})}},77275:function(e,n,t){"use strict";t.d(n,{k:function(){return DefaultPage}});var r=t(72253),o=t(14932),i=t(85893),s=t(62926);function DefaultPage(e){var n=e.excludeMenu,t=e.children,a=e.className,l=e.style,u=e.menu,c=e.cropped,h=void 0===c||c?l:(0,o._)((0,r._)({},l),{padding:0});return(0,i.jsxs)("div",{className:"default-page "+(void 0===a?"":a),style:h,children:[(!(void 0!==n&&n)||!u)&&(0,i.jsx)(s.O,{}),u,(0,i.jsx)("main",{className:"default-content appear-on-mount",children:t})]})}},175:function(e,n,t){"use strict";t.d(n,{Z:function(){return MenuPanel}});var r=t(85893);function MenuPanel(e){var n=e.title,t=e.current,o=e.children,i=e.id;return(0,r.jsxs)("div",{className:t===i?"menu-panel menu-panel-visible":"menu-panel",children:[n&&(0,r.jsx)("div",{className:"menu-title",children:n}),(0,r.jsx)("div",{className:"panel-content-wrapper",children:o})]})}},62926:function(e,n,t){"use strict";t.d(n,{O:function(){return SimpleMenu}});var r=t(11010),o=t(97582),i=t(85893),s=t(52091),a=t(66826),l=t(19807),u=t(10398),c=t(11163),h=t(41664),m=t.n(h),d=t(5336);function SimpleMenu(e){var n,t=e.children,h=e.className,p=(0,c.useRouter)();return(0,i.jsx)("div",{className:"menu-wrapper "+(void 0===h?"":h),children:(0,i.jsxs)("div",{className:"menu menu-visible",style:{justifyContent:"flex-end"},children:[l.U.hasNavigated&&(0,i.jsx)(a.s,{style:{marginBottom:"auto"},onClick:function(){p.back()},ariaLabel:"Go back",children:(0,i.jsx)(s.x_l,{className:"icon"})}),void 0===t?void 0:t,(0,i.jsx)(m(),{href:"https://discord.gg/Arsf65YYHq",target:"_blank",rel:"noreferrer",title:"Go to discord",onClick:(n=(0,r._)(function(e){return(0,o.Jh)(this,function(n){switch(n.label){case 0:return e.preventDefault(),[4,(0,d.jH)("You are leaving the app to go to discord, do you want to continue?")];case 1:if(!n.sent())return[2];return window.open("https://discord.gg/Arsf65YYHq","_blank"),[2]}})}),function(e){return n.apply(this,arguments)}),children:(0,i.jsx)(a.s,{ariaLabel:"Go to discord",children:(0,i.jsx)(s.j2d,{className:"icon"})})}),(0,i.jsx)(a.s,{onClick:u.I.open,ariaLabel:"Open home menu",style:{border:"solid 0.1rem var(--secondary)"},children:(0,i.jsx)(s.xng,{className:"icon"})})]})})}},68569:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return SheetVisualizer}});var r=t(91309),o=t(85893),i=t(67294),s=t(1062),a=t(73288),l=t(47536),u=t(75422),c=t(28796),h=t(37870),m=t(11010),d=t(72253),p=t(14932),f=t(97582),g=t(90337),v=t(41072),x=t(19807),y=t(66826),k=t(52091),_=t(10398),C=t(175),w=t(4674),S=t(18208),j=t(11163);function SheetVisualiserMenu(e){var n=e.currentSong,t=e.onSongLoaded,s=(0,r._)((0,v.n)(),1)[0],a=(0,j.useRouter)(),l=(0,r._)((0,i.useState)(""),2),u=l[0],c=l[1],h="Songs"===u?"side-menu menu-open":"side-menu",m=(0,w.ZP)(function(){c("")},{ignoreFocusable:!0,active:""!==u});return(0,o.jsxs)("div",{className:"menu-wrapper noprint",ref:m,children:[(0,o.jsxs)("div",{className:"menu menu-visible",style:{justifyContent:"flex-end"},children:[x.U.hasNavigated&&""===u&&(0,o.jsx)(y.s,{ariaLabel:"Go back",style:{marginBottom:"auto"},onClick:function(){a.back()},children:(0,o.jsx)(k.x_l,{className:"icon"})}),""!==u&&(0,o.jsx)(y.s,{ariaLabel:"Close menu",style:{marginBottom:"auto"},onClick:function(){return c("")},children:(0,o.jsx)(k.aHS,{className:"icon"})}),(0,o.jsx)(y.s,{onClick:function(){c("Songs"===u?"":"Songs")},ariaLabel:"Open songs menu",children:(0,o.jsx)(k.HcQ,{className:"icon"})}),(0,o.jsx)(y.s,{onClick:_.I.open,ariaLabel:"Open home menu",style:{border:"solid 0.1rem var(--secondary)"},children:(0,o.jsx)(k.xng,{className:"icon"})})]}),(0,o.jsx)("div",{className:h,children:(0,o.jsx)(C.Z,{children:(0,o.jsx)(g.G,{songs:s,className:"noprint",exclude:["vsrg"],SongComponent:SongRow,componentProps:{current:n,onClick:t}})})})]})}function SongRow(e){var n=e.data,t=e.current,r=e.onClick,i=(null==t?void 0:t.id)===n.id?{backgroundColor:"rgb(124, 116, 106)"}:{};return(0,o.jsx)("div",{className:"song-row",style:(0,p._)((0,d._)({},i),{padding:"0.5rem 0.8rem"}),onClick:(0,m._)(function(){var e;return(0,f.Jh)(this,function(t){switch(t.label){case 0:return h.kg.showPill("Loading song..."),[4,S.v.getOneSerializedFromStorable(n)];case 1:if(!(e=t.sent()))return[2,h.kg.error("Could not load song")];return r(e),setTimeout(function(){return h.kg.hidePill()},300),[2]}})}),children:(0,o.jsx)("div",{className:"song-name",children:n.name})})}var b=t(36443),N=t(77275),T=t(18212),z=t(55457),F=t(7073),L=t.n(F),P=t(42678),M=t(76704),V=t.n(M);function getBackgroundColor(e){return 0===e?"transparent":"var(--tempo-changer-".concat(e,")")}var O=new P.Yx,R=(0,i.memo)(function(e){var n=e.chunk,t=e.rows,a=e.hasText,l=e.theme,u=e.keyboardLayout,c="Genshin"===s.iC?7:5,h=(0,r._)((0,i.useState)("var(--primary)"),2),m=h[0],p=h[1];return(0,i.useEffect)(function(){p(l.layer("primary",.2).toString())},[l]),(0,o.jsx)(o.Fragment,{children:n.columns.map(function(e,r){var i,s=Array(c*t).fill(!1);return e.notes.forEach(function(e){s[e.note]=!0}),(0,o.jsx)("div",{className:V()["frame-outer-background"],style:(0,d._)({background:n.columns.length-1===r&&n.endingTempoChanger!==n.tempoChanger?"linear-gradient(to right, ".concat(getBackgroundColor(n.tempoChanger)," 50%, ").concat(getBackgroundColor(n.endingTempoChanger)," 50%)"):getBackgroundColor(n.tempoChanger)},(i=n.columns.length,0===r?{borderTopLeftRadius:"0.5rem",borderBottomLeftRadius:"0.5rem"}:r===i-1?{borderTopRightRadius:"0.5rem",borderBottomRightRadius:"0.5rem"}:{})),children:(0,o.jsx)("div",{className:"".concat(V()["frame-outer"]," ").concat(0===e.notes.length?V()["visualizer-ball"]:""),children:0===e.notes.length?(0,o.jsx)("div",{}):(0,o.jsx)("div",{className:V()["visualizer-frame"],style:{gridTemplateColumns:"repeat(".concat(c,",1fr)")},children:s.map(function(e,n){return(0,o.jsx)("div",{className:e?V()["frame-note-s"]:V()["frame-note-ns"],style:e?{}:{backgroundColor:m},children:e&&a?O.getNoteText(n,u,"C"):null},n)})})})},r)})})},function(e,n){return e.chunk===n.chunk&&e.rows===n.rows&&e.hasText===n.hasText&&e.theme===n.theme}),I=t(48564),E=t(4586),A=t(51705),B=t(73634),D=t(93800),H={joined:50,pause:400},Z=new P.Yx,G=function(){function VisualSong(e){(0,I._)(this,VisualSong),this.chunks=[],this.bpm=e}var e=VisualSong.prototype;return e.toText=function(e){var n=this.chunks.map(function(n){return n.toText(e)}),t=[],r=0,o=!0,i=!1,s=void 0;try{for(var a,l=n[Symbol.iterator]();!(o=(a=l.next()).done);o=!0){var u=a.value;if(""===u)r++;else{if(r){var c=Math.round(6e4/(r*this.bpm)/H.pause);c<=2?t.push(Array.from({length:c},function(){return"-"}).join(" ")):t.push("\n\n".repeat(Math.round(c/2))),r=0}t.push(u)}}}catch(e){i=!0,s=e}finally{try{o||null==l.return||l.return()}finally{if(i)throw s}}return t.join(" ").trim()},e.addChunk=function(e,n){var t,r=Array.from({length:Math.floor(n/H.pause)},function(){return new q(0,[])});(t=this.chunks).push.apply(t,[e].concat((0,E._)(r)))},VisualSong.from=function(e){e=e.clone();var n=new VisualSong(e.bpm);if(e instanceof B.M){var t=e.notes.shift();if(!t)return n;var r=[t],o=t.time,i=!0,s=!1,a=void 0;try{for(var l,u=e.notes[Symbol.iterator]();!(i=(l=u.next()).done);i=!0){var c,h,m=l.value;if(m.time-(null!==(h=null===(c=r[0])||void 0===c?void 0:c.time)&&void 0!==h?h:0)<=H.joined)r.push(m);else{var d=m.time-o,p=new q(0,[U.from(r.splice(0,r.length))]);n.addChunk(p,d),r.push(m)}o=m.time}}catch(e){s=!0,a=e}finally{try{i||null==u.return||u.return()}finally{if(s)throw a}}var f=e.notes[e.notes.length-1].time-o,g=new q(0,[U.from(r)]);n.addChunk(g,f),n.chunks=n.chunks.map(function(e){return 0===e.columns.length&&e.columns.push(new U([])),e})}else if(e instanceof A.l){var v=e.columns,x=v[0];if(!x)return n;var y=[],k=x.tempoChanger,_=!0,C=!1,w=void 0;try{for(var S,j=v[Symbol.iterator]();!(_=(S=j.next()).done);_=!0){var b=S.value;if(0===k&&0===b.tempoChanger)n.addChunk(q.from([b]),0);else if(k>b.tempoChanger){y.push(b);var N=q.from(y.splice(0,y.length));N.endingTempoChanger=b.tempoChanger,n.addChunk(N,0)}else k<b.tempoChanger&&(0===k||n.addChunk(q.from(y.splice(0,y.length)),0)),y.push(b);k=b.tempoChanger}}catch(e){C=!0,w=e}finally{try{_||null==j.return||j.return()}finally{if(C)throw w}}y.length&&n.addChunk(q.from(y.splice(0,y.length)),0);for(var T=-1,z=0;z<n.chunks.length;z++)n.chunks[z].columns.some(function(e){return e.notes.length>0})&&(-1===T&&(n.chunks.splice(0,z),z=0),T=z);n.chunks.splice(T+1)}else console.error("Song type not supported");return n},VisualSong}(),Y=function(){function TempoChunkNote(e){(0,I._)(this,TempoChunkNote),this.note=e}return TempoChunkNote.prototype.toText=function(e){var n,t;return"".concat((n=this.note,t=Z.getNoteText(n,e,"C"),"Genshin"===s.iC?t.toLowerCase():t.toUpperCase()))},TempoChunkNote.from=function(e){return new TempoChunkNote(e.index)},TempoChunkNote}(),Q=new Map([[0,["",""]],[1,["(",")"]],[2,["[","]"]],[3,["{","}"]]]),U=function(){function TempoChunkColumn(e){(0,I._)(this,TempoChunkColumn),this.notes=e}return TempoChunkColumn.prototype.toText=function(e){return this.notes.map(function(n){return n.toText(e)}).join("")},TempoChunkColumn.from=function(e){return new TempoChunkColumn(e instanceof D.dF?e.notes.map(function(e){return Y.from(e)}):e.map(function(e){return Y.from(e)}))},TempoChunkColumn}(),q=function(){function TempoChunk(e,n){(0,I._)(this,TempoChunk),this.tempoChanger=e,this.endingTempoChanger=e,this.columns=n}return TempoChunk.prototype.toText=function(e){var n,t=(0,r._)(null!==(n=Q.get(this.tempoChanger))&&void 0!==n?n:["",""],2),o=t[0],i=t[1],s=this.columns.map(function(n){return n.toText(e)}).join(" ").trim();return s?"".concat(o).concat(s).concat(i):""},TempoChunk.from=function(e,n){var t;return void 0===(n=null!=n?n:null===(t=e[0])||void 0===t?void 0:t.tempoChanger)&&console.log("tempoChanger is undefined",e,n),new TempoChunk(null!=n?n:0,e.map(function(e){return U.from(e)}))},TempoChunk}();function SheetVisualizer(){var e=(0,r._)((0,T.F)(),1)[0],n=(0,r._)((0,i.useState)(null),2),t=n[0],m=n[1],d=(0,r._)((0,i.useState)(7),2),p=d[0],f=d[1],g=(0,r._)((0,i.useState)(null),2),v=g[0],x=g[1],y=(0,r._)((0,i.useState)(!1),2),k=y[0],_=y[1],C=(0,r._)((0,i.useState)(""),2),w=C[0],j=C[1],F=(0,r._)((0,i.useState)("Genshin"===s.iC?"Keyboard layout":"ABC"),2),P=F[0],M=F[1],V=(0,i.useRef)(null);function setFrames(e){if(V.current){var n,t=p+e,r=null===(n=V.current.children[0])||void 0===n?void 0:n.children[0];r&&!(t<1)&&(r.getBoundingClientRect().width<50&&1===e||f(t))}}var O=(0,i.useCallback)(function(e,n){try{var t=S.v.parseSong(e);if(!(0,a.$9)(t))return h.kg.error("Invalid song, it is not composed or recorded");try{var r=G.from(t);m(r),j(r.toText(n))}catch(e){console.error(e),h.kg.error("Error converting song to visual song, trying to convert to recorded song first...");try{var o=G.from(t.toRecordedSong());m(o),j(o.toText(n))}catch(e){console.error(e),h.kg.error("Error converting song to visual song"),m(null),j("")}}}catch(e){console.error(e),h.kg.error("Error visualizing song")}u.Z.songEvent({type:"visualize"})},[]);return(0,i.useEffect)(function(){v&&O(v,P)},[v,k,P,O]),(0,o.jsxs)(N.k,{excludeMenu:!0,className:L()["page-no-print"],menu:(0,o.jsx)(SheetVisualiserMenu,{onSongLoaded:x,currentSong:v}),children:[(0,o.jsx)(b.V,{text:"Sheet Visualizer",description:"Learn a sheet in a visual way, convert the song into text format or print it as pdf"}),(0,o.jsxs)("div",{style:{display:"flex",alignItems:"center",flexDirection:"column"},children:[(0,o.jsxs)("div",{className:"".concat(L()["visualizer-buttons-wrapper"]," noprint"),children:[(0,o.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[(0,o.jsx)("div",{children:"Note names"}),(0,o.jsx)(l.Z,{checked:k,onChange:_}),k&&(0,o.jsx)(z.P,{value:P,onChange:function(e){return M(e.target.value)},children:s.HI.map(function(e){return(0,o.jsx)("option",{value:e,children:e},e)})})]}),(0,o.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:["Per row: ",p,(0,o.jsx)("button",{className:L()["visualizer-plus-minus"],onClick:function(){return setFrames(-1)},children:"-"}),(0,o.jsx)("button",{className:L()["visualizer-plus-minus"],onClick:function(){return setFrames(1)},children:"+"})]})]}),(0,o.jsx)("h1",{className:"onprint",style:{color:"black"},children:"Sky Music Nightly"}),(0,o.jsx)("h1",{className:"onprint",style:{color:"black"},children:v?null==v?void 0:v.name:""}),(0,o.jsxs)("div",{style:{width:"100%"},className:"noprint",children:[(0,o.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,o.jsx)("h2",{className:"text-ellipsis",children:v?v.name:"No song selected"}),v&&(0,o.jsx)(c.J,{onClick:function(){return window.print()},style:{minWidth:"fit-content",marginLeft:"0.4rem"},children:"Print as PDF"})]}),(0,o.jsx)("div",{style:{color:"var(--background-text)"},children:"Select a song from the menu on the left. Remember that you can learn a song with the interactive practice tool in the Player"})]}),(0,o.jsx)("div",{className:L()["visualizer-frame-wrapper"],style:{gridTemplateColumns:"repeat(".concat(p,",1fr)")},ref:V,children:t&&t.chunks.map(function(n,t){return(0,o.jsx)(R,{chunk:n,rows:3,theme:e,hasText:k,keyboardLayout:P},t)})}),w.trim().length>0&&(0,o.jsx)("pre",{className:L()["text-notation-wrapper"],children:w})]})]})}},76704:function(e){e.exports={"visualizer-frame":"SheetFrame_visualizer-frame__OgoI2","frame-outer-background":"SheetFrame_frame-outer-background__eTaQg","frame-outer":"SheetFrame_frame-outer__tYUb8","frame-outer-smaller":"SheetFrame_frame-outer-smaller__5isiu","frame-note-s":"SheetFrame_frame-note-s__YP_tv","frame-note-ns":"SheetFrame_frame-note-ns__0nRmI","visualizer-ball":"SheetFrame_visualizer-ball__6qDw0"}},63326:function(e){e.exports={"switch-wrapper":"Switch_switch-wrapper__QbqdS","switch-inner":"Switch_switch-inner__2FN4t","switch-inner-on":"Switch_switch-inner-on__dXyKj"}},31611:function(e){e.exports={"instrument-picker":"Settings_instrument-picker__7I4Rw",select:"Settings_select__TfGwk","settings-group-title":"Settings_settings-group-title__ZP9Kk","settings-row":"Settings_settings-row__QAhCZ",invalid:"Settings_invalid__xvU6D","settings-input":"Settings_settings-input__TWACI","settings-input-button":"Settings_settings-input-button__AnhLi"}},7073:function(e){e.exports={"visualizer-plus-minus":"SheetVisualizer_visualizer-plus-minus__hbX5w","visualizer-buttons-wrapper":"SheetVisualizer_visualizer-buttons-wrapper__bdwQ7","visualizer-frame-wrapper":"SheetVisualizer_visualizer-frame-wrapper__ocN0J","text-notation-wrapper":"SheetVisualizer_text-notation-wrapper__F5ljw","page-no-print":"SheetVisualizer_page-no-print__ECZzT"}}},function(e){e.O(0,[6441,9774,2888,179],function(){return e(e.s=95891)}),_N_E=e.O()}]);