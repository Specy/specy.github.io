(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[391],{6611:function(e,n,t){"use strict";t.d(n,{Z:function(){return i}});class r{static getDescendantProperty(e,n,t=[]){let i,s,o,a,l,c;if(n){if(-1===(o=n.indexOf("."))?i=n:(i=n.slice(0,o),s=n.slice(o+1)),null!=(a=e[i])){if(s||"string"!=typeof a&&"number"!=typeof a){if("[object Array]"===Object.prototype.toString.call(a))for(l=0,c=a.length;l<c;l++)r.getDescendantProperty(a[l],s,t);else s&&r.getDescendantProperty(a,s,t)}else t.push(a)}}else t.push(e);return t}}class i{constructor(e=[],n=[],t={}){Array.isArray(n)||(t=n,n=[]),this.haystack=e,this.keys=n,this.options=Object.assign({caseSensitive:!1,sort:!1},t)}search(e=""){if(""===e)return this.haystack;let n=[];for(let t=0;t<this.haystack.length;t++){let s=this.haystack[t];if(0===this.keys.length){let t=i.isMatch(s,e,this.options.caseSensitive);t&&n.push({item:s,score:t})}else for(let t=0;t<this.keys.length;t++){let o=r.getDescendantProperty(s,this.keys[t]),a=!1;for(let t=0;t<o.length;t++){let r=i.isMatch(o[t],e,this.options.caseSensitive);if(r){a=!0,n.push({item:s,score:r});break}}if(a)break}}return this.options.sort&&n.sort((e,n)=>e.score-n.score),n.map(e=>e.item)}static isMatch(e,n,t){e=String(e),n=String(n),t||(e=e.toLocaleLowerCase(),n=n.toLocaleLowerCase());let r=i.nearestIndexesFor(e,n);return!!r&&(e===n?1:r.length>1?2+(r[r.length-1]-r[0]):2+r[0])}static nearestIndexesFor(e,n){let t=n.split(""),r=[],s=i.indexesOfFirstLetter(e,n);return s.forEach((n,i)=>{let s=n+1;r[i]=[n];for(let n=1;n<t.length;n++){let o=t[n];if(-1===(s=e.indexOf(o,s))){r[i]=!1;break}r[i].push(s),s++}}),!!(r=r.filter(e=>!1!==e)).length&&r.sort((e,n)=>1===e.length?e[0]-n[0]:(e=e[e.length-1]-e[0])-(n=n[n.length-1]-n[0]))[0]}static indexesOfFirstLetter(e,n){let t=n[0];return e.split("").map((e,n)=>e===t&&n).filter(e=>!1!==e)}}},5891:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/sheet-visualizer",function(){return t(5113)}])},1709:function(e,n,t){"use strict";t.d(n,{P:function(){return u}});var r=t(2253),i=t(1309),s=t(5893),o=t(5055),a=t(7600),l=t.n(a),c=t(7294);function u(e){var n=e.onChange,t=e.value,a=e.children,u=e.style,h=(0,i._)((0,o.F)(),1)[0],d=(0,c.useCallback)(function(e){n(e),e.target.blur()},[n]);return(0,s.jsx)("select",{onChange:d,value:t,className:l().select,style:(0,r._)({backgroundImage:"url(\"data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' height='24' viewBox='0 0 24 24' width='24' fill='".concat(h.getText("primary").hex().replace("#","%23"),"'><path d='M0 0h24v24H0z' fill='none'/><path d='M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z'/></svg>\")")},u),children:a})}},3544:function(e,n,t){"use strict";t.d(n,{Z:function(){return l}});var r=t(1309),i=t(5893),s=t(5055),o=t(7114),a=t.n(o);function l(e){var n=e.checked,t=e.onChange,o=e.styleOuter,l=(0,r._)((0,s.F)(),1)[0];return(0,i.jsx)("button",{className:a()["switch-wrapper"],onClick:function(){return t(!n)},style:o||{},"aria-label":n?"Switch to off":"Switch to on",children:(0,i.jsx)("div",{className:"".concat(a()["switch-inner"]," ").concat(n?a()["switch-inner-on"]:""),style:{backgroundColor:(n?l.get("accent"):l.layer("primary",.4)).toString()}})})}},6390:function(e,n,t){"use strict";t.d(n,{k:function(){return a}});var r=t(2253),i=t(4932),s=t(5893),o=t(369);function a(e){var n=e.excludeMenu,t=e.children,a=e.className,l=e.style,c=e.menu,u=e.cropped,h=void 0===u||u?l:(0,i._)((0,r._)({},l),{padding:0});return(0,s.jsxs)("div",{className:"default-page "+(void 0===a?"":a),style:h,children:[(!(void 0!==n&&n)||!c)&&(0,s.jsx)(o.O,{}),c,(0,s.jsx)("div",{className:"default-content appear-on-mount",children:t})]})}},781:function(e,n,t){"use strict";t.d(n,{Z:function(){return i}});var r=t(5893);function i(e){var n=e.title,t=e.current,i=e.children,s=e.id;return(0,r.jsxs)("div",{className:t===s?"menu-panel menu-panel-visible":"menu-panel",children:[n&&(0,r.jsx)("div",{className:"menu-title",children:n}),(0,r.jsx)("div",{className:"panel-content-wrapper",children:i})]})}},369:function(e,n,t){"use strict";t.d(n,{O:function(){return f}});var r=t(1010),i=t(7582),s=t(5893),o=t(9583),a=t(7671),l=t(9255),c=t(2809),u=t(1163),h=t(1664),d=t.n(h),m=t(750);function f(e){var n,t=e.children,h=e.className,f=(0,u.useRouter)();return(0,s.jsx)("div",{className:"menu-wrapper "+(void 0===h?"":h),children:(0,s.jsxs)("div",{className:"menu menu-visible",style:{justifyContent:"flex-end"},children:[l.U.hasNavigated&&(0,s.jsx)(a.s,{style:{marginBottom:"auto"},onClick:function(){f.back()},ariaLabel:"Go back",children:(0,s.jsx)(o.x_l,{className:"icon"})}),void 0===t?void 0:t,(0,s.jsx)(d(),{href:"https://discord.gg/Arsf65YYHq",target:"_blank",rel:"noreferrer",title:"Go to discord",onClick:(n=(0,r._)(function(e){return(0,i.Jh)(this,function(n){switch(n.label){case 0:return e.preventDefault(),[4,(0,m.jH)("You are leaving the app to go to discord, do you want to continue?")];case 1:if(!n.sent())return[2];return window.open("https://discord.gg/Arsf65YYHq","_blank"),[2]}})}),function(e){return n.apply(this,arguments)}),children:(0,s.jsx)(a.s,{ariaLabel:"Go to discord",children:(0,s.jsx)(o.j2d,{className:"icon"})})}),(0,s.jsx)(a.s,{onClick:c.I.open,ariaLabel:"Open home menu",children:(0,s.jsx)(o.xng,{className:"icon"})})]})})}},5113:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return q}});var r=t(1309),i=t(5893),s=t(7294),o=t(2169),a=t(6743),l=t(3544),c=t(5453),u=t(8461),h=t(4339),d=t(1010),m=t(2253),f=t(4932),p=t(7582),g=t(125),v=t(7008),x=t(9255),_=t(7671),y=t(9583),k=t(2809),w=t(781),j=t(7053),b=t(1182),C=t(1163);function S(e){var n=e.currentSong,t=e.onSongLoaded,o=(0,r._)((0,v.n)(),1)[0],a=(0,C.useRouter)(),l=(0,r._)((0,s.useState)(""),2),c=l[0],u=l[1],h="Songs"===c?"side-menu menu-open":"side-menu",d=(0,j.ZP)(function(){u("")},{ignoreFocusable:!0,active:""!==c});return(0,i.jsxs)("div",{className:"menu-wrapper noprint",ref:d,children:[(0,i.jsxs)("div",{className:"menu menu-visible",style:{justifyContent:"flex-end"},children:[x.U.hasNavigated&&""===c&&(0,i.jsx)(_.s,{ariaLabel:"Go back",style:{marginBottom:"auto"},onClick:function(){a.back()},children:(0,i.jsx)(y.x_l,{className:"icon"})}),""!==c&&(0,i.jsx)(_.s,{ariaLabel:"Close menu",style:{marginBottom:"auto"},onClick:function(){return u("")},children:(0,i.jsx)(y.aHS,{className:"icon"})}),(0,i.jsx)(_.s,{onClick:function(){u("Songs"===c?"":"Songs")},ariaLabel:"Open songs menu",children:(0,i.jsx)(y.HcQ,{className:"icon"})}),(0,i.jsx)(_.s,{onClick:k.I.open,ariaLabel:"Open home menu",children:(0,i.jsx)(y.xng,{className:"icon"})})]}),(0,i.jsx)("div",{className:h,children:(0,i.jsx)(w.Z,{children:(0,i.jsx)(g.G,{songs:o,className:"noprint",exclude:["vsrg"],SongComponent:N,componentProps:{current:n,onClick:t}})})})]})}function N(e){var n=e.data,t=e.current,r=e.onClick,s=(null==t?void 0:t.id)===n.id?{backgroundColor:"rgb(124, 116, 106)"}:{};return(0,i.jsx)("div",{className:"song-row",style:(0,f._)((0,m._)({},s),{padding:"0.5rem 0.8rem"}),onClick:(0,d._)(function(){var e;return(0,p.Jh)(this,function(t){switch(t.label){case 0:return h.kg.showPill("Loading song..."),[4,b.v.getOneSerializedFromStorable(n)];case 1:if(!(e=t.sent()))return[2,h.kg.error("Could not load song")];return r(e),setTimeout(function(){return h.kg.hidePill()},300),[2]}})}),children:(0,i.jsx)("div",{className:"song-name",children:n.name})})}var z=t(4995),T=t(6390),L=t(5055),F=t(1709),P=t(2344),O=t.n(P),I=t(5839),E=t(8571),A=t.n(E);function R(e){return 0===e?"transparent":"var(--tempo-changer-".concat(e,")")}var M=new I.ZP,V=(0,s.memo)(function(e){var n=e.chunk,t=e.rows,a=e.hasText,l=e.theme,c=e.keyboardLayout,u="Genshin"===o.iC?7:5,h=(0,r._)((0,s.useState)("var(--primary)"),2),d=h[0],f=h[1];return(0,s.useEffect)(function(){f(l.layer("primary",.2).toString())},[l]),(0,i.jsx)(i.Fragment,{children:n.columns.map(function(e,r){var s,o=Array(u*t).fill(!1);return e.notes.forEach(function(e){o[e.note]=!0}),(0,i.jsx)("div",{className:A()["frame-outer-background"],style:(0,m._)({background:n.columns.length-1===r&&n.endingTempoChanger!==n.tempoChanger?"linear-gradient(to right, ".concat(R(n.tempoChanger)," 50%, ").concat(R(n.endingTempoChanger)," 50%)"):R(n.tempoChanger)},(s=n.columns.length,0===r?{borderTopLeftRadius:"0.5rem",borderBottomLeftRadius:"0.5rem"}:r===s-1?{borderTopRightRadius:"0.5rem",borderBottomRightRadius:"0.5rem"}:{})),children:(0,i.jsx)("div",{className:"".concat(A()["frame-outer"]," ").concat(0===e.notes.length?A()["visualizer-ball"]:""),children:0===e.notes.length?(0,i.jsx)("div",{}):(0,i.jsx)("div",{className:A()["visualizer-frame"],style:{gridTemplateColumns:"repeat(".concat(u,",1fr)")},children:o.map(function(e,n){return(0,i.jsx)("div",{className:e?A()["frame-note-s"]:A()["frame-note-ns"],style:e?{}:{backgroundColor:d},children:e&&a?M.getNoteText(r,c,"C"):null},n)})})})},r)})})},function(e,n){return e.chunk===n.chunk&&e.rows===n.rows&&e.hasText===n.hasText&&e.theme===n.theme}),Z=t(8564),B=t(4586),D=t(8778),G=t(2881),H=t(539),X={joined:50,pause:400},J=new I.ZP,Y=function(){function e(n){(0,Z._)(this,e),this.chunks=[],this.bpm=n}var n=e.prototype;return n.toText=function(e){var n=this.chunks.map(function(n){return n.toText(e)}),t=[],r=0,i=!0,s=!1,o=void 0;try{for(var a,l=n[Symbol.iterator]();!(i=(a=l.next()).done);i=!0){var c=a.value;if(""===c)r++;else{if(r){var u=Math.round(6e4/(r*this.bpm)/X.pause);u<=2?t.push(Array.from({length:u},function(){return"-"}).join(" ")):t.push("\n\n".repeat(Math.round(u/2))),r=0}t.push(c)}}}catch(e){s=!0,o=e}finally{try{i||null==l.return||l.return()}finally{if(s)throw o}}return t.join(" ").trim()},n.addChunk=function(e,n){var t,r=Array.from({length:Math.floor(n/X.pause)},function(){return new W(0,[])});(t=this.chunks).push.apply(t,[e].concat((0,B._)(r)))},e.from=function(n){n=n.clone();var t=new e(n.bpm);if(n instanceof G.M){var r=n.notes.shift();if(!r)return t;var i=[r],s=r.time,o=!0,a=!1,l=void 0;try{for(var c,u=n.notes[Symbol.iterator]();!(o=(c=u.next()).done);o=!0){var h,d,m=c.value;if(m.time-(null!==(d=null===(h=i[0])||void 0===h?void 0:h.time)&&void 0!==d?d:0)<=X.joined)i.push(m);else{var f=m.time-s,p=new W(0,[Q.from(i.splice(0,i.length))]);t.addChunk(p,f),i.push(m)}s=m.time}}catch(e){a=!0,l=e}finally{try{o||null==u.return||u.return()}finally{if(a)throw l}}var g=n.notes[n.notes.length-1].time-s,v=new W(0,[Q.from(i)]);t.addChunk(v,g)}else if(n instanceof D.l){var x=n.columns,_=x[0];if(!_)return t;var y=[],k=_.tempoChanger,w=!0,j=!1,b=void 0;try{for(var C,S=x[Symbol.iterator]();!(w=(C=S.next()).done);w=!0){var N=C.value;if(0===k&&0===N.tempoChanger)t.addChunk(W.from([N]),0);else if(k>N.tempoChanger){y.push(N);var z=W.from(y.splice(0,y.length));z.endingTempoChanger=N.tempoChanger,t.addChunk(z,0)}else k<N.tempoChanger&&(0===k||t.addChunk(W.from(y.splice(0,y.length)),0)),y.push(N);k=N.tempoChanger}}catch(e){j=!0,b=e}finally{try{w||null==S.return||S.return()}finally{if(j)throw b}}y.length&&t.addChunk(W.from(y.splice(0,y.length)),0);for(var T=-1,L=0;L<t.chunks.length;L++)t.chunks[L].columns.some(function(e){return e.notes.length>0})&&(-1===T&&(t.chunks.splice(0,L),L=0),T=L);t.chunks.splice(T+1)}else console.error("Song type not supported");return t},e}(),K=function(){function e(n){(0,Z._)(this,e),this.note=n}return e.prototype.toText=function(e){var n,t;return"".concat((n=this.note,t=J.getNoteText(n,e,"C"),"Genshin"===o.iC?t.toLowerCase():t.toUpperCase()))},e.from=function(n){return new e(n.index)},e}(),U=new Map([[0,["",""]],[1,["(",")"]],[2,["[","]"]],[3,["{","}"]]]),Q=function(){function e(n){(0,Z._)(this,e),this.notes=n}return e.prototype.toText=function(e){return this.notes.map(function(n){return n.toText(e)}).join("")},e.from=function(n){return new e(n instanceof H.sg?n.notes.map(function(e){return K.from(e)}):n.map(function(e){return K.from(e)}))},e}(),W=function(){function e(n,t){(0,Z._)(this,e),this.tempoChanger=n,this.endingTempoChanger=n,this.columns=t}return e.prototype.toText=function(e){var n,t=(0,r._)(null!==(n=U.get(this.tempoChanger))&&void 0!==n?n:["",""],2),i=t[0],s=t[1],o=this.columns.map(function(n){return n.toText(e)}).join(" ").trim();return o?"".concat(i).concat(o).concat(s):""},e.from=function(n,t){var r;return void 0===(t=null!=t?t:null===(r=n[0])||void 0===r?void 0:r.tempoChanger)&&console.log("tempoChanger is undefined",n,t),new e(null!=t?t:0,n.map(function(e){return Q.from(e)}))},e}();function q(){var e=function(e){if(A.current){var n,t=p+e,r=null===(n=A.current.children[0])||void 0===n?void 0:n.children[0];r&&!(t<1)&&(r.getBoundingClientRect().width<50&&1===e||g(t))}},n=(0,r._)((0,L.F)(),1)[0],t=(0,r._)((0,s.useState)(null),2),d=t[0],m=t[1],f=(0,r._)((0,s.useState)(7),2),p=f[0],g=f[1],v=(0,r._)((0,s.useState)(null),2),x=v[0],_=v[1],y=(0,r._)((0,s.useState)(!1),2),k=y[0],w=y[1],j=(0,r._)((0,s.useState)(""),2),C=j[0],N=j[1],P=(0,r._)((0,s.useState)("Genshin"===o.iC?"Keyboard layout":"ABC"),2),I=P[0],E=P[1],A=(0,s.useRef)(null),R=(0,s.useCallback)(function(e,n){try{var t=b.v.parseSong(e);if(!(0,a.$9)(t))return h.kg.error("Invalid song, it is not composed or recorded");try{var r=Y.from(t);m(r),N(r.toText(n))}catch(e){console.error(e),h.kg.error("Error converting song to visual song, trying to convert to recorded song first...");try{var i=Y.from(t.toRecordedSong());m(i),N(i.toText(n))}catch(e){console.error(e),h.kg.error("Error converting song to visual song"),m(null),N("")}}}catch(e){console.error(e),h.kg.error("Error visualizing song")}c.Z.songEvent({type:"visualize"})},[]);return(0,s.useEffect)(function(){x&&R(x,I)},[x,k,I,R]),(0,i.jsxs)(T.k,{excludeMenu:!0,menu:(0,i.jsx)(S,{onSongLoaded:_,currentSong:x}),children:[(0,i.jsx)(z.D,{text:"Sheet Visualizer",description:"Learn a sheet in a visual way, convert the song into text format or print it as pdf"}),(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",flexDirection:"column"},children:[(0,i.jsxs)("div",{className:"".concat(O()["visualizer-buttons-wrapper"]," noprint"),children:[(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[(0,i.jsx)("div",{children:"Note names"}),(0,i.jsx)(l.Z,{checked:k,onChange:w}),k&&(0,i.jsx)(F.P,{value:I,onChange:function(e){return E(e.target.value)},children:o.HI.map(function(e){return(0,i.jsx)("option",{value:e,children:e},e)})})]}),(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:["Per row: ",p,(0,i.jsx)("button",{className:O()["visualizer-plus-minus"],onClick:function(){return e(-1)},children:"-"}),(0,i.jsx)("button",{className:O()["visualizer-plus-minus"],onClick:function(){return e(1)},children:"+"})]})]}),(0,i.jsx)("h1",{className:"onprint",style:{color:"black"},children:x?null==x?void 0:x.name:""}),(0,i.jsxs)("div",{style:{width:"100%"},className:"noprint",children:[(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,i.jsx)("h2",{className:"text-ellipsis",children:x?x.name:"No song selected"}),x&&(0,i.jsx)(u.J,{onClick:function(){return window.print()},style:{minWidth:"fit-content",marginLeft:"0.4rem"},children:"Print as PDF"})]}),(0,i.jsx)("div",{style:{color:"var(--background-text)"},children:"Select a song from the menu on the left. Remember that you can learn a song with the interactive practice tool in the Player"})]}),(0,i.jsx)("div",{className:O()["visualizer-frame-wrapper"],style:{gridTemplateColumns:"repeat(".concat(p,",1fr)")},ref:A,children:d&&d.chunks.map(function(e,t){return(0,i.jsx)(V,{chunk:e,rows:3,theme:n,hasText:k,keyboardLayout:I},t)})}),C.trim().length>0&&(0,i.jsx)("pre",{className:O()["text-notation-wrapper"],children:C})]})]})}},7114:function(e){e.exports={"switch-wrapper":"Switch_switch-wrapper__sXQsI","switch-inner":"Switch_switch-inner__vcK6i","switch-inner-on":"Switch_switch-inner-on__BXwhZ"}},7600:function(e){e.exports={"instrument-picker":"Settings_instrument-picker__W7kvG",select:"Settings_select__Io3_h","settings-group-title":"Settings_settings-group-title__JR_FV","settings-row":"Settings_settings-row__N_hAE",invalid:"Settings_invalid__H_Utp","settings-input":"Settings_settings-input__keTYI","settings-input-button":"Settings_settings-input-button__CV1P1"}},8571:function(e){e.exports={"visualizer-frame":"SheetFrame_visualizer-frame__hKOAF","frame-outer-background":"SheetFrame_frame-outer-background__JvXAX","frame-outer":"SheetFrame_frame-outer__zmvyW","frame-outer-smaller":"SheetFrame_frame-outer-smaller__4lkX_","frame-note-s":"SheetFrame_frame-note-s__NV3o0","frame-note-ns":"SheetFrame_frame-note-ns__IOvrz","visualizer-ball":"SheetFrame_visualizer-ball__gDeJV"}},2344:function(e){e.exports={"visualizer-plus-minus":"SheetVisualizer_visualizer-plus-minus__hbX5w","visualizer-buttons-wrapper":"SheetVisualizer_visualizer-buttons-wrapper__bdwQ7","visualizer-frame-wrapper":"SheetVisualizer_visualizer-frame-wrapper__ocN0J","text-notation-wrapper":"SheetVisualizer_text-notation-wrapper__F5ljw","frame-note-s":"SheetVisualizer_frame-note-s__opZLA","frame-outer":"SheetVisualizer_frame-outer__OeiKz"}}},function(e){e.O(0,[962,774,888,179],function(){return e(e.s=5891)}),_N_E=e.O()}]);