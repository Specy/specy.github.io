(this["webpackJsonpgenshin-music"]=this["webpackJsonpgenshin-music"]||[]).push([[0],{102:function(e,t,n){},203:function(e,t,n){},204:function(e,t,n){},207:function(e,t,n){"use strict";n.r(t);var a=n(3),s=n.n(a),r=n(4),o=n(5),i=n(8),c=n(11),l=n(10),u=n(2),d=n.n(u),h=n(84),p=n.n(h),g=n(25),b=n(24),m=(n(58),n(102),n(17)),f="Genshin";console.log("".concat(f,"-V").concat("2.0"));var v={noteComposer:"Genshin"===f?"note-composer":"note-composer-sky",note:"Genshin"===f?"note":"note-sky",noteAnimation:"Genshin"===f?"note-animation":"note-animation-sky",approachCircle:"Genshin"===f?"approach-circle":"approach-circle-sky",noteName:"Genshin"===f?"note-name":"note-name-sky"},j=new(window.AudioContext||window.webkitAudioContext),x="Genshin"===f?["Lyre","DunDun","Zither"]:["Piano","Contrabass","Guitar","Harp","Horn","Trumpet","Pipa","WinterPiano","Xylophone","Flute","Ocarina","Kalimba","ToyUkulele","Drum","Bells","DunDun","HandPan"],y="Genshin"===f?21:15,O={Lyre:{notes:21},Zither:{notes:21,effects:{filter:"sepia(100%)"}},DunDun:{notes:8},Bells:{notes:8},Trumpet:{notes:15},Contrabass:{notes:15},Drum:{notes:8},Flute:{notes:15},Guitar:{notes:15},HandPan:{notes:8},ToyUkulele:{notes:15},Harp:{notes:15},Horn:{notes:15},Piano:{notes:15},Pipa:{notes:15},Kalimba:{notes:15},WinterPiano:{notes:15},Xylophone:{notes:15},Ocarina:{notes:15}},k={21:{keyboardLayout:"Q W E R T Y U A S D F G H J Z X C V B N M".split(" "),mobileLayout:"do re mi fa so la ti do re mi fa so la ti do re mi fa so la ti".split(" "),keyboardCodes:"81 87 69 82 84 89 85 65 83 68 70 71 72 74 90 88 67 86 66 78 77".split(" ")},8:{keyboardLayout:"Q W E R A S D F".split(" "),mobileLayout:"do re mi fa do re mi fa".split(" "),keyboardCodes:"81 87 69 82 65 83 68 70".split(" ")},15:{keyboardLayout:"Q W E R T A S D F G Z X C V B".split(" "),mobileLayout:"do re mi fa so do re mi fa so do re mi fa so".split(" "),keyboardCodes:"81 87 69 82 84 65 83 68 70 71 90 88 67 86 66".split(" ")}},w={Sky:{0:["C","D","E","F","G","A","B","C","D","E","F","G","A","B","C"],1:["Db","Eb","F","Gb","Ab","Bb","C","Db","Eb","F","Gb","Ab","Bb","C","Db"],2:["D","E","F#","G","A","B","C#","D","E","F#","G","A","B","C#","D"],3:["Eb","F","G","Ab","Bb","C","D","Eb","F","G","Ab","Bb","C","D","Eb"],4:["E","F#","G#","A","B","C#","D#","E","F#","G#","A","B","C#","D#","E"],5:["F","G","A","Bb","C","D","E","F","G","A","Bb","C","D","E","F"],6:["Gb","Ab","Bb","Cb","Db","Eb","F","Gb","Ab","Bb","Cb","Db","Eb","F","Gb"],7:["G","A","B","C","D","E","F#","G","A","B","C","D","E","F#","G"],8:["Ab","Bb","C","Db","Eb","F","G","Ab","Bb","C","Db","Eb","F","G","Ab"],9:["A","B","C#","D","E","F#","G#","A","B","C#","D","E","F#","G#","A"],10:["Bb","C","D","Eb","F","G","A","Bb","C","D","Eb","F","G","A","Bb"],11:["B","C#","D#","E","F#","G#","A#","B","C#","D#","E","F#","G#","A#","B"]},Genshin:{0:["C","D","E","F","G","A","B","C","D","E","F","G","A","B","C","D","E","F","G","A","B"],1:["Db","Eb","F","Gb","Ab","Bb","C","Db","Eb","F","Gb","Ab","Bb","C","Db","Eb","F","Gb","Ab","Bb","C","Db"],2:["D","E","F#","G","A","B","C#","D","E","F#","G","A","B","C#","D","E","F#","G","A","B","C#","D"],3:["Eb","F","G","Ab","Bb","C","D","Eb","F","G","Ab","Bb","C","D","Eb","F","G","Ab","Bb","C","D","Eb"],4:["E","F#","G#","A","B","C#","D#","E","F#","G#","A","B","C#","D#","E","F#","G#","A","B","C#","D#","E"],5:["F","G","A","Bb","C","D","E","F","G","A","Bb","C","D","E","F","G","A","Bb","C","D","E","F"],6:["Gb","Ab","Bb","Cb","Db","Eb","F","Gb","Ab","Bb","Cb","Db","Eb","F","Gb","Ab","Bb","Cb","Db","Eb","F","Gb"],7:["G","A","B","C","D","E","F#","G","A","B","C","D","E","F#","G","A","B","C","D","E","F#","G"],8:["Ab","Bb","C","Db","Eb","F","G","Ab","Bb","C","Db","Eb","F","G","Ab","Bb","C","Db","Eb","F","G","Ab"],9:["A","B","C#","D","E","F#","G#","A","B","C#","D","E","F#","G#","A","B","C#","D","E","F#","G#","A"],10:["Bb","C","D","Eb","F","G","A","Bb","C","D","Eb","F","G","A","Bb","C","D","Eb","F","G","A","Bb"],11:["B","C#","D#","E","F#","G#","A#","B","C#","D#","E","F#","G#","A#","B","C#","D#","E","F#","G#","A#","B"]}},S=[.25,.5,.75,1,1.25,1.5,2].map((function(e){return{name:"x".concat(e),value:e}})),C=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"],N="Genshin"===f?[14,15,16,17,18,19,20,7,8,9,10,11,12,13,0,1,2,3,4,5,6].reverse():[15,16,17,18,19,20,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14].reverse(),A="Genshin"===f?[14,15,16,17,18,19,20,7,8,9,10,11,12,13,0]:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14],E={15:"dmcr dm cr dm cr cr dm dmcr dm cr cr dm cr dm dmcr".split(" "),8:"Sky"===f?"cr dm cr dm cr dm cr dm".split(" "):"do re mi fa do re mi fa".split(" "),21:"do re mi fa so la ti do re mi fa so la ti do re mi fa so la ti".split(" ")},T=n(96),D=function e(){var t=this;Object(o.a)(this,e),this.init=function(){t.start=(new Date).getTime()-100,console.log("Started new recording")},this.addNote=function(e){0===t.notes.length&&t.init();var n=[e,(new Date).getTime()-t.start];t.notes.push(n)},this.start=(new Date).getTime(),this.notes=[]},P=function e(t){var n=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object(o.a)(this,e),this.name=t,this.version=1,this.notes=a,this.bpm=220,this.pitch="C",this.data={isComposed:!1,isComposedVersion:!1,appName:f},Object.entries(s).forEach((function(e){n.data[e[0]]=e[1]}))},M=function e(t,n,a){var s=this;Object(o.a)(this,e),this.trigger=function(){window.dispatchEvent(s.event)},this.title=t,this.timeout=a,this.text=n,void 0===a&&(this.timeout=3e3),this.event=new CustomEvent("logEvent",{detail:{title:this.title,text:this.text,timeout:this.timeout}})},B=function e(t){var n=this;Object(o.a)(this,e),this.download=function(e,t){var a=n.dataType+encodeURIComponent(e),s=document.createElement("a");s.style="display:none",document.body.appendChild(s),s.setAttribute("href",a),s.setAttribute("download",t),s.click(),s.remove()},void 0===t&&(t="text/json"),this.dataType="data:"+t+";charset=utf-8,"},R=[{id:0,text:"1",changer:1,color:5332079},{id:1,text:"1/2",changer:.5,color:5338451},{id:2,text:"1/4",changer:1/4,color:4410493},{id:3,text:"1/8",changer:1/8,color:7818605}],L=function e(t){var n=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object(o.a)(this,e),s.isComposed=!0,s.isComposedVersion=!0,this.version=1,this.data=s,this.name=t,this.bpm=220,this.pitch="C",this.notes=a,this.instruments=[x[0],x[0],x[0]],this.breakpoints=[0],this.columns=[],this.selected=0,new Array(100).fill().forEach((function(e){var t=new _;t.tempoChanger=0,n.columns.push(t)}))};function F(e){return new Array(e).fill().map((function(){return[]}))}function I(e){var t,n,a,s={data:e.data,name:e.name,bpm:null!==(t=e.bpm)&&void 0!==t?t:220,pitch:null!==(n=e.pitch)&&void 0!==n?n:"C",instruments:e.instruments||[x[0],x[0],x[0]],breakpoints:null!==(a=e.breakpoints)&&void 0!==a?a:[],notes:[],selected:0,columns:[]};return e.columns.forEach((function(e){var t=new _;t.tempoChanger=e[0],e[1].forEach((function(e){t.notes.push(new J(e[0],e[1]))})),s.columns.push(t)})),s}function G(e){var t=new P(e.name),n=Math.floor(6e4/e.bpm),a=100;return e.columns.forEach((function(e){e[1].forEach((function(e){t.notes.push([e[0],a])})),a+=Math.floor(n*R[e[0]].changer)})),t}function V(e){var t={data:e.data,name:e.name,bpm:e.bpm,pitch:e.pitch,breakpoints:e.breakpoints,instruments:e.instruments,columns:[]};return t.data.appName=f,e.columns.forEach((function(e){var n=[e.tempoChanger],a=e.notes.map((function(e){return[e.index,e.layer]}));n[1]=a,t.columns.push(n)})),t}function W(e){var t,n=JSON.parse(JSON.stringify(e)),a={};return a=(null===(t=n.data)||void 0===t?void 0:t.isComposedVersion)?function(e){var t=[],n=Math.floor(6e4/e.bpm),a=100;return e.columns.forEach((function(e){e[1].forEach((function(e){var n=1;"111"===e[1]&&(n=3),"011"===e[1]&&(n=2),"101"===e[1]&&(n=3),"001"===e[1]&&(n=2),"110"===e[1]&&(n=3),"010"===e[1]&&(n=2),"100"===e[1]&&(n=1);var s={key:(n>2?2:n)+"Key"+e[0],time:a};n>2&&(s.l=3),t.push(s)})),a+=Math.floor(n*R[e[0]].changer)})),t}(n):function(e){var t=[];return e.notes.forEach((function(e){t.push({time:e[1],key:"1Key"+e[0]})})),t}(n),n.isComposed=n.data.isComposedVersion,n.pitchLevel=z.indexOf(n.pitch),n.songNotes=a,n.bitsPerPage=16,n.isEncrypted=!1,[n]}function U(e){var t,n;Array.isArray(e)&&e.length>0&&(e=e[0]);var a=function(e){try{if(void 0!==e.data)return e.data.isComposedVersion?"string"!==typeof e.name||"number"!==typeof e.bpm?"none":z.includes(e.pitch)&&Array.isArray(e.breakpoints)?e.breakpoints.length>0&&"number"!==typeof e.breakpoints[0]?"none":Array.isArray(e.columns)?e.columns.length>0&&"number"!==typeof e.columns[0][0]?"none":"newComposed":"none":"none":"string"!==typeof e.name||"number"!==typeof e.bpm?"none":z.includes(e.pitch)?"newRecorded":"none";if(e.pitchLevel=e.pitchLevel||0,void 0!==e.songNotes)return"oldSky"}catch(t){return console.log(t),"none"}return"none"}(e);if("none"===a)throw new M("Error","Invalid song").trigger(),new Error("Error Invalid song");if("oldSky"===a&&(e=function(e){var t=new P("Error");try{(t=new P(e.name)).bpm=e.bpm||220,t.pitch=z[e.pitchLevel||0]||"C",e.songNotes=e.songNotes.filter((function(e,t,n){return t===n.findIndex((function(t){return t.key.split("Key")[1]===e.key.split("Key")[1]&&t.time===e.time}))})),e.songNotes.forEach((function(e){var n,a=e.key.split("Key");t.notes.push([H[a[1]],e.time,null!==(n=e.l)&&void 0!==n?n:Number(a[0])])})),[!0,"true"].includes(e.isComposed)?t=V(K(t)):t.notes=t.notes.map((function(e){return[e[0],e[1]]}))}catch(n){return console.log(n),new P("Error importing")}return t}(e)),"Sky"===f&&"Sky"!==(null===(t=e.data)||void 0===t?void 0:t.appName))throw new M("Error","Invalid song").trigger(),new Error("Error Invalid song");return"Genshin"===f&&"Sky"===(null===(n=e.data)||void 0===n?void 0:n.appName)&&(e=function(e){e.data.isComposedVersion&&(e.instruments=e.instruments.map((function(e){return"Lyre"})),e.columns.forEach((function(e){e[1]=e[1].map((function(e){return[H[e[0]],e[1]]}))})));e.data.isComposedVersion||(e.notes=e.notes.map((function(e){return e[0]=H[e[0]],e})));return e}(e)),e}var H=A;function K(e){var t=Math.floor(6e4/e.bpm),n=new L(e.name,[]);n.bpm=e.bpm,n.pitch=e.pitch;for(var a=e.notes,s=[],r=function(e,t){var n=[];for(;e.length>0;){for(var a=[e.shift()],s=0,r=0;r<e.length;r++)a[0][1]>e[r][1]-t&&s++;n.push([].concat(a,Object(m.a)(e.splice(0,s))))}return n}(a,t/9),o=[t,Math.floor(t/2),Math.floor(t/4),Math.floor(t/8)],i=function(e){var t=new _;t.notes=r[e].map((function(e){var t=new J(e[0]);return 0===e[2]&&(t.layer="100"),1===e[2]&&(t.layer="100"),2===e[2]&&(t.layer="010"),3===e[2]&&(t.layer="110"),void 0===e[2]&&(t.layer="100"),t}));for(var n=(r[e+1]||[[0,0,0]])[0][1]-r[e][0][1],a=[];n>=o[3];)n/o[0]>=1?(n-=o[0],a.push(0)):n/o[1]>=1?(n-=o[1],a.push(1)):n/o[2]>=1?(n-=o[2],a.push(2)):n/o[3]>=1&&(n-=o[3],a.push(3));var i=[];t.tempoChanger=a.shift()||0,a=a.forEach((function(e,t){var n=new _;n.tempoChanger=e,i.push(n)})),s.push.apply(s,[t].concat(i))},c=0;c<r.length;c++)i(c);return n.columns=s,n}var _=function e(){Object(o.a)(this,e),this.notes=[],this.tempoChanger=0};var J=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"000";Object(o.a)(this,e),this.index=t,this.layer=n},z=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"];function Y(e){var t=z.indexOf(e);return t<0&&(t=0),Number(Math.pow(2,t/12).toFixed(4))}function q(e){return new Promise((function(t){T.a(t,e)}))}var Z=n(1);function $(e){var t="Sky"===f?5:7;return["#3da399","#ffb347","#3da399"][Math.floor(e/t)]}function Q(e){return Object(Z.jsx)("div",{className:v.approachCircle,style:{animation:"approach ".concat(e.approachRate,"ms linear"),borderColor:$(e.index)}})}var X=function(e){Object(c.a)(n,e);var t=Object(l.a)(n);function n(e){var a;return Object(o.a)(this,n),(a=t.call(this,e)).state={},a}return Object(i.a)(n,[{key:"render",value:function(){var e,t=this.props,n=t.data,a=t.approachingNotes,s=t.outgoingAnimation,r=n.status,o=n.approachRate,i=n.instrument,c={transition:"background-color ".concat((t.fadeTime/1e3).toFixed(2),"s, transform 0.15s")},l=function(e){var t=v.note;"clicked"===e&&(t+=" click-event");"toClick"===e&&(t+=" note-red");"toClickNext"===e&&(t+=" note-border-click");"toClickAndNext"===e&&(t+=" note-red note-border-click");"approach-wrong"===e&&(t+=" click-event approach-wrong");"approach-correct"===e&&(t+=" click-event approach-correct");return t}(r),u=(null===(e=O[i])||void 0===e?void 0:e.effects)||{};return Object(Z.jsxs)("button",{onPointerDown:function(e){e.preventDefault(),t.handleClick(n)},className:"button-hitbox-bigger",children:[a.map((function(e){return Object(Z.jsx)(Q,{index:n.index,approachRate:o},e.id)})),s.map((function(e){return Object(Z.jsx)("div",{className:v.noteAnimation},e.key)})),Object(Z.jsxs)("div",{className:l,style:c,children:[Object(Z.jsx)("img",{draggable:"false",alt:"",src:t.noteImage,style:u}),Object(Z.jsx)("div",{className:v.noteName,children:t.noteText})]})]})}}]),n}(u.Component),ee=n(44),te=Object(ee.a)({data:{song:{},eventType:"",start:0}}),ne=n(7),ae=n(6),se=function(e){Object(c.a)(n,e);var t=Object(l.a)(n);function n(e){var a;Object(o.a)(this,n),(a=t.call(this,e)).approachingSong=function(){var e=Object(r.a)(s.a.mark((function e(t){var n,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=[],a.approachRate=a.props.data.approachRate||1500,r=a.approachRate,t.notes.forEach((function(e){var t={time:Math.floor(e[1]/a.state.speedChanger.value+r),index:e[0]};n.push(t)})),a.setState({approachingNotes:F("Sky"===f?15:21),approachingScore:{correct:1,wrong:1,score:0,combo:0}}),a.changeSliderState(0,n.length),a.approachingNotesList=n;case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.tick=function(){if(a.props.data.hasSong){var e=a.state,t=e.approachingNotes,n=e.sliderState,s=e.approachingScore,r=e.speedChanger,o=t,i=a.approachingNotesList;i.forEach((function(e){e.time-=a.tickTime}));for(var c=!1,l=0,u=0;u<i.length&&i[u].time<a.approachRate;u++)o[i[u].index].push({clicked:!1,time:a.approachRate,id:Math.floor(1e4*Math.random())}),i.splice(u,1),u--,c=!0;o.forEach((function(e){for(var t=0;t<e.length;t++){var n=e[t];n.time-=a.tickTime,n.clicked&&(n.time<a.approachRate/3?(s.correct++,s.combo++,s.score+=s.combo*r.value):(s.wrong++,s.combo=0),n.time=-1),n.time<0&&(n.clicked||(s.wrong++,s.combo=0),e.splice(t,1),t--,c=!0,l++)}})),c&&(a.changeSliderState(n.position+l),a.setState({approachingNotes:o,approachingScore:s}))}},a.playSong=function(){var e=Object(r.a)(s.a.mark((function e(t){var n,r,o,i,c,l,u,d,h,p=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=p.length>1&&void 0!==p[1]?p[1]:0,a.songTimestamp=t.timestamp,r=a.state.keyboard,0!==(o=a.applySpeedChange(t.notes)).length){e.next=6;break}return e.abrupt("return");case 6:i=o[0][1],c=0,l=(new Date).getTime(),u=n;case 10:if(!(u<o.length)){e.next=27;break}if(d=o[u][1]-i,i=o[u][1],h=o[u][0],l=(new Date).getTime(),!(d>16)){e.next=18;break}return e.next=18,q(d-c);case 18:if(a.songTimestamp===t.timestamp){e.next=20;break}return e.abrupt("return");case 20:r[h].status="clicked",a.handleClick(r[h]),a.setState({keyboard:r,sliderState:{position:u+1,size:o.length}}),c=(new Date).getTime()-l-d;case 24:u++,e.next=10;break;case 27:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.applySpeedChange=function(e){return e.map((function(e){return e[1]=e[1]/a.state.speedChanger.value,e}))},a.practiceSong=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=a.state.keyboard,s=a.applySpeedChange(e.notes),r=s.length;s.splice(0,t);for(var o=[],i=0;s.length>0;i++){for(var c={notes:[s.shift()],delay:0},l=c.notes.length>0?c.notes[0][1]:0,u=0;u<s.length&&u<20;u++){var d=s[u][1]-c.notes[0][1]-50;d<0&&(c.notes.push(s.shift()),u--)}c.delay=s.length>0?s[0][1]-l:0,o.push(c)}if(0!==o.length){var h=o[0];a.nextChunkDelay=h.delay;var p=o[1];h.notes.forEach((function(e){n[e[0]].status="toClick"})),null===p||void 0===p||p.notes.forEach((function(e){var t=n[e[0]];if("toClick"===t.status)return t.status="toClickAndNext";t.status="toClickNext"})),a.props.functions.setHasSong(!0),a.setState({songToPractice:o,keyboard:n,sliderState:{position:t,size:r}})}},a.handleSpeedChanger=function(e){var t=S.find((function(t){return t.name===e}));a.setState({speedChanger:t},a.restartSong)},a.restartSong=Object(r.a)(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=JSON.parse(JSON.stringify(te.data)),e.next=3,a.stopSong();case 3:setTimeout((function(){var e=te.data.start;"practice"===te.data.eventType&&(e=a.state.sliderState.position),te.data=Object(g.a)(Object(g.a)({},t),{},{start:e})}),200);case 4:case"end":return e.stop()}}),e)}))),a.stopSong=function(){return new Promise((function(e){a.songTimestamp=0;var t=a.state.keyboard;t.forEach((function(e){e.status="",e.delay=200})),a.approachingNotesList=[],a.setState({keyboard:t,songToPractice:[],approachingNotes:F("Sky"===f?15:21)},e),a.props.functions.setHasSong(!1)}))},a.handleSliderEvent=function(e){a.changeSliderState(Number(e.target.value))},a.changeSliderState=function(){var e=Object(r.a)(s.a.mark((function e(t){var n,r=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=r.length>1&&void 0!==r[1]?r[1]:a.state.sliderState.size,a.setState({sliderState:{position:t,size:n}});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.handleKeyboard=function(e){var t,n=a.state.keyboard;if(!e.repeat&&"INPUT"!==document.activeElement.tagName){var s=null===(t=e.code)||void 0===t?void 0:t.replace("Key",""),r=n[a.props.data.keyboard.getNoteFromCode(s)];r&&a.handleClick(r)}},a.handleApproachClick=function(e){var t=a.state.approachingNotes[e.index][0];return t&&(t.clicked=!0,t.time<a.approachRate/3)?"approach-correct":"approach-wrong"},a.handlePracticeClick=function(e){var t=a.state,n=t.keyboard,s=t.songToPractice,r=t.sliderState;if(s.length>0){var o,i=null===(o=s[0])||void 0===o?void 0:o.notes.findIndex((function(t){return t[0]===e.index}));if(-1!==i){if(s[0].notes.splice(i,1),0===s[0].notes.length&&s.shift(),0===s.length)a.stopSong(),te.data={song:{},eventType:"stop",start:0};else{var c=s[0],l=s[1];c.notes.forEach((function(e){n[e[0]].status="toClick"})),a.nextChunkDelay=c.delay,null===l||void 0===l||l.notes.forEach((function(e){var t=n[e[0]];if(n[e[0]].delay=c.delay,"toClick"===t.status)return t.status="toClickAndNext";t.status="toClickNext"}))}a.setState({songToPractice:s,sliderState:{size:r.size,position:r.position+1}})}}},a.handleClick=function(e,t){var n=a.state,s=n.keyboard,r=n.outgoingAnimation,o=a.props.data.hasAnimation;s[e.index].status="clicked",s[e.index].delay=200,a.handlePracticeClick(e);var i=a.handleApproachClick(e);if("approaching"===te.data.eventType&&(s[e.index].status=i),o&&"approaching"!==te.data.eventType){var c=Math.floor(1e4*Math.random())+(new Date).getTime();r[e.index].push({key:c})}a.setState(Object(g.a)({keyboard:s},o?r:{}),(function(){setTimeout((function(){if(o&&"approaching"!==te.data.eventType){var t=a.state.outgoingAnimation;t[e.index].shift(),a.setState({outgoingAnimation:t})}}),750)})),setTimeout((function(){["clicked","approach-wrong","approach-correct"].includes(s[e.index].status)&&(s[e.index].status="",a.setState({keyboard:s}))}),"Sky"===f?250:100),a.props.functions.playSound(e)};var i=a.props.data.keyboard;return i.layout.forEach((function(e){e.status=""})),a.state={playTimestamp:(new Date).getTime(),songToPractice:[],approachingNotes:F("Sky"===f?15:21),outgoingAnimation:F("Sky"===f?15:21),keyboard:i.layout,sliderState:{position:0,size:0},approachingScore:{correct:1,wrong:1,score:0,combo:0},speedChanger:S.find((function(e){return"x1"===e.name}))},a.approachRate=1500,a.approachingNotesList=[],a.songTimestamp=0,a.nextChunkDelay=0,a.disposeStore=function(){},a.tickTime=50,a.tickInterval=0,a}return Object(i.a)(n,[{key:"componentDidMount",value:function(){var e=this;window.addEventListener("keydown",this.handleKeyboard),this.tickInterval=setInterval(this.tick,this.tickTime),this.disposeStore=Object(ee.b)(te,function(){var t=Object(r.a)(s.a.mark((function t(n){var a,r,o,i,c;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=n.object.data,o=r.eventType,i=JSON.parse(JSON.stringify(r.song)),(null===(a=i.data)||void 0===a?void 0:a.isComposedVersion)&&(i=G(i)),i.timestamp=(new Date).getTime(),c=!1,"play"!==o){t.next=11;break}return t.next=9,e.stopSong();case 9:e.playSong(i,r.start),c=!0;case 11:if("practice"!==o){t.next=16;break}return t.next=14,e.stopSong();case 14:e.practiceSong(i,r.start),c=!0;case 16:if("approaching"!==o){t.next=21;break}return t.next=19,e.stopSong();case 19:e.approachingSong(i,r.start),c=!0;case 21:if("stop"!==o){t.next=24;break}return t.next=24,e.stopSong();case 24:e.props.functions.setHasSong(c);case 25:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}},{key:"componentWillUnmount",value:function(){window.removeEventListener("keydown",this.handleKeyboard),this.disposeStore(),this.songTimestamp=0,clearInterval(this.tickInterval)}},{key:"render",value:function(){var e=this,t=this.state,n=this.props.data,a=t.keyboard,s=t.approachingScore,r=n.keyboardSize/100;r<.5&&(r=.5),r>1.5&&(r=1.5);var o="keyboard";return 15===a.length&&(o+=" keyboard-5"),8===a.length&&(o+=" keyboard-4"),Object(Z.jsxs)(Z.Fragment,{children:[n.hasSong&&Object(Z.jsxs)("div",{className:"upper-right",children:["approaching"===te.data.eventType&&Object(Z.jsx)(re,{data:s}),Object(Z.jsxs)("div",{className:"slider-wrapper",children:[Object(Z.jsx)("button",{className:"song-button",onClick:function(){e.stopSong(),te.data={song:{},eventType:"stop",start:0}},children:Object(Z.jsx)(ne.a,{icon:ae.s})}),Object(Z.jsx)("input",{type:"range",className:"slider",min:0,onChange:this.handleSliderEvent,max:t.sliderState.size,value:t.sliderState.position}),Object(Z.jsx)("button",{className:"song-button",onClick:function(){e.restartSong()},children:Object(Z.jsx)(ne.a,{icon:ae.t})}),Object(Z.jsxs)("select",{className:"slider-select",onChange:function(t){return e.handleSpeedChanger(t.target.value)},value:t.speedChanger.name,children:[Object(Z.jsx)("option",{disabled:!0,children:"Speed"}),S.map((function(e){return Object(Z.jsx)("option",{value:e.name,children:e.name},e.name)}))]})]})]}),Object(Z.jsx)("div",{className:o,style:{transform:"scale(".concat(r,")"),marginBottom:30*r-15},children:n.isLoading?Object(Z.jsx)("div",{className:"loading",children:"Loading..."}):a.map((function(s){var r=E[a.length][s.index],o=Object(g.a)(Object(g.a)({},s),{},{approachRate:e.approachRate,instrument:e.props.data.keyboard.instrumentName,isAnimated:"approaching"!==te.data.eventType&&e.props.data.hasAnimation});return Object(Z.jsx)(X,{data:o,approachingNotes:t.approachingNotes[s.index],outgoingAnimation:t.outgoingAnimation[s.index],handleClick:e.handleClick,noteText:oe(n.noteNameType,s.index,n.pitch,a.length),noteImage:"./assets/icons/keys/".concat(r,".svg")},s.index)}))})]})}}]),n}(u.Component);function re(e){var t=e.data,n=t.combo,a=t.score,s=t.correct,r=t.wrong;return Object(Z.jsx)("div",{className:"approaching-accuracy",children:Object(Z.jsx)("table",{children:Object(Z.jsxs)("tbody",{children:[Object(Z.jsxs)("tr",{children:[Object(Z.jsx)("td",{className:"sc-2",children:"Accuracy"}),Object(Z.jsxs)("td",{className:"sc-1",children:[(s/(s+r-1)*100).toFixed(1),"%"]})]}),Object(Z.jsxs)("tr",{children:[Object(Z.jsx)("td",{className:"sc-2",children:"Score"}),Object(Z.jsx)("td",{className:"sc-1",children:a})]}),Object(Z.jsxs)("tr",{children:[Object(Z.jsx)("td",{className:"sc-2",children:"Combo"}),Object(Z.jsx)("td",{className:"sc-1",children:n})]})]})})})}function oe(e,t,n,a){try{if("Note name"===e)return w[f][C.indexOf(n)][t];if("Keyboard layout"===e)return k[a].keyboardLayout[t];if("Do Re Mi"===e)return k[a].mobileLayout[t]}catch(s){}return""}var ie=se,ce=n(21),le=n(85),ue=n(37),de=n(46),he=n(86),pe=(n(59),n(45)),ge=n.p+"static/media/mainpage.53c2a740.png",be=n.p+"static/media/composer.69d0b59e.png",me=n.p+"static/media/songs.4892a692.png";function fe(){return Object(Z.jsxs)(Z.Fragment,{children:[Object(Z.jsx)("div",{className:"help-title",children:"Main page"}),Object(Z.jsxs)("div",{children:[Object(Z.jsx)("img",{src:ge,className:"help-img",alt:"tutorial for the main page"}),Object(Z.jsxs)("ol",{children:[Object(Z.jsx)("li",{children:"Record the keyboard as an audio file"}),Object(Z.jsx)("li",{children:"Current note position, you can change it to reload"}),Object(Z.jsx)("li",{children:"Playback speed"}),Object(Z.jsx)("li",{children:"Approaching circles score"}),Object(Z.jsx)("li",{children:"Approaching circle, click when it's close to the note"})]})]}),Object(Z.jsx)("div",{className:"help-title",children:"Songs menu"}),Object(Z.jsxs)("div",{children:[Object(Z.jsx)("img",{src:me,className:"help-img",alt:"tutorial for songs page"}),Object(Z.jsxs)("ol",{children:[Object(Z.jsx)("li",{children:"Open composer to create a song"}),Object(Z.jsx)("li",{children:"Import song (as json)"}),Object(Z.jsx)("li",{children:"Play song (click the name)"}),Object(Z.jsx)("li",{children:"Practice the song"}),Object(Z.jsx)("li",{children:"Play with the approaching circles mode"}),Object(Z.jsx)("li",{children:"Download the song (as json)"})]}),Object(Z.jsxs)("div",{className:"column",children:[Object(Z.jsxs)("div",{children:[Object(Z.jsx)(ne.a,{icon:ae.f})," = practice the song"]}),Object(Z.jsxs)("div",{children:[Object(Z.jsx)(de.a,{})," = Approaching circles mode"]}),Object(Z.jsxs)("div",{children:[Object(Z.jsx)(ne.a,{icon:ae.g})," = download the song"]})]})]}),Object(Z.jsx)("div",{className:"help-title",children:"Composer"}),Object(Z.jsxs)("div",{children:[Object(Z.jsx)("img",{src:be,className:"help-img",alt:"tutorial for composer"}),Object(Z.jsxs)("ol",{children:[Object(Z.jsx)("li",{children:"Go to the next / previous breakpoint"}),Object(Z.jsx)("li",{children:"Timeline of the breakpoints"}),Object(Z.jsx)("li",{children:"Open the tools"}),Object(Z.jsx)("li",{children:"Add 16 columns to the end"}),Object(Z.jsx)("li",{children:"Remove the current selected column"}),Object(Z.jsx)("li",{children:"Add column after the current one"}),Object(Z.jsx)("li",{children:"Change layer (instrument)"}),Object(Z.jsx)("li",{children:"Change column's duration"})]}),Object(Z.jsx)("div",{className:"help-title",children:"Composer shortcuts"}),Object(Z.jsx)("div",{style:{marginTop:"1.5rem"},children:"The composer has shortcuts for PC users:"}),Object(Z.jsx)("table",{className:"keys-table",children:Object(Z.jsxs)("tbody",{children:[Object(Z.jsxs)("tr",{children:[Object(Z.jsx)("td",{children:Object(Z.jsx)(ve,{children:"A / D"})}),Object(Z.jsx)("td",{children:" = move left / right"})]}),Object(Z.jsxs)("tr",{children:[Object(Z.jsx)("td",{children:Object(Z.jsx)(ve,{children:"1 / 2 / 3 / 4"})}),Object(Z.jsx)("td",{children:" = change tempo"})]}),Object(Z.jsxs)("tr",{children:[Object(Z.jsx)("td",{children:Object(Z.jsx)(ve,{children:"Space bar"})}),Object(Z.jsx)("td",{children:" = play / pause song"})]}),Object(Z.jsxs)("tr",{children:[Object(Z.jsx)("td",{children:Object(Z.jsx)(ve,{children:"Arrow Left"})}),Object(Z.jsx)("td",{children:" = go to previous breakpoint"})]}),Object(Z.jsxs)("tr",{children:[Object(Z.jsx)("td",{children:Object(Z.jsx)(ve,{children:"Arrow Right"})}),Object(Z.jsx)("td",{children:" = go to next breakpoint"})]}),Object(Z.jsxs)("tr",{children:[Object(Z.jsx)("td",{children:Object(Z.jsx)(ve,{children:"Arrow Up"})}),Object(Z.jsx)("td",{children:" = select previous layer"})]}),Object(Z.jsxs)("tr",{children:[Object(Z.jsx)("td",{children:Object(Z.jsx)(ve,{children:"Arrow Down"})}),Object(Z.jsx)("td",{children:" = select next layer "})]}),Object(Z.jsxs)("tr",{children:[Object(Z.jsx)("td",{children:Object(Z.jsx)(ve,{children:"Shift + Note"})}),Object(Z.jsx)("td",{children:" = Adds/remove a note in the column "})]}),Object(Z.jsxs)("tr",{children:[Object(Z.jsx)("td",{children:Object(Z.jsx)(ve,{children:"Q"})}),Object(Z.jsx)("td",{children:" = remove current column"})]}),Object(Z.jsxs)("tr",{children:[Object(Z.jsx)("td",{children:Object(Z.jsx)(ve,{children:"E"})}),Object(Z.jsx)("td",{children:" = add column "})]})]})}),"When playing a song, you can press on the PC keyboard to add notes"]})]})}function ve(e){return Object(Z.jsx)("div",{className:"keyboard-key",children:e.children})}var je=function(e){Object(c.a)(n,e);var t=Object(l.a)(n);function n(e){var a;return Object(o.a)(this,n),(a=t.call(this,e)).checkPersistentStorage=Object(r.a)(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!navigator.storage||!navigator.storage.persist){e.next=9;break}return e.next=3,navigator.storage.persisted();case 3:if(t=e.sent){e.next=8;break}return e.next=7,navigator.storage.persist();case 7:t=e.sent;case 8:a.setState({isPersistentStorage:t});case 9:case"end":return e.stop()}}),e)}))),a.handleSearchInput=function(e){a.setState({searchInput:e})},a.clearSearch=function(){a.setState({searchInput:"",searchedSongs:[],searchStatus:"Write a song name then search!"})},a.searchSongs=Object(r.a)(s.a.mark((function e(){var t,n,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=a.state,n=t.searchInput,"Searching..."!==t.searchStatus){e.next=3;break}return e.abrupt("return");case 3:if(0!==n.trim().length){e.next=5;break}return e.abrupt("return",a.setState({searchStatus:"Please write a non empty name"}));case 5:return a.setState({searchStatus:"Searching..."}),e.next=8,fetch("https://sky-music.herokuapp.com/api/songs?search="+encodeURI(n)).then((function(e){return e.json()}));case 8:if(!(r=e.sent).error){e.next=12;break}return a.setState({searchStatus:"Please write a non empty name"}),e.abrupt("return",new M("Error",r.error).trigger());case 12:a.setState({searchedSongs:r,searchStatus:"success"});case 13:case"end":return e.stop()}}),e)}))),a.toggleMenu=function(e){"boolean"!==typeof e&&(e=void 0);var t=void 0!==e?e:!a.state.open;a.setState({open:t})},a.selectSideMenu=function(e){if(e===a.state.selectedMenu&&a.state.open)return a.setState({open:!1});a.clearSearch(),a.setState({selectedMenu:e,open:!0})},a.changeSelectedSongType=function(e){a.setState({selectedSongType:e})},a.importSong=function(e){var t=new FileReader;t.addEventListener("load",function(){var t=Object(r.a)(s.a.mark((function t(n){var r,o,i,c,l,u;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:t.prev=0,r=JSON.parse(n.target.result),Array.isArray(r)||(r=[r]),o=Object(le.a)(r),t.prev=4,o.s();case 6:if((i=o.n()).done){t.next=13;break}return c=U(c=i.value),t.next=11,a.props.functions.addSong(c);case 11:t.next=6;break;case 13:t.next=18;break;case 15:t.prev=15,t.t0=t.catch(4),o.e(t.t0);case 18:return t.prev=18,o.f(),t.finish(18);case 21:t.next=30;break;case 23:if(t.prev=23,t.t1=t.catch(0),u=e.name,console.error(t.t1),!(null===u||void 0===u||null===(l=u.includes)||void 0===l?void 0:l.call(u,".mid"))){t.next=29;break}return t.abrupt("return",new M("Error","Midi files should be imported in the composer").trigger());case 29:new M("Error","Error importing song").trigger();case 30:case"end":return t.stop()}}),t,null,[[0,23],[4,15,18,21]])})));return function(e){return t.apply(this,arguments)}}()),t.readAsText(e)},a.downloadSong=function(e){e._id&&delete e._id;var t=e.name;"Sky"===f&&(e=W(e)),Array.isArray(e)||(e=[e]),e.forEach((function(e){e.data.appName=f}));var n=JSON.stringify(e);(new B).download(n,"".concat(t,".").concat(f.toLowerCase(),"sheet.json")),new M("Success","Song downloaded").trigger()},a.downloadAllSongs=function(){var e=[];a.props.data.songs.forEach((function(t){t._id&&delete t._id,"Sky"===f&&(t=W(t)),Array.isArray(t)?e.push.apply(e,Object(m.a)(t)):e.push(t)}));var t=new B,n=JSON.stringify(e),s=(new Date).toISOString().split("T")[0];t.download(n,"".concat(f,"_Backup_").concat(s,".json")),new M("Success","Song backup downloaded").trigger()},a.state={open:!1,selectedMenu:"Songs",selectedSongType:"recorded",searchInput:"",searchedSongs:[],searchStatus:"Write a song name then search!",isPersistentStorage:!1},a}return Object(i.a)(n,[{key:"componentDidMount",value:function(){this.checkPersistentStorage()}},{key:"render",value:function(){var e=this,t=this.state.open?"side-menu menu-open":"side-menu",n=this.props,a=n.data,s=n.functions,r=s.handleSettingChange;s.toggleMenu=this.toggleMenu,s.downloadSong=this.downloadSong;var o=this.props.functions.changePage,i=a.songs.filter((function(e){return!e.data.isComposedVersion})),c=a.songs.filter((function(e){return e.data.isComposedVersion})),l=this.state,u=l.searchStatus,d=l.searchedSongs,h=l.selectedMenu,p={importSong:s.addSong};return Object(Z.jsxs)("div",{className:"menu-wrapper",children:[Object(Z.jsxs)("div",{className:"menu menu-visible",children:[this.state.open&&Object(Z.jsx)(ye,{action:this.toggleMenu}),Object(Z.jsx)(we,{type:"Help",action:this.selectSideMenu,className:"margin-top-auto",children:Object(Z.jsx)(ne.a,{icon:ae.h,className:"icon"})}),Object(Z.jsx)(we,{type:"Library",action:this.selectSideMenu,children:Object(Z.jsx)(he.a,{className:"icon"})}),Object(Z.jsx)(we,{type:"Songs",action:this.selectSideMenu,children:Object(Z.jsx)(ne.a,{icon:ae.j,className:"icon"})}),Object(Z.jsx)(we,{type:"Settings",action:this.selectSideMenu,children:Object(Z.jsx)(ne.a,{icon:ae.d,className:"icon"})}),Object(Z.jsx)(we,{type:"Composer",action:function(){return o("Composer")},children:Object(Z.jsx)(ne.a,{icon:ae.e,className:"icon"})})]}),Object(Z.jsxs)("div",{className:t,children:[Object(Z.jsx)(xe,{title:"No selection",visible:h}),Object(Z.jsxs)(xe,{title:"Songs",visible:h,children:[Object(Z.jsxs)("div",{className:"songs-buttons-wrapper",children:[Object(Z.jsx)("button",{className:"genshin-button",onClick:function(){return o("Composer")},children:"Compose song"}),Object(Z.jsx)(pe.FilePicker,{onChange:function(t){return e.importSong(t)},children:Object(Z.jsx)("button",{className:"genshin-button",children:"Import song"})})]}),Object(Z.jsxs)("div",{className:"tab-selector-wrapper",children:[Object(Z.jsx)("button",{className:"recorded"===this.state.selectedSongType?"tab-selector tab-selected":"tab-selector",onClick:function(){return e.changeSelectedSongType("recorded")},children:"Recorded"}),Object(Z.jsx)("button",{className:"composed"===this.state.selectedSongType?"tab-selector tab-selected":"tab-selector",onClick:function(){return e.changeSelectedSongType("composed")},children:"Composed"})]}),Object(Z.jsx)("div",{className:"songs-wrapper",children:"recorded"===this.state.selectedSongType?i.map((function(e){return Object(Z.jsx)(ke,{data:e,functions:s},e.name)})):c.map((function(e){return Object(Z.jsx)(ke,{data:e,functions:s},e.name)}))}),Object(Z.jsx)("div",{style:{marginTop:"auto",paddingTop:"0.5rem",width:"100%",display:"flex",justifyContent:"flex-end"},children:Object(Z.jsx)("button",{className:"genshin-button",style:{marginLeft:"auto"},onClick:this.downloadAllSongs,children:"Download all songs (backup)"})})]}),Object(Z.jsxs)(xe,{title:"Settings",visible:h,children:[Object.entries(a.settings).map((function(e){var t=Object(ce.a)(e,2),n=t[0],a=t[1];return Object(Z.jsx)(Oe,{objKey:n,data:a,update:r},n+a.value)})),Object(Z.jsx)("div",{style:{marginTop:"1rem"},children:this.state.isPersistentStorage?"Storage is persisted":"Storage is not persisted"}),!Ce()&&Object(Z.jsx)("a",{className:"donate-button",href:"https://www.buymeacoffee.com/Specy",target:"_blank",rel:"noreferrer",children:"Support me"})]}),Object(Z.jsxs)(xe,{title:"Library",visible:h,children:[Object(Z.jsx)("div",{children:"Here you can find songs to learn, they are provided by the sky-music library."}),Object(Z.jsxs)("div",{className:"library-search-row",children:[Object(Z.jsx)("input",{className:"library-search-input",placeholder:"Song name",onKeyDown:function(t){"Enter"===t.code&&e.searchSongs()},onInput:function(t){return e.handleSearchInput(t.target.value)},value:this.state.searchInput}),Object(Z.jsx)("button",{className:"library-search-btn",onClick:this.clearSearch,children:Object(Z.jsx)(ne.a,{icon:ae.u})}),Object(Z.jsx)("button",{className:"library-search-btn",onClick:this.searchSongs,children:Object(Z.jsx)(ne.a,{icon:ae.p})})]}),Object(Z.jsx)("div",{className:"library-search-songs-wrapper",children:"success"===u?d.length>0?d.map((function(e){return Object(Z.jsx)(Se,{data:e,functions:p,children:e.name},e.file)})):Object(Z.jsx)("div",{className:"library-search-result-text",children:"No results"}):Object(Z.jsx)("div",{className:"library-search-result-text",children:u})})]}),Object(Z.jsxs)(xe,{title:"Help",visible:h,children:[Object(Z.jsxs)("div",{className:"help-icon-wrapper",children:[Object(Z.jsx)("a",{href:"https://discord.gg/Arsf65YYHq",children:Object(Z.jsx)(ue.a,{className:"help-icon"})}),Object(Z.jsx)("a",{href:"https://github.com/Specy/genshin-music",children:Object(Z.jsx)(ue.b,{className:"help-icon"})})]}),Object(Z.jsx)("div",{className:"go-to-changelog genshin-button",onClick:function(){return o("Changelog")},children:"Go to changelog"}),Object(Z.jsx)(fe,{}),!Ce()&&Object(Z.jsx)("a",{className:"donate-button",href:"https://www.buymeacoffee.com/Specy",target:"_blank",rel:"noreferrer",children:"Support me"})]})]})]})}}]),n}(u.Component);function xe(e){var t=e.visible===e.title?"menu-panel menu-panel-visible":"menu-panel";return Object(Z.jsxs)("div",{className:t,children:[Object(Z.jsx)("div",{className:"menu-title",children:e.title}),Object(Z.jsx)("div",{className:"panel-content-wrapper",children:e.children})]})}function ye(e){return Object(Z.jsx)("div",{onClick:function(){return e.action(!1)},className:"close-menu menu-item",children:Object(Z.jsx)(ne.a,{icon:ae.u,className:"icon"})})}function Oe(e){var t=e.data,n=e.update,a=e.objKey,s=Object(u.useState)(t.value),r=Object(ce.a)(s,2),o=r[0],i=r[1];return"settingVesion"===a?null:Object(Z.jsxs)("div",{className:"settings-row",children:[Object(Z.jsx)("div",{children:t.name}),"select"===t.type?Object(Z.jsx)("select",{value:t.value,onChange:function(e){var s=e.target.value;t.value=s,n({key:a,data:t})},children:t.options.map((function(e){return Object(Z.jsx)("option",{value:e,children:e},e)}))}):Object(Z.jsx)("input",{type:t.type,placeholder:t.placeholder||"",value:o,checked:o,onChange:function(e){var s=e.target,r="checkbox"===t.type?s.checked:s.value;if(!("number"===t.type&&(r=Number(r),e.target.value="",r<t.threshold[0]||r>t.threshold[1]))){if("checkbox"===s.type)t.value=r,n({key:a,data:t});i(r)}},onBlur:function(){t.value!==o&&(t.value=o,n({key:a,data:t}))}})]})}function ke(e){var t=e.data,n=e.functions.removeSong,a=e.functions.toggleMenu,s=e.functions.downloadSong;return Object(Z.jsxs)("div",{className:"song-row",children:[Object(Z.jsx)("div",{className:"song-name",onClick:function(){te.data={eventType:"play",song:t,start:0},a(!1)},children:t.name}),Object(Z.jsxs)("div",{className:"song-buttons-wrapper",children:[Object(Z.jsx)("button",{className:"song-button",onClick:function(){te.data={eventType:"practice",song:t,start:0},a(!1)},children:Object(Z.jsx)(ne.a,{icon:ae.f})}),Object(Z.jsx)("button",{className:"song-button",onClick:function(){te.data={eventType:"approaching",song:t,start:0},a(!1)},children:Object(Z.jsx)(de.a,{})}),Object(Z.jsx)("button",{className:"song-button",onClick:function(){return s(t)},children:Object(Z.jsx)(ne.a,{icon:ae.g})}),Object(Z.jsx)("button",{className:"song-button",onClick:function(){return n(t.name)},children:Object(Z.jsx)(ne.a,{icon:ae.w,color:"#ed4557"})})]})]})}var we=function(e){Object(c.a)(n,e);var t=Object(l.a)(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(i.a)(n,[{key:"render",value:function(){var e=this,t=this.props.className?"menu-item ".concat(this.props.className):"menu-item";return Object(Z.jsx)("div",{className:t,onClick:function(){return e.props.action(e.props.type)},children:this.props.children})}}]),n}(u.Component);function Se(e){var t=e.functions,n=e.data,a=t.importSong,o=function(){var e=Object(r.a)(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("https://sky-music.herokuapp.com/api/songs?get="+encodeURI(n.file)).then((function(e){return e.json()}));case 3:t=U(t=e.sent),a(t),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),console.error(e.t0),new M("Error","Error downloading song").trigger();case 12:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}}(),i=function(){var e=Object(r.a)(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("https://sky-music.herokuapp.com/api/songs?get="+encodeURI(n.file)).then((function(e){return e.json()}));case 3:t=U(t=e.sent),te.data={eventType:"play",song:t,start:0},e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),console.error(e.t0),new M("Error","Error downloading song").trigger();case 12:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}}();return Object(Z.jsxs)("div",{className:"song-row",children:[Object(Z.jsx)("div",{className:"song-name",onClick:function(){i(n)},children:n.name}),Object(Z.jsx)("div",{className:"song-buttons-wrapper",children:Object(Z.jsx)("button",{className:"song-button",onClick:o,children:Object(Z.jsx)(ne.a,{icon:ae.g})})})]})}function Ce(){return JSON.parse(sessionStorage.getItem("isTwa"))}var Ne=je,Ae=n(33),Ee=n.n(Ae),Te=n(34),De=n.n(Te),Pe={settingVesion:f+14,instrument:{name:"Instrument (Layer 1)",type:"instrument",songSetting:!1,value:x[0],volume:100,options:x},layer2:{name:"Instrument (Layer 2)",type:"instrument",songSetting:!1,value:x[0],volume:100,options:x},layer3:{name:"Instrument (Layer 3)",type:"instrument",songSetting:!1,value:x[0],volume:100,options:x},bpm:{name:"Bpm",type:"number",songSetting:!0,threshold:[0,1600],value:220},beatMarks:{name:"Beat marks",type:"select",songSetting:!1,value:3,options:[3,4]},noteNameType:{name:"Note name type",type:"select",songSetting:!1,value:"Genshin"===f?Object(Te.isMobile)()?"Do Re Mi":"Keyboard layout":"Note name",options:"Genshin"===f?["Note name","Keyboard layout","Do Re Mi"]:["Note name","Keyboard layout"]},pitch:{name:"Pitch",type:"select",songSetting:!0,value:"C",options:["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"]},columnsPerCanvas:{name:"Number of visible columns",type:"select",songSetting:!1,value:35,options:[20,25,30,35,40,45,50]},caveMode:{name:"Reverb (cave mode)",type:"checkbox",songSetting:!1,value:!1},autosave:{name:"Autosave changes",type:"checkbox",songSetting:!1,value:!1},backgroundImage:{name:"Background image (url)",type:"text",songSetting:!1,value:"",placeholder:"Write here"},syncTabs:{name:"Autoplay in all tabs (pc only)",type:"checkbox",songSetting:!1,value:!1}},Me={settingVesion:f+12,keyboardSize:{name:"Keyboard size",type:"number",songSetting:!1,value:100,threshold:[0,200]},instrument:{name:"Instrument",type:"select",songSetting:!1,value:x[0],options:x},noteNameType:{name:"Note name type",type:"select",songSetting:!1,value:"Genshin"===f?Object(Te.isMobile)()?"Do Re Mi":"Keyboard layout":"Note name",options:"Genshin"===f?["Note name","Keyboard layout","Do Re Mi"]:["Note name","Keyboard layout"]},approachSpeed:{name:"Approach Rate (AR)",type:"number",songSetting:!1,value:1500,threshold:[0,5e3]},pitch:{name:"Pitch",type:"select",songSetting:!0,value:"C",options:["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"]},caveMode:{name:"Reverb (cave mode)",type:"checkbox",songSetting:!1,value:!1},backgroundImage:{name:"Background image (url)",type:"text",songSetting:!1,value:"",placeholder:"Write here"},noteAnimation:{name:"Note animation",type:"checkbox",songSetting:!1,value:!1}};function Be(e){return Re.apply(this,arguments)}function Re(){return(Re=Object(r.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){var n=document.createElement("div");n.className="floating-prompt";var a=document.createElement("div");a.innerText=t;var s=document.createElement("input");s.type="text",s.placeholder="Write here",s.className="prompt-input";var r=document.createElement("div"),o=document.createElement("button"),i=document.createElement("button");o.className="prompt-button",i.className="prompt-button disabled",r.className="prompt-row",i.innerText="Ok",o.innerText="Cancel",r.append(o,i),n.append(a,s,r),document.body.appendChild(n),s.addEventListener("input",(function(){""===s.value.trim()?i.classList.add("disabled"):i.classList.remove("disabled")})),o.addEventListener("click",(function(){n.classList.add("floating-prompt-hidden"),e(null),setTimeout((function(){return n.remove()}),200)})),i.addEventListener("click",(function(){if("Untitled"===s.value.trim())return s.value="",new M("Warning",'"Untitled" is a reserved word, use another').trigger();n.classList.add("floating-prompt-hidden"),e(s.value.trim()),setTimeout((function(){return n.remove()}),200)}))})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Le(e){return Fe.apply(this,arguments)}function Fe(){return(Fe=Object(r.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){var n=document.createElement("div");n.className="floating-prompt";var a=document.createElement("div");a.innerText=t;var s=document.createElement("div"),r=document.createElement("button"),o=document.createElement("button");r.className="prompt-button",o.className="prompt-button",s.className="prompt-row",o.innerText="Yes",o.style.background="#628c83",r.style.background="#a9525a",r.innerText="No",s.append(r,o),n.append(a,s),document.body.appendChild(n),r.addEventListener("click",(function(){n.classList.add("floating-prompt-hidden"),e(!1),setTimeout((function(){return n.remove()}),200)})),o.addEventListener("click",(function(){n.classList.add("floating-prompt-hidden"),e(!0),setTimeout((function(){return n.remove()}),200)}))})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Ie=n.p+"static/media/rotate.e7c0f107.svg",Ge=function e(t,n,a){Object(o.a)(this,e),this.index=t,this.noteNames=n,this.url=a,this.buffer=new ArrayBuffer(8)},Ve=function e(t){var n=this;Object(o.a)(this,e),this.getNoteFromCode=function(e){var t=n.keyboardLayout.findIndex((function(t){return t===String(e)}));return-1!==t?t:null},this.changeVolume=function(e){var t=Number((e/135).toFixed(2));e<5&&(t=0),n.volumeNode.gain.value=t},this.play=function(e,t){if(!n.deleted){var a=j.createBufferSource();a.buffer=n.buffers[e],a.connect(n.volumeNode),a.playbackRate.value=t,a.start(0),a.onended=function(){a.stop(),a.disconnect()}}},this.load=Object(r.a)(s.a.mark((function e(){var t,a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=j.createBuffer(2,j.sampleRate,j.sampleRate),a=n.layout.map((function(e){return new Promise((function(n){fetch(e.url).then((function(e){return e.arrayBuffer()})).then((function(e){j.decodeAudioData(e,n,(function(){n(t)})).catch((function(e){n(t)}))})).catch((function(e){n(t)}))}))})),e.next=4,Promise.all(a);case 4:return n.buffers=e.sent,n.loaded=!0,e.abrupt("return",!0);case 7:case"end":return e.stop()}}),e)}))),this.disconnect=function(){n.volumeNode.disconnect()},this.connect=function(e){n.volumeNode.connect(e)},this.delete=function(){n.disconnect(),n.deleted=!0,n.buffers=null},this.instrumentName=void 0===t?x[0]:t,this.layout=[],this.buffers=[],this.loaded=!1,this.deleted=!1,this.volumeNode=j.createGain();var a=O[this.instrumentName];this.keyboardLayout=k[a.notes].keyboardLayout,this.mobileLayout=k[a.notes].mobileLayout,this.keyboardCodes=k[a.notes].keyboardCodes,this.keyboardLayout.forEach((function(e,a){var s={keyboard:e,mobile:n.mobileLayout[a]},r="./assets/audio/".concat(t,"/").concat(a,".mp3");n.layout.push(new Ge(a,s,r))})),this.volumeNode.gain.value=.8},We=n(87),Ue=n.n(We),He=function(){function e(){Object(o.a)(this,e),this.node=j.createMediaStreamDestination(),this.recorder=new MediaRecorder(this.node.stream)}return Object(i.a)(e,[{key:"start",value:function(){this.recorder.start()}},{key:"stop",value:function(){var e=this;return new Promise((function(t){e.recorder.addEventListener("dataavailable",(function(e){t({data:e.data,toUrl:function(){return URL.createObjectURL(e.data)}})}),{once:!0}),e.recorder.stop()}))}},{key:"download",value:function(){var e=Object(r.a)(s.a.mark((function e(t,n){var a,r,o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=document.createElement("a"),e.t0=Ue.a,e.next=4,Ke(t);case 4:e.t1=e.sent,r=(0,e.t0)(e.t1),o=new Blob([new DataView(r)],{type:"audio/wav"}),a.download=n,a.href=URL.createObjectURL(o),a.click();case 10:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}]),e}();function Ke(e){return new Promise((function(t){var n=new AudioContext,a=new FileReader;a.onloadend=function(){n.decodeAudioData(a.result,(function(e){t(e)}))},a.readAsArrayBuffer(e)}))}var _e=function(e){Object(c.a)(n,e);var t=Object(l.a)(n);function n(e){var a;Object(o.a)(this,n),(a=t.call(this,e)).init=Object(r.a)(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.state.settings,e.next=3,a.loadInstrument(t.instrument.value);case 3:return e.next=5,a.loadReverb();case 5:a.toggleReverbNodes(t.caveMode.value);case 6:case"end":return e.stop()}}),e)}))),a.resetDrag=function(e){a.setState({isDragging:!1})},a.handleDragOver=function(e){e.preventDefault(),a.setState({isDragging:!0})},a.handleDrag=function(e){e.preventDefault(),a.setState({isDragging:!0})},a.setHasSong=function(e){a.setState({thereIsSong:e})},a.handleDrop=function(){var e=Object(r.a)(s.a.mark((function e(t){var n,r,o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a.resetDrag(),t.preventDefault(),e.next=4,Promise.all(Array.from(t.dataTransfer.files).map((function(e){return e.text()})));case 4:n=e.sent,r=0;case 6:if(!(r<n.length)){e.next=19;break}return e.prev=7,o=U(JSON.parse(n[r])),e.next=11,a.addSong(o);case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(7),console.error(e.t0);case 16:r++,e.next=6;break;case 19:case"end":return e.stop()}}),e,null,[[7,13]])})));return function(t){return e.apply(this,arguments)}}(),a.toggleReverbNodes=function(e){var t=a.state.instrument;if(e){if(!a.reverbNode)return console.log("Couldn't connect to reverb");t.disconnect(),t.connect(a.reverbNode)}else t.disconnect(),t.connect(a.audioContext.destination)},a.getSettings=function(){var e=localStorage.getItem(f+"_Main_Settings");try{e=JSON.parse(e)}catch(t){e=null}return null!==e?e.settingVesion!==Me.settingVesion?(a.updateSettings(Me),Me):e:Me},a.loadInstrument=function(){var e=Object(r.a)(s.a.mark((function e(t){var n,r,o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return null===(n=a.state.instrument)||void 0===n||null===(r=n.delete)||void 0===r||r.call(n),o=new Ve(t),a.setState({isLoadingInstrument:!0}),e.next=5,o.load();case 5:o.connect(a.audioContext.destination),a.setState({instrument:o,isLoadingInstrument:!1},(function(){return a.toggleReverbNodes(a.state.settings.caveMode.value)}));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.playSound=function(e){var t=Object(b.a)(a).state,n=t.settings;void 0!==e&&(t.isRecording&&a.handleRecording(e),a.state.instrument.play(e.index,Y(n.pitch.value)))},a.updateSettings=function(e){var t;t=void 0!==e?e:a.state.settings,localStorage.setItem(f+"_Main_Settings",JSON.stringify(t))},a.handleSettingChange=function(e){var t=a.state.settings,n=e.data;t[e.key].value=n.value,"instrument"===e.key&&a.loadInstrument(n.value),"caveMode"===e.key&&a.toggleReverbNodes(n.value),a.setState({settings:t},a.updateSettings)},a.syncSongs=Object(r.a)(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.dbCol.songs.find().toArray();case 2:t=e.sent,a.setState({songs:t});case 4:case"end":return e.stop()}}),e)}))),a.songExists=function(){var e=Object(r.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.dbCol.songs.findOne({name:t});case 2:return e.t0=e.sent,e.t1=void 0,e.abrupt("return",e.t0!==e.t1);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.addSong=function(){var e=Object(r.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,a.songExists(t.name);case 3:if(!e.sent){e.next=5;break}return e.abrupt("return",new M("Warning","A song with this name already exists! \n"+t.name).trigger());case 5:return e.next=7,a.dbCol.songs.insert(t);case 7:a.syncSongs(),new M("Success","Song added to the ".concat(t.data.isComposedVersion?"Composed":"Recorded"," tab!"),4e3).trigger(),e.next=15;break;case 11:return e.prev=11,e.t0=e.catch(0),console.error(e.t0),e.abrupt("return",new M("Error","There was an error importing the song").trigger());case 15:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(t){return e.apply(this,arguments)}}(),a.removeSong=function(){var e=Object(r.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Le('Are you sure you want to delete the song: "'.concat(t,'" ?'));case 2:e.sent&&a.dbCol.songs.remove({name:t},a.syncSongs);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.handleRecording=function(e){a.state.isRecording&&a.recording.addNote(e.index)},a.askForSongName=function(){return new Promise(function(){var e=Object(r.a)(s.a.mark((function e(t){var n,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n="Write song name, press cancel to ignore";case 1:return e.next=4,Be(n);case 4:if(null!==(r=e.sent)){e.next=7;break}return e.abrupt("return",t(null));case 7:if(""===r){e.next=17;break}return e.next=10,a.songExists(r);case 10:if(!e.sent){e.next=14;break}n="This song already exists: "+r,e.next=15;break;case 14:return e.abrupt("return",t(r));case 15:e.next=18;break;case 17:n="Write song name, press cancel to ignore";case 18:e.next=1;break;case 20:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())},a.toggleRecord=function(){var e=Object(r.a)(s.a.mark((function e(t){var n,r,o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("boolean"!==typeof t&&(t=void 0),(n=void 0!==t?t:!a.state.isRecording)||!(a.recording.notes.length>0)){e.next=11;break}return e.next=5,a.askForSongName();case 5:r=e.sent,(o=new P(r,a.recording.notes)).pitch=a.state.settings.pitch.value,null!==r&&a.addSong(o),e.next=12;break;case 11:a.recording=new D;case 12:a.state.isRecording=n,a.setState({open:a.state.isRecording});case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.toggleRecordAudio=function(){var e=Object(r.a)(s.a.mark((function e(t){var n,r,o,i,c,l,u;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("boolean"!==typeof t&&(t=void 0),n=a.state.instrument,r=Object(b.a)(a),o=r.recorder,i=a.state.settings.caveMode.value,!(c=void 0!==t?t:!a.state.isRecordingAudio)){e.next=10;break}i?a.reverbVolumeNode.connect(o.node):n.connect(o.node),o.start(),e.next=20;break;case 10:return e.next=12,o.stop();case 12:return l=e.sent,e.next=15,Be("Write the song name, press cancel to ignore");case 15:(u=e.sent)&&o.download(l.data,u+".wav"),a.toggleReverbNodes(i),a.reverbVolumeNode.disconnect(),a.reverbVolumeNode.connect(j.destination);case 20:a.setState({isRecordingAudio:c});case 21:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.db=new Ee.a.Db(f,{songs:[]}),a.recording=new D;var i=a.getSettings();return a.dbCol={songs:a.db.collection("songs")},a.state={instrument:new Ve,isLoadingInstrument:!0,isRecording:!1,isRecordingAudio:!1,songs:[],settings:i,isDragging:!1,thereIsSong:!1},a.reverbNode=void 0,a.reverbVolumeNode=void 0,a.audioContext=j,a.recorder=new He,a}return Object(i.a)(n,[{key:"componentDidMount",value:function(){document.body.addEventListener("dragenter",this.handleDrag),document.body.addEventListener("dragleave",this.resetDrag),document.body.addEventListener("dragover",this.handleDragOver),document.body.addEventListener("drop",this.handleDrop),this.syncSongs(),this.init()}},{key:"componentWillUnmount",value:function(){document.body.removeEventListener("dragenter",this.handleDrag),document.body.removeEventListener("dragleave",this.resetDrag),document.body.removeEventListener("drop",this.handleDrop),document.body.addEventListener("dragover",this.handleDragOver),te.data={song:{},eventType:"stop",start:0},this.audioContext=void 0,this.recorder=void 0,this.reverbNode=void 0,this.reverbVolumeNode=void 0,this.state.instrument.delete()}},{key:"loadReverb",value:function(){var e=this;return new Promise((function(t){fetch("./assets/audio/reverb4.wav").then((function(e){return e.arrayBuffer()})).then((function(n){e.audioContext.decodeAudioData(n,(function(n){var a=e.audioContext.createConvolver(),s=e.audioContext.createGain();s.gain.value=2.5,a.buffer=n,a.connect(s),s.connect(e.audioContext.destination),e.reverbVolumeNode=s,e.reverbNode=a,t()}))})).catch((function(e){console.log("Error with reverb",e)}))}))}},{key:"componentDidCatch",value:function(){new M("Warning","There was an error with the song! Restoring default...").trigger(),te.data={song:{},eventType:"stop",start:0}}},{key:"render",value:function(){var e=this.state,t={changeSliderState:this.changeSliderState,playSound:this.playSound,setHasSong:this.setHasSong},n={isLoading:e.isLoadingInstrument,keyboard:e.instrument,pitch:e.settings.pitch.value,keyboardSize:e.settings.keyboardSize.value,noteNameType:e.settings.noteNameType.value,hasSong:e.thereIsSong,hasAnimation:e.settings.noteAnimation.value,approachRate:e.settings.approachSpeed.value},a={addSong:this.addSong,removeSong:this.removeSong,changePage:this.props.changePage,handleSettingChange:this.handleSettingChange},s={songs:e.songs,settings:e.settings};return Object(Z.jsxs)("div",{className:"app bg-image",style:{backgroundImage:"url(".concat(e.settings.backgroundImage.value,")")},children:["approaching"!==te.data.eventType&&Object(Z.jsx)("div",{className:"record-button",children:Object(Z.jsx)(Je,{active:e.isRecordingAudio,click:this.toggleRecordAudio,children:e.isRecordingAudio?"Finish recording":"Record audio"})}),Object(Z.jsxs)("div",{className:"rotate-screen",children:[Object(Z.jsx)("img",{src:Ie,alt:"icon for the rotating screen"}),"For a better experience, add the website to the home screen, and rotate your device"]}),e.isDragging&&Object(Z.jsx)("div",{className:"drag-n-drop",children:"Drop file here"}),Object(Z.jsx)(Ne,{functions:a,data:s}),Object(Z.jsxs)("div",{className:"right-panel",children:[Object(Z.jsx)("div",{className:"upper-right",children:!this.state.thereIsSong&&Object(Z.jsx)(Je,{active:e.isRecording,click:this.toggleRecord,style:{marginTop:"-0.5rem"},children:e.isRecording?"Stop":"Record"})}),Object(Z.jsx)("div",{className:"keyboard-wrapper",children:Object(Z.jsx)(ie,{data:n,functions:t},e.instrument.instrumentName)})]})]})}}]),n}(u.Component);function Je(e){var t="genshin-button "+(e.active?"selected":"");return Object(Z.jsx)("button",{className:t,onClick:e.click,style:Object(g.a)({},e.style||{}),children:e.children})}!function(){if(JSON.parse(sessionStorage.getItem("isTwa")))return console.log("inTWA");var e=document.referrer.includes("android-app://");sessionStorage.setItem("isTwa",e)}();var ze=_e,Ye=n.p+"static/media/addCell.73b6c8e9.svg",qe=n.p+"static/media/removeCell.e266ba1a.svg",Ze=n(88);var $e=function(e,t){var n=Object(u.useState)(e),a=Object(ce.a)(n,2),s=a[0],r=a[1];return Object(u.useEffect)((function(){var n=setTimeout((function(){r(e)}),t);return function(){clearTimeout(n)}}),[e,t]),s};function Qe(e){var t=e.data,n=e.index,a=e.editTrack,s=Object(u.useState)(!1),r=Object(ce.a)(s,2),o=r[0],i=r[1];return Object(Z.jsxs)("div",{className:"midi-track-column",children:[Object(Z.jsxs)("div",{className:"midi-track-wrapper",children:[Object(Z.jsxs)("div",{className:"midi-track-center",children:[Object(Z.jsx)("input",{type:"checkbox",onChange:function(){return a("index",{index:n})},checked:t.selected}),t.name," (",t.notes.length,")"]}),Object(Z.jsxs)("div",{className:"midi-track-center",children:[Object(Z.jsx)("div",{style:{textAlign:"center"},children:t.instrument.family}),Object(Z.jsxs)("select",{onChange:function(e){return a("layer",{index:n,layer:Number(e.target.value)})},value:t.layer,className:"midi-select",children:[Object(Z.jsx)("option",{value:"0",children:"Layer 1"}),Object(Z.jsx)("option",{value:"1",children:"Layer 2"}),Object(Z.jsx)("option",{value:"2",children:"Layer 3"})]}),Object(Z.jsx)(ue.c,{size:22,color:o?"rgb(207, 122, 130)":"white",onClick:function(){return i(!o)},cursor:"pointer"})]})]}),Object(Z.jsxs)("div",{className:"midi-track-data",style:{display:o?"flex":"none"},children:[Object(Z.jsxs)("div",{className:"midi-track-data-row",children:[Object(Z.jsx)("div",{children:"Instrument:"}),Object(Z.jsx)("div",{children:t.instrument.name})]}),Object(Z.jsxs)("div",{className:"midi-track-data-row",children:[Object(Z.jsx)("div",{children:"Number of notes:"}),Object(Z.jsx)("div",{children:t.notes.length})]}),Object(Z.jsxs)("div",{className:"midi-track-data-row",children:[Object(Z.jsx)("div",{children:"Accidentals:"}),Object(Z.jsx)("div",{children:t.numberOfAccidentals})]}),Object(Z.jsxs)("div",{className:"midi-track-data-row",children:[Object(Z.jsx)("div",{children:"Out of range:"}),Object(Z.jsx)("div",{children:t.numberOfOutOfRange})]})]})]})}var Xe=function(e){Object(c.a)(n,e);var t=Object(l.a)(n);function n(e){var a;return Object(o.a)(this,n),(a=t.call(this,e)).handleFile=function(e){var t=new FileReader;t.addEventListener("load",(function(t){var n,s,r;try{r=new Ze.Midi(t.target.result)}catch(c){console.error(c)}if(!r)return new M("Error","There was an error importing this file",2e3).trigger();var o=null===(n=r.header.tempos[0])||void 0===n?void 0:n.bpm,i=null===(s=r.header.keySignatures[0])||void 0===s?void 0:s.key;r.tracks.forEach((function(e,t){e.selected=!0,e.layer=0,e.name=e.name||"Track n.".concat(t+1),e.numberOfAccidentals=0,e.numberOfOutOfRange=0})),a.setState({midi:r,fileName:e.name,bpm:Math.floor(4*o)||220,offset:0,pitch:z.includes(i)?i:"C"},(function(){null!==a.state.midi&&a.convertMidi()}))})),t.readAsArrayBuffer(e)},a.convertMidi=function(){var e=a.state,t=e.midi,n=e.bpm,s=e.offset,r=e.includeAccidentals,o=e.pitch,i=t.tracks.filter((function(e){return e.selected})),c=[],l=0,u=0,d=0;i.forEach((function(e){e.numberOfAccidentals=0,e.numberOfOutOfRange=0,e.notes.forEach((function(t){d++;var n=function(e){var t=null,n=!1;if("Sky"===f)switch(e){case 60:t=0;break;case 61:t=0,n=!0;break;case 62:t=1;break;case 63:t=1,n=!0;break;case 64:t=2;break;case 65:t=3;break;case 66:t=3,n=!0;break;case 67:t=4;break;case 68:t=4,n=!0;break;case 69:t=5;break;case 70:t=5,n=!0;break;case 71:t=6;break;case 72:t=7;break;case 73:t=7,n=!0;break;case 74:t=8;break;case 75:t=8,n=!0;break;case 76:t=9;break;case 77:t=10;break;case 78:t=10,n=!0;break;case 79:t=11;break;case 80:t=11,n=!0;break;case 81:t=12;break;case 82:t=12,n=!0;break;case 83:t=13;break;case 84:t=14;break;default:t=null}if("Genshin"===f)switch(e){case 48:t=14;break;case 49:t=14,n=!0;break;case 50:t=15;break;case 51:t=15,n=!0;break;case 52:t=16;break;case 53:t=17;break;case 54:t=17,n=!0;break;case 55:t=18;break;case 56:t=18,n=!0;break;case 57:t=19;break;case 58:t=19,n=!0;break;case 59:t=20;break;case 60:t=7;break;case 61:t=7,n=!0;break;case 62:t=8;break;case 63:t=8,n=!0;break;case 64:t=9;break;case 65:t=10;break;case 66:t=10,n=!0;break;case 67:t=11;break;case 68:t=11,n=!0;break;case 69:t=12;break;case 70:t=12,n=!0;break;case 71:t=13;break;case 72:t=0;break;case 73:t=0,n=!0;break;case 74:t=1;break;case 75:t=1,n=!0;break;case 76:t=2;break;case 77:t=3;break;case 78:t=3,n=!0;break;case 79:t=4;break;case 80:t=4,n=!0;break;case 81:t=5;break;case 82:t=5,n=!0;break;case 83:t=6;break;default:t=null}return{note:t,isAccidental:n}}(t.midi-s),a={time:Math.floor(1e3*t.time),note:n.note,layer:e.layer};n.isAccidental&&(l++,e.numberOfAccidentals++),null!==a.note?!r&&n.isAccidental||c.push(a):(u++,e.numberOfOutOfRange++)}))})),c=c.sort((function(e,t){return e.time-t.time}));for(var h=Math.floor(6e4/n),p=[];c.length>0;){for(var g=[c.shift()],b=0,v=0;v<c.length;v++)g[0].time>c[v].time-h/9&&b++;p.push([].concat(g,Object(m.a)(c.splice(0,b))))}var j=[],x=0;p.forEach((function(e){var t=e[0];if(t){var n=t.time-x;x=t.time;var a=Math.floor((n-h)/h);a>-1&&new Array(a).fill(0).forEach((function(){return j.push(new _)}));var s=new _;s.notes=e.map((function(e){return new J(e.note,function(e){var t="100";return 0===e&&(t="100"),1===e&&(t="010"),2===e&&(t="001"),t}(e.layer))})),j.push(s)}})),j.forEach((function(e){var t=function(e){var t=[];return e.notes.forEach((function(e){t[e.index]?t[e.index].push(e):t[e.index]=[e]})),t.filter((function(e){return Array.isArray(e)}))}(e);e.notes=t.map((function(e){return e[0].layer=function(e){var t="000".split("");return e.forEach((function(e){e.layer.split("").forEach((function(e,n){"1"===e&&(t[n]="1")}))})),t.join("")}(e),e[0]}))}));var y=new L("Untitled");y.columns=j,y.bpm=n,y.instruments=a.props.data.instruments,y.pitch=o;var O=a.props.data.selectedColumn;if(y.selected=O<y.columns.length?O:0,0===y.columns.length)return new M("Error","There are no notes",2e3).trigger();a.props.functions.loadSong(y),a.setState({accidentals:l,totalNotes:d,outOfRange:u})},a.editTrack=function(e,t){var n=a.state.midi.tracks;"index"===e&&(n[t.index].selected=!n[t.index].selected),"layer"===e&&(n[t.index].layer=t.layer),a.setState({midi:a.state.midi},(function(){null!==a.state.midi&&a.convertMidi()}))},a.changeOffset=function(e){e=parseInt(e),Number.isInteger(e)||(e=0),a.state.offset!==e&&a.setState({offset:e},(function(){null!==a.state.midi&&a.convertMidi()}))},a.changePitch=function(e){a.props.functions.changePitch(e),a.setState({pitch:e})},a.toggleAccidentals=function(){a.setState({includeAccidentals:!a.state.includeAccidentals},(function(){null!==a.state.midi&&a.convertMidi()}))},a.changeBpm=function(e){e=parseInt(e),Number.isInteger(e)||(e=0),a.state.bpm!==e&&a.setState({bpm:e},(function(){null!==a.state.midi&&a.convertMidi()}))},a.state={fileName:"",midi:null,bpm:220,offset:0,pitch:"C",accidentals:0,outOfRange:0,totalNotes:0,includeAccidentals:!0},a}return Object(i.a)(n,[{key:"render",value:function(){var e=this.handleFile,t=this.editTrack,n=this.state,a=this.changeBpm,s=this.changeOffset,r=this.changePitch,o=n.fileName,i=n.midi,c=n.bpm,l=n.offset,u=n.pitch,d=n.accidentals,h=n.outOfRange,p=n.totalNotes,g=n.includeAccidentals,b=this.props.functions.changeMidiVisibility;return Object(Z.jsxs)("div",{className:"floating-midi",children:[Object(Z.jsxs)("div",{className:"midi-row separator-border",style:{width:"100%"},children:[Object(Z.jsx)(pe.FilePicker,{onChange:e,children:Object(Z.jsx)("button",{className:"midi-btn",children:"Click to load midi file"})}),Object(Z.jsx)("div",{style:{margin:"0 0.5rem",maxWidth:"8rem",textOverflow:"ellipsis",overflow:"hidden"},children:o}),Object(Z.jsx)("button",{className:"midi-btn",style:{marginLeft:"auto"},onClick:function(){return b(!1)},children:"Close"})]}),Object(Z.jsxs)("table",{className:"separator-border",style:{width:"100%"},children:[Object(Z.jsxs)("tr",{children:[Object(Z.jsx)("td",{children:Object(Z.jsx)("div",{style:{marginRight:"0.5rem"},children:"Bpm:"})}),Object(Z.jsx)("td",{style:{display:"flex",justifyContent:"flex-end",alignItems:"center"},children:Object(Z.jsx)(et,{value:c,changeValue:a,delay:600,step:5})})]}),Object(Z.jsxs)("tr",{children:[Object(Z.jsx)("td",{children:Object(Z.jsx)("div",{style:{marginRight:"0.5rem"},children:"Scale notes by: "})}),Object(Z.jsx)("td",{children:Object(Z.jsx)(et,{value:l,changeValue:s,delay:600,step:1})})]}),Object(Z.jsxs)("tr",{children:[Object(Z.jsx)("td",{children:Object(Z.jsx)("div",{style:{marginRight:"0.5rem"},children:"Pitch:"})}),Object(Z.jsx)("td",{style:{display:"flex",justifyContent:"flex-end",alignItems:"center"},children:Object(Z.jsxs)("select",{className:"midi-select",value:u,onChange:function(e){return r(e.target.value)},style:{backgroundColor:"#576377",width:"5rem"},children:[Object(Z.jsx)("option",{value:"C",children:"C"}),Object(Z.jsx)("option",{value:"Db",children:"Db"}),Object(Z.jsx)("option",{value:"D",children:"D"}),Object(Z.jsx)("option",{value:"Eb",children:"Eb"}),Object(Z.jsx)("option",{value:"E",children:"E"}),Object(Z.jsx)("option",{value:"F",children:"F"}),Object(Z.jsx)("option",{value:"Gb",children:"Gb"}),Object(Z.jsx)("option",{value:"G",children:"G"}),Object(Z.jsx)("option",{value:"Ab",children:"Ab"}),Object(Z.jsx)("option",{value:"A",children:"A"}),Object(Z.jsx)("option",{value:"Bb",children:"Bb"}),Object(Z.jsx)("option",{value:"B",children:"B"})]})})]}),Object(Z.jsxs)("tr",{children:[Object(Z.jsx)("td",{children:Object(Z.jsx)("div",{style:{marginRight:"0.5rem"},children:"Include accidentals:"})}),Object(Z.jsx)("td",{style:{display:"flex",justifyContent:"flex-end"},children:Object(Z.jsx)("input",{type:"checkbox",checked:g,onChange:this.toggleAccidentals})})]})]}),null!==i&&Object(Z.jsx)("div",{className:"midi-column separator-border",style:{width:"100%"},children:Object(Z.jsxs)("div",{className:"midi-column",style:{width:"100%"},children:[Object(Z.jsx)("div",{children:"Select midi tracks"}),null===i||void 0===i?void 0:i.tracks.map((function(e,n){return Object(Z.jsx)(Qe,{data:e,index:n,editTrack:t},n)}))]})}),null!==i&&Object(Z.jsxs)("table",{children:[Object(Z.jsxs)("tr",{children:[Object(Z.jsx)("td",{children:"Total notes: "}),Object(Z.jsx)("td",{}),Object(Z.jsx)("td",{children:p})]}),Object(Z.jsxs)("tr",{children:[Object(Z.jsx)("td",{children:"Accidentals: "}),Object(Z.jsx)("td",{}),Object(Z.jsx)("td",{children:d})]}),Object(Z.jsxs)("tr",{children:[Object(Z.jsx)("td",{children:"Out of range: "}),Object(Z.jsx)("td",{}),Object(Z.jsx)("td",{children:h})]})]})]})}}]),n}(u.Component);function et(e){var t=e.changeValue,n=e.value,a=e.delay,s=void 0===a?500:a,r=e.step,o=void 0===r?1:r,i=Object(u.useState)(n),c=Object(ce.a)(i,2),l=c[0],d=c[1],h=$e(l,s);return Object(u.useEffect)((function(){t(h)}),[h]),Object(u.useEffect)((function(){d(n)}),[n]),Object(Z.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end"},children:[Object(Z.jsx)("button",{onClick:function(){return d(l-o)},className:"midi-btn-small",children:"-"}),Object(Z.jsx)("input",{type:"text",value:l,onChange:function(e){return d(e.target.value)},className:"midi-input",style:{margin:"0 0.3rem"}}),Object(Z.jsx)("button",{onClick:function(){return d(l+o)},className:"midi-btn-small",children:"+"})]})}var tt=function(e){Object(c.a)(n,e);var t=Object(l.a)(n);function n(e){var a;return Object(o.a)(this,n),(a=t.call(this,e)).state={},a}return Object(i.a)(n,[{key:"render",value:function(){var e=this.props,t=e.data,n=e.functions,a=t.visible?"floating-tools tools-visible":"floating-tools";return Object(Z.jsxs)("div",{className:a,children:[Object(Z.jsxs)("div",{className:"tools-row",children:[Object(Z.jsx)("div",{children:"Scroll to the left / right to select the columns"}),Object(Z.jsx)("button",{onClick:n.toggleTools,children:"Close"})]}),Object(Z.jsxs)("div",{className:"tools-buttons-wrapper",children:[Object(Z.jsxs)("div",{className:"tools-half",children:[Object(Z.jsx)("button",{disabled:0!==t.copiedColumns.length,onClick:function(e){e.currentTarget.blur(),n.copyColumns("all")},className:0!==t.copiedColumns.length?"tools-button-highlighted":"",children:"Copy"}),Object(Z.jsxs)("button",{disabled:0!==t.copiedColumns.length,onClick:function(e){e.currentTarget.blur(),n.copyColumns(t.layer)},className:0!==t.copiedColumns.length?"tools-button-highlighted":"",children:["Copy layer ",t.layer]})]}),Object(Z.jsxs)("div",{className:"tools-half",children:[Object(Z.jsx)("button",{disabled:0===t.copiedColumns.length,onClick:function(e){e.currentTarget.blur(),n.pasteColumns(!1)},children:"Paste"}),Object(Z.jsx)("button",{disabled:0===t.copiedColumns.length,onClick:function(e){e.currentTarget.blur(),n.pasteColumns(!0)},children:"Insert"})]}),Object(Z.jsxs)("div",{className:"tools-half",children:[Object(Z.jsx)("button",{disabled:0!==t.copiedColumns.length,onClick:function(e){e.currentTarget.blur(),n.eraseColumns("all")},children:"Erase"}),Object(Z.jsxs)("button",{disabled:0!==t.copiedColumns.length,onClick:function(e){e.currentTarget.blur(),n.eraseColumns(t.layer)},children:["Erase layer ",t.layer]})]}),Object(Z.jsx)("button",{disabled:0!==t.copiedColumns.length,onClick:n.deleteColumns,children:"Delete"})]})]})}}]),n}(u.Component),nt=function(e){Object(c.a)(n,e);var t=Object(l.a)(n);function n(e){var a;return Object(o.a)(this,n),(a=t.call(this,e)).state={},a}return Object(i.a)(n,[{key:"shouldComponentUpdate",value:function(e,t){var n=!1;return n=(n=n||this.props.layers!==e.layers||this.props.noteText!==e.noteText)||this.props.instrument!==e.instrument}},{key:"render",value:function(){var e,t=this,n=this.props,a=n.data,s=n.layers,r=n.instrument,o=v.noteComposer;"1"===s[0]&&(o+=" layer-1"),"1"===s[1]&&(o+=" layer-2"),"1"===s[2]&&(o+=" layer-3");var i=(null===(e=O[r])||void 0===e?void 0:e.effects)||{};return Object(Z.jsx)("button",{onPointerDown:function(){return t.props.clickAction(a)},className:"button-hitbox",children:Object(Z.jsxs)("div",{className:o,children:[Object(Z.jsx)("img",{draggable:"false",alt:a.noteNames.mobile,src:n.noteImage,style:i}),Object(Z.jsx)("div",{className:"layer-3-ball-bigger"}),Object(Z.jsx)("div",{className:"Sky"===f?"note-name-sky":"note-name",children:n.noteText})]})})}}]),n}(u.Component),at=function(e){Object(c.a)(n,e);var t=Object(l.a)(n);function n(e){var a;return Object(o.a)(this,n),(a=t.call(this,e)).state={},a}return Object(i.a)(n,[{key:"render",value:function(){var e=this.props;return Object(Z.jsx)(Z.Fragment,{children:e.options.map((function(t){return Object(Z.jsx)("button",{style:{backgroundColor:t===e.selected?e.selectedColor:""},className:e.buttonsClass,onClick:function(){return e.onSelect(t)},children:t},t)}))})}}]),n}(u.Component),st=function(e){Object(c.a)(n,e);var t=Object(l.a)(n);function n(e){var a;return Object(o.a)(this,n),(a=t.call(this,e)).state={},a}return Object(i.a)(n,[{key:"render",value:function(){var e=this.props,t=e.data,n=e.functions,a=t.currentColumn.notes.map((function(e){return e.index})),s=t.isPlaying?" hidden":"",r="keyboard";return 15===t.keyboard.layout.length&&(r+=" keyboard-5"),8===t.keyboard.layout.length&&(r+=" keyboard-4"),Object(Z.jsxs)("div",{children:[Object(Z.jsxs)("div",{className:r,children:[0===t.keyboard.layout.length?Object(Z.jsx)("div",{className:"loading",children:"Loading..."}):null,t.keyboard.layout.map((function(e,s){var r=a.indexOf(s),o="",i="";try{i=E[t.keyboard.layout.length][e.index],"Note name"===t.noteNameType&&(o=w[f][C.indexOf(t.pitch)][e.index]),"Keyboard layout"===t.noteNameType&&(o=k[t.keyboard.layout.length].keyboardLayout[e.index]),"Do Re Mi"===t.noteNameType&&(o=k[t.keyboard.layout.length].mobileLayout[e.index])}catch(c){}return Object(Z.jsx)(nt,{layers:r>=0?t.currentColumn.notes[r].layer:"000",data:e,noteText:o,instrument:t.keyboard.instrumentName,noteImage:"./assets/icons/keys/".concat(i,".svg"),clickAction:n.handleClick},e.index)}))]}),Object(Z.jsxs)("div",{className:"bottom-right-wrapper"+s,children:[Object(Z.jsxs)("div",{className:"layer-buttons-wrapper",children:[Object(Z.jsx)("div",{className:"bottom-right-text",children:"Layer"}),Object(Z.jsx)(at,{buttonsClass:"layer-button",selectedColor:"#63aea7",options:[1,2,3],onSelect:n.changeLayer,selected:t.layer})]}),Object(Z.jsxs)("div",{className:"tempo-changers-wrapper",children:[Object(Z.jsx)("div",{className:"bottom-right-text",children:"Tempo"}),t.TempoChangers.map((function(e){return Object(Z.jsx)("button",{onClick:function(){return n.handleTempoChanger(e)},style:{backgroundColor:"#"+e.color.toString(16)},children:e.text},e.id)}))]})]})]})}}]),n}(u.Component),rt=n(20),ot=n(12),it="#d3bd8e",ct="#de4545",lt="#de4545",ut=y/3,dt=[{color:5332079},{color:4739939},{color:1742475},{color:14053935}],ht=["000","001","010","011","100","101","110","111"],pt=[{type:"short",color:"#282875"},{type:"long",color:"#282875"}],gt=function e(t,n){var a=this,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:30;Object(o.a)(this,e),this.generate=function(){R.forEach((function(e){var t=bt(e,a,1);a.cache.columns.push(t.toDataURL())})),dt.forEach((function(e){var t=bt(e,a,1);a.cache.standard.push(t.toDataURL())})),dt.forEach((function(e){var t=bt(e,a,3);a.cache.standardLarger.push(t.toDataURL())})),ht.forEach((function(e){var t=a.noteWidth>20?4:2,n=document.createElement("canvas");n.height=a.noteHeight,n.width=a.noteWidth;var s=n.getContext("2d");if("1"===e[0]&&(s.fillStyle=it,mt(s,a.margin/2,a.margin/2,a.noteWidth-a.margin-1,a.noteHeight-a.margin-1,t,!0,!1)),"1"===e[1]&&(s.strokeStyle=ct,s.lineWidth=2,mt(s,a.margin/2,a.margin/2,a.noteWidth-a.margin-1,a.noteHeight-a.margin-1,t,!1,!0)),"1"===e[2]){s.beginPath(),s.fillStyle=lt;var r=a.noteHeight/4;s.arc(a.noteWidth/2-.5,a.noteHeight/2-.5,r,0,2*Math.PI),s.fill()}a.cache.notes[e]=n.toDataURL()})),R.forEach((function(e){var t=bt(e,a,2);a.cache.columnsLarger.push(t.toDataURL())})),pt.forEach((function(e){var t=document.createElement("canvas");if("short"===e.type){var n=a.timelineHeight/6;t.height=a.timelineHeight,t.width=2*n;var s=t.getContext("2d");s.fillStyle=e.color,s.arc(n,a.timelineHeight/2,n,0,2*Math.PI),s.fill(),a.cache.breakpoints.push(t.toDataURL())}else{t.height=a.height,t.width=a.width;var r=t.getContext("2d");r.fillStyle=e.color,r.beginPath(),r.moveTo(0,a.height),r.lineTo(a.noteWidth/2,a.height),r.lineTo(0,a.height-a.noteHeight),r.fill(),r.beginPath(),r.moveTo(a.width,a.height),r.lineTo(a.noteWidth/2,a.height),r.lineTo(a.width,a.height-a.noteHeight),r.fill(),r.beginPath(),r.moveTo(0,0),r.lineTo(a.noteWidth/2,0),r.lineTo(0,a.noteHeight),r.fill(),r.beginPath(),r.moveTo(a.width,0),r.lineTo(a.noteWidth/2,0),r.lineTo(a.width,a.noteHeight),r.fill(),a.cache.breakpoints.push(t.toDataURL())}}))},this.width=t,this.height=n,this.cache={columns:[],notes:{},standard:[],columnsLarger:[],standardLarger:[],breakpoints:[]},this.notesFigures=[],this.timelineHeight=r,this.margin=s,this.noteWidth=this.width,this.noteHeight=this.height/y,this.app=new ot.b({width:t,height:n}),this.generate()};function bt(e,t,n){var a=document.createElement("canvas");a.height=t.height,a.width=t.width;var s=a.getContext("2d");s.fillStyle="#"+e.color.toString(16),s.fillRect(0,0,t.width,t.height),s.strokeStyle=2===n?"black":"#333333",s.lineWidth=n,s.beginPath(),s.moveTo(t.width,0),s.lineTo(t.width,t.height),s.stroke(),s.strokeStyle="#333333";for(var r=1;r<3;r++){s.lineWidth=1;var o=t.noteHeight*ut*r;s.moveTo(0,o),s.lineTo(t.width,o)}return s.stroke(),a}function mt(e,t,n,a,s,r,o,i){if("undefined"===typeof i&&(i=!0),"undefined"===typeof r&&(r=5),"number"===typeof r)r={tl:r,tr:r,br:r,bl:r};else{var c={tl:0,tr:0,br:0,bl:0};for(var l in c)r[l]=r[l]||c[l]}e.beginPath(),e.moveTo(t+r.tl,n),e.lineTo(t+a-r.tr,n),e.quadraticCurveTo(t+a,n,t+a,n+r.tr),e.lineTo(t+a,n+s-r.br),e.quadraticCurveTo(t+a,n+s,t+a-r.br,n+s),e.lineTo(t+r.bl,n+s),e.quadraticCurveTo(t,n+s,t,n+s-r.bl),e.lineTo(t,n+r.tl),e.quadraticCurveTo(t,n,t+r.tl,n),e.closePath(),o&&e.fill(),i&&e.stroke()}n(203);var ft=35,vt=function(e){Object(c.a)(n,e);var t=Object(l.a)(n);function n(e){var a;Object(o.a)(this,n),(a=t.call(this,e)).resetPointerDown=function(e){a.stageSelected=!1,a.sliderSelected=!1,a.stagePreviousPositon=0},a.handleKeyboard=function(e){switch(e.code){case"ArrowRight":a.handleBreakpoints(1);break;case"ArrowLeft":a.handleBreakpoints(-1)}},a.handleWheel=function(e){e.deltaY<0?a.props.functions.selectColumn(a.props.data.selected-1,!0):a.props.functions.selectColumn(a.props.data.selected+1,!0)},a.handleClick=function(e,t){var n=e.data.global.x;if("click"===t){var s=a.state.column.width*a.props.data.columns.length,r=Math.floor(n/a.state.width*s/a.state.column.width);a.props.functions.selectColumn(r)}"up"===t&&(a.sliderSelected=!1),"down"===t&&(a.sliderSelected=!0),"downStage"===t&&(a.stagePreviousPositon=n,a.stageSelected=!0)},a.handleStageSlide=function(e){var t=e.data.global.x;if(!0===a.stageSelected){if(a.throttleStage++,a.throttleStage<5)return;a.throttleStage=0;var n=a.stagePreviousPositon<t,s=Math.ceil(Math.abs(a.stagePreviousPositon-t)/8);s>4&&(s=4);var r=n?-1:1;a.stagePreviousPositon=t;var o=a.props.data.selected+r*s;if(a.props.data.selected===o)return;o<0&&(o=0),o>a.props.data.columns.length&&(o=a.props.data.columns.length-1),a.props.functions.selectColumn(o,!0)}},a.handleBreakpoints=function(e){var t,n=a.props.data.selected,s=a.props.data.columns,r=a.props.data.breakpoints;(t=1===e?r.filter((function(e){return e>n})).sort((function(e,t){return e-t})):r.filter((function(e){return e<n})).sort((function(e,t){return t-e}))).length>=0&&s.length>=t[0]&&t[0]>=0&&a.props.functions.selectColumn(t[0])},a.handleSlide=function(e){if(a.sliderSelected){if(a.throttleStage++,a.throttleStage<4)return;a.throttleStage=0;var t=a.state.column.width*a.props.data.columns.length,n=e.data.global.x,s=Math.floor(n/a.state.width*t/a.state.column.width);a.props.functions.selectColumn(s,!0)}};var s=document.body.getBoundingClientRect();a.sizes=s,ft=Number(a.props.data.settings.columnsPerCanvas.value);var r,i=xt(.82*s.width),c=xt(.45*s.height);window.screen.width<s.height&&(i=xt(.82*s.height),c=xt(.45*s.width)),"Sky"===f&&(c=xt(.95*c)),a.state={width:i,height:c,column:{width:(r=xt(i),xt(r/ft)),height:c},timelineHeight:De()()?25:30,currentBreakpoint:-1},a.canvasRef=d.a.createRef();var l=De()()?1:4;return a.cache=new gt(a.state.column.width,c,l,a.state.timelineHeight).cache,a.stageSelected=!1,a.sliderSelected=!1,a.stagePreviousPositon=0,a.throttleStage=0,a}return Object(i.a)(n,[{key:"componentDidMount",value:function(){window.addEventListener("pointerup",this.resetPointerDown),window.addEventListener("keydown",this.handleKeyboard),this.canvasRef.current._canvas.addEventListener("wheel",this.handleWheel)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("pointerup",this.resetPointerDown),window.removeEventListener("keydown",this.handleKeyboard),this.canvasRef.current._canvas.removeEventListener("wheel",this.handleWheel)}},{key:"render",value:function(){var e=this,t=this.state,n=this.props,a=n.data,s=n.functions,r=this.state.column,o=(a.selected-ft/2+1)*-r.width,i=this.state.timelineHeight,c=0,l=!1,u=this.cache,d=Number(a.settings.beatMarks.value),h=0===d?11:4*d-1,p=this.state.width/a.columns.length,g=Math.floor(p*(ft+1));g>this.state.width&&(g=this.state.width);var b=p*a.selected-(ft/2-1)*p;return Object(Z.jsxs)("div",{className:"canvas-wrapper",style:{width:t.width+6},children:[Object(Z.jsx)(rt.Stage,{width:t.width,height:t.height,raf:!1,renderOnComponentChange:!0,options:{backgroundColor:4805734},ref:this.canvasRef,children:Object(Z.jsx)(rt.Container,{anchor:[.5,.5],x:o,interactive:!0,pointerdown:function(t){return e.handleClick(t,"downStage")},pointermove:function(t){return e.handleStageSlide(t)},children:a.columns.map((function(e,t){if(c>h&&(l=!l,c=0),c++,!function(e,t){var n=ft/2+2,a=[t-n,t+n];return a[0]<e&&e<a[1]}(t,a.selected))return null;var n=(t+1)%4===0?u.columnsLarger:u.columns,o=((t+1)%4===0?u.standardLarger:u.standard)[Number(l)],i=0===e.tempoChanger?o:n[e.tempoChanger];return Object(Z.jsx)(jt,{cache:u,data:e,index:t,sizes:r,backgroundCache:i,isToolsSelected:a.toolsColumns.includes(t),click:s.selectColumn,isSelected:t===a.selected,isBreakpoint:a.breakpoints.includes(t)},t)}))})},this.state.width),Object(Z.jsxs)("div",{className:"timeline-wrapper",style:{height:this.state.timelineHeight},children:[Object(Z.jsx)("div",{className:"timeline-button",onClick:function(){return e.handleBreakpoints(-1)},children:Object(Z.jsx)(ne.a,{icon:ae.q})}),Object(Z.jsx)("div",{className:"timeline-button",onClick:function(){return e.handleBreakpoints(1)},children:Object(Z.jsx)(ne.a,{icon:ae.r})}),Object(Z.jsxs)(rt.Stage,{width:t.width,height:i,options:{antialias:!0,autoDensity:!0,backgroundColor:5332079},raf:!1,renderOnComponentChange:!0,children:[Object(Z.jsxs)(rt.Container,{width:this.state.width,height:this.state.timelineHeight,interactive:!0,pointertap:function(t){return e.handleClick(t,"click")},pointerdown:function(t){return e.handleClick(t,"down")},pointerup:function(t){return e.handleClick(t,"up")},pointermove:this.handleSlide,children:[Object(Z.jsx)(rt.Graphics,{draw:function(t){var n,a,s;n=t,a=e.state.width,s=e.state.timelineHeight,n.clear(),n.beginFill(5332079,1),n.drawRect(0,0,a,s)}}),a.breakpoints.map((function(e){return Object(Z.jsx)(rt.Sprite,{image:u.breakpoints[0],x:p*e},e)}))]}),Object(Z.jsx)(rt.Graphics,{draw:function(t){return n=t,a=g,s=e.state.timelineHeight,n.clear(),n.lineStyle(3,1742475,.8),void n.drawRoundedRect(0,0,a-2,s-4,6);var n,a,s},x:b,y:2})]}),Object(Z.jsx)("div",{className:"timeline-button",onClick:s.toggleBreakpoint,children:Object(Z.jsx)(ne.a,{icon:a.breakpoints.includes(a.selected)?ae.i:ae.n})})]})]})}}]),n}(u.Component);function jt(e){var t=e.data,n=e.index,a=e.sizes,s=e.click,r=e.cache,o=e.backgroundCache,i=e.isBreakpoint,c=e.isSelected,l=e.isToolsSelected;return Object(Z.jsxs)(rt.Container,{pointertap:function(){return s(n)},interactive:!0,x:a.width*n,children:[Object(Z.jsxs)(rt.Sprite,{image:o,interactiveChildren:!1,children:[c||l?Object(Z.jsx)(rt.Sprite,{image:l&&!c?r.standard[3]:r.standard[2],alpha:l?.4:.6,zIndex:1}):null,i?Object(Z.jsx)(rt.Sprite,{image:r.breakpoints[1]}):null]}),t.notes.map((function(e){return Object(Z.jsx)(rt.Sprite,{image:r.notes[e.layer],y:N[e.index]*a.height/y},e.index)}))]})}function xt(e){return 2*Math.round(e/2)}var yt=vt,Ot=function(e){Object(c.a)(n,e);var t=Object(l.a)(n);function n(e){var a;return Object(o.a)(this,n),(a=t.call(this,e)).handleKeyboard=function(e){var t=e.code;if("INPUT"!==document.activeElement.tagName&&"Escape"===t)a.state.open&&a.props.functions.toggleMenuVisible(),a.setState({open:!1})},a.toggleMenu=function(e){"boolean"!==typeof e&&(e=void 0);var t=void 0!==e?e:!a.state.open;a.setState({open:t}),!1===t&&a.props.functions.toggleMenuVisible()},a.changeSelectedSongType=function(e){a.setState({selectedSongType:e})},a.selectSideMenu=function(e){if(e===a.state.selectedMenu&&a.state.open)return a.setState({open:!1});a.setState({selectedMenu:e,open:!0})},a.downloadSong=function(e){e._id&&delete e._id,e.data.isComposedVersion&&(e=V(e));var t=e.name;"Sky"===f&&(e=W(e)),Array.isArray(e)||(e=[e]),e.forEach((function(e){e.data.appName=f}));var n=JSON.stringify(e);(new B).download(n,"".concat(t,".").concat(f.toLowerCase(),"sheet.json")),new M("Success","Song downloaded").trigger()},a.state={open:!1,selectedMenu:"Settings",selectedSongType:"composed"},a}return Object(i.a)(n,[{key:"componentDidMount",value:function(){window.addEventListener("keydown",this.handleKeyboard)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("keydown",this.handleKeyboard)}},{key:"render",value:function(){var e=this,t=this.props,n=t.data,a=t.functions,s=this.state.open?"side-menu menu-open":"side-menu",r=this.state.selectedMenu,o=a.loadSong,i=a.removeSong,c=a.updateSong,l=a.changePage,u=a.handleSettingChange,d=a.changeVolume,h=a.createNewSong,p=a.changeMidiVisibility,g={loadSong:o,removeSong:i,toggleMenu:this.toggleMenu,downloadSong:this.downloadSong},b=n.songs.filter((function(e){var t;return!(null===(t=e.data)||void 0===t?void 0:t.isComposedVersion)})),m=n.songs.filter((function(e){var t;return null===(t=e.data)||void 0===t?void 0:t.isComposedVersion})),f=n.hasChanges?"margin-top-auto not-saved":"margin-top-auto",v=n.menuOpen?"menu menu-visible":"menu";return Object(Z.jsxs)("div",{className:"menu-wrapper",children:[Object(Z.jsxs)("div",{className:v,children:[Object(Z.jsx)(wt,{action:this.toggleMenu}),Object(Z.jsx)(At,{type:"Save",action:function(){return c(n.currentSong)},className:f,children:Object(Z.jsx)(ne.a,{icon:ae.o,className:"icon"})}),Object(Z.jsx)(At,{type:"Songs",action:this.selectSideMenu,children:Object(Z.jsx)(ne.a,{icon:ae.j,className:"icon"})}),Object(Z.jsx)(At,{type:"Settings",action:this.selectSideMenu,children:Object(Z.jsx)(ne.a,{icon:ae.d,className:"icon"})}),Object(Z.jsx)(At,{type:"Composer",action:function(){return l("")},className:"inverted",children:Object(Z.jsx)(ne.a,{icon:ae.e,className:"icon"})})]}),Object(Z.jsxs)("div",{className:s,children:[Object(Z.jsx)(kt,{title:"No selection",visible:r}),Object(Z.jsxs)(kt,{title:"Songs",visible:r,children:[Object(Z.jsxs)("div",{className:"songs-buttons-wrapper",children:[Object(Z.jsx)("button",{className:"genshin-button",onClick:function(){p(!0),e.toggleMenu()},children:"Create from MIDI"}),Object(Z.jsx)("button",{className:"genshin-button",onClick:h,children:"Create new song"})]}),Object(Z.jsxs)("div",{className:"tab-selector-wrapper",children:[Object(Z.jsx)("button",{className:"recorded"===this.state.selectedSongType?"tab-selector tab-selected":"tab-selector",onClick:function(){return e.changeSelectedSongType("recorded")},children:"Recorded"}),Object(Z.jsx)("button",{className:"composed"===this.state.selectedSongType?"tab-selector tab-selected":"tab-selector",onClick:function(){return e.changeSelectedSongType("composed")},children:"Composed"})]}),Object(Z.jsx)("div",{className:"songs-wrapper",style:{marginBottom:"0.5rem"},children:"recorded"===this.state.selectedSongType?b.map((function(e){return Object(Z.jsx)(St,{data:e,functions:g},e.name)})):m.map((function(e){return Object(Z.jsx)(St,{data:e,functions:g},e.name)}))}),Object(Z.jsx)("div",{className:"songs-buttons-wrapper",style:{marginTop:"auto"},children:Object(Z.jsx)("button",{className:"genshin-button record-btn ".concat(n.isRecordingAudio?"selected":""),onClick:function(){return a.startRecordingAudio(!n.isRecordingAudio)},children:n.isRecordingAudio?"Stop recording audio":"Start recording audio"})})]}),Object(Z.jsxs)(kt,{title:"Settings",visible:r,children:[Object.entries(n.settings).map((function(e){var t=Object(ce.a)(e,2),n=t[0],a=t[1];return Object(Z.jsx)(Ct,{objKey:n,data:a,changeVolume:d,update:u},n+a.value)})),!Nt()&&Object(Z.jsx)("a",{className:"donate-button",href:"https://www.buymeacoffee.com/Specy",target:"_blank",rel:"noreferrer",children:"Support me"})]})]})]})}}]),n}(u.Component);function kt(e){var t=e.visible===e.title?"menu-panel menu-panel-visible":"menu-panel";return Object(Z.jsxs)("div",{className:t,children:[Object(Z.jsx)("div",{className:"menu-title",children:e.title}),Object(Z.jsx)("div",{className:"panel-content-wrapper",children:e.children})]})}function wt(e){return Object(Z.jsx)("div",{onClick:function(){return e.action(!1)},className:"close-menu menu-item",children:Object(Z.jsx)(ne.a,{icon:ae.u,className:"icon"})})}function St(e){var t=e.data,n=e.functions,a=n.removeSong,s=n.toggleMenu,r=n.loadSong,o=n.downloadSong;return Object(Z.jsxs)("div",{className:"song-row",children:[Object(Z.jsx)("div",{className:"song-name",onClick:function(){r(t),s(!1)},children:t.name}),Object(Z.jsxs)("div",{className:"song-buttons-wrapper",children:[Object(Z.jsx)("button",{className:"song-button",onClick:function(){return o(t)},children:Object(Z.jsx)(ne.a,{icon:ae.g})}),Object(Z.jsx)("button",{className:"song-button",onClick:function(){return a(t.name)},children:Object(Z.jsx)(ne.a,{icon:ae.w,color:"#ed4557"})})]})]})}function Ct(e){var t=e.data,n=e.update,a=e.objKey,s=e.changeVolume,r=Object(u.useState)(t.value),o=Object(ce.a)(r,2),i=o[0],c=o[1],l=Object(u.useState)(t.volume),d=Object(ce.a)(l,2),h=d[0],p=d[1];function g(e){var s=e.target.value;t.value=s,n({key:a,data:t})}return"settingVesion"===a?null:Object(Z.jsxs)("div",{className:"settings-row",children:[Object(Z.jsx)("div",{children:t.name}),"select"===t.type?Object(Z.jsx)("select",{value:t.value,onChange:g,children:t.options.map((function(e){return Object(Z.jsx)("option",{value:e,children:e},e)}))}):null,["number","text","checkbox"].includes(t.type)?Object(Z.jsx)("input",{type:t.type,value:i,checked:i,onChange:function(e){var s=e.target,r="checkbox"===t.type?s.checked:s.value;if(!("number"===t.type&&(r=Number(r),e.target.value="",r<t.threshold[0]||r>t.threshold[1]))){if("checkbox"===s.type)t.value=r,n({key:a,data:t});c(r)}},onBlur:function(){t.value!==i&&(t.value=i,n({key:a,data:t}))}}):null,"instrument"===t.type?Object(Z.jsxs)("div",{className:"instrument-picker",children:[Object(Z.jsx)("select",{value:t.value,onChange:g,children:t.options.map((function(e){return Object(Z.jsx)("option",{value:e,children:e},e)}))}),Object(Z.jsx)("input",{type:"range",min:1,max:100,value:h,onChange:function(e){p(Number(e.target.value))},onPointerUp:function(){s({key:a,value:h})}})]}):null]})}function Nt(){return JSON.parse(sessionStorage.getItem("isTwa"))}var At=function(e){Object(c.a)(n,e);var t=Object(l.a)(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(i.a)(n,[{key:"render",value:function(){var e=this,t=this.props.className?"menu-item ".concat(this.props.className):"menu-item";return Object(Z.jsx)("div",{className:t,onClick:function(){return e.props.action(e.props.type)},children:this.props.children})}}]),n}(u.Component),Et=Ot,Tt=function(e){Object(c.a)(n,e);var t=Object(l.a)(n);function n(e){var a;Object(o.a)(this,n),(a=t.call(this,e)).init=Object(r.a)(s.a.mark((function e(){var t,n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a.syncSongs(),t=a.state.settings,n=[a.loadInstrument(t.instrument.value,1),a.loadInstrument(t.layer2.value,2),a.loadInstrument(t.layer3.value,3)],e.next=5,Promise.all(n);case 5:return e.next=7,a.loadReverb();case 7:a.setupAudioDestination(t.caveMode.value);case 8:case"end":return e.stop()}}),e)}))),a.handleAutoSave=function(){a.changes++,a.changes>5&&a.state.settings.autosave.value&&"Untitled"!==a.state.song.name&&a.updateSong(a.state.song)},a.getSettings=function(){var e=localStorage.getItem(f+"_Composer_Settings");try{e=JSON.parse(e)}catch(t){e=null}return null!==e?e.settingVesion!==Pe.settingVesion?(a.updateSettings(Pe),Pe):e:Pe},a.updateSettings=function(e){var t;t=void 0!==e?e:a.state.settings,localStorage.setItem(f+"_Composer_Settings",JSON.stringify(t))},a.handleSettingChange=function(e){var t=Object(b.a)(a).state,n=t.settings,s=e.data;n[e.key].value=s.value,s.songSetting&&(t.song[e.key]=s.value),"instrument"===e.key&&a.loadInstrument(s.value,1),"layer2"===e.key&&a.loadInstrument(s.value,2),"layer3"===e.key&&a.loadInstrument(s.value,3),"caveMode"===e.key&&a.setupAudioDestination(s.value),a.setState({settings:n,song:a.state.song},(function(){a.updateSettings()}))},a.loadInstrument=function(){var e=Object(r.a)(s.a.mark((function e(t,n){var r,o,i,c,l;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=a.state.settings,1!==n){e.next=10;break}return a.state.instrument.delete(),o=new Ve(t),e.next=6,o.load();case 6:o.changeVolume(r.instrument.volume),a.setState({instrument:o}),e.next=18;break;case 10:return c=new Ve(t),(l=a.state.layers)[n-2].delete(),l[n-2]=c,e.next=16,c.load();case 16:c.changeVolume(null===(i=r["layer".concat(n)])||void 0===i?void 0:i.volume),a.setState({layers:l});case 18:a.setupAudioDestination(r.caveMode.value);case 19:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),a.changeVolume=function(e){var t=a.state.settings;"instrument"===e.key&&(t.instrument.volume=e.value,a.state.instrument.changeVolume(e.value)),"layer2"===e.key&&(t.layer2.volume=e.value,a.state.layers[0].changeVolume(e.value)),"layer3"===e.key&&(t.layer3.volume=e.value,a.state.layers[1].changeVolume(e.value)),a.setState({settings:t},(function(){return a.updateSettings()}))},a.setupAudioDestination=function(e){var t=a.state,n=t.instrument,s=t.layers;[n,s[0],s[1]].forEach((function(t){if(e){if(!a.reverbNode)return console.log("Couldn't connect to reverb");t.disconnect(),t.connect(a.reverbNode)}else t.disconnect(),t.connect(a.audioContext.destination)}))},a.startRecordingAudio=function(){var e=Object(r.a)(s.a.mark((function e(t){var n,r,o,i,c,l,u,d,h;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=3;break}return a.setState({isRecordingAudio:!1}),e.abrupt("return",a.togglePlay(!1));case 3:return n=a.state,r=n.instrument,o=n.layers,i=[r,o[0],o[1]],c=a.state.settings.caveMode.value,l=Object(b.a)(a),u=l.recorder,c?a.reverbVolumeNode.connect(u.node):i.forEach((function(e){e.connect(u.node)})),u.start(),a.setState({isRecordingAudio:!0}),e.next=12,a.togglePlay(!0);case 12:return e.next=14,u.stop();case 14:return d=e.sent,a.setState({isRecordingAudio:!1}),e.next=18,Be("Write the song name, press cancel to ignore");case 18:(h=e.sent)&&u.download(d.data,h+".wav"),a.reverbVolumeNode.disconnect(),a.reverbVolumeNode.connect(j.destination),a.setupAudioDestination(c);case 23:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.handleKeyboard=function(e){if("INPUT"!==document.activeElement.tagName){var t=a.state,n=t.instrument,s=t.layer,r=t.layers,o=t.isPlaying,i=e.code;if(o||e.shiftKey){var c=null===i||void 0===i?void 0:i.replace("Key",""),l=n.getNoteFromCode(c);switch(null!==l&&a.handleClick(n.layout[l]),i){case"Space":var u,d;if(a.togglePlay(),!a.state.settings.syncTabs.value)break;null===(u=a.broadcastChannel)||void 0===u||null===(d=u.postMessage)||void 0===d||d.call(u,"stop")}}else switch(i){case"KeyD":a.selectColumn(a.state.song.selected+1);break;case"KeyA":a.selectColumn(a.state.song.selected-1);break;case"Digit1":a.handleTempoChanger(R[0]);break;case"Digit2":a.handleTempoChanger(R[1]);break;case"Digit3":a.handleTempoChanger(R[2]);break;case"Digit4":a.handleTempoChanger(R[3]);break;case"Space":var h,p;if(a.togglePlay(),!a.state.settings.syncTabs.value)break;null===(h=a.broadcastChannel)||void 0===h||null===(p=h.postMessage)||void 0===p||p.call(h,"play");break;case"ArrowUp":var g=s-1;g>0&&a.changeLayer(g);break;case"ArrowDown":var b=s+1;b<r.length+2&&a.changeLayer(b);break;case"KeyQ":a.removeColumns(1,a.state.song.selected);break;case"KeyE":a.addColumns(1,a.state.song.selected)}}},a.playSound=function(e,t){try{var n=e.layout[t];if(void 0===n)return;e.play(n.index,Y(a.state.settings.pitch.value))}catch(s){}},a.changePitch=function(e){var t=a.state.settings;t.pitch.value=e,a.setState({settings:t},(function(){return a.updateSettings()}))},a.handleClick=function(e){var t=a.state.song.columns[a.state.song.selected],n=t.notes.findIndex((function(t){return e.index===t.index})),s=a.state.layer-1;if(n<0){var r=new J(e.index);r.layer=Mt(r.layer,s,"1"),t.notes.push(r)}else{var o=t.notes[n];o.layer=Mt(o.layer,s,"0"===o.layer[s]?"1":"0"),"000"===o.layer&&t.notes.splice(n,1)}a.setState({song:a.state.song}),a.handleAutoSave();var i=a.state.instrument;a.state.layer>1&&(i=a.state.layers[a.state.layer-2]),a.playSound(i,e.index)},a.syncSongs=Object(r.a)(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.dbCol.songs.find().toArray();case 2:t=(t=e.sent).map((function(e){return e.data.isComposedVersion?I(e):e})),a.setState({composedSongs:t,songs:t});case 5:case"end":return e.stop()}}),e)}))),a.addSong=function(){var e=Object(r.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.songExists(t.name);case 2:if(!e.sent){e.next=4;break}return e.abrupt("return",new M("Warning","A song with this name already exists! \n"+t.name).trigger());case 4:return e.next=6,a.dbCol.songs.insert(V(t));case 6:a.syncSongs();case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.updateSong=function(){var e=Object(r.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("Untitled"!==t.name){e.next=8;break}return e.next=3,a.askForSongName();case 3:if(null!==(n=e.sent)){e.next=6;break}return e.abrupt("return");case 6:return t.name=n,e.abrupt("return",a.addSong(t));case 8:return e.abrupt("return",new Promise(function(){var e=Object(r.a)(s.a.mark((function e(n){var r,o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.state.settings,e.next=3,a.songExists(t.name);case 3:if(!e.sent){e.next=14;break}return t.instruments[0]=r.instrument.value,t.instruments[1]=r.layer2.value,t.instruments[2]=r.layer3.value,e.next=9,a.dbCol.songs.update({name:t.name},V(t));case 9:console.log("song saved:",t.name),a.changes=0,a.syncSongs(),e.next=28;break;case 14:if(!t.name.includes("- Composed")){e.next=25;break}return e.next=17,a.askForSongName("Write composed song name, press cancel to ignore");case 17:if(null!==(o=e.sent)){e.next=20;break}return e.abrupt("return",n());case 20:return t.name=o,e.next=23,a.dbCol.songs.insert(V(t));case 23:return a.syncSongs(),e.abrupt("return",n());case 25:console.log("song doesn't exist"),t.name="Untitled",a.updateSong(t);case 28:n();case 29:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.askForSongName=function(e){return new Promise(function(){var t=Object(r.a)(s.a.mark((function t(n){var r,o;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=e||"Write song name, press cancel to ignore";case 1:return t.next=4,Be(r);case 4:if(null!==(o=t.sent)){t.next=7;break}return t.abrupt("return",n(null));case 7:if(""===o){t.next=17;break}return t.next=10,a.songExists(o);case 10:if(!t.sent){t.next=14;break}r="This song already exists: "+o,t.next=15;break;case 14:return t.abrupt("return",n(o));case 15:t.next=18;break;case 17:r=e||"Write song name, press cancel to ignore";case 18:t.next=1;break;case 20:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())},a.askForSongUpdate=function(){return new Promise(function(){var e=Object(r.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Le('You have unsaved changes to the song: "'.concat(a.state.song.name,'" do you want to save now?'));case 2:n=e.sent,t(n);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())},a.songExists=function(){var e=Object(r.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.dbCol.songs.findOne({name:t});case 2:return e.t0=e.sent,e.t1=void 0,e.abrupt("return",e.t0!==e.t1);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.createNewSong=Object(r.a)(s.a.mark((function e(){var t,n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!("Untitled"!==a.state.song.name&&a.changes>0)){e.next=7;break}return e.next=3,a.askForSongUpdate();case 3:if(!e.sent){e.next=7;break}return e.next=7,a.updateSong(a.state.song);case 7:return e.next=9,a.askForSongName("Write new song name, press cancel to ignore");case 9:if(null!==(t=e.sent)){e.next=12;break}return e.abrupt("return");case 12:n=new L(t),a.changes=0,a.setState({song:n},(function(){return a.addSong(n)}));case 15:case"end":return e.stop()}}),e)}))),a.removeSong=function(){var e=Object(r.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Le("Are you sure you want to delete the song: "+t);case 2:e.sent&&a.dbCol.songs.remove({name:t},a.syncSongs);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.loadSong=function(){var e=Object(r.a)(s.a.mark((function e(t){var n,r,o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=a.state,(t=JSON.parse(JSON.stringify(t))).data.isComposedVersion||((t=K(t)).name+=" - Composed"),0===a.changes){e.next=12;break}if((r=n.settings.autosave.value&&"Untitled"!==n.song.name)||!(n.song.columns.length>0)){e.next=9;break}return e.next=8,Le('You have unsaved changes to the song: "'.concat(n.song.name,'" do you want to save? UNSAVED CHANGES WILL BE LOST'));case 8:r=e.sent;case 9:if(!r){e.next=12;break}return e.next=12,a.updateSong(n.song);case 12:(o=a.state.settings).bpm.value=t.bpm,o.pitch.value=t.pitch,o.instrument.value!==t.instruments[0]&&(a.loadInstrument(t.instruments[0],1),o.instrument.value=t.instruments[0]),o.layer2.value!==t.instruments[1]&&(a.loadInstrument(t.instruments[1],2),o.layer2.value=t.instruments[1]),o.layer3.value!==t.instruments[2]&&(a.loadInstrument(t.instruments[2],3),o.layer3.value=t.instruments[2]),a.changes=0,console.log("song loaded"),a.setState({song:t,settings:o,toolsColumns:[]});case 21:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.addColumns=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"end";return new Promise((function(n){var s=new Array(e).fill().map((function(){return new _})),r=a.state.song.columns;"end"===t?r.push.apply(r,Object(m.a)(s)):r.splice.apply(r,[t+1,0].concat(Object(m.a)(s))),1===e&&a.selectColumn(a.state.song.selected+1),a.handleAutoSave(),a.setState({song:a.state.song},n)}))},a.removeColumns=function(e,t){var n=a.state.song;n.columns.length<16||(new Array(e).fill().map((function(e,n){return t+n})).forEach((function(e){n.breakpoints.includes(e)&&a.toggleBreakpoint(e)})),n.columns.splice(t,e),n.columns.length<=n.selected&&a.selectColumn(n.selected-1),a.handleAutoSave(),a.setState({song:n}))},a.togglePlay=function(){var e=Object(r.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){var n="boolean"===typeof t?t:!a.state.isPlaying;a.setState({isPlaying:n},Object(r.a)(s.a.mark((function t(){var n,r,o,i,c,l,u;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:a.state.isPlaying&&a.selectColumn(a.state.song.selected),n=0,r=(new Date).getTime();case 3:if(!a.state.isPlaying){t.next=16;break}return o=a.state,i=o.song,c=o.settings,l=R[i.columns[i.selected].tempoChanger],u=Math.floor(6e4/c.bpm.value*l.changer)+n,r=(new Date).getTime(),t.next=10,q(u);case 10:if(a.state.isPlaying){t.next=12;break}return t.abrupt("break",16);case 12:a.handleTick(),n=r+u-(new Date).getTime(),t.next=3;break;case 16:e();case 17:case"end":return t.stop()}}),t)}))))})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.handleTick=function(){var e=a.state.song.selected+1;if(a.state.isPlaying&&e>a.state.song.columns.length-1)return a.togglePlay(!1);a.selectColumn(a.state.song.selected+1)},a.toggleMenuVisible=function(){a.setState({menuOpen:!a.state.menuOpen})},a.toggleBreakpoint=function(e){var t=a.state.song,n="number"===typeof e?e:t.selected,s=t.breakpoints.indexOf(n);s>=0&&t.columns.length>n?t.breakpoints.splice(s,1):t.columns.length>n&&t.breakpoints.push(n),a.validateBreakpoints(),a.setState({song:t})},a.handleTempoChanger=function(e){var t=a.state.song;t.columns[a.state.song.selected].tempoChanger=e.id,a.handleAutoSave(),a.setState({song:t})},a.changePage=function(){var e=Object(r.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0===a.changes){e.next=12;break}if(!a.state.settings.autosave.value){e.next=6;break}return e.next=4,a.updateSong(a.state.song);case 4:e.next=12;break;case 6:return e.next=8,Le('You have unsaved changes to the song: "'.concat(a.state.song.name,'" do you want to save? UNSAVED CHANGES WILL BE LOST'));case 8:if(!e.sent){e.next=12;break}return e.next=12,a.updateSong(a.state.song);case 12:a.props.changePage(t);case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.selectColumn=function(e,t){var n=a.state,s=n.song;if(!(e<0||e>s.columns.length-1)){var r=n.song.columns[e];s.selected=e;var o=n.toolsColumns;if(n.toolsVisible&&0===a.copiedColums.length){o.push(e);var i=Math.min.apply(Math,Object(m.a)(o)),c=Math.max.apply(Math,Object(m.a)(o));o=new Array(c-i+1).fill().map((function(e,t){return i+t}))}a.setState({song:s,toolsColumns:o}),t||r.notes.forEach((function(e){"1"===e.layer[0]&&a.playSound(n.instrument,e.index),"1"===e.layer[1]&&a.playSound(n.layers[0],e.index),"1"===e.layer[2]&&a.playSound(n.layers[1],e.index)}))}},a.changeLayer=function(e){a.setState({layer:e})},a.toggleTools=function(){a.setState({toolsVisible:!a.state.toolsVisible,toolsColumns:a.state.toolsVisible?[]:[a.state.song.selected]}),a.copiedColums=[]},a.copyColumns=function(e){a.copiedColums=[],a.state.toolsColumns.forEach((function(e){var t=a.state.song.columns[e];void 0!==t&&a.copiedColums.push(t)})),a.copiedColums=JSON.parse(JSON.stringify(a.copiedColums)),"all"!==e&&(a.copiedColums=a.copiedColums.map((function(t){return t.notes=t.notes.filter((function(t){return"1"===t.layer[e-1]})),t.notes=t.notes.map((function(t){return t.layer="000",t.layer=Mt(t.layer,e-1,"1"),t})),t}))),a.setState({toolsColumns:[]})},a.pasteColumns=function(){var e=Object(r.a)(s.a.mark((function e(t){var n,r,o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=a.state.song,r=JSON.parse(JSON.stringify(a.copiedColums)),t?r.forEach((function(e,t){var a=n.columns[n.selected+t];void 0!==a&&e.notes.forEach((function(e){var t=a.notes.findIndex((function(t){return e.index===t.index}));if(t<0)a.notes.push(e);else for(var n=0;n<3;n++)"1"===e.layer[n]&&(a.notes[t].layer=Mt(a.notes[t].layer,n,1))}))})):(o=n.columns).splice.apply(o,[n.selected,0].concat(Object(m.a)(r))),a.setState({song:n});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.eraseColumns=function(e){var t=a.state.song;"all"===e?a.state.toolsColumns.forEach((function(e){void 0!==t.columns[e]&&(t.columns[e].notes=[])})):a.state.toolsColumns.forEach((function(n){void 0!==t.columns[n]&&t.columns[n].notes.forEach((function(t){t.layer=Mt(t.layer,e-1,"0")}))})),a.setState({song:t})},a.validateBreakpoints=function(){var e=a.state.song.breakpoints.filter((function(e){return e<a.state.song.columns.length})),t=a.state.song;t.breakpoints=e,a.setState({song:t})},a.deleteColumns=Object(r.a)(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((t=a.state.song).columns=t.columns.filter((function(e,t){return!a.state.toolsColumns.includes(t)})),t.selected>t.columns.length-1&&(t.selected=t.columns.length-1),t.selected<=0&&(t.selected=0),0!==t.columns.length){e.next=7;break}return e.next=7,a.addColumns(12,0);case 7:a.setState({song:t,toolsColumns:[]},a.validateBreakpoints);case 8:case"end":return e.stop()}}),e)}))),a.changeMidiVisibility=function(e){a.setState({midiVisible:e})},a.db=new Ee.a.Db(f,{songs:[]}),a.dbCol={songs:a.db.collection("songs")};var i=a.getSettings();return a.playbackInterval=void 0,a.audioContext=j,a.reverbNode=void 0,a.reverbVolumeNode=void 0,a.recorder=new He,a.state={instrument:new Ve,layers:[new Ve,new Ve],songs:[],isPlaying:!1,song:new L("Untitled"),settings:i,menuOpen:!1,layer:1,toolsColumns:[],toolsVisible:!1,midiVisible:!1,isRecordingAudio:!1},a.copiedColums=[],a.changes=0,a.broadcastChannel={},a}return Object(i.a)(n,[{key:"componentDidMount",value:function(){var e=this;this.init(),window.addEventListener("keydown",this.handleKeyboard),this.broadcastChannel=window.BroadcastChannel?new BroadcastChannel(f+"_composer"):{},this.broadcastChannel.onmessage=function(t){e.state.settings.syncTabs.value&&["play","stop"].includes(null===t||void 0===t?void 0:t.data)&&e.togglePlay("play"===t.data)},"localhost"!==window.location.hostname&&window.addEventListener("beforeunload",(function(e){e.preventDefault(),e.returnValue=""}))}},{key:"componentWillUnmount",value:function(){var e,t;window.removeEventListener("keydown",this.handleKeyboard);var n=this.state,a=n.instrument,s=n.layers;null===(e=this.broadcastChannel)||void 0===e||null===(t=e.close)||void 0===t||t.call(e),[a,s[0],s[1]].forEach((function(e){return e.delete()})),this.reverbNode=void 0,this.reverbVolumeNode=void 0,this.audioContext=void 0,this.state.isPlaying=!1}},{key:"componentDidCatch",value:function(){this.setState({song:new L("Untitled")}),new M("Warning","There was an error with the song! Restoring default...").trigger()}},{key:"loadReverb",value:function(){var e=this;return new Promise((function(t){fetch("./assets/audio/reverb4.wav").then((function(e){return e.arrayBuffer()})).then((function(n){e.audioContext.decodeAudioData(n,(function(n){var a=e.audioContext.createConvolver(),s=e.audioContext.createGain();s.gain.value=2.5,a.buffer=n,a.connect(s),s.connect(e.audioContext.destination),e.reverbNode=a,e.reverbVolumeNode=s,t()}))})).catch((function(e){console.log("Error with reverb",e)}))}))}},{key:"render",value:function(){var e=this,t=this.state,n=t.midiVisible,a=t.song,s={songs:t.songs,currentSong:t.song,settings:t.settings,hasChanges:this.changes,menuOpen:t.menuOpen,isRecordingAudio:t.isRecordingAudio},r={loadSong:this.loadSong,removeSong:this.removeSong,createNewSong:this.createNewSong,changePage:this.changePage,updateSong:this.updateSong,handleSettingChange:this.handleSettingChange,toggleMenuVisible:this.toggleMenuVisible,changeVolume:this.changeVolume,changeMidiVisibility:this.changeMidiVisibility,startRecordingAudio:this.startRecordingAudio},o={handleClick:this.handleClick,handleTempoChanger:this.handleTempoChanger,changeLayer:this.changeLayer},i={keyboard:t.instrument,currentColumn:t.song.columns[t.song.selected],TempoChangers:R,layer:t.layer,pitch:t.settings.pitch.value,isPlaying:t.isPlaying,noteNameType:t.settings.noteNameType.value},c={selectColumn:this.selectColumn,toggleBreakpoint:this.toggleBreakpoint},l={columns:a.columns,selected:a.selected,settings:t.settings,breakpoints:t.song.breakpoints,toolsColumns:t.toolsColumns},u={visible:this.state.toolsVisible,copiedColumns:this.copiedColums,layer:this.state.layer},d={toggleTools:this.toggleTools,eraseColumns:this.eraseColumns,deleteColumns:this.deleteColumns,copyColumns:this.copyColumns,pasteColumns:this.pasteColumns},h={loadSong:this.loadSong,changeMidiVisibility:this.changeMidiVisibility,changePitch:this.changePitch},p={instruments:[t.instrument].concat(Object(m.a)(t.layers)).map((function(e){return e.instrumentName})),selectedColumn:a.selected};return Object(Z.jsxs)("div",{className:"app bg-image",style:{backgroundImage:"url(".concat(t.settings.backgroundImage.value,")")},children:[n&&Object(Z.jsx)(Xe,{functions:h,data:p}),Object(Z.jsx)("div",{className:"hamburger",onClick:this.toggleMenuVisible,children:Object(Z.jsx)(ne.a,{icon:ae.a})}),Object(Z.jsxs)("div",{className:"rotate-screen",children:[Object(Z.jsx)("img",{src:Ie,alt:"a rotating screen"}),"For a better experience, add the website to the home screen, and rotate your device"]}),Object(Z.jsxs)("div",{className:"right-panel-composer",children:[Object(Z.jsx)("div",{className:"column fill-x",children:Object(Z.jsxs)("div",{className:"top-panel-composer",children:[Object(Z.jsxs)("div",{className:"buttons-composer-wrapper",children:[Object(Z.jsx)("div",{className:"tool",onClick:function(){return e.selectColumn(a.selected+1)},children:Object(Z.jsx)(ne.a,{icon:ae.c})}),Object(Z.jsx)("div",{className:"tool",onClick:function(){return e.selectColumn(a.selected-1)},children:Object(Z.jsx)(ne.a,{icon:ae.b})}),Object(Z.jsx)("div",{className:"tool",onClick:this.togglePlay,children:Object(Z.jsx)(ne.a,{icon:this.state.isPlaying?ae.k:ae.l})})]}),Object(Z.jsx)(yt,{functions:c,data:l},this.state.settings.columnsPerCanvas.value),Object(Z.jsxs)("div",{className:"buttons-composer-wrapper-right",children:[Object(Z.jsx)("div",{className:"tool",onClick:function(){return e.addColumns(1,a.selected)},children:Object(Z.jsx)("img",{src:Ye,className:"tool-icon",alt:"Add a new cell"})}),Object(Z.jsx)("div",{className:"tool",onClick:function(){return e.removeColumns(1,a.selected)},children:Object(Z.jsx)("img",{src:qe,className:"tool-icon",alt:"Remove a cell"})}),Object(Z.jsx)("div",{className:"tool",onClick:function(){return e.addColumns(4*e.state.settings.beatMarks.value,"end")},children:Object(Z.jsx)(ne.a,{icon:ae.m})}),Object(Z.jsx)("div",{className:"tool",onClick:this.toggleTools,children:Object(Z.jsx)(ne.a,{icon:ae.v})})]})]})}),Object(Z.jsx)(st,{functions:o,data:i})]}),Object(Z.jsx)(Et,{data:s,functions:r}),Object(Z.jsx)(tt,{data:u,functions:d}),Object(Z.jsxs)("div",{className:"song-info",children:[Object(Z.jsx)("div",{children:a.name}),Object(Z.jsxs)("div",{children:[Dt(Pt(this.state.song,this.state.song.selected)),"/",Dt(Pt(this.state.song,this.state.song.columns.length))]})]})]})}}]),n}(u.Component);function Dt(e){var t=Math.floor(e/6e4),n=(e%6e4/1e3).toFixed(0);return 60===n?t+1+":00":t+":"+(n<10?"0":"")+n}function Pt(e,t){var n=e.columns,a=Math.floor(6e4/e.bpm),s=0;return n.forEach((function(e,n){n>t||(s+=a*R[e.tempoChanger].changer)})),s}function Mt(e,t,n){return t>=e.length?e.valueOf():e.substring(0,t)+n+e.substring(t+1)}var Bt=Tt,Rt=function(e){Object(c.a)(n,e);var t=Object(l.a)(n);function n(e){var a;return Object(o.a)(this,n),(a=t.call(this,e)).syncSongs=Object(r.a)(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.dbCol.songs.find().toArray();case 2:t=e.sent,a.setState({songs:t});case 4:case"end":return e.stop()}}),e)}))),a.deleteSong=function(){var e=Object(r.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Le("Are you sure you want to delete the song: "+t);case 2:if(!e.sent){e.next=4;break}a.dbCol.songs.remove({name:t},a.syncSongs);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.deleteAllSongs=Object(r.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Le("Are you sure you want to delete ALL SONGS?");case 2:if(!e.sent){e.next=4;break}a.dbCol.songs.remove({},a.syncSongs);case 4:case"end":return e.stop()}}),e)}))),a.resetSettings=function(){localStorage.removeItem(f+"_Composer_Settings"),localStorage.removeItem(f+"_Main_Settings"),new M("Success","Settings have been reset").trigger()},a.downloadSong=function(e){e._id&&delete e._id;var t=JSON.stringify(e);(new B).download(t,"".concat(e.name,".").concat(f.toLowerCase(),"sheet.json"))},a.db=new Ee.a.Db(f,{songs:[]}),a.dbCol={songs:a.db.collection("songs")},a.state={songs:[]},a.syncSongs(),a}return Object(i.a)(n,[{key:"render",value:function(){var e=this;return Object(Z.jsxs)("div",{className:"error-page app",children:[Object(Z.jsxs)("div",{className:"error-text-wrapper",children:["There seems to be an error. ",Object(Z.jsx)("br",{}),"Here you can download or delete your songs, try to find what song caused the error and remove it."]}),Object(Z.jsxs)("div",{className:"error-buttons-wrapper",children:[Object(Z.jsx)("button",{className:"genshin-button",onClick:this.resetSettings,children:"Reset settings"}),Object(Z.jsx)("button",{className:"genshin-button",onClick:this.deleteAllSongs,children:"Delete all songs"})]}),Object(Z.jsx)("div",{className:"error-songs-wrapper",children:this.state.songs.map((function(t){return Object(Z.jsx)(Lt,{data:t,functions:{deleteSong:e.deleteSong,downloadSong:e.downloadSong}})}))}),Object(Z.jsx)("button",{className:"error-go-back genshin-button",onClick:function(){return e.props.changePage("")},children:"Go back to main page"})]})}}]),n}(u.Component);function Lt(e){var t=e.data,n=e.functions.deleteSong,a=e.functions.downloadSong;return Object(Z.jsxs)("div",{className:"song-row",children:[Object(Z.jsx)("div",{className:"song-name",children:t.name}),Object(Z.jsxs)("div",{className:"song-buttons-wrapper",children:[Object(Z.jsx)("button",{className:"song-button",onClick:function(){return a(t)},children:Object(Z.jsx)(ne.a,{icon:ae.g})}),Object(Z.jsx)("button",{className:"song-button",onClick:function(){return n(t.name)},children:Object(Z.jsx)(ne.a,{icon:ae.w,color:"#ed4557"})})]})]})}var Ft=Rt,It=(n(204),n(92)),Gt=function(e){Object(c.a)(n,e);var t=Object(l.a)(n);function n(e){var a;return Object(o.a)(this,n),(a=t.call(this,e)).state={},a}return Object(i.a)(n,[{key:"render",value:function(){var e=this;return Object(Z.jsxs)("div",{className:"changelog-page",children:[Object(Z.jsx)("div",{className:"changelog-page-title",children:"Changelog"}),Object(Z.jsx)("div",{className:"absolute-changelog-btn",onClick:function(){return e.props.changePage("")},children:Object(Z.jsx)(It.a,{size:25})}),Wt.map((function(e){return Object(Z.jsx)(Vt,{data:e},e.version)})),Object(Z.jsx)("div",{className:"changelog-ending"})]})}}]),n}(u.Component);function Vt(e){var t=e.data,n=t.version,a=t.title,s=t.changes,r=t.date;return Object(Z.jsxs)("div",{className:"changelog-wrapper",children:[Object(Z.jsxs)("div",{className:"changelog-title",children:[Object(Z.jsx)("div",{className:"clt-1",children:n}),Object(Z.jsx)("div",{className:"clt-2",children:r})]}),Object(Z.jsxs)("div",{className:"changelog-list",children:[Object(Z.jsx)("div",{className:"cll-1",children:a}),Object(Z.jsx)("ul",{children:s.map((function(e,t){return Object(Z.jsx)("li",{children:e.split("$l").map((function(e,t,n){return 0===t?Object(Z.jsx)("div",{children:e},t):Object(Z.jsx)("p",{className:"cll-new-line",children:e},t)}))},t)}))})]})]})}var Wt=[{version:"2.0",title:"Approaching circles",date:"2021 - 28/11",changes:["Added Approaching cirlces mode, a new way to learn a song, or a way to challange yourself.\n            You can find it in the main page, next to the practice button","Rewrite of the main page to increase overall performance","Added changelog page","Added audio recording feature in main page and composer","Added tabs autoplay (composer) on pc as a setting","Added note animations when pressing the note","Added possibility to change background image from URL","Updated info page","In the composer you can now press shift + note name to add a note","In the composer you can press up/down keys to change layer",'While in the composer on PC, you can now add new notes by simply pressing the PC keyboard while in "playing" mode']},{version:"1.7",title:"Zither",date:"2021 - 20/10",changes:["(For genshin) Added Zither",'Added back "do re mi" format']},{version:"1.6",title:"Performance tweaks",date:"2021 - 17/10",changes:["Performance of composer improved by 2x","Added note names for genshin (made it a setting)","Fixed instrument volume bug","Fixed keyboard layout issues","Fixed other small bugs"]},{version:"1.5",title:"MIDI import",date:"2021 - 14/10",changes:["Added to both Sky and Genshin music nightly the MIDI import feature $l\n            - Music track selection (select or deselect which tracks to include) $l\n            - Instrument track selection (select what instrument to give to each track) $l\n            - Track info (get info on how successful your parsing was, accidentals and notes out of range) $l\n            - Change note offset (in case that the song is outside of the octaves available) \n            "]},{version:"1.4",title:"Song library",date:"2021 - 28/08",changes:["Added song library integration, directly import songs from the app (700+ songs)","Bug fixes"]},{version:"1.3",title:"New audio files",date:"2021 - 25/08",changes:["Changed audio files","Added ocarina","Removed support button in TWA","Bug fixes"]},{version:"1.2",title:"Bug fixes and PWA",date:"2021 - 18/08",changes:["(For sky) Fixed bug where sheets couldn't be imported in sky studio","Changed app install to more modern approach with description and images"]},{version:"1.1",title:"Sheets compatibility",date:"2021 - 07/08",changes:["(For sky) Added backwards compatibility for sheets, now sheets made in sky music nightly can be imported into sky music and sky studio (with some losses)","Bug fixes","General improvement in performance"]},{version:"1.0",title:"Release",date:"2021 - 22/05",changes:["3 Instruments composition","Better performance than previous version","Better practice tool","Better interface","Breakpoints for the composer","New features for both composer and main page","Feature rich customisability to make learning and composition easier"]}],Ut=Gt,Ht=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function Kt(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://cra.link/PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}var _t=n(93),Jt=n(13),zt=["","Composer","ErrorPage","Changelog"],Yt=!1,qt=function(e){Object(c.a)(n,e);var t=Object(l.a)(n);function n(e){var a;Object(o.a)(this,n),(a=t.call(this,e)).changePage=function(e){a.setState({selectedPage:e})},a.askForStorage=Object(r.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!navigator.storage||!navigator.storage.persist){e.next=6;break}return e.next=4,navigator.storage.persist();case 4:e.sent?new M("Success","Storage permission allowed").trigger():new M("Warning","Storage permission refused, if you weren't prompt, your browser denied it for you. Don't worry, it will still work fine",6e3).trigger();case 6:e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),console.log(e.t0),new M("Error","There was an error with setting up persistent storage").trigger();case 12:a.closeWelcomeScreen();case 13:case"end":return e.stop()}}),e,null,[[0,8]])}))),a.closeWelcomeScreen=function(){localStorage.setItem(f+"_Visited",!0),a.setState({hasVisited:!0})},a.hideMessage=function(){var e=a.state;e.floatingMessage.visible=!1,a.setState({floatingMessage:e.floatingMessage})},a.checkUpdate=Object(r.a)(s.a.mark((function e(){var t,n,r,o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,q(1500);case 2:if(!Yt){e.next=4;break}return e.abrupt("return");case 4:if(t="2.0",n="   - Added Approaching circles mode, a new way to learn a song\n\t\t\t\t- Better performance in the main page\n\t\t\t\t- On pc, you can now add notes with your keyboard while playing\n\t\t\t\t- Added changelog page\n\t\t\t\tMore info in the changelog page (Info tab)",r=localStorage.getItem(f+"_Version"),a.state.hasVisited){e.next=9;break}return e.abrupt("return",localStorage.setItem(f+"_Version",t));case 9:if(t!==r&&(new M("Update V"+t,n,6e3).trigger(),localStorage.setItem(f+"_Version",t)),Yt=!0,a.state.hasVisited){e.next=13;break}return e.abrupt("return");case 13:if(!navigator.storage||!navigator.storage.persist){e.next=22;break}return e.next=16,navigator.storage.persisted();case 16:if(o=e.sent){e.next=21;break}return e.next=20,navigator.storage.persist();case 20:o=e.sent;case 21:console.log(o?"Storage Persisted":"Storage Not persisted");case 22:case"end":return e.stop()}}),e)}))),a.logEvent=function(e){(e=e.detail).timestamp=(new Date).getTime(),"object"===typeof e&&(a.setState({floatingMessage:{timestamp:e.timestamp,visible:!0,text:e.text,title:e.title}}),setTimeout((function(){a.state.floatingMessage.timestamp===e.timestamp&&a.setState({floatingMessage:{timestamp:0,visible:!1,text:"",title:""}})}),e.timeout))};var i=window.location.href.split("/");i=0===i.length?"":i=i[i.length-1],zt.includes(i)||(i="");var c=localStorage.getItem(f+"_Visited");return c=null!==c&&Boolean(c),a.state={floatingMessage:{timestamp:0,visible:!1,text:"Text",title:"Title"},updateChecked:!1,hasPersistentStorage:navigator.storage&&navigator.storage.persist,selectedPage:i,hasVisited:c},a}return Object(i.a)(n,[{key:"componentDidMount",value:function(){window.addEventListener("logEvent",this.logEvent),this.checkUpdate()}},{key:"componentDidCatch",value:function(){this.setState({selectedPage:"ErrorPage"})}},{key:"componentWillUnmount",value:function(){window.removeEventListener("logEvent",this.logEvent)}},{key:"render",value:function(){var e=this.state.floatingMessage,t=e.visible?"floating-message floating-message-visible":"floating-message";return Object(Z.jsxs)("div",{className:"index",children:[Object(Z.jsxs)("div",{className:t,onClick:this.hideMessage,children:[Object(Z.jsx)("div",{className:"floating-message-title",children:e.title}),Object(Z.jsx)("div",{className:"floating-message-text",children:e.text})]}),this.state.hasVisited?null:Object(Z.jsxs)("div",{className:"welcome-message",children:[Object(Z.jsxs)("div",{className:"welcome-overflow",children:[Object(Z.jsxs)("div",{className:"welcome-message-title",children:["Welcome to ",f," music ","Sky"===f?"nightly":""]}),Object(Z.jsxs)("div",{children:['This is a webapp which is run in your browser, if you currently are on one, please add the website to the homescreen to have a fullscreen view and a more "app" feel.',Object(Z.jsx)("br",{}),Object(Z.jsx)("br",{}),Object(Z.jsx)("div",{className:"red-text",children:"WARNING"}),": Clearing your browser cache / storage might also delete your songs, make sure to make a backup sometimes.",Object(Z.jsx)("br",{}),Object(Z.jsx)("br",{}),this.state.hasPersistentStorage?Object(Z.jsxs)("div",{children:[Object(Z.jsx)("div",{className:"red-text",children:"WARNING"}),': To prevent your browser from automatically clearing the app storage, click the "confirm" button below, if asked, allow permission to keep the website data (Persistent storage). If it doesn\'t work, the program will try to request it again at every launch.']}):null]})]}),Object(Z.jsx)("div",{className:"welcome-message-button-wrapper",children:Object(Z.jsx)("button",{className:"welcome-message-button",onClick:this.askForStorage,children:"Confirm"})})]}),Object(Z.jsxs)(_t.a,{children:[Object(Z.jsx)(Jt.a,{to:"/"+this.state.selectedPage}),"ErrorPage"===this.state.selectedPage?Object(Z.jsx)(Jt.b,{exact:!0,path:"/ErrorPage",children:Object(Z.jsx)(Ft,{changePage:this.changePage})}):Object(Z.jsxs)(Z.Fragment,{children:[Object(Z.jsx)(Jt.b,{exact:!0,path:"/",children:Object(Z.jsx)(ze,{changePage:this.changePage})}),Object(Z.jsx)(Jt.b,{exact:!0,path:"/Composer",children:Object(Z.jsx)(Bt,{changePage:this.changePage})}),Object(Z.jsx)(Jt.b,{exact:!0,path:"/Changelog",children:Object(Z.jsx)(Ut,{changePage:this.changePage})})]})]})]})}}]),n}(u.Component);p.a.render(Object(Z.jsx)(d.a.StrictMode,{children:Object(Z.jsx)(qt,{})}),document.getElementById("root")),function(){if(JSON.parse(sessionStorage.getItem("isTwa")))return console.log("inTWA");var e=document.referrer.includes("android-app://");sessionStorage.setItem("isTwa",e)}(),function(e){if("serviceWorker"in navigator){if(new URL(".",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat(".","/service-worker.js");Ht?(!function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then((function(n){var a=n.headers.get("content-type");404===n.status||null!=a&&-1===a.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):Kt(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://cra.link/PWA")}))):Kt(t,e)}))}}()},58:function(e,t,n){},59:function(e,t,n){}},[[207,1,2]]]);
//# sourceMappingURL=main.ddbbde27.chunk.js.map