{"version":3,"sources":["appConfig.js","pages/Main/Note.js","pages/Main/SongStore.js","lib/SongUtils.js","pages/Main/Keyboard.js","assets/images/mainpage.png","assets/images/composer.png","assets/images/songs.png","pages/Main/HelpTab.js","components/MenuItem.js","components/MenuPanel.js","components/MenuClose.js","components/SettingsRow.js","components/DonateButton.js","pages/Main/Menu.js","lib/SettingsObj.js","lib/Instrument.js","lib/AudioRecorder.js","components/AsyncPrompts.js","pages/Main/index.js","assets/icons/addCell.svg","assets/icons/removeCell.svg","pages/Composer/useDebounce.js","pages/Composer/MidiParser.js","pages/Composer/ComposerTools.js","pages/Composer/ComposerNote.js","pages/Composer/MultiSwitch.js","pages/Composer/ComposerKeyboard.js","pages/Composer/ComposerCache.js","pages/Composer/ComposerCanvas.js","pages/Composer/Menu.js","pages/Composer/index.js","components/SimpleMenu.js","pages/ErrorPage/index.js","pages/Changelog/index.js","pages/Partners/index.js","pages/Home/index.js","serviceWorkerRegistration.js","components/FloatingMessage.js","assets/images/paypalme.png","assets/images/buymeacoffee.svg","pages/Donate/index.js","assets/images/kofi.png","assets/icons/rotate.svg","index.js"],"names":["appName","process","console","log","pages","cssClasses","noteComposer","note","noteAnimation","approachCircle","noteName","audioContext","window","AudioContext","webkitAudioContext","instruments","notesPerColumn","instrumentsData","Lyre","notes","Zither","effects","filter","DunDun","Bells","Trumpet","Contrabass","Drum","Flute","Guitar","HandPan","ToyUkulele","Harp","Horn","Piano","Pipa","Kalimba","WinterPiano","Xylophone","Ocarina","layoutData","keyboardLayout","split","mobileLayout","keyboardCodes","keyNames","Sky","Genshin","speedChangers","map","e","name","value","pitchArr","composerNotePositions","reverse","importNotePositions","layoutImages","isTwa","JSON","parse","sessionStorage","getItem","getApproachCircleColor","index","numOfNotes","Math","floor","ApproachCircle","props","className","style","animation","approachRate","borderColor","Note","state","this","data","approachingNotes","outgoingAnimation","status","instrument","transition","fadeTime","toFixed","parseClass","onPointerDown","preventDefault","handleClick","id","key","draggable","alt","src","noteImage","noteText","Component","songStore","observable","song","eventType","start","Recording","init","Date","getTime","addNote","length","push","Song","version","bpm","pitch","isComposed","isComposedVersion","Object","entries","forEach","entry","LoggerEvent","title","text","timeout","trigger","dispatchEvent","event","undefined","CustomEvent","detail","FileDownloader","type","download","file","dataType","encodeURIComponent","el","document","createElement","body","appendChild","setAttribute","click","remove","TempoChangers","changer","color","ComposedSong","breakpoints","columns","selected","Array","fill","column","Column","tempoChanger","NotesTable","ComposerSongDeSerialization","obj","columnObj","ColumnNote","ComposerToRecording","recordedSong","bpmPerMs","totalTime","ComposerSongSerialization","columnArr","layer","prepareSongDownload","finalSong","stringify","oldFormatNotes","convertedNotes","noteObj","time","l","composedToOldFormat","recordedToOldFormat","pitchLevel","indexOf","songNotes","bitsPerPage","isEncrypted","prepareSongImport","isArray","includes","getSongType","Error","result","self","findIndex","n","genshinLayout","Number","RecordingToComposed","oldSkyToNewFormat","newSkyFormatToGenshin","bpmToMs","composed","converted","grouped","threshold","row","shift","amount","i","splice","groupByNotes","combinations","columnNote","difference","paddingColumns","finalPadding","col","getPitchChanger","pow","delayMs","ms","Promise","resolve","workerTimers","Keyboard","approachingSong","a","startDelay","speedChanger","setState","approachingScore","correct","wrong","score","combo","changeSliderState","approachingNotesList","tick","hasSong","sliderState","stateNotes","tickTime","hasChanges","removed","clicked","random","apNote","position","playSong","songTimestamp","timestamp","keyboard","applySpeedChange","previous","pastError","previousTime","delay","size","practiceSong","songLength","chunks","chunk","startTime","j","firstChunk","nextChunkDelay","secondChunk","keyboardNote","functions","setHasSong","songToPractice","handleSpeedChanger","find","restartSong","lostReference","stopSong","setTimeout","res","handleSliderEvent","target","handleKeyboard","repeat","shiftKey","code","activeElement","tagName","replace","getNoteFromCode","handleApproachClick","approachingNote","handlePracticeClick","indexClicked","nextChunk","nextNextChunk","onlySound","hasAnimation","approachStatus","playSound","propKeyboard","layout","playTimestamp","disposeStore","tickInterval","addEventListener","setInterval","observe","object","removeEventListener","clearInterval","keyboardSize","keyboardClass","Score","onClick","min","onChange","max","disabled","transform","marginBottom","isLoading","noteData","instrumentName","isAnimated","getNoteText","noteNameType","layoutLength","HelpTab","mainPageImg","Key","songsImg","composerImg","children","MenuItem","action","MenuPanel","visible","MenuClose","SettingsRow","update","objKey","changeVolume","useState","valueHook","setter","volume","volumeHook","setterVolume","sendChangeSelect","options","placeholder","checked","onBlur","onPointerUp","DonateButton","Menu","checkPersistentStorage","navigator","storage","persist","persisted","isPersisted","isPersistentStorage","handleSearchInput","searchInput","clearSearch","searchedSongs","searchStatus","searchSongs","trim","fetch","encodeURI","then","json","fetchedSongs","error","toggleMenu","override","newState","open","selectSideMenu","selection","selectedMenu","changeSelectedSongType","selectedSongType","importSong","reader","FileReader","songsInput","addSong","fileName","readAsText","downloadSong","_id","songName","song1","toLowerCase","downloadAllSongs","toDownload","songs","fileDownloader","date","toISOString","sideClass","handleSettingChange","changePage","composedSongs","searchedSongFunctions","SongRow","marginTop","paddingTop","width","display","justifyContent","marginLeft","settings","onKeyDown","onInput","SearchedSong","href","deleteSong","removeSong","play","ComposerSettings","settingVesion","songSetting","layer2","layer3","beatMarks","isMobile","columnsPerCanvas","caveMode","autosave","backgroundImage","syncTabs","MainPageSettings","approachSpeed","NoteData","noteNames","url","buffer","ArrayBuffer","Instrument","String","newVolume","volumeNode","gain","deleted","player","createBufferSource","buffers","connect","playbackRate","onended","stop","disconnect","load","emptyBuffer","createBuffer","sampleRate","requests","arrayBuffer","decodeAudioData","catch","all","loaded","node","delete","createGain","instrumentData","mobile","AudioRecorder","createMediaStreamDestination","MediaRecorder","recorder","stream","MediaRecorderPolyfill","toUrl","URL","createObjectURL","once","urlBlob","anchor","toWav","blobToAudio","wav","blob","Blob","DataView","fileReader","onloadend","audioBuffer","readAsArrayBuffer","asyncPrompt","question","container","innerText","input","cancel","ok","append","classList","add","asyncConfirm","background","App","loadInstrument","loadReverb","toggleReverbNodes","resetDrag","isDragging","handleDragOver","handleDrag","thereIsSong","handleDrop","from","dataTransfer","files","hasReverb","mounted","reverbNode","destination","updateSettings","getSettings","storedSettings","localStorage","newInstrument","isLoadingInstrument","isRecording","handleRecording","setItem","setting","syncSongs","dbCol","toArray","songExists","findOne","insert","recording","askForSongName","promptString","toggleRecord","toggleRecordAudio","isRecordingAudio","reverbVolumeNode","db","ZangoDb","Db","collection","r","b","impulse_response","convolver","createConvolver","gainNode","keyboardFunctions","keyboardData","menuFunctions","menuData","AppButton","active","isInTwa","referrer","setIfInTWA","useDebounce","debouncedValue","setDebouncedValue","useEffect","handler","clearTimeout","Track","editTrack","dataShown","setDataShown","textAlign","family","cursor","numberOfAccidentals","numberOfOutOfRange","MidiImport","handleFile","midi","Midi","header","tempos","keySignatures","tracks","track","offset","convertMidi","includeAccidentals","outOfRange","totalNotes","midiNote","convertedNote","isAccidental","convertMidiNote","sort","groupedNotes","elapsedTime","emptyColumns","noteColumn","number","numberToLayer","groupByIndex","group","final","join","mergeLayers","lastColumn","selectedColumn","loadSong","accidentals","command","changeOffset","parseInt","isInteger","changePitch","toggleAccidentals","changeBpm","changeMidiVisibility","margin","maxWidth","textOverflow","overflow","marginRight","alignItems","NumberInput","changeValue","step","backgroundColor","elementValue","setElementValue","debounced","ComposerTools","toggleTools","copiedColumns","currentTarget","blur","copyColumns","pasteColumns","eraseColumns","deleteColumns","ComposerNote","next","prev","canRender","layers","clickAction","MultiSwitch","selectedColor","buttonsClass","onSelect","ComposerKeyboard","notesIndexes","currentColumn","hiddenSideMenu","isPlaying","changeLayer","handleTempoChanger","toString","horizontalLineBreak","standards","ComposerCache","height","timelineHeight","destroy","app","generate","canvas","drawColumn","cache","toDataURL","standardColumn","standard","standardLarger","roundNess","noteWidth","noteHeight","ctx","getContext","fillStyle","roundRect","strokeStyle","lineWidth","beginPath","ballHeight","arc","PI","columnsLarger","breakpoint","moveTo","lineTo","notesFigures","PIXI","borderWidth","fillRect","stroke","y","x","radius","tl","tr","br","bl","defaultRadius","side","quadraticCurveTo","closePath","NumOfColumnsPerCanvas","ComposerCanvas","resetPointerDown","stageSelected","sliderSelected","stagePreviousPositon","handleBreakpoints","handleWheel","deltaY","selectColumn","global","totalWidth","relativePos","handleStageSlide","throttleStage","isMovingLeft","ceil","abs","toAdd","finalPos","direction","v","handleSlide","sizes","getBoundingClientRect","parentWidth","nearestEven","screen","currentBreakpoint","canvasRef","React","createRef","current","_canvas","s","xPos","switcher","counter","counterLimit","relativeColumnWidth","stageSize","stagePos","raf","renderOnComponentChange","ref","interactive","pointerdown","pointermove","pos","currentPos","boundaries","isVisible","tempoChangersCache","standardBg","backgroundCache","isToolsSelected","toolsColumns","isSelected","isBreakpoint","antialias","autoDensity","pointertap","pointerup","draw","g","clear","beginFill","drawRect","fillX","image","lineStyle","drawRoundedRect","drawStage","toggleBreakpoint","interactiveChildren","alpha","zIndex","num","round","toggleMenuVisible","updateSong","createNewSong","songFunctions","hasUnsaved","menuClass","menuOpen","currentSong","startRecordingAudio","Composer","promises","setupAudioDestination","handleAutoSave","changes","ins","togglePlay","letter","broadcastChannel","postMessage","nextLayer","removeColumns","addColumns","layerIndex","replaceAt","currentNote","askForSongUpdate","confirm","songColumns","msPerBPM","handleTick","newIndex","indexOfBreakpoint","validateBreakpoints","page","ignoreAudio","toolsVisible","copiedColums","copiedColumn","copiedNote","columnIndex","visibility","midiVisible","playbackInterval","BroadcastChannel","onmessage","location","hostname","returnValue","close","canvasFunctions","canvasData","toolsData","toolsFunctions","midiParserFunctions","midiParserData","addCell","removeCell","formatMillis","calculateLength","millis","minutes","seconds","end","totalLength","string","replacement","valueOf","substring","SimpleMenu","rel","ErrorPage","deleteAllSongs","resetSettings","removeItem","Changelogpage","changelogs","ChangelogRow","item","arr","Partners","Partner","description","Iframe","frameBorder","allow","allowFullScreen","Home","to","askForStorage","hasVisited","homeClass","isInPosition","innerWidth","toggleHome","hasPersistentStorage","MainContentelement","icon","Separator","PageRedirect","setDontShowHome","canShow","readOnly","isLocalhost","Boolean","match","registerValidSW","swUrl","config","serviceWorker","register","registration","onupdatefound","installingWorker","installing","onstatechange","controller","onUpdate","onSuccess","FloatingMessage","classes","Donate","paypalImg","buyMeACoffeeImg","Index","homeData","selectedPage","homeVisible","lastState","closeWelcomeScreen","hideMessage","floatingMessage","checkUpdate","updateChecked","currentVersion","updateMessage","storedVersion","logEvent","path","canShowHome","exact","rotateImg","ReactDOM","render","StrictMode","getElementById","origin","headers","response","contentType","get","ready","unregister","reload","checkValidServiceWorker","serviceWorkerRegistration"],"mappings":"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","file":"static/js/main.854377cf.chunk.js","sourcesContent":["const appName = process.env.REACT_APP_NAME || [\"Sky\",\"Genshin\"][1]\r\nconst appVersion = '2.1'\r\nconsole.log(`${appName}-V${appVersion}`)\r\nconst pages = [\"\", \"Composer\", \"ErrorPage\", \"Changelog\",\"Donate\", \"Partners\",\"Home\"]\r\n\r\nconst cssClasses = {\r\n    noteComposer: appName === \"Genshin\" ? \"note-composer\" : \"note-composer-sky\",\r\n    note: appName === \"Genshin\" ? \"note\" : \"note-sky\",\r\n    noteAnimation: appName === 'Genshin' ? \"note-animation\" : \"note-animation-sky\",\r\n    approachCircle: appName === \"Genshin\" ? \"approach-circle\" : \"approach-circle-sky\",\r\n    noteName: appName === \"Genshin\" ? \"note-name\" : \"note-name-sky\"\r\n}\r\nconst audioContext = new (window.AudioContext || window.webkitAudioContext)()\r\n\r\nconst instruments = appName === \"Genshin\" ? [\r\n    \"Lyre\",\r\n    \"DunDun\",\r\n    \"Zither\"\r\n    ]:[\r\n        \"Piano\",\r\n        \"Contrabass\",\r\n        \"Guitar\",\r\n        \"Harp\",\r\n        \"Horn\",\r\n        \"Trumpet\",\r\n        \"Pipa\",\r\n        \"WinterPiano\",\r\n        \"Xylophone\",\r\n        \"Flute\",\r\n        \"Ocarina\",\r\n        \"Kalimba\",\r\n        \"ToyUkulele\",\r\n        \"Drum\",\r\n        \"Bells\",\r\n        \"DunDun\",\r\n        \"HandPan\"\r\n    ]\r\nconst notesPerColumn = appName === \"Genshin\" ? 21 : 15\r\nconst instrumentsData = {\r\n    Lyre: {\r\n        notes: 21\r\n    },\r\n    Zither:{\r\n        notes: 21,\r\n        effects: {\r\n            filter: 'sepia(100%)'\r\n        }\r\n    },\r\n    DunDun: {\r\n        notes: 8\r\n    },\r\n    Bells: {\r\n        notes: 8\r\n    },\r\n    Trumpet:{\r\n        notes: 15\r\n    },\r\n    Contrabass: {\r\n        notes: 15\r\n    },\r\n    Drum: {\r\n        notes: 8\r\n    },\r\n    Flute: {\r\n        notes: 15\r\n    },\r\n    Guitar: {\r\n        notes: 15\r\n    },\r\n    HandPan: {\r\n        notes: 8\r\n    },\r\n    ToyUkulele:{\r\n        notes:15\r\n    },\r\n    Harp: {\r\n        notes: 15\r\n    },\r\n    Horn: {\r\n        notes: 15\r\n    },\r\n    Piano: {\r\n        notes: 15\r\n    },\r\n    Pipa: {\r\n        notes: 15\r\n    },\r\n    Kalimba: {\r\n        notes: 15\r\n    },\r\n    WinterPiano: {\r\n        notes: 15\r\n    },\r\n    Xylophone: {\r\n        notes: 15\r\n    },\r\n    Ocarina:{\r\n        notes:15\r\n    }\r\n}\r\n\r\n\r\nconst layoutData = {\r\n    21: {\r\n        keyboardLayout: (\"Q W E R T Y U \" +\r\n            \"A S D F G H J \" +\r\n            \"Z X C V B N M\").split(\" \"),\r\n\r\n        mobileLayout: (\"do re mi fa so la ti \" +\r\n            \"do re mi fa so la ti \" +\r\n            \"do re mi fa so la ti\").split(\" \"),\r\n\r\n        keyboardCodes: (\"81 87 69 82 84 89 85 \" +\r\n            \"65 83 68 70 71 72 74 \" +\r\n            \"90 88 67 86 66 78 77\").split(\" \")\r\n    },\r\n    8: {\r\n        keyboardLayout: (\"Q W E R \" +\r\n            \"A S D F\").split(\" \"),\r\n\r\n        mobileLayout: (\"do re mi fa \" +\r\n            \"do re mi fa\").split(\" \"),\r\n\r\n        keyboardCodes: (\"81 87 69 82 \" +\r\n        \"65 83 68 70\").split(\" \")\r\n    },\r\n    15: {\r\n        keyboardLayout: (\"Q W E R T \" +\r\n            \"A S D F G \" +\r\n            \"Z X C V B\").split(\" \"),\r\n\r\n        mobileLayout: (\"do re mi fa so \" +\r\n            \"do re mi fa so \" +\r\n            \"do re mi fa so\").split(\" \"),\r\n\r\n        keyboardCodes: (\"81 87 69 82 84 \" +\r\n            \"65 83 68 70 71 \" +\r\n            \"90 88 67 86 66\").split(\" \")\r\n    }\r\n}\r\n\r\nconst keyNames = {\r\n    Sky: {\r\n        0: [\"C\", \"D\", \"E\", \"F\", \"G\", \"A\", \"B\", \"C\", \"D\", \"E\", \"F\", \"G\", \"A\", \"B\", \"C\"],\r\n        1: [\"Db\", \"Eb\", \"F\", \"Gb\", \"Ab\", \"Bb\", \"C\", \"Db\", \"Eb\", \"F\", \"Gb\", \"Ab\", \"Bb\", \"C\", \"Db\"],\r\n        2: [\"D\", \"E\", \"F#\", \"G\", \"A\", \"B\", \"C#\", \"D\", \"E\", \"F#\", \"G\", \"A\", \"B\", \"C#\", \"D\"],\r\n        3: [\"Eb\", \"F\", \"G\", \"Ab\", \"Bb\", \"C\", \"D\", \"Eb\", \"F\", \"G\", \"Ab\", \"Bb\", \"C\", \"D\", \"Eb\"],\r\n        4: [\"E\", \"F#\", \"G#\", \"A\", \"B\", \"C#\", \"D#\", \"E\", \"F#\", \"G#\", \"A\", \"B\", \"C#\", \"D#\", \"E\"],\r\n        5: [\"F\", \"G\", \"A\", \"Bb\", \"C\", \"D\", \"E\", \"F\", \"G\", \"A\", \"Bb\", \"C\", \"D\", \"E\", \"F\"],\r\n        6: [\"Gb\", \"Ab\", \"Bb\", \"Cb\", \"Db\", \"Eb\", \"F\", \"Gb\", \"Ab\", \"Bb\", \"Cb\", \"Db\", \"Eb\", \"F\", \"Gb\"],\r\n        7: [\"G\", \"A\", \"B\", \"C\", \"D\", \"E\", \"F#\", \"G\", \"A\", \"B\", \"C\", \"D\", \"E\", \"F#\", \"G\"],\r\n        8: [\"Ab\", \"Bb\", \"C\", \"Db\", \"Eb\", \"F\", \"G\", \"Ab\", \"Bb\", \"C\", \"Db\", \"Eb\", \"F\", \"G\", \"Ab\"],\r\n        9: [\"A\", \"B\", \"C#\", \"D\", \"E\", \"F#\", \"G#\", \"A\", \"B\", \"C#\", \"D\", \"E\", \"F#\", \"G#\", \"A\"],\r\n        10: [\"Bb\", \"C\", \"D\", \"Eb\", \"F\", \"G\", \"A\", \"Bb\", \"C\", \"D\", \"Eb\", \"F\", \"G\", \"A\", \"Bb\"],\r\n        11: [\"B\", \"C#\", \"D#\", \"E\", \"F#\", \"G#\", \"A#\", \"B\", \"C#\", \"D#\", \"E\", \"F#\", \"G#\", \"A#\", \"B\"]\r\n    },\r\n    Genshin:{\r\n        0: [\"C\", \"D\", \"E\", \"F\", \"G\", \"A\", \"B\", \"C\", \"D\", \"E\", \"F\", \"G\", \"A\", \"B\", \"C\", \"D\", \"E\", \"F\", \"G\", \"A\", \"B\"],\r\n        1: [\"Db\", \"Eb\", \"F\", \"Gb\", \"Ab\", \"Bb\", \"C\", \"Db\", \"Eb\", \"F\", \"Gb\", \"Ab\", \"Bb\", \"C\", \"Db\" , \"Eb\", \"F\", \"Gb\", \"Ab\", \"Bb\", \"C\", \"Db\"],\r\n        2: [\"D\", \"E\", \"F#\", \"G\", \"A\", \"B\", \"C#\", \"D\", \"E\", \"F#\", \"G\", \"A\", \"B\", \"C#\", \"D\", \"E\", \"F#\", \"G\", \"A\", \"B\", \"C#\", \"D\"],\r\n        3: [\"Eb\", \"F\", \"G\", \"Ab\", \"Bb\", \"C\", \"D\", \"Eb\", \"F\", \"G\", \"Ab\", \"Bb\", \"C\", \"D\", \"Eb\", \"F\", \"G\", \"Ab\", \"Bb\", \"C\", \"D\", \"Eb\"],\r\n        4: [\"E\", \"F#\", \"G#\", \"A\", \"B\", \"C#\", \"D#\", \"E\", \"F#\", \"G#\", \"A\", \"B\", \"C#\", \"D#\", \"E\", \"F#\", \"G#\", \"A\", \"B\", \"C#\", \"D#\", \"E\"],\r\n        5: [\"F\", \"G\", \"A\", \"Bb\", \"C\", \"D\", \"E\", \"F\", \"G\", \"A\", \"Bb\", \"C\", \"D\", \"E\", \"F\", \"G\", \"A\", \"Bb\", \"C\", \"D\", \"E\", \"F\"],\r\n        6: [\"Gb\", \"Ab\", \"Bb\", \"Cb\", \"Db\", \"Eb\", \"F\", \"Gb\", \"Ab\", \"Bb\", \"Cb\", \"Db\", \"Eb\", \"F\", \"Gb\", \"Ab\", \"Bb\", \"Cb\", \"Db\", \"Eb\", \"F\", \"Gb\"],\r\n        7: [\"G\", \"A\", \"B\", \"C\", \"D\", \"E\", \"F#\", \"G\", \"A\", \"B\", \"C\", \"D\", \"E\", \"F#\", \"G\", \"A\", \"B\", \"C\", \"D\", \"E\", \"F#\", \"G\"],\r\n        8: [\"Ab\", \"Bb\", \"C\", \"Db\", \"Eb\", \"F\", \"G\", \"Ab\", \"Bb\", \"C\", \"Db\", \"Eb\", \"F\", \"G\", \"Ab\", \"Bb\", \"C\", \"Db\", \"Eb\", \"F\", \"G\", \"Ab\"],\r\n        9: [\"A\", \"B\", \"C#\", \"D\", \"E\", \"F#\", \"G#\", \"A\", \"B\", \"C#\", \"D\", \"E\", \"F#\", \"G#\", \"A\", \"B\", \"C#\", \"D\", \"E\", \"F#\", \"G#\", \"A\"],\r\n        10: [\"Bb\", \"C\", \"D\", \"Eb\", \"F\", \"G\", \"A\", \"Bb\", \"C\", \"D\", \"Eb\", \"F\", \"G\", \"A\", \"Bb\", \"C\", \"D\", \"Eb\", \"F\", \"G\", \"A\", \"Bb\"],\r\n        11: [\"B\", \"C#\", \"D#\", \"E\", \"F#\", \"G#\", \"A#\", \"B\", \"C#\", \"D#\", \"E\", \"F#\", \"G#\", \"A#\", \"B\", \"C#\", \"D#\", \"E\", \"F#\", \"G#\", \"A#\", \"B\"]\r\n    }\r\n}\r\nconst speedChangers = [0.25,0.5,0.75,1,1.25,1.5,2].map(e => {\r\n    return {\r\n        name: `x${e}`,\r\n        value: e\r\n    }\r\n})\r\n\r\nconst pitchArr = [\"C\", \"Db\", \"D\", \"Eb\", \"E\", \"F\", \"Gb\", \"G\", \"Ab\", \"A\", \"Bb\", \"B\"] \r\n\r\nconst composerNotePositions =  appName === \"Genshin\" ? [14, 15, 16, 17, 18, 19, 20, 7, 8, 9, 10, 11, 12, 13, 0, 1, 2, 3, 4, 5, 6].reverse() : [15,16,17,18,19,20,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14].reverse()\r\n\r\nconst importNotePositions = appName === \"Genshin\" ? [14, 15, 16, 17, 18, 19, 20, 7, 8, 9, 10, 11, 12, 13, 0] :  [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14]\r\n\r\nconst layoutImages = {\r\n    15: \"dmcr dm cr dm cr cr dm dmcr dm cr cr dm cr dm dmcr\".split(\" \"),\r\n    8: appName === \"Sky\"? \"cr dm cr dm cr dm cr dm\".split(\" \") : \"do re mi fa do re mi fa\".split(\" \"),\r\n    21: \"do re mi fa so la ti do re mi fa so la ti do re mi fa so la ti\".split(\" \")\r\n}\r\n\r\nfunction isTwa() {\r\n    let isTwa = JSON.parse(sessionStorage.getItem('isTwa'))\r\n    return isTwa\r\n}\r\nexport {\r\n    instruments,\r\n    instrumentsData,\r\n    composerNotePositions,\r\n    importNotePositions,\r\n    appName,\r\n    layoutData,\r\n    cssClasses,\r\n    notesPerColumn,\r\n    keyNames,\r\n    pitchArr,\r\n    layoutImages,\r\n    appVersion,\r\n    speedChangers,\r\n    audioContext,\r\n    pages,\r\n    isTwa\r\n}","import React, { Component } from 'react'\r\nimport { cssClasses, appName, instrumentsData } from \"appConfig\"\r\n\r\nclass Note extends Component {\r\n    constructor(props) {\r\n        super(props)\r\n        this.state = {\r\n        }\r\n    }\r\n    render() {\r\n        const { props } = this\r\n        const { data, approachingNotes,outgoingAnimation} = props\r\n        const { status , approachRate, instrument} = data\r\n        let animation = { transition: `background-color ${(props.fadeTime/1000).toFixed(2)}s, transform 0.15s` }\r\n        let className = parseClass(status)\r\n        let effects = instrumentsData[instrument]?.effects || {}\r\n        return <button\r\n            onPointerDown={(e) => {\r\n                e.preventDefault()\r\n                props.handleClick(data)\r\n            }}\r\n            className=\"button-hitbox-bigger\"\r\n        >\r\n            {approachingNotes.map((note) => {\r\n                return <ApproachCircle\r\n                    key={note.id}\r\n                    index={data.index}\r\n                    approachRate={approachRate}\r\n                />\r\n            })}\r\n            {outgoingAnimation.map(e => {\r\n                return <div \r\n                    key={e.key}\r\n                    className={cssClasses.noteAnimation}\r\n                />\r\n            })}\r\n            <div className={className} style={animation}>\r\n                <img\r\n                    draggable=\"false\"\r\n                    alt=''\r\n                    src={props.noteImage}\r\n                    style={effects}\r\n                />\r\n                <div className={cssClasses.noteName}>\r\n                    {props.noteText}\r\n                </div>\r\n            </div>\r\n        </button>\r\n    }\r\n}\r\nfunction getApproachCircleColor(index){\r\n    let numOfNotes = appName === \"Sky\" ? 5 : 7\r\n    let row = Math.floor(index / numOfNotes)\r\n    let colors = [\"#3da399\",\"#ffb347\",\"#3da399\"]\r\n    return colors[row]\r\n}\r\nfunction ApproachCircle(props) {\r\n    return <div\r\n        className={cssClasses.approachCircle}\r\n        style={{ \r\n            animation: `approach ${props.approachRate}ms linear`,\r\n            borderColor:getApproachCircleColor(props.index),\r\n        }}\r\n    >\r\n    </div>\r\n}\r\nfunction parseClass(status) {\r\n    let className = cssClasses.note\r\n    if (status === \"clicked\") className += \" click-event\"\r\n    if (status === 'toClick') className += \" note-red\"\r\n    if (status === 'toClickNext') className += \" note-border-click\"\r\n    if (status === 'toClickAndNext') className += \" note-red note-border-click\"\r\n    if (status === 'approach-wrong') className += \" click-event approach-wrong\"\r\n    if (status === 'approach-correct') className += \" click-event approach-correct\"\r\n    return className\r\n}\r\n\r\nexport default Note","import { observable } from \"mobx\";\r\nexport const songStore = observable({\r\n    data: {\r\n        song: {},\r\n        eventType: '',\r\n        start: 0\r\n    }\r\n})","import { importNotePositions, appName, instruments } from \"appConfig\"\r\nimport * as workerTimers from 'worker-timers';\r\nclass Recording {\r\n\tconstructor() {\r\n\t\tthis.start = new Date().getTime()\r\n\t\tthis.notes = []\r\n\t}\r\n\tinit = () => {\r\n\t\tthis.start = new Date().getTime() - 100\r\n\t\tconsole.log(\"Started new recording\")\r\n\t}\r\n\taddNote = (index) => {\r\n\t\tif (this.notes.length === 0) this.init()\r\n\t\tlet currentTime = new Date().getTime()\r\n\t\tlet note = [index, currentTime - this.start]\r\n\t\tthis.notes.push(note)\r\n\t}\r\n}\r\nclass Song {\r\n\tconstructor(name, notes = [], data = {}) {\r\n\t\tthis.name = name\r\n\t\tthis.version = 1\r\n\t\tthis.notes = notes\r\n\t\tthis.bpm = 220\r\n\t\tthis.pitch = \"C\"\r\n\t\tthis.data = {\r\n\t\t\tisComposed: false,\r\n\t\t\tisComposedVersion: false,\r\n\t\t\tappName: appName\r\n\t\t}\r\n\t\tObject.entries(data).forEach((entry) => {\r\n\t\t\tthis.data[entry[0]] = entry[1]\r\n\t\t})\r\n\t}\r\n}\r\nclass LoggerEvent {\r\n\tconstructor(title, text, timeout) {\r\n\t\tthis.title = title\r\n\t\tthis.timeout = timeout\r\n\t\tthis.text = text\r\n\t\tif (timeout === undefined) this.timeout = 3000\r\n\t\tthis.event = new CustomEvent(\"logEvent\", {\r\n\t\t\tdetail: {\r\n\t\t\t\ttitle: this.title,\r\n\t\t\t\ttext: this.text,\r\n\t\t\t\ttimeout: this.timeout\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\ttrigger = () => {\r\n\t\twindow.dispatchEvent(this.event)\r\n\t}\r\n}\r\nclass NoteData {\r\n\tconstructor(index, noteNames, url) {\r\n\t\tthis.index = index\r\n\t\tthis.noteNames = noteNames\r\n\t\tthis.url = url\r\n\t\tthis.buffer = new ArrayBuffer(8)\r\n\t\tthis.clicked = false\r\n\t}\r\n}\r\nclass PlayingSong {\r\n\tconstructor(notes) {\r\n\t\tthis.timestamp = new Date().getTime()\r\n\t\tthis.notes = notes\r\n\t}\r\n}\r\nclass FileDownloader {\r\n\tconstructor(type) {\r\n\t\tif (type === undefined) type = \"text/json\"\r\n\t\tthis.dataType = \"data:\" + type + \";charset=utf-8,\"\r\n\t}\r\n\tdownload = (file, name) => {\r\n\t\tlet data = this.dataType + encodeURIComponent(file)\r\n\t\tvar el = document.createElement(\"a\")\r\n\t\tel.style = \"display:none\"\r\n\t\tdocument.body.appendChild(el)\r\n\t\tel.setAttribute(\"href\", data)\r\n\t\tel.setAttribute(\"download\", name)\r\n\t\tel.click();\r\n\t\tel.remove();\r\n\t}\r\n}\r\n\r\nlet TempoChangers = [\r\n\t{\r\n\t\tid: 0,\r\n\t\ttext: \"1\",\r\n\t\tchanger: 1,\r\n\t\tcolor: 0x515c6f\r\n\t}, {\r\n\t\tid: 1,\r\n\t\ttext: \"1/2\",\r\n\t\tchanger: 1 / 2,\r\n\t\tcolor: 0x517553\r\n\t}, {\r\n\t\tid: 2,\r\n\t\ttext: \"1/4\",\r\n\t\tchanger: 1 / 4,\r\n\t\tcolor: 0x434c7d\r\n\t}, {\r\n\t\tid: 3,\r\n\t\ttext: \"1/8\",\r\n\t\tchanger: 1 / 8,\r\n\t\tcolor: 0x774D6D\r\n\t}\r\n]\r\nclass ComposedSong {\r\n\tconstructor(name, notes = [], data = {}) {\r\n\t\tdata.isComposed = true\r\n\t\tdata.isComposedVersion = true\r\n\t\tthis.version = 1\r\n\t\tthis.data = data\r\n\t\tthis.name = name\r\n\t\tthis.bpm = 220\r\n\t\tthis.pitch = \"C\"\r\n\t\tthis.notes = notes\r\n\t\tthis.instruments = [instruments[0], instruments[0], instruments[0]]\r\n\t\tthis.breakpoints = [0]\r\n\t\tthis.columns = []\r\n\t\tthis.selected = 0\r\n\t\tnew Array(100).fill().forEach((e) => {\r\n\t\t\tlet column = new Column()\r\n\t\t\tcolumn.tempoChanger = 0\r\n\t\t\tthis.columns.push(column)\r\n\t\t})\r\n\t}\r\n}\r\n\r\nfunction NotesTable(length){\r\n\treturn new Array(length).fill().map(() => {return []})\r\n}\r\nfunction ComposerSongDeSerialization(song) {\r\n\tlet obj = {\r\n\t\tdata: song.data,\r\n\t\tname: song.name,\r\n\t\tbpm: song.bpm ?? 220,\r\n\t\tpitch: song.pitch ?? \"C\",\r\n\t\tinstruments: song.instruments || [instruments[0], instruments[0], instruments[0]],\r\n\t\tbreakpoints: song.breakpoints ?? [],\r\n\t\tnotes: [],\r\n\t\tselected: 0,\r\n\t\tcolumns: []\r\n\t}\r\n\tsong.columns.forEach(column => {\r\n\t\tlet columnObj = new Column()\r\n\t\tcolumnObj.tempoChanger = column[0]\r\n\t\tcolumn[1].forEach(note => {\r\n\t\t\tcolumnObj.notes.push(new ColumnNote(note[0], note[1]))\r\n\t\t})\r\n\t\tobj.columns.push(columnObj)\r\n\t})\r\n\treturn obj\r\n}\r\nfunction ComposerToRecording(song) {\r\n\tlet recordedSong = new Song(song.name)\r\n\tlet bpmPerMs = Math.floor(60000 / song.bpm)\r\n\tlet totalTime = 100\r\n\tsong.columns.forEach(column => {\r\n\t\tcolumn[1].forEach(note => {\r\n\t\t\trecordedSong.notes.push([note[0], totalTime])\r\n\t\t})\r\n\t\ttotalTime += Math.floor(bpmPerMs * TempoChangers[column[0]].changer)\r\n\t})\r\n\treturn recordedSong\r\n}\r\nfunction ComposerSongSerialization(song) {\r\n\tlet obj = {\r\n\t\tdata: song.data,\r\n\t\tname: song.name,\r\n\t\tbpm: song.bpm,\r\n\t\tpitch: song.pitch,\r\n\t\tbreakpoints: song.breakpoints,\r\n\t\tinstruments: song.instruments,\r\n\t\tcolumns: []\r\n\t}\r\n\tobj.data.appName = appName\r\n\t/*\r\n\t\tnotes = [tempoChanger,notes] ----> note = [index,layer]\r\n\t\ttempoChanger = Number\r\n\t*/\r\n\tsong.columns.forEach(column => {\r\n\t\tlet columnArr = [column.tempoChanger]\r\n\t\tlet notes = column.notes.map(note => {\r\n\t\t\treturn [note.index, note.layer]\r\n\t\t})\r\n\t\tcolumnArr[1] = notes\r\n\t\tobj.columns.push(columnArr)\r\n\t})\r\n\treturn obj\r\n}\r\nfunction prepareSongDownload(song) {\r\n\tlet finalSong = JSON.parse(JSON.stringify(song)) //lose reference\r\n\tlet oldFormatNotes = {}\r\n\tif (finalSong.data?.isComposedVersion) {\r\n\t\toldFormatNotes = composedToOldFormat(finalSong)\r\n\t} else {\r\n\t\toldFormatNotes = recordedToOldFormat(finalSong)\r\n\t}\r\n\tfinalSong.isComposed = finalSong.data.isComposedVersion\r\n\tfinalSong.pitchLevel = pitchArr.indexOf(finalSong.pitch)\r\n\tfinalSong.songNotes = oldFormatNotes\r\n\tfinalSong.bitsPerPage = 16\r\n\tfinalSong.isEncrypted = false\r\n\treturn [finalSong] //for compatibility, add back to an array, it will be ignored when importing\r\n\t//from this app\r\n}\r\n\r\nfunction prepareSongImport(song) {\r\n\t//TODO add multi songs in the same file\r\n\tif (Array.isArray(song) && song.length > 0) song = song[0]\r\n\tlet type = getSongType(song)\r\n\tif (type === \"none\") {\r\n\t\tnew LoggerEvent(\"Error\", \"Invalid song\").trigger()\r\n\t\tthrow new Error(\"Error Invalid song\")\r\n\t}\r\n\tif (type === \"oldSky\") {\r\n\t\tsong = oldSkyToNewFormat(song)\r\n\t}\r\n\tif (appName === 'Sky' && song.data?.appName !== 'Sky') {\r\n\t\tnew LoggerEvent(\"Error\", \"Invalid song\").trigger()\r\n\t\tthrow new Error(\"Error Invalid song\")\r\n\t}\r\n\tif (appName === 'Genshin' && song.data?.appName === 'Sky') {\r\n\t\tsong = newSkyFormatToGenshin(song)\r\n\t}\r\n\treturn song\r\n}\r\n\r\nfunction composedToOldFormat(song) {\r\n\tlet convertedNotes = []\r\n\tlet bpmPerMs = Math.floor(60000 / song.bpm)\r\n\tlet totalTime = 100\r\n\tsong.columns.forEach(column => {\r\n\t\tcolumn[1].forEach(note => {\r\n\t\t\tlet layer = 1\r\n\t\t\tif (note[1] === '111') layer = 3\r\n\t\t\tif (note[1] === '011') layer = 2\r\n\t\t\tif (note[1] === '101') layer = 3\r\n\t\t\tif (note[1] === '001') layer = 2\r\n\t\t\tif (note[1] === '110') layer = 3\r\n\t\t\tif (note[1] === '010') layer = 2\r\n\t\t\tif (note[1] === '100') layer = 1\r\n\t\t\tlet noteObj = {\r\n\t\t\t\tkey: (layer > 2 ? 2 : layer) + 'Key' + note[0],\r\n\t\t\t\ttime: totalTime\r\n\t\t\t}\r\n\t\t\tif (layer > 2) noteObj.l = 3\r\n\t\t\tconvertedNotes.push(noteObj)\r\n\t\t})\r\n\t\ttotalTime += Math.floor(bpmPerMs * TempoChangers[column[0]].changer)\r\n\t})\r\n\treturn convertedNotes\r\n}\r\n\r\nfunction recordedToOldFormat(song) {\r\n\tlet convertedNotes = []\r\n\tsong.notes.forEach(note => {\r\n\t\tconvertedNotes.push({\r\n\t\t\ttime: note[1],\r\n\t\t\tkey: \"1Key\" + note[0]\r\n\t\t})\r\n\t})\r\n\treturn convertedNotes\r\n}\r\nfunction getSongType(song) {\r\n\ttry {\r\n\t\tif (song.data === undefined) {\r\n\t\t\t//oldSky format\r\n\t\t\tsong.pitchLevel = song.pitchLevel || 0\r\n\t\t\tif (song.songNotes !== undefined) {\r\n\t\t\t\treturn \"oldSky\"\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t//current format\r\n\t\t\tif (song.data.isComposedVersion) {\r\n\t\t\t\tif (typeof song.name !== \"string\") return \"none\"\r\n\t\t\t\tif (typeof song.bpm !== \"number\") return \"none\"\r\n\t\t\t\tif (!pitchArr.includes(song.pitch)) return \"none\"\r\n\t\t\t\tif (Array.isArray(song.breakpoints)) {\r\n\t\t\t\t\tif (song.breakpoints.length > 0) {\r\n\t\t\t\t\t\tif (typeof song.breakpoints[0] !== \"number\") return \"none\"\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn \"none\"\r\n\t\t\t\t}\r\n\t\t\t\tif (Array.isArray(song.columns)) {\r\n\t\t\t\t\tif (song.columns.length > 0) {\r\n\t\t\t\t\t\tlet column = song.columns[0]\r\n\t\t\t\t\t\tif (typeof column[0] !== \"number\") return \"none\"\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn \"none\"\r\n\t\t\t\t}\r\n\t\t\t\treturn \"newComposed\"\r\n\t\t\t} else {\r\n\t\t\t\tif (typeof song.name !== \"string\") return \"none\"\r\n\t\t\t\tif (typeof song.bpm !== \"number\") return \"none\"\r\n\t\t\t\tif (!pitchArr.includes(song.pitch)) return \"none\"\r\n\t\t\t\treturn \"newRecorded\"\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t} catch (e) {\r\n\t\tconsole.log(e)\r\n\t\treturn \"none\"\r\n\t}\r\n\treturn \"none\"\r\n}\r\nlet genshinLayout = importNotePositions\r\n\r\nfunction newSkyFormatToGenshin(song) {\r\n\tif (song.data.isComposedVersion) {\r\n\t\tsong.instruments = song.instruments.map(instrument => 'Lyre')\r\n\t\tsong.columns.forEach(column => {\r\n\t\t\tcolumn[1] = column[1].map(note => {\r\n\t\t\t\treturn [genshinLayout[note[0]], note[1]]\r\n\t\t\t})\r\n\r\n\t\t})\r\n\t}\r\n\tif (!song.data.isComposedVersion) {\r\n\t\tsong.notes = song.notes.map(note => {\r\n\t\t\tnote[0] = genshinLayout[note[0]]\r\n\t\t\treturn note\r\n\t\t})\r\n\t}\r\n\treturn song\r\n}\r\n\r\nfunction oldSkyToNewFormat(song) {\r\n\tlet result = new Song(\"Error\")\r\n\ttry {\r\n\t\tresult = new Song(song.name)\r\n\t\tresult.bpm = song.bpm || 220\r\n\t\tresult.pitch = (pitchArr[song.pitchLevel || 0]) || \"C\"\r\n\t\t//remove duplicate notes\r\n\t\tsong.songNotes = song.songNotes.filter((note, index, self) =>\r\n\t\t\tindex === self.findIndex((n) => {\r\n\t\t\t\treturn n.key.split('Key')[1] === note.key.split('Key')[1] && n.time === note.time\r\n\t\t\t})\r\n\t\t)\r\n\t\tlet songNotes = song.songNotes\r\n\t\tsongNotes.forEach(note => {\r\n\t\t\tlet data = note.key.split(\"Key\")\r\n\t\t\tresult.notes.push([genshinLayout[data[1]], note.time, note.l ?? Number(data[0])])\r\n\t\t})\r\n\r\n\t\tif ([true, \"true\"].includes(song.isComposed)) {\r\n\t\t\tresult = ComposerSongSerialization(RecordingToComposed(result))\r\n\t\t} else {\r\n\t\t\tresult.notes = result.notes.map(e => [e[0], e[1]])\r\n\t\t}\r\n\r\n\r\n\t} catch (e) {\r\n\t\tconsole.log(e)\r\n\t\treturn new Song(\"Error importing\")\r\n\t}\r\n\treturn result\r\n}\r\nfunction RecordingToComposed(song) {\r\n\tlet bpmToMs = Math.floor(60000 / song.bpm)\r\n\tlet composed = new ComposedSong(song.name, [])\r\n\tcomposed.bpm = song.bpm\r\n\tcomposed.pitch = song.pitch\r\n\tlet notes = song.notes\r\n\t//remove duplicates\r\n\r\n\tlet converted = []\r\n\tlet grouped = groupByNotes(notes, bpmToMs / 9)\r\n\tlet combinations = [bpmToMs, Math.floor(bpmToMs / 2), Math.floor(bpmToMs / 4), Math.floor(bpmToMs / 8)]\r\n\tfor (let i = 0; i < grouped.length; i++) {\r\n\t\tlet column = new Column()\r\n\t\tcolumn.notes = grouped[i].map(note => {\r\n\t\t\tlet columnNote = new ColumnNote(note[0])\r\n\t\t\tif (note[2] === 0) columnNote.layer = \"100\"\r\n\t\t\tif (note[2] === 1) columnNote.layer = \"100\"\r\n\t\t\tif (note[2] === 2) columnNote.layer = \"010\"\r\n\t\t\tif (note[2] === 3) columnNote.layer = \"110\"\r\n\t\t\tif (note[2] === undefined) columnNote.layer = \"100\"\r\n\t\t\treturn columnNote\r\n\t\t})\r\n\t\tlet next = grouped[i + 1] || [[0, 0, 0]]\r\n\t\tlet difference = next[0][1] - grouped[i][0][1]\r\n\t\tlet paddingColumns = []\r\n\t\twhile (difference >= combinations[3]) {\r\n\t\t\tif (difference / combinations[0] >= 1) {\r\n\t\t\t\tdifference -= combinations[0]\r\n\t\t\t\tpaddingColumns.push(0)\r\n\t\t\t} else if (difference / combinations[1] >= 1) {\r\n\t\t\t\tdifference -= combinations[1]\r\n\t\t\t\tpaddingColumns.push(1)\r\n\t\t\t} else if (difference / combinations[2] >= 1) {\r\n\t\t\t\tdifference -= combinations[2]\r\n\t\t\t\tpaddingColumns.push(2)\r\n\t\t\t} else if (difference / combinations[3] >= 1) {\r\n\t\t\t\tdifference -= combinations[3]\r\n\t\t\t\tpaddingColumns.push(3)\r\n\t\t\t}\r\n\t\t}\r\n\t\tlet finalPadding = []\r\n\t\tcolumn.tempoChanger = paddingColumns.shift() || 0\r\n\t\tpaddingColumns = paddingColumns.forEach((col, i) => {\r\n\t\t\tlet column = new Column()\r\n\t\t\tcolumn.tempoChanger = col\r\n\t\t\tfinalPadding.push(column)\r\n\t\t})\r\n\t\tconverted.push(column, ...finalPadding)\r\n\t}\r\n\tcomposed.columns = converted\r\n\treturn composed\r\n}\r\nclass Column {\r\n\tconstructor() {\r\n\t\tthis.notes = []\r\n\t\tthis.tempoChanger = 0\r\n\r\n\t}\r\n}\r\nfunction groupByNotes(notes, threshold) {\r\n\tlet result = []\r\n\twhile (notes.length > 0) {\r\n\t\tlet row = [notes.shift()]\r\n\t\tlet amount = 0\r\n\t\tfor (let i = 0; i < notes.length; i++) {\r\n\t\t\tif (row[0][1] > notes[i][1] - threshold) amount++\r\n\t\t}\r\n\t\tresult.push([...row, ...notes.splice(0, amount)])\r\n\t}\r\n\treturn result\r\n}\r\nclass ColumnNote {\r\n\tconstructor(index, layer = \"000\") {\r\n\t\tthis.index = index\r\n\t\tthis.layer = layer\r\n\t}\r\n}\r\nlet pitchArr = [\"C\", \"Db\", \"D\", \"Eb\", \"E\", \"F\", \"Gb\", \"G\", \"Ab\", \"A\", \"Bb\", \"B\"]\r\nfunction getPitchChanger(pitch) {\r\n\tlet index = pitchArr.indexOf(pitch)\r\n\tif (index < 0) index = 0\r\n\treturn Number(Math.pow(2, index / 12).toFixed(4))\r\n}\r\nfunction numberToLayer(number) {\r\n\tlet layer = \"100\"\r\n\tif (number === 0) layer = \"100\"\r\n\tif (number === 1) layer = \"010\"\r\n\tif (number === 2) layer = \"001\"\r\n\treturn layer\r\n}\r\nfunction mergeLayers(notes) {\r\n\tlet final = \"000\".split(\"\")\r\n\tnotes.forEach(notes => {\r\n\t\tnotes.layer.split(\"\").forEach((e, i) => {\r\n\t\t\tif (e === \"1\") final[i] = \"1\"\r\n\t\t})\r\n\t})\r\n\treturn final.join(\"\")\r\n}\r\nfunction groupByIndex(column) {\r\n\tlet notes = []\r\n\tcolumn.notes.forEach(note => {\r\n\t\tif (notes[note.index]) {\r\n\t\t\tnotes[note.index].push(note)\r\n\t\t} else {\r\n\t\t\tnotes[note.index] = [note]\r\n\t\t}\r\n\t})\r\n\treturn notes.filter(e => Array.isArray(e))\r\n}\r\n\r\nfunction delayMs(ms) {\r\n    return new Promise(resolve => {\r\n        workerTimers.setTimeout(resolve, ms)\r\n    })\r\n}\r\n\r\nexport {\r\n\tRecording,\r\n\tSong,\r\n\tNoteData,\r\n\tFileDownloader,\r\n\tLoggerEvent,\r\n\tPlayingSong,\r\n\tComposedSong,\r\n\tColumnNote,\r\n\tColumn,\r\n\tTempoChangers,\r\n\tComposerSongSerialization,\r\n\tComposerSongDeSerialization,\r\n\tComposerToRecording,\r\n\tgetPitchChanger,\r\n\tgetSongType,\r\n\toldSkyToNewFormat,\r\n\tRecordingToComposed,\r\n\tprepareSongDownload,\r\n\tnewSkyFormatToGenshin,\r\n\tprepareSongImport,\r\n\tpitchArr,\r\n\tgroupByNotes,\r\n\tnumberToLayer,\r\n\tmergeLayers,\r\n\tgroupByIndex,\r\n\tdelayMs,\r\n\tNotesTable\r\n}","import React, { Component } from 'react'\r\nimport { observe } from 'mobx'\r\nimport { FaSyncAlt, FaStop } from 'react-icons/fa'\r\nimport { keyNames, pitchArr, layoutImages, appName, layoutData,speedChangers } from \"appConfig\"\r\nimport Note from \"./Note\"\r\nimport { songStore } from './SongStore'\r\nimport { delayMs, ComposerToRecording, NotesTable } from \"lib/SongUtils\"\r\nimport \"./Keyboard.css\"\r\n\r\nclass Keyboard extends Component {\r\n    constructor(props) {\r\n        super(props)\r\n        let propKeyboard = this.props.data.keyboard\r\n        propKeyboard.layout.forEach(note => { note.status = '' })\r\n        this.state = {\r\n            playTimestamp: new Date().getTime(),\r\n            songToPractice: [],\r\n            approachingNotes: NotesTable(appName === 'Sky' ? 15 : 21),\r\n            outgoingAnimation: NotesTable(appName === 'Sky' ? 15 : 21),\r\n            keyboard: propKeyboard.layout,\r\n            sliderState: {\r\n                position: 0,\r\n                size: 0\r\n            },\r\n            approachingScore: {\r\n                correct: 1,\r\n                wrong: 1,\r\n                score: 0,\r\n                combo: 0\r\n            },\r\n\t\t\tspeedChanger: speedChangers.find(e => e.name === 'x1'),\r\n        }\r\n        this.approachRate = 1500\r\n        this.approachingNotesList = []\r\n        this.songTimestamp = 0\r\n        this.nextChunkDelay = 0\r\n        this.disposeStore = () => { }\r\n        this.tickTime = 50\r\n        this.tickInterval = 0\r\n    }\r\n\r\n    componentDidMount() {\r\n        window.addEventListener('keydown', this.handleKeyboard)\r\n        this.tickInterval = setInterval(this.tick, this.tickTime)\r\n        this.disposeStore = observe(songStore, async (data) => {\r\n            let value = data.object.data\r\n            let type = value.eventType\r\n            let lostReference = JSON.parse(JSON.stringify(value.song))\r\n            if (lostReference.data?.isComposedVersion) {\r\n                lostReference = ComposerToRecording(lostReference)\r\n            }\r\n            lostReference.timestamp = new Date().getTime()\r\n            let hasSong = false\r\n            if (type === 'play') {\r\n                await this.stopSong()\r\n                this.playSong(lostReference, value.start)\r\n                hasSong = true\r\n            }\r\n            if (type === 'practice') {\r\n                await this.stopSong()\r\n                this.practiceSong(lostReference, value.start)\r\n                hasSong = true\r\n            }\r\n            if (type === 'approaching') {\r\n                await this.stopSong()\r\n                this.approachingSong(lostReference, value.start)\r\n                hasSong = true\r\n            }\r\n            if (type === 'stop') await this.stopSong()\r\n            this.props.functions.setHasSong(hasSong)\r\n        })\r\n    }\r\n    componentWillUnmount() {\r\n        window.removeEventListener('keydown', this.handleKeyboard)\r\n        this.disposeStore()\r\n        this.songTimestamp = 0\r\n        clearInterval(this.tickInterval)\r\n    }\r\n\r\n    approachingSong = async (song) => {\r\n        let notes = []\r\n        this.approachRate = this.props.data.approachRate || 1500 \r\n        let startDelay = this.approachRate\r\n        song.notes.forEach(note => {\r\n            let obj = {\r\n                time: Math.floor(note[1] / this.state.speedChanger.value + startDelay),\r\n                index: note[0]\r\n            }\r\n            notes.push(obj)\r\n        })\r\n        this.setState({\r\n            approachingNotes: NotesTable(appName === 'Sky' ? 15 : 21),\r\n            approachingScore: {\r\n                correct: 1,\r\n                wrong: 1,\r\n                score: 0,\r\n                combo: 0\r\n            }\r\n        })\r\n        this.changeSliderState(0, notes.length)\r\n        this.approachingNotesList = notes\r\n    }\r\n\r\n    tick = () => {\r\n        if (!this.props.data.hasSong) return\r\n        const { approachingNotes, sliderState, approachingScore , speedChanger} = this.state\r\n        let stateNotes = approachingNotes\r\n        let notes = this.approachingNotesList\r\n        notes.forEach(note => {\r\n            note.time -= this.tickTime\r\n        })\r\n        let hasChanges = false\r\n        let removed = 0\r\n        for (let i = 0; i < notes.length; i++) {\r\n            if (notes[i].time < this.approachRate) {\r\n                stateNotes[notes[i].index].push({\r\n                    clicked: false,\r\n                    time: this.approachRate,\r\n                    id: Math.floor(Math.random() * 10000)\r\n                })\r\n                notes.splice(i, 1)\r\n                i--\r\n                hasChanges = true\r\n            } else {\r\n                break\r\n            }\r\n        }\r\n        stateNotes.forEach(note => {\r\n            for (let i = 0; i < note.length; i++) {\r\n                let apNote = note[i]\r\n                apNote.time -= this.tickTime\r\n                if (apNote.clicked) {\r\n                    if (apNote.time < this.approachRate / 3) {\r\n                        approachingScore.correct++\r\n                        approachingScore.combo++\r\n                        approachingScore.score += approachingScore.combo * speedChanger.value\r\n                    } else {\r\n                        approachingScore.wrong++\r\n                        approachingScore.combo = 0\r\n                    }\r\n                    apNote.time = -1 //so that it can be removed after\r\n                }\r\n                if (apNote.time < 0) {\r\n                    if (!apNote.clicked) {\r\n                        approachingScore.wrong++\r\n                        approachingScore.combo = 0\r\n                    }\r\n                    note.splice(i, 1)\r\n                    i--\r\n                    hasChanges = true\r\n                    removed++\r\n                }\r\n            }\r\n        })\r\n        if (!hasChanges) return\r\n        this.changeSliderState(sliderState.position + removed)\r\n        this.setState({\r\n            approachingNotes: stateNotes,\r\n            approachingScore: approachingScore\r\n        })\r\n    }\r\n\r\n    playSong = async (song, start = 0) => {\r\n        this.songTimestamp = song.timestamp\r\n        const { keyboard } = this.state\r\n        let notes = this.applySpeedChange(song.notes)\r\n        if (notes.length === 0) return\r\n        let previous = notes[0][1]\r\n        let pastError = 0\r\n        let previousTime = new Date().getTime()\r\n        for (let i = start; i < notes.length; i++) {\r\n            let delay = notes[i][1] - previous\r\n            previous = notes[i][1]\r\n            let note = notes[i][0]\r\n            previousTime = new Date().getTime()\r\n            if (delay > 16) await delayMs(delay - pastError)\r\n            if (this.songTimestamp !== song.timestamp) return\r\n            keyboard[note].status = 'clicked'\r\n            this.handleClick(keyboard[note])\r\n            this.setState({\r\n                keyboard,\r\n                sliderState: {\r\n                    position: i+1,\r\n                    size: notes.length\r\n                }\r\n            })\r\n            pastError = new Date().getTime() - previousTime - delay\r\n        }\r\n\r\n    }\r\n    applySpeedChange = (notes) => {\r\n        return notes.map(note => {\r\n            note[1] = note[1] / this.state.speedChanger.value\r\n            return note\r\n        })\r\n    }\r\n    practiceSong = (song, start = 0) => {\r\n        const { keyboard } = this.state\r\n        let notes = this.applySpeedChange(song.notes)\r\n        let songLength = notes.length\r\n        notes.splice(0, start)\r\n        let chunks = []\r\n        for (let i = 0; notes.length > 0; i++) {\r\n            let chunk = {\r\n                notes: [notes.shift()],\r\n                delay: 0\r\n            }\r\n            let startTime = chunk.notes.length > 0 ? chunk.notes[0][1] : 0\r\n            for (let j = 0; j < notes.length && j < 20; j++) {\r\n                let difference = notes[j][1] - chunk.notes[0][1] - 50 //TODO add threshold here\r\n                if (difference < 0) {\r\n                    chunk.notes.push(notes.shift())\r\n                    j--\r\n                }\r\n            }\r\n            chunk.delay = notes.length > 0 ? notes[0][1] - startTime : 0\r\n            chunks.push(chunk)\r\n        }\r\n        if (chunks.length === 0) return\r\n        let firstChunk = chunks[0]\r\n        this.nextChunkDelay = firstChunk.delay\r\n        let secondChunk = chunks[1]\r\n        firstChunk.notes.forEach(note => { keyboard[note[0]].status = 'toClick' })\r\n        secondChunk?.notes.forEach(note => {\r\n            let keyboardNote = keyboard[note[0]]\r\n            if (keyboardNote.status === 'toClick') return keyboardNote.status = 'toClickAndNext'\r\n            keyboardNote.status = 'toClickNext'\r\n        })\r\n        this.props.functions.setHasSong(true)\r\n        this.setState({\r\n            songToPractice: chunks,\r\n            keyboard,\r\n            sliderState: {\r\n                position: start,\r\n                size: songLength\r\n            }\r\n        })\r\n    }\r\n    handleSpeedChanger = (value) =>{\r\n        let changer = speedChangers.find(e => e.name === value)\r\n        this.setState({\r\n            speedChanger: changer\r\n        },this.restartSong)\r\n    }\r\n    restartSong =async () => {\r\n        let lostReference = JSON.parse(JSON.stringify(songStore.data))\r\n        await this.stopSong()\r\n        setTimeout(() => {\r\n            let start = songStore.data.start\r\n            if (songStore.data.eventType === 'practice'){\r\n                start = this.state.sliderState.position\r\n            }\r\n            songStore.data = {\r\n                ...lostReference,\r\n                start\r\n            }\r\n        }, 200)\r\n    }\r\n    stopSong = () => {\r\n        return new Promise(res => {\r\n            this.songTimestamp = 0\r\n            const { keyboard } = this.state\r\n            keyboard.forEach(note => {\r\n                note.status = ''\r\n                note.delay = 200\r\n            })\r\n            this.approachingNotesList = []\r\n            this.setState({\r\n                keyboard,\r\n                songToPractice: [],\r\n                approachingNotes: NotesTable(appName === 'Sky' ? 15 : 21)\r\n            }, res)\r\n\r\n            this.props.functions.setHasSong(false)\r\n        })\r\n\r\n    }\r\n    handleSliderEvent = (event) => {\r\n        this.changeSliderState(Number(event.target.value))\r\n    }\r\n    changeSliderState = async (position, size = this.state.sliderState.size) => {\r\n        this.setState({\r\n            sliderState: {\r\n                position,\r\n                size\r\n            }\r\n        })\r\n    }\r\n    handleKeyboard = (event) => {\r\n        const { keyboard } = this.state\r\n        if (event.repeat) return\r\n        if(event.shiftKey){\r\n            switch(event.code){\r\n                case \"KeyR\" : {\r\n                    if(!this.props.data.hasSong) return\r\n                    if(['practice','playing','approaching'].includes(songStore.data.eventType)){\r\n                        console.log(\"restarting\")\r\n                       return this.restartSong()\r\n                    }\r\n                    break;\r\n                }\r\n                case \"KeyS\" : {\r\n                    if(!this.props.data.hasSong) return\r\n                    return this.stopSong()\r\n                }\r\n                default: break;\r\n            }\r\n        }\r\n        if (document.activeElement.tagName === \"INPUT\") return\r\n        let code = event.code?.replace(\"Key\", \"\")\r\n        let index = this.props.data.keyboard.getNoteFromCode(code)\r\n        let note = keyboard[index]\r\n        if (note) this.handleClick(note)\r\n    }\r\n\r\n    handleApproachClick = (note) => {\r\n        const { approachingNotes } = this.state\r\n        let approachingNote = approachingNotes[note.index][0]\r\n        if (approachingNote) {\r\n            approachingNote.clicked = true\r\n            if(approachingNote.time < this.approachRate / 3) return \"approach-correct\"\r\n        }\r\n        return \"approach-wrong\"\r\n    }\r\n    handlePracticeClick = (note) => {\r\n        const { keyboard, songToPractice, sliderState } = this.state\r\n        if (songToPractice.length > 0) {\r\n            let indexClicked = songToPractice[0]?.notes.findIndex(e => e[0] === note.index)\r\n            if (indexClicked !== -1) {\r\n                songToPractice[0].notes.splice(indexClicked, 1)\r\n                if (songToPractice[0].notes.length === 0) songToPractice.shift()\r\n                if (songToPractice.length === 0) {\r\n                    this.stopSong()\r\n                    songStore.data = returnStopSong()\r\n                } else {\r\n                    let nextChunk = songToPractice[0]\r\n                    let nextNextChunk = songToPractice[1]\r\n                    nextChunk.notes.forEach(note => {\r\n                        keyboard[note[0]].status = 'toClick'\r\n                    })\r\n                    this.nextChunkDelay = nextChunk.delay\r\n                    nextNextChunk?.notes.forEach(note => {\r\n                        let keyboardNote = keyboard[note[0]]\r\n                        keyboard[note[0]].delay = nextChunk.delay\r\n                        if (keyboardNote.status === 'toClick') return keyboardNote.status = 'toClickAndNext'\r\n                        keyboardNote.status = 'toClickNext'\r\n                    })\r\n                }\r\n                this.setState({\r\n                    songToPractice: songToPractice,\r\n                    sliderState: {\r\n                        size: sliderState.size,\r\n                        position: sliderState.position + 1\r\n                    }\r\n                })\r\n            }\r\n        }\r\n    }\r\n    handleClick = (note, onlySound) => {\r\n        const { keyboard, outgoingAnimation} = this.state\r\n        const hasAnimation = this.props.data.hasAnimation\r\n        keyboard[note.index].status = 'clicked'\r\n        keyboard[note.index].delay = 200\r\n        this.handlePracticeClick(note)\r\n        let approachStatus = this.handleApproachClick(note)\r\n        if(songStore.data.eventType === 'approaching'){\r\n            keyboard[note.index].status = approachStatus\r\n        }\r\n        if(hasAnimation && songStore.data.eventType !=='approaching'){\r\n            let key = Math.floor(Math.random() * 10000) + new Date().getTime()\r\n            outgoingAnimation[note.index].push({key})\r\n        }\r\n        this.setState({ keyboard,\r\n            ...(hasAnimation? outgoingAnimation : {})\r\n        },() => {\r\n            setTimeout(() => {\r\n                if(!hasAnimation || songStore.data.eventType === 'approaching') return\r\n                const {outgoingAnimation} = this.state\r\n                outgoingAnimation[note.index].shift()\r\n                this.setState({outgoingAnimation})\r\n            },750)\r\n        })\r\n        setTimeout(() => {\r\n            if (!['clicked','approach-wrong','approach-correct'].includes(keyboard[note.index].status)) return\r\n            keyboard[note.index].status = ''\r\n            this.setState({ keyboard })\r\n        },appName === 'Sky' ? 250 : 100)\r\n        this.props.functions.playSound(note)\r\n    }\r\n    render() {\r\n        const { state, props } = this\r\n        const { data } = props\r\n        const { keyboard, approachingScore } = state\r\n        let size = data.keyboardSize / 100\r\n        if (size < 0.5) size = 0.5\r\n        if (size > 1.5) size = 1.5\r\n        let keyboardClass = \"keyboard\"\r\n        if (keyboard.length === 15) keyboardClass += \" keyboard-5\"\r\n        if (keyboard.length === 8) keyboardClass += \" keyboard-4\"\r\n        return <>\r\n            {data.hasSong &&\r\n                <div className=\"upper-right\">\r\n                    {songStore.data.eventType === 'approaching' &&\r\n                        <Score data={approachingScore} />\r\n                    }\r\n\r\n                    <div className=\"slider-wrapper\">\r\n                        <button className=\"song-button\" onClick={() => {\r\n                            this.stopSong()\r\n                            songStore.data = returnStopSong()\r\n                        }\r\n                        }>\r\n                            <FaStop />\r\n                        </button>\r\n                        <input\r\n                            type=\"range\"\r\n                            className=\"slider\"\r\n                            min={0}\r\n                            onChange={this.handleSliderEvent}\r\n                            max={state.sliderState.size}\r\n                            value={state.sliderState.position}\r\n                        ></input>\r\n                        <button className=\"song-button\" onClick={() => {\r\n                            this.restartSong()\r\n                        }}>\r\n                            <FaSyncAlt />\r\n                        </button>\r\n                        <select \r\n                            className='slider-select'\r\n                            onChange={(e) => this.handleSpeedChanger(e.target.value)}\r\n                            value={state.speedChanger.name}\r\n                        >\r\n                            <option disabled>Speed</option>\r\n                            {speedChangers.map(e => {\r\n                                return <option value={e.name} key={e.name}>\r\n                                    {e.name}\r\n                                </option>\r\n                            })}\r\n                        </select>\r\n                    </div>\r\n                </div>\r\n            }\r\n            <div\r\n                className={keyboardClass}\r\n                style={{\r\n                    transform: `scale(${size})`,\r\n                    marginBottom: size * 30 - 15\r\n                }}\r\n            >\r\n                {data.isLoading \r\n                    ? <div className=\"loading\">Loading...</div> \r\n                    \r\n                    : keyboard.map(note => {\r\n                        let noteImage = layoutImages[keyboard.length][note.index]\r\n                        let noteData = {\r\n                            ...note,\r\n                            approachRate:this.approachRate,\r\n                            instrument: this.props.data.keyboard.instrumentName,\r\n                            isAnimated: songStore.data.eventType === 'approaching' ? false : this.props.data.hasAnimation\r\n                        }\r\n                        return <Note\r\n                            key={note.index}\r\n                            data={noteData}\r\n                            approachingNotes={state.approachingNotes[note.index]}\r\n                            outgoingAnimation={state.outgoingAnimation[note.index]}\r\n                            handleClick={this.handleClick}\r\n                            noteText={getNoteText(data.noteNameType, note.index, data.pitch, keyboard.length)}\r\n                            noteImage={`./assets/icons/keys/${noteImage}.svg`}\r\n                        />\r\n    \r\n                    })\r\n                }\r\n\r\n            </div>\r\n        </>\r\n\r\n\r\n    }\r\n}\r\nfunction Score(props) {\r\n    const { combo, score, correct, wrong} = props.data\r\n    return <div className='approaching-accuracy'>\r\n        <table>\r\n            <tbody>\r\n                <tr>\r\n                    <td className='sc-2'>Accuracy</td>\r\n                    <td className='sc-1'>{(correct / (correct + wrong - 1) * 100 ).toFixed(1)}%</td>\r\n                </tr>\r\n                <tr>\r\n                    <td className='sc-2'>Score</td>\r\n                    <td className='sc-1'>{score}</td>\r\n                </tr>\r\n                <tr>\r\n                    <td className='sc-2'>Combo</td>\r\n                    <td className='sc-1'>{combo}</td>\r\n                </tr>\r\n            </tbody>\r\n        </table>\r\n    </div>\r\n\r\n\r\n\r\n}\r\nfunction returnStopSong() {\r\n    return {\r\n        song: {},\r\n        eventType: 'stop',\r\n        start: 0\r\n    }\r\n}\r\n\r\nfunction getNoteText(noteNameType, index, pitch, layoutLength) {\r\n    try {\r\n        if (noteNameType === \"Note name\") return keyNames[appName][pitchArr.indexOf(pitch)][index]\r\n        if (noteNameType === \"Keyboard layout\") return layoutData[layoutLength].keyboardLayout[index]\r\n        if (noteNameType === \"Do Re Mi\") return layoutData[layoutLength].mobileLayout[index]\r\n    } catch (e) { }\r\n    return ''\r\n}\r\nexport default Keyboard\r\n\r\n\r\n\r\n","export default __webpack_public_path__ + \"static/media/mainpage.53c2a740.png\";","export default __webpack_public_path__ + \"static/media/composer.69d0b59e.png\";","export default __webpack_public_path__ + \"static/media/songs.4892a692.png\";","import mainPageImg from 'assets/images/mainpage.png'\r\nimport composerImg from 'assets/images/composer.png'\r\nimport songsImg from 'assets/images/songs.png'\r\nimport { FaCrosshairs, FaDownload } from 'react-icons/fa'\r\nimport { BsCircle } from 'react-icons/bs'\r\n\r\nexport function HelpTab() {\r\n    return <>\r\n        <div className='help-title'>\r\n            Main page\r\n        </div>\r\n        <div>\r\n            <img src={mainPageImg} className='help-img' alt='tutorial for the main page' />\r\n            <ol>\r\n                <li>Record the keyboard as an audio file</li>\r\n                <li>Current note position, you can change it to reload</li>\r\n                <li>Playback speed</li>\r\n                <li>Approaching circles score</li>\r\n                <li>Approaching circle, click when it's close to the note</li>\r\n            </ol>\r\n        </div>\r\n                <div className='help-title'>\r\n                Main page shortcuts\r\n        </div>\r\n        <div style={{marginBottom:'0.5rem'}}>\r\n            The main page has shortcuts for PC users:\r\n        </div>\r\n        <table className='keys-table'>\r\n            <tbody>\r\n                <tr>\r\n                    <td><Key>Shift + R</Key></td><td>reload song </td>\r\n                </tr>\r\n                <tr>\r\n                    <td><Key>Shift + S</Key></td><td>stop song </td>\r\n                </tr>\r\n            </tbody>\r\n        </table>\r\n\r\n        <div className='help-title'>\r\n            Songs menu\r\n        </div>\r\n        <div>\r\n            <img src={songsImg} className='help-img' alt='tutorial for songs page' />\r\n            <ol>\r\n                <li>Open composer to create a song</li>\r\n                <li>Import song (as json)</li>\r\n                <li>Play song (click the name)</li>\r\n                <li>Practice the song</li>\r\n                <li>Play with the approaching circles mode</li>\r\n                <li>Download the song (as json)</li>\r\n            </ol>\r\n            <div className=\"column\">\r\n                <div>\r\n                    <FaCrosshairs /> = practice the song\r\n                </div>\r\n                <div>\r\n                    <BsCircle /> = Approaching circles mode\r\n                </div>\r\n                <div>\r\n                    <FaDownload /> = download the song\r\n                </div>\r\n\r\n            </div>\r\n        </div>\r\n\r\n        <div className='help-title'>\r\n            Composer\r\n        </div>\r\n        <div>\r\n            <img src={composerImg} className='help-img' alt=\"tutorial for composer\" />\r\n            <ol>\r\n                <li>Go to the next / previous breakpoint</li>\r\n                <li>Timeline of the breakpoints</li>\r\n                <li>Open the tools</li>\r\n                <li>Add 16 columns to the end</li>\r\n                <li>Remove the current selected column</li>\r\n                <li>Add column after the current one</li>\r\n                <li>Change layer (instrument)</li>\r\n                <li>Change column's duration</li>\r\n            </ol>\r\n        </div>\r\n\r\n        <div className='help-title'>\r\n                Composer shortcuts\r\n            </div>\r\n            <div style={{marginBottom:'0.5rem'}}>\r\n                The composer has shortcuts for PC users:\r\n            </div>\r\n            <table className='keys-table'>\r\n                <tbody>\r\n                    <tr>\r\n                        <td><Key>A / D</Key></td><td>move left / right</td>\r\n                    </tr>\r\n                    <tr>\r\n                        <td><Key>1 / 2 / 3 / 4</Key></td><td>change tempo</td>\r\n                    </tr>\r\n                    <tr>\r\n                        <td><Key>Space bar</Key></td><td>play / pause song</td>\r\n                    </tr>\r\n                    <tr>\r\n                        <td><Key>Arrow Left</Key></td><td>go to previous breakpoint</td>\r\n                    </tr>\r\n                    <tr>\r\n                        <td><Key>Arrow Right</Key></td><td>go to next breakpoint</td>\r\n                    </tr>\r\n                    <tr>\r\n                        <td><Key>Arrow Up</Key></td><td>select previous layer</td>\r\n                    </tr>\r\n                    <tr>\r\n                        <td><Key>Arrow Down</Key></td><td>select next layer </td>\r\n                    </tr>\r\n                    <tr>\r\n                        <td><Key>Shift + Note</Key></td><td>Adds/remove a note in the column </td>\r\n                    </tr>\r\n                    <tr>\r\n                        <td><Key>Q</Key></td><td>remove current column</td>\r\n                    </tr>\r\n                    <tr>\r\n                        <td><Key>E</Key></td><td>add column </td>\r\n                    </tr>\r\n                </tbody>\r\n            </table>\r\n            When playing a song, you can press on the PC keyboard to add notes\r\n            <div style={{marginBottom: \"1rem\"}}>\r\n\r\n            </div>\r\n    </>\r\n}\r\n\r\n\r\nfunction Key(props){\r\n    return <div className='keyboard-key'>\r\n        {props.children}\r\n    </div>\r\n}","import { Component } from 'react'\r\n\r\nexport default class MenuItem extends Component {\r\n    render() {\r\n        let className = this.props.className ? `menu-item ${this.props.className}` : \"menu-item\"\r\n        return <div\r\n            className={className}\r\n            onClick={() => this.props.action?.(this.props.type)}\r\n        >\r\n            {this.props.children}\r\n        </div>\r\n    }\r\n}","export default function MenuPanel(props) {\r\n    let className = props.visible === props.title ? \"menu-panel menu-panel-visible\" : \"menu-panel\"\r\n    return <div className={className}>\r\n        <div className=\"menu-title\">\r\n            {props.title}\r\n        </div>\r\n        <div className=\"panel-content-wrapper\">\r\n            {props.children}\r\n        </div>\r\n    </div>\r\n}","import { FaTimes } from 'react-icons/fa'\r\nexport default function MenuClose(props) {\r\n    return <div onClick={() => props.action(false)} className=\"close-menu menu-item\">\r\n        <FaTimes className=\"icon\" />\r\n    </div>\r\n}","import {useState } from 'react'\r\n\r\nexport default function SettingsRow(props) {\r\n    const { data, update, objKey, changeVolume } = props\r\n    const [valueHook, setter] = useState(data.value)\r\n    const [volumeHook, setterVolume] = useState(data.volume)\r\n    function handleChange(e) {\r\n        let el = e.target\r\n        let value = data.type === \"checkbox\" ? el.checked : el.value\r\n        if (data.type === \"number\") {\r\n            value = Number(value)\r\n            e.target.value = \"\" //have to do this to remove a react bug that adds a 0 at the start\r\n            if (value < data.threshold[0] || value > data.threshold[1]) {\r\n                return\r\n            }\r\n        }\r\n        if(el.type === 'checkbox'){\r\n            data.value = value\r\n            let obj = {\r\n                key: objKey,\r\n                data\r\n            }\r\n            update(obj)\r\n        }\r\n        setter(value)\r\n    }\r\n    function sendChange() {\r\n        if (data.value === valueHook) return\r\n        data.value = valueHook\r\n        let obj = {\r\n            key: objKey,\r\n            data: data\r\n        }\r\n        update(obj)\r\n    }\r\n    function sendChangeSelect(e) {\r\n        let value = e.target.value\r\n        data.value = value\r\n        let obj = {\r\n            key: objKey,\r\n            data: data\r\n        }\r\n        update(obj)\r\n    }\r\n    function handleVolume(e) {\r\n        setterVolume(Number(e.target.value))\r\n    }\r\n    function sendVolumeChange() {\r\n        changeVolume({\r\n            key: objKey,\r\n            value: volumeHook\r\n        })\r\n    }\r\n    if (objKey === \"settingVesion\") return null\r\n    return <div className=\"settings-row\">\r\n        <div>\r\n            {data.name}\r\n        </div>\r\n        {data.type === \"select\"\r\n            ? <select value={data.value}\r\n                onChange={sendChangeSelect}\r\n            >\r\n                {data.options.map(e => {\r\n                    return <option value={e} key={e}>{e}</option>\r\n                })}\r\n            </select>\r\n            : null\r\n        }\r\n        {[\"number\", \"text\", \"checkbox\"].includes(data.type) ?\r\n            <input\r\n                type={data.type}\r\n                value={valueHook}\r\n                placeholder={data.placeholder || \"\"}\r\n                checked={valueHook}\r\n                onChange={handleChange}\r\n                onBlur={sendChange}\r\n            />\r\n            : null\r\n        }\r\n        {data.type === \"instrument\"\r\n            ? <div className=\"instrument-picker\">\r\n                <select value={data.value}\r\n                    onChange={sendChangeSelect}\r\n                >\r\n                    {data.options.map(e => {\r\n                        return <option value={e} key={e}>{e}</option>\r\n                    })}\r\n                </select>\r\n\r\n                <input\r\n                    type=\"range\"\r\n                    min={1}\r\n                    max={100}\r\n                    value={volumeHook}\r\n                    onChange={handleVolume}\r\n                    onPointerUp={sendVolumeChange}\r\n                />\r\n            </div>\r\n            : null\r\n        }\r\n    </div>\r\n}","export default function DonateButton(props){\r\n    return <div className=\"donate-button\" onClick={() => props.onClick(\"Donate\")}>\r\n        Donate\r\n    </div>\r\n}","import { Component } from 'react'\r\nimport { FaMusic, FaTimes, FaCog, FaTrash, FaCrosshairs, FaDownload, FaInfo, FaSearch, FaHome } from 'react-icons/fa';\r\nimport { FaDiscord, FaGithub} from 'react-icons/fa';\r\nimport { BsCircle } from 'react-icons/bs'\r\nimport { RiPlayListFill } from 'react-icons/ri'\r\nimport { FileDownloader, LoggerEvent, prepareSongImport, prepareSongDownload} from \"lib/SongUtils\"\r\nimport { FilePicker } from \"react-file-picker\"\r\nimport { appName, isTwa } from \"appConfig\"\r\nimport { songStore } from './SongStore'\r\nimport { HelpTab } from './HelpTab'\r\nimport MenuItem from 'components/MenuItem'\r\nimport MenuPanel from 'components/MenuPanel'\r\nimport MenuClose from 'components/MenuClose'\r\nimport SettingsRow from 'components/SettingsRow'\r\nimport DonateButton from 'components/DonateButton'\r\nimport \"./menu.css\"\r\n\r\nclass Menu extends Component {\r\n    constructor(props) {\r\n        super(props)\r\n        this.state = {\r\n            open: false,\r\n            selectedMenu: \"Songs\",\r\n            selectedSongType: \"recorded\",\r\n            searchInput:'',\r\n            searchedSongs:[],\r\n            searchStatus: 'Write a song name then search!',\r\n            isPersistentStorage: false\r\n        }\r\n    }\r\n    componentDidMount(){\r\n        this.checkPersistentStorage()\r\n    }\r\n    checkPersistentStorage = async () => {\r\n        if (navigator.storage && navigator.storage.persist) {\r\n            let isPersisted = await navigator.storage.persisted()\r\n            if(!isPersisted) isPersisted = await navigator.storage.persist()\r\n            this.setState({isPersistentStorage: isPersisted})\r\n          }\r\n    }\r\n    handleSearchInput = (text) =>{\r\n        this.setState({\r\n            searchInput: text\r\n        })\r\n    }\r\n    clearSearch = () =>{\r\n        this.setState({\r\n            searchInput: '',\r\n            searchedSongs:[],\r\n            searchStatus: 'Write a song name then search!'\r\n        })\r\n    }\r\n    searchSongs = async () =>{\r\n        const { searchInput, searchStatus } = this.state\r\n        if(searchStatus === \"Searching...\") return\r\n        if(searchInput.trim().length === 0){\r\n            return this.setState({\r\n                searchStatus: 'Please write a non empty name'\r\n            })\r\n        }\r\n        this.setState({\r\n            searchStatus: 'Searching...'\r\n        })\r\n        let fetchedSongs = await fetch('https://sky-music.herokuapp.com/api/songs?search='+encodeURI(searchInput)).then(data => data.json())\r\n        if(fetchedSongs.error){\r\n            this.setState({\r\n                searchStatus: 'Please write a non empty name'\r\n            })\r\n            return new LoggerEvent(\"Error\", fetchedSongs.error).trigger()\r\n        }\r\n        this.setState({\r\n            searchedSongs: fetchedSongs,\r\n            searchStatus: 'success'\r\n        })\r\n    }\r\n    toggleMenu = (override) => {\r\n        if (typeof override !== \"boolean\") override = undefined\r\n        let newState = override !== undefined ? override : !this.state.open\r\n        this.setState({\r\n            open: newState,\r\n        })\r\n    }\r\n    selectSideMenu = (selection) => {\r\n        if (selection === this.state.selectedMenu && this.state.open) {\r\n            return this.setState({\r\n                open: false,\r\n            })\r\n        }\r\n        this.clearSearch()\r\n        this.setState({\r\n            selectedMenu: selection,\r\n            open: true\r\n        })\r\n    }\r\n    changeSelectedSongType = (name) => {\r\n        this.setState({\r\n            selectedSongType: name\r\n        })\r\n    }\r\n    importSong = (file) => {\r\n        const reader = new FileReader();\r\n        reader.addEventListener('load',async (event) => {\r\n            try {\r\n                let songsInput = JSON.parse(event.target.result)\r\n                \r\n                if(!Array.isArray(songsInput)) songsInput = [songsInput]\r\n                for(let song of songsInput){\r\n                    song = prepareSongImport(song)\r\n                    await this.props.functions.addSong(song)\r\n                }\r\n            } catch (e) {\r\n                let fileName = file.name\r\n                console.error(e)\r\n                if(fileName?.includes?.(\".mid\")){\r\n                    return new LoggerEvent(\"Error\", \"Midi files should be imported in the composer\").trigger()\r\n                }   \r\n                new LoggerEvent(\"Error\", \"Error importing song\").trigger()\r\n                \r\n            }\r\n        })\r\n        reader.readAsText(file)\r\n    }\r\n    downloadSong = (song) => {\r\n        if (song._id) delete song._id\r\n        let songName = song.name\r\n        if(appName === \"Sky\"){\r\n            //adds old format into the sheet\r\n            song = prepareSongDownload(song)\r\n        }\r\n        if(!Array.isArray(song)) song = [song]\r\n        song.forEach(song1 => {\r\n            song1.data.appName = appName\r\n        })\r\n        let json = JSON.stringify(song)\r\n        let fileDownloader = new FileDownloader()\r\n        fileDownloader.download(json,`${songName}.${appName.toLowerCase()}sheet.json`)\r\n        new LoggerEvent(\"Success\", \"Song downloaded\").trigger()\r\n    }\r\n\r\n    downloadAllSongs = () => {\r\n        let toDownload = []\r\n        this.props.data.songs.forEach(song => {\r\n            if (song._id) delete song._id\r\n            if(appName === \"Sky\"){\r\n                song = prepareSongDownload(song)\r\n            }\r\n            Array.isArray(song) ? toDownload.push(...song) : toDownload.push(song)\r\n        })\r\n        let fileDownloader = new FileDownloader()\r\n        let json = JSON.stringify(toDownload)\r\n        let date = new Date().toISOString().split('T')[0]\r\n        fileDownloader.download(json,`${appName}_Backup_${date}.json`)\r\n        new LoggerEvent(\"Success\", \"Song backup downloaded\").trigger()\r\n    }\r\n\r\n    render() {\r\n        let sideClass = this.state.open ? \"side-menu menu-open\" : \"side-menu\"\r\n        const { data, functions } = this.props\r\n        const { handleSettingChange } = functions\r\n        functions.toggleMenu = this.toggleMenu\r\n        functions.downloadSong = this.downloadSong\r\n        let changePage = this.props.functions.changePage\r\n        let songs = data.songs.filter(song => !song.data.isComposedVersion)\r\n        let composedSongs = data.songs.filter(song => song.data.isComposedVersion)\r\n        const { searchStatus , searchedSongs, selectedMenu } = this.state\r\n        let searchedSongFunctions = {\r\n            importSong: functions.addSong,\r\n        }\r\n        return <div className=\"menu-wrapper\">\r\n            <div className=\"menu menu-visible menu-main-page\">\r\n                {this.state.open && <MenuClose action={this.toggleMenu} />}\r\n                <MenuItem type=\"Help\" action={this.selectSideMenu} className=\"margin-top-auto\">\r\n                    <FaInfo className=\"icon\" />\r\n                </MenuItem>\r\n                <MenuItem type=\"Library\" action={this.selectSideMenu}>\r\n                    <RiPlayListFill className='icon'/>\r\n                </MenuItem>\r\n                <MenuItem type=\"Songs\" action={this.selectSideMenu} >\r\n                    <FaMusic className=\"icon\" />\r\n                </MenuItem>\r\n                <MenuItem type=\"Settings\" action={this.selectSideMenu}>\r\n                    <FaCog className=\"icon\" />\r\n                </MenuItem>\r\n                <MenuItem type=\"Home\" action={() => changePage(\"home\")}>\r\n                    <FaHome className=\"icon\" />\r\n                </MenuItem>\r\n            </div>\r\n            <div className={sideClass}>\r\n                <MenuPanel title=\"No selection\" visible={selectedMenu}>\r\n                </MenuPanel>\r\n                <MenuPanel title=\"Songs\" visible={selectedMenu}>\r\n                    <div className=\"songs-buttons-wrapper\">\r\n                        <button className=\"genshin-button\"\r\n                            onClick={() => changePage(\"Composer\")}\r\n                        >\r\n                            Compose song\r\n                        </button>\r\n                        <FilePicker\r\n                            onChange={(file) => this.importSong(file)}\r\n                        >\r\n                            <button className=\"genshin-button\">\r\n                                Import song\r\n                            </button>\r\n                        </FilePicker>\r\n\r\n                    </div>\r\n                    <div className=\"tab-selector-wrapper\">\r\n                        <button\r\n                            className={this.state.selectedSongType === \"recorded\" ? \"tab-selector tab-selected\" : \"tab-selector\"}\r\n                            onClick={() => this.changeSelectedSongType(\"recorded\")}\r\n                        >\r\n                            Recorded\r\n                        </button>\r\n                        <button\r\n                            className={this.state.selectedSongType === \"composed\" ? \"tab-selector tab-selected\" : \"tab-selector\"}\r\n                            onClick={() => this.changeSelectedSongType(\"composed\")}\r\n                        >\r\n                            Composed\r\n                        </button>\r\n                    </div>\r\n                    <div className=\"songs-wrapper\">\r\n                        {this.state.selectedSongType === \"recorded\"\r\n                            ? songs.map(song => {\r\n                                return <SongRow\r\n                                    data={song}\r\n                                    key={song.name}\r\n                                    functions={functions}\r\n                                >\r\n                                </SongRow>\r\n                            })\r\n                            : composedSongs.map(song => {\r\n                                return <SongRow\r\n                                    data={song}\r\n                                    key={song.name}\r\n                                    functions={functions}\r\n                                >\r\n                                </SongRow>\r\n                            })\r\n                        }\r\n                    </div>\r\n                    <div style={{marginTop:\"auto\", paddingTop:'0.5rem', width:'100%',display:'flex',justifyContent:'flex-end'}}>\r\n                        <button \r\n                            className='genshin-button'\r\n                            style={{marginLeft:'auto'}}\r\n                            onClick={this.downloadAllSongs}\r\n                        >\r\n                            Download all songs (backup)\r\n                        </button>\r\n                    </div>\r\n                </MenuPanel>\r\n\r\n                <MenuPanel title=\"Settings\" visible={selectedMenu}>\r\n                    {Object.entries(data.settings).map(([key, data]) => {\r\n                        return <SettingsRow\r\n                            key={key + data.value}\r\n                            objKey={key}\r\n                            data={data}\r\n                            changeVolume={functions.changeVolume}\r\n                            update={handleSettingChange}\r\n                        >\r\n\r\n                        </SettingsRow>\r\n                    })}\r\n                    <div style={{marginTop:'1rem'}}>\r\n                        {this.state.isPersistentStorage ?\"Storage is persisted\" : \"Storage is not persisted\"}\r\n                    </div>\r\n                    {!isTwa() && <DonateButton onClick={changePage}/>}\r\n\r\n                </MenuPanel>\r\n                \r\n                <MenuPanel title=\"Library\" visible={selectedMenu}>\r\n                    <div>\r\n                        Here you can find songs to learn, they are provided by the sky-music library.\r\n                    </div>\r\n                    <div className='library-search-row' >\r\n                        <input \r\n                            className='library-search-input' \r\n                            placeholder='Song name'\r\n                            onKeyDown={(e) => {\r\n                                if(e.code === \"Enter\") this.searchSongs()\r\n                            }}\r\n                            onInput={(e) => this.handleSearchInput(e.target.value)}\r\n                            value={this.state.searchInput}\r\n                        />\r\n                        <button className='library-search-btn' onClick={this.clearSearch}>\r\n                            <FaTimes />\r\n                        </button>\r\n                        <button className='library-search-btn' onClick={this.searchSongs}>\r\n                            <FaSearch/>\r\n                        </button>\r\n                    </div>\r\n                    <div className='library-search-songs-wrapper'>\r\n                        {searchStatus === \"success\" ?\r\n                            searchedSongs.length > 0 \r\n                                ?   searchedSongs.map(song => \r\n                                        <SearchedSong\r\n                                            key={song.file}\r\n                                            data={song}\r\n                                            functions={searchedSongFunctions}\r\n                                        >\r\n                                            {song.name}\r\n                                        </SearchedSong>)   \r\n                                :   <div className='library-search-result-text'>\r\n                                        No results\r\n                                    </div>\r\n                            :   <div className='library-search-result-text'>\r\n                                    {searchStatus}\r\n                                </div>\r\n                        }\r\n                    </div>\r\n                </MenuPanel>\r\n                <MenuPanel title=\"Help\" visible={selectedMenu}>\r\n                    <div className='help-icon-wrapper'>\r\n                        <a href='https://discord.gg/Arsf65YYHq' >\r\n                            <FaDiscord className='help-icon' />\r\n                        </a>\r\n                        <a href='https://github.com/Specy/genshin-music' >\r\n                            <FaGithub className='help-icon' />\r\n                        </a>\r\n                        \r\n                    </div>\r\n                    <HelpTab />\r\n                    {!isTwa() && <DonateButton onClick={changePage}/>}\r\n                </MenuPanel>\r\n            </div>\r\n        </div>\r\n    }\r\n}\r\nfunction SongRow(props) {\r\n    let data = props.data\r\n    let deleteSong = props.functions.removeSong\r\n    let toggleMenu = props.functions.toggleMenu\r\n    let downloadSong = props.functions.downloadSong\r\n \r\n    return <div className=\"song-row\">\r\n        <div className=\"song-name\" onClick={() => {\r\n            songStore.data = {\r\n                eventType: 'play',\r\n                song: data,\r\n                start: 0\r\n            }\r\n            toggleMenu(false)\r\n        }}>\r\n            {data.name}\r\n        </div>\r\n        <div className=\"song-buttons-wrapper\">\r\n            <button className=\"song-button\" onClick={() => {\r\n                    songStore.data = {\r\n                        eventType: 'practice',\r\n                        song: data,\r\n                        start: 0\r\n                    }\r\n                    toggleMenu(false)\r\n                }}\r\n            >\r\n                <FaCrosshairs />\r\n            </button>\r\n            \r\n            <button className=\"song-button\" onClick={() => {\r\n                    songStore.data = {\r\n                        eventType: 'approaching',\r\n                        song: data,\r\n                        start: 0\r\n                    }\r\n                    toggleMenu(false)\r\n                }}\r\n            >\r\n                <BsCircle />\r\n            </button>\r\n            <button className=\"song-button\" onClick={() => downloadSong(data)}>\r\n                <FaDownload />\r\n\r\n            </button>\r\n            <button className=\"song-button\" onClick={() => deleteSong(data.name)}>\r\n                <FaTrash color=\"#ed4557\" />\r\n            </button>\r\n        </div>\r\n    </div>\r\n}\r\n\r\nfunction SearchedSong(props){\r\n    const { functions, data} = props\r\n    const { importSong } = functions\r\n    const download = async function(){\r\n        try{\r\n            let song = await fetch('https://sky-music.herokuapp.com/api/songs?get='+encodeURI(data.file)).then(data => data.json())\r\n            song = prepareSongImport(song)\r\n            importSong(song)\r\n        }catch(e){\r\n            console.error(e)\r\n            new LoggerEvent(\"Error\", \"Error downloading song\").trigger()\r\n        }\r\n    }\r\n    const play = async function(){\r\n        try{\r\n            let song = await fetch('https://sky-music.herokuapp.com/api/songs?get='+encodeURI(data.file)).then(data => data.json())\r\n            song = prepareSongImport(song)\r\n            songStore.data = {\r\n                eventType: 'play',\r\n                song: song,\r\n                start: 0\r\n            }\r\n        }catch(e){\r\n            console.error(e)\r\n            new LoggerEvent(\"Error\", \"Error downloading song\").trigger()\r\n        }\r\n    }\r\n    return <div className=\"song-row\">\r\n    <div className=\"song-name\" onClick={() => {\r\n        play(data)\r\n    }}>\r\n        {data.name}\r\n    </div>\r\n    <div className=\"song-buttons-wrapper\">\r\n        <button className=\"song-button\" onClick={download}>\r\n            <FaDownload />\r\n        </button>\r\n    </div>\r\n</div>\r\n}\r\n\r\nexport default Menu","import { isMobile } from \"is-mobile\"\r\nimport {instruments, appName} from \"appConfig\"\r\n\r\nconst ComposerSettings = {\r\n    settingVesion: appName + 15,\r\n    instrument: {\r\n        name: \"Instrument (Layer 1)\",\r\n        type: \"instrument\",\r\n        songSetting: false,\r\n        value: instruments[0],\r\n        volume: 100,\r\n        options: instruments\r\n    },\r\n    layer2: {\r\n        name: \"Instrument (Layer 2)\",\r\n        type: \"instrument\",\r\n        songSetting: false,\r\n        value: instruments[0],\r\n        volume: 100,\r\n        options: instruments\r\n    },\r\n    layer3: {\r\n        name: \"Instrument (Layer 3)\",\r\n        type: \"instrument\",\r\n        songSetting: false,\r\n        value: instruments[0],\r\n        volume: 100,\r\n        options: instruments\r\n    },\r\n    bpm: {\r\n        name: \"Bpm\",\r\n        type: \"number\",\r\n        songSetting: true,\r\n        threshold: [0, 1600],\r\n        value: 220\r\n    },\r\n    beatMarks: {\r\n        name: \"Beat marks\",\r\n        type: \"select\",\r\n        songSetting: false,\r\n        value: 3,\r\n        options: [\r\n            3,\r\n            4\r\n        ]\r\n    },\r\n    noteNameType:{\r\n        name: \"Note name type\",\r\n        type: \"select\",\r\n        songSetting: false,\r\n        value: appName === \"Genshin\" \r\n                                ? isMobile() \r\n                                    ? \"Do Re Mi\" \r\n                                    : \"Keyboard layout\"\r\n                                : \"Note name\",\r\n        options: appName === \"Genshin\"\r\n        ? [\r\n            \"Note name\",\r\n            \"Keyboard layout\",\r\n            \"Do Re Mi\"\r\n        ]\r\n        : [\r\n            \"Note name\",\r\n            \"Keyboard layout\"\r\n        ]\r\n    },\r\n    pitch: {\r\n        name: \"Pitch\",\r\n        type: \"select\",\r\n        songSetting: true,\r\n        value: \"C\",\r\n        options: [\r\n            \"C\",\r\n            \"Db\",\r\n            \"D\",\r\n            \"Eb\",\r\n            \"E\",\r\n            \"F\",\r\n            \"Gb\",\r\n            \"G\",\r\n            \"Ab\",\r\n            \"A\",\r\n            \"Bb\",\r\n            \"B\",\r\n        ]\r\n    },\r\n    columnsPerCanvas: {\r\n        name: \"Number of visible columns\",\r\n        type: \"select\",\r\n        songSetting: false,\r\n        value: 35,\r\n        options: [\r\n            20,\r\n            25,\r\n            30,\r\n            35,\r\n            40,\r\n            45,\r\n            50\r\n        ]\r\n    },\r\n    caveMode: {\r\n        name: \"Reverb (cave mode)\",\r\n        type: \"checkbox\",\r\n        songSetting: false,\r\n        value: false,\r\n    },\r\n    autosave: {\r\n        name: \"Autosave changes\",\r\n        type: \"checkbox\",\r\n        songSetting: false,\r\n        value: false,\r\n    },\r\n    backgroundImage:{\r\n        name: \"Background image (url)\",\r\n        type: \"text\",\r\n        songSetting: false,\r\n        value: \"\",\r\n        placeholder: \"Write here\"\r\n    },\r\n    syncTabs:{\r\n        name: \"Autoplay in all tabs (pc only)\",\r\n        type: \"checkbox\",\r\n        songSetting:false,\r\n        value: false\r\n    }\r\n}\r\n\r\n\r\n\r\nconst MainPageSettings = {\r\n    settingVesion:appName + 15,\r\n    instrument: {\r\n        name: \"Instrument\",\r\n        type: \"instrument\",\r\n        songSetting: false,\r\n        value: instruments[0],\r\n        volume: 100,\r\n        options: instruments\r\n    },\r\n    pitch: {\r\n        name: \"Pitch\",\r\n        type: \"select\",\r\n        songSetting: true,\r\n        value: \"C\",\r\n        options: [\r\n            \"C\",\r\n            \"Db\",\r\n            \"D\",\r\n            \"Eb\",\r\n            \"E\",\r\n            \"F\",\r\n            \"Gb\",\r\n            \"G\",\r\n            \"Ab\",\r\n            \"A\",\r\n            \"Bb\",\r\n            \"B\",\r\n        ]\r\n    },\r\n    caveMode: {\r\n        name: \"Reverb (cave mode)\",\r\n        type: \"checkbox\",\r\n        songSetting: false,\r\n        value: false,\r\n    },\r\n    keyboardSize: {\r\n        name: \"Keyboard size\",\r\n        type: \"number\",\r\n        songSetting: false,\r\n        value: 100,\r\n        threshold: [0, 200]\r\n    },\r\n    noteNameType:{\r\n        name: \"Note name type\",\r\n        type: \"select\",\r\n        songSetting: false,\r\n        value: appName === \"Genshin\" \r\n                                ? isMobile() \r\n                                    ? \"Do Re Mi\" \r\n                                    : \"Keyboard layout\"\r\n                                : \"Note name\",\r\n                                \r\n        options: appName === \"Genshin\"\r\n        ? [\r\n            \"Note name\",\r\n            \"Keyboard layout\",\r\n            \"Do Re Mi\"\r\n        ]\r\n        : [\r\n            \"Note name\",\r\n            \"Keyboard layout\"\r\n        ]\r\n    },\r\n    approachSpeed: {\r\n        name: \"Approach Rate (AR)\",\r\n        type: \"number\",\r\n        songSetting: false,\r\n        value: 1500,\r\n        threshold: [0, 5000]\r\n    },\r\n    backgroundImage:{\r\n        name: \"Background image (url)\",\r\n        type: \"text\",\r\n        songSetting: false,\r\n        value: \"\",\r\n        placeholder: \"Write here\"\r\n    },\r\n    noteAnimation:{\r\n        name: \"Note animation\",\r\n        type: \"checkbox\",\r\n        songSetting: false,\r\n        value: false\r\n    }\r\n}\r\nexport {\r\n    ComposerSettings,\r\n    MainPageSettings\r\n}","import { instrumentsData, layoutData, instruments,audioContext } from \"appConfig\"\r\nclass Instrument {\r\n    constructor(instrumentName) {\r\n        this.instrumentName = instrumentName === undefined ? instruments[0] : instrumentName\r\n        this.layout = []\r\n        this.buffers = []\r\n        this.loaded = false\r\n        this.deleted = false\r\n        this.volumeNode = audioContext.createGain()\r\n        let instrumentData = instrumentsData[this.instrumentName]\r\n\r\n        this.keyboardLayout = layoutData[instrumentData.notes].keyboardLayout\r\n        this.mobileLayout = layoutData[instrumentData.notes].mobileLayout\r\n        this.keyboardCodes = layoutData[instrumentData.notes].keyboardCodes\r\n        \r\n        this.keyboardLayout.forEach((noteName, i) => {\r\n            let noteNames = {\r\n                keyboard: noteName,\r\n                mobile: this.mobileLayout[i]\r\n            }\r\n            let url = `./assets/audio/${instrumentName}/${i}.mp3`\r\n            this.layout.push(new NoteData(i, noteNames, url))\r\n        })\r\n\r\n        this.volumeNode.gain.value = 0.8\r\n    }\r\n    getNoteFromCode = (code) => {\r\n        let index = this.keyboardLayout.findIndex(e => e === String(code))\r\n        return index !== -1 ? index : null\r\n    }\r\n\r\n    changeVolume = (amount) => {\r\n        let newVolume = Number((amount / 135).toFixed(2))\r\n        if(amount < 5) newVolume = 0\r\n        this.volumeNode.gain.value = newVolume\r\n    }\r\n\r\n    play = (note, pitch) => {\r\n        if(this.deleted) return\r\n        let player = audioContext.createBufferSource()\r\n        player.buffer = this.buffers[note]\r\n        player.connect(this.volumeNode)\r\n        player.playbackRate.value = pitch\r\n        player.start(0)\r\n        player.onended = () => {\r\n            player.stop()\r\n            player.disconnect()\r\n        }\r\n    }\r\n    load = async () => {\r\n        let emptyBuffer = audioContext.createBuffer(2, audioContext.sampleRate, audioContext.sampleRate)\r\n        const requests = this.layout.map(note => {\r\n            return new Promise(resolve => {\r\n                fetch(note.url)\r\n                    .then(result => result.arrayBuffer())\r\n                    .then(buffer => {\r\n                        audioContext.decodeAudioData(buffer, resolve, () => {\r\n                            resolve(emptyBuffer)\r\n                        })\r\n                        .catch(e => {resolve(emptyBuffer)})\r\n                    }).catch(e => {resolve(emptyBuffer)})\r\n            })\r\n        })\r\n        this.buffers = await Promise.all(requests)\r\n        this.loaded = true\r\n        return true\r\n    }\r\n    disconnect = () =>{\r\n        this.volumeNode.disconnect()\r\n    }\r\n    connect = (node) => {\r\n        this.volumeNode.connect(node)\r\n    }\r\n    delete = () => {\r\n        this.disconnect()\r\n        this.deleted = true\r\n        this.buffers = null\r\n    }\r\n}\r\n\r\n\r\n\r\nclass NoteData {\r\n    constructor(index, noteNames, url) {\r\n        this.index = index\r\n        this.noteNames = noteNames\r\n        this.url = url\r\n        this.buffer = new ArrayBuffer(8)\r\n    }\r\n}\r\nexport default Instrument","import { audioContext } from \"appConfig\";\r\nimport toWav from 'audiobuffer-to-wav'\r\nimport MediaRecorderPolyfill from 'audio-recorder-polyfill'\r\nexport default class AudioRecorder {\r\n    constructor() {\r\n        this.node = audioContext.createMediaStreamDestination()\r\n        if(!window.MediaRecorder){\r\n            console.log(\"Audio recorder Polyfill\")\r\n            this.recorder = new MediaRecorderPolyfill(this.node.stream)\r\n        }else{\r\n            this.recorder = new MediaRecorder(this.node.stream)\r\n        }\r\n    }\r\n    start() {\r\n        this.recorder.start()\r\n    }\r\n    stop() {\r\n        return new Promise(resolve => {\r\n            this.recorder.addEventListener('dataavailable', function (e) {\r\n                resolve({\r\n                    data: e.data,\r\n                    toUrl: () => {\r\n                        return URL.createObjectURL(e.data);\r\n                    }\r\n                })\r\n            }, { once: true })\r\n            this.recorder.stop()\r\n        })\r\n    }\r\n\r\n    async download(urlBlob, fileName) {\r\n        const anchor = document.createElement(\"a\")\r\n        const wav = toWav(await blobToAudio(urlBlob))\r\n        var blob = new Blob([new DataView(wav)], {\r\n            type: 'audio/wav'\r\n        })\r\n        anchor.download = fileName\r\n        anchor.href = URL.createObjectURL(blob)\r\n        anchor.click();\r\n    }\r\n}\r\n\r\nfunction blobToAudio(blob) {\r\n    return new Promise(resolve => {\r\n        const audioContext = new AudioContext();\r\n        const fileReader = new FileReader();\r\n        fileReader.onloadend = () => {\r\n            audioContext.decodeAudioData(fileReader.result, (audioBuffer) => {\r\n                resolve(audioBuffer)\r\n            });\r\n        };\r\n        fileReader.readAsArrayBuffer(blob);\r\n    })\r\n}","import { LoggerEvent } from \"lib/SongUtils\"\r\n\r\nasync function asyncPrompt(question) {\r\n    return new Promise(resolve => {\r\n        let container = document.createElement(\"div\")\r\n        container.className = \"floating-prompt\"\r\n        let text = document.createElement(\"div\")\r\n        text.innerText = question\r\n        let input = document.createElement(\"input\")\r\n        input.type = \"text\"\r\n        input.placeholder = \"Write here\"\r\n        input.className = \"prompt-input\"\r\n        let row = document.createElement(\"div\")\r\n        let cancel = document.createElement(\"button\")\r\n        let ok = document.createElement(\"button\")\r\n        cancel.className = \"prompt-button\"\r\n        ok.className = \"prompt-button disabled\"\r\n        row.className = \"prompt-row\"\r\n        ok.innerText = \"Ok\"\r\n        cancel.innerText = \"Cancel\"\r\n        row.append(cancel, ok)\r\n        container.append(text, input, row)\r\n        document.body.appendChild(container)\r\n        input.addEventListener(\"input\", () => {\r\n            if (input.value.trim() === \"\") {\r\n                ok.classList.add(\"disabled\")\r\n            } else {\r\n                ok.classList.remove(\"disabled\")\r\n            }\r\n\r\n        })\r\n        cancel.addEventListener(\"click\", () => {\r\n            container.classList.add(\"floating-prompt-hidden\")\r\n            resolve(null)\r\n            setTimeout(() => container.remove(), 200)\r\n        })\r\n        ok.addEventListener(\"click\", () => {\r\n            if (input.value.trim() === \"Untitled\") {\r\n                input.value = \"\"\r\n                return new LoggerEvent(\"Warning\", '\"Untitled\" is a reserved word, use another').trigger()\r\n            }\r\n            container.classList.add(\"floating-prompt-hidden\")\r\n            resolve(input.value.trim())\r\n\r\n            setTimeout(() => container.remove(), 200)\r\n        })\r\n    })\r\n}\r\n\r\nasync function asyncConfirm(question) {\r\n    return new Promise(resolve => {\r\n        let container = document.createElement(\"div\")\r\n        container.className = \"floating-prompt\"\r\n        let text = document.createElement(\"div\")\r\n        text.innerText = question\r\n        let row = document.createElement(\"div\")\r\n        let cancel = document.createElement(\"button\")\r\n        let ok = document.createElement(\"button\")\r\n\r\n        cancel.className = \"prompt-button\"\r\n        ok.className = \"prompt-button\"\r\n        row.className = \"prompt-row\"\r\n        ok.innerText = \"Yes\"\r\n        ok.style.background = '#628c83'\r\n        cancel.style.background = '#a9525a'\r\n        cancel.innerText = \"No\"\r\n        row.append(cancel, ok)\r\n        container.append(text, row)\r\n        document.body.appendChild(container)\r\n        cancel.addEventListener(\"click\", () => {\r\n            container.classList.add(\"floating-prompt-hidden\")\r\n            resolve(false)\r\n            setTimeout(() => container.remove(), 200)\r\n        })\r\n        ok.addEventListener(\"click\", () => {\r\n            container.classList.add(\"floating-prompt-hidden\")\r\n            resolve(true)\r\n            setTimeout(() => container.remove(), 200)\r\n        })\r\n    })\r\n}\r\n\r\nexport {\r\n    asyncConfirm,\r\n    asyncPrompt\r\n}","import React, { Component } from 'react';\r\nimport Keyboard from \"./Keyboard\"\r\nimport Menu from \"./Menu\"\r\nimport { songStore } from './SongStore'\r\nimport ZangoDb from \"zangodb\"\r\nimport { Song, Recording, LoggerEvent, prepareSongImport, getPitchChanger } from \"lib/SongUtils\"\r\nimport { MainPageSettings } from \"lib/SettingsObj\"\r\nimport Instrument from 'lib/Instrument';\r\nimport AudioRecorder from 'lib/AudioRecorder';\r\nimport { asyncConfirm, asyncPrompt } from \"components/AsyncPrompts\"\r\nimport { appName, audioContext , isTwa} from \"appConfig\"\r\nimport './App.css';\r\nclass App extends Component {\r\n\tconstructor(props) {\r\n\t\tsuper(props)\r\n\t\tthis.db = new ZangoDb.Db(appName, { songs: [] })\r\n\t\tthis.recording = new Recording()\r\n\t\tlet settings = this.getSettings()\r\n\t\tthis.dbCol = {\r\n\t\t\tsongs: this.db.collection(\"songs\")\r\n\t\t}\r\n\t\tthis.state = {\r\n\t\t\tinstrument: new Instrument(),\r\n\t\t\tisLoadingInstrument: true,\r\n\t\t\tisRecording: false,\r\n\t\t\tisRecordingAudio: false,\r\n\t\t\tsongs: [],\r\n\t\t\tsettings: settings,\r\n\t\t\tisDragging: false,\r\n\t\t\tthereIsSong: false\r\n\t\t}\r\n\t\tthis.mounted = false\r\n\t\tthis.reverbNode = undefined\r\n\t\tthis.reverbVolumeNode = undefined\r\n\t\tthis.audioContext = audioContext\r\n\t\tthis.recorder = new AudioRecorder()\r\n\t}\r\n\r\n\tinit = async () => {\r\n\t\tconst { settings } = this.state\r\n\t\tawait this.loadInstrument(settings.instrument.value)\r\n\t\tawait this.loadReverb()\r\n\t\tthis.toggleReverbNodes(settings.caveMode.value)\r\n\t}\r\n\tcomponentDidMount() {\r\n\t\tdocument.body.addEventListener('dragenter', this.handleDrag)\r\n\t\tdocument.body.addEventListener('dragleave', this.resetDrag)\r\n\t\tdocument.body.addEventListener('dragover', this.handleDragOver)\r\n\t\tdocument.body.addEventListener('drop', this.handleDrop)\r\n\t\tthis.mounted = true\r\n\t\tthis.syncSongs()\r\n\t\tthis.init()\r\n\t}\r\n\tcomponentWillUnmount() {\r\n\t\tdocument.body.removeEventListener('dragenter', this.handleDrag)\r\n\t\tdocument.body.removeEventListener('dragleave', this.resetDrag)\r\n\t\tdocument.body.removeEventListener('drop', this.handleDrop)\r\n\t\tdocument.body.addEventListener('dragover', this.handleDragOver)\r\n\t\tsongStore.data = {\r\n\t\t\tsong: {},\r\n\t\t\teventType: 'stop',\r\n\t\t\tstart: 0\r\n\t\t}\r\n\t\tthis.mounted = false\r\n\t\tthis.audioContext = undefined\r\n\t\tthis.recorder = undefined\r\n\t\tthis.reverbNode = undefined\r\n\t\tthis.reverbVolumeNode = undefined\r\n\t\tthis.state.instrument.delete()\r\n\t}\r\n\tresetDrag = (e) => {\r\n\t\tthis.setState({\r\n\t\t\tisDragging: false\r\n\t\t})\r\n\t}\r\n\thandleDragOver = (e) => {\r\n\t\te.preventDefault()\r\n\t\tthis.setState({\r\n\t\t\tisDragging: true\r\n\t\t})\r\n\t}\r\n\thandleDrag = (e) => {\r\n\t\te.preventDefault()\r\n\t\tthis.setState({\r\n\t\t\tisDragging: true\r\n\t\t})\r\n\t}\r\n\tsetHasSong = (data) => {\r\n\t\tthis.setState({\r\n\t\t\tthereIsSong: data\r\n\t\t})\r\n\t}\r\n\thandleDrop = async (e) => {\r\n\t\tthis.resetDrag()\r\n\t\te.preventDefault()\r\n\t\tlet songs = await Promise.all(Array.from(e.dataTransfer.files).map(file => file.text()))\r\n\t\tfor (let i = 0; i < songs.length; i++) {\r\n\t\t\ttry {\r\n\t\t\t\tlet song = prepareSongImport(JSON.parse(songs[i]))\r\n\t\t\t\tawait this.addSong(song)\r\n\t\t\t} catch (e) {\r\n\t\t\t\tconsole.error(e)\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t}\r\n\ttoggleReverbNodes = (hasReverb) => {\r\n\t\tif(!this.mounted) return\r\n\t\tconst { instrument } = this.state\r\n\t\tif (hasReverb) {\r\n\t\t\tif (!this.reverbNode) return console.log(\"Couldn't connect to reverb\")\r\n\t\t\tinstrument.disconnect()\r\n\t\t\tinstrument.connect(this.reverbNode)\r\n\t\t} else {\r\n\t\t\tinstrument.disconnect()\r\n\t\t\tinstrument.connect(this.audioContext.destination)\r\n\t\t}\r\n\t}\r\n\tchangeVolume = (obj) => {\r\n        let settings = this.state.settings\r\n        if (obj.key === \"instrument\") {\r\n            settings.instrument.volume = obj.value\r\n            this.state.instrument.changeVolume(obj.value)\r\n        }\r\n        this.setState({\r\n            settings: settings\r\n        }, () => this.updateSettings())\r\n    }\r\n\tgetSettings = () => {\r\n\t\tlet storedSettings = localStorage.getItem(appName + \"_Main_Settings\")\r\n\t\ttry {\r\n\t\t\tstoredSettings = JSON.parse(storedSettings)\r\n\t\t} catch (e) {\r\n\t\t\tstoredSettings = null\r\n\t\t}\r\n\t\tif (storedSettings !== null) {\r\n\t\t\tif (storedSettings.settingVesion !== MainPageSettings.settingVesion) {\r\n\t\t\t\tthis.updateSettings(MainPageSettings)\r\n\t\t\t\treturn MainPageSettings\r\n\t\t\t}\r\n\t\t\treturn storedSettings\r\n\t\t}\r\n\t\treturn MainPageSettings\r\n\t}\r\n\tloadInstrument = async (name) => {\r\n\t\tthis.state.instrument?.delete?.()\r\n\t\tlet newInstrument = new Instrument(name)\r\n\t\tthis.setState({ isLoadingInstrument: true })\r\n\t\tawait newInstrument.load()\r\n\t\tif(!this.mounted) return \r\n\t\tnewInstrument.connect(this.audioContext.destination)\r\n\t\tthis.setState({\r\n\t\t\tinstrument: newInstrument,\r\n\t\t\tisLoadingInstrument: false\r\n\t\t}, () => this.toggleReverbNodes(this.state.settings.caveMode.value))\r\n\t}\r\n\tloadReverb() {\r\n\t\treturn new Promise(resolve => {\r\n\t\t\tfetch(\"./assets/audio/reverb4.wav\")\r\n\t\t\t\t.then(r => r.arrayBuffer())\r\n\t\t\t\t.then(b => {\r\n\t\t\t\t\tif(!this.mounted) return\r\n\t\t\t\t\tthis.audioContext.decodeAudioData(b, (impulse_response) => {\r\n\t\t\t\t\t\tif(!this.mounted) return\r\n\t\t\t\t\t\tlet convolver = this.audioContext.createConvolver()\r\n\t\t\t\t\t\tlet gainNode = this.audioContext.createGain()\r\n\t\t\t\t\t\tgainNode.gain.value = 2.5\r\n\t\t\t\t\t\tconvolver.buffer = impulse_response\r\n\t\t\t\t\t\tconvolver.connect(gainNode)\r\n\t\t\t\t\t\tgainNode.connect(this.audioContext.destination)\r\n\t\t\t\t\t\tthis.reverbVolumeNode = gainNode\r\n\t\t\t\t\t\tthis.reverbNode = convolver\r\n\t\t\t\t\t\tresolve()\r\n\t\t\t\t\t})\r\n\t\t\t\t}).catch((e) => {\r\n\t\t\t\t\tconsole.log(\"Error with reverb\", e)\r\n\t\t\t\t})\r\n\t\t})\r\n\r\n\t}\r\n\tplaySound = (note) => {\r\n\t\tconst { state } = this\r\n\t\tconst { settings } = state\r\n\t\tif (note === undefined) return\r\n\t\tif (state.isRecording) this.handleRecording(note)\r\n\t\tthis.state.instrument.play(note.index, getPitchChanger(settings.pitch.value))\r\n\t}\r\n\tupdateSettings = (override) => {\r\n\t\tlet state\r\n\t\tif (override !== undefined) {\r\n\t\t\tstate = override\r\n\t\t} else {\r\n\t\t\tstate = this.state.settings\r\n\t\t}\r\n\t\tlocalStorage.setItem(appName + \"_Main_Settings\", JSON.stringify(state))\r\n\t}\r\n\thandleSettingChange = (setting) => {\r\n\t\tlet settings = this.state.settings\r\n\t\tlet data = setting.data\r\n\t\tsettings[setting.key].value = data.value\r\n\t\tif (setting.key === \"instrument\") {\r\n\t\t\tthis.loadInstrument(data.value)\r\n\t\t}\r\n\t\tif (setting.key === 'caveMode') {\r\n\t\t\tthis.toggleReverbNodes(data.value)\r\n\t\t}\r\n\t\tthis.setState({\r\n\t\t\tsettings: settings,\r\n\t\t}, this.updateSettings)\r\n\t}\r\n\tsyncSongs = async () => {\r\n\t\tlet songs = await this.dbCol.songs.find().toArray()\r\n\t\tthis.setState({\r\n\t\t\tsongs: songs\r\n\t\t})\r\n\t}\r\n\r\n\tsongExists = async (name) => {\r\n\t\treturn await this.dbCol.songs.findOne({ name: name }) !== undefined\r\n\t}\r\n\taddSong = async (song) => {\r\n\t\ttry {\r\n\t\t\tif (await this.songExists(song.name)) {\r\n\t\t\t\treturn new LoggerEvent(\"Warning\", \"A song with this name already exists! \\n\" + song.name).trigger()\r\n\t\t\t}\r\n\t\t\tawait this.dbCol.songs.insert(song)\r\n\t\t\tthis.syncSongs()\r\n\t\t\tnew LoggerEvent(\"Success\", `Song added to the ${song.data.isComposedVersion ? \"Composed\" : \"Recorded\"} tab!`, 4000).trigger()\r\n\t\t} catch (e) {\r\n\t\t\tconsole.error(e)\r\n\t\t\treturn new LoggerEvent(\"Error\", 'There was an error importing the song').trigger()\r\n\t\t}\r\n\r\n\t}\r\n\tcomponentDidCatch() {\r\n\t\tnew LoggerEvent(\"Warning\", \"There was an error with the song! Restoring default...\").trigger()\r\n\t\tsongStore.data = {\r\n\t\t\tsong: {}, eventType: 'stop', start: 0\r\n\t\t}\r\n\t}\r\n\tremoveSong = async (name) => {\r\n\t\tlet result = await asyncConfirm(`Are you sure you want to delete the song: \"${name}\" ?`)\r\n\t\tif (result) {\r\n\t\t\tthis.dbCol.songs.remove({ name: name }, this.syncSongs)\r\n\t\t}\r\n\t}\r\n\thandleRecording = (note) => {\r\n\t\tif (this.state.isRecording) {\r\n\t\t\tthis.recording.addNote(note.index)\r\n\t\t}\r\n\t}\r\n\taskForSongName = () => {\r\n\t\treturn new Promise(async resolve => {\r\n\t\t\tlet promptString = \"Write song name, press cancel to ignore\"\r\n\t\t\twhile (true) {\r\n\t\t\t\tlet songName = await asyncPrompt(promptString)\r\n\t\t\t\tif (songName === null) return resolve(null)\r\n\t\t\t\tif (songName !== \"\") {\r\n\t\t\t\t\tif (await this.songExists(songName)) {\r\n\t\t\t\t\t\tpromptString = \"This song already exists: \" + songName\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\treturn resolve(songName)\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tpromptString = \"Write song name, press cancel to ignore\"\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t})\r\n\r\n\t}\r\n\ttoggleRecord = async (override) => {\r\n\t\tif (typeof override !== \"boolean\") override = undefined\r\n\t\tlet newState = override !== undefined ? override : !this.state.isRecording\r\n\t\tif (!newState && this.recording.notes.length > 0) { //if there was a song recording\r\n\t\t\tlet songName = await this.askForSongName()\r\n\t\t\tlet song = new Song(songName, this.recording.notes)\r\n\t\t\tsong.pitch = this.state.settings.pitch.value\r\n\t\t\tif (songName !== null) this.addSong(song)\r\n\t\t} else {\r\n\t\t\tthis.recording = new Recording()\r\n\t\t}\r\n\t\tthis.state.isRecording = newState\r\n\t\tthis.setState({\r\n\t\t\topen: this.state.isRecording\r\n\t\t})\r\n\t}\r\n\ttoggleRecordAudio = async (override) => {\r\n\t\tif(!this.mounted) return\r\n\t\tif (typeof override !== \"boolean\") override = undefined\r\n\t\tconst { instrument } = this.state\r\n\t\tconst { recorder } = this\r\n\t\tconst hasReverb = this.state.settings.caveMode.value\r\n\t\tconst newState = override !== undefined ? override : !this.state.isRecordingAudio\r\n\t\tif (newState) {\r\n\t\t\tif (hasReverb) {\r\n\t\t\t\tthis.reverbVolumeNode.connect(recorder.node)\r\n\t\t\t} else {\r\n\t\t\t\tinstrument.connect(recorder.node)\r\n\t\t\t}\r\n\t\t\trecorder.start()\r\n\t\t} else {\r\n\t\t\tlet recording = await recorder.stop()\r\n\t\t\tlet fileName = await asyncPrompt(\"Write the song name, press cancel to ignore\")\r\n\t\t\tif (fileName) recorder.download(recording.data, fileName + '.wav')\r\n\t\t\tthis.toggleReverbNodes(hasReverb)\r\n\t\t\tthis.reverbVolumeNode.disconnect()\r\n\t\t\tthis.reverbVolumeNode.connect(audioContext.destination)\r\n\r\n\t\t}\r\n\t\tthis.setState({\r\n\t\t\tisRecordingAudio: newState\r\n\t\t})\r\n\t}\r\n\trender() {\r\n\t\tconst { state } = this\r\n\t\tlet keyboardFunctions = {\r\n\t\t\tchangeSliderState: this.changeSliderState,\r\n\t\t\tplaySound: this.playSound,\r\n\t\t\tsetHasSong: this.setHasSong\r\n\t\t}\r\n\t\tlet keyboardData = {\r\n\t\t\tisLoading: state.isLoadingInstrument,\r\n\t\t\tkeyboard: state.instrument,\r\n\t\t\tpitch: state.settings.pitch.value,\r\n\t\t\tkeyboardSize: state.settings.keyboardSize.value,\r\n\t\t\tnoteNameType: state.settings.noteNameType.value,\r\n\t\t\thasSong: state.thereIsSong,\r\n\t\t\thasAnimation: state.settings.noteAnimation.value,\r\n\t\t\tapproachRate: state.settings.approachSpeed.value\r\n\t\t}\r\n\t\tlet menuFunctions = {\r\n\t\t\taddSong: this.addSong,\r\n\t\t\tremoveSong: this.removeSong,\r\n\t\t\tchangePage: this.props.changePage,\r\n\t\t\thandleSettingChange: this.handleSettingChange,\r\n\t\t\tchangeVolume: this.changeVolume\r\n\t\t}\r\n\t\tlet menuData = {\r\n\t\t\tsongs: state.songs,\r\n\t\t\tsettings: state.settings\r\n\t\t}\r\n\r\n\t\treturn <div className='app bg-image' style={{ backgroundImage: `url(${state.settings.backgroundImage.value})` }}>\r\n\t\t\t{songStore.data.eventType !== 'approaching' &&\r\n\t\t\t\t<div className='record-button'>\r\n\t\t\t\t\t<AppButton\r\n\t\t\t\t\t\tactive={state.isRecordingAudio}\r\n\t\t\t\t\t\tclick={this.toggleRecordAudio}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t{state.isRecordingAudio ? \"Finish recording\" : \"Record audio\"}\r\n\t\t\t\t\t</AppButton>\r\n\t\t\t\t</div>\r\n\t\t\t}\r\n\r\n\t\t\t{state.isDragging && <div className='drag-n-drop'>\r\n\t\t\t\tDrop file here\r\n\t\t\t</div>}\r\n\t\t\t<Menu functions={menuFunctions} data={menuData} />\r\n\t\t\t<div className=\"right-panel\">\r\n\t\t\t\t<div className=\"upper-right\">\r\n\t\t\t\t\t{!this.state.thereIsSong\r\n\t\t\t\t\t\t&&\r\n\t\t\t\t\t\t<AppButton\r\n\t\t\t\t\t\t\tactive={state.isRecording}\r\n\t\t\t\t\t\t\tclick={this.toggleRecord}\r\n\t\t\t\t\t\t\tstyle={{marginTop: \"0.8rem\"}}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t{state.isRecording ? \"Stop\" : \"Record\"}\r\n\t\t\t\t\t\t</AppButton>\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"keyboard-wrapper\" style={{marginBottom: '2vh'}}>\r\n\t\t\t\t\t<Keyboard\r\n\t\t\t\t\t\tkey={state.instrument.instrumentName}\r\n\t\t\t\t\t\tdata={keyboardData}\r\n\t\t\t\t\t\tfunctions={keyboardFunctions}\r\n\t\t\t\t\t/>\r\n\t\t\t\t</div>\r\n\r\n\t\t\t</div>\r\n\t\t</div>\r\n\r\n\r\n\t}\r\n}\r\n\r\n\r\nfunction setIfInTWA() {\r\n\tif (isTwa()) return console.log('inTWA')\r\n\tlet isInTwa = document.referrer.includes('android-app://')\r\n\tsessionStorage.setItem('isTwa', isInTwa)\r\n}\r\nsetIfInTWA()\r\nfunction AppButton(props) {\r\n\tlet className = \"genshin-button \" + (props.active ? \"selected\" : \"\")\r\n\treturn <button className={className} onClick={props.click} style={{ ...(props.style || {}) }}>\r\n\t\t{props.children}\r\n\t</button>\r\n}\r\nexport default App;\r\n","export default __webpack_public_path__ + \"static/media/addCell.73b6c8e9.svg\";","export default __webpack_public_path__ + \"static/media/removeCell.e266ba1a.svg\";","import { useState, useEffect } from 'react';\r\nfunction useDebounce(value, delay) {\r\n  // State and setters for debounced value\r\n  const [debouncedValue, setDebouncedValue] = useState(value);\r\n  useEffect(\r\n    () => {\r\n      const handler = setTimeout(() => {\r\n        setDebouncedValue(value);\r\n      }, delay);\r\n      return () => {\r\n        clearTimeout(handler);\r\n      };\r\n    },\r\n    [value, delay]\r\n  );\r\n  return debouncedValue;\r\n}\r\nexport default useDebounce;","import React, { Component, useEffect, useState } from 'react'\r\nimport { FilePicker } from \"react-file-picker\"\r\nimport { Midi } from '@tonejs/midi'\r\nimport { LoggerEvent, pitchArr, ColumnNote, Column, numberToLayer, ComposedSong, groupByIndex, mergeLayers } from 'lib/SongUtils'\r\nimport { appName } from 'appConfig'\r\nimport { FaInfoCircle } from 'react-icons/fa'\r\nimport useDebounce from './useDebounce'\r\nclass MidiImport extends Component {\r\n    constructor(props) {\r\n        super(props)\r\n        this.state = {\r\n            fileName: '',\r\n            midi: null,\r\n            bpm: 220,\r\n            offset: 0,\r\n            pitch: 'C',\r\n            accidentals: 0,\r\n            outOfRange: 0,\r\n            totalNotes: 0,\r\n            includeAccidentals: true\r\n        }\r\n    }\r\n    handleFile = (file) => {\r\n        const reader = new FileReader();\r\n        reader.addEventListener('load', (event) => {\r\n            let midi\r\n            try {\r\n                midi = new Midi(event.target.result)\r\n            } catch (e) {\r\n                console.error(e)\r\n            }\r\n            if (!midi) return new LoggerEvent('Error', 'There was an error importing this file', 2000).trigger()\r\n            let bpm = midi.header.tempos[0]?.bpm\r\n            let key = midi.header.keySignatures[0]?.key\r\n            midi.tracks.forEach((track, i) => {\r\n                track.selected = true\r\n                track.layer = 0\r\n                track.name = track.name || `Track n.${i + 1}`\r\n                track.numberOfAccidentals = 0\r\n                track.numberOfOutOfRange = 0\r\n            })\r\n            this.setState({\r\n                midi: midi,\r\n                fileName: file.name,\r\n                bpm: Math.floor(bpm * 4) || 220,\r\n                offset: 0,\r\n                pitch: pitchArr.includes(key) ? key : 'C',\r\n            }, () => { if (this.state.midi !== null) this.convertMidi()})\r\n        })\r\n        reader.readAsArrayBuffer(file)\r\n    }\r\n\r\n    convertMidi = () => {\r\n        const { midi, bpm, offset, includeAccidentals,pitch } = this.state\r\n        let tracks = midi.tracks.filter(track => track.selected)\r\n        let notes = []\r\n        let numberOfAccidentals = 0\r\n        let outOfRange = 0\r\n        let totalNotes = 0\r\n        tracks.forEach(track => {\r\n            track.numberOfAccidentals = 0\r\n            track.numberOfOutOfRange = 0\r\n            track.notes.forEach(midiNote => {\r\n                totalNotes++\r\n                let convertedNote = convertMidiNote(midiNote.midi - offset)\r\n                let note = {\r\n                    time: Math.floor(midiNote.time * 1000),\r\n                    note: convertedNote.note,\r\n                    layer: track.layer\r\n                }\r\n                if(convertedNote.isAccidental){\r\n                    numberOfAccidentals ++\r\n                    track.numberOfAccidentals ++\r\n                }\r\n                if (note.note !== null) {\r\n                    if (includeAccidentals || !convertedNote.isAccidental) {\r\n                        notes.push(note)\r\n                    }\r\n                } else {\r\n                    outOfRange++\r\n                    track.numberOfOutOfRange ++\r\n                }\r\n            })\r\n        })\r\n        notes = notes.sort((a, b) => a.time - b.time)\r\n        let bpmToMs = Math.floor(60000 / bpm)\r\n        let groupedNotes = []\r\n        while (notes.length > 0) {\r\n            let row = [notes.shift()]\r\n            let amount = 0\r\n            for (let i = 0; i < notes.length; i++) {\r\n                if (row[0].time > notes[i].time - bpmToMs / 9) amount++\r\n            }\r\n            groupedNotes.push([...row, ...notes.splice(0, amount)])\r\n        }\r\n        let columns = []\r\n        let previousTime = 0\r\n        groupedNotes.forEach(notes => {\r\n            let note = notes[0]\r\n            if (!note) return\r\n            let elapsedTime = note.time - previousTime\r\n            previousTime = note.time\r\n            let emptyColumns = Math.floor((elapsedTime - bpmToMs) / bpmToMs)\r\n            if (emptyColumns > -1) new Array(emptyColumns).fill(0).forEach(() => columns.push(new Column())) // adds empty columns\r\n            let noteColumn = new Column()\r\n            noteColumn.notes = notes.map(note => {\r\n                return new ColumnNote(note.note, numberToLayer(note.layer))\r\n            })\r\n            columns.push(noteColumn)\r\n        })\r\n        columns.forEach(column => { //merges notes of different layer\r\n            let groupedNotes = groupByIndex(column)\r\n            column.notes = groupedNotes.map(group => {\r\n                group[0].layer = mergeLayers(group)\r\n                return group[0]\r\n            })\r\n        })\r\n        let song = new ComposedSong(\"Untitled\")\r\n        song.columns = columns\r\n        song.bpm = bpm\r\n        song.instruments = this.props.data.instruments\r\n        song.pitch = pitch\r\n        let lastColumn = this.props.data.selectedColumn\r\n        song.selected = lastColumn < song.columns.length ? lastColumn : 0\r\n        if (song.columns.length === 0) {\r\n            return new LoggerEvent(\"Error\", \"There are no notes\", 2000).trigger()\r\n        }\r\n        this.props.functions.loadSong(song)\r\n        this.setState({\r\n            accidentals: numberOfAccidentals,\r\n            totalNotes: totalNotes,\r\n            outOfRange: outOfRange\r\n        })\r\n    }\r\n\r\n    editTrack = (command, data) => {\r\n        let tracks = this.state.midi.tracks\r\n        if (command === 'index') {\r\n\r\n            tracks[data.index].selected = !tracks[data.index].selected\r\n        }\r\n        if (command === 'layer') {\r\n            tracks[data.index].layer = data.layer\r\n        }\r\n\r\n        this.setState({\r\n            midi: this.state.midi\r\n        }, () => { if (this.state.midi !== null) this.convertMidi() })\r\n    }\r\n    changeOffset = (value) => {\r\n        value = parseInt(value)\r\n        if (!Number.isInteger(value)) value = 0\r\n        if(this.state.offset === value) return\r\n        this.setState({\r\n            offset: value\r\n        }, () => { if (this.state.midi !== null) this.convertMidi() })\r\n    }\r\n    changePitch = (value) => {\r\n        this.props.functions.changePitch(value)\r\n        this.setState({\r\n            pitch: value\r\n        })\r\n    }\r\n    toggleAccidentals = () => {\r\n        this.setState({\r\n            includeAccidentals: !this.state.includeAccidentals\r\n        }, () => { if (this.state.midi !== null) this.convertMidi() })\r\n    }\r\n    changeBpm = (value) => {\r\n        value = parseInt(value)\r\n        if (!Number.isInteger(value)) value = 0\r\n        if(this.state.bpm === value) return\r\n        this.setState({\r\n            bpm: value\r\n        }, () => { if (this.state.midi !== null) this.convertMidi() })\r\n    }\r\n    render() {\r\n        const { handleFile, editTrack, state, changeBpm, changeOffset, changePitch } = this\r\n        const { fileName, midi, bpm, offset, pitch, accidentals, outOfRange, totalNotes, includeAccidentals } = state\r\n        const { functions } = this.props\r\n        const { changeMidiVisibility } = functions\r\n        return <div className='floating-midi'>\r\n            <div\r\n                className='midi-row separator-border'\r\n                style={{ width: '100%' }}\r\n            >\r\n                <FilePicker onChange={handleFile}>\r\n                    <button className=\"midi-btn\">\r\n                        Click to load midi file\r\n                    </button>\r\n                </FilePicker>\r\n                <div style={{ margin: '0 0.5rem', maxWidth: '8rem', textOverflow: 'ellipsis', overflow: 'hidden' }}>\r\n                    {fileName}\r\n                </div>\r\n                <button\r\n                    className='midi-btn'\r\n                    style={{ marginLeft: 'auto' }}\r\n                    onClick={() => changeMidiVisibility(false)}\r\n                >\r\n                    Close\r\n                </button>\r\n            </div>\r\n            <table className='separator-border' style={{ width: \"100%\" }}>\r\n                <tr>\r\n                    <td>\r\n                        <div style={{ marginRight: '0.5rem' }}>Bpm:</div>\r\n                    </td>\r\n                    <td style={{ display: 'flex', justifyContent: 'flex-end', alignItems:\"center\" }}>\r\n                    <NumberInput\r\n                            value={bpm}\r\n                            changeValue={changeBpm}\r\n                            delay={600}\r\n                            step={5}\r\n                        />\r\n                    </td>\r\n                </tr>\r\n                <tr>\r\n                    <td>\r\n                        <div style={{ marginRight: '0.5rem' }}>Scale notes by: </div>\r\n                    </td>\r\n                    <td>\r\n                        <NumberInput\r\n                            value={offset}\r\n                            changeValue={changeOffset}\r\n                            delay={600}\r\n                            step={1}\r\n                        />\r\n                    </td>\r\n                </tr>\r\n                <tr>\r\n                    <td>\r\n                        <div style={{ marginRight: '0.5rem' }}>Pitch:</div>\r\n                    </td>\r\n                    <td style={{ display: 'flex', justifyContent: 'flex-end', alignItems:\"center\" }}>\r\n                        <select\r\n                            className='midi-select'\r\n                            value={pitch}\r\n                            onChange={(event) => changePitch(event.target.value)}\r\n                            style={{ backgroundColor: '#576377', width: '5rem' }}\r\n                        >\r\n                            <option value=\"C\">C</option>\r\n                            <option value=\"Db\">Db</option>\r\n                            <option value=\"D\">D</option>\r\n                            <option value=\"Eb\">Eb</option>\r\n                            <option value=\"E\">E</option>\r\n                            <option value=\"F\">F</option>\r\n                            <option value=\"Gb\">Gb</option>\r\n                            <option value=\"G\">G</option>\r\n                            <option value=\"Ab\">Ab</option>\r\n                            <option value=\"A\">A</option>\r\n                            <option value=\"Bb\">Bb</option>\r\n                            <option value=\"B\">B</option>\r\n                        </select>\r\n                    </td>\r\n                </tr>\r\n                <tr>\r\n                    <td>\r\n                        <div style={{ marginRight: '0.5rem' }}>Include accidentals:</div>\r\n                    </td>\r\n                    <td style={{ display: 'flex', justifyContent: 'flex-end' }}>\r\n                        <input type='checkbox'\r\n                            checked={includeAccidentals}\r\n                            onChange={this.toggleAccidentals}\r\n                        />\r\n                    </td>\r\n                </tr>\r\n            </table>\r\n            {midi !== null && <div className='midi-column separator-border' style={{ width: '100%' }}>\r\n                <div className='midi-column' style={{ width: '100%' }}>\r\n                    <div>Select midi tracks</div>\r\n                    {midi?.tracks.map((track, i) =>\r\n                        <Track\r\n                            data={track}\r\n                            key={i}\r\n                            index={i}\r\n                            editTrack={editTrack}\r\n                        />\r\n                    )}\r\n                </div>\r\n            </div>\r\n            }\r\n            {midi !== null && <table>\r\n                <tr>\r\n                    <td>Total notes: </td>\r\n                    <td />\r\n                    <td>{totalNotes}</td>\r\n                </tr>\r\n                <tr>\r\n                    <td>Accidentals: </td>\r\n                    <td />\r\n                    <td>{accidentals}</td>\r\n                </tr>\r\n                <tr>\r\n                    <td>Out of range: </td>\r\n                    <td />\r\n                    <td>{outOfRange}</td>\r\n                </tr>\r\n            </table>\r\n            }\r\n        </div>\r\n    }\r\n}\r\n\r\nfunction Track(props) {\r\n    const { data, index, editTrack } = props\r\n    const [dataShown, setDataShown] = useState(false)\r\n    return <div className='midi-track-column'>\r\n        <div className='midi-track-wrapper'>\r\n            <div className='midi-track-center'>\r\n                <input type='checkbox' onChange={() => editTrack(\"index\", { index: index })} checked={data.selected} />\r\n                {data.name} ({data.notes.length})\r\n            </div>\r\n            <div className='midi-track-center'>\r\n                <div style={{ textAlign: 'center' }}>\r\n                    {data.instrument.family}\r\n                </div>\r\n                <select\r\n                    onChange={(event) => editTrack('layer', { index: index, layer: Number(event.target.value) })}\r\n                    value={data.layer}\r\n                    className='midi-select'\r\n                >\r\n                    <option value='0'>Layer 1</option>\r\n                    <option value='1'>Layer 2</option>\r\n                    <option value='2'>Layer 3</option>\r\n                </select>\r\n\r\n                <FaInfoCircle\r\n                    size={22}\r\n                    color={dataShown ? \"rgb(207, 122, 130)\" : \"white\"}\r\n                    onClick={() => setDataShown(!dataShown)}\r\n                    cursor='pointer'\r\n                />\r\n            </div>\r\n\r\n        </div>\r\n        <div className='midi-track-data' style={{ display: dataShown ? \"flex\" : \"none\" }}>\r\n            <div className='midi-track-data-row'>\r\n                <div>Instrument:</div>\r\n                <div>{data.instrument.name}</div>\r\n            </div>\r\n            <div className='midi-track-data-row'>\r\n                <div>Number of notes:</div>\r\n                <div>{data.notes.length}</div>\r\n            </div>\r\n            <div className='midi-track-data-row'>\r\n                <div>Accidentals:</div>\r\n                <div>{data.numberOfAccidentals}</div>\r\n            </div>\r\n            <div className='midi-track-data-row'>\r\n                <div>Out of range:</div>\r\n                <div>{data.numberOfOutOfRange}</div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n}\r\n\r\nexport default MidiImport\r\n\r\nfunction NumberInput(props) {\r\n    const { changeValue, value, delay = 500, step = 1 } = props\r\n    const [elementValue, setElementValue] = useState(value)\r\n    const debounced = useDebounce(elementValue, delay) \r\n    useEffect(() => {\r\n        changeValue(debounced)\r\n        // eslint-disable-next-line react-hooks/exhaustive-deps\r\n    }, [debounced]);\r\n    useEffect(() => {\r\n        setElementValue(value)\r\n    }, [value])\r\n    return <div style={{ display: 'flex', justifyContent: 'flex-end' }} >\r\n        <button\r\n            onClick={() => setElementValue(elementValue - step)}\r\n            className='midi-btn-small'\r\n        >-</button>\r\n        <input\r\n            type=\"text\"\r\n            value={elementValue}\r\n            onChange={(e) => setElementValue(e.target.value)}\r\n            className='midi-input'\r\n            style={{ margin: '0 0.3rem' }}\r\n        />\r\n        <button\r\n            onClick={() => setElementValue(elementValue + step)}\r\n            className='midi-btn-small'\r\n        >+</button>\r\n    </div>\r\n}\r\n\r\nfunction convertMidiNote(midiNote) {\r\n    let note = null\r\n    let isAccidental = false\r\n    if (appName === 'Sky') {\r\n        switch (midiNote) {\r\n            case 60: note = 0; break;\r\n            case 61: note = 0; isAccidental = true; break;\r\n            case 62: note = 1; break;\r\n            case 63: note = 1; isAccidental = true; break;\r\n            case 64: note = 2; break;\r\n            case 65: note = 3; break;\r\n            case 66: note = 3; isAccidental = true; break;\r\n            case 67: note = 4; break;\r\n            case 68: note = 4; isAccidental = true; break;\r\n            case 69: note = 5; break;\r\n            case 70: note = 5; isAccidental = true; break;\r\n            case 71: note = 6; break;\r\n            case 72: note = 7; break;\r\n            case 73: note = 7; isAccidental = true; break;\r\n            case 74: note = 8; break;\r\n            case 75: note = 8; isAccidental = true; break;\r\n            case 76: note = 9; break;\r\n            case 77: note = 10; break;\r\n            case 78: note = 10; isAccidental = true; break;\r\n            case 79: note = 11; break;\r\n            case 80: note = 11; isAccidental = true; break;\r\n            case 81: note = 12; break;\r\n            case 82: note = 12; isAccidental = true; break;\r\n            case 83: note = 13; break;\r\n            case 84: note = 14; break;\r\n            default: note = null;\r\n        }\r\n    }\r\n    if (appName === 'Genshin') {\r\n        switch (midiNote) {\r\n            case 48: note = 14; break;\r\n            case 49: note = 14; isAccidental = true; break;\r\n            case 50: note = 15; break;\r\n            case 51: note = 15; isAccidental = true; break;\r\n            case 52: note = 16; break;\r\n            case 53: note = 17; break;\r\n            case 54: note = 17; isAccidental = true; break;\r\n            case 55: note = 18; break;\r\n            case 56: note = 18; isAccidental = true; break;\r\n            case 57: note = 19; break;\r\n            case 58: note = 19; isAccidental = true; break;\r\n            case 59: note = 20; break;\r\n            case 60: note = 7; break;\r\n            case 61: note = 7; isAccidental = true; break;\r\n            case 62: note = 8; break;\r\n            case 63: note = 8; isAccidental = true; break;\r\n            case 64: note = 9; break;\r\n            case 65: note = 10; break;\r\n            case 66: note = 10; isAccidental = true; break;\r\n            case 67: note = 11; break;\r\n            case 68: note = 11; isAccidental = true; break;\r\n            case 69: note = 12; break;\r\n            case 70: note = 12; isAccidental = true; break;\r\n            case 71: note = 13; break;\r\n            case 72: note = 0; break;\r\n            case 73: note = 0; isAccidental = true; break;\r\n            case 74: note = 1; break;\r\n            case 75: note = 1; isAccidental = true; break;\r\n            case 76: note = 2; break;\r\n            case 77: note = 3; break;\r\n            case 78: note = 3; isAccidental = true; break;\r\n            case 79: note = 4; break;\r\n            case 80: note = 4; isAccidental = true; break;\r\n            case 81: note = 5; break;\r\n            case 82: note = 5; isAccidental = true; break;\r\n            case 83: note = 6; break;\r\n            default: note = null;\r\n        }\r\n    }\r\n    return {\r\n        note: note,\r\n        isAccidental: isAccidental\r\n    }\r\n}","import React, { Component } from 'react'\r\n\r\nclass ComposerTools extends Component {\r\n    constructor(props) {\r\n        super(props)\r\n        this.state = {\r\n\r\n        }\r\n    }\r\n\r\n    render() {\r\n        const { data, functions } = this.props\r\n        let className = data.visible ? \"floating-tools tools-visible\" : \"floating-tools\"\r\n        return <div className={className}>\r\n            <div className=\"tools-row\">\r\n                <div>\r\n                    Scroll to the left / right to select the columns\r\n                </div>\r\n                <button onClick={functions.toggleTools}>\r\n                    Close\r\n                </button>\r\n            </div>\r\n            <div className=\"tools-buttons-wrapper\">\r\n                <div className='tools-half'>\r\n                    <button\r\n                        disabled={data.copiedColumns.length !== 0}\r\n                        onClick={(e) => { \r\n                            e.currentTarget.blur()\r\n                            functions.copyColumns('all')\r\n                        }}\r\n                        className={data.copiedColumns.length !== 0 ? \"tools-button-highlighted\" : \"\"}\r\n                    >\r\n                        Copy\r\n                    </button>\r\n                    <button\r\n                        disabled={data.copiedColumns.length !== 0}\r\n                        onClick={(e) => { \r\n                            e.currentTarget.blur()\r\n                            functions.copyColumns(data.layer)\r\n                        }}\r\n                        className={data.copiedColumns.length !== 0 ? \"tools-button-highlighted\" : \"\"}\r\n                    >\r\n                        Copy layer {data.layer}\r\n                    </button>\r\n                </div>\r\n                <div className='tools-half'>\r\n                    <button\r\n                        disabled={data.copiedColumns.length === 0}\r\n                        onClick={(e) => { \r\n                            e.currentTarget.blur()\r\n                            functions.pasteColumns(false)\r\n                        }}\r\n                    >\r\n                        Paste\r\n                </button>\r\n                    <button\r\n                        disabled={data.copiedColumns.length === 0}\r\n                        onClick={(e) => { \r\n                            e.currentTarget.blur()\r\n                            functions.pasteColumns(true)\r\n                        }}\r\n                    >\r\n                        Insert\r\n                </button>\r\n                </div>\r\n                <div className='tools-half'>\r\n                    <button\r\n                        disabled={data.copiedColumns.length !== 0}\r\n                        onClick={(e) => { \r\n                            e.currentTarget.blur()\r\n                            functions.eraseColumns('all')\r\n                        }}\r\n                    >\r\n                        Erase\r\n                    </button>\r\n                    <button\r\n                        disabled={data.copiedColumns.length !== 0}\r\n                        onClick={(e) => { \r\n                            e.currentTarget.blur()\r\n                            functions.eraseColumns(data.layer)\r\n                        }}\r\n                    >\r\n                        Erase layer {data.layer}\r\n                    </button>\r\n                </div>\r\n\r\n                <button\r\n                    disabled={data.copiedColumns.length !== 0}\r\n                    onClick={functions.deleteColumns}\r\n                >\r\n                    Delete\r\n                </button>\r\n            </div>\r\n        </div>\r\n    }\r\n}\r\n\r\n\r\n\r\nexport default ComposerTools","import React, { Component } from 'react'\r\nimport { cssClasses, appName , instrumentsData} from \"appConfig\" \r\nclass ComposerNote extends Component {\r\n    constructor(props) {\r\n        super(props)\r\n        this.state = {\r\n\r\n        }\r\n    }\r\n    shouldComponentUpdate(next, prev) {\r\n        let canRender = false\r\n        canRender = canRender ||this.props.layers !== next.layers || this.props.noteText !== next.noteText\r\n        canRender = canRender || this.props.instrument !== next.instrument\r\n        return canRender\r\n    }\r\n    render() {\r\n        const {props} = this\r\n        const { data, layers,instrument } = props\r\n        let className = cssClasses.noteComposer\r\n        if (layers[0] === \"1\") className += \" layer-1\"\r\n        if (layers[1] === \"1\") className += \" layer-2\"\r\n        if (layers[2] === \"1\") className += \" layer-3\"\r\n        let layer3Class = \"Sky\" ? \"layer-3-ball-bigger\" : \"layer-3-ball\"\r\n        let effects = instrumentsData[instrument]?.effects || {}\r\n        return <button onPointerDown={() => this.props.clickAction(data)} className=\"button-hitbox\">\r\n            <div className={className} >\r\n                <img\r\n                    draggable=\"false\"\r\n                    alt={data.noteNames.mobile}\r\n                    src={props.noteImage}\r\n                    style={effects}\r\n                >\r\n                  \r\n                </img>\r\n                <div className={layer3Class}>\r\n                </div>\r\n                <div className={appName === \"Sky\" ? \"note-name-sky\" : \"note-name\"}>\r\n                    {props.noteText}\r\n                </div>\r\n            </div>\r\n        </button>\r\n    }\r\n}\r\n\r\n\r\n\r\nexport default ComposerNote","import React, { Component } from 'react'\r\n\r\nclass MultiSwitch extends Component {\r\n    constructor(props) {\r\n        super(props)\r\n        this.state = {\r\n\r\n        }\r\n    }\r\n\r\n    render() {\r\n        let props = this.props\r\n        return <>\r\n            {props.options.map(e => {\r\n                return <button\r\n                    style={{ backgroundColor: e === props.selected ? props.selectedColor : \"\" }}\r\n                    className={props.buttonsClass}\r\n                    onClick={() => props.onSelect(e)}\r\n                    key={e}\r\n                >\r\n                    {e}\r\n                </button>\r\n            })}\r\n        </>\r\n    }\r\n}\r\n\r\n\r\n\r\nexport default MultiSwitch\r\n\r\n","import React, { Component } from 'react'\r\nimport ComposerNote from \"./ComposerNote\"\r\nimport MultiSwitch from \"./MultiSwitch\"\r\nimport { appName, keyNames, pitchArr , layoutImages,layoutData } from \"appConfig\"\r\nclass ComposerKeyboard extends Component {\r\n    constructor(props) {\r\n        super(props)\r\n        this.state = {\r\n\r\n        }\r\n\r\n    }\r\n\r\n    render() {\r\n        const { data, functions } = this.props\r\n        let notesIndexes = data.currentColumn.notes.map((e) => e.index)\r\n        let hiddenSideMenu = data.isPlaying ? \" hidden\" : \"\"\r\n        let keyboardClass = \"keyboard\"\r\n        if (data.keyboard.layout.length === 15) keyboardClass += \" keyboard-5\"\r\n        if (data.keyboard.layout.length === 8) keyboardClass += \" keyboard-4\"\r\n        return <div>\r\n            <div className={keyboardClass}>\r\n            {data.keyboard.layout.length === 0 ? <div className=\"loading\">Loading...</div> : null}\r\n                {data.keyboard.layout.map((note, i) => {\r\n                    let index = notesIndexes.indexOf(i)\r\n                    let noteText = \"\"\r\n                    let noteImage = \"\"\r\n                    try{    \r\n                        noteImage = layoutImages[data.keyboard.layout.length][note.index]  \r\n                        if(data.noteNameType === \"Note name\") noteText = keyNames[appName][pitchArr.indexOf(data.pitch)][note.index]\r\n                        if(data.noteNameType === \"Keyboard layout\") noteText = layoutData[data.keyboard.layout.length].keyboardLayout[note.index]\r\n                        if(data.noteNameType === \"Do Re Mi\") noteText = layoutData[data.keyboard.layout.length].mobileLayout[note.index]\r\n                    }catch(e){}\r\n                    return <ComposerNote\r\n                        key={note.index}\r\n                        layers={index >= 0 ? data.currentColumn.notes[index].layer : \"000\"}\r\n                        data={note}\r\n                        noteText={noteText}\r\n                        instrument={data.keyboard.instrumentName}\r\n                        noteImage={`./assets/icons/keys/${noteImage}.svg`}\r\n                        clickAction={functions.handleClick}\r\n                    />\r\n                })}\r\n            </div>\r\n            <div className={\"bottom-right-wrapper\" + hiddenSideMenu}>\r\n                <div className={\"layer-buttons-wrapper\"}>\r\n                    <div className=\"bottom-right-text\">\r\n                        Layer\r\n                    </div>\r\n                    <MultiSwitch\r\n                        buttonsClass={\"layer-button\"}\r\n                        selectedColor={\"#63aea7\"}\r\n                        options={[1, 2, 3]}\r\n                        onSelect={functions.changeLayer}\r\n                        selected={data.layer}\r\n                    />\r\n                </div>\r\n                <div className=\"tempo-changers-wrapper\">\r\n                    <div className=\"bottom-right-text\">\r\n                        Tempo\r\n                    </div>\r\n                    {data.TempoChangers.map((e) => {\r\n                        return <button\r\n                            key={e.id}\r\n                            onClick={() => functions.handleTempoChanger(e)}\r\n                            style={{ backgroundColor: \"#\" + e.color.toString(16) }}\r\n                        >\r\n                            {e.text}\r\n                        </button>\r\n                    })}\r\n                </div>\r\n            </div>\r\n        </div>\r\n    }\r\n}\r\n\r\n\r\n\r\nexport default ComposerKeyboard","import { TempoChangers } from \"lib/SongUtils\"\r\nimport * as PIXI from \"pixi.js\"\r\nimport {notesPerColumn } from \"appConfig\"\r\nlet noteData = {\r\n    background: \"#d3bd8e\",\r\n    border: \"#de4545\",\r\n    center: \"#de4545\"\r\n}\r\n\r\nlet horizontalLineBreak = notesPerColumn / 3\r\nlet standards = [\r\n    {\r\n        color: 0x515c6f //lighter\r\n    },\r\n    {\r\n        color: 0x485363 //darker\r\n    },\r\n    {\r\n        color: 0x1a968b //selected\r\n    },\r\n    {\r\n        color: 0xd6722f\r\n    }\r\n]\r\nlet notes = [\"000\", \"001\", \"010\", \"011\", \"100\", \"101\", \"110\", \"111\"]\r\nlet breakpoints = [\r\n    {\r\n        type: \"short\",\r\n        color: \"#282875\"\r\n    },\r\n    {\r\n        type: \"long\",\r\n        color: \"#282875\"\r\n    }\r\n]\r\nclass ComposerCache {\r\n    constructor(width, height, margin = 4, timelineHeight = 30) {\r\n        this.width = width\r\n        this.height = height\r\n        this.cache = {\r\n            columns: [],\r\n            notes: {},\r\n            standard: [],\r\n            columnsLarger: [],\r\n            standardLarger: [],\r\n            breakpoints: []\r\n        }\r\n        this.notesFigures = []\r\n        this.timelineHeight = timelineHeight\r\n        this.margin = margin\r\n        this.noteWidth = this.width\r\n        this.noteHeight = this.height / notesPerColumn\r\n        this.app = new PIXI.Application({\r\n            width: width,\r\n            height: height,\r\n        })\r\n        this.generate()\r\n    }\r\n    destroy = () => {\r\n        this.app.destroy()\r\n    }\r\n    generate = () => {\r\n        TempoChangers.forEach(tempoChanger => {\r\n            let canvas = drawColumn(tempoChanger, this, 1)\r\n            this.cache.columns.push(canvas.toDataURL())\r\n        })\r\n        standards.forEach(standardColumn => {\r\n            let canvas = drawColumn(standardColumn, this, 1)\r\n            this.cache.standard.push(canvas.toDataURL())\r\n        })\r\n        standards.forEach(standardColumn => {\r\n            let canvas = drawColumn(standardColumn, this, 3)\r\n            this.cache.standardLarger.push(canvas.toDataURL())\r\n        })\r\n        notes.forEach(note => {\r\n            let roundNess = this.noteWidth > 20 ? 4 : 2\r\n            let canvas = document.createElement(\"canvas\")\r\n            canvas.height = this.noteHeight\r\n            canvas.width = this.noteWidth\r\n            let ctx = canvas.getContext(\"2d\")\r\n            if (note[0] === \"1\") {\r\n                ctx.fillStyle = noteData.background\r\n                roundRect(\r\n                    ctx,\r\n                    this.margin / 2,\r\n                    this.margin / 2,\r\n                    this.noteWidth - this.margin - 1,\r\n                    this.noteHeight - this.margin - 1,\r\n                    roundNess,\r\n                    true,\r\n                    false\r\n                )\r\n            }\r\n            if (note[1] === \"1\") {\r\n                ctx.strokeStyle = noteData.border\r\n                ctx.lineWidth = 2\r\n                roundRect(\r\n                    ctx,\r\n                    this.margin / 2,\r\n                    this.margin / 2,\r\n                    this.noteWidth - this.margin - 1,\r\n                    this.noteHeight - this.margin - 1,\r\n                    roundNess,\r\n                    false,\r\n                    true\r\n                )\r\n            }\r\n            if (note[2] === \"1\") {\r\n                ctx.beginPath()\r\n                ctx.fillStyle = noteData.center\r\n                let ballHeight = this.noteHeight / 4\r\n                ctx.arc(this.noteWidth / 2 - 0.5, this.noteHeight / 2 - 0.5, ballHeight, 0, 2 * Math.PI);\r\n                ctx.fill()\r\n            }\r\n            this.cache.notes[note] = canvas.toDataURL()\r\n        })\r\n        TempoChangers.forEach(tempoChanger => {\r\n            let canvas = drawColumn(tempoChanger, this, 2)\r\n            this.cache.columnsLarger.push(canvas.toDataURL())\r\n        })\r\n        breakpoints.forEach(breakpoint => {\r\n            let canvas = document.createElement(\"canvas\")\r\n            if (breakpoint.type === \"short\") {\r\n                let size = this.timelineHeight / 6\r\n                canvas.height = this.timelineHeight\r\n                canvas.width = size * 2\r\n                let ctx = canvas.getContext(\"2d\")\r\n                ctx.fillStyle = breakpoint.color\r\n                ctx.arc(size, this.timelineHeight / 2, size, 0, 2 * Math.PI);\r\n                ctx.fill()\r\n                this.cache.breakpoints.push(canvas.toDataURL())\r\n            } else {\r\n                canvas.height = this.height\r\n                canvas.width = this.width\r\n                let ctx = canvas.getContext(\"2d\")\r\n                ctx.fillStyle = breakpoint.color\r\n                /*\r\n               ctx.strokeStyle = breakpoint.color\r\n               ctx.lineWidth = 3\r\n                ctx.strokeRect(1,1,this.width - 3,this.height - 2)\r\n                */\r\n                ctx.beginPath();\r\n                ctx.moveTo(0, this.height)\r\n                ctx.lineTo(this.noteWidth / 2, this.height)\r\n                ctx.lineTo(0, this.height - this.noteHeight)\r\n                ctx.fill();\r\n                ctx.beginPath();\r\n                ctx.moveTo(this.width, this.height)\r\n                ctx.lineTo(this.noteWidth / 2, this.height)\r\n                ctx.lineTo(this.width, this.height - this.noteHeight)\r\n                ctx.fill();\r\n                ctx.beginPath();\r\n                ctx.moveTo(0, 0)\r\n                ctx.lineTo(this.noteWidth / 2, 0)\r\n                ctx.lineTo(0, this.noteHeight)\r\n                ctx.fill();\r\n                ctx.beginPath();\r\n                ctx.moveTo(this.width, 0)\r\n                ctx.lineTo(this.noteWidth / 2, 0)\r\n                ctx.lineTo(this.width, this.noteHeight)\r\n                ctx.fill();\r\n\r\n                this.cache.breakpoints.push(canvas.toDataURL())\r\n            }\r\n        })\r\n    }\r\n}\r\n\r\n\r\nfunction drawColumn(tempoChanger, self, borderWidth) {\r\n    let canvas = document.createElement(\"canvas\")\r\n    canvas.height = self.height\r\n    canvas.width = self.width\r\n    let ctx = canvas.getContext(\"2d\")\r\n    ctx.fillStyle = \"#\" + tempoChanger.color.toString(16)\r\n    ctx.fillRect(0, 0, self.width, self.height)\r\n    ctx.strokeStyle = borderWidth === 2 ? \"black\" : \"#333333\"\r\n    ctx.lineWidth = borderWidth\r\n    ctx.beginPath()\r\n    ctx.moveTo(self.width, 0)\r\n    ctx.lineTo(self.width, self.height)\r\n    ctx.stroke()\r\n    ctx.strokeStyle = \"#333333\"\r\n    for (let i = 1; i < 3; i++) {\r\n        ctx.lineWidth = 1\r\n        let y = self.noteHeight * horizontalLineBreak * i\r\n        ctx.moveTo(0, y)\r\n        ctx.lineTo(self.width, y)\r\n    }\r\n    ctx.stroke()\r\n    return canvas\r\n}\r\n\r\nfunction roundRect(ctx, x, y, width, height, radius, fill, stroke) {\r\n    if (typeof stroke === 'undefined') {\r\n        stroke = true;\r\n    }\r\n    if (typeof radius === 'undefined') {\r\n        radius = 5;\r\n    }\r\n    if (typeof radius === 'number') {\r\n        radius = { tl: radius, tr: radius, br: radius, bl: radius };\r\n    } else {\r\n        var defaultRadius = { tl: 0, tr: 0, br: 0, bl: 0 };\r\n        for (var side in defaultRadius) {\r\n            radius[side] = radius[side] || defaultRadius[side];\r\n        }\r\n    }\r\n    ctx.beginPath();\r\n    ctx.moveTo(x + radius.tl, y);\r\n    ctx.lineTo(x + width - radius.tr, y);\r\n    ctx.quadraticCurveTo(x + width, y, x + width, y + radius.tr);\r\n    ctx.lineTo(x + width, y + height - radius.br);\r\n    ctx.quadraticCurveTo(x + width, y + height, x + width - radius.br, y + height);\r\n    ctx.lineTo(x + radius.bl, y + height);\r\n    ctx.quadraticCurveTo(x, y + height, x, y + height - radius.bl);\r\n    ctx.lineTo(x, y + radius.tl);\r\n    ctx.quadraticCurveTo(x, y, x + radius.tl, y);\r\n    ctx.closePath();\r\n    if (fill) {\r\n        ctx.fill();\r\n    }\r\n    if (stroke) {\r\n        ctx.stroke();\r\n    }\r\n\r\n}\r\nexport {\r\n    ComposerCache\r\n}","import React, { Component } from 'react'\r\nimport { Stage, Container, Graphics, Sprite } from '@inlet/react-pixi';\r\nimport { FaStepBackward, FaStepForward, FaPlusCircle, FaMinusCircle } from 'react-icons/fa';\r\nimport isMobile from \"is-mobile\"\r\nimport \"./Composer.css\"\r\nimport { ComposerCache } from \"./ComposerCache\"\r\n\r\nimport { composerNotePositions, notesPerColumn, appName } from \"../../appConfig\"\r\nlet NumOfColumnsPerCanvas = 35\r\n\r\nclass ComposerCanvas extends Component {\r\n    constructor(props) {\r\n        super(props)\r\n        let sizes = document.body.getBoundingClientRect()\r\n        this.sizes = sizes\r\n        NumOfColumnsPerCanvas = Number(this.props.data.settings.columnsPerCanvas.value)\r\n        let width = nearestEven(sizes.width * 0.84)\r\n        let height = nearestEven(sizes.height * 0.45)\r\n\r\n        if (window.screen.width < sizes.height) {\r\n            width = nearestEven(sizes.height * 0.84)\r\n            height = nearestEven(sizes.width * 0.45)\r\n        }\r\n        if(appName === \"Sky\") height = nearestEven(height * 0.95)\r\n        this.state = {\r\n            width: Math.floor(width),\r\n            height: Math.floor(height),\r\n            column: {\r\n                width: calcMinColumnWidth(nearestEven(width)),\r\n                height: height\r\n            },\r\n            timelineHeight: isMobile() ? 25 : 30,\r\n            currentBreakpoint: -1\r\n        }\r\n        this.canvasRef = React.createRef()\r\n        let margin = isMobile() ? 1 : 4\r\n        this.cache = new ComposerCache(this.state.column.width, height, margin, this.state.timelineHeight)\r\n        this.stageSelected = false\r\n        this.sliderSelected = false\r\n        this.stagePreviousPositon = 0\r\n        this.throttleStage = 0\r\n    }\r\n    resetPointerDown = (e) => {\r\n        this.stageSelected = false\r\n        this.sliderSelected = false\r\n        this.stagePreviousPositon = 0\r\n    }\r\n    componentDidMount() {\r\n        window.addEventListener(\"pointerup\", this.resetPointerDown)\r\n        window.addEventListener(\"keydown\", this.handleKeyboard)\r\n        this.canvasRef.current._canvas.addEventListener(\"wheel\", this.handleWheel)\r\n    }\r\n    componentWillUnmount() {\r\n        window.removeEventListener(\"pointerup\", this.resetPointerDown)\r\n        window.removeEventListener(\"keydown\", this.handleKeyboard)\r\n        this.canvasRef.current._canvas.removeEventListener(\"wheel\", this.handleWheel)\r\n        this.cache.destroy()\r\n    }\r\n    handleKeyboard = (event) => {\r\n        let key = event.code\r\n        switch (key) {\r\n            case \"ArrowRight\": this.handleBreakpoints(1)\r\n                break;\r\n            case \"ArrowLeft\": this.handleBreakpoints(-1)\r\n                break;\r\n            default : \r\n                break;\r\n        }\r\n    }\r\n    handleWheel = (e) => {\r\n        if (e.deltaY < 0) {\r\n            this.props.functions.selectColumn(this.props.data.selected - 1, true)\r\n        } else {\r\n            this.props.functions.selectColumn(this.props.data.selected + 1, true)\r\n        }\r\n    }\r\n    handleClick = (e, type) => {\r\n        let x = e.data.global.x\r\n        if (type === \"click\") {\r\n            let totalWidth = this.state.column.width * this.props.data.columns.length\r\n\r\n            let relativePos = Math.floor(x / this.state.width * totalWidth / this.state.column.width)\r\n            this.props.functions.selectColumn(relativePos)\r\n        }\r\n        if (type === \"up\") {\r\n            this.sliderSelected = false\r\n        }\r\n        if (type === \"down\") {\r\n            this.sliderSelected = true\r\n        }\r\n        if (type === \"downStage\") {\r\n            this.stagePreviousPositon = x\r\n            this.stageSelected = true\r\n        }\r\n    }\r\n    handleStageSlide = (e) => {\r\n        let x = e.data.global.x\r\n        if (this.stageSelected === true) {\r\n            this.throttleStage++\r\n            if (this.throttleStage < 5) return\r\n            this.throttleStage = 0\r\n            let isMovingLeft = this.stagePreviousPositon < x\r\n            let amount = Math.ceil(Math.abs(this.stagePreviousPositon - x) / 8)\r\n            if (amount > 4) amount = 4\r\n            let toAdd = isMovingLeft ? -1 : 1\r\n            this.stagePreviousPositon = x\r\n            let finalPos = this.props.data.selected + toAdd * amount\r\n            if (this.props.data.selected === finalPos) return\r\n            if (finalPos < 0) finalPos = 0\r\n            if (finalPos > this.props.data.columns.length) finalPos = this.props.data.columns.length - 1\r\n            this.props.functions.selectColumn(finalPos, true)\r\n        }\r\n    }\r\n    handleBreakpoints = (direction) => {\r\n        let selectedColumn = this.props.data.selected\r\n        let columns = this.props.data.columns\r\n        let breakpoint\r\n        let breakpoints = this.props.data.breakpoints\r\n        if (direction === 1) {//right\r\n            breakpoint = breakpoints.filter((v) => v > selectedColumn).sort((a, b) => a - b)\r\n        } else {\r\n            breakpoint = breakpoints.filter((v) => v < selectedColumn).sort((a, b) => b - a)\r\n        }\r\n        if (breakpoint.length >= 0) {\r\n            if (columns.length >= breakpoint[0] && breakpoint[0] >= 0) {\r\n                this.props.functions.selectColumn(breakpoint[0])\r\n            }\r\n        }\r\n\r\n    }\r\n    handleSlide = (e) => {\r\n        if (this.sliderSelected) {\r\n            this.throttleStage++\r\n            if (this.throttleStage < 4) return\r\n            this.throttleStage = 0\r\n            let totalWidth = this.state.column.width * this.props.data.columns.length\r\n            let x = e.data.global.x\r\n            let relativePos = Math.floor(x / this.state.width * totalWidth / this.state.column.width)\r\n            this.props.functions.selectColumn(relativePos, true)\r\n        }\r\n    }\r\n\r\n    render() {\r\n        let s = this.state\r\n        const { width, timelineHeight, height} = this.state\r\n        const cache = this.cache.cache\r\n        const { data, functions } = this.props\r\n        let sizes = this.state.column\r\n        let xPos = (data.selected - NumOfColumnsPerCanvas / 2 + 1) * - sizes.width\r\n        let switcher = false\r\n        let counter = 0\r\n        const beatMarks = Number(data.settings.beatMarks.value)\r\n        const counterLimit = beatMarks === 0 ? 11 : 4 * beatMarks - 1\r\n        let relativeColumnWidth = width / data.columns.length\r\n        let stageSize = Math.floor(relativeColumnWidth * (NumOfColumnsPerCanvas + 1))\r\n        if (stageSize > width) stageSize = width\r\n        let stagePos = relativeColumnWidth * data.selected - (NumOfColumnsPerCanvas / 2 - 1) * relativeColumnWidth\r\n        return <div className=\"canvas-wrapper\" style={{ width: width + 2 }}>\r\n            <Stage\r\n                width={width}\r\n                height={height}\r\n                raf={false}\r\n                renderOnComponentChange={true}\r\n                options={{\r\n                    backgroundColor: 0x495466,\r\n                }}\r\n                key={this.state.width}\r\n                ref={this.canvasRef}\r\n            >\r\n                <Container\r\n                    anchor={[0.5, 0.5]}\r\n                    x={xPos}\r\n                    interactive={true}\r\n                    pointerdown={(e) => this.handleClick(e, \"downStage\")}\r\n                    pointermove={(e) => this.handleStageSlide(e)}\r\n                >\r\n                    {data.columns.map((column, i) => {\r\n                        if (counter > counterLimit) {\r\n                            switcher = !switcher\r\n                            counter = 0\r\n                        }\r\n                        counter++\r\n                        if (!isVisible(i, data.selected)) return null\r\n                        let tempoChangersCache = (i + 1) % 4 === 0 ? cache.columnsLarger : cache.columns\r\n                        let standardCache = (i + 1) % 4 === 0 ? cache.standardLarger : cache.standard\r\n                        let standardBg = standardCache[Number(switcher)] // boolean is 1 or 0\r\n                        let background = column.tempoChanger === 0 ? standardBg : tempoChangersCache[column.tempoChanger]\r\n                        return <Column\r\n                            cache={cache}\r\n                            key={i}\r\n                            data={column}\r\n                            index={i}\r\n                            sizes={sizes}\r\n                            backgroundCache={background}\r\n                            isToolsSelected={data.toolsColumns.includes(i)}\r\n                            click={functions.selectColumn}\r\n                            isSelected={i === data.selected}\r\n                            isBreakpoint={data.breakpoints.includes(i)}\r\n                        />\r\n\r\n                    })}\r\n\r\n                </Container>\r\n            </Stage>\r\n            <div className=\"timeline-wrapper\" style={{ height: this.state.timelineHeight }}>\r\n                <div className=\"timeline-button\" onClick={() => this.handleBreakpoints(-1)}>\r\n                    <FaStepBackward />\r\n                </div>\r\n                <div className=\"timeline-button\" onClick={() => this.handleBreakpoints(1)}>\r\n                    <FaStepForward />\r\n                </div>\r\n                <Stage\r\n                    width={s.width}\r\n                    height={timelineHeight}\r\n                    options={{ antialias: true, autoDensity: true,backgroundColor: 0x515c6f }}\r\n                    raf={false}\r\n                    renderOnComponentChange={true}\r\n                >   \r\n                    <Container\r\n                        width={this.state.width}\r\n                        height={this.state.timelineHeight}\r\n                        interactive={true}\r\n                        pointertap={(e) => this.handleClick(e, \"click\")}\r\n                        pointerdown={(e) => this.handleClick(e, \"down\")}\r\n                        pointerup={(e) => this.handleClick(e, \"up\")}\r\n                        pointermove={this.handleSlide}\r\n                    >\r\n                        <Graphics draw={(e) => { fillX(e, this.state.width, this.state.timelineHeight) }}/>\r\n                        {data.breakpoints.map(breakpoint => {\r\n                            return <Sprite\r\n                                image={cache.breakpoints[0]}\r\n                                key={breakpoint}\r\n                                x={relativeColumnWidth * breakpoint}\r\n                            >\r\n                            </Sprite>\r\n                        })}\r\n                    </Container>\r\n\r\n                    <Graphics draw={(e) => drawStage(e, stageSize, this.state.timelineHeight)} x={stagePos} y={2} />\r\n\r\n\r\n                </Stage>\r\n                <div className=\"timeline-button\" onClick={functions.toggleBreakpoint}>\r\n                    {data.breakpoints.includes(data.selected) ? <FaMinusCircle/> : <FaPlusCircle />}\r\n                </div>\r\n            </div>\r\n        </div>\r\n    }\r\n}\r\n\r\nfunction fillX(g, width, height) {\r\n    g.clear()\r\n    g.beginFill(0x515c6f, 1)\r\n    g.drawRect(0, 0, width, height)\r\n}\r\nfunction drawStage(g, width, height) {\r\n    g.clear()\r\n    g.lineStyle(3, 0x1a968b, 0.8)\r\n    g.drawRoundedRect(0, 0, width - 2, height - 4, 6)\r\n}\r\n\r\nfunction Column(props) {\r\n    let { data, index, sizes, click, cache, backgroundCache, isBreakpoint, isSelected, isToolsSelected } = props\r\n    return <Container\r\n        pointertap={() => click(index)}\r\n        interactive={true}\r\n        x={sizes.width * index}\r\n    >\r\n        <Sprite\r\n            image={backgroundCache}\r\n            interactiveChildren={false}\r\n        >\r\n            {isSelected || isToolsSelected ? <Sprite\r\n                image={isToolsSelected && !isSelected? cache.standard[3] : cache.standard[2]}\r\n                alpha={isToolsSelected ?0.4 : 0.6}\r\n                zIndex={1}\r\n            >\r\n            </Sprite> : null}\r\n            {isBreakpoint ? <Sprite\r\n                image={cache.breakpoints[1]}\r\n            >\r\n            </Sprite> : null}\r\n        </Sprite>\r\n        {data.notes.map((note) => {\r\n            return <Sprite\r\n                key={note.index}\r\n                image={cache.notes[note.layer]}\r\n                y={composerNotePositions[note.index] * sizes.height / notesPerColumn}\r\n            >\r\n            </Sprite>\r\n        })}\r\n\r\n    </Container>\r\n}\r\nfunction calcMinColumnWidth(parentWidth) {\r\n    return nearestEven(parentWidth / NumOfColumnsPerCanvas)\r\n}\r\nfunction nearestEven(num) {\r\n    return 2 * Math.round(num / 2);\r\n}\r\nfunction isVisible(pos, currentPos) {\r\n    let threshold = NumOfColumnsPerCanvas / 2 + 2\r\n    let boundaries = [currentPos - threshold, currentPos + threshold]\r\n    return boundaries[0] < pos && pos < boundaries[1]\r\n}\r\nexport default ComposerCanvas","import React, { Component } from 'react'\r\nimport { FaMusic, FaSave, FaCog, FaHome, FaTrash, FaDownload } from 'react-icons/fa';\r\nimport { FileDownloader, LoggerEvent, ComposerSongSerialization, prepareSongDownload } from \"lib/SongUtils\"\r\nimport { appName,isTwa } from 'appConfig'\r\nimport MenuItem from 'components/MenuItem'\r\nimport MenuPanel from 'components/MenuPanel'\r\nimport MenuClose from 'components/MenuClose'\r\nimport SettingsRow from 'components/SettingsRow'\r\nimport DonateButton from 'components/DonateButton'\r\n\r\nclass Menu extends Component {\r\n    constructor(props) {\r\n        super(props)\r\n        this.state = {\r\n            open: false,\r\n            selectedMenu: \"Settings\",\r\n            selectedSongType: \"composed\",\r\n        }    \r\n    }\r\n    componentDidMount() {\r\n        window.addEventListener(\"keydown\", this.handleKeyboard)\r\n    }\r\n    componentWillUnmount(){\r\n        window.removeEventListener(\"keydown\", this.handleKeyboard)\r\n    }\r\n    handleKeyboard = (event) => {\r\n        let key = event.code\r\n        if (document.activeElement.tagName === \"INPUT\") return\r\n\r\n        switch (key) {\r\n            case \"Escape\": {\r\n                if(this.state.open) this.props.functions.toggleMenuVisible()\r\n                this.setState({ open: false })\r\n                break\r\n            }\r\n            default: break;\r\n        }\r\n    }\r\n    toggleMenu = (override) => {\r\n        if (typeof override !== \"boolean\") override = undefined\r\n        let newState = override !== undefined ? override : !this.state.open\r\n        this.setState({\r\n            open: newState,\r\n        })\r\n        if (newState === false) {\r\n            this.props.functions.toggleMenuVisible()\r\n        }\r\n    }\r\n    changeSelectedSongType = (name) => {\r\n        this.setState({\r\n            selectedSongType: name\r\n        })\r\n    }\r\n    selectSideMenu = (selection) => {\r\n        if (selection === this.state.selectedMenu && this.state.open) {\r\n            return this.setState({\r\n                open: false,\r\n            })\r\n        }\r\n        this.setState({\r\n            selectedMenu: selection,\r\n            open: true\r\n        })\r\n    }\r\n    downloadSong = (song) => {\r\n        if (song._id) delete song._id\r\n        if (song.data.isComposedVersion) {\r\n            song = ComposerSongSerialization(song)\r\n        }\r\n        let songName = song.name\r\n        if (appName === \"Sky\") {\r\n            //adds old format into the sheet\r\n            song = prepareSongDownload(song)\r\n        }\r\n        if (!Array.isArray(song)) song = [song]\r\n        song.forEach(song1 => {\r\n            song1.data.appName = appName\r\n        })\r\n        let json = JSON.stringify(song)\r\n        let fileDownloader = new FileDownloader()\r\n        fileDownloader.download(json, `${songName}.${appName.toLowerCase()}sheet.json`)\r\n        new LoggerEvent(\"Success\", \"Song downloaded\").trigger()\r\n    }\r\n    render() {\r\n        const { data, functions } = this.props\r\n        let sideClass = this.state.open ? \"side-menu menu-open\" : \"side-menu\"\r\n        let selectedMenu = this.state.selectedMenu\r\n        const { loadSong, removeSong, updateSong, changePage, handleSettingChange, changeVolume, createNewSong, changeMidiVisibility } = functions\r\n        let songFunctions = {\r\n            loadSong: loadSong,\r\n            removeSong: removeSong,\r\n            toggleMenu: this.toggleMenu,\r\n            downloadSong: this.downloadSong\r\n        }\r\n        let songs = data.songs.filter(song => !song.data?.isComposedVersion)\r\n        let composedSongs = data.songs.filter(song => song.data?.isComposedVersion)\r\n        let hasUnsaved = data.hasChanges ? \"margin-top-auto not-saved\" : \"margin-top-auto\"\r\n        let menuClass = data.menuOpen ? \"menu menu-visible\" : \"menu\"\r\n        return <div className=\"menu-wrapper\">\r\n            <div className={menuClass}>\r\n                <MenuClose action={this.toggleMenu} />\r\n                <MenuItem type=\"Save\" action={() => updateSong(data.currentSong)} className={hasUnsaved}>\r\n                    <FaSave className=\"icon\" />\r\n                </MenuItem>\r\n                <MenuItem type=\"Songs\" action={this.selectSideMenu}>\r\n                    <FaMusic className=\"icon\" />\r\n                </MenuItem>\r\n                <MenuItem type=\"Settings\" action={this.selectSideMenu}>\r\n                    <FaCog className=\"icon\" />\r\n                </MenuItem>\r\n                <MenuItem type=\"Home\" action={() => changePage(\"home\")}>\r\n                    <FaHome className=\"icon\" />\r\n                </MenuItem>\r\n            </div>\r\n            <div className={sideClass}>\r\n                <MenuPanel title=\"No selection\" visible={selectedMenu}>\r\n                </MenuPanel>\r\n                <MenuPanel title=\"Songs\" visible={selectedMenu}>\r\n                    <div className=\"songs-buttons-wrapper\">\r\n                        <button className=\"genshin-button\" onClick={() => { changeMidiVisibility(true); this.toggleMenu() }}>\r\n                            Create from MIDI\r\n                        </button>\r\n                        <button className=\"genshin-button\" onClick={createNewSong}>\r\n                            Create new song\r\n                        </button>\r\n                    </div>\r\n                    <div className=\"tab-selector-wrapper\">\r\n                        <button\r\n                            className={this.state.selectedSongType === \"recorded\" ? \"tab-selector tab-selected\" : \"tab-selector\"}\r\n                            onClick={() => this.changeSelectedSongType(\"recorded\")}\r\n                        >\r\n                            Recorded\r\n                        </button>\r\n                        <button\r\n                            className={this.state.selectedSongType === \"composed\" ? \"tab-selector tab-selected\" : \"tab-selector\"}\r\n                            onClick={() => this.changeSelectedSongType(\"composed\")}\r\n                        >\r\n                            Composed\r\n                        </button>\r\n                    </div>\r\n                    <div className=\"songs-wrapper\" style={{marginBottom: '0.5rem'}}>\r\n                        {this.state.selectedSongType === \"recorded\"\r\n                            ? songs.map(song => {\r\n                                return <SongRow\r\n                                    data={song}\r\n                                    key={song.name}\r\n                                    functions={songFunctions}\r\n                                >\r\n                                </SongRow>\r\n                            })\r\n\r\n                            : composedSongs.map(song => {\r\n                                return <SongRow\r\n                                    data={song}\r\n                                    key={song.name}\r\n                                    functions={songFunctions}\r\n                                >\r\n                                </SongRow>\r\n                            })\r\n                        }\r\n\r\n                    </div>\r\n                    <div className=\"songs-buttons-wrapper\" style={{marginTop: 'auto'}}>\r\n                        <button \r\n                            className={`genshin-button record-btn ${data.isRecordingAudio ? \"selected\" : \"\"}`}\r\n                            onClick={() => functions.startRecordingAudio(!data.isRecordingAudio)}\r\n                        >\r\n                                {data.isRecordingAudio ? \"Stop recording audio\" : \"Start recording audio\"}\r\n                        </button>\r\n                    </div>\r\n\r\n                </MenuPanel>\r\n                <MenuPanel title=\"Settings\" visible={selectedMenu}>\r\n                    {Object.entries(data.settings).map(([key, data]) => {\r\n                        return <SettingsRow\r\n                            key={key + data.value}\r\n                            objKey={key}\r\n                            data={data}\r\n                            changeVolume={changeVolume}\r\n                            update={handleSettingChange}\r\n                        >\r\n\r\n                        </SettingsRow>\r\n                    })}\r\n                    {!isTwa() && <DonateButton onClick={changePage}/>}\r\n                </MenuPanel>\r\n            </div>\r\n        </div>\r\n    }\r\n}\r\n\r\n\r\nfunction SongRow(props) {\r\n    const { data, functions } = props\r\n    const { removeSong, toggleMenu, loadSong, downloadSong } = functions\r\n    return <div className=\"song-row\">\r\n        <div className=\"song-name\" onClick={() => {\r\n            loadSong(data)\r\n            toggleMenu(false)\r\n        }}>\r\n            {data.name}\r\n        </div>\r\n        <div className=\"song-buttons-wrapper\">\r\n            <button className=\"song-button\" onClick={() => downloadSong(data)}>\r\n                <FaDownload />\r\n            </button>\r\n            <button className=\"song-button\" onClick={() => removeSong(data.name)}>\r\n                <FaTrash color=\"#ed4557\" />\r\n            </button>\r\n        </div>\r\n    </div>\r\n}\r\n\r\n\r\n\r\nexport default Menu","import React, { Component } from 'react'\r\nimport ZangoDb from \"zangodb\"\r\nimport { FaPlay, FaPlus, FaPause, FaBars, FaChevronLeft, FaChevronRight, FaTools } from 'react-icons/fa';\r\n\r\nimport addCell from \"assets/icons/addCell.svg\"\r\nimport removeCell from \"assets/icons/removeCell.svg\"\r\nimport { appName, audioContext } from \"appConfig\"\r\n\r\nimport MidiImport from \"./MidiParser\"\r\nimport ComposerTools from \"./ComposerTools\"\r\nimport ComposerKeyboard from \"./ComposerKeyboard\"\r\nimport ComposerCanvas from \"./ComposerCanvas\"\r\nimport Menu from \"./Menu\"\r\n\r\nimport { asyncConfirm, asyncPrompt } from \"components/AsyncPrompts\"\r\nimport { ComposerSettings } from \"lib/SettingsObj\"\r\nimport Instrument from \"lib/Instrument\"\r\nimport {\r\n    ComposedSong, LoggerEvent, ColumnNote, Column, TempoChangers,\r\n    ComposerSongSerialization, ComposerSongDeSerialization, getPitchChanger, RecordingToComposed, delayMs\r\n} from \"lib/SongUtils\"\r\nimport AudioRecorder from 'lib/AudioRecorder'\r\n\r\nclass Composer extends Component {\r\n    constructor(props) {\r\n        super(props)\r\n        this.db = new ZangoDb.Db(appName, { songs: [] })\r\n        this.dbCol = {\r\n            songs: this.db.collection(\"songs\")\r\n\r\n        }\r\n        let settings = this.getSettings()\r\n        this.playbackInterval = undefined\r\n        this.audioContext = audioContext\r\n        this.reverbNode = undefined\r\n        this.reverbVolumeNode = undefined\r\n        this.recorder = new AudioRecorder()\r\n\r\n        this.state = {\r\n            instrument: new Instrument(),\r\n            layers: [new Instrument(), new Instrument()],\r\n            songs: [],\r\n            isPlaying: false,\r\n            song: new ComposedSong(\"Untitled\"),\r\n            settings: settings,\r\n            menuOpen: false,\r\n            layer: 1,\r\n            toolsColumns: [],\r\n            toolsVisible: false,\r\n            midiVisible: false,\r\n            isRecordingAudio: false\r\n        }\r\n        this.mounted = false\r\n        this.copiedColums = []\r\n        this.changes = 0\r\n        this.broadcastChannel = {}\r\n    }\r\n\r\n    componentDidMount() {\r\n        this.mounted = true\r\n        this.init()\r\n        window.addEventListener(\"keydown\", this.handleKeyboard)\r\n        this.broadcastChannel = window.BroadcastChannel ? new BroadcastChannel(appName + '_composer') : {}\r\n        this.broadcastChannel.onmessage = (event) => {\r\n            if (!this.state.settings.syncTabs.value) return\r\n            if (!['play', 'stop'].includes(event?.data)) return\r\n            this.togglePlay(event.data === 'play')\r\n        }\r\n        if (window.location.hostname !== \"localhost\") {\r\n            window.addEventListener(\"beforeunload\", (event) => {\r\n                event.preventDefault()\r\n                event.returnValue = ''\r\n            })\r\n        }\r\n\r\n    }\r\n    componentWillUnmount() {\r\n        this.mounted = false\r\n        window.removeEventListener('keydown', this.handleKeyboard)\r\n        const {instrument, layers} = this.state\r\n        this.broadcastChannel?.close?.()\r\n        const instruments = [instrument, layers[0], layers[1]]\r\n        instruments.forEach(instrument => instrument.delete())\r\n        this.reverbNode = undefined\r\n        this.reverbVolumeNode = undefined\r\n        this.audioContext = undefined   \r\n        let state = this.state\r\n        state.isPlaying = false\r\n    }\r\n\r\n    init = async () => {\r\n        this.syncSongs()\r\n        const { settings } = this.state\r\n        const promises = [\r\n            this.loadInstrument(settings.instrument.value, 1),\r\n            this.loadInstrument(settings.layer2.value, 2),\r\n            this.loadInstrument(settings.layer3.value, 3)\r\n        ]\r\n        if(this.mounted) await Promise.all(promises)\r\n        if(this.mounted) await this.loadReverb()\r\n        if(this.mounted) this.setupAudioDestination(settings.caveMode.value)\r\n    }\r\n    componentDidCatch() {\r\n        this.setState({\r\n            song: new ComposedSong(\"Untitled\")\r\n        })\r\n        new LoggerEvent(\"Warning\", \"There was an error with the song! Restoring default...\").trigger()\r\n    }\r\n    handleAutoSave = () => {\r\n        this.changes++\r\n        if (this.changes > 5 && this.state.settings.autosave.value) {\r\n            if (this.state.song.name !== \"Untitled\") {\r\n                this.updateSong(this.state.song)\r\n            }\r\n\r\n        }\r\n    }\r\n    loadReverb() {\r\n        return new Promise(resolve => {\r\n            fetch(\"./assets/audio/reverb4.wav\")\r\n                .then(r => r.arrayBuffer())\r\n                .then(b => {\r\n                    if(!this.mounted) return\r\n                    this.audioContext.decodeAudioData(b, (impulse_response) => {\r\n                        if(!this.mounted) return\r\n                        let convolver = this.audioContext.createConvolver()\r\n                        let gainNode = this.audioContext.createGain()\r\n                        gainNode.gain.value = 2.5\r\n                        convolver.buffer = impulse_response\r\n                        convolver.connect(gainNode)\r\n                        gainNode.connect(this.audioContext.destination)\r\n                        this.reverbNode = convolver\r\n                        this.reverbVolumeNode = gainNode\r\n                        resolve()\r\n                    })\r\n                }).catch((e) => {\r\n                    console.log(\"Error with reverb\", e)\r\n                })\r\n        })\r\n    }\r\n    getSettings = () => {\r\n        let storedSettings = localStorage.getItem(appName + \"_Composer_Settings\")\r\n        try {\r\n            storedSettings = JSON.parse(storedSettings)\r\n        } catch (e) {\r\n            storedSettings = null\r\n        }\r\n        if (storedSettings !== null) {\r\n            if (storedSettings.settingVesion !== ComposerSettings.settingVesion) {\r\n                this.updateSettings(ComposerSettings)\r\n                return ComposerSettings\r\n            }\r\n            return storedSettings\r\n        }\r\n        return ComposerSettings\r\n    }\r\n\r\n    updateSettings = (override) => {\r\n        let state\r\n        if (override !== undefined) {\r\n            state = override\r\n        } else {\r\n            state = this.state.settings\r\n        }\r\n        localStorage.setItem(appName + \"_Composer_Settings\", JSON.stringify(state))\r\n    }\r\n\r\n    handleSettingChange = (setting) => {\r\n        const { state } = this\r\n        let settings = state.settings\r\n        let data = setting.data\r\n        settings[setting.key].value = data.value\r\n        if (data.songSetting) {\r\n            state.song[setting.key] = data.value\r\n        }\r\n        if (setting.key === \"instrument\") this.loadInstrument(data.value, 1)\r\n        if (setting.key === \"layer2\") this.loadInstrument(data.value, 2)\r\n        if (setting.key === \"layer3\") this.loadInstrument(data.value, 3)\r\n        if (setting.key === \"caveMode\") this.setupAudioDestination(data.value)\r\n        this.setState({\r\n            settings: settings,\r\n            song: this.state.song\r\n        }, () => {\r\n            this.updateSettings()\r\n        })\r\n    }\r\n\r\n    loadInstrument = async (name, layer) => {\r\n        if(!this.mounted) return\r\n        const { settings } = this.state\r\n        if (layer === 1) {\r\n            this.state.instrument.delete()\r\n            let newInstrument = new Instrument(name)\r\n            await newInstrument.load()\r\n\t\t    if(!this.mounted) return \r\n            newInstrument.changeVolume(settings.instrument.volume)\r\n            this.setState({\r\n                instrument: newInstrument\r\n            })\r\n        } else {\r\n            let newInstrument = new Instrument(name)\r\n            let layers = this.state.layers\r\n            layers[layer-2].delete()\r\n            layers[layer - 2] = newInstrument\r\n            await newInstrument.load()\r\n\t\t    if(!this.mounted) return \r\n            newInstrument.changeVolume(settings[`layer${layer}`]?.volume)\r\n            this.setState({\r\n                layers: layers\r\n            })\r\n        }\r\n        this.setupAudioDestination(settings.caveMode.value)\r\n    }\r\n    changeVolume = (obj) => {\r\n        let settings = this.state.settings\r\n        if (obj.key === \"instrument\") {\r\n            settings.instrument.volume = obj.value\r\n            this.state.instrument.changeVolume(obj.value)\r\n        }\r\n        if (obj.key === \"layer2\") {\r\n            settings.layer2.volume = obj.value\r\n            this.state.layers[0].changeVolume(obj.value)\r\n        }\r\n        if (obj.key === \"layer3\") {\r\n            settings.layer3.volume = obj.value\r\n            this.state.layers[1].changeVolume(obj.value)\r\n        }\r\n        this.setState({\r\n            settings: settings\r\n        }, () => this.updateSettings())\r\n    }\r\n    setupAudioDestination = (hasReverb) => {\r\n        if(!this.mounted) return\r\n        const { instrument, layers } = this.state\r\n        const instruments = [instrument, layers[0], layers[1]]\r\n        instruments.forEach(ins => {\r\n            if (hasReverb) {\r\n                if (!this.reverbNode) return console.log(\"Couldn't connect to reverb\")\r\n                ins.disconnect()\r\n                ins.connect(this.reverbNode)\r\n            } else {\r\n                ins.disconnect()\r\n                ins.connect(this.audioContext.destination)\r\n            }\r\n        })\r\n    }\r\n    startRecordingAudio =async (override) => { //will record untill the song stops\r\n        if(!this.mounted) return\r\n        if(!override){\r\n            this.setState({ isRecordingAudio: false })\r\n            return this.togglePlay(false)\r\n        }\r\n        const { instrument, layers } = this.state\r\n        const instruments = [instrument, layers[0], layers[1]]\r\n        const hasReverb = this.state.settings.caveMode.value\r\n        const { recorder } = this\r\n        if (hasReverb) {\r\n            this.reverbVolumeNode.connect(recorder.node)\r\n        } else {\r\n            instruments.forEach(instrument => {\r\n                instrument.connect(recorder.node)\r\n            })\r\n        }\r\n        recorder.start()\r\n        this.setState({ isRecordingAudio: true })\r\n        await this.togglePlay(true) //wait till song finishes\r\n\t\tif(!this.mounted) return \r\n        let recording = await recorder.stop()\r\n        this.setState({ isRecordingAudio: false })\r\n        let fileName = await asyncPrompt(\"Write the song name, press cancel to ignore\")\r\n        if (fileName)  recorder.download(recording.data, fileName + '.wav')\r\n        if(!this.mounted) return\r\n        this.reverbVolumeNode.disconnect()\r\n        this.reverbVolumeNode.connect(audioContext.destination)\r\n        this.setupAudioDestination(hasReverb)\r\n    }\r\n    handleKeyboard = (event) => {\r\n        if (document.activeElement.tagName === \"INPUT\") return\r\n        const { instrument,layer,layers,isPlaying } = this.state\r\n        let key = event.code\r\n        const shouldEditKeyboard = isPlaying || event.shiftKey\r\n        if (shouldEditKeyboard) {\r\n            let letter = key?.replace(\"Key\", \"\")\r\n            let note = instrument.getNoteFromCode(letter)\r\n            if (note !== null) this.handleClick(instrument.layout[note])\r\n            switch (key) {\r\n                case \"Space\": {\r\n                    this.togglePlay()\r\n                    if (!this.state.settings.syncTabs.value) break;\r\n                    this.broadcastChannel?.postMessage?.(\"stop\")\r\n                    break;\r\n                }\r\n                default: break;\r\n            }\r\n        } else {\r\n            switch (key) {\r\n                case \"KeyD\": this.selectColumn(this.state.song.selected + 1); break;\r\n                case \"KeyA\": this.selectColumn(this.state.song.selected - 1); break;\r\n                case \"Digit1\": this.handleTempoChanger(TempoChangers[0]); break;\r\n                case \"Digit2\": this.handleTempoChanger(TempoChangers[1]); break;\r\n                case \"Digit3\": this.handleTempoChanger(TempoChangers[2]); break;\r\n                case \"Digit4\": this.handleTempoChanger(TempoChangers[3]); break;\r\n                case \"Space\": {\r\n                    this.togglePlay()\r\n                    if (!this.state.settings.syncTabs.value) break;\r\n                    this.broadcastChannel?.postMessage?.(\"play\")\r\n                    break;\r\n                }\r\n                case \"ArrowUp\":{\r\n                    let nextLayer = layer - 1\r\n                    if(nextLayer > 0) this.changeLayer(nextLayer)\r\n                    break;\r\n                }   \r\n                case \"ArrowDown\":{\r\n                    let nextLayer = layer + 1\r\n                    if(nextLayer < layers.length + 2) this.changeLayer(nextLayer)\r\n                    break;\r\n                }\r\n                case \"KeyQ\": this.removeColumns(1, this.state.song.selected); break;\r\n                case \"KeyE\": this.addColumns(1, this.state.song.selected); break;\r\n                default: break;\r\n            }\r\n        }\r\n\r\n    }\r\n    playSound = (instrument, index) => {\r\n        try {\r\n            let note = instrument.layout[index]\r\n            if (note === undefined) return\r\n            instrument.play(note.index, getPitchChanger(this.state.settings.pitch.value))\r\n        } catch (e) {\r\n\r\n        }\r\n    }\r\n    changePitch = (value) => {\r\n        const { settings } = this.state\r\n        settings.pitch.value = value\r\n        this.setState({\r\n            settings: settings\r\n        }, () => this.updateSettings())\r\n    }\r\n    handleClick = (note) => {\r\n        let column = this.state.song.columns[this.state.song.selected]\r\n        let index = column.notes.findIndex((n) => {\r\n            return note.index === n.index\r\n        })\r\n        let layerIndex = this.state.layer - 1\r\n        if (index < 0) { //if it doesn't exist, create a new one\r\n            let columnNote = new ColumnNote(note.index)\r\n            columnNote.layer = replaceAt(columnNote.layer, layerIndex, \"1\")\r\n            column.notes.push(columnNote)\r\n        } else { //if it exists, toggle the current layer and if it's 000 delete it\r\n            let currentNote = column.notes[index]\r\n            currentNote.layer = replaceAt(currentNote.layer, layerIndex, currentNote.layer[layerIndex] === \"0\" ? \"1\" : \"0\")\r\n            if (currentNote.layer === \"000\") column.notes.splice(index, 1)\r\n        }\r\n        this.setState({\r\n            song: this.state.song\r\n        })\r\n        this.handleAutoSave()\r\n        let instrument = this.state.instrument\r\n        if (this.state.layer > 1) {\r\n            instrument = this.state.layers[this.state.layer - 2]\r\n        }\r\n        this.playSound(instrument, note.index)\r\n    }\r\n    syncSongs = async () => {\r\n        let songs = await this.dbCol.songs.find().toArray()\r\n        if(!this.mounted) return\r\n        songs = songs.map(song => {\r\n            if (song.data.isComposedVersion) {\r\n                return ComposerSongDeSerialization(song)\r\n            }\r\n            return song\r\n        })\r\n        this.setState({\r\n            composedSongs: songs,\r\n            songs: songs\r\n        })\r\n    }\r\n    addSong = async (song) => {\r\n        if (await this.songExists(song.name)) {\r\n            return new LoggerEvent(\"Warning\", \"A song with this name already exists! \\n\" + song.name).trigger()\r\n        }\r\n        await this.dbCol.songs.insert(ComposerSongSerialization(song))\r\n        this.syncSongs()\r\n    }\r\n    updateSong = async (song) => {\r\n        if (song.name === \"Untitled\") {\r\n            let name = await this.askForSongName()\r\n            if(!this.mounted) return\r\n            if (name === null) return\r\n            song.name = name\r\n            return this.addSong(song)\r\n        }\r\n        return new Promise(async resolve => {\r\n            let settings = this.state.settings\r\n            if (await this.songExists(song.name)) {\r\n                song.instruments[0] = settings.instrument.value\r\n                song.instruments[1] = settings.layer2.value\r\n                song.instruments[2] = settings.layer3.value\r\n                await this.dbCol.songs.update({ name: song.name }, ComposerSongSerialization(song))\r\n                console.log(\"song saved:\", song.name)\r\n                this.changes = 0\r\n                this.syncSongs()\r\n            } else {\r\n                if (song.name.includes(\"- Composed\")) {\r\n                    let name = await this.askForSongName(\"Write composed song name, press cancel to ignore\")\r\n                    if (name === null) return resolve()\r\n                    song.name = name\r\n                    await this.dbCol.songs.insert(ComposerSongSerialization(song))\r\n                    this.syncSongs()\r\n                    return resolve()\r\n                }\r\n                console.log(\"song doesn't exist\")\r\n                song.name = \"Untitled\"\r\n                this.updateSong(song)\r\n            }\r\n            resolve()\r\n        })\r\n    }\r\n    askForSongName = (question) => {\r\n        return new Promise(async resolve => {\r\n            let promptString = question || \"Write song name, press cancel to ignore\"\r\n            while (true) {\r\n                let songName = await asyncPrompt(promptString)\r\n                if (songName === null) return resolve(null)\r\n                if (songName !== \"\") {\r\n                    if (await this.songExists(songName)) {\r\n                        promptString = \"This song already exists: \" + songName\r\n                    } else {\r\n                        return resolve(songName)\r\n                    }\r\n                } else {\r\n                    promptString =question || \"Write song name, press cancel to ignore\"\r\n                }\r\n            }\r\n        })\r\n\r\n    }\r\n    askForSongUpdate = () => {\r\n        return new Promise(async resolve => {\r\n            let result = await asyncConfirm(`You have unsaved changes to the song: \"${this.state.song.name}\" do you want to save now?`)\r\n            resolve(result)\r\n        })\r\n    }\r\n    songExists = async (name) => {\r\n        return await this.dbCol.songs.findOne({ name: name }) !== undefined\r\n    }\r\n    createNewSong = async () => {\r\n        if (this.state.song.name !== \"Untitled\" && this.changes > 0) {\r\n            let wantsToSave = await this.askForSongUpdate()\r\n            if (wantsToSave) {\r\n                await this.updateSong(this.state.song)\r\n            }\r\n        }\r\n        let name = await this.askForSongName(\"Write new song name, press cancel to ignore\")\r\n        if (name === null) return\r\n        let song = new ComposedSong(name)\r\n        this.changes = 0\r\n        if(!this.mounted) return\r\n        this.setState({\r\n            song: song\r\n        }, () => this.addSong(song))\r\n    }\r\n    removeSong = async (name) => {\r\n        let confirm = await asyncConfirm(\"Are you sure you want to delete the song: \" + name)\r\n        if (confirm) this.dbCol.songs.remove({ name: name }, this.syncSongs)\r\n    }\r\n\r\n    loadSong = async (song) => {\r\n        const state = this.state\r\n        song = JSON.parse(JSON.stringify(song)) //lose reference\r\n        if (!song.data.isComposedVersion) {\r\n            song = RecordingToComposed(song)\r\n            song.name += \" - Composed\"\r\n        }\r\n        if (this.changes !== 0) {\r\n            let confirm = state.settings.autosave.value && state.song.name !== \"Untitled\"\r\n            if (!confirm && state.song.columns.length > 0) {\r\n                confirm = await asyncConfirm(`You have unsaved changes to the song: \"${state.song.name}\" do you want to save? UNSAVED CHANGES WILL BE LOST`)\r\n            }\r\n            if (confirm) await this.updateSong(state.song)\r\n        }\r\n        let settings = this.state.settings\r\n        settings.bpm.value = song.bpm\r\n        settings.pitch.value = song.pitch\r\n        if (settings.instrument.value !== song.instruments[0]) {\r\n            this.loadInstrument(song.instruments[0], 1)\r\n            settings.instrument.value = song.instruments[0]\r\n        }\r\n        if (settings.layer2.value !== song.instruments[1]) {\r\n            this.loadInstrument(song.instruments[1], 2)\r\n            settings.layer2.value = song.instruments[1]\r\n        }\r\n        if (settings.layer3.value !== song.instruments[2]) {\r\n            this.loadInstrument(song.instruments[2], 3)\r\n            settings.layer3.value = song.instruments[2]\r\n        }\r\n        this.changes = 0\r\n        console.log(\"song loaded\")\r\n        if(!this.mounted) return\r\n        this.setState({\r\n            song: song,\r\n            settings: settings,\r\n            toolsColumns: []\r\n        })\r\n    }\r\n\r\n    addColumns = (amount = 1, position = \"end\") => {\r\n        return new Promise(resolve => {\r\n            let columns = new Array(amount).fill().map(() => new Column())\r\n            let songColumns = this.state.song.columns\r\n            if (position === \"end\") {\r\n                songColumns.push(...columns)\r\n            } else {\r\n                songColumns.splice(position + 1, 0, ...columns)\r\n            }\r\n            if (amount === 1) this.selectColumn(this.state.song.selected + 1)\r\n            this.handleAutoSave()\r\n            this.setState({\r\n                song: this.state.song\r\n            }, resolve)\r\n        })\r\n\r\n    }\r\n    removeColumns = (amount, position) => {\r\n        let song = this.state.song\r\n        if (song.columns.length < 16) return\r\n        let indexes = new Array(amount).fill().map((e, i) => position + i)\r\n        indexes.forEach(index => {\r\n            if (song.breakpoints.includes(index)) this.toggleBreakpoint(index)\r\n        })\r\n        song.columns.splice(position, amount)\r\n        if (song.columns.length <= song.selected) this.selectColumn(song.selected - 1)\r\n        this.handleAutoSave()\r\n        this.setState({\r\n            song: song\r\n        })\r\n    }\r\n    //----------------------------------------------//\r\n\r\n    togglePlay = async (override) => {\r\n        return new Promise(resolve => {\r\n            let newState = typeof override === \"boolean\" ? override : !this.state.isPlaying\r\n            this.setState({\r\n                isPlaying: newState\r\n            }, async () => {\r\n                if (this.state.isPlaying) this.selectColumn(this.state.song.selected)\r\n                let pastError = 0\r\n                let previousTime = new Date().getTime()\r\n                while (this.state.isPlaying) {\r\n                    const { song, settings } = this.state\r\n                    let tempoChanger = TempoChangers[song.columns[song.selected].tempoChanger]\r\n                    let msPerBPM = Math.floor(60000 / settings.bpm.value * tempoChanger.changer) + pastError\r\n                    previousTime = new Date().getTime()\r\n                    await delayMs(msPerBPM)\r\n                    if (!this.state.isPlaying || !this.mounted) break\r\n                    this.handleTick()\r\n                    pastError = previousTime + msPerBPM - new Date().getTime()\r\n                }\r\n                resolve()\r\n            })\r\n        }) \r\n    }\r\n\r\n\r\n    handleTick = () => {\r\n        let newIndex = this.state.song.selected + 1\r\n        if (this.state.isPlaying && newIndex > this.state.song.columns.length - 1) {\r\n            return this.togglePlay(false)\r\n        }\r\n        this.selectColumn(this.state.song.selected + 1)\r\n\r\n    }\r\n    toggleMenuVisible = () => {\r\n        this.setState({\r\n            menuOpen: !this.state.menuOpen\r\n        })\r\n    }\r\n    toggleBreakpoint = (override) => {\r\n        let song = this.state.song\r\n        let index = typeof override === \"number\" ? override : song.selected\r\n        let indexOfBreakpoint = song.breakpoints.indexOf(index)\r\n        if (indexOfBreakpoint >= 0 && song.columns.length > index) {\r\n            song.breakpoints.splice(indexOfBreakpoint, 1)\r\n        } else if (song.columns.length > index) {\r\n            song.breakpoints.push(index)\r\n        }\r\n        this.validateBreakpoints()\r\n        this.setState({\r\n            song: song\r\n        })\r\n    }\r\n    handleTempoChanger = (changer) => {\r\n        let song = this.state.song\r\n        song.columns[this.state.song.selected].tempoChanger = changer.id\r\n        this.handleAutoSave()\r\n        this.setState({\r\n            song: song\r\n        })\r\n    }\r\n    changePage = async (page) => {\r\n        if (this.changes !== 0) {\r\n            if (this.state.settings.autosave.value) {\r\n                await this.updateSong(this.state.song)\r\n            } else {\r\n                let confirm = await asyncConfirm(`You have unsaved changes to the song: \"${this.state.song.name}\" do you want to save? UNSAVED CHANGES WILL BE LOST`)\r\n                if (confirm) {\r\n                    await this.updateSong(this.state.song)\r\n                }\r\n            }\r\n\r\n        }\r\n\r\n        this.props.changePage(page)\r\n    }\r\n    selectColumn = (index, ignoreAudio) => {\r\n        const state = this.state\r\n        let song = state.song\r\n        if (index < 0 || index > song.columns.length - 1) return\r\n        let currentColumn = state.song.columns[index]\r\n        song.selected = index\r\n        let toolsColumns = state.toolsColumns\r\n        if (state.toolsVisible && this.copiedColums.length === 0) {\r\n            toolsColumns.push(index)\r\n            let min = Math.min(...toolsColumns)\r\n            let max = Math.max(...toolsColumns)\r\n            toolsColumns = new Array(max - min + 1).fill().map((e, i) => min + i)\r\n        }\r\n        this.setState({\r\n            song: song,\r\n            toolsColumns: toolsColumns\r\n        })\r\n\r\n        if (ignoreAudio) return\r\n        currentColumn.notes.forEach(note => {\r\n            if (note.layer[0] === \"1\") this.playSound(state.instrument, note.index)\r\n            if (note.layer[1] === \"1\") this.playSound(state.layers[0], note.index)\r\n            if (note.layer[2] === \"1\") this.playSound(state.layers[1], note.index)\r\n        })\r\n    }\r\n    changeLayer = (layer) => {\r\n        this.setState({\r\n            layer: layer\r\n        })\r\n    }\r\n    //-----------------------TOOLS---------------------//\r\n    toggleTools = () => {\r\n        this.setState({\r\n            toolsVisible: !this.state.toolsVisible,\r\n            toolsColumns: this.state.toolsVisible ? [] : [this.state.song.selected]\r\n        })\r\n        this.copiedColums = []\r\n    }\r\n    copyColumns = (layer) => {\r\n        this.copiedColums = []\r\n        this.state.toolsColumns.forEach((index) => {\r\n            let column = this.state.song.columns[index]\r\n            if (column !== undefined) this.copiedColums.push(column)\r\n        })\r\n        this.copiedColums = JSON.parse(JSON.stringify(this.copiedColums)) // removing reference\r\n        if (layer !== 'all') {\r\n            this.copiedColums = this.copiedColums.map(column => {\r\n                column.notes = column.notes.filter(e => e.layer[layer - 1] === '1')\r\n                column.notes = column.notes.map(e => {\r\n                    e.layer = '000'\r\n                    e.layer = replaceAt(e.layer, layer - 1, '1')\r\n                    return e\r\n                })\r\n                return column\r\n            })\r\n        }\r\n        this.setState({\r\n            toolsColumns: []\r\n        })\r\n    }\r\n    pasteColumns = async (insert) => {\r\n        let song = this.state.song\r\n        let copiedColumns = JSON.parse(JSON.stringify(this.copiedColums))\r\n        if (!insert) {\r\n            song.columns.splice(song.selected, 0, ...copiedColumns)\r\n        } else {\r\n            copiedColumns.forEach((copiedColumn, i) => {\r\n                let column = song.columns[song.selected + i]\r\n                if (column !== undefined) {\r\n                    copiedColumn.notes.forEach(copiedNote => {\r\n                        let index = column.notes.findIndex(note => copiedNote.index === note.index)\r\n                        if (index < 0) {\r\n                            column.notes.push(copiedNote)\r\n                        } else {\r\n                            for (let j = 0; j < 3; j++) {\r\n                                if (copiedNote.layer[j] === '1') {\r\n                                    column.notes[index].layer = replaceAt(column.notes[index].layer, j, 1)\r\n                                }\r\n                            }\r\n                        }\r\n                    })\r\n                }\r\n            })\r\n        }\r\n\r\n        this.setState({\r\n            song: song\r\n        })\r\n    }\r\n    eraseColumns = (layer) => {\r\n        let song = this.state.song\r\n        if (layer === 'all') {\r\n            this.state.toolsColumns.forEach(columnIndex => {\r\n                let column = song.columns[columnIndex]\r\n                if (column !== undefined) song.columns[columnIndex].notes = []\r\n            })\r\n        } else {\r\n            this.state.toolsColumns.forEach(columnIndex => {\r\n                let column = song.columns[columnIndex]\r\n                if (column !== undefined) {\r\n                    song.columns[columnIndex].notes.forEach(note => {\r\n                        note.layer = replaceAt(note.layer, layer - 1, '0')\r\n                    })\r\n                }\r\n            })\r\n        }\r\n\r\n        this.setState({\r\n            song: song\r\n        })\r\n    }\r\n    validateBreakpoints = () => {\r\n        let breakpoints = this.state.song.breakpoints.filter(breakpoint => breakpoint < this.state.song.columns.length)\r\n        let song = this.state.song\r\n        song.breakpoints = breakpoints\r\n        this.setState({\r\n            song: song\r\n        })\r\n    }\r\n    deleteColumns = async () => {\r\n        let song = this.state.song\r\n        song.columns = song.columns.filter((e, i) => !this.state.toolsColumns.includes(i))\r\n        if (song.selected > song.columns.length - 1) song.selected = song.columns.length - 1\r\n        if (song.selected <= 0) song.selected = 0\r\n        if (song.columns.length === 0) await this.addColumns(12, 0)\r\n        this.setState({\r\n            song: song,\r\n            toolsColumns: []\r\n        }, this.validateBreakpoints)\r\n    }\r\n    changeMidiVisibility = (visibility) => {\r\n        this.setState({\r\n            midiVisible: visibility\r\n        })\r\n    }\r\n    render() {\r\n\r\n        const { state } = this\r\n        const { midiVisible } = state\r\n        let song = state.song\r\n        let menuData = {\r\n            songs: state.songs,\r\n            currentSong: state.song,\r\n            settings: state.settings,\r\n            hasChanges: this.changes,\r\n            menuOpen: state.menuOpen,\r\n            isRecordingAudio: state.isRecordingAudio\r\n        }\r\n        let menuFunctions = {\r\n            loadSong: this.loadSong,\r\n            removeSong: this.removeSong,\r\n            createNewSong: this.createNewSong,\r\n            changePage: this.changePage,\r\n            updateSong: this.updateSong,\r\n            handleSettingChange: this.handleSettingChange,\r\n            toggleMenuVisible: this.toggleMenuVisible,\r\n            changeVolume: this.changeVolume,\r\n            changeMidiVisibility: this.changeMidiVisibility,\r\n            startRecordingAudio: this.startRecordingAudio\r\n        }\r\n        let keyboardFunctions = {\r\n            handleClick: this.handleClick,\r\n            handleTempoChanger: this.handleTempoChanger,\r\n            changeLayer: this.changeLayer\r\n        }\r\n        let keyboardData = {\r\n            keyboard: state.instrument,\r\n            currentColumn: state.song.columns[state.song.selected],\r\n            TempoChangers: TempoChangers,\r\n            layer: state.layer,\r\n            pitch: state.settings.pitch.value,\r\n            isPlaying: state.isPlaying,\r\n            noteNameType: state.settings.noteNameType.value,\r\n        }\r\n        let canvasFunctions = {\r\n            selectColumn: this.selectColumn,\r\n            toggleBreakpoint: this.toggleBreakpoint\r\n        }\r\n        let canvasData = {\r\n            columns: song.columns,\r\n            selected: song.selected,\r\n            settings: state.settings,\r\n            breakpoints: state.song.breakpoints,\r\n            toolsColumns: state.toolsColumns\r\n        }\r\n        let toolsData = {\r\n            visible: this.state.toolsVisible,\r\n            copiedColumns: this.copiedColums,\r\n            layer: this.state.layer\r\n        }\r\n        let toolsFunctions = {\r\n            toggleTools: this.toggleTools,\r\n            eraseColumns: this.eraseColumns,\r\n            deleteColumns: this.deleteColumns,\r\n            copyColumns: this.copyColumns,\r\n            pasteColumns: this.pasteColumns\r\n        }\r\n        let midiParserFunctions = {\r\n            loadSong: this.loadSong,\r\n            changeMidiVisibility: this.changeMidiVisibility,\r\n            changePitch: this.changePitch,\r\n        }\r\n        let midiParserData = {\r\n            instruments: [state.instrument, ...state.layers].map(layer => layer.instrumentName),\r\n            selectedColumn: song.selected,\r\n\r\n        }\r\n        return <div className=\"app bg-image\" style={{ backgroundImage: `url(${state.settings.backgroundImage.value})` }}>\r\n            {midiVisible && <MidiImport functions={midiParserFunctions} data={midiParserData} />}\r\n            <div className=\"hamburger\" onClick={this.toggleMenuVisible}>\r\n                <FaBars />\r\n            </div>\r\n            <div className=\"right-panel-composer\">\r\n\r\n                <div className=\"column fill-x\">\r\n\r\n                    <div className=\"top-panel-composer\">\r\n                        <div className=\"buttons-composer-wrapper\">\r\n                            <div className=\"tool\" onClick={() => this.selectColumn(song.selected + 1)}>\r\n                                <FaChevronRight />\r\n                            </div>\r\n                            <div className=\"tool\" onClick={() => this.selectColumn(song.selected - 1)}>\r\n                                <FaChevronLeft />\r\n                            </div>\r\n\r\n                            <div className=\"tool\" onClick={this.togglePlay}>\r\n                                {this.state.isPlaying ? <FaPause/> : <FaPlay />}\r\n                            </div>\r\n                        </div>\r\n                        <ComposerCanvas\r\n                            key={this.state.settings.columnsPerCanvas.value}\r\n                            functions={canvasFunctions}\r\n                            data={canvasData}\r\n                        />\r\n                        <div className=\"buttons-composer-wrapper-right\">\r\n\r\n                            <div className=\"tool\" onClick={() => this.addColumns(1, song.selected)}>\r\n                                <img src={addCell} className=\"tool-icon\" alt=\"Add a new cell\" />\r\n                            </div>\r\n                            <div className=\"tool\" onClick={() => this.removeColumns(1, song.selected)}>\r\n                                <img src={removeCell} className=\"tool-icon\" alt=\"Remove a cell\" />\r\n                            </div>\r\n                            <div className=\"tool\" onClick={() => this.addColumns(this.state.settings.beatMarks.value * 4, \"end\")}>\r\n                                <FaPlus />\r\n                            </div>\r\n                            <div className=\"tool\" onClick={this.toggleTools}>\r\n                                <FaTools />\r\n                            </div>\r\n\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n\r\n                <ComposerKeyboard\r\n                    functions={keyboardFunctions}\r\n                    data={keyboardData}\r\n                />\r\n            </div>\r\n            <Menu\r\n                data={menuData}\r\n                functions={menuFunctions}\r\n            />\r\n            <ComposerTools\r\n                data={toolsData}\r\n                functions={toolsFunctions}\r\n            />\r\n            <div className=\"song-info\">\r\n                <div>\r\n                    {song.name}\r\n                </div>\r\n                <div>\r\n                    {formatMillis(calculateLength(this.state.song, this.state.song.selected))}\r\n                    /\r\n                    {formatMillis(calculateLength(this.state.song, this.state.song.columns.length))}\r\n                </div>\r\n\r\n\r\n            </div>\r\n        </div>\r\n    }\r\n}\r\nfunction formatMillis(millis) {\r\n    let minutes = Math.floor(millis / 60000);\r\n    let seconds = ((millis % 60000) / 1000).toFixed(0);\r\n    return (\r\n        seconds === 60 \r\n        ? (minutes+1) + \":00\" \r\n        : minutes + \":\" + (seconds < 10 ? \"0\" : \"\") + seconds\r\n    )\r\n}\r\nfunction calculateLength(song, end) {\r\n    let columns = song.columns\r\n    let bpmPerMs = Math.floor(60000 / song.bpm)\r\n    let totalLength = 0\r\n    columns.forEach((column, i) => {\r\n        if (i > end) return\r\n        totalLength += bpmPerMs * TempoChangers[column.tempoChanger].changer\r\n    })\r\n    return totalLength\r\n}\r\n\r\nfunction replaceAt(string, index, replacement) {\r\n    if (index >= string.length) {\r\n        return string.valueOf();\r\n    }\r\n\r\n    return string.substring(0, index) + replacement + string.substring(index + 1);\r\n}\r\nexport default Composer\r\n\r\n","import React, { Component } from 'react'\r\nimport { FaHome, FaDiscord } from 'react-icons/fa';\r\n\r\nimport MenuItem from 'components/MenuItem'\r\nimport MenuPanel from 'components/MenuPanel'\r\n\r\n\r\nexport class SimpleMenu extends Component {\r\n    constructor(props) {\r\n        super(props)\r\n        this.state = {\r\n            open: false,\r\n            selectedMenu: \"Settings\"\r\n        }    \r\n    }\r\n    toggleMenu = (override) => {\r\n        if (typeof override !== \"boolean\") override = undefined\r\n        let newState = override !== undefined ? override : !this.state.open\r\n        this.setState({\r\n            open: newState,\r\n        })\r\n        if (newState === false) {\r\n            this.props.functions.toggleMenuVisible()\r\n        }\r\n    }\r\n    selectSideMenu = (selection) => {\r\n        if (selection === this.state.selectedMenu && this.state.open) {\r\n            return this.setState({\r\n                open: false,\r\n            })\r\n        }\r\n        this.setState({\r\n            selectedMenu: selection,\r\n            open: true\r\n        })\r\n    }\r\n    render() {\r\n        const {      functions } = this.props\r\n        let sideClass = this.state.open ? \"side-menu menu-open\" : \"side-menu\"\r\n        let selectedMenu = this.state.selectedMenu\r\n        const { changePage } = functions\r\n        let menuClass = \"menu menu-visible\"\r\n        return <div className=\"menu-wrapper\" >\r\n            <div className={menuClass} style={{justifyContent: 'flex-end'}}>\r\n            {this.props.children}\r\n                \r\n                <MenuItem type='Discord'>\r\n                    <a href='https://discord.gg/Arsf65YYHq' target='_blank' rel='noreferrer' >\r\n                        <FaDiscord className=\"icon\"/>\r\n                    </a>\r\n                </MenuItem>\r\n                <MenuItem type=\"Home\" action={() => changePage(\"home\")}>\r\n                    <FaHome className=\"icon\"/>\r\n                </MenuItem>\r\n            </div>\r\n            <div className={sideClass}>\r\n                <MenuPanel title=\"No selection\" visible={selectedMenu}>\r\n                </MenuPanel>\r\n            </div>\r\n        </div>\r\n    }\r\n}","import React, { Component } from 'react'\r\nimport { FaTrash, FaDownload} from 'react-icons/fa';\r\nimport ZangoDb from \"zangodb\"\r\nimport { FileDownloader, LoggerEvent,prepareSongDownload } from \"lib/SongUtils\"\r\nimport { asyncConfirm } from \"components/AsyncPrompts\"\r\nimport { appName } from \"appConfig\"\r\nimport { SimpleMenu } from 'components/SimpleMenu'\r\nclass ErrorPage extends Component {\r\n    constructor(props) {\r\n        super(props)\r\n        this.db = new ZangoDb.Db(appName, { songs: [] })\r\n        this.dbCol = {\r\n            songs: this.db.collection(\"songs\")\r\n\r\n        }\r\n        this.state = {\r\n            songs: []\r\n        }\r\n\r\n    }\r\n    componentDidMount(){\r\n        this.syncSongs()\r\n    }\r\n    downloadAllSongs = () => {\r\n        let toDownload = []\r\n        const { songs } = this.state\r\n        songs.forEach(song => {\r\n            if (song._id) delete song._id\r\n            if(appName === \"Sky\"){\r\n                song = prepareSongDownload(song)\r\n            }\r\n            Array.isArray(song) ? toDownload.push(...song) : toDownload.push(song)\r\n        })\r\n        let fileDownloader = new FileDownloader()\r\n        let json = JSON.stringify(toDownload)\r\n        let date = new Date().toISOString().split('T')[0]\r\n        fileDownloader.download(json,`${appName}_Backup_${date}.json`)\r\n        new LoggerEvent(\"Success\", \"Song backup downloaded\").trigger()\r\n    }\r\n    syncSongs = async () => {\r\n        let songs = await this.dbCol.songs.find().toArray()\r\n        this.setState({\r\n            songs: songs\r\n        })\r\n    }\r\n    deleteSong = async (name) => {\r\n        if (await asyncConfirm(\"Are you sure you want to delete the song: \" + name)) {\r\n            this.dbCol.songs.remove({ name: name }, this.syncSongs)\r\n        }\r\n\r\n    }\r\n    deleteAllSongs = async () =>{\r\n        if (await asyncConfirm(\"Are you sure you want to delete ALL SONGS?\")) {\r\n            this.dbCol.songs.remove({}, this.syncSongs)\r\n        }\r\n    }\r\n    resetSettings = () => {\r\n        localStorage.removeItem(appName+\"_Composer_Settings\")\r\n        localStorage.removeItem(appName+\"_Main_Settings\")\r\n        new LoggerEvent(\"Success\", \"Settings have been reset\").trigger()\r\n    }\r\n    downloadSong = (song) => {\r\n        if (song._id) delete song._id\r\n        let songName = song.name\r\n        if(appName === \"Sky\"){\r\n            song = prepareSongDownload(song)\r\n        }\r\n        if(!Array.isArray(song)) song = [song]\r\n        song.forEach(song1 => {\r\n            song1.data.appName = appName\r\n        })\r\n        let json = JSON.stringify(song)\r\n        let fileDownloader = new FileDownloader()\r\n        fileDownloader.download(json,`${songName}.${appName.toLowerCase()}sheet.json`)\r\n        new LoggerEvent(\"Success\", \"Song downloaded\").trigger()\r\n    }\r\n    render() {\r\n        return <div className=\"error-page app\">\r\n            <SimpleMenu functions={{changePage: this.props.changePage}}/>\r\n            <div className=\"error-text-wrapper\">\r\n                There seems to be an error. <br />\r\n                Here you can download or delete your songs,\r\n                try to find what song caused the error and remove it.\r\n            </div>\r\n            <div className=\"error-buttons-wrapper\">\r\n                <button className=\"genshin-button\" onClick={this.resetSettings}>\r\n                    Reset settings\r\n                </button>\r\n                <button className=\"genshin-button\" onClick={this.deleteAllSongs}>\r\n                    Delete all songs\r\n                </button>\r\n            </div>\r\n            <div className=\"error-songs-wrapper\">\r\n                {this.state.songs.map(song => \r\n                    <SongRow\r\n                        key={song?.name}\r\n                        data={song}\r\n                        functions={{\r\n                            deleteSong: this.deleteSong,\r\n                            downloadSong: this.downloadSong\r\n                        }}\r\n                    />\r\n                )}\r\n            </div>\r\n        </div>\r\n    }\r\n}\r\n\r\nfunction SongRow(props) {\r\n    let data = props.data\r\n    let deleteSong = props.functions.deleteSong\r\n    let downloadSong = props.functions.downloadSong\r\n    return <div className=\"song-row\">\r\n        <div className=\"song-name\">\r\n            {data.name}\r\n        </div>\r\n        <div className=\"song-buttons-wrapper\">\r\n            <button className=\"song-button\" onClick={() => downloadSong(data)}>\r\n                <FaDownload />\r\n\r\n            </button>\r\n            <button className=\"song-button\" onClick={() => deleteSong(data.name)}>\r\n                <FaTrash color=\"#ed4557\" />\r\n            </button>\r\n        </div>\r\n    </div>\r\n}\r\n\r\nexport default ErrorPage","import { SimpleMenu } from 'components/SimpleMenu'\r\nimport MenuItem from 'components/MenuItem'\r\nimport { FaGithub } from 'react-icons/fa'\r\nimport './Changelog.css'\r\nexport default function Changelogpage(props) {\r\n    return <div className='changelog-page'>\r\n        <div className='changelog-page-title'>\r\n            Changelog\r\n        </div>\r\n        <SimpleMenu functions={{changePage: props.changePage}}>\r\n            <MenuItem>\r\n                <a href='https://github.com/Specy/genshin-music' className='icon' target=\"_blank\" rel='noreferrer'>\r\n                    <FaGithub />\r\n                </a>\r\n            </MenuItem>\r\n        </SimpleMenu>\r\n        {changelogs.map(e => <ChangelogRow\r\n            data={e}\r\n            key={e.version}\r\n        />)}\r\n        <div className='changelog-ending'>\r\n\r\n        </div>\r\n    </div>\r\n}\r\n\r\nfunction ChangelogRow(props) {\r\n    const { version, title, changes, date } = props.data\r\n    return <div className='changelog-wrapper'>\r\n        <div className='changelog-title'>\r\n            <div className='clt-1'>\r\n                {version}\r\n            </div>\r\n            <div className='clt-2'>\r\n                {date}\r\n            </div>\r\n        </div>\r\n        <div className='changelog-list'>\r\n            <div className='cll-1'>\r\n                {title}\r\n            </div>\r\n            <ul>\r\n                {changes.map((e, i) =>\r\n                    <li key={i}>\r\n                        {e.split('$l').map((item, i, arr) => {\r\n                            if (i === 0) {\r\n                                return <div key={i}>{item}</div>\r\n                            }\r\n                            return <p key={i} className='cll-new-line'>\r\n                                {item}\r\n                            </p>\r\n                        })}\r\n                    </li>\r\n                )}\r\n            </ul>\r\n        </div>\r\n\r\n    </div>\r\n}\r\nconst changelogs = [\r\n    {\r\n        version: '2.1',\r\n        title: 'Home menu and pages',\r\n        date: '2021 - 11/12',\r\n        changes: [\r\n            'Restructured code',\r\n            'Added opacity to some elements',\r\n            'Changed margins and padding of some elements',\r\n            'Added home page',\r\n            'Added Partners page',\r\n            'Added shortcuts for main page',\r\n            'Fixed loading bug in composer and main page',\r\n            'Added Donate page'\r\n        ]\r\n    },\r\n    {\r\n        version: '2.0',\r\n        title: 'Approaching circles',\r\n        date: '2021 - 28/11',\r\n        changes: [\r\n            `Added Approaching cirlces mode, a new way to learn a song, or a way to challange yourself.\r\n            You can find it in the main page, next to the practice button`,\r\n            `Rewrite of the main page to increase overall performance`,\r\n            `Added changelog page`,\r\n            `Added audio recording feature in main page and composer`,\r\n            `Added tabs autoplay (composer) on pc as a setting`,\r\n            `Added note animations when pressing the note`,\r\n            `Added possibility to change background image from URL`,\r\n            `Updated info page`,\r\n            `In the composer you can now press shift + note name to add a note`,\r\n            `In the composer you can press up/down keys to change layer`,\r\n            `While in the composer on PC, you can now add new notes by simply pressing the PC keyboard while in \"playing\" mode`\r\n        ]\r\n    }, {\r\n        version: '1.7',\r\n        title: 'Zither',\r\n        date: '2021 - 20/10',\r\n        changes: [\r\n            '(For genshin) Added Zither',\r\n            'Added back \"do re mi\" format'\r\n        ]\r\n    }, {\r\n        version: '1.6',\r\n        title: 'Performance tweaks',\r\n        date: '2021 - 17/10',\r\n        changes: [\r\n            'Performance of composer improved by 2x',\r\n            'Added note names for genshin (made it a setting)',\r\n            'Fixed instrument volume bug',\r\n            'Fixed keyboard layout issues',\r\n            'Fixed other small bugs'\r\n        ]\r\n    }, {\r\n        version: '1.5',\r\n        title: 'MIDI import',\r\n        date: '2021 - 14/10',\r\n        changes: [\r\n            `Added to both Sky and Genshin music nightly the MIDI import feature $l\r\n            - Music track selection (select or deselect which tracks to include) $l\r\n            - Instrument track selection (select what instrument to give to each track) $l\r\n            - Track info (get info on how successful your parsing was, accidentals and notes out of range) $l\r\n            - Change note offset (in case that the song is outside of the octaves available) \r\n            `\r\n        ]\r\n    }, {\r\n        version: '1.4',\r\n        title: 'Song library',\r\n        date: '2021 - 28/08',\r\n        changes: [\r\n            'Added song library integration, directly import songs from the app (700+ songs)',\r\n            'Bug fixes'\r\n        ]\r\n    }, {\r\n        version: '1.3',\r\n        title: 'New audio files',\r\n        date: '2021 - 25/08',\r\n        changes: [\r\n            'Changed audio files',\r\n            'Added ocarina',\r\n            'Removed support button in TWA',\r\n            'Bug fixes'\r\n        ]\r\n    }, {\r\n        version: '1.2',\r\n        title: 'Bug fixes and PWA',\r\n        date: '2021 - 18/08',\r\n        changes: [\r\n            \"(For sky) Fixed bug where sheets couldn't be imported in sky studio\",\r\n            'Changed app install to more modern approach with description and images'\r\n        ]\r\n    }, {\r\n        version: '1.1',\r\n        title: 'Sheets compatibility',\r\n        date: '2021 - 07/08',\r\n        changes: [\r\n            '(For sky) Added backwards compatibility for sheets, now sheets made in sky music nightly can be imported into sky music and sky studio (with some losses)',\r\n            'Bug fixes',\r\n            'General improvement in performance'\r\n        ]\r\n    }, {\r\n        version: '1.0',\r\n        title: 'Release',\r\n        date: '2021 - 22/05',\r\n        changes: [\r\n            '3 Instruments composition',\r\n            'Better performance than previous version',\r\n            'Better practice tool',\r\n            'Better interface',\r\n            'Breakpoints for the composer',\r\n            'New features for both composer and main page',\r\n            'Feature rich customisability to make learning and composition easier'\r\n        ]\r\n    }\r\n]\r\n","import './Partners.css'\r\nimport { SimpleMenu } from 'components/SimpleMenu'\r\nexport default function Partners(props) {\r\n    return <div className='partners-page'>\r\n        <SimpleMenu functions={{ changePage: props.changePage }} />\r\n        <div className='partner-wrapper'>\r\n            <Partner\r\n                name='Specy'\r\n                description='The youtube channel that collects videos created by users of this app'\r\n            >\r\n                <Iframe\r\n                    src='https://www.youtube.com/embed/Sh7kqYVMjwM'\r\n                    title=\"Specy\"\r\n                />\r\n            </Partner>\r\n            <Partner\r\n                name='ChaconneScott_ACG'\r\n                description='YouTube pianist and arranger, features Genshin Impact OST'\r\n            >\r\n                <Iframe\r\n                    src='https://www.youtube.com/embed/ltE8zfGfUVo'\r\n                    title=\"ChaconneScott_ACG\"\r\n                />\r\n            </Partner>\r\n            <Partner\r\n                name='uma✿'\r\n                description={`Arranges music, primarily from anime and games for Sky and Genshin.`}\r\n            >\r\n                <Iframe\r\n                    src='https://www.youtube.com/embed/7aIkAGvp9Y0'\r\n                    title=\"uma\"\r\n                />\r\n            </Partner>\r\n        </div>\r\n\r\n    </div>\r\n}\r\n\r\nfunction Iframe(props) {\r\n    return <iframe\r\n        src={props.src}\r\n        title={props.src}\r\n        frameBorder=\"0\"\r\n        allow=\"autoplay; picture-in-picture\"\r\n        allowFullScreen\r\n    >\r\n    </iframe>\r\n}\r\nfunction Partner(props) {\r\n    return <div className='partner'>\r\n        <div className='partner-title'>\r\n            {props.name}\r\n        </div>\r\n        <div className='partner-description'>\r\n            {props.description}\r\n        </div>\r\n        {props.children}\r\n    </div>\r\n}\r\n","import './Home.css'\r\nimport { FaCompactDisc, FaTimes } from 'react-icons/fa'\r\nimport { BsMusicPlayerFill } from 'react-icons/bs'\r\nimport { appName, isTwa } from 'appConfig'\r\nexport default function Home(props) {\r\n    const to = props.changePage\r\n    const { data, askForStorage, hasVisited } = props\r\n    const homeClass = data.isInPosition ? \"home\" : \"home home-visible\"\r\n    const breakpoint = window.innerWidth > 900\r\n    return <div className={homeClass}>\r\n        <FaTimes className='close-home' onClick={() => props.toggleHome(false)} />\r\n        {(breakpoint || !hasVisited) && <div className='home-top'>\r\n            <div className='home-title'>\r\n                {appName} Music Nightly\r\n            </div>\r\n            <div className='home-top-text'>\r\n                An app where you can create, practice and play songs for {appName}\r\n            </div>\r\n        </div>  \r\n        }\r\n\r\n        {!hasVisited && <div className='home-welcome'>\r\n            <div>\r\n                {!isTwa() && <div className='home-spacing'>\r\n                    To have the webapp fullscreen and better view, please add the website to the home screen\r\n                </div>}\r\n                <div  className='home-spacing'>\r\n                    <div className=\"red-text\">WARNING</div>:\r\n                    Clearing your browser cache / storage might delete your songs, make sure you make backups\r\n                </div>\r\n                {data.hasPersistentStorage ?\r\n                    <div>\r\n                        <div className=\"red-text\">WARNING</div>: Click the button below to make sure that your browser won't delete your songs if you\r\n                        lack storage\r\n                    </div>\r\n                    : null\r\n                }\r\n            </div>\r\n            <div style={{display:'flex', justifyContent:'flex-end'}}>\r\n                <button className=\"home-accept-storage\" onClick={askForStorage}>\r\n                    Confirm\r\n                </button>\r\n            </div>\r\n\r\n        </div>}\r\n        <div className='home-content'>\r\n            <MainContentelement\r\n                icon={<FaCompactDisc />}\r\n                title='Composer'\r\n                background={`./manifestData/composer.png`}\r\n                onClick={() => to(\"Composer\")}\r\n            >\r\n                Create or edit songs with a fully fledged music composer. Also with MIDI.\r\n            </MainContentelement>\r\n            <MainContentelement\r\n                icon={<BsMusicPlayerFill />}\r\n                title='Player'\r\n                background={`./manifestData/main.png`}\r\n                onClick={() => to(\"\")}\r\n            >\r\n                Play, download, record and import songs. Learn a song with approaching circle\r\n                mode and practice mode.\r\n            </MainContentelement>\r\n        </div>\r\n        <Separator> Other pages </Separator>\r\n        <div className='page-redirect-wrapper'>\r\n            <PageRedirect onClick={() => to(\"Changelog\")}>\r\n                Changelog\r\n            </PageRedirect>\r\n            {!isTwa() &&\r\n                <PageRedirect onClick={() => to(\"Donate\")}>\r\n                    Donate\r\n                </PageRedirect>\r\n            }\r\n            <PageRedirect onClick={() => to(\"Partners\")}>\r\n                Partners\r\n            </PageRedirect>\r\n        </div>\r\n        <div className='home-dont-show-again' onClick={() => props.setDontShowHome(!data.canShow)}>\r\n            <input type='checkbox' checked={!data.canShow} readOnly />\r\n            Hide on open\r\n        </div>\r\n    </div>\r\n}\r\n\r\nfunction PageRedirect(props) {\r\n    return <button onClick={props.onClick}>\r\n        {props.children}\r\n    </button>\r\n}\r\nfunction MainContentelement(props) {\r\n    return <div className='home-content-element' onClick={props.onClick}>\r\n        <div className='home-content-background' style={{ backgroundImage: `url(${props.background})` }}>\r\n        </div>\r\n        <div className='home-content-main'>\r\n            <div className='home-content-title'>\r\n                {props.icon} {props.title}\r\n            </div>\r\n            <div className='home-content-text'>\r\n                {props.children}\r\n            </div>\r\n            <div className='home-content-open'>\r\n                <button>\r\n                    OPEN\r\n                </button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n}\r\n\r\nfunction Separator(props) {\r\n    return <div className='home-separator'>\r\n        {props.children}\r\n    </div>\r\n}\r\n\r\n/*\r\n        <div className='redirect-wrapper' style={{display:'none'}}>\r\n            <PageButton name='Composer' onClick={() => to(\"/Composer\")}>\r\n                <FaCompactDisc className='redirect-icon' />\r\n            </PageButton>\r\n            <PageButton name='Player' onClick={() => to(\"/Composer\")}>\r\n                <BsMusicPlayerFill className='redirect-icon' />\r\n            </PageButton>\r\n        </div>\r\n        function PageButton(props) {\r\n            return <button className='redirect-button' onClick={props.onClick}>\r\n                {props.children}\r\n                <div>\r\n                    {props.name}\r\n                </div>\r\n            </button>\r\n        }\r\n*/\r\n","// This optional code is used to register a service worker.\r\n// register() is not called by default.\r\n\r\n// This lets the app load faster on subsequent visits in production, and gives\r\n// it offline capabilities. However, it also means that developers (and users)\r\n// will only see deployed updates on subsequent visits to a page, after all the\r\n// existing tabs open on the page have been closed, since previously cached\r\n// resources are updated in the background.\r\n\r\n// To learn more about the benefits of this model and instructions on how to\r\n// opt-in, read https://cra.link/PWA\r\n\r\nconst isLocalhost = Boolean(\r\n  window.location.hostname === 'localhost' ||\r\n    // [::1] is the IPv6 localhost address.\r\n    window.location.hostname === '[::1]' ||\r\n    // 127.0.0.0/8 are considered localhost for IPv4.\r\n    window.location.hostname.match(/^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/)\r\n);\r\n\r\nexport function register(config) {\r\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\r\n    // The URL constructor is available in all browsers that support SW.\r\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\r\n    if (publicUrl.origin !== window.location.origin) {\r\n      // Our service worker won't work if PUBLIC_URL is on a different origin\r\n      // from what our page is served on. This might happen if a CDN is used to\r\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\r\n      return;\r\n    }\r\n\r\n    window.addEventListener('load', () => {\r\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\r\n      if (isLocalhost) {\r\n        // This is running on localhost. Let's check if a service worker still exists or not.\r\n        checkValidServiceWorker(swUrl, config);\r\n\r\n        // Add some additional logging to localhost, pointing developers to the\r\n        // service worker/PWA documentation.\r\n        navigator.serviceWorker.ready.then(() => {\r\n          console.log(\r\n            'This web app is being served cache-first by a service ' +\r\n              'worker. To learn more, visit https://cra.link/PWA'\r\n          );\r\n        });\r\n      } else {\r\n        // Is not localhost. Just register service worker\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction registerValidSW(swUrl, config) {\r\n  navigator.serviceWorker\r\n    .register(swUrl)\r\n    .then((registration) => {\r\n      registration.onupdatefound = () => {\r\n        const installingWorker = registration.installing;\r\n        if (installingWorker == null) {\r\n          return;\r\n        }\r\n        installingWorker.onstatechange = () => {\r\n          if (installingWorker.state === 'installed') {\r\n            if (navigator.serviceWorker.controller) {\r\n              // At this point, the updated precached content has been fetched,\r\n              // but the previous service worker will still serve the older\r\n              // content until all client tabs are closed.\r\n              console.log(\r\n                'New content is available and will be used when all ' +\r\n                  'tabs for this page are closed. See https://cra.link/PWA.'\r\n              );\r\n\r\n              // Execute callback\r\n              if (config && config.onUpdate) {\r\n                config.onUpdate(registration);\r\n              }\r\n            } else {\r\n              // At this point, everything has been precached.\r\n              // It's the perfect time to display a\r\n              // \"Content is cached for offline use.\" message.\r\n              console.log('Content is cached for offline use.');\r\n\r\n              // Execute callback\r\n              if (config && config.onSuccess) {\r\n                config.onSuccess(registration);\r\n              }\r\n            }\r\n          }\r\n        };\r\n      };\r\n    })\r\n    .catch((error) => {\r\n      console.error('Error during service worker registration:', error);\r\n    });\r\n}\r\n\r\nfunction checkValidServiceWorker(swUrl, config) {\r\n  // Check if the service worker can be found. If it can't reload the page.\r\n  fetch(swUrl, {\r\n    headers: { 'Service-Worker': 'script' },\r\n  })\r\n    .then((response) => {\r\n      // Ensure service worker exists, and that we really are getting a JS file.\r\n      const contentType = response.headers.get('content-type');\r\n      if (\r\n        response.status === 404 ||\r\n        (contentType != null && contentType.indexOf('javascript') === -1)\r\n      ) {\r\n        // No service worker found. Probably a different app. Reload the page.\r\n        navigator.serviceWorker.ready.then((registration) => {\r\n          registration.unregister().then(() => {\r\n            window.location.reload();\r\n          });\r\n        });\r\n      } else {\r\n        // Service worker found. Proceed as normal.\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    })\r\n    .catch(() => {\r\n      console.log('No internet connection found. App is running in offline mode.');\r\n    });\r\n}\r\n\r\nexport function unregister() {\r\n  if ('serviceWorker' in navigator) {\r\n    navigator.serviceWorker.ready\r\n      .then((registration) => {\r\n        registration.unregister();\r\n      })\r\n      .catch((error) => {\r\n        console.error(error.message);\r\n      });\r\n  }\r\n}\r\n","export default function FloatingMessage(props){\r\n    const { title, text, visible, onClick} = props\r\n\tlet classes = visible ? \"floating-message floating-message-visible\" : \"floating-message\"\r\n    return <div className={classes} onClick={onClick}>\r\n    <div className=\"floating-message-title\">\r\n        {title}\r\n    </div>\r\n    <div className=\"floating-message-text\">\r\n        {text}\r\n    </div>\r\n</div>\r\n}","export default __webpack_public_path__ + \"static/media/paypalme.45abe55e.png\";","export default __webpack_public_path__ + \"static/media/buymeacoffee.b124acdd.svg\";","import './Donate.css'\r\nimport paypalImg from 'assets/images/paypalme.png'\r\nimport buyMeACoffeeImg from 'assets/images/buymeacoffee.svg'\r\nimport kofiImg from 'assets/images/kofi.png'\r\nimport { SimpleMenu } from 'components/SimpleMenu'\r\nexport default function Donate(props) {\r\n    return <div className='donate-page'>\r\n        <SimpleMenu functions={{changePage: props.changePage}}/>\r\n        <div className=\"donate-text\">\r\n            Each App I make takes months of learning and development. Added to that\r\n            are also the costs of hosting. With a higher budget I can afford to not\r\n            worry so much about how much I spend on the server, giving you the best\r\n            possible experience.<br />\r\n            I care about giving users all features without\r\n            having to pay for it, neither having intrusive ads which can be annoying.\r\n            For this same reason, there is no source of income except donations.\r\n            <br /><br />\r\n            I would be really thankful if you could consider donating in order to fund\r\n            development and costs.\r\n        </div>\r\n        <div className=\"donation-wrapper\">\r\n            <a href=\"https://paypal.me/specyDev\" target=\"_blank\" className=\"paypal\" rel=\"noreferrer\">\r\n                <img src={paypalImg} alt=\"paypalme\" style={{ height: \"4rem\" }} />\r\n            </a>\r\n            <a href=\"https://ko-fi.com/specy\" target=\"_blank\" className=\"kofi\" rel=\"noreferrer\">\r\n                <img src={kofiImg} alt=\"kofi\" style={{ height: \"3rem\" }} />\r\n            </a>\r\n            <a href=\"https://www.buymeacoffee.com/specy\" target=\"_blank\" rel=\"noreferrer\">\r\n                <img src={buyMeACoffeeImg} alt=\"buymeacoffee\" style={{ height: \"4rem\" }} />\r\n            </a>\r\n        </div>\r\n    </div>\r\n}","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAWUAAACNCAMAAABYO5vSAAABIFBMVEX///8Auf4mJyoAAAD/XlsAu/8AoNwAt/4wMDAAtf7w8PAAv/8VFxsbHSDz8/OTk5XBwcLa2toICxG0tLT/XGP/W2kAvf//XWD/Wm3/W2jj4+QAJjXR0dEAR2L/WXEAlMsANUn/WHZUVVcABQ2dnZ0AaZDs+v+EhIYZGx7/V3r/WHT/U1AATWtERETE7P/V8v8Are6srK07PD9nZ2mG2P5Exv6h4P+25/9bW10AWXoREREAPlVxcnPj9f9hzP7R8f+q4v8Ae6n/3+NSy/7/S0d60P4AdaEAGCAAir7/vsX/ydD/fJH/Y4P/r73/7fD/iJP/oqz/ZHX/19r/Rmj/R1v/l6X/foj/tLX/fHn/qqj/aWYAExn/l5X/dnT/hoT/m5qa6M4eAAAQ3klEQVR4nO2d/UPaVhfHJSkGSMJLaGkbaXUEgVWxvCpWRK3Vdt3mttq12/p0+///iycvJDn35r4kMUAt+f6kQMLNJ4dzzzn3JRsbqb51tU7PDkdXV7PZ2NTl7OpqdHhw2lp1q74jtQ5Gs7Es5SVLGVv2n3mpNp6Njk5X3b7vQAejcdaDG5TJOiNfHaVGfQcdXebzVMAAdT4/PkxBx1HraJYJg9gjfXmego6os1ktAmJH+czl0arbfZ90dkn3xEyDlsYp55A6GEc2Y2DQtfNVt/8+yGQcG3HKOZxaszsytjmPz1Z9Hd+0DrPxfQWUNFr1lXy7OpMTMOQ55mzaDZI1SoyxpfxlGj4H1Ron4yw8SbWDVV/TN6eDhDwywjn1zqiS9Rau8pervq5vSknEbyRJcloXdZW4SwaYs2no7KglLwyypbQPtHS6gH4PKp9i3th4mV0oYwtzmqCc1hYN2XTO627NrSVANrXmXeBiOz5fax3QLS6Ew1Rb46LGbFmQM9J41de6Mh0uKOMjYp6t+mpXpLMlQjbjucNVX+9KtKTwwpP0ctVXvAotzynPJa/6ilegZTplR2vomk+XbcmZdUy1L1dAOVNb9VUvWUdL9xeW1m2ICokvsgmLgXmtMu0R8Be1zGbC6pk3Tq6RYH8HKWCx3C9NJ9N2v8z75Clg3NsVk5exc3zRy8pBzPe9A+xPDENRVFVVFEMt6czPXnmmnO1tLQCyo5Prnhww6HsdNPcHmir4Ujp95/V6e9iYTKtF5MPAlDOLg2zpeBO3Z+n+GrPe0ARMYsV8vTDQLOtWjRxi275Xlm138SqXqIRXrwDnHpbIczxzvd+v1rkXXGwOh80i92OJqmqoOGRBaZtvDJX5f50J+HjL7/rktyaIafItqpRLXZfzRQZxG8zB1uJU1DRNFDg9S1nRVFUTKom2maOyEWAsCOrQbLPi/asBYwYBRs/CsCCb0JuDuX/uQbchseYbTeYt1pjmXHY+pQ6WaM31oCFbTTAttOi/IwLK/hVnN00IwuKaVs7ZmLV3EHOeXptruvaiTqif8SCb96KZfJNp6hIpKyUa5XMJpZxbZOOac68BMEtX1E/7zTcK1A+VRc+SGotoMlHNQMfnYS10SJTHmSVS3tAnNuZriJn6YZHUXkxV/0OCupAmkwQgq5qmmEGF+UfHME15Qyf5ZRjGLYGya84AMzUzKYSg3IfX211Um3GBrs+YlHW9XJp2B92p00l7HgP8tmByvRTK5k/cku+bqf1fCMoQsiD2F9ZmTFPPK2jB7yyLlmWbNi76ffZ42bZs9s825p4f0FGmDfApN4G7EJThAtuMauCZK+k7C81GThhMAH9kSHVJlB1rPvHSE+mc/DEuZQSytoA4nybPKbBDTE/QYSROudro2hpOmygl2ze/8zBT8j8eZaSjN9rJtZunoucwVHaByBV0GElT1mEJo4vc9Yb5yhfPZVBmGnEolxCfXEqs2Xz5lJVw+aa0QMpVtFQEf9E6Ysx58uxENuU2THGNJSYk0Skf5JdHWeyCDHhq/r/jhhmUkSkmZQSyVk2s0WEUlfIogi2/NoW/dvP6w0/vgy87siifWIMl29cnDmb/PduYN12fQXbMLMpt6C40djVJrzdL7em0XapW6ClkFPEp68gXoeVeBuX3P//yo6lffv71xn/xw2/Pby09+fSedIxF+ZmczWZrcm37LeY0JkhqQvxOBuUpTEYUVkdfbw9UQ1E6qtpRNE1o9MP1VxQV6pbKfuLRr88FT1saCLlB2wPdyoej/PuPrn54cfvznPPNp9vntp48efLxjw/BoxzK8w4us2Nh9o2uD4M5cvmTTnkIIbMqnk1V8xNe55YYk/gV0qmhWQKnVDRXXa+JTusUL79G3XKmtk2k/OEHj7GlF7e/Wq9+9hmbevTx98BxkHImm7Gs+ZX3puUyjJ7rmIlTE6mUEcgDunH2O6SijioOY9pzQyGczjutNr97fdFt2fywcykE5Q+3ALEJ+cWL2z83NhxDfjLXo0cEzAjlTM36oYAkOAccM7kuR6M8BBfbGVBdrT4hFdrtg9RYuTilEOdhnpctvMTQmP9yR2Eo/wEYm4hfmHBv//z0xCNsIX706OnTjz9hB6KUM/Ix0gFajvnCdRnE7o9CGUJWGtTKfVUhloDnAOIkig3GCe3G2I0EXeM8hr8kUMYL5n//AKzYZozasIPY1MOH2BVjlG2v7+Nqm//sMrs/MmX4s9XopYsSzZDnBLqRB1aKA+YZ52OroIrvUsZGlG3KWCm8+AdixYCwy/jpnPHDx5/RQzHKmZoVz3mRrVXM2Pe6P1L2R6JchJAZFtlmQzZ/37nIUR3Plp3uLkC5leVT/nCLIH5OQ2xRfsimbLsMLxO2KnM77lvE7I9AGYVML100MchWFKegLsTrnEKrzer8rPJ2kUj5ZYZP+fMtFTEkbEF+vHeDHBqgfG2+4JGpmP9seZRJlfwgZQSySM+qy7BYJyhit92sVvulhgj7L4U1mEiSrjKNef4zDVA+k/iUf38eQPyEiNjUHho0BzzGO5iYWKHcW/ctYvEzQLk48MfUBIMeJxSQGT9gZlWxn4NePWqFSRc0pWMKnF7tOFI0tz2xKP9HMuOnJMZ8ytuQctEazfYokwJmnHJhAC6PVboYgpuhTdFurgQxh6sOA5WbbVNDvx3TtqNS33XzAcpYUkKxZQ7ix64ePOBRvsBt2fMYxHoRRllHRucZpQs4ISU4YlT2vUbcgUL/FEowvwlQxueGE/0y31HYhC3toWWjgF/ehZQtv3ySDU9ZHyB+gJEmg1jAIFg8cNqkt0MIUA42I0D5nOQxsD7h/UcsLKYhNvUGPZQYyXm2ZcUYz9xIjpj8IZR1Aet6qAzq/mFkzwtzOOpZWIpG+TCEX775CAMKBmJTf6GHsrOSKsxKiOulAGWtjEPuUBMS32vSPIJv7AbqeAq4yKXSaJRHJMr47f0Uxoodh4Gl2OwMewozbOJsgQISj+GiztcCDoHSu9W9HhAZg+4PNBGXRqosJWDLeB3j80dqb4cLOxKlLG+j1aIuLOPHoCxQyso+AvrsuolPwjdWcrqo5IKYE/DLOOXiw3CIH+z9jR2JUJZtf+Gf3A6X3con1y8TlSOWIqb+MD41Dqlqwc9UKBW3TvBeRaOMxxjkKv7nj2xH4eqfwLX4lGt2RiKC2TbWZIF9f34RJ8YgXz9x9iGo6VArFQXfVL3+sUTLn7WAMUejjMfLlLGSvx5zrNgx5cBoiUPZUmb7mQ0ZuNIcHMQOTVlFUJBcsw+QNR23G/zQkJY+iwGS0SjjuR9tROorF7EJ+XPgMIvy1vX18f7JfLVKG33vi//NvNzPbfekivyuCclbxbsPHcY8GM8x+zMGqXXNu9pyWMobXx+wEZuQ/xc8Cp8pAC3vFVJd5tYx5s0eYnNdhGD5sq5hF0lU28vBvaCHPO/bVHCKfzTKeE2OSrn4lUWYAnk+udNVFzbIKuGL4Jt5NTnHqOywawKKFISuCRBgzITxi5gewxKl9yO4pWiU8foyfabAzT9syP+SDir4iDtDpL+3Z30CU+bWl+3LdZLzQg55ETfYajjK3q3yKBeDC8vsLyB0sdEo42MljPkYN9Ehm9FaqV0qlZr9so7+6AoqrHralDljJQKo2dcRGiIWrgHKDL/sd3XA5zSFQFIiDkhuJyJlbNyPNbeIgXnvK/1yiLIXS20jC/9IH0Mog4ERdCxZRV0zSEoYI6igoBRjulFEyqPwlOlOY+8vyhEUFbu4v+CPYQsGtCk4io2v2fEtnbWYJ0xQTVdEyucEytQy1euEINuWvI9YMnc+BhYv5GA8gLrmCrgD9Kkafg8aZ5FgRMoHhBlcIvXkr/cScBd1yyf75fs5Zc7cItws0WwYKawVKa8jAstR4hTyI1LG5sk5a1fpZyf45qiQS3afsoN+LXeeXODH30cqOxo0Wi+tY6QlfrWIuDCEp4iU8SCDQ9n0zZg506ILWvNsQxafZfAdHIifZlBGR+2ROrIfpMGCGyLwU2CFe/TLiEgZ6/54lM30BMFMTEaox1bnK96vA7tk8OYvEzoyJFWDQRsY9aPFcqBkEX2AdSM6ZcwxcymbyfZeLMiFcrvjMP6yHdjzhTsXn0BZR4JpWOQEbwQLPZbg6Gus5a5RKW9EtGVT/+5FglzQ9XK/PfDC/OtMcKdLyu4NTMrYzBawWGkKrZzgM3QAmZW50BWZ8hi9XoNPeeO/OeZA1T6gKZ5JGce9gCFnQqyRIoa+yKIH4JorcGV2cOJtBd4E+vpuliJTRh2z/CUE5Y2/34SDXMcY71wTGYdY70dOMCYU1wxfV3OY40WGaTvxVmJGpoxuBxyO8sbnN8R6Mi6k8rmzu5khM6ZEy3zKfsHekj+3At2GRSkBc9bbaKQdb/FDZMqoywhJ2cT8hrheB5VD+cvbZ7sXm5lscP8tT5S9+3iU4cwLAbrmKTKioqjTsp3gFapDBR1ribkUMzplxGXY+xaFub8fKIvPEFkZyO7YGpEibtnnmTJ/TwFaSaJJds0g/3Pe0cRctyuIGlqoj73TQ3TKcH+MjLwVknIoobPtqQqxPwa18APnHYK4rcwZl6UiCqfolBGXkSxla+XIO/4O5dS9XkJQLsC6Ecjj+iEw45Xp8IpBGdblbMpxsiGSilZRfJP7wCT6vkUhKCMlfRj8NrmY77BnSQzKLWjL1oB+UmuarUmdX3pUup7DoO7BFYYyrBshNQlkF5ig1E5sS+ZRDqyRsgX6P3vua1J7IFhu+YTrlln7yfmUGZUzP6AwkBSjrEKfjUnBw+hIAj8gQnXaew8ZlwV7I9ozgJLaycoK4y64bpm1N6I3bkTYHciXO69Zw7LlwpDmNVSxfbcN/twBXoWU1XiD4ehEDhjMiYk5Zns/F77DYO3z6cbD7F0PdaFjkwvae3mAxW7O2YzGXa+wItrnVVRiuwbOrwtzvSCYsx1zIjtkWF5ZPOY7DOaetWVruYxidNnVBn2SU9QGsTspNzooaFUThglYUaWhGEZnSLn5bWsRfA53/P7+y/aszyT2U9WFcKbM2X+5UG23S/x+qlCh3ge9PxwYmmJL0wbT6p12bvBVKdfpZypUKpXAHYDGvJ8I5rpdTL7me+VlbL9c1Mv9JmleyJLle+Zsz94upHun1KTglDz3uZC/g33xo8jnUes5NbRus64X8WUWxUI9oHLVVXOuhnOGE667WLNnPMCRqdrmW7z4HkvHfMj5NXteCZzLVes9uzvjrRAFjLV79g76HKna5h0fQrB1QRjdC5ry/X3yQFwh66Wycu9if2eLrB1MJ/tzHe86uujJYZ4VuIbPRMOfbJutybHFrNmDr1j1Fa9Cp3wuiYr5cIfvV/iKqQVDXrf4wtUofYbwMpQ+D3spWtqz3WmTA9ZC+KKpRYmy4fK6qMUnlICk9QwvfL1cgjXf46fNJaXFY17DxDqo0+xiu8A1zUZwteSFYl7vjs9Xa3EBnVSjP2du7TRbUBYoyescJwe0mGQ7z3ou5TrqYAF9IGUp1DqrdZmwOUu1NLggKFmvkb+kPF9u3XUgJ8ZZyqapCFWHyXhnKfXITLWuEsAsjdMgmaOD8R3dRl5OnUUInY3z8Q06ZRxaZzMpFmdJGqfRWwS9nGUjG7SUuUwZR1TrKJJBS/nxYVqziKPWoZwPY9GSlK+NUsTx1ToajU2KVNQm4Iw8O0oR31mtg9FsLEt5SfJxW3/mpdp4NkoJJ6jW6dnh6Go2G4/H8ng8m11dHR6cppWKVCvR/wHDcffSeAGLqQAAAABJRU5ErkJggg==\"","export default __webpack_public_path__ + \"static/media/rotate.e7c0f107.svg\";","import React, { Component } from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport App from 'pages/Main';\r\nimport Composer from \"pages/Composer\"\r\nimport ErrorPage from \"pages/ErrorPage\"\r\nimport Changelogpage from 'pages/Changelog'\r\nimport Partners from 'pages/Partners';\r\nimport Home from 'pages/Home'; \r\nimport * as serviceWorkerRegistration from './serviceWorkerRegistration';\r\nimport { HashRouter, Route, Redirect } from \"react-router-dom\";\r\nimport { LoggerEvent, delayMs } from \"lib/SongUtils\"\r\nimport { appName, appVersion, pages,isTwa } from \"appConfig\"\r\nimport FloatingMessage from 'components/FloatingMessage'\r\nimport Donate from 'pages/Donate';\r\nimport rotateImg from \"assets/icons/rotate.svg\"\r\n\r\nclass Index extends Component {\r\n\tconstructor(props) {\r\n\t\tsuper(props)\r\n\t\tlet path = window.location.href.split(\"/\")\r\n\t\tpath = path.length === 0 ? \"\" : path = path[path.length - 1]\r\n\t\tif (!pages.includes(path)) path = \"\"\r\n\t\tconst hasVisited = localStorage.getItem(appName + \"_Visited\")\r\n\t\tlet canShowHome = localStorage.getItem(appName + \"_ShowHome\")\r\n\t\tcanShowHome = canShowHome === null ? 'true' : canShowHome\r\n\t\tthis.state = {\r\n\t\t\tfloatingMessage: {\r\n\t\t\t\ttimestamp: 0,\r\n\t\t\t\tvisible: false,\r\n\t\t\t\ttext: \"Text\",\r\n\t\t\t\ttitle: \"Title\"\r\n\t\t\t},\r\n\t\t\thomeData: {\r\n\t\t\t\tcanShow: canShowHome === 'true',\r\n\t\t\t\tvisible: canShowHome === 'true',\r\n\t\t\t\tisInPosition: false,\r\n\t\t\t\thasPersistentStorage: Boolean(navigator.storage && navigator.storage.persist)\r\n\t\t\t},\r\n\t\t\tselectedPage: path,\r\n\t\t\thasVisited: hasVisited === 'true'\r\n\t\t}\r\n\t\tthis.updateChecked = false\r\n\t}\r\n\tcomponentDidMount() {\r\n\t\twindow.addEventListener('logEvent', this.logEvent);\r\n\t\tthis.checkUpdate()\t\r\n\t}\r\n\tchangePage = (page) => {\r\n\t\tif(page === 'home') return this.toggleHome(true)\r\n\t\tif(this.state.homeData.visible) this.toggleHome(false)\r\n\t\tthis.setState({\r\n\t\t\tselectedPage: page,\r\n\t\t\thomeVisible:false\r\n\t\t})\r\n\t}\r\n\ttoggleHome = (override = false) =>{\r\n\t\t//TODO please refactor this\r\n\t\tconst lastState = this.state.homeData\r\n\t\tif(override){ //if its to be shown then just show it\r\n\t\t\treturn this.setState({\r\n\t\t\t\thomeData: {...lastState, visible:true, isInPosition:false }\r\n\t\t\t})\r\n\t\t}\r\n\t\tthis.setState({ //if it needs to be hidden, first trigger the animation\r\n\t\t\thomeData: {...lastState, isInPosition:true }\r\n\t\t},() => {\r\n\t\t\tsetTimeout(() => { //then demount it\r\n\t\t\t\tthis.setState({\r\n\t\t\t\t\thomeData: {...lastState, visible: false }\r\n\t\t\t\t})\r\n\t\t\t},150)\r\n\t\t})\r\n\t}\r\n\tsetDontShowHome = (override = false) => {\r\n\t\tlocalStorage.setItem(appName + \"_ShowHome\",override)\r\n\t\tconst lastState = this.state.homeData\r\n\t\tthis.setState({\r\n\t\t\thomeData: {...lastState, canShow:override }\r\n\t\t})\r\n\t}\r\n\tcomponentDidCatch() {\r\n\t\tthis.setState({\r\n\t\t\tselectedPage: \"ErrorPage\"\r\n\t\t})\r\n\t}\r\n\tcomponentWillUnmount() {\r\n\t\twindow.removeEventListener('logEvent', this.logEvent);\r\n\t}\r\n\taskForStorage = async () => {\r\n\t\ttry {\r\n\t\t\tif (navigator.storage && navigator.storage.persist) {\r\n\t\t\t\tlet result = await navigator.storage.persist()\r\n\t\t\t\tif (result) {\r\n\t\t\t\t\tnew LoggerEvent(\"Success\", \"Storage permission allowed\").trigger()\r\n\t\t\t\t} else {\r\n\t\t\t\t\tnew LoggerEvent(\"Warning\", \"Storage permission refused, will try next time\", 6000).trigger()\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} catch (e) {\r\n\t\t\tconsole.log(e)\r\n\t\t\tnew LoggerEvent(\"Error\", \"There was an error with setting up persistent storage\").trigger()\r\n\t\t}\r\n\t\tthis.closeWelcomeScreen()\r\n\t}\r\n\tcloseWelcomeScreen = () => {\r\n\t\tlocalStorage.setItem(appName + \"_Visited\", true)\r\n\t\tthis.setState({\r\n\t\t\thasVisited: true\r\n\t\t})\r\n\t}\r\n\thideMessage = () => {\r\n\t\tlet state = this.state\r\n\t\tstate.floatingMessage.visible = false\r\n\t\tthis.setState({\r\n\t\t\tfloatingMessage: state.floatingMessage\r\n\t\t})\r\n\t}\r\n\tcheckUpdate = async () => {\r\n\t\tawait delayMs(1500) //wait for page to render\r\n\t\tif (this.updateChecked) return\r\n\t\tlet currentVersion = appVersion\r\n\t\tlet updateMessage =\r\n\t\t\t`   - Fixed some UI issues\r\n\t\t\t\t- Added Home page\r\n\t\t\t\t- Added Some pages (Donate, Changelog, Partners)\r\n\t\t\t\t- Added shortcuts for main page (PC)\r\n\t\t\t\t`\r\n\t\tlet storedVersion = localStorage.getItem(appName + \"_Version\")\r\n\t\tif (!this.state.hasVisited) {\r\n\t\t\treturn localStorage.setItem(appName + \"_Version\", currentVersion)\r\n\t\t}\r\n\r\n\t\tif (currentVersion !== storedVersion) {\r\n\t\t\tnew LoggerEvent(\"Update V\" + currentVersion, updateMessage, 6000).trigger()\r\n\t\t\tlocalStorage.setItem(appName + \"_Version\", currentVersion)\r\n\t\t}\r\n\t\tthis.updateChecked = true\r\n\t\tif(!this.state.hasVisited) return\r\n\t\tif (navigator.storage && navigator.storage.persist) {\r\n\t\t\tlet isPersisted = await navigator.storage.persisted()\r\n\t\t\tif (!isPersisted) isPersisted = await navigator.storage.persist()\r\n\t\t\tconsole.log(isPersisted ? \"Storage Persisted\" : \"Storage Not persisted\")\r\n\t\t}\r\n\t}\r\n\r\n\tlogEvent = (error) => {\r\n\t\terror = error.detail\r\n\t\terror.timestamp = new Date().getTime()\r\n\t\tif (typeof error !== \"object\") return\r\n\t\tthis.setState({\r\n\t\t\tfloatingMessage: {\r\n\t\t\t\ttimestamp: error.timestamp,\r\n\t\t\t\tvisible: true,\r\n\t\t\t\ttext: error.text,\r\n\t\t\t\ttitle: error.title\r\n\t\t\t}\r\n\t\t})\r\n\t\tsetTimeout(() => {\r\n\t\t\tif (this.state.floatingMessage.timestamp !== error.timestamp) return\r\n\t\t\tthis.setState({\r\n\t\t\t\tfloatingMessage: {\r\n\t\t\t\t\ttimestamp: 0,\r\n\t\t\t\t\tvisible: false,\r\n\t\t\t\t\ttext: \"\",\r\n\t\t\t\t\ttitle: \"\"\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t}, error.timeout)\r\n\t}\r\n\trender() {\r\n\t\tconst {floatingMessage, hasVisited,homeData} = this.state\r\n\t\treturn <div className=\"index\">\r\n\r\n\t\t\t<FloatingMessage \r\n\t\t\t\ttitle={floatingMessage.title}\r\n\t\t\t\tvisible={floatingMessage.visible}\r\n\t\t\t\tonClick={this.hideMessage}\r\n\t\t\t\ttext={floatingMessage.text}\r\n\t\t\t/>\r\n\t\t\t{homeData.visible && <Home \r\n\t\t\t\ttoggleHome={this.toggleHome}\r\n\t\t\t\tchangePage={this.changePage}\r\n\t\t\t\tsetDontShowHome={this.setDontShowHome}\r\n\t\t\t\taskForStorage={this.askForStorage}\r\n\t\t\t\thasVisited={hasVisited}\r\n\t\t\t\tdata={homeData}\r\n\t\t\t/>}\r\n\t\t\t<HashRouter>\r\n\t\t\t\t<Redirect to={\"/\" + this.state.selectedPage}></Redirect>\r\n\t\t\t\t{this.state.selectedPage === \"ErrorPage\"\r\n\t\t\t\t\t? <Route exact path={\"/ErrorPage\"}>\r\n\t\t\t\t\t\t<ErrorPage changePage={this.changePage} />\r\n\t\t\t\t\t</Route>\r\n\t\t\t\t\t: <>\r\n\t\t\t\t\t\t<Route exact path={\"/ErrorPage\"}>\r\n\t\t\t\t\t\t\t<ErrorPage changePage={this.changePage} />\r\n\t\t\t\t\t\t</Route>\r\n\t\t\t\t\t\t<Route exact path=\"/\">\r\n\t\t\t\t\t\t\t<App changePage={this.changePage} />\r\n\t\t\t\t\t\t</Route>\r\n\r\n\t\t\t\t\t\t<Route exact path=\"/Composer\">\r\n\t\t\t\t\t\t\t<Composer changePage={this.changePage} />\r\n\t\t\t\t\t\t</Route>\r\n\r\n\t\t\t\t\t\t<Route exact path=\"/Donate\">\r\n\t\t\t\t\t\t\t<Donate changePage={this.changePage} />\r\n\t\t\t\t\t\t</Route>\r\n\r\n\t\t\t\t\t\t<Route exact path=\"/Changelog\">\r\n\t\t\t\t\t\t\t<Changelogpage changePage={this.changePage} />\r\n\t\t\t\t\t\t</Route>\r\n\r\n\t\t\t\t\t\t<Route exact path=\"/Partners\">\r\n\t\t\t\t\t\t\t<Partners changePage={this.changePage} />\r\n\t\t\t\t\t\t</Route>\r\n\r\n\t\t\t\t\t\t<Route exact path='/Home'>\r\n\t\t\t\t\t\t\t<Home changePage={this.changePage} />\r\n\t\t\t\t\t\t</Route>\r\n\t\t\t\t\t</>\r\n\t\t\t\t}\r\n\t\t\t</HashRouter>\r\n\t\t\t<div className=\"rotate-screen\">\r\n\t\t\t\t<img src={rotateImg} alt=\"icon for the rotating screen\">\r\n\t\t\t\t</img>\r\n\t\t\t\tFor a better experience, add the website to the home screen, and rotate your device\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t}\r\n}\r\n\r\nReactDOM.render(\r\n\t<React.StrictMode>\r\n\t\t<Index />\r\n\t</React.StrictMode>,\r\n\tdocument.getElementById('root')\r\n);\r\n\r\n\r\nfunction setIfInTWA() {\r\n\tif (isTwa()) return console.log('inTWA')\r\n\tlet isInTwa = document.referrer.includes('android-app://')\r\n\tsessionStorage.setItem('isTwa', isInTwa)\r\n}\r\n\r\n\r\nsetIfInTWA()\r\nserviceWorkerRegistration.register();\r\n\r\n\r\n\r\n"],"sourceRoot":""}