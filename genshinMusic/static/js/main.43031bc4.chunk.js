(this["webpackJsonpgenshin-music"]=this["webpackJsonpgenshin-music"]||[]).push([[0],{101:function(e,t,n){},193:function(e,t,n){},196:function(e,t,n){"use strict";n.r(t);var a=n(7),s=n.n(a),o=n(9),r=n(10),i=n(15),c=n(17),l=n(16),u=n(6),d=n.n(u),h=n(87),g=n.n(h),p=(n(65),n(101),n(31)),m="Genshin";console.log("App name:",m);var b={noteComposer:"Genshin"===m?"note-composer":"note-composer-sky",note:"Genshin"===m?"note":"note-sky"},f="Genshin"===m?["Lyre","DunDun"]:["Piano","Contrabass","Guitar","Harp","Horn","Trumpet","Pipa","WinterPiano","Xylophone","Flute","Ocarina","ToyUkulele","Drum","Bells","DunDun","HandPan","Kalimba"],v="Genshin"===m?21:15,j={Lyre:{notes:21},DunDun:{notes:8},Bells:{notes:8},Trumpet:{notes:15},Contrabass:{notes:15},Drum:{notes:8},Flute:{notes:15},Guitar:{notes:15},HandPan:{notes:8},ToyUkulele:{notes:15},Harp:{notes:15},Horn:{notes:15},Piano:{notes:15},Pipa:{notes:15},Kalimba:{notes:15},WinterPiano:{notes:15},Xylophone:{notes:15},Ocarina:{notes:15}},y={21:{keyboardLayout:"Q W E R T Y U A S D F G H J Z X C V B N M".split(" "),mobileLayout:"do re mi fa so la ti do re mi fa so la ti do re mi fa so la ti".split(" "),keyboardCodes:"81 87 69 82 84 89 85 65 83 68 70 71 72 74 90 88 67 86 66 78 77".split(" ")},8:{keyboardLayout:"Q W E R A S D F".split(" "),mobileLayout:"do re mi fa do re mi fa".split(" "),keyboardCodes:"81 87 69 82 65 83 68 70".split(" ")},15:{keyboardLayout:"Q W E R T A S D F G Z X C V B".split(" "),mobileLayout:"do re mi fa so do re mi fa so do re mi fa so".split(" "),keyboardCodes:"81 87 69 82 84 65 83 68 70 71 90 88 67 86 66".split(" ")}},x={0:["C","D","E","F","G","A","B","C","D","E","F","G","A","B","C"],1:["Db","Eb","F","Gb","Ab","Bb","C","Db","Eb","F","Gb","Ab","Bb","C","Db"],2:["D","E","F#","G","A","B","C#","D","E","F#","G","A","B","C#","D"],3:["Eb","F","G","Ab","Bb","C","D","Eb","F","G","Ab","Bb","C","D","Eb"],4:["E","F#","G#","A","B","C#","D#","E","F#","G#","A","B","C#","D#","E"],5:["F","G","A","Bb","C","D","E","F","G","A","Bb","C","D","E","F"],6:["Gb","Ab","Bb","Cb","Db","Eb","F","Gb","Ab","Bb","Cb","Db","Eb","F","Gb"],7:["G","A","B","C","D","E","F#","G","A","B","C","D","E","F#","G"],8:["Ab","Bb","C","Db","Eb","F","G","Ab","Bb","C","Db","Eb","F","G","Ab"],9:["A","B","C#","D","E","F#","G#","A","B","C#","D","E","F#","G#","A"],10:["Bb","C","D","Eb","F","G","A","Bb","C","D","Eb","F","G","A","Bb"],11:["B","C#","D#","E","F#","G#","A#","B","C#","D#","E","F#","G#","A#","B"]},S=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"],O="Genshin"===m?[14,15,16,17,18,19,20,7,8,9,10,11,12,13,0,1,2,3,4,5,6].reverse():[15,16,17,18,19,20,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14].reverse(),w="Genshin"===m?[14,15,16,17,18,19,20,7,8,9,10,11,12,13,0]:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14],k={15:"dmcr dm cr dm cr cr dm dmcr dm cr cr dm cr dm dmcr".split(" "),8:"cr dm cr dm cr dm cr dm".split(" "),21:"do re mi fa so la ti do re mi fa so la ti do re mi fa so la ti".split(" ")},C=function e(){var t=this;Object(r.a)(this,e),this.init=function(){t.start=(new Date).getTime()-100,console.log("Started new recording")},this.addNote=function(e){0===t.notes.length&&t.init();var n=[e,(new Date).getTime()-t.start];t.notes.push(n)},this.start=(new Date).getTime(),this.notes=[]},N=function e(t){var n=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object(r.a)(this,e),this.name=t,this.version=1,this.notes=a,this.bpm=220,this.pitch="C",this.data={isComposed:!1,isComposedVersion:!1,appName:m},Object.entries(s).forEach((function(e){n.data[e[0]]=e[1]}))},E=function e(t,n,a){var s=this;Object(r.a)(this,e),this.trigger=function(){window.dispatchEvent(s.event)},this.title=t,this.timeout=a,this.text=n,void 0===a&&(this.timeout=3e3),this.event=new CustomEvent("logEvent",{detail:{title:this.title,text:this.text,timeout:this.timeout}})},T=function e(t){Object(r.a)(this,e),this.timestamp=(new Date).getTime(),this.notes=t},D=function e(t){var n=this;Object(r.a)(this,e),this.download=function(e,t){var a=n.dataType+encodeURIComponent(e),s=document.createElement("a");s.style="display:none",document.body.appendChild(s),s.setAttribute("href",a),s.setAttribute("download",t),s.click(),s.remove()},void 0===t&&(t="text/json"),this.dataType="data:"+t+";charset=utf-8,"},P=[{id:0,text:"1",changer:1,color:5332079},{id:1,text:"1/2",changer:.5,color:5338451},{id:2,text:"1/4",changer:1/4,color:4410493},{id:3,text:"1/8",changer:1/8,color:7818605}],A=function e(t){var n=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object(r.a)(this,e),s.isComposed=!0,s.isComposedVersion=!0,this.version=1,this.data=s,this.name=t,this.bpm=220,this.pitch="C",this.notes=a,this.instruments=[f[0],f[0],f[0]],this.breakpoints=[0],this.columns=[],this.selected=0,new Array(100).fill().forEach((function(e){var t=new F;t.tempoChanger=0,n.columns.push(t)}))};function L(e){var t,n,a,s={data:e.data,name:e.name,bpm:null!==(t=e.bpm)&&void 0!==t?t:220,pitch:null!==(n=e.pitch)&&void 0!==n?n:"C",instruments:e.instruments||[f[0],f[0],f[0]],breakpoints:null!==(a=e.breakpoints)&&void 0!==a?a:[],notes:[],selected:0,columns:[]};return e.columns.forEach((function(e){var t=new F;t.tempoChanger=e[0],e[1].forEach((function(e){t.notes.push(new W(e[0],e[1]))})),s.columns.push(t)})),s}function M(e){var t=new N(e.name),n=Math.floor(6e4/e.bpm),a=100;return e.columns.forEach((function(e){e[1].forEach((function(e){t.notes.push([e[0],a])})),a+=Math.floor(n*P[e[0]].changer)})),t}function I(e){var t={data:e.data,name:e.name,bpm:e.bpm,pitch:e.pitch,breakpoints:e.breakpoints,instruments:e.instruments,columns:[]};return t.data.appName=m,e.columns.forEach((function(e){var n=[e.tempoChanger],a=e.notes.map((function(e){return[e.index,e.layer]}));n[1]=a,t.columns.push(n)})),t}function B(e){var t,n=JSON.parse(JSON.stringify(e)),a={};return a=(null===(t=n.data)||void 0===t?void 0:t.isComposedVersion)?function(e){var t=[],n=Math.floor(6e4/e.bpm),a=100;return e.columns.forEach((function(e){e[1].forEach((function(e){var n=1;"111"===e[1]&&(n=3),"011"===e[1]&&(n=2),"101"===e[1]&&(n=3),"001"===e[1]&&(n=2),"110"===e[1]&&(n=3),"010"===e[1]&&(n=2),"100"===e[1]&&(n=1);var s={key:(n>2?2:n)+"Key"+e[0],time:a};n>2&&(s.l=3),t.push(s)})),a+=Math.floor(n*P[e[0]].changer)})),t}(n):function(e){var t=[];return e.notes.forEach((function(e){t.push({time:e[1],key:"1Key"+e[0]})})),t}(n),n.isComposed=n.data.isComposedVersion,n.pitchLevel=U.indexOf(n.pitch),n.songNotes=a,n.bitsPerPage=16,n.isEncrypted=!1,[n]}function R(e){var t,n;Array.isArray(e)&&e.length>0&&(e=e[0]);var a=function(e){try{if(void 0!==e.data)return e.data.isComposedVersion?"string"!==typeof e.name||"number"!==typeof e.bpm?"none":U.includes(e.pitch)&&Array.isArray(e.breakpoints)?e.breakpoints.length>0&&"number"!==typeof e.breakpoints[0]?"none":Array.isArray(e.columns)?e.columns.length>0&&"number"!==typeof e.columns[0][0]?"none":"newComposed":"none":"none":"string"!==typeof e.name||"number"!==typeof e.bpm?"none":U.includes(e.pitch)?"newRecorded":"none";if(void 0!==e.songNotes&&void 0!==e.pitchLevel)return"oldSky"}catch(t){return console.log(t),"none"}return"none"}(e);if("none"===a)throw new E("Error","Invalid song").trigger(),new Error("Error Invalid song");if("oldSky"===a&&(e=function(e){var t=new N("Error");try{(t=new N(e.name)).bpm=e.bpm||220,t.pitch=U[e.pitchLevel||0]||"C",e.songNotes=e.songNotes.filter((function(e,t,n){return t===n.findIndex((function(t){return t.key.split("Key")[1]===e.key.split("Key")[1]&&t.time===e.time}))})),e.songNotes.forEach((function(e){var n,a=e.key.split("Key");t.notes.push([V[a[1]],e.time,null!==(n=e.l)&&void 0!==n?n:Number(a[0])])})),[!0,"true"].includes(e.isComposed)?t=I(G(t)):t.notes=t.notes.map((function(e){return[e[0],e[1]]}))}catch(n){return console.log(n),new N("Error importing")}return t}(e)),"Sky"===m&&"Sky"!==(null===(t=e.data)||void 0===t?void 0:t.appName))throw new E("Error","Invalid song").trigger(),new Error("Error Invalid song");return"Genshin"===m&&"Sky"===(null===(n=e.data)||void 0===n?void 0:n.appName)&&(e=function(e){e.data.isComposedVersion&&(e.instruments=e.instruments.map((function(e){return"Lyre"})),e.columns.forEach((function(e){e[1]=e[1].map((function(e){return[V[e[0]],e[1]]}))})));e.data.isComposedVersion||(e.notes=e.notes.map((function(e){return e[0]=V[e[0]],e})));return e}(e)),e}var V=w;function G(e){var t=Math.floor(6e4/e.bpm),n=new A(e.name,[]);n.bpm=e.bpm,n.pitch=e.pitch;for(var a=e.notes,s=[],o=function(e,t){var n=[];for(;e.length>0;){for(var a=[e.shift()],s=0,o=0;o<e.length;o++)a[0][1]>e[o][1]-t&&s++;n.push([].concat(a,Object(p.a)(e.splice(0,s))))}return n}(a,t/9),r=[t,Math.floor(t/2),Math.floor(t/4),Math.floor(t/8)],i=function(e){var t=new F;t.notes=o[e].map((function(e){var t=new W(e[0]);return 0===e[2]&&(t.layer="100"),1===e[2]&&(t.layer="100"),2===e[2]&&(t.layer="010"),3===e[2]&&(t.layer="110"),void 0===e[2]&&(t.layer="100"),t}));for(var n=(o[e+1]||[[0,0,0]])[0][1]-o[e][0][1],a=[];n>=r[3];)n/r[0]>=1?(n-=r[0],a.push(0)):n/r[1]>=1?(n-=r[1],a.push(1)):n/r[2]>=1?(n-=r[2],a.push(2)):n/r[3]>=1&&(n-=r[3],a.push(3));var i=[];t.tempoChanger=a.shift()||0,a=a.forEach((function(e,t){var n=new F;n.tempoChanger=e,i.push(n)})),s.push.apply(s,[t].concat(i))},c=0;c<o.length;c++)i(c);return n.columns=s,n}var F=function e(){Object(r.a)(this,e),this.notes=[],this.tempoChanger=0};var W=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"000";Object(r.a)(this,e),this.index=t,this.layer=n},U=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"];function H(e){var t=U.indexOf(e);return t<0&&(t=0),Number(Math.pow(2,t/12).toFixed(4))}var J=n(88),_=function e(t,n,a){Object(r.a)(this,e),this.index=t,this.noteNames=n,this.url=a,this.buffer=new ArrayBuffer(8)},K=function e(t){var n=this;Object(r.a)(this,e),this.getNoteFromCode=function(e){var t=n.keyboardCodes.findIndex((function(t){return t===e}));return-1!==t?t:null},this.setBuffers=function(e){e.forEach((function(e,t){n.layout[t].buffer=e}))},this.changeVolume=function(e){n.gain.gain.value=e/100},this.load=function(){var e=Object(o.a)(s.a.mark((function e(t){var a,o,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.gain=t.createGain(),n.gain.gain.value=1,a=t.createBuffer(2,t.sampleRate,t.sampleRate),o=n.layout.map((function(e){return new Promise((function(n){fetch(e.url).then((function(e){return e.arrayBuffer()})).then((function(e){t.decodeAudioData(e,n,(function(){n(a)})).catch((function(e){n(a)}))})).catch((function(e){n(a)}))}))})),e.next=6,Promise.all(o);case 6:return r=e.sent,n.setBuffers(r),e.abrupt("return",!0);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.instrumentName=t;var a=void 0===t?f[0]:t;this.layout=[],this.gain=GainNode;var i=j[a];this.keyboardLayout=y[i.notes].keyboardLayout,this.mobileLayout=y[i.notes].mobileLayout,this.keyboardCodes=y[i.notes].keyboardCodes;var c=0;if(void 0!==t){var l,u=Object(J.a)(this.keyboardLayout);try{for(u.s();!(l=u.n()).done;){var d={keyboard:l.value,mobile:this.mobileLayout[c]},h="./assets/audio/".concat(t,"/").concat(c,".mp3"),g=new _(c,d,h);this.layout.push(g),c++}}catch(p){u.e(p)}finally{u.f()}}},z=n(44),Y=n.n(z),q=n(1),Q=function(e){Object(c.a)(n,e);var t=Object(l.a)(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,e)).state={},a}return Object(i.a)(n,[{key:"render",value:function(){var e=this.props,t=e.data,n=t.clicked?b.note+" click-event":b.note;n+=(e.toBeClicked?" note-red":"")+(e.toBeClickedNext?" note-border-click":"");var a=Y()()?t.noteNames.mobile:t.noteNames.keyboard,s={transition:"all ".concat(e.fadeTime,"s")},o="./assets/icons/keys/".concat(t.noteNames.mobile,".svg");return"Sky"===m&&(o="./assets/icons/keys/".concat(e.skyImg,".svg")),"Sky"===m&&(a=e.skyText),Object(q.jsx)("button",{onPointerDown:function(n){n.preventDefault(),e.clickAction(t)},className:"button-hitbox",children:Object(q.jsxs)("div",{className:n,style:s,children:[Object(q.jsx)("img",{draggable:"false",alt:t.noteNames.mobile,src:o}),Object(q.jsx)("div",{className:"Sky"===m?"note-name-sky":"note-name",children:a})]})})}}]),n}(u.Component),X=n(51);function Z(e){return new Promise((function(t){X.a(t,e)}))}var $=function(e){Object(c.a)(n,e);var t=Object(l.a)(n);function n(e){var a;Object(r.a)(this,n),(a=t.call(this,e)).handleKeyboard=function(e){if(!e.repeat&&"INPUT"!==document.activeElement.tagName){var t,n=a.state.instrument.getNoteFromCode(e.keyCode);null!==n&&(t=a.state.instrument.layout[n]),void 0!==t&&a.handleClick(t)}},a.handlePlayEvent=function(e){var t=e.detail;a.setState({playTimestamp:t.timestamp},(function(){return a.playSong(t)}))},a.handlePracticeEvent=function(e){var t=e.detail;a.practiceSong(JSON.parse(JSON.stringify(t)))},a.loadInstrument=function(){var e=Object(o.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new K(t),e.next=3,n.load(a.state.audioContext);case 3:a.setState({instrument:n});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.practiceSong=function(e){var t=e.notes,n=t.length;void 0===e.start&&(e.start=0),t.splice(0,e.start);for(var s=[],o=0;t.length>0;o++){for(var r={notes:[t.shift()],delay:0},i=r.notes.length>0?r.notes[0][1]:0,c=0;c<t.length&&c<20;c++){t[c][1]-r.notes[0][1]-e.threshold<0&&(r.notes.push(t.shift()),c--)}r.delay=t.length>0?t[0][1]-i:0,s.push(r)}a.setState({songToPractice:s}),a.setSlider({size:n,position:e.start})},a.changeSliderPosition=function(e){var t=a.state.sliderState;t.position+=e,a.setState({sliderState:t},(function(){return a.props.functions.changeSliderState(a.state.sliderState)}))},a.setSlider=function(e){a.setState({sliderState:e},a.props.functions.changeSliderState(e))},a.playSong=function(){var e=Object(o.a)(s.a.mark((function e(t){var n,o,r,i,c;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.notes,o=0,a.setSlider({size:n.length,position:0}),0!==n.length){e.next=5;break}return e.abrupt("return");case 5:r=0;case 6:if(!(r<n.length)){e.next=20;break}if(i=n[r][1]-o,o=n[r][1],c=n[r][0],a.state.playTimestamp===t.timestamp){e.next=12;break}return e.abrupt("break",20);case 12:if(!(i>10)){e.next=15;break}return e.next=15,Z(i);case 15:a.changeSliderPosition(1),a.playSound(a.state.instrument.layout[c]);case 17:r++,e.next=6;break;case 20:a.props.functions.stopSong();case 21:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.handleClick=function(e){var t=a.state.songToPractice;if(t.length>0){var n,s=null===(n=t[0])||void 0===n?void 0:n.notes.findIndex((function(t){return t[0]===e.index}));-1!==s&&(t[0].notes.splice(s,1),0===t[0].notes.length&&t.shift(),0===t.length&&a.props.functions.stopSong(),a.setState({songToPractice:t},(function(){return a.changeSliderPosition(1)})))}a.playSound(e)},a.playSound=function(e){if(void 0!==e){a.props.isRecording&&a.props.functions.handleRecording(e),e.clicked=!0,setTimeout((function(){e.clicked=!1,a.setState({instrument:a.state.instrument})}),200);var t=a.state.audioContext.createBufferSource();t.playbackRate.value=H(a.props.settings.pitch.value),t.buffer=e.buffer,a.props.settings.caveMode.value?t.connect(a.state.reverbAudioContext):t.connect(a.state.audioContext.destination),t.start(0),a.setState({instrument:a.state.instrument})}},a.state={instrument:new K,audioContext:new(window.AudioContext||window.webkitAudioContext),reverbAudioContext:new(window.AudioContext||window.webkitAudioContext),playTimestamp:(new Date).getTime(),songToPractice:[],sliderState:{position:0,size:0}},console.log("created"),a.loadInstrument(e.data.instrument);try{a.loadReverb()}catch(i){console.log("Error with reverb0",i)}return a}return Object(i.a)(n,[{key:"componentDidMount",value:function(){window.addEventListener("keydown",this.handleKeyboard),window.addEventListener("playSong",this.handlePlayEvent),window.addEventListener("practiceSong",this.handlePracticeEvent)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("keydown",this.handleKeyboard),window.removeEventListener("playSong",this.handlePlayEvent),window.removeEventListener("practiceSong",this.handlePracticeEvent),this.state.playTimestamp=(new Date).getTime()}},{key:"loadReverb",value:function(){var e=this,t=this.state.audioContext;fetch("./assets/audio/reverb4.wav").then((function(e){return e.arrayBuffer()})).then((function(n){t.decodeAudioData(n,(function(n){var a=t.createConvolver(),s=t.createGain();s.gain.value=2.5,a.buffer=n,a.connect(s),s.connect(t.destination),e.setState({reverbAudioContext:a})}))})).catch((function(e){console.log("Error with reverb1",e)}))}},{key:"render",value:function(){var e=this,t=this.state,n=this.props.settings.keyboardSize.value/100;n<.5&&(n=.5),n>1.5&&(n=1.5);var a="keyboard";return 15===t.instrument.layout.length&&(a+=" keyboard-5"),8===t.instrument.layout.length&&(a+=" keyboard-4"),Object(q.jsxs)("div",{className:a,style:{transform:"scale(".concat(n,")"),marginBottom:30*n},children:[0===t.instrument.layout.length?Object(q.jsx)("div",{className:"loading",children:"Loading..."}):null,t.instrument.layout.map((function(n){var a,s,o,r,i=void 0!==(null===(a=t.songToPractice[0])||void 0===a?void 0:a.notes.find((function(e){return e[0]===n.index}))),c=void 0!==(null===(s=t.songToPractice[1])||void 0===s?void 0:s.notes.find((function(e){return e[0]===n.index}))),l=void 0!==(null===(o=t.songToPractice[0])||void 0===o?void 0:o.delay)?(null===(r=t.songToPractice[0])||void 0===r?void 0:r.delay)/1e3:.1,u="",d="";try{u=x[S.indexOf(e.props.settings.pitch.value)][n.index],d=k[t.instrument.layout.length][n.index]}catch(h){}return Object(q.jsx)(Q,{toBeClicked:i,fadeTime:l,toBeClickedNext:c,data:n,skyText:u,skyImg:d,clickAction:e.handleClick},n.index)}))]})}}]),n}(u.Component),ee=n(37),te=n(12),ne=n(11),ae=n(61),se=n(90),oe=(n(66),n.p+"static/media/mainpage.114ce51f.png"),re=n.p+"static/media/composer.76adcf72.png",ie=n(89),ce=function(e){Object(c.a)(n,e);var t=Object(l.a)(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,e)).handleSearchInput=function(e){a.setState({searchInput:e})},a.clearSearch=function(){a.setState({searchInput:"",searchedSongs:[],searchStatus:"Write a song name then search!"}),a.props.functions.stopSong()},a.searchSongs=Object(o.a)(s.a.mark((function e(){var t,n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==(t=a.state.searchInput).trim().length){e.next=3;break}return e.abrupt("return",a.setState({searchStatus:"Please write a non empty name"}));case 3:return a.setState({searchStatus:"Searching..."}),e.next=6,fetch("https://sky-music.herokuapp.com/api/songs?search="+encodeURI(t)).then((function(e){return e.json()}));case 6:if(!(n=e.sent).error){e.next=10;break}return a.setState({searchStatus:"Please write a non empty name"}),e.abrupt("return",new E("Error",n.error).trigger());case 10:a.setState({searchedSongs:n,searchStatus:"success"});case 11:case"end":return e.stop()}}),e)}))),a.toggleMenu=function(e){"boolean"!==typeof e&&(e=void 0);var t=void 0!==e?e:!a.state.open;a.setState({open:t})},a.selectSideMenu=function(e){if(e===a.state.selectedMenu&&a.state.open)return a.setState({open:!1});a.setState({selectedMenu:e,open:!0})},a.changeSelectedSongType=function(e){a.setState({selectedSongType:e})},a.importSong=function(e){var t=new FileReader;t.addEventListener("load",(function(e){try{var t=JSON.parse(e.target.result);t=R(t),a.props.functions.addSong(t)}catch(n){new E("Error","Error importing song").trigger(),console.error(n)}})),t.readAsText(e)},a.downloadSong=function(e){e._id&&delete e._id;var t=e.name;"Sky"===m&&(e=B(e)),Array.isArray(e)||(e=[e]),e.forEach((function(e){e.data.appName=m}));var n=JSON.stringify(e);(new D).download(n,"".concat(t,".").concat(m.toLowerCase(),"sheet.json")),new E("Success","Song downloaded").trigger()},a.state={open:!1,selectedMenu:"Songs",selectedSongType:"recorded",searchInput:"",searchedSongs:[],searchStatus:"Write a song name then search!"},a}return Object(i.a)(n,[{key:"render",value:function(){var e=this,t=this.state.open?"side-menu menu-open":"side-menu",n=this.props,a=n.data,s=n.functions,o=s.handleSettingChange;s.toggleMenu=this.toggleMenu,s.downloadSong=this.downloadSong;var r=this.props.functions.changePage,i=a.songs.filter((function(e){return!e.data.isComposedVersion})),c=a.songs.filter((function(e){return e.data.isComposedVersion})),l=this.state,u=l.searchStatus,d=l.searchedSongs,h=l.selectedMenu,g={playSong:s.playSong,importSong:s.addSong};return Object(q.jsxs)("div",{className:"menu-wrapper",children:[Object(q.jsxs)("div",{className:"menu menu-visible",children:[this.state.open&&Object(q.jsx)(de,{action:this.toggleMenu}),Object(q.jsx)(pe,{type:"Help",action:this.selectSideMenu,className:"margin-top-auto",children:Object(q.jsx)(te.a,{icon:ne.h,className:"icon"})}),Object(q.jsx)(pe,{type:"Library",action:this.selectSideMenu,children:Object(q.jsx)(se.a,{className:"icon"})}),Object(q.jsx)(pe,{type:"Songs",action:this.selectSideMenu,children:Object(q.jsx)(te.a,{icon:ne.j,className:"icon"})}),Object(q.jsx)(pe,{type:"Settings",action:this.selectSideMenu,children:Object(q.jsx)(te.a,{icon:ne.d,className:"icon"})}),Object(q.jsx)(pe,{type:"Composer",action:function(){return r("Composer")},children:Object(q.jsx)(te.a,{icon:ne.e,className:"icon"})})]}),Object(q.jsxs)("div",{className:t,children:[Object(q.jsx)(ue,{title:"No selection",visible:h}),Object(q.jsxs)(ue,{title:"Songs",visible:h,children:[Object(q.jsxs)("div",{className:"songs-buttons-wrapper",children:[Object(q.jsx)("button",{className:"genshin-button",onClick:function(){return r("Composer")},children:"Compose song"}),Object(q.jsx)(ie.FilePicker,{onChange:function(t){return e.importSong(t)},children:Object(q.jsx)("button",{className:"genshin-button",children:"Import song"})})]}),Object(q.jsxs)("div",{className:"tab-selector-wrapper",children:[Object(q.jsx)("button",{className:"recorded"===this.state.selectedSongType?"tab-selector tab-selected":"tab-selector",onClick:function(){return e.changeSelectedSongType("recorded")},children:"Recorded"}),Object(q.jsx)("button",{className:"composed"===this.state.selectedSongType?"tab-selector tab-selected":"tab-selector",onClick:function(){return e.changeSelectedSongType("composed")},children:"Composed"})]}),Object(q.jsx)("div",{className:"songs-wrapper",children:"recorded"===this.state.selectedSongType?i.map((function(e){return Object(q.jsx)(ge,{data:e,functions:s},e.name)})):c.map((function(e){return Object(q.jsx)(ge,{data:e,functions:s},e.name)}))})]}),Object(q.jsxs)(ue,{title:"Settings",visible:h,children:[Object.entries(a.settings).map((function(e){var t=Object(ee.a)(e,2),n=t[0],a=t[1];return Object(q.jsx)(he,{objKey:n,data:a,update:o},n+a.value)})),!be()&&Object(q.jsx)("a",{className:"donate-button",href:"https://www.buymeacoffee.com/Specy",target:"_blank",rel:"noreferrer",children:"Support me"})]}),Object(q.jsxs)(ue,{title:"Library",visible:h,children:[Object(q.jsx)("div",{children:"Here you can find songs to learn, they are provided by the sky-music library."}),Object(q.jsxs)("div",{className:"library-search-row",children:[Object(q.jsx)("input",{className:"library-search-input",placeholder:"Song name",onInput:function(t){return e.handleSearchInput(t.target.value)},value:this.state.searchInput}),Object(q.jsx)("button",{className:"library-search-btn",onClick:this.clearSearch,children:Object(q.jsx)(te.a,{icon:ne.u})}),Object(q.jsx)("button",{className:"library-search-btn",onClick:this.searchSongs,children:Object(q.jsx)(te.a,{icon:ne.p})})]}),Object(q.jsx)("div",{className:"library-search-songs-wrapper",children:"success"===u?d.length>0?d.map((function(e){return Object(q.jsx)(me,{data:e,functions:g,children:e.name},e.file)})):Object(q.jsx)("div",{className:"library-search-result-text",children:"No results"}):Object(q.jsx)("div",{className:"library-search-result-text",children:u})})]}),Object(q.jsxs)(ue,{title:"Help",visible:h,children:[Object(q.jsxs)("div",{className:"help-icon-wrapper",children:[Object(q.jsx)("a",{href:"https://discord.gg/Rj8V5gkZPc",children:Object(q.jsx)(ae.a,{className:"help-icon"})}),Object(q.jsx)("a",{href:"https://github.com/Specy/genshin-music",children:Object(q.jsx)(ae.b,{className:"help-icon"})})]}),Object(q.jsx)("div",{className:"help-title",children:"Main page"}),Object(q.jsxs)("div",{children:[Object(q.jsx)("img",{src:oe,className:"help-img",alt:"icon for the main page"}),Object(q.jsxs)("ol",{children:[Object(q.jsx)("li",{children:"Keyboard"}),Object(q.jsx)("li",{children:"Record your keyboard"}),Object(q.jsx)("li",{children:"Open the composer"}),Object(q.jsx)("li",{children:"Open the settings"}),Object(q.jsx)("li",{children:"Open the saved songs"})]}),Object(q.jsxs)("div",{className:"column",children:[Object(q.jsxs)("div",{children:[Object(q.jsx)(te.a,{icon:ne.f})," = practice the song"]}),Object(q.jsxs)("div",{children:[Object(q.jsx)(te.a,{icon:ne.g})," = download the song"]})]})]}),Object(q.jsx)("div",{className:"help-title",children:"Composer"}),Object(q.jsxs)("div",{children:[Object(q.jsx)("img",{src:re,className:"help-img",alt:"the icon for the help menu"}),Object(q.jsxs)("ol",{children:[Object(q.jsx)("li",{children:"Go to the next / previous breakpoint"}),Object(q.jsx)("li",{children:"Timeline of the breakpoints"}),Object(q.jsx)("li",{children:"Open the tools"}),Object(q.jsx)("li",{children:"Add 16 columns to the end"}),Object(q.jsx)("li",{children:"Remove the current selected column"}),Object(q.jsx)("li",{children:"Add column after the current one"})]}),"The composer has tools for PC users: ",Object(q.jsx)("br",{}),Object(q.jsx)("br",{}),Object(q.jsxs)("div",{style:{marginLeft:"1rem"},children:[Object(q.jsx)(le,{children:"A / D"})," = move left / right ",Object(q.jsx)("br",{}),Object(q.jsx)(le,{children:"1 / 2 / 3 / 4"})," = change tempo ",Object(q.jsx)("br",{}),Object(q.jsx)(le,{children:"Space bar"})," = play / pause song ",Object(q.jsx)("br",{}),Object(q.jsx)(le,{children:"Arrow left"})," = go to previous breakpoint",Object(q.jsx)("br",{}),Object(q.jsx)(le,{children:"Arrow right"})," = go to next breakpoint ",Object(q.jsx)("br",{}),Object(q.jsx)(le,{children:"Q"})," = remove current column",Object(q.jsx)("br",{}),Object(q.jsx)(le,{children:"E"})," = add column ",Object(q.jsx)("br",{})]})]}),!be()&&Object(q.jsx)("a",{className:"donate-button",href:"https://www.buymeacoffee.com/Specy",target:"_blank",rel:"noreferrer",children:"Support me"})]})]})]})}}]),n}(u.Component);function le(e){return Object(q.jsx)("div",{className:"keyboard-key",children:e.children})}function ue(e){var t=e.visible===e.title?"menu-panel menu-panel-visible":"menu-panel";return Object(q.jsxs)("div",{className:t,children:[Object(q.jsx)("div",{className:"menu-title",children:e.title}),Object(q.jsx)("div",{className:"panel-content-wrapper",children:e.children})]})}function de(e){return Object(q.jsx)("div",{onClick:function(){return e.action(!1)},className:"close-menu menu-item",children:Object(q.jsx)(te.a,{icon:ne.u,className:"icon"})})}function he(e){var t=e.data,n=e.update,a=e.objKey,s=Object(u.useState)(t.value),o=Object(ee.a)(s,2),r=o[0],i=o[1];return"settingVesion"===a?null:Object(q.jsxs)("div",{className:"settings-row",children:[Object(q.jsx)("div",{children:t.name}),"select"===t.type?Object(q.jsx)("select",{value:t.value,onChange:function(e){var s=e.target.value;t.value=s,n({key:a,data:t})},children:t.options.map((function(e){return Object(q.jsx)("option",{value:e,children:e},e)}))}):Object(q.jsx)("input",{type:t.type,value:r,checked:r,onChange:function(e){var n=e.target,a="checkbox"===t.type?n.checked:n.value;"number"===t.type&&(a=Number(a),e.target.value="",a<t.threshold[0]||a>t.threshold[1])||i(a)},onBlur:function(){t.value!==r&&(t.value=r,n({key:a,data:t}))}})]})}function ge(e){var t=e.data,n=e.functions.removeSong,a=e.functions.playSong,s=e.functions.practiceSong,o=e.functions.toggleMenu,r=e.functions.downloadSong;return Object(q.jsxs)("div",{className:"song-row",children:[Object(q.jsx)("div",{className:"song-name",onClick:function(){a(t),o(!1)},children:t.name}),Object(q.jsxs)("div",{className:"song-buttons-wrapper",children:[Object(q.jsx)("button",{className:"song-button",onClick:function(){s(t),o(!1)},children:Object(q.jsx)(te.a,{icon:ne.f})}),Object(q.jsx)("button",{className:"song-button",onClick:function(){return r(t)},children:Object(q.jsx)(te.a,{icon:ne.g})}),Object(q.jsx)("button",{className:"song-button",onClick:function(){return n(t.name)},children:Object(q.jsx)(te.a,{icon:ne.w,color:"#ed4557"})})]})]})}var pe=function(e){Object(c.a)(n,e);var t=Object(l.a)(n);function n(){return Object(r.a)(this,n),t.apply(this,arguments)}return Object(i.a)(n,[{key:"render",value:function(){var e=this,t=this.props.className?"menu-item ".concat(this.props.className):"menu-item";return Object(q.jsx)("div",{className:t,onClick:function(){return e.props.action(e.props.type)},children:this.props.children})}}]),n}(u.Component);function me(e){var t=e.functions,n=e.data,a=t.playSong,r=t.importSong,i=function(){var e=Object(o.a)(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("https://sky-music.herokuapp.com/api/songs?get="+encodeURI(n.file)).then((function(e){return e.json()}));case 3:t=R(t=e.sent),r(t),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),console.error(e.t0),new E("Error","Error downloading song").trigger();case 12:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}}(),c=function(){var e=Object(o.a)(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("https://sky-music.herokuapp.com/api/songs?get="+encodeURI(n.file)).then((function(e){return e.json()}));case 3:t=R(t=e.sent),a(t),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),console.error(e.t0),new E("Error","Error downloading song").trigger();case 12:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}}();return Object(q.jsxs)("div",{className:"song-row",children:[Object(q.jsx)("div",{className:"song-name",onClick:function(){c(n)},children:n.name}),Object(q.jsx)("div",{className:"song-buttons-wrapper",children:Object(q.jsx)("button",{className:"song-button",onClick:i,children:Object(q.jsx)(te.a,{icon:ne.g})})})]})}function be(){return JSON.parse(sessionStorage.getItem("isTwa"))}var fe=ce,ve=n(40),je=n.n(ve),ye={settingVesion:m+5,instrument:{name:"Instrument (Layer 1)",type:"instrument",songSetting:!1,value:f[0],volume:100,options:f},layer2:{name:"Instrument (Layer 2)",type:"instrument",songSetting:!1,value:f[0],volume:100,options:f},layer3:{name:"Instrument (Layer 3)",type:"instrument",songSetting:!1,value:f[0],volume:100,options:f},bpm:{name:"Bpm",type:"number",songSetting:!0,threshold:[0,1e3],value:220},beatMarks:{name:"Beat marks",type:"select",songSetting:!1,value:3,options:[3,4]},pitch:{name:"Pitch",type:"select",songSetting:!0,value:"C",options:["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"]},columnsPerCanvas:{name:"Number of visible columns",type:"select",songSetting:!1,value:35,options:[20,25,30,35,40,45,50]},caveMode:{name:"Reverb (cave mode)",type:"checkbox",songSetting:!1,value:!1},autosave:{name:"Autosave changes",type:"checkbox",songSetting:!1,value:!1}},xe={settingVesion:m+5,keyboardSize:{name:"Keyboard size",type:"number",songSetting:!1,value:100,threshold:[0,200]},instrument:{name:"Instrument",type:"select",songSetting:!1,value:f[0],options:f},pitch:{name:"Pitch",type:"select",songSetting:!0,value:"C",options:["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"]},caveMode:{name:"Reverb (cave mode)",type:"checkbox",songSetting:!1,value:!1}};function Se(e){return Oe.apply(this,arguments)}function Oe(){return(Oe=Object(o.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){var n=document.createElement("div");n.className="floating-prompt";var a=document.createElement("div");a.innerText=t;var s=document.createElement("input");s.type="text",s.placeholder="Write here",s.className="prompt-input";var o=document.createElement("div"),r=document.createElement("button"),i=document.createElement("button");r.className="prompt-button",i.className="prompt-button disabled",o.className="prompt-row",i.innerText="Ok",r.innerText="Cancel",o.append(r,i),n.append(a,s,o),document.body.appendChild(n),s.addEventListener("input",(function(){""===s.value.trim()?i.classList.add("disabled"):i.classList.remove("disabled")})),r.addEventListener("click",(function(){n.classList.add("floating-prompt-hidden"),e(null),setTimeout((function(){return n.remove()}),200)})),i.addEventListener("click",(function(){if("Untitled"===s.value.trim())return s.value="",new E("Warning",'"Untitled" is a reserved word, use another').trigger();n.classList.add("floating-prompt-hidden"),e(s.value.trim()),setTimeout((function(){return n.remove()}),200)}))})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function we(e){return ke.apply(this,arguments)}function ke(){return(ke=Object(o.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){var n=document.createElement("div");n.className="floating-prompt";var a=document.createElement("div");a.innerText=t;var s=document.createElement("div"),o=document.createElement("button"),r=document.createElement("button");o.className="prompt-button",r.className="prompt-button",s.className="prompt-row",r.innerText="Yes",r.style.background="#628c83",o.style.background="#a9525a",o.innerText="No",s.append(o,r),n.append(a,s),document.body.appendChild(n),o.addEventListener("click",(function(){n.classList.add("floating-prompt-hidden"),e(!1),setTimeout((function(){return n.remove()}),200)})),r.addEventListener("click",(function(){n.classList.add("floating-prompt-hidden"),e(!0),setTimeout((function(){return n.remove()}),200)}))})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Ce=n.p+"static/media/rotate.e7c0f107.svg",Ne=function(e){Object(c.a)(n,e);var t=Object(l.a)(n);function n(e){var a;Object(r.a)(this,n),(a=t.call(this,e)).resetDrag=function(e){a.setState({isDragging:!1})},a.handleDragOver=function(e){e.preventDefault(),a.setState({isDragging:!0})},a.handleDrag=function(e){e.preventDefault(),a.setState({isDragging:!0})},a.handleDrop=function(){var e=Object(o.a)(s.a.mark((function e(t){var n,o,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a.resetDrag(),t.preventDefault(),e.next=4,Promise.all(Array.from(t.dataTransfer.files).map((function(e){return e.text()})));case 4:n=e.sent,o=0;case 6:if(!(o<n.length)){e.next=19;break}return e.prev=7,r=R(JSON.parse(n[o])),e.next=11,a.addSong(r);case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(7),console.error(e.t0);case 16:o++,e.next=6;break;case 19:case"end":return e.stop()}}),e,null,[[7,13]])})));return function(t){return e.apply(this,arguments)}}(),a.getSettings=function(){var e=localStorage.getItem(m+"_Main_Settings");try{e=JSON.parse(e)}catch(t){e=null}return null!==e?e.settingVesion!==xe.settingVesion?(a.updateSettings(xe),xe):e:xe},a.updateSettings=function(e){var t;t=void 0!==e?e:a.state.settings,localStorage.setItem(m+"_Main_Settings",JSON.stringify(t))},a.handleSettingChange=function(e){var t=a.state.settings,n=e.data;t[e.key].value=n.value,"instrument"===e.key&&a.loadInstrument(n.value),a.setState({settings:t},a.updateSettings)},a.syncSongs=Object(o.a)(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.dbCol.songs.find().toArray();case 2:t=e.sent,a.setState({songs:t});case 4:case"end":return e.stop()}}),e)}))),a.loadInstrument=function(e){var t=a.state;t.keyboardData.instrument=e,a.setState({keyboardData:t.keyboardData})},a.practiceSong=function(){var e=Object(o.a)(s.a.mark((function e(t){var n,o,r,i,c=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=c.length>1&&void 0!==c[1]?c[1]:0,e.next=3,a.stopSong();case 3:r=a.state.keyboardData.practicingSong,(null===(n=t.data)||void 0===n?void 0:n.isComposedVersion)&&(t=M(t),r.threshold=10),r.notes=t.notes,r.timestamp=(new Date).getTime(),(i=JSON.parse(JSON.stringify(a.state.keyboardData.practicingSong))).start=o,a.setState({keyboardData:a.state.keyboardData,thereIsSong:"practicing"},(function(){var e=new CustomEvent("practiceSong",{detail:i});window.dispatchEvent(e)}));case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.songExists=function(){var e=Object(o.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.dbCol.songs.findOne({name:t});case 2:return e.t0=e.sent,e.t1=void 0,e.abrupt("return",e.t0!==e.t1);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.addSong=function(){var e=Object(o.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,a.songExists(t.name);case 3:if(!e.sent){e.next=5;break}return e.abrupt("return",new E("Warning","A song with this name already exists! \n"+t.name).trigger());case 5:return e.next=7,a.dbCol.songs.insert(t);case 7:a.syncSongs(),new E("Success","Song added to the ".concat(t.data.isComposedVersion?"Composed":"Recorded"," tab!"),4e3).trigger(),e.next=15;break;case 11:return e.prev=11,e.t0=e.catch(0),console.error(e.t0),e.abrupt("return",new E("Error","There was an error importing the song").trigger());case 15:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(t){return e.apply(this,arguments)}}(),a.removeSong=function(){var e=Object(o.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,we('Are you sure you want to delete the song: "'.concat(t,'" ?'));case 2:e.sent&&a.dbCol.songs.remove({name:t},a.syncSongs);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.handleRecording=function(e){a.state.isRecording&&a.recording.addNote(e.index)},a.handleSliderEvent=function(e){a.changeSliderState({position:Number(e.target.value),size:a.state.sliderState.size})},a.stopSong=function(){return new Promise((function(e){var t=a.state.keyboardData;t.practicingSong=new T([]),t.playingSong=new T([]),a.setState({thereIsSong:"none",keyboardData:t},(function(){var t=new CustomEvent("playSong",{detail:new T([])});window.dispatchEvent(t),t=new CustomEvent("practiceSong",{detail:new T([])}),window.dispatchEvent(t),setTimeout(e,300)}))}))},a.changeSliderState=function(e){a.setState({sliderState:e})},a.playSong=function(){var e=Object(o.a)(s.a.mark((function e(t){var n,o,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.stopSong();case 2:(n=a.state.settings).pitch.value=t.pitch,t.data.isComposedVersion&&(t=M(t)),o={timestamp:(new Date).getTime(),notes:t.notes},a.state.keyboardData.playingSong=o,a.setState({keyboardData:a.state.keyboardData,thereIsSong:"playing",settings:n}),r=new CustomEvent("playSong",{detail:o}),window.dispatchEvent(r),a.lastPlayedSong=t;case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.askForSongName=function(){return new Promise(function(){var e=Object(o.a)(s.a.mark((function e(t){var n,o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n="Write song name, press cancel to ignore";case 1:return e.next=4,Se(n);case 4:if(null!==(o=e.sent)){e.next=7;break}return e.abrupt("return",t(null));case 7:if(""===o){e.next=17;break}return e.next=10,a.songExists(o);case 10:if(!e.sent){e.next=14;break}n="This song already exists: "+o,e.next=15;break;case 14:return e.abrupt("return",t(o));case 15:e.next=18;break;case 17:n="Write song name, press cancel to ignore";case 18:e.next=1;break;case 20:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())},a.toggleRecord=function(){var e=Object(o.a)(s.a.mark((function e(t){var n,o,r,i,c;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("boolean"!==typeof t&&(t=void 0),(n=void 0!==t?t:!a.state.isRecording)||!(a.recording.notes.length>0)){e.next=11;break}return e.next=5,a.askForSongName();case 5:o=e.sent,(r=new N(o,a.recording.notes)).pitch=a.state.settings.pitch.value,null!==o&&a.addSong(r),e.next=15;break;case 11:a.recording=new C,i=new T([]),c=new CustomEvent("playSong",{detail:i}),window.dispatchEvent(c);case 15:a.state.isRecording=n,a.setState({open:a.state.isRecording});case 17:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.db=new je.a.Db(m,{songs:[]}),a.recording=new C;var i=a.getSettings();return a.dbCol={songs:a.db.collection("songs")},a.state={keyboardData:{instrument:i.instrument.value,playingSong:{timestamp:0,notes:[]},practicingSong:{timestamp:0,notes:[],threshold:100}},isRecording:!1,songs:[],settings:i,sliderState:{position:0,size:0},thereIsSong:"none",isDragging:!1},a.lastPlayedSong=new C,a.syncSongs(),a}return Object(i.a)(n,[{key:"componentDidMount",value:function(){document.body.addEventListener("dragenter",this.handleDrag),document.body.addEventListener("dragleave",this.resetDrag),document.body.addEventListener("dragover",this.handleDragOver),document.body.addEventListener("drop",this.handleDrop)}},{key:"componentWillUnmount",value:function(){document.body.removeEventListener("dragenter",this.handleDrag),document.body.removeEventListener("dragleave",this.resetDrag),document.body.removeEventListener("drop",this.handleDrop),document.body.addEventListener("dragover",this.handleDragOver)}},{key:"componentDidCatch",value:function(){new E("Warning","There was an error with the song! Restoring default...").trigger(),this.stopSong()}},{key:"render",value:function(){var e=this,t=this.state,n={handleRecording:this.handleRecording,changeSliderState:this.changeSliderState,stopSong:this.stopSong},a={addSong:this.addSong,removeSong:this.removeSong,playSong:this.playSong,practiceSong:this.practiceSong,stopSong:this.stopSong,changePage:this.props.changePage,handleSettingChange:this.handleSettingChange},r={songs:t.songs,settings:this.state.settings};return Object(q.jsxs)("div",{className:"app",children:[Object(q.jsxs)("div",{className:"rotate-screen",children:[Object(q.jsx)("img",{src:Ce,alt:"icon for the rotating screen"}),"For a better experience, add the website to the home screen, and rotate your device"]}),t.isDragging&&Object(q.jsx)("div",{className:"drag-n-drop",children:"Drop file here"}),Object(q.jsx)(fe,{functions:a,data:r}),Object(q.jsxs)("div",{className:"right-panel",children:[Object(q.jsx)("div",{className:"upper-right",children:"none"!==this.state.thereIsSong?Object(q.jsxs)("div",{className:"slider-wrapper",children:[Object(q.jsx)("button",{className:"song-button",onClick:this.stopSong,children:Object(q.jsx)(te.a,{icon:ne.s})}),Object(q.jsx)("input",{type:"range",className:"slider",min:0,onChange:this.handleSliderEvent,max:t.sliderState.size,value:t.sliderState.position}),Object(q.jsx)("button",{className:"song-button",onClick:Object(o.a)(s.a.mark((function n(){return s.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if("practicing"!==e.state.thereIsSong){n.next=4;break}e.practiceSong(t.keyboardData.practicingSong,t.sliderState.position),n.next=7;break;case 4:return n.next=6,e.stopSong();case 6:e.playSong(e.lastPlayedSong);case 7:case"end":return n.stop()}}),n)}))),children:Object(q.jsx)(te.a,{icon:ne.t})})]}):Object(q.jsx)(Ee,{active:t.isRecording,click:this.toggleRecord,children:t.isRecording?"Stop":"Record"})}),Object(q.jsx)("div",{className:"keyboard-wrapper",children:Object(q.jsx)($,{data:t.keyboardData,settings:this.state.settings,functions:n,isRecording:t.isRecording},t.keyboardData.instrument)})]})]})}}]),n}(u.Component);function Ee(e){var t="genshin-button record-btn "+(e.active?"selected":"");return Object(q.jsx)("button",{className:t,onClick:e.click,children:e.children})}!function(){if(JSON.parse(sessionStorage.getItem("isTwa")))return console.log("inTWA");var e=document.referrer.includes("android-app://");sessionStorage.setItem("isTwa",e)}();var Te=Ne,De=n.p+"static/media/addCell.73b6c8e9.svg",Pe=n.p+"static/media/removeCell.e266ba1a.svg",Ae=function(e){Object(c.a)(n,e);var t=Object(l.a)(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,e)).state={},a}return Object(i.a)(n,[{key:"render",value:function(){var e=this.props,t=e.data,n=e.functions,a=t.visible?"floating-tools tools-visible":"floating-tools";return Object(q.jsxs)("div",{className:a,children:[Object(q.jsxs)("div",{className:"tools-row",children:[Object(q.jsx)("div",{children:"Scroll to the left / right to select the columns"}),Object(q.jsx)("button",{onClick:n.toggleTools,children:"Close"})]}),Object(q.jsxs)("div",{className:"tools-buttons-wrapper",children:[Object(q.jsxs)("div",{className:"tools-half",children:[Object(q.jsx)("button",{disabled:0!==t.copiedColumns.length,onClick:function(e){e.currentTarget.blur(),n.copyColumns("all")},className:0!==t.copiedColumns.length?"tools-button-highlighted":"",children:"Copy"}),Object(q.jsxs)("button",{disabled:0!==t.copiedColumns.length,onClick:function(e){e.currentTarget.blur(),n.copyColumns(t.layer)},className:0!==t.copiedColumns.length?"tools-button-highlighted":"",children:["Copy layer ",t.layer]})]}),Object(q.jsxs)("div",{className:"tools-half",children:[Object(q.jsx)("button",{disabled:0===t.copiedColumns.length,onClick:function(e){e.currentTarget.blur(),n.pasteColumns(!1)},children:"Paste"}),Object(q.jsx)("button",{disabled:0===t.copiedColumns.length,onClick:function(e){e.currentTarget.blur(),n.pasteColumns(!0)},children:"Insert"})]}),Object(q.jsxs)("div",{className:"tools-half",children:[Object(q.jsx)("button",{disabled:0!==t.copiedColumns.length,onClick:function(e){e.currentTarget.blur(),n.eraseColumns("all")},children:"Erase"}),Object(q.jsxs)("button",{disabled:0!==t.copiedColumns.length,onClick:function(e){e.currentTarget.blur(),n.eraseColumns(t.layer)},children:["Erase layer ",t.layer]})]}),Object(q.jsx)("button",{disabled:0!==t.copiedColumns.length,onClick:n.deleteColumns,children:"Delete"})]})]})}}]),n}(u.Component),Le=function(e){Object(c.a)(n,e);var t=Object(l.a)(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,e)).state={},a}return Object(i.a)(n,[{key:"shouldComponentUpdate",value:function(e,t){return this.props.layers!==e.layers||this.props.skyText!==e.skyText}},{key:"render",value:function(){var e=this,t=this.props,n=t.data,a=t.layers,s=b.noteComposer;"1"===a[0]&&(s+=" layer-1"),"1"===a[1]&&(s+=" layer-2"),"1"===a[2]&&(s+=" layer-3");var o=n.noteNames.mobile,r="./assets/icons/keys/".concat(n.noteNames.mobile,".svg");"Sky"===m&&(r="./assets/icons/keys/".concat(t.skyImg,".svg")),"Sky"===m&&(o=t.skyText);return Object(q.jsx)("button",{onPointerDown:function(){return e.props.clickAction(n)},className:"button-hitbox",children:Object(q.jsxs)("div",{className:s,children:[Object(q.jsx)("img",{draggable:"false",alt:n.noteNames.mobile,src:r}),Object(q.jsx)("div",{className:"layer-3-ball-bigger"}),Object(q.jsx)("div",{className:"Sky"===m?"note-name-sky":"note-name",children:o})]})})}}]),n}(u.Component),Me=function(e){Object(c.a)(n,e);var t=Object(l.a)(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,e)).state={},a}return Object(i.a)(n,[{key:"render",value:function(){var e=this.props;return Object(q.jsx)(q.Fragment,{children:e.options.map((function(t){return Object(q.jsx)("button",{style:{backgroundColor:t===e.selected?e.selectedColor:""},className:e.buttonsClass,onClick:function(){return e.onSelect(t)},children:t},t)}))})}}]),n}(u.Component),Ie=function(e){Object(c.a)(n,e);var t=Object(l.a)(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,e)).state={},a}return Object(i.a)(n,[{key:"render",value:function(){var e=this.props,t=e.data,n=e.functions,a=t.currentColumn.notes.map((function(e){return e.index})),s=t.isPlaying?" hidden":"",o="keyboard";return 15===t.keyboard.layout.length&&(o+=" keyboard-5"),8===t.keyboard.layout.length&&(o+=" keyboard-4"),Object(q.jsxs)("div",{children:[Object(q.jsxs)("div",{className:o,children:[0===t.keyboard.layout.length?Object(q.jsx)("div",{className:"loading",children:"Loading..."}):null,t.keyboard.layout.map((function(e,s){var o=a.indexOf(s),r="",i="";try{r=x[S.indexOf(t.pitch)][e.index],i=k[t.keyboard.layout.length][e.index]}catch(c){}return Object(q.jsx)(Le,{layers:o>=0?t.currentColumn.notes[o].layer:"000",data:e,skyText:r,skyImg:i,clickAction:n.handleClick},e.index)}))]}),Object(q.jsxs)("div",{className:"bottom-right-wrapper"+s,children:[Object(q.jsxs)("div",{className:"layer-buttons-wrapper",children:[Object(q.jsx)("div",{className:"bottom-right-text",children:"Layer"}),Object(q.jsx)(Me,{buttonsClass:"layer-button",selectedColor:"#63aea7",options:[1,2,3],onSelect:n.changeLayer,selected:t.layer})]}),Object(q.jsxs)("div",{className:"tempo-changers-wrapper",children:[Object(q.jsx)("div",{className:"bottom-right-text",children:"Tempo"}),t.TempoChangers.map((function(e){return Object(q.jsx)("button",{onClick:function(){return n.handleTempoChanger(e)},style:{backgroundColor:"#"+e.color.toString(16)},children:e.text},e.id)}))]})]})]})}}]),n}(u.Component),Be=n(26),Re=n(14),Ve="#d3bd8e",Ge="#de4545",Fe="#de4545",We=v/3,Ue=[{color:5332079},{color:4739939},{color:1742475},{color:14053935}],He=["000","001","010","011","100","101","110","111"],Je=[{type:"short",color:"#282875"},{type:"long",color:"#282875"}],_e=function e(t,n){var a=this,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:30;Object(r.a)(this,e),this.generate=function(){P.forEach((function(e){var t=Ke(e,a,1);a.cache.columns.push(t.toDataURL())})),Ue.forEach((function(e){var t=Ke(e,a,1);a.cache.standard.push(t.toDataURL())})),Ue.forEach((function(e){var t=Ke(e,a,3);a.cache.standardLarger.push(t.toDataURL())})),He.forEach((function(e){var t=a.noteWidth>20?4:2,n=document.createElement("canvas");n.height=a.noteHeight,n.width=a.noteWidth;var s=n.getContext("2d");if("1"===e[0]&&(s.fillStyle=Ve,ze(s,a.margin/2,a.margin/2,a.noteWidth-a.margin-1,a.noteHeight-a.margin-1,t,!0,!1)),"1"===e[1]&&(s.strokeStyle=Ge,s.lineWidth=2,ze(s,a.margin/2,a.margin/2,a.noteWidth-a.margin-1,a.noteHeight-a.margin-1,t,!1,!0)),"1"===e[2]){s.beginPath(),s.fillStyle=Fe;var o=a.noteHeight/4;s.arc(a.noteWidth/2-.5,a.noteHeight/2-.5,o,0,2*Math.PI),s.fill()}a.cache.notes[e]=n.toDataURL()})),P.forEach((function(e){var t=Ke(e,a,2);a.cache.columnsLarger.push(t.toDataURL())})),Je.forEach((function(e){var t=document.createElement("canvas");if("short"===e.type){var n=a.timelineHeight/6;t.height=a.timelineHeight,t.width=2*n;var s=t.getContext("2d");s.fillStyle=e.color,s.arc(n,a.timelineHeight/2,n,0,2*Math.PI),s.fill(),a.cache.breakpoints.push(t.toDataURL())}else{t.height=a.height,t.width=a.width;var o=t.getContext("2d");o.fillStyle=e.color,o.beginPath(),o.moveTo(0,a.height),o.lineTo(a.noteWidth/2,a.height),o.lineTo(0,a.height-a.noteHeight),o.fill(),o.beginPath(),o.moveTo(a.width,a.height),o.lineTo(a.noteWidth/2,a.height),o.lineTo(a.width,a.height-a.noteHeight),o.fill(),o.beginPath(),o.moveTo(0,0),o.lineTo(a.noteWidth/2,0),o.lineTo(0,a.noteHeight),o.fill(),o.beginPath(),o.moveTo(a.width,0),o.lineTo(a.noteWidth/2,0),o.lineTo(a.width,a.noteHeight),o.fill(),a.cache.breakpoints.push(t.toDataURL())}}))},this.width=t,this.height=n,this.cache={columns:[],notes:{},standard:[],columnsLarger:[],standardLarger:[],breakpoints:[]},this.notesFigures=[],this.timelineHeight=o,this.margin=s,this.noteWidth=this.width,this.noteHeight=this.height/v,this.app=new Re.b({width:t,height:n}),this.generate()};function Ke(e,t,n){var a=document.createElement("canvas");a.height=t.height,a.width=t.width;var s=a.getContext("2d");s.fillStyle="#"+e.color.toString(16),s.fillRect(0,0,t.width,t.height),s.strokeStyle=2===n?"black":"#333333",s.lineWidth=n,s.beginPath(),s.moveTo(t.width,0),s.lineTo(t.width,t.height),s.stroke(),s.strokeStyle="#333333";for(var o=1;o<3;o++){s.lineWidth=1;var r=t.noteHeight*We*o;s.moveTo(0,r),s.lineTo(t.width,r)}return s.stroke(),a}function ze(e,t,n,a,s,o,r,i){if("undefined"===typeof i&&(i=!0),"undefined"===typeof o&&(o=5),"number"===typeof o)o={tl:o,tr:o,br:o,bl:o};else{var c={tl:0,tr:0,br:0,bl:0};for(var l in c)o[l]=o[l]||c[l]}e.beginPath(),e.moveTo(t+o.tl,n),e.lineTo(t+a-o.tr,n),e.quadraticCurveTo(t+a,n,t+a,n+o.tr),e.lineTo(t+a,n+s-o.br),e.quadraticCurveTo(t+a,n+s,t+a-o.br,n+s),e.lineTo(t+o.bl,n+s),e.quadraticCurveTo(t,n+s,t,n+s-o.bl),e.lineTo(t,n+o.tl),e.quadraticCurveTo(t,n,t+o.tl,n),e.closePath(),r&&e.fill(),i&&e.stroke()}n(193);var Ye=35,qe=function(e){Object(c.a)(n,e);var t=Object(l.a)(n);function n(e){var a;Object(r.a)(this,n),(a=t.call(this,e)).resetPointerDown=function(e){a.stageSelected=!1,a.sliderSelected=!1,a.stagePreviousPositon=0},a.handleKeyboard=function(e){switch(e.keyCode){case 39:a.handleBreakpoints(1);break;case 37:a.handleBreakpoints(-1)}},a.handleWheel=function(e){e.deltaY<0?a.props.functions.selectColumn(a.props.data.selected-1,!0):a.props.functions.selectColumn(a.props.data.selected+1,!0)},a.handleClick=function(e,t){var n=e.data.global.x;if("click"===t){var s=a.state.column.width*a.props.data.columns.length,o=Math.floor(n/a.state.width*s/a.state.column.width);a.props.functions.selectColumn(o)}"up"===t&&(a.sliderSelected=!1),"down"===t&&(a.sliderSelected=!0),"downStage"===t&&(a.stagePreviousPositon=n,a.stageSelected=!0)},a.handleStageSlide=function(e){var t=e.data.global.x;if(!0===a.stageSelected){if(a.throttleStage++,a.throttleStage<5)return;a.throttleStage=0;var n=a.stagePreviousPositon<t,s=Math.ceil(Math.abs(a.stagePreviousPositon-t)/8);s>4&&(s=4);var o=n?-1:1;a.stagePreviousPositon=t;var r=a.props.data.selected+o*s;if(a.props.data.selected===r)return;r<0&&(r=0),r>a.props.data.columns.length&&(r=a.props.data.columns.length-1),a.props.functions.selectColumn(r,!0)}},a.handleBreakpoints=function(e){var t,n=a.props.data.selected,s=a.props.data.columns,o=a.props.data.breakpoints;(t=1===e?o.filter((function(e){return e>n})).sort((function(e,t){return e-t})):o.filter((function(e){return e<n})).sort((function(e,t){return t-e}))).length>=0&&s.length>=t[0]&&t[0]>=0&&a.props.functions.selectColumn(t[0])},a.handleSlide=function(e){if(a.sliderSelected){if(a.throttleStage++,a.throttleStage<4)return;a.throttleStage=0;var t=a.state.column.width*a.props.data.columns.length,n=e.data.global.x,s=Math.floor(n/a.state.width*t/a.state.column.width);a.props.functions.selectColumn(s,!0)}};var s=document.body.getBoundingClientRect();a.sizes=s,Ye=Number(a.props.data.settings.columnsPerCanvas.value);var o,i=Xe(.82*s.width),c=Xe(.45*s.height);window.screen.width<s.height&&(i=Xe(.82*s.height),c=Xe(.45*s.width)),"Sky"===m&&(c=Xe(.95*c)),a.state={width:i,height:c,column:{width:(o=Xe(i),Xe(o/Ye)),height:c},timelineHeight:Y()()?25:30,currentBreakpoint:-1},a.canvasRef=d.a.createRef();var l=Y()()?1:4;return a.cache=new _e(a.state.column.width,c,l,a.state.timelineHeight).cache,a.stageSelected=!1,a.sliderSelected=!1,a.stagePreviousPositon=0,a.throttleStage=0,a}return Object(i.a)(n,[{key:"componentDidMount",value:function(){window.addEventListener("pointerup",this.resetPointerDown),this.canvasRef.current._canvas.addEventListener("wheel",this.handleWheel),window.addEventListener("keydown",this.handleKeyboard)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("pointerup",this.resetPointerDown),window.removeEventListener("keydown",this.handleKeyboard),this.canvasRef.current._canvas.removeEventListener("wheel",this.handleWheel)}},{key:"render",value:function(){var e=this,t=this.state,n=this.props,a=n.data,s=n.functions,o=this.state.column,r=(a.selected-Ye/2+1)*-o.width,i=this.state.timelineHeight,c=0,l=!1,u=this.cache,d=Number(a.settings.beatMarks.value),h=0===d?11:4*d-1,g=this.state.width/a.columns.length,p=Math.floor(g*(Ye+1));p>this.state.width&&(p=this.state.width);var m=g*a.selected-(Ye/2-1)*g;return Object(q.jsxs)("div",{className:"canvas-wrapper",style:{width:t.width+6},children:[Object(q.jsx)(Be.Stage,{width:t.width,height:t.height,options:{backgroundColor:4805734},ref:this.canvasRef,children:Object(q.jsx)(Be.Container,{anchor:[.5,.5],x:r,interactive:!0,pointerdown:function(t){return e.handleClick(t,"downStage")},pointermove:function(t){return e.handleStageSlide(t)},children:a.columns.map((function(e,t){if(c>h&&(l=!l,c=0),c++,!function(e,t){var n=Ye/2+2,a=[t-n,t+n];return a[0]<e&&e<a[1]}(t,a.selected))return null;var n=(t+1)%4===0?u.columnsLarger:u.columns,r=((t+1)%4===0?u.standardLarger:u.standard)[Number(l)],i=0===e.tempoChanger?r:n[e.tempoChanger];return Object(q.jsx)(Qe,{cache:u,data:e,index:t,sizes:o,backgroundCache:i,isToolsSelected:a.toolsColumns.includes(t),click:s.selectColumn,isSelected:t===a.selected,isBreakpoint:a.breakpoints.includes(t)},t)}))})},this.state.width),Object(q.jsxs)("div",{className:"timeline-wrapper",style:{height:this.state.timelineHeight},children:[Object(q.jsx)("div",{className:"timeline-button",onClick:function(){return e.handleBreakpoints(-1)},children:Object(q.jsx)(te.a,{icon:ne.q})}),Object(q.jsx)("div",{className:"timeline-button",onClick:function(){return e.handleBreakpoints(1)},children:Object(q.jsx)(te.a,{icon:ne.r})}),Object(q.jsxs)(Be.Stage,{width:t.width,height:i,options:{antialias:!0,autoDensity:!0},children:[Object(q.jsxs)(Be.Container,{width:this.state.width,height:this.state.timelineHeight,interactive:!0,pointertap:function(t){return e.handleClick(t,"click")},pointerdown:function(t){return e.handleClick(t,"down")},pointerup:function(t){return e.handleClick(t,"up")},pointermove:this.handleSlide,children:[Object(q.jsx)(Be.Graphics,{draw:function(t){var n,a,s;n=t,a=e.state.width,s=e.state.timelineHeight,n.clear(),n.beginFill(5332079,1),n.drawRect(0,0,a,s)}}),a.breakpoints.map((function(e){return Object(q.jsx)(Be.Sprite,{image:u.breakpoints[0],x:g*e},e)}))]}),Object(q.jsx)(Be.Graphics,{draw:function(t){return n=t,a=p,s=e.state.timelineHeight,n.clear(),n.lineStyle(3,1742475,.8),void n.drawRoundedRect(0,0,a-2,s-4,6);var n,a,s},x:m,y:2})]}),Object(q.jsx)("div",{className:"timeline-button",onClick:s.toggleBreakpoint,children:Object(q.jsx)(te.a,{icon:a.breakpoints.includes(a.selected)?ne.i:ne.n})})]})]})}}]),n}(u.Component);function Qe(e){var t=e.data,n=e.index,a=e.sizes,s=e.click,o=e.cache,r=e.backgroundCache,i=e.isBreakpoint,c=e.isSelected,l=e.isToolsSelected;return Object(q.jsxs)(Be.Container,{pointertap:function(){return s(n)},interactive:!0,x:a.width*n,children:[Object(q.jsxs)(Be.Sprite,{image:r,interactiveChildren:!1,children:[c||l?Object(q.jsx)(Be.Sprite,{image:l&&!c?o.standard[3]:o.standard[2],alpha:l?.4:.6,zIndex:1}):null,i?Object(q.jsx)(Be.Sprite,{image:o.breakpoints[1]}):null]}),t.notes.map((function(e){return Object(q.jsx)(Be.Sprite,{image:o.notes[e.layer],y:Ze[e.index]*a.height/v},e.index)}))]})}function Xe(e){return 2*Math.round(e/2)}var Ze=O,$e=qe,et=function(e){Object(c.a)(n,e);var t=Object(l.a)(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,e)).toggleMenu=function(e){"boolean"!==typeof e&&(e=void 0);var t=void 0!==e?e:!a.state.open;a.setState({open:t}),!1===t&&a.props.functions.toggleMenuVisible()},a.changeSelectedSongType=function(e){a.setState({selectedSongType:e})},a.selectSideMenu=function(e){if(e===a.state.selectedMenu&&a.state.open)return a.setState({open:!1});a.setState({selectedMenu:e,open:!0})},a.downloadSong=function(e){e._id&&delete e._id,e.data.isComposedVersion&&(e=I(e));var t=e.name;"Sky"===m&&(e=B(e)),Array.isArray(e)||(e=[e]),e.forEach((function(e){e.data.appName=m}));var n=JSON.stringify(e);(new D).download(n,"".concat(t,".").concat(m.toLowerCase(),"sheet.json")),new E("Success","Song downloaded").trigger()},a.state={open:!1,selectedMenu:"Settings",selectedSongType:"composed"},a}return Object(i.a)(n,[{key:"render",value:function(){var e=this,t=this.props,n=t.data,a=t.functions,s=this.state.open?"side-menu menu-open":"side-menu",o=this.state.selectedMenu,r=a.loadSong,i=a.removeSong,c=a.updateSong,l=a.changePage,u=a.handleSettingChange,d=a.changeVolume,h={loadSong:r,removeSong:i,toggleMenu:this.toggleMenu,downloadSong:this.downloadSong},g=n.songs.filter((function(e){var t;return!(null===(t=e.data)||void 0===t?void 0:t.isComposedVersion)})),p=n.songs.filter((function(e){var t;return null===(t=e.data)||void 0===t?void 0:t.isComposedVersion})),m=n.hasChanges?"margin-top-auto not-saved":"margin-top-auto",b=n.menuOpen?"menu menu-visible":"menu";return Object(q.jsxs)("div",{className:"menu-wrapper",children:[Object(q.jsxs)("div",{className:b,children:[Object(q.jsx)(nt,{action:this.toggleMenu}),Object(q.jsx)(rt,{type:"Save",action:function(){return c(n.currentSong)},className:m,children:Object(q.jsx)(te.a,{icon:ne.o,className:"icon"})}),Object(q.jsx)(rt,{type:"Songs",action:this.selectSideMenu,children:Object(q.jsx)(te.a,{icon:ne.j,className:"icon"})}),Object(q.jsx)(rt,{type:"Settings",action:this.selectSideMenu,children:Object(q.jsx)(te.a,{icon:ne.d,className:"icon"})}),Object(q.jsx)(rt,{type:"Composer",action:function(){return l("")},className:"inverted",children:Object(q.jsx)(te.a,{icon:ne.e,className:"icon"})})]}),Object(q.jsxs)("div",{className:s,children:[Object(q.jsx)(tt,{title:"No selection",visible:o}),Object(q.jsxs)(tt,{title:"Songs",visible:o,children:[Object(q.jsx)("div",{className:"songs-buttons-wrapper",children:Object(q.jsx)("button",{className:"genshin-button",onClick:this.props.functions.createNewSong,children:"Create new song"})}),Object(q.jsxs)("div",{className:"tab-selector-wrapper",children:[Object(q.jsx)("button",{className:"recorded"===this.state.selectedSongType?"tab-selector tab-selected":"tab-selector",onClick:function(){return e.changeSelectedSongType("recorded")},children:"Recorded"}),Object(q.jsx)("button",{className:"composed"===this.state.selectedSongType?"tab-selector tab-selected":"tab-selector",onClick:function(){return e.changeSelectedSongType("composed")},children:"Composed"})]}),Object(q.jsx)("div",{className:"songs-wrapper no-margin",children:"recorded"===this.state.selectedSongType?g.map((function(e){return Object(q.jsx)(at,{data:e,functions:h},e.name)})):p.map((function(e){return Object(q.jsx)(at,{data:e,functions:h},e.name)}))})]}),Object(q.jsxs)(tt,{title:"Settings",visible:o,children:[Object.entries(n.settings).map((function(e){var t=Object(ee.a)(e,2),n=t[0],a=t[1];return Object(q.jsx)(st,{objKey:n,data:a,changeVolume:d,update:u},n+a.value)})),!ot()&&Object(q.jsx)("a",{className:"donate-button",href:"https://www.buymeacoffee.com/Specy",target:"_blank",rel:"noreferrer",children:"Support me"})]})]})]})}}]),n}(u.Component);function tt(e){var t=e.visible===e.title?"menu-panel menu-panel-visible":"menu-panel";return Object(q.jsxs)("div",{className:t,children:[Object(q.jsx)("div",{className:"menu-title",children:e.title}),Object(q.jsx)("div",{className:"panel-content-wrapper",children:e.children})]})}function nt(e){return Object(q.jsx)("div",{onClick:function(){return e.action(!1)},className:"close-menu menu-item",children:Object(q.jsx)(te.a,{icon:ne.u,className:"icon"})})}function at(e){var t=e.data,n=e.functions,a=n.removeSong,s=n.toggleMenu,o=n.loadSong,r=n.downloadSong;return Object(q.jsxs)("div",{className:"song-row",children:[Object(q.jsx)("div",{className:"song-name",onClick:function(){o(t),s(!1)},children:t.name}),Object(q.jsxs)("div",{className:"song-buttons-wrapper",children:[Object(q.jsx)("button",{className:"song-button",onClick:function(){return r(t)},children:Object(q.jsx)(te.a,{icon:ne.g})}),Object(q.jsx)("button",{className:"song-button",onClick:function(){return a(t.name)},children:Object(q.jsx)(te.a,{icon:ne.w,color:"#ed4557"})})]})]})}function st(e){var t=e.data,n=e.update,a=e.objKey,s=e.changeVolume,o=Object(u.useState)(t.value),r=Object(ee.a)(o,2),i=r[0],c=r[1],l=Object(u.useState)(t.volume),d=Object(ee.a)(l,2),h=d[0],g=d[1];function p(e){var s=e.target.value;t.value=s,n({key:a,data:t})}return"settingVesion"===a?null:Object(q.jsxs)("div",{className:"settings-row",children:[Object(q.jsx)("div",{children:t.name}),"select"===t.type?Object(q.jsx)("select",{value:t.value,onChange:p,children:t.options.map((function(e){return Object(q.jsx)("option",{value:e,children:e},e)}))}):null,["number","text","checkbox"].includes(t.type)?Object(q.jsx)("input",{type:t.type,value:i,checked:i,onChange:function(e){var n=e.target,a="checkbox"===t.type?n.checked:n.value;"number"===t.type&&(a=Number(a),e.target.value="",a<t.threshold[0]||a>t.threshold[1])||c(a)},onBlur:function(){t.value!==i&&(t.value=i,n({key:a,data:t}))}}):null,"instrument"===t.type?Object(q.jsxs)("div",{className:"instrument-picker",children:[Object(q.jsx)("select",{value:t.value,onChange:p,children:t.options.map((function(e){return Object(q.jsx)("option",{value:e,children:e},e)}))}),Object(q.jsx)("input",{type:"range",min:1,max:100,value:h,onChange:function(e){g(Number(e.target.value))},onPointerUp:function(){s({key:a,value:h})}})]}):null]})}function ot(){return JSON.parse(sessionStorage.getItem("isTwa"))}var rt=function(e){Object(c.a)(n,e);var t=Object(l.a)(n);function n(){return Object(r.a)(this,n),t.apply(this,arguments)}return Object(i.a)(n,[{key:"render",value:function(){var e=this,t=this.props.className?"menu-item ".concat(this.props.className):"menu-item";return Object(q.jsx)("div",{className:t,onClick:function(){return e.props.action(e.props.type)},children:this.props.children})}}]),n}(u.Component),it=et;function ct(e){var t=Math.floor(e/6e4),n=(e%6e4/1e3).toFixed(0);return t+":"+(n<10?"0":"")+n}function lt(e,t){var n=e.columns,a=Math.floor(6e4/e.bpm),s=0;return n.forEach((function(e,n){n>t||(s+=a*P[e.tempoChanger].changer)})),s}function ut(e){return new Promise((function(t){X.a(t,e)}))}function dt(e,t,n){return t>=e.length?e.valueOf():e.substring(0,t)+n+e.substring(t+1)}var ht=function(e){Object(c.a)(n,e);var t=Object(l.a)(n);function n(e){var a;Object(r.a)(this,n),(a=t.call(this,e)).handleAutoSave=function(){a.changes++,a.changes>5&&a.state.settings.autosave.value&&"Untitled"!==a.state.song.name&&a.updateSong(a.state.song)},a.getSettings=function(){var e=localStorage.getItem(m+"_Composer_Settings");try{e=JSON.parse(e)}catch(t){e=null}return null!==e?e.settingVesion!==ye.settingVesion?(a.updateSettings(ye),ye):e:ye},a.updateSettings=function(e){var t;t=void 0!==e?e:a.state.settings,localStorage.setItem(m+"_Composer_Settings",JSON.stringify(t))},a.handleSettingChange=function(e){var t=a.state.settings,n=e.data;t[e.key].value=n.value,n.songSetting&&(a.state.song[e.key]=n.value),"instrument"===e.key&&a.loadInstrument(n.value,1),"layer2"===e.key&&a.loadInstrument(n.value,2),"layer3"===e.key&&a.loadInstrument(n.value,3),a.setState({settings:t,song:a.state.song},(function(){a.updateSettings()}))},a.loadInstrument=function(){var e=Object(o.a)(s.a.mark((function e(t,n){var o,r,i;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(1!==n){e.next=7;break}return o=new K(t),e.next=4,o.load(a.state.audioContext);case 4:a.setState({instrument:o}),e.next=13;break;case 7:return r=new K(t),(i=a.state.layers)[n-2]=r,e.next=12,r.load(a.state.audioContext);case 12:a.setState({layers:i});case 13:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),a.changeVolume=function(e){var t=a.state.settings;"instrument"===e.key&&(t.instrument.volume=e.value,a.state.instrument.changeVolume(e.value)),"layer2"===e.key&&(t.layer2.volume=e.value,a.state.layers[0].changeVolume(e.value)),"layer3"===e.key&&(t.layer3.volume=e.value,a.state.layers[1].changeVolume(e.value)),a.setState({settings:t},(function(){return a.updateSettings()}))},a.handleKeyboard=function(e){var t=e.keyCode;if("INPUT"!==document.activeElement.tagName)switch(t){case 68:a.selectColumn(a.state.song.selected+1);break;case 65:a.selectColumn(a.state.song.selected-1);break;case 49:a.handleTempoChanger(P[0]);break;case 50:a.handleTempoChanger(P[1]);break;case 51:a.handleTempoChanger(P[2]);break;case 52:a.handleTempoChanger(P[3]);break;case 32:a.togglePlay();break;case 81:a.removeColumns(1,a.state.song.selected);break;case 69:a.addColumns(1,a.state.song.selected)}},a.playSound=function(e,t){try{var n=a.state.audioContext.createBufferSource(),s=e.layout[t];if(void 0===s)return;n.buffer=s.buffer,n.playbackRate.value=H(a.state.settings.pitch.value),n.connect(e.gain),a.state.settings.caveMode.value?e.gain.connect(a.state.reverbAudioContext):e.gain.connect(a.state.audioContext.destination),n.start(0)}catch(o){}},a.handleClick=function(e){var t=a.state.song.columns[a.state.song.selected],n=t.notes.findIndex((function(t){return e.index===t.index})),s=a.state.layer-1;if(n<0){var o=new W(e.index);o.layer=dt(o.layer,s,"1"),t.notes.push(o)}else{var r=t.notes[n];r.layer=dt(r.layer,s,"0"===r.layer[s]?"1":"0"),"000"===r.layer&&t.notes.splice(n,1)}a.setState({song:a.state.song}),a.handleAutoSave();var i=a.state.instrument;a.state.layer>1&&(i=a.state.layers[a.state.layer-2]),a.playSound(i,e.index)},a.syncSongs=Object(o.a)(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.dbCol.songs.find().toArray();case 2:t=(t=e.sent).map((function(e){return e.data.isComposedVersion?L(e):e})),a.setState({composedSongs:t,songs:t});case 5:case"end":return e.stop()}}),e)}))),a.addSong=function(){var e=Object(o.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.songExists(t.name);case 2:if(!e.sent){e.next=4;break}return e.abrupt("return",new E("Warning","A song with this name already exists! \n"+t.name).trigger());case 4:return e.next=6,a.dbCol.songs.insert(I(t));case 6:a.syncSongs();case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.updateSong=function(){var e=Object(o.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("Untitled"!==t.name){e.next=8;break}return e.next=3,a.askForSongName();case 3:if(null!==(n=e.sent)){e.next=6;break}return e.abrupt("return");case 6:return t.name=n,e.abrupt("return",a.addSong(t));case 8:return e.abrupt("return",new Promise(function(){var e=Object(o.a)(s.a.mark((function e(n){var o,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=a.state.settings,e.next=3,a.songExists(t.name);case 3:if(!e.sent){e.next=14;break}return t.instruments[0]=o.instrument.value,t.instruments[1]=o.layer2.value,t.instruments[2]=o.layer3.value,e.next=9,a.dbCol.songs.update({name:t.name},I(t));case 9:console.log("song saved:",t.name),a.changes=0,a.syncSongs(),e.next=28;break;case 14:if(!t.name.includes("- Composed")){e.next=25;break}return e.next=17,a.askForSongName();case 17:if(null!==(r=e.sent)){e.next=20;break}return e.abrupt("return",n());case 20:return t.name=r,e.next=23,a.dbCol.songs.insert(I(t));case 23:return a.syncSongs(),e.abrupt("return",n());case 25:console.log("song doesn't exist"),t.name="Untitled",a.updateSong(t);case 28:n();case 29:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.askForSongName=function(){return new Promise(function(){var e=Object(o.a)(s.a.mark((function e(t){var n,o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n="Write song name, press cancel to ignore";case 1:return e.next=4,Se(n);case 4:if(null!==(o=e.sent)){e.next=7;break}return e.abrupt("return",t(null));case 7:if(""===o){e.next=17;break}return e.next=10,a.songExists(o);case 10:if(!e.sent){e.next=14;break}n="This song already exists: "+o,e.next=15;break;case 14:return e.abrupt("return",t(o));case 15:e.next=18;break;case 17:n="Write song name, press cancel to ignore";case 18:e.next=1;break;case 20:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())},a.askForSongUpdate=function(){return new Promise(function(){var e=Object(o.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,we('You have unsaved changes to the song: "'.concat(a.state.song.name,'" do you want to save now?'));case 2:n=e.sent,t(n);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())},a.songExists=function(){var e=Object(o.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.dbCol.songs.findOne({name:t});case 2:return e.t0=e.sent,e.t1=void 0,e.abrupt("return",e.t0!==e.t1);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.createNewSong=Object(o.a)(s.a.mark((function e(){var t,n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!("Untitled"!==a.state.song.name&&a.changes>0)){e.next=7;break}return e.next=3,a.askForSongUpdate();case 3:if(!e.sent){e.next=7;break}return e.next=7,a.updateSong(a.state.song);case 7:return e.next=9,a.askForSongName();case 9:if(null!==(t=e.sent)){e.next=12;break}return e.abrupt("return");case 12:n=new A(t),a.changes=0,a.setState({song:n},(function(){return a.addSong(n)}));case 15:case"end":return e.stop()}}),e)}))),a.removeSong=function(){var e=Object(o.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,we("Are you sure you want to delete the song: "+t);case 2:e.sent&&a.dbCol.songs.remove({name:t},a.syncSongs);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.loadSong=function(){var e=Object(o.a)(s.a.mark((function e(t){var n,o,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=a.state,(t=JSON.parse(JSON.stringify(t))).data.isComposedVersion||((t=G(t)).name+=" - Composed"),0===a.changes){e.next=12;break}if((o=n.settings.autosave.value&&"Untitled"!==n.song.name)||!(n.song.columns.length>0)){e.next=9;break}return e.next=8,we('You have unsaved changes to the song: "'.concat(n.song.name,'" do you want to save? UNSAVED CHANGES WILL BE LOST'));case 8:o=e.sent;case 9:if(!o){e.next=12;break}return e.next=12,a.updateSong(n.song);case 12:(r=a.state.settings).bpm.value=t.bpm,r.pitch.value=t.pitch,r.instrument.value!==t.instruments[0]&&(a.loadInstrument(t.instruments[0],1),r.instrument.value=t.instruments[0]),r.layer2.value!==t.instruments[1]&&(a.loadInstrument(t.instruments[1],2),r.layer2.value=t.instruments[1]),r.layer3.value!==t.instruments[2]&&(a.loadInstrument(t.instruments[2],3),r.layer3.value=t.instruments[2]),a.changes=0,a.setState({song:t,settings:r,toolsColumns:[]});case 20:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.addColumns=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"end";return new Promise((function(n){var s=new Array(e).fill().map((function(){return new F})),o=a.state.song.columns;"end"===t?o.push.apply(o,Object(p.a)(s)):o.splice.apply(o,[t+1,0].concat(Object(p.a)(s))),1===e&&a.selectColumn(a.state.song.selected+1),a.handleAutoSave(),a.setState({song:a.state.song},n)}))},a.removeColumns=function(e,t){var n=a.state.song;n.columns.length<16||(new Array(e).fill().map((function(e,n){return t+n})).forEach((function(e){n.breakpoints.includes(e)&&a.toggleBreakpoint(e)})),n.columns.splice(t,e),n.columns.length<=n.selected&&a.selectColumn(n.selected-1),a.handleAutoSave(),a.setState({song:n}))},a.togglePlay=function(){var e=Object(o.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n="boolean"===typeof t?t:!a.state.isPlaying,a.setState({isPlaying:n},Object(o.a)(s.a.mark((function e(){var t,n,o,r,i,c,l;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a.state.isPlaying&&a.selectColumn(a.state.song.selected),t=0,n=(new Date).getTime();case 3:if(!a.state.isPlaying){e.next=16;break}return o=a.state,r=o.song,i=o.settings,c=P[r.columns[r.selected].tempoChanger],l=Math.floor(6e4/i.bpm.value*c.changer)+t,n=(new Date).getTime(),e.next=10,ut(l);case 10:if(a.state.isPlaying){e.next=12;break}return e.abrupt("break",16);case 12:a.handleTick(),t=n+l-(new Date).getTime(),e.next=3;break;case 16:case"end":return e.stop()}}),e)}))));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.handleTick=function(){var e=a.state.song.selected+1;if(a.state.isPlaying&&e>a.state.song.columns.length-1)return a.togglePlay(!1);a.selectColumn(a.state.song.selected+1)},a.toggleMenuVisible=function(){a.setState({menuOpen:!a.state.menuOpen})},a.toggleBreakpoint=function(e){var t=a.state.song,n="number"===typeof e?e:t.selected,s=t.breakpoints.indexOf(n);s>=0&&t.columns.length>n?t.breakpoints.splice(s,1):t.columns.length>n&&t.breakpoints.push(n),a.validateBreakpoints(),a.setState({song:t})},a.handleTempoChanger=function(e){var t=a.state.song;t.columns[a.state.song.selected].tempoChanger=e.id,a.handleAutoSave(),a.setState({song:t})},a.changePage=function(){var e=Object(o.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0===a.changes){e.next=7;break}return e.next=3,we('You have unsaved changes to the song: "'.concat(a.state.song.name,'" do you want to save? UNSAVED CHANGES WILL BE LOST'));case 3:if(!e.sent){e.next=7;break}return e.next=7,a.updateSong(a.state.song);case 7:a.props.changePage(t);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.selectColumn=function(e,t){var n=a.state,s=n.song;if(!(e<0||e>s.columns.length-1)){var o=n.song.columns[e];s.selected=e;var r=n.toolsColumns;if(n.toolsVisible&&0===a.copiedColums.length){r.push(e);var i=Math.min.apply(Math,Object(p.a)(r)),c=Math.max.apply(Math,Object(p.a)(r));r=new Array(c-i+1).fill().map((function(e,t){return i+t}))}a.setState({song:s,toolsColumns:r}),t||o.notes.forEach((function(e){"1"===e.layer[0]&&a.playSound(n.instrument,e.index),"1"===e.layer[1]&&a.playSound(n.layers[0],e.index),"1"===e.layer[2]&&a.playSound(n.layers[1],e.index)}))}},a.changeLayer=function(e){a.setState({layer:e})},a.toggleTools=function(){a.setState({toolsVisible:!a.state.toolsVisible,toolsColumns:a.state.toolsVisible?[]:[a.state.song.selected]}),a.copiedColums=[]},a.copyColumns=function(e){a.copiedColums=[],a.state.toolsColumns.forEach((function(e){var t=a.state.song.columns[e];void 0!==t&&a.copiedColums.push(t)})),a.copiedColums=JSON.parse(JSON.stringify(a.copiedColums)),"all"!==e&&(a.copiedColums=a.copiedColums.map((function(t){return t.notes=t.notes.filter((function(t){return"1"===t.layer[e-1]})),t.notes=t.notes.map((function(t){return t.layer="000",t.layer=dt(t.layer,e-1,"1"),t})),t}))),a.setState({toolsColumns:[]})},a.pasteColumns=function(){var e=Object(o.a)(s.a.mark((function e(t){var n,o,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=a.state.song,o=JSON.parse(JSON.stringify(a.copiedColums)),t?o.forEach((function(e,t){var a=n.columns[n.selected+t];void 0!==a&&e.notes.forEach((function(e){var t=a.notes.findIndex((function(t){return e.index===t.index}));if(t<0)a.notes.push(e);else for(var n=0;n<3;n++)"1"===e.layer[n]&&(a.notes[t].layer=dt(a.notes[t].layer,n,1))}))})):(r=n.columns).splice.apply(r,[n.selected,0].concat(Object(p.a)(o))),a.setState({song:n});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.eraseColumns=function(e){var t=a.state.song;"all"===e?a.state.toolsColumns.forEach((function(e){void 0!==t.columns[e]&&(t.columns[e].notes=[])})):a.state.toolsColumns.forEach((function(n){void 0!==t.columns[n]&&t.columns[n].notes.forEach((function(t){t.layer=dt(t.layer,e-1,"0")}))})),a.setState({song:t})},a.validateBreakpoints=function(){var e=a.state.song.breakpoints.filter((function(e){return e<a.state.song.columns.length})),t=a.state.song;t.breakpoints=e,a.setState({song:t})},a.deleteColumns=Object(o.a)(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((t=a.state.song).columns=t.columns.filter((function(e,t){return!a.state.toolsColumns.includes(t)})),t.selected>t.columns.length-1&&(t.selected=t.columns.length-1),t.selected<=0&&(t.selected=0),0!==t.columns.length){e.next=7;break}return e.next=7,a.addColumns(12,0);case 7:a.setState({song:t,toolsColumns:[]},a.validateBreakpoints);case 8:case"end":return e.stop()}}),e)}))),a.db=new je.a.Db(m,{songs:[]}),a.dbCol={songs:a.db.collection("songs")};var i=a.getSettings();a.playbackInterval=void 0,a.state={instrument:new K,layers:[new K,new K],audioContext:new(window.AudioContext||window.webkitAudioContext),reverbAudioContext:new(window.AudioContext||window.webkitAudioContext),songs:[],isPlaying:!1,song:new A("Untitled"),settings:i,menuOpen:!1,layer:1,toolsColumns:[],toolsVisible:!1},a.copiedColums=[],a.changes=0,a.syncSongs(),a.loadInstrument(i.instrument.value,1),a.loadInstrument(i.layer2.value,2),a.loadInstrument(i.layer3.value,3);try{a.loadReverb()}catch(c){console.log("Error with reverb1")}return a}return Object(i.a)(n,[{key:"componentDidMount",value:function(){window.addEventListener("keydown",this.handleKeyboard),"localhost"!==window.location.hostname&&window.addEventListener("beforeunload",(function(e){e.preventDefault(),e.returnValue=""}))}},{key:"componentWillUnmount",value:function(){window.removeEventListener("keydown",this.handleKeyboard),this.state.isPlaying=!1}},{key:"componentDidCatch",value:function(){this.setState({song:new A("Untitled")}),new E("Warning","There was an error with the song! Restoring default...").trigger()}},{key:"loadReverb",value:function(){var e=this,t=this.state.audioContext;fetch("./assets/audio/reverb4.wav").then((function(e){return e.arrayBuffer().catch((function(e){console.log("Error with reverb1",e)}))})).then((function(n){return t.decodeAudioData(n,(function(n){var a=t.createConvolver(),s=t.createGain();s.gain.value=2.5,a.buffer=n,a.connect(s),s.connect(t.destination),e.setState({reverbAudioContext:a})}))})).catch((function(e){console.log("Error with reverb2",e)}))}},{key:"render",value:function(){var e=this,t=this.state,n=(this.props,t.song),a={songs:t.songs,currentSong:t.song,settings:t.settings,hasChanges:this.changes,menuOpen:t.menuOpen},s={loadSong:this.loadSong,removeSong:this.removeSong,createNewSong:this.createNewSong,changePage:this.changePage,updateSong:this.updateSong,handleSettingChange:this.handleSettingChange,toggleMenuVisible:this.toggleMenuVisible,changeVolume:this.changeVolume},o={handleClick:this.handleClick,handleTempoChanger:this.handleTempoChanger,changeLayer:this.changeLayer},r={keyboard:t.instrument,currentColumn:t.song.columns[t.song.selected],TempoChangers:P,layer:t.layer,pitch:t.settings.pitch.value,isPlaying:t.isPlaying},i={selectColumn:this.selectColumn,toggleBreakpoint:this.toggleBreakpoint},c={columns:n.columns,selected:n.selected,settings:t.settings,breakpoints:t.song.breakpoints,toolsColumns:t.toolsColumns},l={visible:this.state.toolsVisible,copiedColumns:this.copiedColums,layer:this.state.layer},u={toggleTools:this.toggleTools,eraseColumns:this.eraseColumns,deleteColumns:this.deleteColumns,copyColumns:this.copyColumns,pasteColumns:this.pasteColumns};return Object(q.jsxs)("div",{className:"app",children:[Object(q.jsx)("div",{className:"hamburger",onClick:this.toggleMenuVisible,children:Object(q.jsx)(te.a,{icon:ne.a})}),Object(q.jsxs)("div",{className:"rotate-screen",children:[Object(q.jsx)("img",{src:Ce,alt:"a rotating screen"}),"For a better experience, add the website to the home screen, and rotate your device"]}),Object(q.jsxs)("div",{className:"right-panel-composer",children:[Object(q.jsx)("div",{className:"column fill-x",children:Object(q.jsxs)("div",{className:"top-panel-composer",children:[Object(q.jsxs)("div",{className:"buttons-composer-wrapper",children:[Object(q.jsx)("div",{className:"tool",onClick:function(){return e.selectColumn(n.selected+1)},children:Object(q.jsx)(te.a,{icon:ne.c})}),Object(q.jsx)("div",{className:"tool",onClick:function(){return e.selectColumn(n.selected-1)},children:Object(q.jsx)(te.a,{icon:ne.b})}),Object(q.jsx)("div",{className:"tool",onClick:this.togglePlay,children:Object(q.jsx)(te.a,{icon:this.state.isPlaying?ne.k:ne.l})})]}),Object(q.jsx)($e,{functions:i,data:c},this.state.settings.columnsPerCanvas.value),Object(q.jsxs)("div",{className:"buttons-composer-wrapper-right",children:[Object(q.jsx)("div",{className:"tool",onClick:function(){return e.addColumns(1,n.selected)},children:Object(q.jsx)("img",{src:De,className:"tool-icon",alt:"Add a new cell"})}),Object(q.jsx)("div",{className:"tool",onClick:function(){return e.removeColumns(1,n.selected)},children:Object(q.jsx)("img",{src:Pe,className:"tool-icon",alt:"Remove a cell"})}),Object(q.jsx)("div",{className:"tool",onClick:function(){return e.addColumns(4*e.state.settings.beatMarks.value,"end")},children:Object(q.jsx)(te.a,{icon:ne.m})}),Object(q.jsx)("div",{className:"tool",onClick:this.toggleTools,children:Object(q.jsx)(te.a,{icon:ne.v})})]})]})}),Object(q.jsx)(Ie,{functions:o,data:r})]}),Object(q.jsx)(it,{data:a,functions:s}),Object(q.jsx)(Ae,{data:l,functions:u}),Object(q.jsxs)("div",{className:"song-info",children:[Object(q.jsx)("div",{children:n.name}),Object(q.jsxs)("div",{children:[ct(lt(this.state.song,this.state.song.selected)),"/",ct(lt(this.state.song,this.state.song.columns.length))]})]})]})}}]),n}(u.Component);function gt(e){var t=e.data,n=e.functions.deleteSong,a=e.functions.downloadSong;return Object(q.jsxs)("div",{className:"song-row",children:[Object(q.jsx)("div",{className:"song-name",children:t.name}),Object(q.jsxs)("div",{className:"song-buttons-wrapper",children:[Object(q.jsx)("button",{className:"song-button",onClick:function(){return a(t)},children:Object(q.jsx)(te.a,{icon:ne.g})}),Object(q.jsx)("button",{className:"song-button",onClick:function(){return n(t.name)},children:Object(q.jsx)(te.a,{icon:ne.w,color:"#ed4557"})})]})]})}var pt=function(e){Object(c.a)(n,e);var t=Object(l.a)(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,e)).syncSongs=Object(o.a)(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.dbCol.songs.find().toArray();case 2:t=e.sent,a.setState({songs:t});case 4:case"end":return e.stop()}}),e)}))),a.deleteSong=function(){var e=Object(o.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,we("Are you sure you want to delete the song: "+t);case 2:if(!e.sent){e.next=4;break}a.dbCol.songs.remove({name:t},a.syncSongs);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.deleteAllSongs=Object(o.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,we("Are you sure you want to delete ALL SONGS?");case 2:if(!e.sent){e.next=4;break}a.dbCol.songs.remove({},a.syncSongs);case 4:case"end":return e.stop()}}),e)}))),a.resetSettings=function(){localStorage.removeItem(m+"_Composer_Settings"),localStorage.removeItem(m+"_Main_Settings"),new E("Success","Settings have been reset").trigger()},a.downloadSong=function(e){e._id&&delete e._id;var t=JSON.stringify(e);(new D).download(t,"".concat(e.name,".").concat(m.toLowerCase(),"sheet.json"))},a.db=new je.a.Db(m,{songs:[]}),a.dbCol={songs:a.db.collection("songs")},a.state={songs:[]},a.syncSongs(),a}return Object(i.a)(n,[{key:"render",value:function(){var e=this;return Object(q.jsxs)("div",{className:"error-page app",children:[Object(q.jsxs)("div",{className:"error-text-wrapper",children:["There seems to be an error. ",Object(q.jsx)("br",{}),"Here you can download or delete your songs, try to find what song caused the error and remove it."]}),Object(q.jsxs)("div",{className:"error-buttons-wrapper",children:[Object(q.jsx)("button",{className:"genshin-button",onClick:this.resetSettings,children:"Reset settings"}),Object(q.jsx)("button",{className:"genshin-button",onClick:this.deleteAllSongs,children:"Delete all songs"})]}),Object(q.jsx)("div",{className:"error-songs-wrapper",children:this.state.songs.map((function(t){return Object(q.jsx)(gt,{data:t,functions:{deleteSong:e.deleteSong,downloadSong:e.downloadSong}})}))}),Object(q.jsx)("button",{className:"error-go-back genshin-button",onClick:function(){return e.props.changePage("")},children:"Go back to main page"})]})}}]),n}(u.Component),mt=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function bt(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://cra.link/PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}var ft=n(94),vt=n(20),jt=["","Composer","ErrorPage"],yt=function(e){Object(c.a)(n,e);var t=Object(l.a)(n);function n(e){var a;Object(r.a)(this,n),(a=t.call(this,e)).changePage=function(e){a.setState({selectedPage:e})},a.askForStorage=Object(o.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!navigator.storage||!navigator.storage.persist){e.next=6;break}return e.next=4,navigator.storage.persist();case 4:e.sent?new E("Success","Storage permission allowed").trigger():new E("Warning","Storage permission refused, if you weren't prompt, your browser denied it for you. Don't worry, it will still work fine",6e3).trigger();case 6:e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),console.log(e.t0),new E("Error","There was an error with setting up persistent storage").trigger();case 12:a.closeWelcomeScreen();case 13:case"end":return e.stop()}}),e,null,[[0,8]])}))),a.closeWelcomeScreen=function(){localStorage.setItem(m+"_Visited",!0),a.setState({hasVisited:!0})},a.hideMessage=function(){var e=a.state;e.floatingMessage.visible=!1,a.setState({floatingMessage:e.floatingMessage})},a.checkUpdate=function(){setTimeout((function(){var e=1.3,t=localStorage.getItem(m+"_Version");if(!a.state.hasVisited)return localStorage.setItem(m+"_Version",e);e!==t&&(new E("Update V1.3","\n          Improved library search UI, fixed bugs, (for sky) added kalimba\n        ",6e3).trigger(),localStorage.setItem(m+"_Version",e))}),1e3)},a.logEvent=function(e){(e=e.detail).timestamp=(new Date).getTime(),"object"===typeof e&&(a.setState({floatingMessage:{timestamp:e.timestamp,visible:!0,text:e.text,title:e.title}}),setTimeout((function(){a.state.floatingMessage.timestamp===e.timestamp&&a.setState({floatingMessage:{timestamp:0,visible:!1,text:"",title:""}})}),e.timeout))};var i=window.location.href.split("/");return i=0===i.length?"":i=i[i.length-1],jt.includes(i)||(i=""),a.state={floatingMessage:{timestamp:0,visible:!1,text:"Text",title:"Title"},hasVisited:localStorage.getItem(m+"_Visited"),hasPersistentStorage:navigator.storage&&navigator.storage.persist,selectedPage:i},a.checkUpdate(),a}return Object(i.a)(n,[{key:"componentDidMount",value:function(){window.addEventListener("logEvent",this.logEvent)}},{key:"componentDidCatch",value:function(){this.setState({selectedPage:"ErrorPage"})}},{key:"componentWillUnmount",value:function(){window.removeEventListener("logEvent",this.logEvent)}},{key:"render",value:function(){var e=this.state.floatingMessage,t=e.visible?"floating-message floating-message-visible":"floating-message";return Object(q.jsxs)("div",{className:"index",children:[Object(q.jsxs)("div",{className:t,onClick:this.hideMessage,children:[Object(q.jsx)("div",{className:"floating-message-title",children:e.title}),Object(q.jsx)("div",{className:"floating-message-text",children:e.text})]}),[null,!1,"false"].includes(this.state.hasVisited)?Object(q.jsxs)("div",{className:"welcome-message",children:[Object(q.jsxs)("div",{className:"welcome-message-title",children:["Welcome to ",m," music ","Sky"===m?"nightly":""]}),Object(q.jsxs)("div",{children:['This is a webapp which is run in your browser, if you currently are on one, please add the website to the homescreen to have a fullscreen view and a more "app" feel.',Object(q.jsx)("br",{}),Object(q.jsx)("br",{}),Object(q.jsx)("div",{className:"red-text",children:"WARNING"}),": Clearing your browser cache / storage might also delete your songs, make sure to make a backup sometimes.",Object(q.jsx)("br",{}),Object(q.jsx)("br",{}),this.state.hasPersistentStorage?Object(q.jsx)("div",{children:'To prevent your browser from automatically clearing the app storage, click the "confirm" button below, if asked, allow permission to keep the website data (Persistent storage).'}):null]}),Object(q.jsx)("div",{className:"welcome-message-button-wrapper",children:Object(q.jsx)("button",{className:"welcome-message-button",onClick:this.askForStorage,children:"Confirm"})})]}):null,Object(q.jsxs)(ft.a,{children:[Object(q.jsx)(vt.a,{to:"/"+this.state.selectedPage}),"ErrorPage"===this.state.selectedPage?Object(q.jsx)(vt.b,{exact:!0,path:"/ErrorPage",children:Object(q.jsx)(pt,{changePage:this.changePage})}):Object(q.jsxs)(q.Fragment,{children:[Object(q.jsx)(vt.b,{exact:!0,path:"/",children:Object(q.jsx)(Te,{changePage:this.changePage})}),Object(q.jsx)(vt.b,{exact:!0,path:"/Composer",children:Object(q.jsx)(ht,{changePage:this.changePage})})]})]})]})}}]),n}(u.Component);g.a.render(Object(q.jsx)(d.a.StrictMode,{children:Object(q.jsx)(yt,{})}),document.getElementById("root")),function(){if(JSON.parse(sessionStorage.getItem("isTwa")))return console.log("inTWA");var e=document.referrer.includes("android-app://");sessionStorage.setItem("isTwa",e)}(),function(e){if("serviceWorker"in navigator){if(new URL(".",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat(".","/service-worker.js");mt?bt(t,e):(!function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then((function(n){var a=n.headers.get("content-type");404===n.status||null!=a&&-1===a.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):bt(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://cra.link/PWA")})))}))}}()},65:function(e,t,n){},66:function(e,t,n){}},[[196,1,2]]]);
//# sourceMappingURL=main.43031bc4.chunk.js.map