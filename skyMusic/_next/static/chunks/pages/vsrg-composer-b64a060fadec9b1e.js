(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6747],{37347:function(e){!function(){function t(e,t){document.addEventListener?e.addEventListener("scroll",t,!1):e.attachEvent("scroll",t)}function s(e){this.g=document.createElement("div"),this.g.setAttribute("aria-hidden","true"),this.g.appendChild(document.createTextNode(e)),this.h=document.createElement("span"),this.i=document.createElement("span"),this.m=document.createElement("span"),this.j=document.createElement("span"),this.l=-1,this.h.style.cssText="max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;",this.i.style.cssText="max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;",this.j.style.cssText="max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;",this.m.style.cssText="display:inline-block;width:200%;height:200%;font-size:16px;max-width:none;",this.h.appendChild(this.m),this.i.appendChild(this.j),this.g.appendChild(this.h),this.g.appendChild(this.i)}function n(e,t){e.g.style.cssText="max-width:none;min-width:20px;min-height:20px;display:inline-block;overflow:hidden;position:absolute;width:auto;margin:0;padding:0;top:-999px;white-space:nowrap;font-synthesis:none;font:"+t+";"}function i(e){var t=e.g.offsetWidth,s=t+100;return e.j.style.width=s+"px",e.i.scrollLeft=s,e.h.scrollLeft=e.h.scrollWidth+100,e.l!==t&&(e.l=t,!0)}function r(e,s){function n(){i(r)&&null!==r.g.parentNode&&s(r.l)}var r=e;t(e.h,n),t(e.i,n),i(e)}function a(e,t,s){t=t||{},s=s||window,this.family=e,this.style=t.style||"normal",this.weight=t.weight||"normal",this.stretch=t.stretch||"normal",this.context=s}var o=null,l=null,c=null,h=null;function u(e){return null===h&&(h=!!e.document.fonts),h}function d(e,t){var s=e.style,n=e.weight;if(null===c){var i=document.createElement("div");try{i.style.font="condensed 100px sans-serif"}catch(e){}c=""!==i.style.font}return[s,n,c?e.stretch:"","100px",t].join(" ")}a.prototype.load=function(e,t){var i=this,a=e||"BESbswy",c=0,h=t||3e3,m=(new Date).getTime();return new Promise(function(e,t){if(u(i.context)&&(g=i.context,null===l&&(l=!!(u(g)&&/Apple/.test(window.navigator.vendor))&&!!(g=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))(?:\.([0-9]+))/.exec(window.navigator.userAgent))&&603>parseInt(g[1],10)),!l)){var g,p,f=new Promise(function(e,t){!function s(){(new Date).getTime()-m>=h?t(Error(""+h+"ms timeout exceeded")):i.context.document.fonts.load(d(i,'"'+i.family+'"'),a).then(function(t){1<=t.length?e():setTimeout(s,25)},t)}()});Promise.race([new Promise(function(e,t){c=setTimeout(function(){t(Error(""+h+"ms timeout exceeded"))},h)}),f]).then(function(){clearTimeout(c),e(i)},t)}else p=function(){function l(){var t;(t=-1!=f&&-1!=v||-1!=f&&-1!=x||-1!=v&&-1!=x)&&((t=f!=v&&f!=x&&v!=x)||(null===o&&(o=!!(t=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))/.exec(window.navigator.userAgent))&&(536>parseInt(t[1],10)||536===parseInt(t[1],10)&&11>=parseInt(t[2],10))),t=o&&(f==b&&v==b&&x==b||f==y&&v==y&&x==y||f==j&&v==j&&x==j)),t=!t),t&&(null!==k.parentNode&&k.parentNode.removeChild(k),clearTimeout(c),e(i))}var u=new s(a),g=new s(a),p=new s(a),f=-1,v=-1,x=-1,b=-1,y=-1,j=-1,k=document.createElement("div");k.dir="ltr",n(u,d(i,"sans-serif")),n(g,d(i,"serif")),n(p,d(i,"monospace")),k.appendChild(u.g),k.appendChild(g.g),k.appendChild(p.g),i.context.document.body.appendChild(k),b=u.g.offsetWidth,y=g.g.offsetWidth,j=p.g.offsetWidth,function e(){if((new Date).getTime()-m>=h)null!==k.parentNode&&k.parentNode.removeChild(k),t(Error(""+h+"ms timeout exceeded"));else{var s=i.context.document.hidden;(!0===s||void 0===s)&&(f=u.g.offsetWidth,v=g.g.offsetWidth,x=p.g.offsetWidth,l()),c=setTimeout(e,50)}}(),r(u,function(e){f=e,l()}),n(u,d(i,'"'+i.family+'",sans-serif')),r(g,function(e){v=e,l()}),n(g,d(i,'"'+i.family+'",serif')),r(p,function(e){x=e,l()}),n(p,d(i,'"'+i.family+'",monospace'))},document.body?p():document.addEventListener?document.addEventListener("DOMContentLoaded",function e(){document.removeEventListener("DOMContentLoaded",e),p()}):document.attachEvent("onreadystatechange",function e(){("interactive"==document.readyState||"complete"==document.readyState)&&(document.detachEvent("onreadystatechange",e),p())})})},e.exports=a}()},40120:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/vsrg-composer",function(){return s(90045)}])},70560:function(e,t,s){"use strict";s.d(t,{A:function(){return l},s:function(){return o}});var n=s(85893),i=s(20557),r=s.n(i),a=s(67421);function o(e){let{children:t}=e;return(0,n.jsx)("div",{className:"keyboard-key",children:t})}function l(e){let{shortcuts:t,className:s,style:i}=e,{t:l}=(0,a.$G)("shortcuts");return(0,n.jsx)("table",{className:"".concat(r()["keys-table"]," ").concat(s),style:i,children:(0,n.jsx)("tbody",{children:Array.from(t.entries()).map(e=>{let[t,{name:s,description:i,holdable:r}]=e,a=i?l("props.".concat(i)):s;return(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{children:(0,n.jsxs)(o,{children:[" ",t]})}),(0,n.jsxs)("td",{children:[a,r&&(0,n.jsxs)("span",{style:{fontSize:"0.8rem"},children:[" (",l("holdable"),")"]})]})]},s)})})})}},42474:function(e,t,s){"use strict";s.d(t,{k:function(){return a}});var n=s(85893),i=s(39324),r=s(67294);function a(e){var t;let{options:s,selected:a,onChange:o}=e,l=(0,r.useRef)(null),c=s.find(e=>e.value===a),[h,u]=(0,r.useState)({width:0,left:0});return(0,r.useEffect)(()=>{var e;let t=null===(e=l.current)||void 0===e?void 0:e.querySelectorAll("button"),n=s.findIndex(e=>e.value===a);if(!t||n<0)return;let i=t[n].getBoundingClientRect(),r=l.current.getBoundingClientRect();u({width:i.width-3,left:i.left-r.left})},[l,s,a]),(0,n.jsxs)("div",{className:"multiple-option-slider",ref:l,style:{border:"solid 0.1rem ".concat(null!==(t=null==c?void 0:c.color)&&void 0!==t?t:"var(--accent)")},children:[s.map(e=>(0,n.jsx)("button",{onClick:()=>o(e.value),className:e===c?"multiple-options-selected":"",children:(0,i.kC)(e.text)},e.value)),(0,n.jsx)("div",{className:"multiple-option-slider-overlay",style:{width:"".concat(h.width,"px"),left:"".concat(h.left,"px"),backgroundColor:null==c?void 0:c.color}})]})}},66834:function(e,t,s){"use strict";s.d(t,{x:function(){return o}});var n=s(85893),i=s(17544),r=s(21820),a=s.n(r);function o(e){let{selected:t,onChange:s,style:r,children:o,className:l}=e;return(0,n.jsxs)("select",{className:"".concat(a().select," ").concat(null!=l?l:""),style:{width:"100%",padding:"0.3rem",...r},onChange:e=>{s(e.target.value),e.target.blur()},value:t,children:[o,i.T_.map(e=>(0,n.jsx)("option",{children:e},e))]})}},19502:function(e,t,s){"use strict";s.d(t,{P:function(){return l}});var n=s(85893),i=s(92634),r=s(21820),a=s.n(r),o=s(67294);function l(e){let{onChange:t,value:s,children:r,style:l}=e,[c]=(0,i.F)(),h=(0,o.useCallback)(e=>{t(e),e.target.blur()},[t]);return(0,n.jsx)("select",{onChange:h,value:s,className:a().select,style:{backgroundImage:"url(\"data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' height='24' viewBox='0 0 24 24' width='24' fill='".concat(c.getText("primary").hex().replace("#","%23"),"'><path d='M0 0h24v24H0z' fill='none'/><path d='M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z'/></svg>\")"),...l},children:r})}},84455:function(e,t,s){"use strict";s.d(t,{F:function(){return a}});var n=s(85893),i=s(41664),r=s.n(i);function a(e){let{href:t,children:s,style:i,...a}=e;return(0,n.jsx)(r(),{href:t,style:{display:"inline-block",textDecoration:"underline",color:"var(--accent)",...i},...a,children:s})}},40419:function(e,t,s){"use strict";s.d(t,{v:function(){return n}});class n{get fps(){return this.maxFps}changeMaxFps(e){this.maxFps=e,this.maxFpsInterval=1e3/e}setCallback(e){this.callback=e}start(e){this.stop(),this.startTime=Date.now(),this.nextTick=Date.now(),this.previousTickTime=0,this.duration=null!=e?e:Number.MAX_SAFE_INTEGER,this.tick()}stop(){clearTimeout(this.raf)}constructor(e,t){this.nextTick=0,this.maxFpsInterval=0,this.deltaTime=0,this.raf=0,this.duration=0,this.previousTickTime=0,this.tick=()=>{let e=Date.now();this.deltaTime=e-this.nextTick,this.deltaTime>=this.maxFpsInterval&&(this.nextTick=e-this.deltaTime%this.maxFpsInterval,this.callback(this.elapsed,e-this.previousTickTime),this.previousTickTime=e),this.elapsed=e-this.startTime,this.elapsed<this.duration&&(this.raf=setTimeout(this.tick,8))},this.callback=e,this.startTime=0,this.elapsed=0,this.maxFps=t,this.maxFpsInterval=1e3/t}}},74646:function(e,t,s){"use strict";s.d(t,{z:function(){return r}});var n=s(83679),i=s(92761);class r{setBasePitch(e){this.basePitch=e}destroy(){this.audioInstruments.forEach(e=>{i.n.disconnect(e.endNode),e.dispose()})}syncInstruments(e){return this.instruments=e,this.loadInstruments()}async loadInstruments(){let{instruments:e,audioInstruments:t}=this;return t.splice(e.length).forEach(e=>{i.n.disconnect(e.endNode),e.dispose()}),Promise.all(e.map(async(e,s)=>{if(void 0===t[s]){let r=new n.Yx(e.name);return t[s]=r,await r.load(i.n.getAudioContext()),i.n.connect(r.endNode,e.reverbOverride),r.changeVolume(e.volume),r}if(t[s].name===e.name)return t[s].changeVolume(e.volume),i.n.setReverbOfNode(t[s].endNode,e.reverbOverride),t[s];{let r=t[s];i.n.disconnect(r.endNode),r.dispose();let a=new n.Yx(e.name);return t[s]=a,await a.load(i.n.getAudioContext()),i.n.connect(a.endNode,e.reverbOverride),a.changeVolume(e.volume),a}}))}playNoteOfInstrument(e,t,s){let n=this.instruments[e];this.audioInstruments[e].play(t,null!=s?s:n.pitch||this.basePitch)}playNotesOfInstrument(e,t,s){t.forEach(t=>this.playNoteOfInstrument(e,t,s))}constructor(e){this.instruments=[],this.audioInstruments=[],this.basePitch="C",this.basePitch=e}}},90045:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return eK}});var n=s(85893),i=s(67294),r=s(48043),a=s(50746),o=s(20027),l=s(17678),c=s(54135),h=s(86998),u=s(31602),d=s(52461),m=s(46335),g=s(97411),p=s(10694),f=s(12293),v=s(86087),x=s(24104),b=s(92634),y=s(89867),j=s(85565),k=s(78773),w=s(40569),S=s(6340),C=s(11090);function T(e){let{data:t,onChange:s,onVisibilityChange:i,theme:a,style:o}=e,l=a.layer("menu_background",.2).desaturate(.5);return(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)(C.X,{align:"center",justify:"between",className:"track-modifier",style:{backgroundColor:l.hex(),...o},children:[(0,n.jsx)("span",{className:"text-ellipsis",children:t.alias}),(0,n.jsxs)(C.X,{align:"center",justify:"end",children:[(0,n.jsx)(r.J,{className:"flex-centered vsrg-track-modifier-button",onClick:()=>i(!t.hidden),children:t.hidden?(0,n.jsx)(k.tgn,{}):(0,n.jsx)(k.dSq,{})}),(0,n.jsx)(r.J,{className:"flex-centered vsrg-track-modifier-button",style:{marginLeft:"0.3rem"},onClick:()=>s(t.set({muted:!t.muted})),children:t.muted?(0,n.jsx)(k.xZH,{}):(0,n.jsx)(k.rxG,{})})]})]})})}var _=s(7374),H=s(32362),N=s(5323),E=s(70560),O=s(82860),P=s(84455),z=s(82446),M=s(67421);function R(){let{t:e}=(0,M.$G)(["tutorials","shortcuts"]),t=_.z5.getVsrgKeybinds(6),{IS_MOBILE:s}=(0,N.Z)(),[i]=(0,H.Kq)(_.z5.getShortcutMap("vsrg_composer"));return(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)(O.s,{children:[(0,n.jsx)(z.h,{type:"h2",children:e("help.learn_how_to_use_vsrg_composer")}),(0,n.jsx)("p",{children:(0,n.jsx)(P.F,{href:"/blog/posts/how-to-use-player",children:e("help.click_to_visit_blog")})}),!s&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(z.h,{type:"h2",children:e("help.vsrg_composer_shortcuts")}),(0,n.jsx)(P.F,{href:"/keybinds",style:{marginTop:"1rem"},children:(0,n.jsx)(r.J,{children:e("help.change_keybinds")})}),(0,n.jsx)(E.A,{shortcuts:i}),(0,n.jsxs)("div",{className:"row",style:{padding:"0.1rem",gap:"1rem",marginTop:"-0.1rem"},children:[(0,n.jsx)(E.s,{children:t.join("/")}),(0,n.jsx)("div",{children:e("shortcuts:props.vsrg_add_hit_object")})]})]})]})})}var I=s(53179),A=s(21820),F=s.n(A),L=s(17544),D=s(99962),B=s(95616),W=(0,i.memo)(function(e){let{onSave:t,onSongOpen:s,settings:u,handleSettingChange:d,hasChanges:p,onCreateSong:y,setAudioSong:j,audioSong:S,trackModifiers:_,onTrackModifierChange:H}=e,{t:E}=(0,M.$G)(["menu","common","vsrg_composer","settings"]),[O,z]=(0,i.useState)(!1),[I,A]=(0,i.useState)(!1),[L,W]=(0,i.useState)("Settings"),[$]=(0,v.j)(),[X]=(0,x.n)(),[q]=(0,b.F)(),{IS_MOBILE:Z}=(0,N.Z)(),V=(0,f.ZP)(e=>{A(!1)},{active:O&&I,ignoreFocusable:!0});return(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)(D.q,{ref:V,current:L,setCurrent:W,open:O,setOpen:z,visible:I,children:[(0,n.jsx)("div",{className:"hamburger vsrg-hamburger",onClick:()=>A(!I),children:(0,n.jsx)(g.c,{icon:k.Fm7})}),(0,n.jsxs)(D.V,{children:[(0,n.jsx)(c.j,{onClick:()=>A(!I),className:"close-menu",ariaLabel:"Close menu",children:(0,n.jsx)(g.c,{icon:k.aHS,className:"icon"})}),(0,n.jsx)(c.j,{onClick:t,style:{marginTop:"auto"},className:p?"not-saved":"",ariaLabel:E("common:save"),children:(0,n.jsx)(g.c,{icon:k.TvB,className:"icon"})}),(0,n.jsx)(c.s,{id:"Help",ariaLabel:E("help"),children:(0,n.jsx)(g.c,{icon:k.g_g,className:"icon"})}),(0,n.jsx)(c.s,{id:"Songs",ariaLabel:E("song_menu"),children:(0,n.jsx)(g.c,{icon:k.HcQ,className:"icon"})}),(0,n.jsx)(c.s,{id:"Settings",ariaLabel:E("settings_menu"),children:(0,n.jsx)(g.c,{icon:k.p4t,className:"icon"})}),(0,n.jsx)(c.j,{onClick:w.I.open,ariaLabel:E("open_home_menu"),style:{border:"solid 0.1rem var(--secondary)"},children:(0,n.jsx)(g.c,{icon:k.xng,className:"icon"})})]}),(0,n.jsxs)(o.f,{children:[(0,n.jsx)(o.G,{id:"Help",children:(0,n.jsx)(R,{})}),(0,n.jsxs)(o.G,{id:"Songs",children:[(0,n.jsx)("div",{className:"row",children:(0,n.jsx)(r.J,{onClick:y,children:E("common:create_song")})}),(0,n.jsx)(l.G,{songs:X,exclude:["composed","recorded"],style:{marginTop:"0.6rem"},SongComponent:K,componentProps:{theme:q,folders:$,functions:{onClick:s,toggleMenu:A}}})]}),(0,n.jsxs)(o.G,{id:"Settings",children:[(0,n.jsx)(h.A,{settings:u,onUpdate:d}),(0,n.jsxs)("div",{className:"column vsrg-select-song-wrapper",children:[(0,n.jsxs)(C.X,{align:"center",children:[(0,n.jsx)("h1",{className:"".concat(F()["settings-group-title"]," row-centered"),children:E("vsrg_composer:background_song")}),(0,n.jsx)(m.k,{buttonStyle:{width:"1.2rem",height:"1.2rem",marginLeft:"0.5rem"},position:"middle",children:E("vsrg_composer:background_song_info")})]}),null===S?(0,n.jsx)("span",{children:E("vsrg_composer:no_background_song_selected")}):(0,n.jsxs)("div",{className:"column vsrg-composer-selected-song",children:[(0,n.jsxs)("div",{className:"row",style:{borderBottom:"2px solid var(--secondary)",paddingBottom:"0.4rem",marginBottom:"0.4rem"},children:[(0,n.jsx)("span",{className:"song-name",style:{cursor:"default"},children:S.name}),(0,n.jsx)(a.v,{onClick:()=>j(null),ariaLabel:E("vsrg_composer:remove_background_song"),tooltip:E("vsrg_composer:remove_background_song"),style:{backgroundColor:"var(--red-bg)",margin:0},children:(0,n.jsx)(k.aHS,{})})]}),(0,n.jsxs)(C.X,{justify:"between",align:"center",children:[(0,n.jsx)("span",{children:E("common:pitch")}),(0,n.jsx)("span",{children:S.pitch})]}),(0,n.jsxs)(C.X,{justify:"between",align:"center",children:[(0,n.jsx)("span",{children:E("common:bpm")}),(0,n.jsx)("span",{children:S.bpm})]}),(0,n.jsx)("span",{style:{marginTop:"0.4rem"},children:E("vsrg_composer:instrument_modifiers")}),_.map((e,t)=>(0,n.jsx)(T,{theme:q,data:e,onChange:e=>H(e,t,!1),onVisibilityChange:s=>{H(e.set({hidden:s}),t,!0)}},t))]}),(0,n.jsx)(l.G,{songs:X,exclude:["vsrg"],style:{marginTop:"0.6rem"},SongComponent:J,componentProps:{onClick:j}})]}),!Z&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(B.Z,{background:"var(--secondary)",height:"0.1rem",verticalMargin:"0.5rem"}),(0,n.jsx)(P.F,{href:"/keybinds",style:{marginLeft:"auto"},children:(0,n.jsx)(r.J,{children:E("settings:change_keybinds")})})]})]})]})]})})},(e,t)=>e.settings===t.settings&&e.hasChanges===t.hasChanges&&e.audioSong===t.audioSong&&e.trackModifiers===t.trackModifiers);function J(e){let{data:t,onClick:s}=e;return(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("div",{className:"song-row ".concat((0,p.h)(!0)),onClick:async()=>{let e=await j.v.getOneSerializedFromStorable(t);if(!e)return I.kg.error("Could not find song");s(e)},style:{cursor:"pointer"},children:[(0,n.jsx)("div",{className:"song-name",children:t.name}),(0,n.jsx)(p.u,{children:"Click to select as background song"})]})})}function K(e){let{data:t,functions:s,theme:r,folders:a}=e,{toggleMenu:o,onClick:l}=s,c={backgroundColor:r.layer("primary",.15).toString()},[h,m]=(0,i.useState)(!1),[g,f]=(0,i.useState)(t.name);return((0,i.useEffect)(()=>{f(t.name)},[t.name]),"vsrg"!==t.type)?(0,n.jsx)("div",{className:"row",children:"Invalid song"}):(0,n.jsxs)("div",{className:"song-row",children:[(0,n.jsxs)("div",{className:"song-name ".concat((0,p.h)(!0)),onClick:async()=>{if(h)return;let e=await j.v.fromStorableSong(t);if(!e)return I.kg.error("Could not find song");l(e),o(!1)},children:[h?(0,n.jsx)("input",{className:"song-name-input ".concat(h?"song-rename":""),disabled:!h,onChange:e=>f(e.target.value),style:{width:"100%",color:"var(--primary-text)"},value:g}):(0,n.jsx)("div",{style:{marginLeft:"0.3rem"},children:g}),(0,n.jsx)(p.u,{children:h?"Song name":"Play song"})]}),(0,n.jsx)("div",{className:"song-buttons-wrapper",children:(0,n.jsxs)(d.Rk,{Icon:k.LCi,style:c,ignoreClickOutside:h,tooltip:"More options",onClose:()=>m(!1),children:[(0,n.jsxs)(d.tc,{onClick:()=>{h&&(S.k.renameSong(t.id,g),m(!1)),m(!h)},children:[(0,n.jsx)(k.tU3,{style:{marginRight:"0.4rem"},size:14}),(0,n.jsx)(d.Qr,{text:h?"Save":"Rename"})]}),(0,n.jsxs)(d.tc,{style:{padding:"0 0.4rem"},children:[(0,n.jsx)(k.$nz,{style:{marginRight:"0.4rem"}}),(0,n.jsxs)("select",{className:"dropdown-select",value:t.folderId||"_None",onChange:async e=>{let s=e.target.value,n=await j.v.getOneSerializedFromStorable(t);if(!n)return I.kg.error("Could not find song");S.k.addSongToFolder(n,"_None"!==s?s:null)},children:[(0,n.jsx)("option",{value:"_None",children:"None"}),a.map(e=>(0,n.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,n.jsxs)(d.tc,{onClick:async()=>{let e=await j.v.getOneSerializedFromStorable(t);if(!e)return I.kg.error("Could not find song");y.bV.downloadSong(e,"".concat(t.name,".").concat(L.iC.toLowerCase(),"sheet"))},children:[(0,n.jsx)(k.aBF,{style:{marginRight:"0.4rem"},size:14}),(0,n.jsx)(d.Qr,{text:"Download"})]}),(0,n.jsxs)(d.tc,{onClick:async()=>{await (0,u.jH)("Are you sure you want to delete this song?")&&S.k.removeSong(t.id)},children:[(0,n.jsx)(k.Xm5,{color:"#ed4557",style:{marginRight:"0.4rem"},size:14}),(0,n.jsx)(d.Qr,{text:"Delete"})]})]})})]})}var $=s(19502),X=s(42474),q=s(10418);let Z=[1,2,4,8,16];function V(e){let{onSnapPointChange:t,onHitObjectTypeChange:s,selectedSnapPoint:a,isPlaying:o,togglePlay:l,selectedHitObjectType:c,vsrg:h,onScalingChange:u,scaling:d,tempoChanger:m,onTempoChangerChange:g}=e,{t:p}=(0,M.$G)("vsrg_composer"),f=(0,i.useMemo)(()=>[{value:"tap",text:p("tap"),color:"var(--accent)"},{value:"hold",text:p("hold"),color:"#8569a9"},{value:"delete",text:p("delete"),color:"var(--red)"}],[p,q.WV.language]);return(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("div",{className:"vsrg-bottom",children:[(0,n.jsx)(X.k,{options:f,selected:c,onChange:e=>{s(e)}}),(0,n.jsx)("div",{className:"vsrg-name text-ellipsis",children:h.name}),(0,n.jsx)("div",{className:"flex-centered",style:{flex:"1",padding:"0 1rem"},children:(0,n.jsx)("input",{type:"range",min:10,style:{width:"100%"},max:120,value:d,onPointerUp:e=>{var t;null===(t=e.target)||void 0===t||t.blur()},onChange:e=>u(parseInt(e.target.value))})}),(0,n.jsxs)("div",{className:"flex-centered",style:{height:"100%"},children:[(0,n.jsx)($.P,{value:m,onChange:e=>g(Number(e.target.value)),style:{width:"5rem",height:"100%",borderRadius:"0.4rem",marginRight:"0.6rem"},children:L.zr.map(e=>(0,n.jsxs)("option",{value:e,children:[100*e,"%"]},e))}),(0,n.jsx)($.P,{value:a,onChange:e=>{t(parseInt(e.target.value))},style:{width:"6rem",height:"100%",borderRadius:"0.4rem"},children:Z.map(e=>(0,n.jsxs)("option",{value:e,children:[p("snap"),": 1/",e]},e))}),(0,n.jsx)(r.J,{className:"vsrg-play-button flex-centered",onClick:l,children:o?(0,n.jsx)(k.Wh,{size:20}):(0,n.jsx)(k.gmG,{size:20})})]})]})})}var U=s(6767),G=s.n(U);function Y(e){let{elements:t,perRow:s,onClick:i,selected:r}=e;return(0,n.jsx)(n.Fragment,{children:(0,n.jsx)("div",{className:"vsrg-keyboard",style:{gridTemplateColumns:"repeat(".concat(s,", 1fr)"),gridTemplateRows:"repeat(".concat(Math.ceil(t.length/s),", 1fr)"),opacity:r?1:.5,pointerEvents:r?"all":"none",cursor:r?"pointer":"not-allowed"},children:t.map(e=>(0,n.jsx)("button",{onClick:()=>i(e),style:(null==r?void 0:r.includes(e))?{backgroundColor:"var(--accent)"}:{}},e))})})}var Q=s(19075),ee=s(66834),et=s(55651);function es(e){let{onChange:t,value:s,absolute:r=!0,style:a}=e,[o,l]=(0,i.useState)(G()(s));function c(e){l(G()(e))}return(0,i.useEffect)(()=>{l(G()(s))},[s]),(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("div",{className:"color-picker",style:{position:r?"absolute":"unset",...a},children:[(0,n.jsx)(et.gW,{onChange:c,color:o.hex()}),(0,n.jsxs)("div",{className:"color-picker-row",children:[(0,n.jsxs)("div",{className:"color-picker-input",style:{backgroundColor:o.toString(),color:o.isDark()?L.kx.text.light:L.kx.text.dark},children:[(0,n.jsx)("div",{style:{fontFamily:"Arial"},children:"#"}),(0,n.jsx)(et.ZE,{onChange:c,color:o.hex(),style:{color:o.isDark()?L.kx.text.light:L.kx.text.dark}})]}),(0,n.jsx)("button",{className:"color-picker-check",onClick:()=>{l(G()(s)),null==t||t(s)},style:{backgroundColor:o.toString(),color:o.isDark()?L.kx.text.light:L.kx.text.dark},children:(0,n.jsx)(k.aHS,{size:16})}),(0,n.jsx)("button",{className:"color-picker-check",onClick:function(){null==t||t(o.toString())},style:{backgroundColor:o.toString(),color:o.isDark()?L.kx.text.light:L.kx.text.dark},children:(0,n.jsx)(k.l_A,{size:16})})]})]})})}class en{addEventListener(e,t){this.listeners.has(e)||this.listeners.set(e,[]),this.listeners.get(e).push(t)}removeEventListener(e,t){let s=this.listeners.get(e);if(!s)return;let n=s.findIndex(e=>e.id===t.id||e.callback===t.callback);-1!==n&&s.splice(n,1)}emitEvent(e,t){var s,n;[...null!==(s=this.listeners.get(e))&&void 0!==s?s:[],...null!==(n=this.listeners.get("ALL"))&&void 0!==n?n:[]].forEach(s=>s.callback(e,t))}constructor(){this.listeners=new Map}}let ei=new en;function er(e){let{track:t,onSave:s,onDelete:a,onChange:o}=e,{t:l}=(0,M.$G)(["vsrg_composer","common","instrument_settings","instruments"]),[c,h]=(0,i.useState)(!1);return t?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"vsrg-floating-settings box-shadow",children:[(0,n.jsxs)(C.X,{justify:"between",align:"center",children:[l("track_name"),(0,n.jsx)("input",{type:"text",maxLength:50,className:"input",style:{width:"7.4rem"},value:t.instrument.alias,onChange:e=>{t.instrument.set({alias:e.target.value}),o(t)},placeholder:l("instruments:".concat(t.instrument.name))})]}),(0,n.jsxs)(C.X,{justify:"between",align:"center",style:{marginTop:"0.4rem"},children:[l("common:instrument"),(0,n.jsx)(Q.O,{style:{width:"8rem"},selected:t.instrument.name,onChange:e=>{t.instrument.set({name:e}),o(t)}})]}),(0,n.jsxs)(C.X,{justify:"between",align:"center",style:{marginTop:"0.4rem"},children:[l("common:pitch"),(0,n.jsx)(ee.x,{style:{width:"8rem"},selected:t.instrument.pitch,onChange:e=>{t.instrument.set({pitch:e}),o(t)},children:(0,n.jsx)("option",{value:"",children:l("instrument_settings:use_song_pitch")})})]}),(0,n.jsxs)(C.X,{align:"center",style:{marginTop:"1rem"},children:[l("instrument_settings:volume"),(0,n.jsxs)("span",{style:{marginLeft:"0.4rem",width:"3rem",...t.instrument.volume>100&&{color:"hsl(0, ".concat(-40+t.instrument.volume,"%, 61%)"),marginLeft:"0.4rem"}},children:[t.instrument.volume,"%"]}),(0,n.jsx)(m.k,{buttonStyle:{width:"1.2rem",height:"1.2rem"},width:10,children:l("instrument_settings:volume_high_warning")})]}),(0,n.jsx)(C.X,{align:"center",children:(0,n.jsx)("input",{type:"range",style:{flex:"1"},min:0,max:125,value:t.instrument.volume,onChange:e=>{t.instrument.set({volume:parseInt(e.target.value)}),o(t)}})}),(0,n.jsx)(O.s,{children:(0,n.jsxs)(C.X,{justify:"between",align:"center",children:[l("common:color"),(0,n.jsx)(r.J,{onClick:()=>h(!0),ariaLabel:"Change color",style:{backgroundColor:t.color,color:G()(t.color).isDark()?"#fff":"#000"},children:l("common:change")})]})}),(0,n.jsxs)(C.X,{justify:"between",style:{marginTop:"0.4rem"},children:[(0,n.jsxs)(r.J,{className:"row-centered",style:{padding:"0.4rem",width:"fit-content"},onClick:a,children:[(0,n.jsx)(k.Xm5,{color:"var(--red)",style:{marginRight:"0.3rem"}}),l("common:delete")]}),(0,n.jsx)(r.J,{onClick:s,style:{padding:"0.4rem",width:"fit-content"},children:l("common:ok")})]})]}),c&&(0,n.jsx)(es,{style:{right:"0.8rem",top:"0.5rem"},value:t.color,onChange:e=>{o(t.set({color:e})),h(!1),ei.emitEvent("colorChange")}})]}):null}function ea(e){let{vsrg:t,selectedTrack:s,children:a,onTrackAdd:o,onTrackChange:l,onTrackSelect:c,onTrackDelete:h,onNoteSelect:u,onBreakpointChange:d,onBreakpointSelect:m,lastCreatedHitObject:p,selectedHitObject:f}=e,{t:v}=(0,M.$G)(["vsrg_composer","common"]),[x]=(0,b.F)(),[y,j]=(0,i.useState)([]),[w,S]=(0,i.useState)(!1),T=t.tracks[s];return(0,i.useEffect)(()=>{j(Array("Sky"===L.iC?15:21).fill(0).map((e,t)=>t))},[]),(0,n.jsxs)(n.Fragment,{children:[a,(0,n.jsxs)("div",{className:"vsrg-top-right ".concat(null!==p?"vsrg-top-right-disabled":""),children:[w&&(0,n.jsx)(er,{track:T,onSave:()=>S(!1),onDelete:()=>h(s),onChange:e=>l(e,s)}),(0,n.jsxs)(C.X,{align:"center",className:"vsrg-breakpoints-buttons",style:{marginBottom:"0.4rem"},children:[(0,n.jsx)(r.J,{style:{marginLeft:0},onClick:()=>m(-1),children:(0,n.jsx)(g.c,{icon:k.qSR})}),(0,n.jsx)(r.J,{onClick:()=>d(!0),children:(0,n.jsx)(g.c,{icon:k.iFH})}),(0,n.jsx)(r.J,{onClick:()=>d(!1),children:(0,n.jsx)(g.c,{icon:k.wEH})}),(0,n.jsx)(r.J,{onClick:()=>m(1),children:(0,n.jsx)(g.c,{icon:k.Nqc})})]}),(0,n.jsxs)("div",{className:"vsrg-track-wrapper column",children:[t.tracks.map((e,t)=>(0,n.jsx)(eo,{track:e,selected:t===s,theme:x,onSettingsClick:()=>S(!w),onTrackClick:()=>c(t)},t)),(0,n.jsx)("div",{style:{width:"100%",height:"1.4rem"}}),(0,n.jsx)(r.J,{onClick:e=>{setTimeout(()=>{var t;o(),null===(t=e.target)||void 0===t||t.scrollIntoView()},50)},ariaLabel:v("common:add_new_instrument"),className:"flex-centered",style:{marginTop:"auto",padding:"0.3rem"},children:(0,n.jsx)(k.wEH,{size:16,color:"var(--icon-color)"})})]}),(0,n.jsx)(Y,{elements:y,selected:null==f?void 0:f.notes,perRow:"Sky"===L.iC?5:7,onClick:u})]})]})}function eo(e){let{track:t,selected:s,theme:a,onSettingsClick:o,onTrackClick:l}=e,{t:c}=(0,M.$G)(["instruments"]),[h,u]=(0,i.useState)({background:"var(--primary)",text:"var(--primary-text)"}),[d,m]=(0,i.useState)({background:"var(--primary)",text:"var(--primary-text)"});return(0,i.useEffect)(()=>{let e=a.get("primary").mix(new(G())(t.color),.3);u({background:e.toString(),text:e.isDark()?"var(--text-light)":"var(--text-dark)"});let s=new(G())(t.color);m({background:s.toString(),text:s.isDark()?"rgb(220 219 216)":"rgb(55 55 55)"})},[a,t.color]),(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("div",{className:"vsrg-track row-centered",style:{backgroundColor:s?h.background:"var(--primary)",color:s?h.text:"var(--primary-text)"},onClick:l,children:[(0,n.jsx)("span",{className:"text-ellipsis",style:{color:s?h.text:"var(--text-color)",paddingLeft:"0.6rem",paddingRight:"0.2rem",flex:1},children:t.instrument.alias||c("instruments:".concat(t.instrument.name))}),(0,n.jsx)(r.J,{onClick:()=>s&&o(),style:{backgroundColor:d.background},className:"vsrg-track-left flex-centered",children:s&&(0,n.jsx)(k.p4t,{color:d.text})})]})})}var el=s(28682),ec=s(78810),eh=s(63805),eu=s.n(eh),ed=s(40419),em=s(54233),eg=s(57564),ep=s(43531),ef=s(39324);eg.Xd.LINE_SCALE_MODE=eg.F4.NORMAL;class ev{generate(){let{app:e}=this;e&&(this.isMobile=eu()(),this.generateSnapPoints(e),this.generateTrackCache(e),this.generateTrails(e),this.generateSelectionRings(e),this.generateOthers(e))}getHitObjectCache(e){return this.textures.hitObjects[e]||this.textures.hitObjects["#FF0000"]}getHeldTrailCache(e){return this.textures.trails[e]||this.textures.trails["#FF0000"]}getHeldHitObjectCache(e){return this.textures.heldHitObjects[e]||this.textures.heldHitObjects["#FF0000"]}getSelectionRingsCache(e){return this.textures.selectionRings[e]||this.textures.selectionRings["#FF0000"]}generateOthers(e){let{sizes:t,colors:s,isHorizontal:n}=this,i=new eg.K3;i.beginFill(this.colors.background_plain[1]).drawRect(0,0,this.sizes.width,this.sizes.timelineSize).lineStyle(3,this.colors.secondary[1],1).moveTo(0,t.timelineSize).lineTo(this.sizes.width,t.timelineSize);let r=e.renderer.generateTexture(i,{resolution:1,scaleMode:ep.aH$.LINEAR,region:new ep.AeJ(0,0,this.sizes.width,this.sizes.timelineSize)});this.textures.timeline.square=r;let a=n?t.height/16:t.width/16,o=(0,ef.uZ)(t.timelineSize/4,8,100),l=new eg.K3;l.beginFill(s.accent[1]).moveTo(0,0).lineTo(o,0).lineTo(o/2,o).lineTo(0,0).moveTo(0,0).lineTo(o,0).lineTo(o/2,-o).lineTo(0,0).endFill().lineStyle(3,s.accent[1],1).moveTo(o/2,0).lineTo(o/2,t.timelineSize).lineStyle(0).beginFill(s.accent[1]).moveTo(0,t.timelineSize).lineTo(o,t.timelineSize).lineTo(o/2,t.timelineSize).lineTo(0,t.timelineSize).moveTo(0,t.timelineSize).lineTo(o,t.timelineSize).lineTo(o/2,t.timelineSize-o).lineTo(0,t.timelineSize);let c=t.timelineSize/2,h=new eg.K3;h.lineStyle(this.isMobile?2:3,s.secondary[1],1).drawCircle(t.timelineSize/2+1,t.timelineSize/2,c/2);let u=e.renderer.generateTexture(h,{resolution:1,scaleMode:ep.aH$.LINEAR,region:new ep.AeJ(0,0,t.timelineSize,t.timelineSize)});this.textures.timeline.note=u;let d=new eg.K3;d.lineStyle(12,s.accent[1],1).moveTo(0,0).lineTo(0,t.timelineSize);let m=e.renderer.generateTexture(d,{resolution:1,scaleMode:ep.aH$.LINEAR,region:new ep.AeJ(0,0,12,t.timelineSize)});this.textures.timeline.currentTime=m;let g=e.renderer.generateTexture(l,{resolution:2,scaleMode:ep.aH$.LINEAR,region:new ep.AeJ(0,0,o,t.timelineSize)});this.textures.timeline.thumb=g;let p=new eg.K3;p.beginFill(s.accent[1]).moveTo(0,0).lineTo(o,0).lineTo(o/2,o).lineTo(0,0).moveTo(0,0).lineTo(o,0).lineTo(o/2,-o).lineTo(0,0);let f=e.renderer.generateTexture(p,{resolution:1,scaleMode:ep.aH$.LINEAR,region:new ep.AeJ(0,0,o,o)});this.textures.timeline.breakpoint=f;let v=new eg.K3;if(v.beginFill(s.background_10[1]),n){v.drawRoundedRect(a/2,a/2,t.width/2-a,t.height/2-a,16);let s=e.renderer.generateTexture(v,{resolution:1,scaleMode:ep.aH$.LINEAR,region:new ep.AeJ(0,0,t.width/2,t.height/2)});this.textures.buttons.width=t.width/2,this.textures.buttons.height=t.height/2,this.textures.buttons.time=s}else{v.drawRoundedRect(a/2,a/2,t.width/2-a,t.height/3-a,8);let s=e.renderer.generateTexture(v,{resolution:1,scaleMode:ep.aH$.LINEAR,region:new ep.AeJ(0,0,t.width/2,t.height/3)});this.textures.buttons.width=t.width/2,this.textures.buttons.height=t.height/3,this.textures.buttons.time=s}i.destroy(!0),l.destroy(!0),h.destroy(!0),d.destroy(!0),p.destroy(!0),v.destroy(!0)}generateTrails(e){let{sizes:t,trackColors:s}=this,n=[...s,"#FF0000"],i=(0,ef.uZ)(t.keyHeight/2*t.scaling,t.keyHeight/(this.isMobile?3:4),100),r=i/2;n.forEach(t=>{let s=new eg.K3;this.isHorizontal?s.beginFill(G()(t).rgbNumber()).drawRect(0,r/2,i,i-r):s.beginFill(G()(t).rgbNumber()).drawRect(r/2,0,i-r,i);let n=e.renderer.generateTexture(s,{resolution:1,scaleMode:ep.aH$.LINEAR,region:new ep.AeJ(0,0,i,i)});this.textures.trails[t]=n}),this.textures.sizes.trail=i}generateSelectionRings(e){let{sizes:t,trackColors:s}=this,n=[...s,"#FF0000"],i=(0,ef.uZ)(t.keyHeight/1.5*t.scaling,t.keyHeight/(this.isMobile?1.2:2),150);n.forEach(t=>{let s=new eg.K3;s.lineStyle(3,G()(t).rgbNumber()).drawCircle(i/2,i/2,i/2-3);let n=e.renderer.generateTexture(s,{resolution:1,scaleMode:ep.aH$.LINEAR,region:new ep.AeJ(0,0,i,i)});this.textures.selectionRings[t]=n,s.destroy(!0)})}generateTrackCache(e){let{colors:t,sizes:s,trackColors:n}=this,i=(0,ef.uZ)(s.keyHeight/1.8*s.scaling,s.keyHeight/(this.isMobile?2:3.5),100);[...n,"#FF0000"].forEach(s=>{let n=new eg.K3,r=i/2;n.lineStyle(5,G()(s).rgbNumber()).beginFill(t.background_10[1]).drawCircle(r,r,r-5);let a=e.renderer.generateTexture(n,{resolution:2,scaleMode:ep.aH$.LINEAR,region:new ep.AeJ(0,0,i,i)});this.textures.hitObjects[s]=a,n.destroy(!0);let o=new eg.K3,l=.7*i,c=(i-l)/2;o.width=l,o.height=l,o.lineStyle(5,G()(s).rgbNumber()).beginFill(t.background_10[1]).drawRoundedRect(c,c,l,l,6);let h=e.renderer.generateTexture(o,{resolution:2,scaleMode:ep.aH$.LINEAR,region:new ep.AeJ(0,0,i,i)});this.textures.heldHitObjects[s]=h,o.destroy(!0)}),this.textures.sizes.hitObject=i}generateSnapPoints(e){let{colors:t,sizes:s,isHorizontal:n,playbarOffset:i}=this,r=new eg.K3,a=new eg.K3,o=new eg.K3;if(n){r.lineStyle(2,t.lineColor[1]).moveTo(0,0).lineTo(0,s.height);let n=e.renderer.generateTexture(r,{resolution:1,scaleMode:ep.aH$.LINEAR,region:new ep.AeJ(0,0,s.snapPointWidth,s.height)});a.lineStyle(4,t.secondary[1]).moveTo(0,0).lineTo(0,s.height);let l=e.renderer.generateTexture(a,{resolution:1,scaleMode:ep.aH$.LINEAR,region:new ep.AeJ(0,0,s.snapPointWidth,s.height)}),c=s.height/10;o.lineStyle(2,t.secondary[1]);for(let e=0;e<12;e++){let t=c*e-c;o.moveTo(i,t),o.lineTo(0,t+c)}let h=e.renderer.generateTexture(o,{resolution:1,scaleMode:ep.aH$.LINEAR,region:new ep.AeJ(0,0,i,s.height)});this.textures.snapPoints.size=s.snapPointWidth,this.textures.snapPoints.small=n,this.textures.snapPoints.large=l,this.textures.snapPoints.empty=h}else{r.lineStyle(2,t.lineColor[1]).moveTo(0,s.snapPointWidth).lineTo(s.width,s.snapPointWidth);let n=e.renderer.generateTexture(r,{resolution:1,scaleMode:ep.aH$.LINEAR,region:new ep.AeJ(0,0,s.width,s.snapPointWidth)});a.lineStyle(4,t.secondary[1]).moveTo(0,s.snapPointWidth).lineTo(s.width,s.snapPointWidth);let l=e.renderer.generateTexture(a,{resolution:1,scaleMode:ep.aH$.LINEAR,region:new ep.AeJ(0,0,s.width,s.snapPointWidth)}),c=s.width/20;o.lineStyle(2,t.secondary[1]);for(let e=0;e<22;e++){let t=c*e-c;o.moveTo(t,i),o.lineTo(t+c,0)}let h=e.renderer.generateTexture(o,{resolution:1,scaleMode:ep.aH$.LINEAR,region:new ep.AeJ(0,0,s.width,i)});this.textures.snapPoints.size=s.snapPointWidth,this.textures.snapPoints.large=l,this.textures.snapPoints.empty=h,this.textures.snapPoints.small=n}r.destroy(!0),a.destroy(!0),o.destroy(!0)}constructor({app:e,colors:t,sizes:s,trackColors:n,isHorizontal:i,playbarOffset:r}){this.isMobile=!1,this.destroy=()=>{var e,t,s,n;null===(e=this.textures.snapPoints.small)||void 0===e||e.destroy(!0),null===(t=this.textures.snapPoints.large)||void 0===t||t.destroy(!0),null===(s=this.textures.snapPoints.empty)||void 0===s||s.destroy(!0),Object.values(this.textures.hitObjects).forEach(e=>null==e?void 0:e.destroy(!0)),Object.values(this.textures.heldHitObjects).forEach(e=>null==e?void 0:e.destroy(!0)),Object.values(this.textures.trails).forEach(e=>null==e?void 0:e.destroy(!0)),Object.values(this.textures.selectionRings).forEach(e=>null==e?void 0:e.destroy(!0)),Object.values(this.textures.timeline).forEach(e=>null==e?void 0:e.destroy(!0)),null===(n=this.textures.buttons.time)||void 0===n||n.destroy(!0),this.app=null},this.textures={hitObjects:{},heldHitObjects:{},selectionRings:{},trails:{},buttons:{width:0,height:0,time:null},snapPoints:{size:0,small:null,large:null,empty:null},timeline:{breakpoint:null,currentTime:null,note:null,square:null,thumb:null},sizes:{hitObject:0,trail:0}},this.trackColors=n,this.colors=t,this.isHorizontal=i,this.playbarOffset=r,this.sizes=s,this.app=e,this.generate()}}var ex=s(37347),eb=s.n(ex);function ey(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],{testString:t,timeout:s}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{showErrors:n}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{showErrors:!1},[r,a]=(0,i.useState)(!1),o=JSON.stringify(e);return(0,i.useEffect)(()=>{Promise.all(JSON.parse(o).map(e=>{let{family:n,weight:i,style:r,stretch:a}=e;return new(eb())(n,{weight:i,style:r,stretch:a}).load(t,s)})).then(()=>a(!0)).catch(()=>{n&&console.error("An error occurred during font loading")})},[o,t,s,n]),r}let ej=new ep.pn8({fontFamily:'"Source Sans Pro", Helvetica, sans-serif',fontSize:30,fill:"#ffffff"}),ek=[{family:"Bonobo"}],ew=(0,i.memo)(function(e){let{keys:t,sizes:s,colors:r,isHorizontal:a,onKeyDown:o,onKeyUp:l}=e,{PLAY_BAR_OFFSET:c}=(0,N.Z)(),[h,u]=(0,i.useState)(ej),d=ey(ek);(0,i.useEffect)(()=>{u(new ep.pn8({fontFamily:d?'"Bonobo"':'"Source Sans Pro", Helvetica, sans-serif',fontSize:d?25:30,fill:r.lineColor[1]}))},[r,s,t,d]);let m=s.height/t.length,g=s.width/t.length;return(0,n.jsxs)(ec.W2,{x:0,y:s.timelineSize,children:[(0,n.jsx)(ec.TC,{draw:e=>{if(e.clear(),e.beginFill(r.background_plain[1]),a){e.drawRect(0,0,60,s.height),e.lineStyle(2,r.lineColor_10[1]);for(let n=0;n<t.length-1;n++)e.moveTo(0,m*(n+1)),e.lineTo(s.width,m*(n+1));e.lineStyle(2,r.secondary[1]),e.moveTo(59,0),e.lineTo(59,s.height)}else{e.drawRect(0,s.height-60,s.width,60),e.lineStyle(2,r.lineColor_10[1]);for(let n=0;n<t.length-1;n++)e.moveTo(g*(n+1),0),e.lineTo(g*(n+1),s.height);e.lineStyle(2,r.secondary[1]),e.moveTo(0,s.height-60),e.lineTo(s.width,s.height-60)}}}),(0,n.jsx)(ec.TC,{draw:e=>{if(e.clear(),e.lineStyle(6,r.accent[1]),a){e.moveTo(c+1,0),e.lineTo(c+1,s.height);for(let s=0;s<t.length;s++)e.drawCircle(c+1,m*(s+.5),4)}else{let n=s.height-c-1-s.timelineSize;e.moveTo(0,n),e.lineTo(s.width,n);for(let s=0;s<t.length;s++)e.drawCircle(g*(s+.5)+1,n,4)}}}),t.map((e,t)=>{let i=new ep.AeJ(a?0:g*t,a?m*t:s.height-60,a?60:s.width,a?m:60);return(0,n.jsx)(ec.W2,{hitArea:i,eventMode:"static",pointerdown:()=>o(t),pointerup:()=>l(t),pointerupoutside:()=>l(t),children:(0,n.jsx)(ec.xv,{x:a?30:g*t+g/2,y:a?m*t+m/2:s.height-30,anchor:.5,text:"".concat(t+1),style:h})},e)})]})},(e,t)=>e.keys===t.keys&&e.sizes===t.sizes&&e.colors===t.colors&&e.isHorizontal===t.isHorizontal);function eS(e){let{track:t,sizes:s,keys:r,cache:a,isHorizontal:o,selectedHitObject:l,selectHitObject:c,trackIndex:h,timestamp:u}=e,{PLAY_BAR_OFFSET:d}=(0,N.Z)(),m=s.scaling,g=s.height/r,p=s.width/r,f=u-d/m-a.textures.sizes.hitObject,v=u+(o?s.width:s.height)/m-d+a.textures.sizes.hitObject;return(0,n.jsx)(n.Fragment,{children:t.hitObjects.map(e=>{if(f>e.timestamp+e.holdDuration||e.timestamp>v)return null;let r=o?e.timestamp*m:p*e.index+p/2,u=o?g*e.index+g/2:-(e.timestamp*m-s.height);return e.isHeld?(0,n.jsxs)(ec.W2,{eventMode:"static",pointerdown:t=>{c(e,h,(0,ef.Bq)(t.button))},children:[o?(0,n.jsx)(ec.jy,{texture:a.getHeldTrailCache(t.color),anchor:[0,.5],height:a.textures.sizes.trail,width:e.holdDuration*m,x:r,y:u}):(0,n.jsx)(ec.jy,{texture:a.getHeldTrailCache(t.color),anchor:L.$n,width:a.textures.sizes.trail,height:e.holdDuration*m,x:r,y:u}),(0,n.jsx)(ec.jy,{texture:a.getHeldHitObjectCache(t.color),anchor:.5,x:r,angle:45,y:u}),(0,n.jsx)(ec.jy,{texture:a.getHeldHitObjectCache(t.color),anchor:.5,x:o?(e.timestamp+e.holdDuration)*m:r,y:o?u:u-e.holdDuration*m}),e===l&&(0,n.jsx)(ec.jy,{texture:a.getSelectionRingsCache(t.color),anchor:.5,x:r,y:u})]},e.renderId):(0,n.jsxs)(i.Fragment,{children:[e===l&&(0,n.jsx)(ec.jy,{texture:a.getSelectionRingsCache(t.color),anchor:.5,x:r,y:u}),(0,n.jsx)(ec.jy,{texture:a.getHitObjectCache(t.color),eventMode:"static",pointerdown:t=>{c(e,h,(0,ef.Bq)(t.button))},anchor:.5,x:r,y:u})]},e.renderId)})})}let eC=[{family:"Bonobo"}];function eT(e){let{vsrg:t,sizes:s,snapPoint:r,timestamp:a,snapPoints:o,colors:l,cache:c,onSnapPointSelect:h,preventClick:u,isHorizontal:d,selectedHitObject:m,selectHitObject:g,onAddTime:p,onRemoveTime:f}=e,{t:v,i18n:x}=(0,M.$G)("vsrg_composer"),b=s.scaling,{PLAY_BAR_OFFSET:y}=(0,N.Z)(),j=a-(y+c.textures.snapPoints.size)/b,k=a+((d?s.width:s.height)-y)/b,w=c.textures.snapPoints.size,[S,C]=(0,i.useState)(ej),T=ey(eC);(0,i.useEffect)(()=>{C(new ep.pn8({fontFamily:T?'"Bonobo"':'"Source Sans Pro", Helvetica, sans-serif',fontSize:T?25:30,fill:l.lineColor[1]}))},[T,l.lineColor]);let _=(0,i.useMemo)(()=>({addTime:v("click_to_add_time"),removeTime:v("click_to_remove_time")}),[v,x.language]);function H(e){if(u)return;let t=e.target;if(d){let n=e.globalY-s.timelineSize;h(t.x/b,Math.floor(n/s.keyHeight),(0,ef.Bq)(e.button))}else h(Math.abs(Math.floor(t.y-s.height+w)/b),Math.floor(t.x/s.keyWidth),(0,ef.Bq)(e.button))}return(0,n.jsxs)(ec.W2,{x:d?-a*b+y:0,y:d?s.timelineSize:a*b-y,eventMode:"static",interactiveChildren:!0,children:[o.map((e,t)=>j>e||e>k?null:(0,n.jsx)(ec.jy,{eventMode:"static",pointertap:H,x:d?e*b:0,y:d?0:-(e*b-s.height+w),texture:t%r?c.textures.snapPoints.small:c.textures.snapPoints.large},e)),j<0&&(0,n.jsx)(ec.jy,{x:d?-y:0,y:d?0:s.height,texture:c.textures.snapPoints.empty}),t.tracks.map((e,i)=>(0,n.jsx)(eS,{track:e,cache:c,keys:t.keys,colors:l,sizes:s,timestamp:a,trackIndex:i,selectHitObject:g,selectedHitObject:m,isHorizontal:d},i)),a>=t.duration-(d?s.width:s.height)/b&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(ec.W2,{pointertap:p,eventMode:"static",x:d?t.duration*b:0,anchor:.5,y:d?0:-(t.duration*b-s.height+c.textures.buttons.height),children:[(0,n.jsx)(ec.jy,{texture:c.textures.buttons.time}),(0,n.jsx)(ec.xv,{x:c.textures.buttons.width/2,anchor:.5,y:c.textures.buttons.height/2,text:_.addTime,style:S})]}),(0,n.jsxs)(ec.W2,{pointertap:f,eventMode:"static",x:d?t.duration*b:s.width/2,anchor:.5,y:d?s.height/2:-(t.duration*b-s.height+c.textures.buttons.height),children:[(0,n.jsx)(ec.jy,{texture:c.textures.buttons.time}),(0,n.jsx)(ec.xv,{x:c.textures.buttons.width/2,anchor:.5,y:c.textures.buttons.height/2,text:_.removeTime,style:S})]})]})]})}let e_=(0,i.memo)(function(e){let{cache:t,breakpoints:s,sizes:i,duration:r}=e;return(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(ec.W2,{children:s.map(e=>(0,n.jsx)(ec.jy,{texture:t.textures.timeline.breakpoint,x:e/r*i.width},e))})})},(e,t)=>e.breakpoints===t.breakpoints&&e.cache===t.cache&&e.sizes===t.sizes&&e.duration===t.duration),eH=new ep.AeJ(0,0,0,0);function eN(e){let{sizes:t,timestamp:s,song:r,cache:a,hidden:o,notes:l,onTimelineClick:c}=e,{PLAY_BAR_OFFSET:h}=(0,N.Z)(),[u,d]=(0,i.useState)(eH),[m,g]=(0,i.useState)(!1),p=s-(h+t.timelineSize)/t.scaling,f=s+(t.width-h+t.timelineSize)/t.scaling,v=(0,i.useCallback)(()=>g(!1),[]);(0,i.useEffect)(()=>{d(new ep.AeJ(0,0,t.width,t.timelineSize))},[t]),(0,i.useEffect)(()=>{function e(){g(!1)}return window.addEventListener("blur",e),()=>window.removeEventListener("blur",e)},[]);let x=(0,i.useCallback)((e,s)=>{if(!m&&!0!==s)return;let n=e.globalX/t.width*r.duration;c((0,ef.uZ)(n,0,r.duration))},[t,r.duration,c,m]),b=(0,i.useCallback)(e=>{g(!0),x(e,!0)},[x]);if(o)return null;let y=s/r.duration;return(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)(ec.W2,{x:0,y:0,eventMode:"static",pointermove:x,pointerdown:b,pointerup:v,pointerupoutside:v,hitArea:u,children:[(0,n.jsx)(ec.jy,{x:0,y:0,texture:a.textures.timeline.square}),(0,n.jsx)(ec.W2,{x:-s*t.scaling+h,y:0,children:l.map((e,s)=>e.time<p||e.time>f?null:(0,n.jsx)(ec.jy,{x:e.time*t.scaling,anchor:L.Xu,texture:a.textures.timeline.note},s))}),(0,n.jsx)(e_,{breakpoints:r.breakpoints,cache:a,sizes:t,duration:r.duration}),(0,n.jsx)(ec.jy,{x:h-2,y:0,texture:a.textures.timeline.currentTime}),(0,n.jsx)(ec.jy,{y:0,x:y*t.width,texture:a.textures.timeline.thumb})]})})}var eE=s(47008);class eO extends i.Component{componentDidMount(){var e;this.toDispose.push((0,b.B)(this.handleThemeChange)),window.addEventListener("resize",this.calculateSizes),this.toDispose.push(()=>window.removeEventListener("resize",this.calculateSizes)),ei.addEventListener("ALL",{callback:this.handleEvent,id:"vsrg-canvas-color-change"}),this.toDispose.push(()=>ei.removeEventListener("ALL",{id:"vsrg-canvas-color-change"})),this.calculateSizes(),this.throttledEventLoop.setCallback(this.handleTick),this.throttledEventLoop.changeMaxFps(this.props.maxFps),this.throttledEventLoop.start(),window.addEventListener("blur",this.handleBlur),null===(e=this.state.cache)||void 0===e||e.destroy(),this.toDispose.push(()=>window.removeEventListener("blur",this.handleBlur)),this.handleThemeChange(em.f6)}componentWillUnmount(){var e;this.toDispose.forEach(e=>e()),null===(e=this.state.cache)||void 0===e||e.destroy(),this.throttledEventLoop.stop()}render(){var e;let{canvasColors:t,sizes:s,cache:i,timestamp:r,preventClick:a}=this.state,{vsrg:o,isHorizontal:l,audioSong:c,snapPoint:h,snapPoints:u,selectedHitObject:d}=this.props;return(0,n.jsx)("div",{className:"vsrg-top-canvas-wrapper",ref:this.wrapperRef,children:this.wrapperRef.current&&(0,n.jsxs)(ec.Hf,{onMount:this.calculateSizes,ref:this.stageRef,raf:!1,width:s.rawWidth,height:s.rawHeight,onWheel:this.handleWheel,onPointerDown:this.setIsDragging,onPointerUp:this.setIsNotDragging,onPointerLeave:this.setIsNotDragging,onPointerMove:this.handleDrag,onContextMenu:e=>e.preventDefault(),options:{backgroundColor:t.background_plain[1],autoDensity:!1,resolution:(null===(e=window)||void 0===e?void 0:e.devicePixelRatio)||1},children:[i&&(0,n.jsx)(eT,{vsrg:o,cache:i,selectedHitObject:d,snapPoint:h,snapPoints:u,timestamp:r,preventClick:a,sizes:s,colors:t,isHorizontal:l,onAddTime:this.props.onAddTime,onRemoveTime:this.props.onRemoveTime,selectHitObject:this.selectHitObject,onSnapPointSelect:this.props.onSnapPointSelect}),(0,n.jsx)(ew,{isHorizontal:l,keys:L.CB[o.keys],sizes:s,colors:t,onKeyDown:this.props.onKeyDown,onKeyUp:this.props.onKeyUp}),i&&(0,n.jsx)(eN,{hidden:!1,notes:this.props.renderableNotes,cache:i,timestamp:r,onTimelineClick:this.setTimestamp,isHorizontal:l,song:o,audioSong:c,sizes:s,colors:t})]})})}constructor(e){super(e),this.wrapperRef=(0,i.createRef)(),this.stageRef=(0,i.createRef)(),this.toDispose=[],this.throttledEventLoop=new ed.v(()=>{},48),this.cumulativeScroll=0,this.handleEvent=(e,t)=>{"colorChange"===e&&this.generateCache(),"updateKeys"===e&&this.calculateSizes(),"updateOrientation"===e&&this.calculateSizes(),"snapPointChange"===e&&this.calculateSizes(),"tracksChange"===e&&this.generateCache(),"songLoad"===e&&this.calculateSizes(),"scaleChange"===e&&this.calculateSizes(),"maxFpsChange"===e&&this.throttledEventLoop.changeMaxFps(this.props.maxFps),"timestampChange"===e&&this.setTimestamp(t)},this.handleTick=(e,t)=>{if(this.props.isPlaying){let e=this.state.timestamp+t*this.props.tempoChanger;this.setTimestamp(e)}},this.handleBlur=()=>{this.setState({isPressing:!1})},this.calculateSizes=()=>{let{wrapperRef:e}=this;if(!e.current)return console.warn("no wrapper");let t=e.current.getBoundingClientRect(),{scaling:s}=this.props,n=eu()()?20:40,i=t.height-n,r={el:t,rawWidth:t.width,rawHeight:t.height,width:t.width,height:i,keyHeight:i/L.CB[this.props.vsrg.keys].length,keyWidth:t.width/L.CB[this.props.vsrg.keys].length,snapPointWidth:6e4/this.props.vsrg.bpm/this.props.snapPoint*s/100,scaling:s/100,timelineSize:n},a=e.current.querySelector("canvas");a&&(a.style.width="".concat(r.width,"px"),a.style.height="".concat(r.height+n,"px")),this.setState({sizes:r},this.generateCache)},this.handleWheel=e=>{if(this.props.scrollSnap){if(this.cumulativeScroll+=e.deltaY,100>Math.abs(this.cumulativeScroll))return;let{snapPoints:t}=this.props,s=t.findIndex(e=>e>this.state.timestamp),n=(s<0?t.length:s)-1+(this.cumulativeScroll<0?-1:1);if(this.cumulativeScroll=0,n<0||n>=t.length)return;let i=t[n];return this.setTimestamp(i)}let t=Math.min(Math.max(0,this.state.timestamp+e.deltaY/1.2),this.props.vsrg.duration);this.setState({timestamp:t},()=>{let{draggedHitObject:t,timestamp:s}=this.state;this.props.onTimestampChange(this.state.timestamp),t&&!(s<=0)&&this.props.dragHitObject(t.timestamp+e.deltaY/1.2)})},this.setIsDragging=e=>{let{sizes:t}=this.state;e.clientY-t.el.top>t.timelineSize&&this.setState({isPressing:!0,previousPosition:this.props.isHorizontal?e.clientX:-e.clientY})},this.setIsNotDragging=e=>{if(!this.state.isPressing)return;let t=this.state.draggedHitObject;this.setState({isPressing:!1,totalMovement:0,draggedHitObject:null},()=>{if(t&&this.props.releaseHitObject(),setTimeout(()=>this.setState({preventClick:!1}),200),this.props.scrollSnap){let{snapPoints:e}=this.props,t=e.findIndex(e=>e>this.state.timestamp);if(!t||t<0)return;let s=e[t],n=e[t-1];if(void 0===s||void 0===n)return;let i=(0,ef.uy)(this.state.timestamp,n,s);this.setTimestamp(i)}})},this.handleDrag=e=>{if(!this.state.isPressing)return;let{previousPosition:t,draggedHitObject:s,sizes:n,timestamp:i}=this.state,{isHorizontal:r,vsrg:a}=this.props,o=r?e.clientX:-e.clientY,l=Math.floor((r?e.clientY-n.el.top-n.timelineSize:e.clientX-n.el.left)/(r?n.keyHeight:n.keyWidth)),c=(t-o)/n.scaling,h=this.state.totalMovement+Math.abs(c);if(null!==s){let e=s.timestamp-c;return this.setState({previousPosition:o},()=>this.props.dragHitObject(Math.max(0,e),l))}let u=Math.min(Math.max(0,i+c),a.duration);this.setState({previousPosition:o,preventClick:h>50,totalMovement:h,timestamp:u},()=>this.props.onTimestampChange(this.state.timestamp))},this.generateCache=()=>{let{sizes:e,canvasColors:t,cache:s}=this.state,n=this.props.vsrg.tracks.map(e=>e.color);if(!this.stageRef.current)return;this.stageRef.current.app.renderer.background.color=t.background[0];let i=new ev({app:this.stageRef.current.app,sizes:e,colors:t,trackColors:n,isHorizontal:this.props.isHorizontal,playbarOffset:eE.X.get().PLAY_BAR_OFFSET}),r=this.state.cache;this.setState({cache:i},()=>{setTimeout(()=>{null==r||r.destroy()},500)})},this.selectHitObject=(e,t,s)=>{2!==s&&this.setState({draggedHitObject:e}),this.props.selectHitObject(e,t,s)},this.setTimestamp=e=>{this.setState({timestamp:e}),this.props.onTimestampChange(e)},this.handleThemeChange=e=>{let t=e.get("primary"),s=e.getText("primary"),n=s.darken(.5).desaturate(1),i=t.darken(.15),r=i.darken(.1),a=e.get("secondary"),o=e.get("accent");this.setState({canvasColors:{background_plain:[t.hex(),t.rgbNumber()],background:[i.hex(),i.rgbNumber()],background_10:[r.hex(),r.rgbNumber()],secondary:[a.hex(),a.rgbNumber()],lineColor:[s.hex(),s.rgbNumber()],lineColor_10:[n.hex(),n.rgbNumber()],accent:[o.hex(),o.rgbNumber()]}},this.generateCache)},this.state={canvasColors:{background_plain:["#000000",0],background:["#000000",0],background_10:["#000000",0],secondary:["#ffffff",16777215],lineColor:["#ffffff",16777215],lineColor_10:["#ffffff",16777215],accent:["#ffffff",16777215]},timestamp:0,sizes:{el:{...L.n},rawWidth:0,rawHeight:0,width:0,height:0,snapPointWidth:0,keyHeight:0,keyWidth:0,timelineSize:0,scaling:0},draggedHitObject:null,isPressing:!1,totalMovement:0,previousPosition:0,preventClick:!1,cache:null},this.wrapperRef=(0,i.createRef)(),this.stageRef=(0,i.createRef)()}}var eP=s(80219),ez=s(74646),eM=s(21249),eR=s(23935),eI=s(12120),eA=s(78581),eF=s(23441),eL=s(47103),eD=s(11163),eB=s(19116),eW=s(51797);class eJ extends i.Component{componentDidMount(){let e=eP.j.getVsrgComposerSettings();this.setState({settings:e}),this.state.audioPlayer.setBasePitch(e.pitch.value),this.state.audioPlaybackPlayer.setBasePitch(e.pitch.value),this.mounted=!0;let t="vsrg-composer";this.calculateSnapPoints(),this.syncInstruments(),this.unblock=e=>{if(0!==this.changes)throw this.changePage(e),this.props.router.events.emit("routeChangeError"),"routeChange aborted.";this.props.router.events.off("routeChangeStart",this.unblock),this.props.router.push((0,ef.k8)(e))},this.props.router.events.on("routeChangeStart",this.unblock);let s=(0,_.JZ)("vsrg_composer","vsrg_composer",this.handleShortcut);this.cleanup.push(s),eM.w.listen(this.handleKeyboardDown,{id:t,type:"keydown"}),eM.w.listen(this.handleKeyboardUp,{id:t,type:"keyup"})}componentWillUnmount(){this.mounted=!1,eM.w.unregisterById("vsrg-composer"),this.props.router.events.off("routeChangeStart",this.unblock);let{audioPlaybackPlayer:e,audioPlayer:t}=this.state;e.destroy(),t.destroy(),this.cleanup.forEach(e=>e())}render(){var e;let{settings:t,selectedTrack:s,vsrg:i,lastCreatedHitObject:r,snapPoints:a,isPlaying:o,snapPoint:l,selectedHitObject:c,selectedType:h,audioSong:u,scaling:d,renderableNotes:m,tempoChanger:g}=this.state;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(eF.d,{text:"".concat(this.props.t("home:vsrg_composer_name")," - ").concat(null!==(e=i.name)&&void 0!==e?e:"Unnamed"),description:"Create new VSRG songs using existing background songs and create your own beatmap for it."}),(0,n.jsx)(W,{trackModifiers:i.trackModifiers,hasChanges:this.changes>0,settings:t,audioSong:u,onTrackModifierChange:this.onTrackModifierChange,onSongOpen:this.onSongOpen,onSave:this.saveSong,onCreateSong:this.createNewSong,setAudioSong:this.setAudioSong,handleSettingChange:this.handleSettingChange}),(0,n.jsxs)("div",{className:"vsrg-page appear-on-mount",children:[(0,n.jsx)(ea,{vsrg:i,onBreakpointSelect:this.onBreakpointSelect,onBreakpointChange:this.onBreakpointChange,selectedHitObject:c,isHorizontal:!t.isVertical.value,selectedTrack:s,lastCreatedHitObject:r,onTrackAdd:this.addTrack,onTrackChange:this.onTrackChange,onTrackDelete:this.deleteTrack,onTrackSelect:this.selectTrack,onNoteSelect:this.onNoteSelect,children:(0,n.jsx)(eW.P,{className:"decorated-vsrg-canvas",size:"1.2rem",children:(0,n.jsx)(eO,{vsrg:i,renderableNotes:m,onTimestampChange:this.onTimestampChange,selectedHitObject:c,isHorizontal:!t.isVertical.value,tempoChanger:g,scrollSnap:t.scrollSnap.value,maxFps:t.maxFps.value,scaling:d,audioSong:u,snapPoint:l,snapPoints:a,isPlaying:o,onRemoveTime:this.removeTime,onAddTime:this.addTime,onKeyDown:this.startHitObjectTap,onKeyUp:this.endHitObjectTap,dragHitObject:this.dragHitObject,releaseHitObject:this.releaseHitObject,selectHitObject:this.selectHitObject,onSnapPointSelect:this.onSnapPointSelect})})}),(0,n.jsx)(V,{vsrg:i,scaling:d,tempoChanger:g,onTempoChangerChange:this.onTempoChangerChange,onScalingChange:this.onScalingChange,isPlaying:o,togglePlay:this.togglePlay,selectedSnapPoint:l,onSnapPointChange:this.onSnapPointChange,selectedHitObjectType:h,onHitObjectTypeChange:this.selectType})]})]})}constructor(e){super(e),this.lastTimestamp=0,this.changes=0,this.playbackTimestamp=0,this.mounted=!1,this.heldKeys=[],this.pressedDownHitObjects=[],this.unblock=()=>{},this.cleanup=[],this.addTrack=()=>{let{vsrg:e}=this.state;e.addTrack(),this.setState({vsrg:e},()=>ei.emitEvent("tracksChange"))},this.handleShortcut=e=>{let{shortcut:t,event:s}=e,{name:n}=t;if("Space"===s.code){if(s.repeat&&"toggle_play"===n)return;if((0,ef.EB)(document.activeElement)){var i;null===(i=document.activeElement)||void 0===i||i.blur()}}let{vsrg:r,selectedTrack:a,selectedHitObject:o,snapPointDuration:l,settings:c}=this.state;if("set_tap_hand"===n&&this.setState({selectedType:"tap"}),"set_hold_hand"===n&&this.setState({selectedType:"hold"}),"set_delete_hand"===n&&this.setState({selectedType:"delete"}),"deselect"===n&&this.setState({selectedHitObject:null,lastCreatedHitObject:null}),"toggle_play"===n&&this.togglePlay(),"next_breakpoint"===n&&this.onBreakpointSelect(1),"previous_breakpoint"===n&&this.onBreakpointSelect(-1),"next_track"===n&&this.selectTrack(Math.min(this.state.vsrg.tracks.length-1,this.state.selectedTrack+1)),"previous_track"===n&&this.selectTrack(Math.max(0,this.state.selectedTrack-1)),"delete"===n){if(!o)return;r.removeHitObjectInTrackAtTimestamp(a,o.timestamp,o.index),this.setState({selectedHitObject:null,lastCreatedHitObject:null})}if("move_right"===n){if(!o)return;c.isVertical.value?o.index=(0,ef.uZ)(o.index+1,0,r.keys):o.timestamp=o.timestamp+l,this.releaseHitObject()}if("move_down"===n){if(!o)return;c.isVertical.value?o.timestamp=o.timestamp-l:o.index=(0,ef.uZ)(o.index+1,0,r.keys),this.releaseHitObject()}if("move_left"===n){if(!o)return;c.isVertical.value?o.index=(0,ef.uZ)(o.index-1,0,r.keys):o.timestamp=o.timestamp-l,this.releaseHitObject()}if("move_up"===n){if(!o)return;c.isVertical.value?o.timestamp=o.timestamp+l:o.index=(0,ef.uZ)(o.index-1,0,r.keys),this.releaseHitObject()}},this.updateSettings=e=>{eP.j.updateVsrgComposerSettings(void 0!==e?e:this.state.settings)},this.syncInstruments=()=>{let{vsrg:e,audioPlayer:t}=this.state;t.syncInstruments(e.tracks.map(e=>e.instrument))},this.syncAudioSongInstruments=()=>{let{audioSong:e,audioPlaybackPlayer:t}=this.state;null!==e&&(t.syncInstruments(e.instruments),t.basePitch=e.pitch)},this.handleKeyboardDown=e=>{var t;let{event:s,letter:n,shift:i}=e,{vsrg:r}=this.state;if(i)return;let a=null===(t=L.CB[r.keys])||void 0===t?void 0:t.indexOf(n);if(a>=0){if(s.repeat)return;this.startHitObjectTap(a)}},this.handleKeyboardUp=e=>{var t;let{letter:s}=e,{vsrg:n}=this.state,i=null===(t=L.CB[n.keys])||void 0===t?void 0:t.indexOf(s);i>=0&&this.endHitObjectTap(i)},this.startHitObjectTap=e=>{let{vsrg:t,selectedTrack:s,selectedType:n}=this.state;this.heldKeys[e]=!0,this.changes++;let i=this.findClosestSnapPoint(this.lastTimestamp);if("delete"===n)return t.removeHitObjectInTrackAtTimestamp(s,i,e),this.setState({vsrg:t,selectedHitObject:null});let r=t.createHitObjectInTrack(s,i,e);this.pressedDownHitObjects[e]=r,this.setState({vsrg:t,selectedHitObject:r})},this.endHitObjectTap=e=>{let{vsrg:t,selectedTrack:s}=this.state,n=this.pressedDownHitObjects[e];if(this.heldKeys[e]&&n){let e=this.findClosestSnapPoint(n.timestamp+n.holdDuration);t.setHeldHitObjectTail(s,n,e-n.timestamp)}this.heldKeys[e]=!1,this.pressedDownHitObjects[e]=void 0},this.handleSettingChange=e=>{let{settings:t,vsrg:s}=this.state,{data:n}=e;t[e.key]={...t[e.key],value:n.value},"keys"===e.key&&s.changeKeys(n.value),"bpm"===e.key&&(s.set({bpm:n.value}),this.calculateSnapPoints()),"difficulty"===e.key&&s.set({difficulty:n.value}),this.setState({settings:{...t}},()=>{this.updateSettings(),"keys"===e.key&&ei.emitEvent("updateKeys"),"isVertical"===e.key&&ei.emitEvent("updateOrientation"),"maxFps"===e.key&&ei.emitEvent("maxFpsChange")})},this.changePage=async e=>{let{vsrg:t,settings:s}=this.state;if("Home"===e)return w.I.open();if(0!==this.changes){if(s.autosave.value)await this.saveSong();else{let e=await (0,u.jH)(this.props.t("question:unsaved_song_save",{song_name:t.name}),!0);if(null===e||e&&await this.saveSong()===null)return}}this.props.router.events.off("routeChangeStart",this.unblock),this.props.router.push((0,ef.k8)(e))},this.onSnapPointChange=e=>{let{vsrg:t}=this.state;t.set({snapPoint:e}),this.setState({snapPoint:e,vsrg:t},()=>{this.calculateSnapPoints(),ei.emitEvent("snapPointChange")})},this.selectHitObject=(e,t,s)=>{let n=e.isHeld?"hold":"tap";if("delete"===this.state.selectedType||s===eA.u.Right){this.state.vsrg.removeHitObjectInTrack(t,e),this.setState({selectedHitObject:null,vsrg:this.state.vsrg});return}"hold"===this.state.selectedType&&s===eA.u.Left&&this.setState({selectedHitObject:e,lastCreatedHitObject:e,selectedType:n}),this.setState({selectedHitObject:e,selectedTrack:t,selectedType:n})},this.onSnapPointSelect=(e,t,s)=>{let{vsrg:n,selectedType:i,lastCreatedHitObject:r,selectedTrack:a,selectedHitObject:o}=this.state;if(this.changes++,e<0)return console.warn("Timestamp is less than 0");let l=n.getHitObjectsAt(e,t).find(e=>null!==e);if(s===eA.u.Unknown&&console.warn("unknown click type"),"tap"===i&&s===eA.u.Left){if(l)return this.setState({selectedHitObject:l});let s=n.createHitObjectInTrack(a,e,t);this.playHitObject(s,a),this.setState({selectedHitObject:s})}if("hold"===i&&s===eA.u.Left){if(null!==r)n.setHeldHitObjectTail(a,r,e-r.timestamp),this.setState({lastCreatedHitObject:null,selectedHitObject:null});else{if(l)return this.setState({selectedHitObject:l});let s=n.createHeldHitObject(a,e,t);this.setState({lastCreatedHitObject:s,selectedHitObject:s})}}("delete"===i||s===eA.u.Right)&&(n.removeHitObjectInTrackAtTimestamp(a,e,t),this.setState({selectedHitObject:null})),this.setState({vsrg:n})},this.selectTrack=e=>{this.setState({selectedTrack:e})},this.setAudioSong=e=>{let{vsrg:t}=this.state;if(this.changes++,null===e)return t.setAudioSong(null),this.setState({audioSong:null,renderableNotes:[]});let s=j.v.parseSong(e);if(s instanceof eR.M){t.setAudioSong(s),s.startPlayback(this.lastTimestamp),t.setDurationFromNotes(s.notes);let e=t.getRenderableNotes(s);this.setState({audioSong:s,renderableNotes:e},()=>{this.syncAudioSongInstruments(),this.calculateSnapPoints()})}if(s instanceof eI.l){let e=s.toRecordedSong(0);t.setDurationFromNotes(e.notes),e.startPlayback(this.lastTimestamp),t.setAudioSong(s);let n=t.getRenderableNotes(e);this.setState({audioSong:e,renderableNotes:n},()=>{this.syncAudioSongInstruments(),this.calculateSnapPoints()})}},this.askForSongUpdate=async()=>await (0,u.jH)(this.props.t("question:unsaved_song_save",{song_name:this.state.vsrg.name}),!0),this.createNewSong=async()=>{if("Untitled"!==this.state.vsrg.name&&this.changes>0){let e=await this.askForSongUpdate();if(null===e)return;e&&await this.saveSong()}let e=await (0,u.cJ)(this.props.t("question:enter_song_name"));if(e){let t=new el.Cz(e);t.set({bpm:this.state.settings.bpm.value,keys:this.state.settings.keys.value,pitch:this.state.settings.pitch.value,snapPoint:this.state.snapPoint}),t.addTrack();let s=await S.k.addSong(t);t.set({id:s}),this.setState({vsrg:t,renderableNotes:[]},()=>{ei.emitEvent("songLoad"),this.calculateSnapPoints(),this.syncInstruments()})}},this.calculateSnapPoints=()=>{let{vsrg:e,snapPoint:t}=this.state,s=e.duration/Math.floor(6e4/e.bpm)*t,n=e.duration/s,i=Array(Math.floor(s)).fill(0).map((e,t)=>t*n);this.setState({snapPoints:i,snapPointDuration:n})},this.dragHitObject=(e,t)=>{let{selectedHitObject:s,vsrg:n,settings:i}=this.state;null!==s&&(s.timestamp=e,void 0!==t&&t<i.keys.value&&(s.index=t),this.setState({vsrg:n,selectedHitObject:s}))},this.findClosestSnapPoint=e=>{let{snapPoints:t}=this.state;return t.reduce((t,s)=>Math.abs(s-e)<Math.abs(t-e)?s:t)},this.releaseHitObject=()=>{let{selectedHitObject:e,vsrg:t}=this.state;null!==e&&(e.timestamp=this.findClosestSnapPoint(e.timestamp),t.getHitObjectsBetween(e.timestamp,e.timestamp+e.holdDuration,e.index).forEach((s,n)=>s.forEach(s=>s!==e&&t.removeHitObjectInTrackAtTimestamp(n,s.timestamp,s.index))),this.changes++,this.setState({vsrg:t}))},this.onTrackChange=(e,t)=>{let{vsrg:s}=this.state;s.tracks[t]=e,this.setState({vsrg:s},this.syncInstruments)},this.onNoteSelect=e=>{let{selectedHitObject:t,audioPlayer:s,selectedTrack:n}=this.state;null==t||t.toggleNote(e),s.playNoteOfInstrument(n,e),this.setState({selectedHitObject:t})},this.togglePlay=()=>{let{isPlaying:e,vsrg:t,audioSong:s}=this.state;if(t.startPlayback(this.lastTimestamp),this.lastTimestamp>=t.duration)return this.setState({isPlaying:!1});s&&s.startPlayback(this.lastTimestamp),this.setState({isPlaying:!e})},this.playHitObject=(e,t)=>{let{audioPlayer:s}=this.state;s.playNotesOfInstrument(t,e.notes)},this.onTimestampChange=e=>{let{vsrg:t,isPlaying:s,audioSong:n,audioPlaybackPlayer:i,snapPointDuration:r}=this.state;if(this.lastTimestamp=e,s){if(this.lastTimestamp>=t.duration)return this.setState({isPlaying:!1});this.heldKeys.forEach((t,s)=>{if(t){let t=this.pressedDownHitObjects[s];if(!t)return;let n=e-t.timestamp;n>r&&(t.holdDuration=n,t.isHeld=!0)}}),n&&n.tickPlayback(e).forEach(e=>{e.layer.toArray().forEach((s,n)=>{0===s||t.trackModifiers[n].muted||i.playNoteOfInstrument(n,e.index)})}),t.tickPlayback(e).forEach((e,t)=>e.forEach(e=>this.playHitObject(e,t)))}},this.deleteTrack=async e=>{let{vsrg:t}=this.state;if(1===t.tracks.length)return I.kg.error(this.props.t("vsrg_composer:cannot_delete_last_track"));await (0,u.jH)(this.props.t("vsrg_composer:delete_track_question"))&&this.mounted&&(this.changes++,t.deleteTrack(e),this.setState({vsrg:t,selectedTrack:Math.max(0,e-1)},()=>ei.emitEvent("tracksChange")))},this.onSongOpen=async e=>{let{settings:t,vsrg:s}=this.state;if(0!==this.changes){let e=t.autosave.value&&"Untitled"!==s.name;if(!e){let t=await (0,u.jH)(this.props.t("question:unsaved_song_save",{song_name:s.name}),!0);if(null===t)return;e=t}if(e&&await this.saveSong()===null)return}t.bpm={...t.bpm,value:e.bpm},t.keys={...t.keys,value:e.keys},t.pitch={...t.pitch,value:e.pitch},this.updateSettings(),this.changes++,this.setState({vsrg:e,snapPoint:e.snapPoint,selectedTrack:0,selectedHitObject:null,lastCreatedHitObject:null},async()=>{ei.emitEvent("songLoad"),this.syncInstruments();let t=await S.k.getSongById(e.audioSongId);this.setAudioSong(t),this.calculateSnapPoints()})},this.addTime=()=>{let{vsrg:e}=this.state;e.duration+=1e3,this.calculateSnapPoints(),this.changes++,this.setState({vsrg:e})},this.removeTime=()=>{let{vsrg:e}=this.state;e.duration-=1e3,this.calculateSnapPoints(),this.changes++,this.setState({vsrg:e})},this.onScalingChange=e=>{this.setState({scaling:e},()=>ei.emitEvent("scaleChange"))},this.saveSong=async()=>{let{vsrg:e}=this.state,t=null!==e.id?e.name:await (0,u.cJ)(this.props.t("question:enter_song_name"));if(null===t)return null;if(e.set({name:t}),null===e.id){let t=await S.k.addSong(e);e.set({id:t})}else S.k.updateSong(e);return this.changes=0,this.setState({vsrg:e}),e},this.onTrackModifierChange=(e,t,s)=>{let{vsrg:n,audioSong:i}=this.state;if(n.trackModifiers[t]=e,n.trackModifiers=[...n.trackModifiers],this.changes++,s&&i){let e=n.getRenderableNotes(i);return this.setState({renderableNotes:e,vsrg:n})}this.setState({vsrg:n})},this.onTempoChangerChange=e=>{this.setState({tempoChanger:e})},this.selectType=e=>{this.setState({selectedType:e,lastCreatedHitObject:null})},this.onBreakpointChange=e=>{let{vsrg:t}=this.state,s=this.findClosestSnapPoint(this.lastTimestamp);t.setBreakpoint(s,!e),this.setState({vsrg:t})},this.onBreakpointSelect=e=>{let{vsrg:t,isPlaying:s,audioSong:n}=this.state,i=t.getClosestBreakpoint(this.lastTimestamp,e);s&&(null==n||n.startPlayback(i),t.startPlayback(i)),ei.emitEvent("timestampChange",i)};let t=eP.j.getDefaultVsrgComposerSettings();this.state={vsrg:new el.Cz("Untitled"),audioPlayer:new ez.z(t.pitch.value),audioPlaybackPlayer:new ez.z(t.pitch.value),selectedTrack:0,snapPoint:1,snapPoints:[0],snapPointDuration:0,selectedHitObject:null,scaling:60,selectedType:"tap",isPlaying:!1,lastCreatedHitObject:null,settings:t,audioSong:null,renderableNotes:[],tempoChanger:1},this.state.vsrg.addTrack("DunDun"),this.state.vsrg.set({bpm:t.bpm.value,keys:t.keys.value}),this.mounted=!1}}function eK(){let e=(0,eD.useRouter)(),{t}=(0,M.$G)(["vsrg_composer","home","question"]);return(0,eB.o)("vsrgComposer"),(0,n.jsx)(eJ,{router:e,t:t})}eK.getLayout=function(e){return(0,n.jsx)(eL.Z,{page:"Composer",children:e})}},20557:function(e){e.exports={"help-icon":"HelpTab_help-icon__LZT3K","help-icon-wrapper":"HelpTab_help-icon-wrapper__765O_","help-title":"HelpTab_help-title__B5SPa","help-margin-left":"HelpTab_help-margin-left__5ibwm","help-img":"HelpTab_help-img__kRbW_","keys-table":"HelpTab_keys-table__JU_J5"}},55651:function(e,t,s){"use strict";s.d(t,{L_:function(){return B},ZE:function(){return $},gW:function(){return A}});var n=s(67294);function i(){return(i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(e[n]=s[n])}return e}).apply(this,arguments)}function r(e,t){if(null==e)return{};var s,n,i={},r=Object.keys(e);for(n=0;n<r.length;n++)t.indexOf(s=r[n])>=0||(i[s]=e[s]);return i}function a(e){var t=(0,n.useRef)(e),s=(0,n.useRef)(function(e){t.current&&t.current(e)});return t.current=e,s.current}var o=function(e,t,s){return void 0===t&&(t=0),void 0===s&&(s=1),e>s?s:e<t?t:e},l=function(e){return"touches"in e},c=function(e){return e&&e.ownerDocument.defaultView||self},h=function(e,t,s){var n=e.getBoundingClientRect(),i=l(t)?function(e,t){for(var s=0;s<e.length;s++)if(e[s].identifier===t)return e[s];return e[0]}(t.touches,s):t;return{left:o((i.pageX-(n.left+c(e).pageXOffset))/n.width),top:o((i.pageY-(n.top+c(e).pageYOffset))/n.height)}},u=function(e){l(e)||e.preventDefault()},d=n.memo(function(e){var t=e.onMove,s=e.onKey,o=r(e,["onMove","onKey"]),d=(0,n.useRef)(null),m=a(t),g=a(s),p=(0,n.useRef)(null),f=(0,n.useRef)(!1),v=(0,n.useMemo)(function(){var e=function(e){u(e),(l(e)?e.touches.length>0:e.buttons>0)&&d.current?m(h(d.current,e,p.current)):s(!1)},t=function(){return s(!1)};function s(s){var n=f.current,i=c(d.current),r=s?i.addEventListener:i.removeEventListener;r(n?"touchmove":"mousemove",e),r(n?"touchend":"mouseup",t)}return[function(e){var t=e.nativeEvent,n=d.current;if(n&&(u(t),(!f.current||l(t))&&n)){if(l(t)){f.current=!0;var i=t.changedTouches||[];i.length&&(p.current=i[0].identifier)}n.focus(),m(h(n,t,p.current)),s(!0)}},function(e){var t=e.which||e.keyCode;t<37||t>40||(e.preventDefault(),g({left:39===t?.05:37===t?-.05:0,top:40===t?.05:38===t?-.05:0}))},s]},[g,m]),x=v[0],b=v[1],y=v[2];return(0,n.useEffect)(function(){return y},[y]),n.createElement("div",i({},o,{onTouchStart:x,onMouseDown:x,className:"react-colorful__interactive",ref:d,onKeyDown:b,tabIndex:0,role:"slider"}))}),m=function(e){return e.filter(Boolean).join(" ")},g=function(e){var t=e.color,s=e.left,i=e.top,r=m(["react-colorful__pointer",e.className]);return n.createElement("div",{className:r,style:{top:100*(void 0===i?.5:i)+"%",left:100*s+"%"}},n.createElement("div",{className:"react-colorful__pointer-fill",style:{backgroundColor:t}}))},p=function(e,t,s){return void 0===t&&(t=0),void 0===s&&(s=Math.pow(10,t)),Math.round(s*e)/s},f=function(e){return C(v(e))},v=function(e){return"#"===e[0]&&(e=e.substring(1)),e.length<6?{r:parseInt(e[0]+e[0],16),g:parseInt(e[1]+e[1],16),b:parseInt(e[2]+e[2],16),a:4===e.length?p(parseInt(e[3]+e[3],16)/255,2):1}:{r:parseInt(e.substring(0,2),16),g:parseInt(e.substring(2,4),16),b:parseInt(e.substring(4,6),16),a:8===e.length?p(parseInt(e.substring(6,8),16)/255,2):1}},x=function(e){return S(k(e))},b=function(e){var t=e.s,s=e.v,n=e.a,i=(200-t)*s/100;return{h:p(e.h),s:p(i>0&&i<200?t*s/100/(i<=100?i:200-i)*100:0),l:p(i/2),a:p(n,2)}},y=function(e){var t=b(e);return"hsl("+t.h+", "+t.s+"%, "+t.l+"%)"},j=function(e){var t=b(e);return"hsla("+t.h+", "+t.s+"%, "+t.l+"%, "+t.a+")"},k=function(e){var t=e.h,s=e.s,n=e.v,i=e.a;t=t/360*6,s/=100,n/=100;var r=Math.floor(t),a=n*(1-s),o=n*(1-(t-r)*s),l=n*(1-(1-t+r)*s),c=r%6;return{r:p(255*[n,o,a,a,l,n][c]),g:p(255*[l,n,n,o,a,a][c]),b:p(255*[a,a,l,n,n,o][c]),a:p(i,2)}},w=function(e){var t=e.toString(16);return t.length<2?"0"+t:t},S=function(e){var t=e.r,s=e.g,n=e.b,i=e.a,r=i<1?w(p(255*i)):"";return"#"+w(t)+w(s)+w(n)+r},C=function(e){var t=e.r,s=e.g,n=e.b,i=e.a,r=Math.max(t,s,n),a=r-Math.min(t,s,n),o=a?r===t?(s-n)/a:r===s?2+(n-t)/a:4+(t-s)/a:0;return{h:p(60*(o<0?o+6:o)),s:p(r?a/r*100:0),v:p(r/255*100),a:i}},T=n.memo(function(e){var t=e.hue,s=e.onChange,i=m(["react-colorful__hue",e.className]);return n.createElement("div",{className:i},n.createElement(d,{onMove:function(e){s({h:360*e.left})},onKey:function(e){s({h:o(t+360*e.left,0,360)})},"aria-label":"Hue","aria-valuenow":p(t),"aria-valuemax":"360","aria-valuemin":"0"},n.createElement(g,{className:"react-colorful__hue-pointer",left:t/360,color:y({h:t,s:100,v:100,a:1})})))}),_=n.memo(function(e){var t=e.hsva,s=e.onChange,i={backgroundColor:y({h:t.h,s:100,v:100,a:1})};return n.createElement("div",{className:"react-colorful__saturation",style:i},n.createElement(d,{onMove:function(e){s({s:100*e.left,v:100-100*e.top})},onKey:function(e){s({s:o(t.s+100*e.left,0,100),v:o(t.v-100*e.top,0,100)})},"aria-label":"Color","aria-valuetext":"Saturation "+p(t.s)+"%, Brightness "+p(t.v)+"%"},n.createElement(g,{className:"react-colorful__saturation-pointer",top:1-t.v/100,left:t.s/100,color:y(t)})))}),H=function(e,t){if(e===t)return!0;for(var s in e)if(e[s]!==t[s])return!1;return!0},N=function(e,t){return e.toLowerCase()===t.toLowerCase()||H(v(e),v(t))};function E(e,t,s){var i=a(s),r=(0,n.useState)(function(){return e.toHsva(t)}),o=r[0],l=r[1],c=(0,n.useRef)({color:t,hsva:o});return(0,n.useEffect)(function(){if(!e.equal(t,c.current.color)){var s=e.toHsva(t);c.current={hsva:s,color:t},l(s)}},[t,e]),(0,n.useEffect)(function(){var t;H(o,c.current.hsva)||e.equal(t=e.fromHsva(o),c.current.color)||(c.current={hsva:o,color:t},i(t))},[o,e,i]),[o,(0,n.useCallback)(function(e){l(function(t){return Object.assign({},t,e)})},[])]}var O,P="undefined"!=typeof window?n.useLayoutEffect:n.useEffect,z=new Map,M=function(e){P(function(){var t=e.current?e.current.ownerDocument:document;if(void 0!==t&&!z.has(t)){var n=t.createElement("style");n.innerHTML='.react-colorful{position:relative;display:flex;flex-direction:column;width:200px;height:200px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:default}.react-colorful__saturation{position:relative;flex-grow:1;border-color:transparent;border-bottom:12px solid #000;border-radius:8px 8px 0 0;background-image:linear-gradient(0deg,#000,transparent),linear-gradient(90deg,#fff,hsla(0,0%,100%,0))}.react-colorful__alpha-gradient,.react-colorful__pointer-fill{content:"";position:absolute;left:0;top:0;right:0;bottom:0;pointer-events:none;border-radius:inherit}.react-colorful__alpha-gradient,.react-colorful__saturation{box-shadow:inset 0 0 0 1px rgba(0,0,0,.05)}.react-colorful__alpha,.react-colorful__hue{position:relative;height:24px}.react-colorful__hue{background:linear-gradient(90deg,red 0,#ff0 17%,#0f0 33%,#0ff 50%,#00f 67%,#f0f 83%,red)}.react-colorful__last-control{border-radius:0 0 8px 8px}.react-colorful__interactive{position:absolute;left:0;top:0;right:0;bottom:0;border-radius:inherit;outline:none;touch-action:none}.react-colorful__pointer{position:absolute;z-index:1;box-sizing:border-box;width:28px;height:28px;transform:translate(-50%,-50%);background-color:#fff;border:2px solid #fff;border-radius:50%;box-shadow:0 2px 4px rgba(0,0,0,.2)}.react-colorful__interactive:focus .react-colorful__pointer{transform:translate(-50%,-50%) scale(1.1)}.react-colorful__alpha,.react-colorful__alpha-pointer{background-color:#fff;background-image:url(\'data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill-opacity=".05"><path d="M8 0h8v8H8zM0 8h8v8H0z"/></svg>\')}.react-colorful__saturation-pointer{z-index:3}.react-colorful__hue-pointer{z-index:2}',z.set(t,n);var i=O||s.nc;i&&n.setAttribute("nonce",i),t.head.appendChild(n)}},[])},R=function(e){var t=e.className,s=e.colorModel,a=e.color,o=void 0===a?s.defaultColor:a,l=e.onChange,c=r(e,["className","colorModel","color","onChange"]),h=(0,n.useRef)(null);M(h);var u=E(s,o,l),d=u[0],g=u[1],p=m(["react-colorful",t]);return n.createElement("div",i({},c,{ref:h,className:p}),n.createElement(_,{hsva:d,onChange:g}),n.createElement(T,{hue:d.h,onChange:g,className:"react-colorful__last-control"}))},I={defaultColor:"000",toHsva:f,fromHsva:function(e){return x({h:e.h,s:e.s,v:e.v,a:1})},equal:N},A=function(e){return n.createElement(R,i({},e,{colorModel:I}))},F=function(e){var t=e.className,s=e.hsva,i=e.onChange,r={backgroundImage:"linear-gradient(90deg, "+j(Object.assign({},s,{a:0}))+", "+j(Object.assign({},s,{a:1}))+")"},a=m(["react-colorful__alpha",t]),l=p(100*s.a);return n.createElement("div",{className:a},n.createElement("div",{className:"react-colorful__alpha-gradient",style:r}),n.createElement(d,{onMove:function(e){i({a:e.left})},onKey:function(e){i({a:o(s.a+e.left)})},"aria-label":"Alpha","aria-valuetext":l+"%","aria-valuenow":l,"aria-valuemin":"0","aria-valuemax":"100"},n.createElement(g,{className:"react-colorful__alpha-pointer",left:s.a,color:j(s)})))},L=function(e){var t=e.className,s=e.colorModel,a=e.color,o=void 0===a?s.defaultColor:a,l=e.onChange,c=r(e,["className","colorModel","color","onChange"]),h=(0,n.useRef)(null);M(h);var u=E(s,o,l),d=u[0],g=u[1],p=m(["react-colorful",t]);return n.createElement("div",i({},c,{ref:h,className:p}),n.createElement(_,{hsva:d,onChange:g}),n.createElement(T,{hue:d.h,onChange:g}),n.createElement(F,{hsva:d,onChange:g,className:"react-colorful__last-control"}))},D={defaultColor:"0001",toHsva:f,fromHsva:x,equal:N},B=function(e){return n.createElement(L,i({},e,{colorModel:D}))},W=/^#?([0-9A-F]{3,8})$/i,J=function(e){var t=e.color,s=void 0===t?"":t,o=e.onChange,l=e.onBlur,c=e.escape,h=e.validate,u=e.format,d=e.process,m=r(e,["color","onChange","onBlur","escape","validate","format","process"]),g=(0,n.useState)(function(){return c(s)}),p=g[0],f=g[1],v=a(o),x=a(l),b=(0,n.useCallback)(function(e){var t=c(e.target.value);f(t),h(t)&&v(d?d(t):t)},[c,d,h,v]),y=(0,n.useCallback)(function(e){h(e.target.value)||f(c(s)),x(e)},[s,c,h,x]);return(0,n.useEffect)(function(){f(c(s))},[s,c]),n.createElement("input",i({},m,{value:u?u(p):p,spellCheck:"false",onChange:b,onBlur:y}))},K=function(e){return"#"+e},$=function(e){var t=e.prefixed,s=e.alpha,a=r(e,["prefixed","alpha"]),o=(0,n.useCallback)(function(e){return e.replace(/([^0-9A-F]+)/gi,"").substring(0,s?8:6)},[s]),l=(0,n.useCallback)(function(e){var t,n;return 3===(n=(t=W.exec(e))?t[1].length:0)||6===n||!!s&&4===n||!!s&&8===n},[s]);return n.createElement(J,i({},a,{escape:o,format:t?K:void 0,process:K,validate:l}))}}},function(e){e.O(0,[9569,5598,9790,2888,9774,179],function(){return e(e.s=40120)}),_N_E=e.O()}]);