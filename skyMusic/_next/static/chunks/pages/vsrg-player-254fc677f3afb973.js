(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1944],{89406:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/vsrg-player",function(){return s(59579)}])},19075:function(e,t,s){"use strict";s.d(t,{O:function(){return m}});var r=s(85893),n=s(17544),i=s(21820),a=s.n(i),o=s(701),l=s(67421),c=s(92634),h=s(67294);let d=new Set(n.BX.filter(e=>e.includes("_")).map(e=>e.split("_")[0])),u={instruments:n.BX.filter(e=>!e.includes("_"))};for(let e of d)u[e]=n.BX.filter(t=>t.startsWith(e));let g=Object.entries(u);function m(e){let{selected:t,onChange:s,style:n,className:i}=e,{t:d}=(0,l.$G)("instruments"),[m]=(0,c.F)(),p=(0,h.useMemo)(()=>"url(\"data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' height='24' viewBox='0 0 24 24' width='24' fill='".concat(m.getText("primary").hex().replace("#","%23"),"'><path d='M0 0h24v24H0z' fill='none'/><path d='M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z'/></svg>\")"),[m]);return(0,r.jsx)("select",{className:"".concat(a().select," ").concat(i),style:{width:"100%",padding:"0.3rem",backgroundImage:p,...n},onChange:e=>{s(e.target.value),e.target.blur()},value:t,children:1===g.length?(0,r.jsx)(r.Fragment,{children:u.instruments.map(e=>(0,r.jsx)("option",{value:e,children:d(e)},e))}):(0,r.jsx)(r.Fragment,{children:g.map(e=>{let[t,s]=e;return(0,r.jsx)("optgroup",{label:(0,o.kC)(t),children:s.map(e=>(0,r.jsx)("option",{value:e,children:d(e)},e))},t)})})})}},13042:function(e,t,s){"use strict";s.d(t,{Z:function(){return o}});var r=s(85893),n=s(92634),i=s(48771),a=s.n(i);function o(e){let{checked:t,onChange:s,styleOuter:i}=e,[o]=(0,n.F)();return(0,r.jsx)("button",{className:a()["switch-wrapper"],onClick:()=>s(!t),style:i||{},"aria-label":t?"Switch to off":"Switch to on",children:(0,r.jsx)("div",{className:"".concat(a()["switch-inner"]," ").concat(t?a()["switch-inner-on"]:""),style:{backgroundColor:(t?o.get("accent"):o.layer("primary",.4)).toString()}})})}},20027:function(e,t,s){"use strict";s.d(t,{G:function(){return c},f:function(){return l}});var r=s(85893),n=s(40456),i=s.n(n),a=s(701),o=s(69887);function l(e){let{children:t,className:s,style:n}=e,{open:l,visible:c}=(0,o.X)();return(0,r.jsx)("div",{className:(0,a.cn)("".concat(i()["side-menu"]," ").concat(s),[l&&c,i()["side-menu-open"]]),style:n,children:t})}function c(e){let{title:t,children:s,id:n}=e,{current:l}=(0,o.X)();return(0,r.jsxs)("div",{className:(0,a.cn)(i()["menu-panel"],[l===n,i()["menu-panel-visible"]]),children:[t&&(0,r.jsx)("div",{className:i()["menu-title"],children:t}),(0,r.jsx)("div",{className:i()["panel-content-wrapper"],children:s})]})}},86998:function(e,t,s){"use strict";s.d(t,{A:function(){return x}});var r=s(85893),n=s(67294),i=s(13042),a=s(21820),o=s.n(a),l=s(19075);function c(e){let{data:t,volume:s,onVolumeChange:n,onVolumeComplete:i,onInstrumentPick:a,objectKey:c,instrument:h,theme:d}=e;return(0,r.jsxs)("div",{className:o()["instrument-picker"],children:[(0,r.jsx)(l.O,{selected:h,onChange:function(e){a({key:c,data:{...t,value:e}})},className:o().select,style:{textAlign:"left",paddingLeft:"0.4rem"}}),(0,r.jsx)("input",{type:"range",min:1,max:100,value:s,onChange:function(e){n(Number(e.target.value))},onPointerUp:function(){i({key:c,value:s})}})]})}var h=s(78773);function d(e){let{data:t,value:s,onChange:n,onComplete:i,objectKey:a}=e;function l(e){if("number"===t.type){let r=Number(s)+(t.increment||0)*e;!t.threshold||r<t.threshold[0]||r>t.threshold[1]||i({key:a,data:{...t,value:r}})}}return(0,r.jsxs)("div",{className:o()["settings-input"],children:["number"===t.type&&(0,r.jsx)("button",{onClick:()=>l(-1),className:o()["settings-input-button"],style:{marginRight:"0.15rem"},"aria-label":"Decrement",children:(0,r.jsx)(h.iFH,{})}),(0,r.jsx)("input",{type:t.type,value:s,placeholder:t.placeholder||"",onBlur:function(){t.value!==s&&i({key:a,data:{...t,value:s}})},onChange:function(e){let s=e.target;if("number"===t.type){let e=Number(s.value);if(s.value="",!t.threshold||e<t.threshold[0]||e>t.threshold[1])return;n(e)}else n(s.value)},"aria-label":t.name}),"number"===t.type&&(0,r.jsx)("button",{onClick:()=>l(1),className:o()["settings-input-button"],style:{marginLeft:"0.15rem"},"aria-label":"Increment",children:(0,r.jsx)(h.wEH,{})})]})}function u(e){let{data:t,value:s,onChange:n,objectKey:i}=e;return(0,r.jsx)("input",{type:"range",min:t.threshold[0],max:t.threshold[1],step:t.step,value:s,onChange:function(e){n({key:i,data:{...t,value:Number(e.target.value)}})}})}function g(e){let{value:t,onChange:s,data:n,objectKey:i,children:a,theme:o,type:l}=e;return(0,r.jsx)("select",{value:t,onChange:function(e){s({key:i,data:{...n,value:"number"==typeof l?parseInt(e.target.value):e.target.value}}),e.target.blur()},style:{backgroundImage:"url(\"data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' height='24' viewBox='0 0 24 24' width='24' fill='".concat(o.getText("primary").hex().replace("#","%23"),"'><path d='M0 0h24v24H0z' fill='none'/><path d='M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z'/></svg>\")")},children:a})}var m=s(92634),p=s(10694),y=s(67421),v=(0,n.memo)(function(e){let{data:t,update:s,objKey:a,changeVolume:l}=e,{t:h}=(0,y.$G)(["settings"]),[v,x]=(0,n.useState)(t.value),[b,f]=(0,n.useState)("instrument"===t.type?t.volume:0),[j]=(0,m.F)(),{type:k}=t;return(0,n.useEffect)(()=>{x(t.value)},[t.value]),(0,r.jsxs)("div",{className:o()["settings-row"],style:{backgroundColor:j.layer("menu_background",.15).toString()},children:[(0,r.jsxs)("div",{className:(0,p.h)(t.tooltip),style:{flex:"1"},children:[h("props.".concat(t.name)),t.tooltip&&(0,r.jsx)(p.u,{style:{width:"12rem"},children:h("props.".concat(t.tooltip))})]}),"select"===k&&(0,r.jsx)(g,{theme:j,type:t.options[0],onChange:s,value:t.value,objectKey:a,data:t,children:t.options.map(e=>(0,r.jsx)("option",{value:e,children:e},e))}),("number"===k||"text"===k)&&(0,r.jsx)(d,{data:t,value:v,onChange:x,onComplete:s,objectKey:a}),"checkbox"===k&&(0,r.jsx)(i.Z,{checked:v,onChange:function(e){"checkbox"===k&&s({key:a,data:{...t,value:e}})}}),"slider"===k&&(0,r.jsx)(u,{objectKey:a,data:t,value:v,onChange:s}),"instrument"===k&&l&&(0,r.jsx)(c,{theme:j,volume:b,onInstrumentPick:s,onVolumeChange:f,onVolumeComplete:l,instrument:t.value,data:t,objectKey:a})]})},(e,t)=>e.data.value===t.data.value&&e.data.volume===t.data.volume&&e.update===t.update);function x(e){let{settings:t,changeVolume:s,onUpdate:i}=e,{t:a}=(0,y.$G)(["settings"]),l=new Map;return Object.entries(t).forEach(e=>{let[t,s]=e;l.has(s.category)||l.set(s.category,{category:s.category,settings:{}}),l.get(s.category).settings[t]=s}),(0,r.jsx)(r.Fragment,{children:Array.from(l.values()).map(e=>(0,r.jsx)(n.Fragment,{children:(0,r.jsxs)("div",{className:"column",children:[(0,r.jsx)("h1",{className:o()["settings-group-title"],children:a("category.".concat(e.category))}),Object.entries(e.settings).map(e=>{let[t,n]=e;return(0,r.jsx)(v,{objKey:t,data:n,changeVolume:s,update:i},t)})]})},e.category))})}},97411:function(e,t,s){"use strict";s.d(t,{c:function(){return i}});var r=s(85893),n=s(67294);t.Z=(0,n.memo)(function(e){let{children:t}=e;return(0,r.jsx)(r.Fragment,{children:t})},(e,t)=>{var s,r,n,i;return(null===(s=t.children)||void 0===s?void 0:s.key)!==null||(null===(r=e.children)||void 0===r?void 0:r.key)!==null?(null===(n=e.children)||void 0===n?void 0:n.key)===(null===(i=t.children)||void 0===i?void 0:i.key):void 0!==e.children});let i=(0,n.memo)(function(e){let{icon:t,size:s,className:n}=e;return(0,r.jsx)(t,{size:s,className:n})},(e,t)=>e.icon===t.icon&&e.size===t.size&&e.className===t.className)},84455:function(e,t,s){"use strict";s.d(t,{F:function(){return a}});var r=s(85893),n=s(41664),i=s.n(n);function a(e){let{href:t,children:s,style:n,...a}=e;return(0,r.jsx)(i(),{href:t,style:{display:"inline-block",textDecoration:"underline",color:"var(--accent)",...n},...a,children:s})}},47103:function(e,t,s){"use strict";s.d(t,{Z:function(){return o}});var r=s(85893),n=s(54233),i=s(67294),a=s(68949);function o(e){let{children:t,page:s,style:o}=e,[l]=function(){let[e,t]=(0,i.useState)(n.f6);return(0,i.useEffect)(()=>(0,a.N7)(n.f6.state.other,()=>{t({...n.f6})}),[]),[e,t]}();return(0,r.jsx)("div",{className:"app bg-image",style:{backgroundImage:"url(".concat(l.getOther("backgroundImage"+s),")"),...o},children:t})}},95616:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});var r=s(85893),n=s(21558),i=s.n(n);function a(e){let{background:t="var(--primary)",color:s="var(--primary-text)",height:n="0.3rem",style:a,className:o,children:l,pillBackground:c,verticalMargin:h="0.2rem",shadow:d=!1}=e,u="string"==typeof d?d:"shadow";return(0,r.jsxs)("div",{className:"".concat(i().separator," ").concat(o),style:{color:s,margin:"".concat(h," 0"),...a},children:[(0,r.jsx)("div",{className:i()["separator-part"],style:{backgroundColor:t,height:n,boxShadow:d?"0 0rem 0.6rem ".concat(u):void 0,borderTopLeftRadius:"0.6rem",borderBottomLeftRadius:"0.6rem"}}),l&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"".concat(i()["separator-content"]),style:{backgroundColor:c,boxShadow:d?"0 0rem 0.6rem ".concat(u):void 0,color:s,border:"solid 0.2rem ".concat(s)},children:l}),(0,r.jsx)("div",{className:i()["separator-part"],style:{height:n,backgroundColor:"var(--".concat(s,")"),boxShadow:d?"0 0rem 0.6rem ".concat(u):void 0,borderTopRightRadius:"0.6rem",borderBottomRightRadius:"0.6rem"}})]})]})}},5323:function(e,t,s){"use strict";s.d(t,{Z:function(){return i}});var r=s(47008),n=s(32362);function i(){return(0,n.$d)(r.X.state)}},40419:function(e,t,s){"use strict";s.d(t,{v:function(){return r}});class r{get fps(){return this.maxFps}changeMaxFps(e){this.maxFps=e,this.maxFpsInterval=1e3/e}setCallback(e){this.callback=e}start(e){this.stop(),this.startTime=Date.now(),this.nextTick=Date.now(),this.previousTickTime=0,this.duration=null!=e?e:Number.MAX_SAFE_INTEGER,this.tick()}stop(){clearTimeout(this.raf)}constructor(e,t){this.nextTick=0,this.maxFpsInterval=0,this.deltaTime=0,this.raf=0,this.duration=0,this.previousTickTime=0,this.tick=()=>{let e=Date.now();this.deltaTime=e-this.nextTick,this.deltaTime>=this.maxFpsInterval&&(this.nextTick=e-this.deltaTime%this.maxFpsInterval,this.callback(this.elapsed,e-this.previousTickTime),this.previousTickTime=e),this.elapsed=e-this.startTime,this.elapsed<this.duration&&(this.raf=setTimeout(this.tick,8))},this.callback=e,this.startTime=0,this.elapsed=0,this.maxFps=t,this.maxFpsInterval=1e3/t}}},74646:function(e,t,s){"use strict";s.d(t,{z:function(){return i}});var r=s(83679),n=s(92761);class i{setBasePitch(e){this.basePitch=e}destroy(){this.audioInstruments.forEach(e=>{n.n.disconnect(e.endNode),e.dispose()})}syncInstruments(e){return this.instruments=e,this.loadInstruments()}async loadInstruments(){let{instruments:e,audioInstruments:t}=this;return t.splice(e.length).forEach(e=>{n.n.disconnect(e.endNode),e.dispose()}),Promise.all(e.map(async(e,s)=>{if(void 0===t[s]){let i=new r.Yx(e.name);return t[s]=i,await i.load(n.n.getAudioContext()),n.n.connect(i.endNode,e.reverbOverride),i.changeVolume(e.volume),i}if(t[s].name===e.name)return t[s].changeVolume(e.volume),n.n.setReverbOfNode(t[s].endNode,e.reverbOverride),t[s];{let i=t[s];n.n.disconnect(i.endNode),i.dispose();let a=new r.Yx(e.name);return t[s]=a,await a.load(n.n.getAudioContext()),n.n.connect(a.endNode,e.reverbOverride),a.changeVolume(e.volume),a}}))}playNoteOfInstrument(e,t,s){let r=this.instruments[e];this.audioInstruments[e].play(t,null!=s?s:r.pitch||this.basePitch)}playNotesOfInstrument(e,t,s){t.forEach(t=>this.playNoteOfInstrument(e,t,s))}constructor(e){this.instruments=[],this.audioInstruments=[],this.basePitch="C",this.basePitch=e}}},59579:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return eT}});var r,n,i=s(85893),a=s(67294),o=s(48043),l=s(20027),c=s(17678),h=s(54135),d=s(86998),u=s(31602),g=s(52461),m=s(97411),p=s(10694),y=s(12293),v=s(86087),x=s(24104),b=s(92634),f=s(89867),j=s(85565),k=s(78773),S=s(41664),_=s.n(S),w=s(6340),N=s(53179),C=s(5323),O=s(17544),P=s(99962),F=s(40569),z=s(67421),T=s(47118),E=s(84455),L=s(95616),H=(0,a.memo)(function(e){let{onSongSelect:t,settings:s,onSettingsUpdate:r}=e,{t:n}=(0,z.$G)(["menu","common","settings"]),[u,g]=(0,a.useState)(!1),[p,f]=(0,a.useState)(!0),[j,S]=(0,a.useState)("Settings"),[w]=(0,v.j)(),[N]=(0,x.n)(),[O]=(0,b.F)(),{IS_MOBILE:T}=(0,C.Z)(),H=(0,y.ZP)(e=>{f(!1)},{active:u&&p,ignoreFocusable:!0});return(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)(P.q,{ref:H,current:j,setCurrent:S,open:u,setOpen:g,visible:p,children:[(0,i.jsx)("div",{className:"hamburger-top",onClick:()=>f(!0),children:(0,i.jsx)(m.c,{icon:k.Fm7})}),(0,i.jsxs)(P.V,{children:[(0,i.jsx)(h.j,{onClick:()=>{f(!1)},ariaLabel:n("close_menu"),children:(0,i.jsx)(m.c,{icon:k.aHS,className:"icon"})}),(0,i.jsx)(h.s,{style:{marginTop:"auto"},id:"Songs",ariaLabel:n("song_menu"),children:(0,i.jsx)(m.c,{icon:k.HcQ,className:"icon"})}),(0,i.jsx)(h.s,{id:"Settings",ariaLabel:n("settings_menu"),children:(0,i.jsx)(m.c,{icon:k.p4t,className:"icon"})}),(0,i.jsx)(h.j,{onClick:F.I.open,ariaLabel:n("open_home_menu"),style:{border:"solid 0.1rem var(--secondary)"},children:(0,i.jsx)(m.c,{icon:k.xng,className:"icon"})})]}),(0,i.jsxs)(l.f,{children:[(0,i.jsxs)(l.G,{id:"Songs",children:[(0,i.jsx)("div",{className:"row",children:(0,i.jsx)(_(),{href:"/vsrg-composer",children:(0,i.jsx)(o.J,{children:n("common:create_song")})})}),(0,i.jsx)(c.G,{songs:N,exclude:["composed","recorded"],style:{marginTop:"0.6rem"},SongComponent:I,componentProps:{theme:O,folders:w,functions:{setMenuVisible:f,onSongSelect:t}}})]}),(0,i.jsxs)(l.G,{id:"Settings",children:[(0,i.jsx)(d.A,{settings:s,onUpdate:r}),!T&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(L.Z,{background:"var(--secondary)",height:"0.1rem",verticalMargin:"0.5rem"}),(0,i.jsx)(E.F,{href:"/keybinds",style:{marginLeft:"auto"},children:(0,i.jsx)(o.J,{children:n("settings:change_keybinds")})})]})]})]})]})})},(e,t)=>e.settings===t.settings);function I(e){let{data:t,functions:s,theme:r,folders:n}=e,{t:o}=(0,z.$G)(["common","logs","settings","menu","confirm"]),{setMenuVisible:l,onSongSelect:c}=s,h={backgroundColor:r.layer("primary",.15).toString()},[d,m]=(0,a.useState)(!1),[y,v]=(0,a.useState)(t.name);return((0,a.useEffect)(()=>{v(t.name)},[t.name]),"vsrg"!==t.type)?(0,i.jsx)("div",{className:"row",children:o("menu:invalid_song")}):(0,i.jsxs)("div",{className:"song-row",children:[(0,i.jsxs)("div",{className:"song-name ".concat((0,p.h)(!0)),onClick:async()=>{if(d)return;let e=await j.v.fromStorableSong(t);if(!e)return N.kg.error(T.WV.t("logs:could_not_find_song"));c(e,"play"),l(!1)},children:[d?(0,i.jsx)("input",{className:"song-name-input ".concat(d?"song-rename":""),disabled:!d,onChange:e=>v(e.target.value),style:{width:"100%",color:"var(--primary-text)"},value:y}):(0,i.jsx)("div",{style:{marginLeft:"0.3rem"},children:y}),(0,i.jsx)(p.u,{children:d?o("menu:song_name"):o("menu:play_song")})]}),(0,i.jsx)("div",{className:"song-buttons-wrapper",children:(0,i.jsxs)(g.Rk,{Icon:k.LCi,style:h,ignoreClickOutside:d,tooltip:o("settings:more_options"),onClose:()=>m(!1),children:[(0,i.jsxs)(g.tc,{onClick:()=>{d&&(w.k.renameSong(t.id,y),m(!1)),m(!d)},children:[(0,i.jsx)(k.tU3,{style:{marginRight:"0.4rem"},size:14}),(0,i.jsx)(g.Qr,{text:d?o("common:save"):o("common:rename")})]}),(0,i.jsxs)(g.tc,{style:{padding:"0 0.4rem"},children:[(0,i.jsx)(k.$nz,{style:{marginRight:"0.4rem"}}),(0,i.jsxs)("select",{className:"dropdown-select",value:t.folderId||"_None",onChange:async e=>{let s=e.target.value,r=await j.v.getOneSerializedFromStorable(t);if(!r)return N.kg.error(o("logs:could_not_find_song"));w.k.addSongToFolder(r,"_None"!==s?s:null)},children:[(0,i.jsx)("option",{value:"_None",children:T.WV.t("common:none")}),n.map(e=>(0,i.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,i.jsxs)(g.tc,{onClick:async()=>{let e=await j.v.getOneSerializedFromStorable(t);if(!e)return N.kg.error(o("logs:could_not_find_song"));f.bV.downloadSong(e,"".concat(t.name,".").concat(O.iC.toLowerCase(),"sheet"))},children:[(0,i.jsx)(k.aBF,{style:{marginRight:"0.4rem"},size:14}),(0,i.jsx)(g.Qr,{text:o("common:download")})]}),(0,i.jsxs)(g.tc,{onClick:async()=>{await (0,u.jH)(o("confirm:delete_song",{song_name:t.name}))&&w.k.removeSong(t.id)},children:[(0,i.jsx)(k.Xm5,{color:"#ed4557",style:{marginRight:"0.4rem"},size:14}),(0,i.jsx)(g.Qr,{text:o("common:delete")})]})]})})]})}var V=s(80219),R=s(74646),A=s(68949),K=s(97582);let M={amazing:300,perfect:200,great:100,good:50,bad:25,miss:0};class D{constructor(){this.keyboard=[],this.currentSong={song:null,type:"stop"},this.score={scoreVisible:!1,combo:0,score:0,amazing:0,perfect:0,great:0,good:0,bad:0,miss:0,lastScore:{timestamp:0,type:"",combo:0}},this.listeners=[],this.keyboardListeners=[],this.setLayout=e=>{this.keyboard.splice(0,this.keyboard.length,...e.map((e,t)=>({key:e,index:t,isPressed:!1})))},this.addEventListener=(e,t)=>{this.listeners.push({callback:e,id:t})},this.emitEvent=e=>{this.listeners.forEach(t=>t.callback(e))},this.removeEventListener=e=>{this.listeners=this.listeners.filter(t=>t.id!==e)},this.resetScore=()=>{Object.assign(this.score,{scoreVisible:!1,score:0,amazing:0,perfect:0,great:0,good:0,bad:0,miss:0,combo:0,lastScore:{timestamp:0,type:"",combo:0}})},this.incrementScore=e=>{let t="miss"===e?0:this.score.combo+1;Object.assign(this.score,{[e]:this.score[e]+1,combo:t,score:this.score.score+this.getScore(e)*t,lastScore:{timestamp:Date.now(),type:e,combo:t}})},this.getScore=e=>{var t;return null!==(t=M[e])&&void 0!==t?t:0},this.playSong=e=>{this.currentSong.type="play",this.currentSong.song=e.clone()},this.showScore=()=>{this.score.scoreVisible=!0},this.stopSong=()=>{this.currentSong.type="stop",this.currentSong.song=null},this.pressKey=e=>{this.keyboard[e].isPressed=!0,this.emitKeyboardEvent(this.keyboard[e],"down")},this.releaseKey=e=>{this.keyboard[e].isPressed=!1,this.emitKeyboardEvent(this.keyboard[e],"up")},this.addKeyboardListener=e=>{this.keyboardListeners.push(e)},this.removeKeyboardListener=e=>{let t=this.keyboardListeners.findIndex(t=>t.id===e.id||t.callback===e.callback);-1!==t&&this.keyboardListeners.splice(t,1)},this.emitKeyboardEvent=(e,t)=>{this.keyboardListeners.forEach(s=>s.callback(e,t))},(0,A.rC)(this)}}(0,K.gn)([A.LO],D.prototype,"keyboard",void 0),(0,K.gn)([A.LO.shallow],D.prototype,"currentSong",void 0),(0,K.gn)([A.LO],D.prototype,"score",void 0);let B=new D;var W=s(21249),$=s(79613),Z=s.n($);function G(e){let{hitObjectSize:t,offset:s,keyboardLayout:r,verticalOffset:n,horizontalOffset:o}=e,l=function(){let[e,t]=(0,a.useState)(B.keyboard);return(0,a.useEffect)(()=>(function(e){let t=(0,A.N7)(B.keyboard,()=>{e([...B.keyboard])});return e([...B.keyboard]),t})(t),[]),e}();(0,a.useEffect)(()=>(W.w.listen(e=>{let{letter:t,event:s}=e;if(s.repeat)return;let r=l.findIndex(e=>e.key===t);r>=0&&B.pressKey(r)},{type:"keydown",id:"vsrg-player-keyboard"}),W.w.listen(e=>{let{letter:t,event:s}=e;if(s.repeat)return;let r=l.findIndex(e=>e.key===t);r>=0&&B.releaseKey(r)},{type:"keyup",id:"vsrg-player-keyboard"}),()=>{W.w.unregisterById("vsrg-player-keyboard")}),[l]);let c=Math.ceil(l.length/2),h=l.length-2*c,d=l.slice(0,c),u=l.slice(c+h);return(0,i.jsxs)(i.Fragment,{children:["line"===r&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",{className:Z()["vsrg-player-keyboard-control-left"],style:{"--vertical-offset":"calc(-".concat(2*d.length,"vw + ").concat(.1*n,"rem)"),"--horizontal-offset":"".concat(.1*o+1,"rem")},children:d.map(e=>(0,i.jsx)(X,{index:e.index,layout:l,offset:s,layoutType:"circles",size:t},"".concat(e.key,"-").concat(l.length)))}),(0,i.jsx)("div",{className:Z()["vsrg-player-keyboard-control-right"],style:{"--vertical-offset":"calc(-".concat(2*d.length,"vw + ").concat(.1*n,"rem)"),"--horizontal-offset":"".concat(.1*o+1,"rem")},children:u.map(e=>(0,i.jsx)(X,{index:e.index,layout:l,offset:s,layoutType:"circles",size:t},"".concat(e.key,"-").concat(l.length)))})]}),(0,i.jsx)("div",{className:Z()["vsrg-player-keyboard-circles"],children:l.map(e=>(0,i.jsx)(X,{index:e.index,layout:l,offset:s,layoutType:r,size:t},"".concat(e.key,"-").concat(l.length)))})]})}function X(e){let{index:t,layout:s,size:r,layoutType:n,offset:o}=e,l=function(e,t){let[s,r]=(0,a.useState)(B.keyboard[e]);return(0,a.useEffect)(()=>(function(e,t){if(!B.keyboard[e])return console.warn("No key found",e,B.keyboard),()=>{};let s=(0,A.N7)(B.keyboard[e],()=>{t({...B.keyboard[e]})});return t({...B.keyboard[e]}),s})(e,r),[e,t]),s}(t,s),c=(0,a.useCallback)(()=>{B.pressKey(t)},[t]),h=(0,a.useCallback)(()=>{B.releaseKey(t)},[t]);return"circles"===n?(0,i.jsx)("button",{className:"".concat(Z()["vsrg-player-key-hitbox-circle"]," flex-centered"),style:{paddingBottom:"".concat(o,"px")},onPointerDown:c,onPointerUp:h,onPointerLeave:h,children:(0,i.jsx)("div",{className:"".concat(Z()["vsrg-player-key-circle"]," ").concat(l.isPressed?Z()["vsrg-key-pressed"]:""),style:{width:r,height:r},children:l.key})}):"line"===n?(0,i.jsx)("button",{className:Z()["vsrg-player-key-hitbox-line"],onPointerDown:c,onPointerUp:h,onPointerLeave:h,children:(0,i.jsx)("div",{className:"".concat(Z()["vsrg-player-key-line"]," ").concat(l.isPressed?Z()["vsrg-key-pressed"]:""),style:{height:"".concat(o,"px")}})}):null}var U=s(78810),Q=s(28682),J=s(40419),q=s(701),Y=s(7374),ee=s(6767),et=s.n(ee),es=s(57564),er=s(43531);es.Xd.LINE_SCALE_MODE=es.F4.NORMAL;class en{generate(){let{app:e}=this;e&&(this.generateTrackCache(e),this.generateTrailsCache(e),this.generateLinesCache(e))}getHitObjectCache(e){return this.textures.hitObjects[e]||this.textures.hitObjects["#FF0000"]}getHeldTrailCache(e){return this.textures.trails[e]||this.textures.trails["#FF0000"]}getHeldHitObjectCache(e){return this.textures.heldHitObjects[e]||this.textures.heldHitObjects["#FF0000"]}getLinesCache(e){return this.textures.lines[e]||this.textures.lines["#FF0000"]}generateTrailsCache(e){let{sizes:t,trackColors:s}=this,r=[...s,"#FF0000"],n=t.hitObjectSize,i=n/3;r.forEach(t=>{let s=new es.K3;s.beginFill(et()(t).rgbNumber()).drawRect(i/2,0,n-i,n);let r=e.renderer.generateTexture(s,{resolution:1,scaleMode:er.aH$.LINEAR,region:new er.AeJ(0,0,n,n)});this.textures.trails[t]=r,s.destroy(!0)}),this.textures.sizes.trail=n}generateLinesCache(e){let{sizes:t,trackColors:s}=this;[...s,"#FF0000"].forEach(s=>{let r=new es.K3;r.lineStyle(5,et()(s).rgbNumber()).moveTo(0,0).lineTo(t.width,0);let n=e.renderer.generateTexture(r,{resolution:2,scaleMode:er.aH$.LINEAR,region:new er.AeJ(0,0,t.width,5)});this.textures.lines[s]=n,r.destroy(!0)})}generateTrackCache(e){let{colors:t,sizes:s,trackColors:r}=this,n=s.hitObjectSize;[...r,"#FF0000"].forEach(s=>{let r=new es.K3,i=n/2;r.lineStyle(5,et()(s).rgbNumber()).beginFill(t.background_10[1]).drawCircle(i,i,i-5);let a=e.renderer.generateTexture(r,{resolution:2,scaleMode:er.aH$.LINEAR,region:new er.AeJ(0,0,n,n)});this.textures.hitObjects[s]=a,r.destroy(!0);let o=new es.K3,l=.7*n,c=(n-l)/2;o.lineStyle(5,et()(s).rgbNumber()).beginFill(t.background_10[1]).drawRoundedRect(c,c,l,l,6);let h=e.renderer.generateTexture(o,{resolution:2,scaleMode:er.aH$.LINEAR,region:new er.AeJ(0,0,n,n)});this.textures.heldHitObjects[s]=h,o.destroy(!0)}),this.textures.sizes.hitObject=n}constructor({app:e,colors:t,sizes:s,trackColors:r}){this.destroy=()=>{Object.values(this.textures.hitObjects).forEach(e=>null==e?void 0:e.destroy(!0)),Object.values(this.textures.heldHitObjects).forEach(e=>null==e?void 0:e.destroy(!0)),Object.values(this.textures.trails).forEach(e=>null==e?void 0:e.destroy(!0)),Object.values(this.textures.lines).forEach(e=>null==e?void 0:e.destroy(!0)),this.app=null},this.textures={hitObjects:{},heldHitObjects:{},trails:{},lines:{},sizes:{hitObject:0,trail:0}},this.trackColors=r,this.colors=t,this.sizes=s,this.app=e,this.generate()}}function ei(e){let{timestamp:t,renderableHitObjects:s,cache:r,sizes:o,offset:l}=e,c=o.scaling,h=o.hitObjectSize/2;return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(U.W2,{x:0,y:t*c+o.height-l,sortableChildren:!0,children:s.map((e,t)=>{let l=e.hitObject,d=l.index*o.keyWidth+o.keyWidth/2,u=-(l.timestamp*c);if((e.status===n.Hit||e.status===n.Missed)&&!l.isHeld)return null;let g=e.hitObject.index,m=g;for(let t of s)t!==e&&t.status!==n.Missed&&t.status!==n.Hit&&t.hitObject.timestamp===l.timestamp&&(t.hitObject.index<g&&(g=t.hitObject.index),t.hitObject.index>m&&(m=t.hitObject.index));return(0,i.jsxs)(a.Fragment,{children:[g!==m&&(0,i.jsx)(U.jy,{texture:r.getLinesCache(e.color),x:g*o.keyWidth+o.keyWidth/2,width:(m-g)*o.keyWidth,zIndex:-1,y:u-h}),l.isHeld?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(U.jy,{texture:r.getHeldTrailCache(e.color),anchor:O.$n,width:r.textures.sizes.trail,height:l.holdDuration*c,x:d,y:u-h}),(0,i.jsx)(U.jy,{texture:r.getHeldHitObjectCache(e.color),anchor:.5,angle:45,x:d,y:u-h}),(0,i.jsx)(U.jy,{texture:r.getHeldHitObjectCache(e.color),anchor:O.$n,x:d,y:u-l.holdDuration*c})]}):(0,i.jsx)(U.jy,{texture:r.getHitObjectCache(e.color),y:u,anchor:O.$n,x:d},e.hitObject.renderId)]},l.renderId)})})})}var ea=s(63615),eo=s.n(ea);let el=(0,a.memo)(function(e){let{time:t}=e,s=(0,a.useRef)(null);return(0,a.useEffect)(()=>{let e=s.current;e&&e.animate([{transform:"scale(1.4)"},{transform:"scale(1)"}],{duration:500,iterations:1})},[t]),(0,i.jsx)(i.Fragment,{children:(0,i.jsx)("div",{className:"".concat(eo()["vsrg-player-countdown"]," flex-centered"),ref:s,children:t})})},(e,t)=>e.time===t.time);var ec=s(11826),eh=s.n(ec);(r=n||(n={}))[r.Idle=0]="Idle",r[r.Pressed=1]="Pressed",r[r.Missed=2]="Missed",r[r.Hit=3]="Hit";class ed{constructor(e){this.color="#FFFFFF",this.status=0,this.instrumentIndex=0,this.heldScoreTimeout=0,this.hitObject=e}}let eu={el:{...O.n},rawWidth:0,rawHeight:0,width:0,height:0,keyWidth:0,hitObjectSize:0,scaling:0,verticalOffset:0};class eg extends a.Component{componentDidMount(){var e,t;this.throttledEventLoop.setCallback(this.handleTick),this.throttledEventLoop.start(),B.addKeyboardListener({callback:this.handleKeyboard,id:"vsrg-player-canvas"}),this.setState({devicePixelRatio:null!==(e=window.devicePixelRatio)&&void 0!==e?e:1.4}),this.toDispose.push(()=>B.removeKeyboardListener({id:"vsrg-player-canvas"})),this.toDispose.push((t=this.onSongPick,(0,A.N7)(B.currentSong,()=>{t(B.currentSong)}))),this.toDispose.push((0,b.B)(this.handleThemeChange)),B.addEventListener(this.handleVsrgEvent,"vsrg-player-canvas"),this.toDispose.push(()=>B.removeEventListener("vsrg-player-canvas")),window.addEventListener("resize",this.calculateSizes),this.toDispose.push(()=>window.removeEventListener("resize",this.calculateSizes)),this.calculateSizes()}componentWillUnmount(){this.throttledEventLoop.stop(),B.setLayout(Y.z5.getVsrgKeybinds(4)),this.toDispose.forEach(e=>e())}render(){let{sizes:e,cache:t,renderableHitObjects:s,timestamp:r,colors:n,devicePixelRatio:a}=this.state,{scrollSpeed:o}=this.props;return(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)("div",{className:"".concat(eh()["vsrg-player-canvas"]," box-shadow"),style:{backgroundColor:n.background_layer_10[0]},ref:this.wrapperRef,children:[r+o<0&&(0,i.jsx)(el,{time:Math.abs(Math.ceil((r+o)/1e3*2))+1}),(0,i.jsx)(U.Hf,{ref:this.stageRef,raf:!1,width:e.width,height:e.height,options:{backgroundAlpha:0,autoDensity:!1,resolution:a},onMount:this.calculateSizes,children:t&&(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(ei,{sizes:e,offset:e.verticalOffset,cache:t,renderableHitObjects:s,timestamp:r})})})]})})}constructor(e){super(e),this.toDispose=[],this.onSongPick=e=>{let{type:t,song:s}=e;B.resetScore();let{scrollSpeed:r}=this.props;"play"===t&&s&&this.setState({song:s,timestamp:-1500-r,renderableHitObjects:[]},()=>{s.startPlayback(0),this.calculateSizes(),this.generateAccuracyBounds()}),"stop"===t&&this.setState({song:new Q.Cz(""),timestamp:0,renderableHitObjects:[]})},this.handleVsrgEvent=e=>{"fpsChange"===e&&this.throttledEventLoop.changeMaxFps(this.props.maxFps)},this.handleKeyboard=(e,t)=>{let{renderableHitObjects:s,timestamp:r,accuracy:n}=this.state,i=s.find(t=>t.hitObject.index===e.index);if(i){if("down"===t){let e=(0,q.j$)(i.hitObject.timestamp,r,n),t=0===i.status;e&&t&&(i.hitObject.isHeld?i.status=1:i.status=3,this.props.playHitObject(i.hitObject,i.instrumentIndex),B.incrementScore(this.getHitRating(i.hitObject,r)))}"up"===t&&i.hitObject.isHeld&&((0,q.j$)(i.hitObject.timestamp+i.hitObject.holdDuration,r,n)?i.status=3:(i.status=2,B.incrementScore("miss")))}},this.calculateSizes=()=>{let e=this.wrapperRef.current;if(!e)return;let t=e.clientWidth,s=t/this.state.song.keys,r={width:t,height:e.clientHeight,rawWidth:t,rawHeight:e.clientHeight,el:e.getBoundingClientRect(),keyWidth:s,hitObjectSize:.6*s,scaling:e.clientHeight/this.props.scrollSpeed,verticalOffset:15},n=e.querySelector("canvas");n&&(n.style.width="".concat(r.width,"px"),n.style.height="".concat(r.height,"px")),this.props.onSizeChange(r),this.setState({sizes:r},this.generateCache)},this.generateCache=()=>{let{colors:e,sizes:t,cache:s}=this.state,r=new en({app:this.stageRef.current.app,colors:e,sizes:t,trackColors:this.state.song.tracks.map(e=>e.color)});this.setState({cache:r},()=>{setTimeout(()=>{null==s||s.destroy()},500)})},this.generateAccuracyBounds=()=>{let{song:e}=this.state;this.setState({accuracyBounds:e.getAccuracyBounds()})},this.getHitRating=(e,t)=>{let{accuracyBounds:s}=this.state,r=Math.abs(t-e.timestamp);return r<s[0]?"amazing":r<s[1]?"perfect":r<s[2]?"great":r<s[3]?"good":r<s[4]?"bad":"miss"},this.handleThemeChange=e=>{let t=e.get("primary"),s=e.getText("primary"),r=s.darken(.5).desaturate(1),n=e.layer("background",.18,.06),i=t.darken(.15),a=i.darken(.1),o=e.get("secondary"),l=e.get("accent");this.setState({colors:{background_plain:[t.hex(),t.rgbNumber()],background_layer_10:[n.hex(),n.rgbNumber()],background:[i.hex(),i.rgbNumber()],background_10:[a.hex(),a.rgbNumber()],secondary:[o.hex(),o.rgbNumber()],lineColor:[s.hex(),s.rgbNumber()],lineColor_10:[r.hex(),r.rgbNumber()],accent:[l.hex(),l.rgbNumber()]}},this.generateCache)},this.handleTick=(e,t)=>{let{isPlaying:s,scrollSpeed:r}=this.props,{song:n,renderableHitObjects:i,sizes:a}=this.state;if(!s)return;let o=this.state.timestamp+t,l=n.tickPlayback(o+r+a.height).map((e,t)=>e.map(e=>{let s=new ed(e);return s.instrumentIndex=t,s.color=n.tracks[t].color,s})).flat();this.validateHitObjects(o,i.concat(l),this.state.timestamp),this.props.onTick(o)},this.validateHitObjects=(e,t,s)=>{let{accuracy:r}=this.state,n=B.keyboard;for(let i=0;i<t.length;i++){let a=t[i],o=n[a.hitObject.index];if(!o)continue;let l=0===a.status;if(!o.isPressed&&l&&a.hitObject.timestamp<e-r){a.status=2,B.incrementScore("miss");continue}if(o.isPressed&&1===a.status){let t=a.hitObject.timestamp+a.hitObject.holdDuration<e-r;a.heldScoreTimeout-=e-s,t?(a.status=2,B.incrementScore("miss")):a.heldScoreTimeout<=0&&(a.heldScoreTimeout=300,B.incrementScore("perfect"));continue}}let i=t.filter(t=>t.hitObject.timestamp+t.hitObject.holdDuration>e-r);this.setState({timestamp:e,renderableHitObjects:i})},this.state={song:new Q.Cz(""),timestamp:0,devicePixelRatio:1.4,accuracy:150,sizes:eu,colors:{background_plain:["#000000",1],background_layer_10:["#000000",1],background:["#000000",1],background_10:["#000000",1],secondary:["#000000",1],lineColor:["#000000",1],lineColor_10:["#000000",1],accent:["#000000",1]},accuracyBounds:[0,0,0,0,0],cache:null,renderableHitObjects:[]},this.throttledEventLoop=new J.v(()=>{},this.props.maxFps),this.wrapperRef=(0,a.createRef)(),this.stageRef=(0,a.createRef)()}}var em=s(23935),ep=s(12120),ey=s(40208),ev=s(77069),ex=s.n(ev);let eb=(0,a.memo)(function(){let e=function(){let[e,t]=(0,a.useState)(B.score);return(0,a.useEffect)(()=>(0,A.N7)(B.score,()=>{t({...B.score})}),[]),e}(),{t}=(0,z.$G)("vsrg_player");return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",{className:ex()["vsrg-player-score"],children:(0,i.jsx)("div",{className:"column space-between",children:(0,i.jsx)("div",{children:e.score})})}),e.scoreVisible&&(0,i.jsxs)("div",{className:"".concat(ex()["vsrg-final-score"]," box-shadow"),children:[(0,i.jsx)(ef,{text:t("amazing"),number:e.amazing,color:O.fA.amazing,gridArea:"a"}),(0,i.jsx)(ef,{text:t("perfect"),number:e.perfect,color:O.fA.perfect,gridArea:"b"}),(0,i.jsx)(ef,{text:t("great"),number:e.great,color:O.fA.great,gridArea:"c"}),(0,i.jsx)(ef,{text:t("good"),number:e.good,color:O.fA.good,gridArea:"d"}),(0,i.jsx)(ef,{text:t("miss"),number:e.miss,color:O.fA.miss,gridArea:"e"}),(0,i.jsxs)("div",{className:"row space-between",style:{width:"100%",alignItems:"center",gridArea:"f"},children:[(0,i.jsxs)("div",{style:{fontSize:"1.2rem"},children:[t("combo"),": ",e.combo,"x"]}),(0,i.jsx)("div",{className:"flex",style:{fontSize:"1.2rem",alignItems:"center"},children:e.score})]})]})]})},(e,t)=>!1);function ef(e){let{text:t,color:s,number:r,gridArea:n}=e;return(0,i.jsxs)("div",{className:"".concat(ex()["floating-score-element"]," row"),style:{gridArea:n},children:[(0,i.jsx)("span",{style:{color:s},children:t}),(0,i.jsx)("span",{children:r})]})}var ej=s(15571),ek=s.n(ej);function eS(e){let{song:t,onStopSong:s,onRetrySong:r}=e;return t?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",{className:ek()["vsrg-player-right"],children:(0,i.jsxs)("div",{className:"row space-between",style:{gap:"0.2rem"},children:[(0,i.jsx)(ey.h,{onClick:s,children:(0,i.jsx)(m.c,{icon:k.JuG})}),(0,i.jsx)(ey.h,{onClick:r,children:(0,i.jsx)(m.c,{icon:k.dnK})})]})}),(0,i.jsx)(eb,{})]}):null}let e_={transform:"rotate(0) scale(1)",color:"var(--primary-text)"},ew=(0,a.memo)(function(){let{t:e,i18n:t}=(0,z.$G)("vsrg_player"),[s,r]=(0,a.useState)(B.score.lastScore),n=(0,a.useRef)(null),[o,l]=(0,a.useState)(e_),c=(0,a.useMemo)(()=>({perfect:e("perfect"),amazing:e("amazing"),great:e("great"),good:e("good"),bad:e("bad"),miss:e("miss")}),[e,t.language]);return(0,a.useEffect)(()=>{var e;let t=0,s=(e=e=>{r(e),clearTimeout(t),t=setTimeout(()=>{r({...e,type:""})},800)},(0,A.N7)(B.score,()=>{e({...B.score.lastScore})}));return()=>{s(),clearTimeout(t)}},[]),(0,a.useEffect)(()=>{let e=n.current;if(!e)return;let t=Math.floor(25*Math.random()-12.5);e.animate([o,{transform:"rotate(".concat(t,"deg) scale(1.3)"),color:O.fA[s.type]},{transform:"rotate(0) scale(1)",color:O.fA[s.type]}],{duration:150,easing:"ease-out"}),l({transform:"rotate(".concat(t,"deg)"),color:O.fA[s.type]})},[s]),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",{ref:n,style:o,className:ex()["vsrg-floating-score"],children:s.type&&c[s.type]}),(0,i.jsx)("div",{className:ex()["vsrg-floating-combo"],children:s.combo>0&&"".concat(s.combo,"x")})]})},(e,t)=>!1);var eN=s(23441),eC=s(47103),eO=s(35253),eP=s.n(eO),eF=s(19116);class ez extends a.Component{componentDidMount(){this.setState({settings:V.j.getVsrgPlayerSettings()}),B.setLayout(this.state.currentLayout);let e=(0,Y.JZ)("vsrg_player","vsrg_player",e=>{let{shortcut:t}=e,{name:s}=t;"restart"===s&&this.onRetrySong(),"stop"===s&&this.onStopSong()});this.cleanup.push(e)}componentWillUnmount(){let{songAudioPlayer:e,keyboardAudioPlayer:t}=this.state;e.destroy(),t.destroy(),B.resetScore(),N.kg.hidePill(),this.cleanup.forEach(e=>e())}render(){let{canvasSizes:e,settings:t}=this.state;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(eN.d,{text:T.WV.t("home:vsrg_player_name"),description:"Play or practice VSRG songs"}),(0,i.jsx)(H,{settings:t,onSettingsUpdate:this.handleSettingChange,onSongSelect:this.onSongSelect}),(0,i.jsxs)("div",{className:"".concat(eP()["vsrg-player-page"]," appear-on-mount"),children:[(0,i.jsxs)("div",{className:eP()["vsrg-player-grid"],children:[(0,i.jsx)(eg,{keyboardLayout:t.keyboardLayout.value,onTick:this.handleTick,maxFps:t.maxFps.value,scrollSpeed:t.approachTime.value,onSizeChange:this.onSizeChange,playHitObject:this.playHitObject,isPlaying:this.state.isPlaying}),(0,i.jsx)(G,{keyboardLayout:t.keyboardLayout.value,offset:e.verticalOffset,hitObjectSize:e.hitObjectSize,verticalOffset:t.verticalOffset.value,horizontalOffset:t.horizontalOffset.value})]}),(0,i.jsx)(eS,{song:this.state.song,onStopSong:this.onStopSong,onRetrySong:this.onRetrySong}),(0,i.jsx)(ew,{})]})]})}constructor(e){super(e),this.lastTimestamp=0,this.cleanup=[],this.onSongSelect=async(e,t)=>{let{songAudioPlayer:s,keyboardAudioPlayer:r}=this.state,n=await w.k.getSongById(e.audioSongId);if(N.kg.showPill(T.WV.t("logs:loading_instruments")),n){let e=j.v.parseSong(n);if(s.basePitch=e.pitch,e instanceof em.M&&(this.setState({audioSong:e}),await s.syncInstruments(e.instruments)),e instanceof ep.l){let t=e.toRecordedSong(0);this.setState({audioSong:t}),await s.syncInstruments(t.instruments)}}else this.setState({audioSong:null});await r.syncInstruments(e.tracks.map(e=>e.instrument)),N.kg.hidePill(),this.setState({song:e,songDuration:e.getHighestNoteTime(),isPlaying:!0},()=>{"play"===t&&(B.setLayout(Y.z5.getVsrgKeybinds(e.keys)),B.playSong(e))})},this.handleSettingChange=e=>{let{settings:t}=this.state,{data:s}=e;t[e.key]={...t[e.key],value:s.value},this.setState({settings:{...t}},()=>{this.updateSettings(),"maxFps"===e.key&&B.emitEvent("fpsChange")})},this.updateSettings=e=>{V.j.updateVsrgPlayerSettings(void 0!==e?e:this.state.settings)},this.onSizeChange=e=>{this.setState({canvasSizes:e})},this.onStopSong=()=>{this.setState({isPlaying:!1,song:null},()=>{B.stopSong()})},this.onRetrySong=()=>{let{song:e}=this.state;e&&this.onSongSelect(e,"play")},this.handleTick=e=>{let{audioSong:t,songAudioPlayer:s,songDuration:r,song:n,settings:i}=this.state;this.lastTimestamp=e,n&&(this.lastTimestamp>=r+2e3&&(this.setState({isPlaying:!1}),B.showScore()),this.lastTimestamp>=n.duration||e<0||!t||t.tickPlayback(e+i.offset.value).forEach(e=>{e.layer.toArray().forEach((t,r)=>{0===t||n.trackModifiers[r].muted||s.playNoteOfInstrument(r,e.index)})}))},this.playHitObject=(e,t)=>{let{keyboardAudioPlayer:s}=this.state;s&&e.notes.forEach(e=>{s.playNoteOfInstrument(t,e)})},this.state={song:null,songDuration:0,audioSong:null,settings:V.j.getDefaultVsrgPlayerSettings(),canvasSizes:eu,songAudioPlayer:new R.z("C"),keyboardAudioPlayer:new R.z("C"),currentLayout:Y.z5.getVsrgKeybinds(4),isPlaying:!1}}}function eT(){return(0,eF.o)("vsrgPlayer"),(0,i.jsx)(ez,{})}eT.getLayout=function(e){return(0,i.jsx)(eC.Z,{page:"Main",children:e})}},21558:function(e){e.exports={separator:"separator_separator__0BMUz","separator-content":"separator_separator-content__VZtha","separator-part":"separator_separator-part__kAyrM"}},11826:function(e){e.exports={"vsrg-player-canvas":"VsrgPlayerCanvas_vsrg-player-canvas__FD0Ow"}},63615:function(e){e.exports={"vsrg-player-countdown":"VsrgPlayerCountdown_vsrg-player-countdown__JZ_yN"}},79613:function(e){e.exports={"vsrg-player-keyboard-circles":"VsrgPlayerKeyboard_vsrg-player-keyboard-circles__4z_Qj","vsrg-player-keyboard-control-left":"VsrgPlayerKeyboard_vsrg-player-keyboard-control-left__UjU4z","vsrg-player-keyboard-control-right":"VsrgPlayerKeyboard_vsrg-player-keyboard-control-right__Yr1TA","vsrg-player-key-circle":"VsrgPlayerKeyboard_vsrg-player-key-circle__lQmE_","vsrg-player-key-hitbox-circle":"VsrgPlayerKeyboard_vsrg-player-key-hitbox-circle__2QO9H","vsrg-player-key-hitbox-line":"VsrgPlayerKeyboard_vsrg-player-key-hitbox-line__jIQ3o","vsrg-player-key-line":"VsrgPlayerKeyboard_vsrg-player-key-line__N6vdc","vsrg-key-pressed":"VsrgPlayerKeyboard_vsrg-key-pressed__45fBC"}},15571:function(e){e.exports={"vsrg-player-right":"VsrgPlayerRight_vsrg-player-right__yP0cz"}},77069:function(e){e.exports={"vsrg-player-score":"VsrgPlayerScore_vsrg-player-score__VsqXu","vsrg-final-score":"VsrgPlayerScore_vsrg-final-score__FhlBZ",fadeIn:"VsrgPlayerScore_fadeIn__HmC_d","floating-score-element":"VsrgPlayerScore_floating-score-element__fsjPq","vsrg-floating-score":"VsrgPlayerScore_vsrg-floating-score__8jNPH","vsrg-floating-combo":"VsrgPlayerScore_vsrg-floating-combo__EESPi"}},48771:function(e){e.exports={"switch-wrapper":"Switch_switch-wrapper__QbqdS","switch-inner":"Switch_switch-inner__2FN4t","switch-inner-on":"Switch_switch-inner-on__dXyKj"}},21820:function(e){e.exports={"instrument-picker":"Settings_instrument-picker__7I4Rw",select:"Settings_select__TfGwk","settings-group-title":"Settings_settings-group-title__ZP9Kk","settings-row":"Settings_settings-row__QAhCZ",invalid:"Settings_invalid__xvU6D","settings-input":"Settings_settings-input__TWACI","settings-input-button":"Settings_settings-input-button__AnhLi"}},35253:function(e){e.exports={"vsrg-player-page":"VsrgPlayer_vsrg-player-page__PL_xV","vsrg-player-grid":"VsrgPlayer_vsrg-player-grid__uLqQ_"}}},function(e){e.O(0,[9569,584,2888,9774,179],function(){return e(e.s=89406)}),_N_E=e.O()}]);