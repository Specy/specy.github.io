(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9391],{66611:function(e,t,n){"use strict";n.d(t,{Z:function(){return s}});class r{static getDescendantProperty(e,t,n=[]){let s,i,o,a,l,c;if(t){if(-1===(o=t.indexOf("."))?s=t:(s=t.slice(0,o),i=t.slice(o+1)),null!=(a=e[s])){if(i||"string"!=typeof a&&"number"!=typeof a){if("[object Array]"===Object.prototype.toString.call(a))for(l=0,c=a.length;l<c;l++)r.getDescendantProperty(a[l],i,n);else i&&r.getDescendantProperty(a,i,n)}else n.push(a)}}else n.push(e);return n}}class s{constructor(e=[],t=[],n={}){Array.isArray(t)||(n=t,t=[]),this.haystack=e,this.keys=t,this.options=Object.assign({caseSensitive:!1,sort:!1},n)}search(e=""){if(""===e)return this.haystack;let t=[];for(let n=0;n<this.haystack.length;n++){let i=this.haystack[n];if(0===this.keys.length){let n=s.isMatch(i,e,this.options.caseSensitive);n&&t.push({item:i,score:n})}else for(let n=0;n<this.keys.length;n++){let o=r.getDescendantProperty(i,this.keys[n]),a=!1;for(let n=0;n<o.length;n++){let r=s.isMatch(o[n],e,this.options.caseSensitive);if(r){a=!0,t.push({item:i,score:r});break}}if(a)break}}return this.options.sort&&t.sort((e,t)=>e.score-t.score),t.map(e=>e.item)}static isMatch(e,t,n){e=String(e),t=String(t),n||(e=e.toLocaleLowerCase(),t=t.toLocaleLowerCase());let r=s.nearestIndexesFor(e,t);return!!r&&(e===t?1:r.length>1?2+(r[r.length-1]-r[0]):2+r[0])}static nearestIndexesFor(e,t){let n=t.split(""),r=[];return s.indexesOfFirstLetter(e,t).forEach((t,s)=>{let i=t+1;r[s]=[t];for(let t=1;t<n.length;t++){let o=n[t];if(-1===(i=e.indexOf(o,i))){r[s]=!1;break}r[s].push(i),i++}}),!!(r=r.filter(e=>!1!==e)).length&&r.sort((e,t)=>1===e.length?e[0]-t[0]:(e=e[e.length-1]-e[0])-(t=t[t.length-1]-t[0]))[0]}static indexesOfFirstLetter(e,t){let n=t[0];return e.split("").map((e,t)=>e===n&&t).filter(e=>!1!==e)}}},95891:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/sheet-visualizer",function(){return n(59050)}])},19502:function(e,t,n){"use strict";n.d(t,{P:function(){return l}});var r=n(85893),s=n(92634),i=n(21820),o=n.n(i),a=n(67294);function l(e){let{onChange:t,value:n,children:i,style:l}=e,[c]=(0,s.F)(),u=(0,a.useCallback)(e=>{t(e),e.target.blur()},[t]);return(0,r.jsx)("select",{onChange:u,value:n,className:o().select,style:{backgroundImage:"url(\"data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' height='24' viewBox='0 0 24 24' width='24' fill='".concat(c.getText("primary").hex().replace("#","%23"),"'><path d='M0 0h24v24H0z' fill='none'/><path d='M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z'/></svg>\")"),...l},children:i})}},13042:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});var r=n(85893),s=n(92634),i=n(48771),o=n.n(i);function a(e){let{checked:t,onChange:n,styleOuter:i}=e,[a]=(0,s.F)();return(0,r.jsx)("button",{className:o()["switch-wrapper"],onClick:()=>n(!t),style:i||{},"aria-label":t?"Switch to off":"Switch to on",children:(0,r.jsx)("div",{className:"".concat(o()["switch-inner"]," ").concat(t?o()["switch-inner-on"]:""),style:{backgroundColor:(t?a.get("accent"):a.layer("primary",.4)).toString()}})})}},20027:function(e,t,n){"use strict";n.d(t,{G:function(){return c},f:function(){return l}});var r=n(85893),s=n(40456),i=n.n(s),o=n(39324),a=n(69887);function l(e){let{children:t,className:n,style:s}=e,{open:l,visible:c}=(0,a.X)();return(0,r.jsx)("div",{className:(0,o.cn)("".concat(i()["side-menu"]," ").concat(n),[l&&c,i()["side-menu-open"]]),style:s,children:t})}function c(e){let{title:t,children:n,id:s}=e,{current:l}=(0,a.X)();return(0,r.jsxs)("div",{className:(0,o.cn)(i()["menu-panel"],[l===s,i()["menu-panel-visible"]]),children:[t&&(0,r.jsx)("div",{className:i()["menu-title"],children:t}),(0,r.jsx)("div",{className:i()["panel-content-wrapper"],children:n})]})}},59050:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return q}});var r=n(85893),s=n(67294),i=n(17544),o=n(39324),a=n(13042),l=n(33297),c=n(48043),u=n(53179),h=n(17678),m=n(24104),d=n(9827),p=n(54135),g=n(78773),f=n(40569),_=n(20027),v=n(12293),x=n(85565),k=n(11163),w=n(99962),y=n(67421);function j(e){let{currentSong:t,onSongLoaded:n,className:i,style:o}=e,{t:a}=(0,y.$G)("menu"),[l]=(0,m.n)(),c=(0,k.useRouter)(),[u,x]=(0,s.useState)(""),[j,b]=(0,s.useState)(!1),S=(0,v.ZP)(()=>{b(!1)},{ignoreFocusable:!0,active:""!==u});return(0,r.jsxs)(w.q,{ref:S,open:j,setOpen:b,className:i,style:o,current:u,setCurrent:x,children:[(0,r.jsxs)(w.V,{style:{justifyContent:"flex-end"},children:[d.b.hasNavigated&&!j&&(0,r.jsx)(p.j,{ariaLabel:a("go_back"),style:{marginBottom:"auto"},onClick:()=>{c.back()},children:(0,r.jsx)(g.x_l,{className:"icon"})}),j&&(0,r.jsx)(p.j,{ariaLabel:a("close_menu"),style:{marginBottom:"auto"},onClick:()=>b(!1),children:(0,r.jsx)(g.aHS,{className:"icon"})}),(0,r.jsx)(p.s,{id:"Songs",ariaLabel:a("song_menu"),children:(0,r.jsx)(g.HcQ,{className:"icon"})}),(0,r.jsx)(p.j,{onClick:f.I.open,ariaLabel:a("open_home_menu"),style:{border:"solid 0.1rem var(--secondary)"},children:(0,r.jsx)(g.xng,{className:"icon"})})]}),(0,r.jsx)(_.f,{children:(0,r.jsx)(_.G,{id:"Songs",children:(0,r.jsx)(h.G,{songs:l,className:"noprint",exclude:["vsrg"],SongComponent:C,componentProps:{current:t,onClick:n}})})})]})}function C(e){let{data:t,current:n,onClick:s}=e,{t:i}=(0,y.$G)("logs"),o=(null==n?void 0:n.id)===t.id?{backgroundColor:"rgb(124, 116, 106)"}:{};return(0,r.jsx)("div",{className:"song-row",style:{...o,padding:"0.5rem 0.8rem"},onClick:async()=>{u.kg.showPill(i("loading_song"));let e=await x.v.getOneSerializedFromStorable(t);if(!e)return u.kg.error(i("could_not_load_song"));s(e),setTimeout(()=>u.kg.hidePill(),300)},children:(0,r.jsx)("div",{className:"song-name",children:t.name})})}var b=n(23441),S=n(2816),N=n(92634),z=n(19502),T=n(58899),F=n.n(T),L=n(83679),P=n(21215),I=n.n(P);function M(e){return 0===e?"transparent":"var(--tempo-changer-".concat(e,")")}let R=new L.Yx,A=(0,s.memo)(function(e){let{chunk:t,rows:n,hasText:o,theme:a,keyboardLayout:l}=e,c="Genshin"===i.iC?7:5,[u,h]=(0,s.useState)("var(--primary)");return(0,s.useEffect)(()=>{h(a.layer("primary",.2).toString())},[a]),(0,r.jsx)(r.Fragment,{children:t.columns.map((e,s)=>{var i;let a=Array(c*n).fill(!1);return e.notes.forEach(e=>{a[e.note]=!0}),(0,r.jsx)("div",{className:I()["frame-outer-background"],style:{background:t.columns.length-1===s&&t.endingTempoChanger!==t.tempoChanger?"linear-gradient(to right, ".concat(M(t.tempoChanger)," 50%, ").concat(M(t.endingTempoChanger)," 50%)"):M(t.tempoChanger),...(i=t.columns.length,0===s?{borderTopLeftRadius:"0.5rem",borderBottomLeftRadius:"0.5rem"}:s===i-1?{borderTopRightRadius:"0.5rem",borderBottomRightRadius:"0.5rem"}:{})},children:(0,r.jsx)("div",{className:"".concat(I()["frame-outer"]," ").concat(0===e.notes.length?I()["visualizer-ball"]:""),children:0===e.notes.length?(0,r.jsx)("div",{}):(0,r.jsx)("div",{className:I()["visualizer-frame"],style:{gridTemplateColumns:"repeat(".concat(c,",1fr)")},children:a.map((e,t)=>(0,r.jsx)("div",{className:e?I()["frame-note-s"]:I()["frame-note-ns"],style:e?{}:{backgroundColor:u},children:e&&o?R.getNoteText(t,l,"C"):null},t))})})},s)})})},(e,t)=>e.chunk===t.chunk&&e.rows===t.rows&&e.hasText===t.hasText&&e.theme===t.theme);var E=n(12120),G=n(23935),O=n(61748);let V={joined:50,pause:400},Z=new L.Yx;class X{static from(e,t){let n=new X((e=e.clone()).bpm);if(e instanceof G.M){let t=e.notes.shift();if(!t)return n;let i=[t],o=t.time;for(let t of e.notes){var r,s;if(t.time-(null!==(s=null===(r=i[0])||void 0===r?void 0:r.time)&&void 0!==s?s:0)<=V.joined)i.push(t);else{let e=t.time-o,r=new Y(0,[Q.from(i.splice(0,i.length))]);n.addChunk(r,e),i.push(t)}o=t.time}let a=e.notes[e.notes.length-1].time-o,l=new Y(0,[Q.from(i)]);n.addChunk(l,a),n.chunks=n.chunks.map(e=>(0===e.columns.length&&e.columns.push(new Q([])),e))}else if(e instanceof E.l){let t=e.columns,r=t[0];if(!r)return n;let s=[],i=r.tempoChanger;for(let e of t){if(0===i&&0===e.tempoChanger)n.addChunk(Y.from([e]),0);else if(i>e.tempoChanger){s.push(e);let t=Y.from(s.splice(0,s.length));t.endingTempoChanger=e.tempoChanger,n.addChunk(t,0)}else i<e.tempoChanger&&(0===i||n.addChunk(Y.from(s.splice(0,s.length)),0)),s.push(e);i=e.tempoChanger}s.length&&n.addChunk(Y.from(s.splice(0,s.length)),0);let o=-1;for(let e=0;e<n.chunks.length;e++)n.chunks[e].columns.some(e=>e.notes.length>0)&&(-1===o&&(n.chunks.splice(0,e),e=0),o=e);n.chunks.splice(o+1)}else console.error("Song type not supported");if(t){let e=0,t=[];for(let r of n.chunks)if(r.columns.every(e=>0===e.notes.length))e++;else{let n=t[t.length-1];n&&(n.emptyAhead=e,e=0),t.push(r)}n.chunks=t}return n}toText(e){let t=this.chunks.map(t=>t.toText(e)),n=[],r=0;for(let e of t)if(""===e)r++;else{if(r){let e=Math.round(6e4/(r*this.bpm)/V.pause);e<=2?n.push(Array.from({length:e},()=>"-").join(" ")):n.push("\n\n".repeat(Math.round(e/2))),r=0}n.push(e)}return n.join(" ").trim()}addChunk(e,t){let n=Array.from({length:Math.floor(t/V.pause)},()=>new Y(0,[]));this.chunks.push(e,...n)}constructor(e){this.chunks=[],this.bpm=e}}class B{static from(e){return new B(e.index)}toText(e){return"".concat(function(e,t){let n=Z.getNoteText(e,t,"C");return"Genshin"===i.iC?n.toLowerCase():n.toUpperCase()}(this.note,e))}constructor(e){this.note=e}}let D=new Map([[0,["",""]],[1,["(",")"]],[2,["[","]"]],[3,["{","}"]]]);class Q{static from(e){return new Q(e instanceof O.dF?e.notes.map(e=>B.from(e)):e.map(e=>B.from(e)))}toText(e){return this.notes.map(t=>t.toText(e)).join("")}constructor(e){this.notes=e}}class Y{static from(e,t){var n;return void 0===(t=null!=t?t:null===(n=e[0])||void 0===n?void 0:n.tempoChanger)&&console.log("tempoChanger is undefined",e,t),new Y(null!=t?t:0,e.map(e=>Q.from(e)))}toText(e){var t;let[n,r]=null!==(t=D.get(this.tempoChanger))&&void 0!==t?t:["",""],s=this.columns.map(t=>t.toText(e)).join(" ").trim();return s?"".concat(n).concat(s).concat(r):""}constructor(e,t){this.tempoChanger=e,this.endingTempoChanger=e,this.columns=t}}var H=n(11090),U=n(82860),$=n(19116);function q(){(0,$.o)("sheetVisualizer");let{t:e}=(0,y.$G)(["sheet_visualizer","home"]),[t]=(0,N.F)(),[n,h]=(0,s.useState)(null),[m,d]=(0,s.useState)(7),[p,g]=(0,s.useState)(null),[f,_]=(0,s.useState)(!1),[v,k]=(0,s.useState)(""),[w,C]=(0,s.useState)(!1),[T,L]=(0,s.useState)("Genshin"===i.iC?"Keyboard layout":"ABC"),P=(0,s.useRef)(null);function I(e){var t;if(!P.current)return;let n=m+e,r=null===(t=P.current.children[0])||void 0===t?void 0:t.children[0];r&&!(n<1)&&(r.getBoundingClientRect().width<50&&1===e||d(n))}let M=(0,s.useCallback)((t,n)=>{try{let r=x.v.parseSong(t);if(!(0,o.$9)(r))return u.kg.error(e("invalid_song_to_visualize"));try{let e=X.from(r,w);h(e),k(e.toText(n))}catch(t){console.error(t),u.kg.error(e("error_converting_to_visual_song_try_convert_in_recorded"));try{let e=X.from(r.toRecordedSong(),w);h(e),k(e.toText(n))}catch(t){console.error(t),u.kg.error(e("error_converting_to_visual_song")),h(null),k("")}}}catch(t){console.error(t),u.kg.error(e("error_converting_to_visual_song"))}l.Z.songEvent({type:"visualize"})},[w,e]);return(0,s.useEffect)(()=>{p&&M(p,T)},[p,f,T,M,w]),(0,r.jsxs)(S.k,{excludeMenu:!0,className:F()["page-no-print"],menu:(0,r.jsx)(j,{className:F()["no-print"],onSongLoaded:g,currentSong:p}),children:[(0,r.jsx)(b.d,{text:"".concat(e("home:sheet_visualizer_name")).concat(p?" - ".concat(p.name):""),description:"Learn a sheet in a visual way, convert the song into text format or print it as pdf"}),(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",flexDirection:"column"},children:[(0,r.jsxs)("div",{className:"".concat(F()["visualizer-buttons-wrapper"]," noprint"),children:[(0,r.jsxs)(U.s,{gap:"0.5rem",children:[(0,r.jsxs)(H.X,{align:"center",gap:"0.5rem",children:[(0,r.jsx)("div",{children:e("note_names")}),(0,r.jsx)(a.Z,{checked:f,onChange:_}),f&&(0,r.jsx)(z.P,{value:T,onChange:e=>L(e.target.value),children:i.HI.map(e=>(0,r.jsx)("option",{value:e,children:e},e))})]}),(0,r.jsxs)(H.X,{align:"center",gap:"0.5rem",children:[(0,r.jsx)("div",{children:e("merge_empty_spaces")}),(0,r.jsx)(a.Z,{checked:w,onChange:C})]})]}),(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[e("per_row"),": ",m,(0,r.jsx)("button",{className:F()["visualizer-plus-minus"],onClick:()=>I(-1),children:"-"}),(0,r.jsx)("button",{className:F()["visualizer-plus-minus"],onClick:()=>I(1),children:"+"})]})]}),(0,r.jsxs)("h1",{className:"onprint",style:{color:"black"},children:[i.iC," Music Nightly"]}),(0,r.jsx)("h1",{className:"onprint",style:{color:"black"},children:p?null==p?void 0:p.name:""}),(0,r.jsxs)("div",{style:{width:"100%"},className:"noprint",children:[(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,r.jsx)("h2",{className:"text-ellipsis",children:p?p.name:e("no_song_selected")}),p&&(0,r.jsx)(c.J,{onClick:()=>window.print(),style:{minWidth:"fit-content",marginLeft:"0.4rem"},children:e("print_as_pdf")})]}),(0,r.jsx)("div",{style:{color:"var(--background-text)"},children:e("sheet_visualizer_instructions")})]}),(0,r.jsx)("div",{className:F()["visualizer-frame-wrapper"],style:{gridTemplateColumns:"repeat(".concat(m,",1fr)")},ref:P,children:n&&n.chunks.map((e,n)=>(0,r.jsx)(A,{chunk:e,rows:3,theme:t,hasText:f,keyboardLayout:T},n))}),v.trim().length>0&&(0,r.jsx)("pre",{className:F()["text-notation-wrapper"],children:v})]})]})}},21215:function(e){e.exports={"visualizer-frame":"SheetFrame_visualizer-frame__OgoI2","frame-outer-background":"SheetFrame_frame-outer-background__eTaQg","frame-empty-counter":"SheetFrame_frame-empty-counter__IGMkV","frame-outer":"SheetFrame_frame-outer__tYUb8","frame-outer-smaller":"SheetFrame_frame-outer-smaller__5isiu","frame-note-s":"SheetFrame_frame-note-s__YP_tv","frame-note-ns":"SheetFrame_frame-note-ns__0nRmI","visualizer-ball":"SheetFrame_visualizer-ball__6qDw0"}},48771:function(e){e.exports={"switch-wrapper":"Switch_switch-wrapper__QbqdS","switch-inner":"Switch_switch-inner__2FN4t","switch-inner-on":"Switch_switch-inner-on__dXyKj"}},21820:function(e){e.exports={"instrument-picker":"Settings_instrument-picker__7I4Rw",select:"Settings_select__TfGwk","settings-group-title":"Settings_settings-group-title__ZP9Kk","settings-row":"Settings_settings-row__QAhCZ",invalid:"Settings_invalid__xvU6D","settings-input":"Settings_settings-input__TWACI","settings-input-button":"Settings_settings-input-button__AnhLi"}},58899:function(e){e.exports={"visualizer-plus-minus":"SheetVisualizer_visualizer-plus-minus__hbX5w","visualizer-buttons-wrapper":"SheetVisualizer_visualizer-buttons-wrapper__bdwQ7","visualizer-frame-wrapper":"SheetVisualizer_visualizer-frame-wrapper__ocN0J","text-notation-wrapper":"SheetVisualizer_text-notation-wrapper__F5ljw","page-no-print":"SheetVisualizer_page-no-print__ECZzT","no-print":"SheetVisualizer_no-print__U07Ys"}}},function(e){e.O(0,[5598,2888,9774,179],function(){return e(e.s=95891)}),_N_E=e.O()}]);