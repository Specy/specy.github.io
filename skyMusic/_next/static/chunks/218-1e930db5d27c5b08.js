"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[218],{5736:function(e,t,n){n.d(t,{O:function(){return p}});var s=n(2253),r=n(5893),i=n(2169),o=n(7600),a=n.n(o),l=[],c=[],u=!0,d=!1,h=void 0;try{for(var m,g=i.BX[Symbol.iterator]();!(u=(m=g.next()).done);u=!0){var f=m.value;f.startsWith("SFX")?c.push(f):l.push(f)}}catch(e){d=!0,h=e}finally{try{u||null==g.return||g.return()}finally{if(d)throw h}}function p(e){var t=e.selected,n=e.onChange,i=e.style;return(0,r.jsx)("select",{className:a().select,style:(0,s._)({width:"100%",padding:"0.3rem"},i),onChange:function(e){n(e.target.value),e.target.blur()},value:t,children:0===c.length?(0,r.jsx)(r.Fragment,{children:l.map(function(e){return(0,r.jsx)("option",{value:e,children:e.replace("-"," ")},e)})}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("optgroup",{label:"Instruments",children:l.map(function(e){return(0,r.jsx)("option",{value:e,children:e.replace("-"," ")},e)})}),(0,r.jsx)("optgroup",{label:"SFX",children:c.map(function(e){return(0,r.jsx)("option",{value:e,children:e.replace("-"," ").replace("SFX_","")},e)})})]})})}},6912:function(e,t,n){n.d(t,{x:function(){return l}});var s=n(2253),r=n(5893),i=n(2169),o=n(7600),a=n.n(o);function l(e){var t=e.selected,n=e.onChange,o=e.style,l=e.children,c=e.className;return(0,r.jsxs)("select",{className:"".concat(a().select," ").concat(null!=c?c:""),style:(0,s._)({width:"100%",padding:"0.3rem"},o),onChange:function(e){n(e.target.value),e.target.blur()},value:t,children:[l,i.T_.map(function(e){return(0,r.jsx)("option",{children:e},e)})]})}},1709:function(e,t,n){n.d(t,{P:function(){return u}});var s=n(2253),r=n(1309),i=n(5893),o=n(5055),a=n(7600),l=n.n(a),c=n(7294);function u(e){var t=e.onChange,n=e.value,a=e.children,u=e.style,d=(0,r._)((0,o.F)(),1)[0],h=(0,c.useCallback)(function(e){t(e),e.target.blur()},[t]);return(0,i.jsx)("select",{onChange:h,value:n,className:l().select,style:(0,s._)({backgroundImage:"url(\"data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' height='24' viewBox='0 0 24 24' width='24' fill='".concat(d.getText("primary").hex().replace("#","%23"),"'><path d='M0 0h24v24H0z' fill='none'/><path d='M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z'/></svg>\")")},u),children:a})}},218:function(e,t,n){n.r(t),n.d(t,{default:function(){return e2}});var s=n(2678),r=n(1010),i=n(8564),o=n(2267),a=n(8007),l=n(2253),c=n(4932),u=n(1309),d=n(4586),h=n(3304),m=n(7582),g=n(5893),f=n(7294),p=n(9583),v=n(2169);function y(e){var t=e.className;return(0,g.jsx)("svg",{width:"194.40327mm",height:"290.853mm",viewBox:"0 0 194.40327 290.85299",xmlns:"http://www.w3.org/2000/svg",className:t,style:{fill:"currentcolor"},children:(0,g.jsxs)("g",{children:[(0,g.jsx)("rect",{width:"50.962246",height:"290.853",x:"143.44104",y:"2.4868996e-14",rx:"15.05095",ry:"17.061689"}),(0,g.jsx)("path",{d:"m 42.968955,90.42652 c -2.198688,0 -3.96875,1.770063 -3.96875,3.96875 v 35.03145 H 3.9687499 C 1.7700625,129.42672 0,131.19678 0,133.39547 v 24.0621 c 0,2.19869 1.7700625,3.96875 3.9687499,3.96875 H 39.000205 v 35.03145 c 0,2.19869 1.770062,3.96875 3.96875,3.96875 h 24.062613 c 2.198687,0 3.968749,-1.77006 3.968749,-3.96875 v -35.03145 h 35.030933 c 2.19869,0 3.96875,-1.77006 3.96875,-3.96875 v -24.0621 c 0,-2.19869 -1.77006,-3.96875 -3.96875,-3.96875 H 71.000317 V 94.39527 c 0,-2.198687 -1.770062,-3.96875 -3.968749,-3.96875 z"}),(0,g.jsx)("rect",{width:"7.8557625",height:"1.5711526",x:"57.085205",y:"139.30885",rx:"3.96875"})]})})}function x(e){var t=e.className;return(0,g.jsx)("svg",{width:"194.40327mm",height:"290.853mm",viewBox:"0 0 194.40327 290.85299",xmlns:"http://www.w3.org/2000/svg",className:t,style:{fill:"currentcolor"},children:(0,g.jsxs)("g",{children:[(0,g.jsx)("rect",{width:"50.962246",height:"290.853",x:"143.44104",y:"2.4868996e-14",rx:"15.05095",ry:"17.061689"}),(0,g.jsx)("rect",{width:"110.35661",height:"35.805271",x:"0",y:"127.52386",rx:"3.96875"})]})})}var b=n(1446),j=n(2452),C=n(6743),w=n(539),k=n(8778),S=n(4339),N=n(5829),_=n(8949),T=n(3544),R=n(3439),P=n(515),A=n(6912),L=n(6806),M=n(3819),I=n(1709),E=n(1014);function B(e){var t=e.onChange,n=e.value,s=e.delay,r=e.step,i=void 0===r?1:r,o=e.style,a=e.placeholder,c=e.className,d=(0,u._)((0,f.useState)("".concat(n)),2),h=d[0],m=d[1],p=(0,M.Z)(h,void 0===s?800:s);return(0,f.useEffect)(function(){var e=Number(p);Number.isFinite(e)?t(e):m("0")},[p,t]),(0,f.useEffect)(function(){m("".concat(n))},[n]),(0,g.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end"},className:c,children:[(0,g.jsx)("button",{onClick:function(){return m("".concat(Number(h)-i))},className:"midi-btn-small",style:o,children:"-"}),(0,g.jsx)("input",{type:"text",placeholder:a,value:h,onChange:function(e){return m(e.target.value)},className:"midi-input",style:(0,l._)({margin:"0 0.3rem"},o)}),(0,g.jsx)("button",{onClick:function(){return m("".concat(Number(h)+i))},className:"midi-btn-small",style:o,children:"+"})]})}function H(e){var t,n=e.data,s=e.index,r=e.onChange,i=e.theme,o=e.instruments,a=(0,u._)((0,f.useState)(!1),2),l=a[0],c=a[1],d={backgroundColor:i.layer("menu_background",.15).toString()},h=(0,u._)((0,f.useState)("".concat(null!==(t=n.localOffset)&&void 0!==t?t:"")),2),m=h[0],v=h[1],y=(0,M.Z)(m,600);(0,f.useEffect)(function(){var e=parseInt(y),t=Number.isFinite(e)?e:null;v("".concat(null!=t?t:"")),r(s,{localOffset:t})},[y,r,s]),(0,f.useEffect)(function(){var e;v("".concat(null!==(e=n.localOffset)&&void 0!==e?e:""))},[n.localOffset]);var x=(0,f.useCallback)(function(e){r(s,{maxScaling:Math.max(0,e)})},[r,s]);return(0,g.jsxs)("div",{className:"midi-track-column",style:d,children:[(0,g.jsxs)("div",{className:"midi-track-wrapper",children:[(0,g.jsxs)("div",{className:"midi-track-center",children:[(0,g.jsx)("input",{type:"checkbox",onChange:function(){return r(s,{selected:!n.selected})},checked:n.selected}),"".concat(n.name," "),"(",n.track.notes.length,","," ".concat(n.track.instrument.family),")"]}),(0,g.jsxs)("div",{className:"midi-track-center",children:[(0,g.jsx)(I.P,{onChange:function(e){return r(s,{layer:Number(e.target.value)})},value:n.layer,className:"midi-select",style:{marginLeft:"0.2rem"},children:o.map(function(e,t){return(0,g.jsxs)("option",{value:t,children:[e.alias||(0,C.yX)(e.name)," - ","Layer ".concat(t+1)]},t)})}),(0,g.jsx)(p.LCi,{size:22,color:"var(--primary)",onClick:function(){return c(!l)},cursor:"pointer"})]})]}),(0,g.jsxs)("div",{className:"midi-track-data",style:{display:l?"flex":"none"},children:[(0,g.jsxs)("div",{className:"midi-track-data-row",children:[(0,g.jsxs)("div",{className:(0,E.h)(!0),children:[(0,g.jsx)(E.u,{children:"Changes the index of each note by this amount."}),"Track offset:"]}),(0,g.jsx)("input",{type:"text",value:m,placeholder:"No offset",className:"midi-input",style:{width:"6.3rem"},onChange:function(e){return v(e.target.value)}})]}),(0,g.jsxs)("div",{className:"midi-track-data-row",children:[(0,g.jsxs)("div",{className:(0,E.h)(!0),children:[(0,g.jsx)(E.u,{children:"Scale down/up the notes which are out of scale by theose octaves."}),"Max notes octave scaling:"]}),(0,g.jsx)(B,{value:n.maxScaling,placeholder:"No scaling",onChange:x})]}),(0,g.jsxs)("div",{className:"midi-track-data-row",children:[(0,g.jsx)("div",{children:"Instrument:"}),(0,g.jsx)("div",{children:n.track.instrument.name})]}),(0,g.jsxs)("div",{className:"midi-track-data-row",children:[(0,g.jsx)("div",{children:"Number of notes:"}),(0,g.jsx)("div",{children:n.track.notes.length})]}),(0,g.jsxs)("div",{className:"midi-track-data-row",children:[(0,g.jsx)("div",{children:"Accidentals:"}),(0,g.jsx)("div",{children:n.numberOfAccidentals})]}),(0,g.jsxs)("div",{className:"midi-track-data-row",children:[(0,g.jsxs)("div",{children:["Out of range: (",n.outOfRangeBounds.upper+n.outOfRangeBounds.lower,")"]}),(0,g.jsxs)("div",{className:"row",style:{width:"fit-content"},children:[(0,g.jsxs)("div",{className:"row",style:{marginRight:"0.4rem"},children:[(0,g.jsx)(p.ZTc,{style:{marginRight:"0.2rem"}}),n.outOfRangeBounds.upper]}),(0,g.jsxs)("div",{className:"row",children:[(0,g.jsx)(p.NWQ,{style:{marginRight:"0.2rem"}}),n.outOfRangeBounds.lower]})]})]})]})]})}var O=function(e){(0,a._)(n,e);var t=(0,h._)(n);function n(e){var s;return(0,i._)(this,n),(s=t.call(this,e)).handleFile=function(e){try{if(0===e.length)return;var t,n,r=e[0],i=new j.Midi(r.data),o=null===(t=i.header.tempos[0])||void 0===t?void 0:t.bpm,a=null===(n=i.header.keySignatures[0])||void 0===n?void 0:n.key,l=i.tracks.map(function(e,t){return{track:e,selected:!0,layer:0,name:e.name||"Track n.".concat(t+1),numberOfAccidentals:0,maxScaling:0,outOfRangeBounds:{lower:0,upper:0},localOffset:null}});s.setState({tracks:l,fileName:r.file.name,bpm:Math.floor(4*o)||220,offset:0,pitch:v.T_.includes(a)?a:"C"},function(){s.state.tracks.length&&s.convertMidi()})}catch(e){console.error(e),S.kg.error("There was an error importing this file, is it a .mid file?")}},s.convertMidi=function(){var e=s.state,t=e.tracks,n=e.bpm,r=e.offset,i=e.includeAccidentals,o=e.pitch,a=t.filter(function(e){return e.selected}),l=[],c=0,u=0,h=0;a.forEach(function(e){e.numberOfAccidentals=0,e.outOfRangeBounds.upper=0,e.outOfRangeBounds.lower=0,e.track.notes.forEach(function(t){h++;var n,s=w.LG.fromMidi(e.layer,Math.floor(1e3*t.time),t.midi-(null!==(n=e.localOffset)&&void 0!==n?n:r),e.maxScaling);s.data.isAccidental&&(c++,e.numberOfAccidentals++),-1!==s.data.note?(i||!s.data.isAccidental)&&l.push(s):(u++,-1===s.data.outOfRangeBound&&e.outOfRangeBounds.lower++,1===s.data.outOfRangeBound&&e.outOfRangeBounds.upper++)})});for(var m=l.sort(function(e,t){return e.time-t.time}),g=Math.floor(6e4/n),f=[];m.length>0;){for(var p=[m.shift()],v=0,y=0;y<m.length;y++)p[0].time>m[y].time-g/9&&v++;f.push((0,d._)(p).concat((0,d._)(m.splice(0,v))))}var x=[],b=0;f.forEach(function(e){var t=e[0];if(t){var n=Math.floor((t.time-b-g)/g),s=new w.sg;b=t.time,n>-1&&Array(n).fill(0).forEach(function(){return x.push(new w.sg)}),s.notes=e.map(function(e){var t=new R.u;return t.set(e.layer,!0),new w.Ws(e.data.note,t)}),x.push(s)}}),x.forEach(function(e){var t=(0,C.l3)(e);e.notes=t.map(function(e){return e[0].layer=(0,C.UV)(e),e[0]})});var j=new k.l("Untitled");j.columns=x,j.bpm=n,j.instruments=[],j.instruments=s.props.data.instruments.map(function(e){return e.clone()}),j.pitch=o;var N=s.props.data.selectedColumn;if(j.selected=N<j.columns.length?N:0,0===j.columns.length)return S.kg.warn("There are no notes");s.props.functions.loadSong(j),s.setState({accidentals:c,totalNotes:h,outOfRange:u})},s.editTrack=function(e,t){var n=s.state.tracks;Object.assign(n[e],t),s.setState({tracks:n},function(){s.state.tracks.length>0&&s.convertMidi()})},s.changeOffset=function(e){Number.isInteger(e)||(e=0),s.state.offset!==e&&s.setState({offset:e},function(){s.state.tracks.length>0&&s.convertMidi()})},s.changePitch=function(e){s.props.functions.changePitch(e),s.setState({pitch:e})},s.toggleAccidentals=function(){s.setState({includeAccidentals:!s.state.includeAccidentals},function(){s.state.tracks.length>0&&s.convertMidi()})},s.changeBpm=function(e){Number.isInteger(e)||(e=0),s.state.bpm!==e&&s.setState({bpm:e},function(){s.state.tracks.length>0&&s.convertMidi()})},s.state={fileName:"",bpm:220,tracks:[],offset:0,pitch:"C",ignoreEmptytracks:!1,accidentals:0,outOfRange:0,totalNotes:0,includeAccidentals:!0,theme:N.f6},s.dispose=function(){},s}var s=n.prototype;return s.componentDidMount=function(){var e=this;this.dispose=(0,_.N7)(N.f6.state.data,function(){e.setState({theme:(0,l._)({},N.f6)})})},s.componentWillUnmount=function(){this.dispose()},s.render=function(){var e=this,t=this.handleFile,n=this.editTrack,s=this.state,r=this.changeBpm,i=this.changeOffset,o=this.changePitch,a=s.tracks,c=s.fileName,u=s.bpm,d=s.offset,h=s.pitch,m=s.accidentals,f=s.outOfRange,p=s.totalNotes,v=s.includeAccidentals,y=s.theme,x=s.ignoreEmptytracks,j=this.props,C=j.functions,w=j.data,k=C.changeMidiVisibility,S={backgroundColor:y.layer("primary",.2).toString(),color:y.getText("primary").toString()};return(0,g.jsx)(L.s,{boxProps:{className:"floating-midi"},size:"1.2rem",isRelative:!1,offset:"0.1rem",children:(0,g.jsxs)("div",{className:"column floating-midi-content",children:[(0,g.jsxs)("div",{className:"midi-row separator-border",style:{width:"100%"},children:[(0,g.jsx)(b.G,{onPick:t,as:"buffer",children:(0,g.jsx)("button",{className:"midi-btn",style:S,children:"Open midi file"})}),(0,g.jsx)("div",{style:{margin:"0 0.5rem",maxWidth:"20rem"},className:"text-ellipsis",children:c}),(0,g.jsx)("button",{className:"midi-btn",style:(0,l._)({marginLeft:"auto"},S),onClick:function(){return k(!1)},children:"Close"})]}),(0,g.jsxs)("div",{className:"midi-table-row",children:[(0,g.jsx)("div",{style:{marginRight:"0.5rem"},children:"Bpm:"}),(0,g.jsx)(B,{value:u,onChange:r,delay:600,style:S,step:5})]}),(0,g.jsxs)("div",{className:"midi-table-row",children:[(0,g.jsxs)("div",{className:"row flex-centered",children:[(0,g.jsx)("span",{style:{marginRight:"0.5rem"},children:"Global note offset: "}),(0,g.jsx)(P.k,{buttonStyle:{width:"1.2rem",height:"1.2rem"},children:"The index of each note will be pushed up/down by this amount, you can use it to make the song fit into the app range. You can also change the offset of each layer."})]}),(0,g.jsx)(B,{value:d,onChange:i,delay:600,style:S,step:1})]}),(0,g.jsxs)("div",{className:"midi-table-row",children:[(0,g.jsx)("div",{style:{marginRight:"0.5rem"},children:"Pitch:"}),(0,g.jsx)(A.x,{style:(0,l._)({width:"5rem"},S),selected:h,onChange:o})]}),(0,g.jsxs)("div",{className:"midi-table-row",children:[(0,g.jsxs)("div",{className:"row",children:[(0,g.jsx)("div",{style:{marginRight:"0.5rem"},children:"Include accidentals:"}),(0,g.jsx)(T.Z,{checked:v,onChange:this.toggleAccidentals,styleOuter:S})]}),(0,g.jsxs)("div",{className:"row",children:[(0,g.jsx)("div",{style:{marginRight:"0.5rem"},children:"Ignore empty tracks:"}),(0,g.jsx)(T.Z,{checked:x,onChange:function(t){return e.setState({ignoreEmptytracks:t})},styleOuter:S})]})]}),a.length>0&&(0,g.jsx)("div",{className:"midi-column separator-border",style:{width:"100%"},children:(0,g.jsxs)("div",{className:"midi-column",style:{width:"100%"},children:[(0,g.jsx)("div",{children:"Select midi tracks"}),a.map(function(e,t){return!(x&&0===e.track.notes.length)&&(0,g.jsx)(H,{data:e,instruments:w.instruments,index:t,onChange:n,theme:y},t)})]})}),a.length>0&&(0,g.jsx)("table",{children:(0,g.jsxs)("tbody",{children:[(0,g.jsxs)("tr",{children:[(0,g.jsx)("td",{children:"Total notes: "}),(0,g.jsx)("td",{}),(0,g.jsx)("td",{children:p})]}),(0,g.jsxs)("tr",{children:[(0,g.jsx)("td",{children:"Accidentals: "}),(0,g.jsx)("td",{}),(0,g.jsx)("td",{children:m})]}),(0,g.jsxs)("tr",{children:[(0,g.jsx)("td",{children:"Out of range: "}),(0,g.jsx)("td",{}),(0,g.jsx)("td",{children:f})]})]})})]})})},n}(f.Component),D=n(8461),F=n(5434),J=n(7106),V=(0,f.memo)(function(e){var t=e.data,n=e.functions,s=(0,u._)((0,f.useState)("all"),2),r=s[0],i=s[1],o=n.toggleTools,a=n.copyColumns,l=n.eraseColumns,c=n.pasteColumns,d=n.deleteColumns,h=n.resetSelection,m=n.undo,v=n.moveNotesBy,y=t.isToolsVisible,x=t.hasCopiedColumns,b=t.layer,j=t.selectedColumns,C=t.undoHistory,w="all"===r?"all":b;return(0,g.jsx)(L.s,{boxProps:{className:"floating-tools ".concat(y?"floating-tools tools-visible":"")},size:"1.2rem",isRelative:!1,offset:"0.1rem",children:(0,g.jsxs)("div",{className:"floating-tools-content",children:[(0,g.jsxs)("div",{className:"tools-buttons-grid",children:[(0,g.jsxs)(z,{area:"a",disabled:x,onClick:function(){return a(w)},active:x,tooltip:"Copy all notes",style:{flexDirection:"column",justifyContent:"center"},tooltipPosition:"bottom",children:[(0,g.jsx)(p.esY,{className:"tools-icon",size:24}),"Copy"]}),(0,g.jsxs)(z,{disabled:!x,onClick:function(){return c(!1,w)},tooltip:"Paste copied notes",area:"b",tooltipPosition:"bottom",children:[(0,g.jsx)(p.VGm,{className:"tools-icon"}),"Paste ","all"===r?"":"in layer ".concat(b+1)]}),(0,g.jsxs)(z,{disabled:!x,onClick:function(){return c(!0,w)},tooltip:"Insert copied notes",area:"c",children:[(0,g.jsx)(J.ODP,{className:"tools-icon",style:{strokeWidth:"3px"}}),"Insert ","all"===r?"":"in layer ".concat(b+1)]}),(0,g.jsxs)(z,{disabled:x,onClick:function(){return l(w)},tooltip:"Erase all selected notes",area:"d",children:[(0,g.jsx)(p.arg,{className:"tools-icon"}),"Erase"]}),(0,g.jsxs)(z,{disabled:x||"all"!==w,onClick:d,tooltip:"Delete selected columns",area:"f",children:[(0,g.jsx)(p.Xm5,{className:"tools-icon",color:"var(--red)"}),"Delete"]}),(0,g.jsxs)(z,{disabled:x,tooltip:"Push notes up by 1 position",area:"e",onClick:function(){return v(1,w)},children:[(0,g.jsx)(p.$Pg,{className:"tools-icon"}),"Move notes up"]}),(0,g.jsxs)(z,{disabled:x,tooltip:"Push notes down by 1 position",onClick:function(){return v(-1,w)},area:"g",children:[(0,g.jsx)(p.iUH,{className:"tools-icon"}),"Move notes down"]})]}),(0,g.jsxs)("div",{className:"tools-right column",children:[(0,g.jsxs)(D.J,{style:{marginBottom:"0.2rem"},className:(0,E.h)(!0),toggled:"all"===r,onClick:function(){return i("all")},children:[(0,g.jsx)(F.L_o,{style:{marginRight:"0.2rem"},size:16}),"All layers",(0,g.jsx)(E.u,{style:{left:0},children:"Select all the layers in the highlighted columns"})]}),(0,g.jsxs)(D.J,{style:{marginBottom:"0.2rem"},className:(0,E.h)(!0),toggled:"layer"===r,onClick:function(){return i("layer")},children:[(0,g.jsx)(F.yo,{style:{marginRight:"0.2rem"},size:16}),"Only Layer",(0,g.jsx)("span",{style:{minWidth:"0.6rem",marginLeft:"0.2rem"},children:b+1}),(0,g.jsx)(E.u,{style:{left:0},children:"Select all the notes in the highlighted columns of the current layer"})]}),(0,g.jsx)(D.J,{style:{marginBottom:"0.2rem",justifyContent:"center"},onClick:h,disabled:j.length<=1&&!x,toggled:x,children:"Clear selection"}),(0,g.jsxs)("div",{className:"row",style:{flex:"1",alignItems:"flex-end"},children:[(0,g.jsx)(D.J,{style:{flex:"1",justifyContent:"center"},disabled:0===C.length,onClick:m,children:"Undo"}),(0,g.jsx)(D.J,{onClick:o,style:{marginLeft:"0.2rem",flex:"1",justifyContent:"center"},children:"Ok"})]})]})]})})},function(e,t){return e.data.isToolsVisible===t.data.isToolsVisible&&e.data.hasCopiedColumns===t.data.hasCopiedColumns&&e.data.layer===t.data.layer&&e.data.selectedColumns===t.data.selectedColumns&&e.data.undoHistory===t.data.undoHistory});function z(e){var t=e.disabled,n=e.onClick,s=e.active,r=e.style,i=e.children,o=e.tooltip,a=e.area,c=e.tooltipPosition;return(0,g.jsxs)("button",{disabled:t,onClick:n,className:"flex-centered tools-button ".concat(s?"tools-button-highlighted":""," ").concat((0,E.h)(o)),style:(0,l._)({gridArea:a},r),children:[i,o&&(0,g.jsx)(E.u,{position:c||"top",children:o})]})}var Z=n(8376),W=n(2114),U=new Map(Array(16).fill(0).map(function(e,t){var n=t.toString(2).split("").map(function(e){return parseInt(e)}).reverse();return[t,"".concat(v.Al.noteComposer," ").concat(n.map(function(e,t){return 1===e?"layer-".concat(t+1):""}).join(" "))]})),X={note_background:N.f6.get("note_background").desaturate(.6).toString(),isAccentDefault:N.f6.isDefault("accent")},Y=(0,f.memo)(function(e){var t,n,s=e.data,r=e.layer,i=e.instrument,o=e.clickAction,a=e.noteText,l=e.noteImage,c=e.theme,d=(0,u._)((0,f.useState)(X),2),h=d[0],m=d[1];(0,f.useEffect)(function(){var e=N.f6.get("note_background").desaturate(.6);m({note_background:e.isDark()?e.lighten(.45).toString():e.darken(.18).toString(),isAccentDefault:N.f6.isDefault("accent")})},[c]);var p=null!==(n=U.get(r))&&void 0!==n?n:v.Al.noteComposer;return(0,g.jsx)("button",{onPointerDown:function(){return o(s)},className:"button-hitbox",children:(0,g.jsxs)("div",{className:p,children:["Genshin"===v.iC&&(0,g.jsx)(Z.Z,{fill:h.note_background,className:"genshin-border"}),(0,g.jsx)(W.Z,{name:l,color:h.isAccentDefault?null===(t=v.as[i])||void 0===t?void 0:t.fill:void 0,background:"var(--note-background)"}),(0,g.jsx)("div",{className:"layer-3-ball-bigger"}),(0,g.jsx)("div",{className:"layer-4-line"}),(0,g.jsx)("div",{className:"Sky"===v.iC?"note-name-sky":"note-name",children:a})]})})},function(e,t){return e.noteText===t.noteText&&e.clickAction===t.clickAction&&e.noteImage===t.noteImage&&e.noteText===t.noteText&&e.layer===t.layer&&e.instrument===t.instrument}),G=n(5055);function q(e){var t=e.data,n=e.functions,s=t.keyboard,r=t.isPlaying,i=t.noteNameType,o=t.currentColumn,a=t.pitch,d=t.currentLayer,h=t.isRecordingAudio,m=n.handleClick,f=n.handleTempoChanger,y=(0,u._)((0,G.F)(),1)[0];if(void 0===s)return(0,g.jsx)("div",{className:"composer-keyboard-wrapper",style:{marginBottom:"4rem"},children:(0,g.jsx)("h1",{children:"There was an error with this layer"})});if(h)return(0,g.jsx)("div",{className:"composer-keyboard-wrapper",style:{marginBottom:"4rem"},children:(0,g.jsx)("h1",{children:"Recording Audio..."})});var x="keyboard";return 15===s.notes.length&&(x+=" keyboard-5"),14===s.notes.length&&(x+=" keyboard-5"),8===s.notes.length&&(x+=" keyboard-4"),6===s.notes.length&&(x+=" keyboard-3"),(0,g.jsxs)(g.Fragment,{children:[(0,g.jsxs)("div",{className:"composer-keyboard-wrapper",children:[t.settings.useKeyboardSideButtons.value&&(0,g.jsx)("button",{onPointerDown:function(){return n.selectColumnFromDirection(-1)},className:"keyboard-column-selection-buttons ".concat(t.isPlaying?"":"keyboard-column-selection-buttons-visible"),style:{paddingRight:"0.5rem",justifyContent:"flex-end",visibility:t.isPlaying?"hidden":"visible"},children:(0,g.jsx)(p.bUI,{})}),(0,g.jsxs)("div",{className:x,children:[0===s.notes.length?(0,g.jsx)("div",{className:"loading",children:"Loading..."}):null,s.notes.map(function(e,n){try{var r=o.notes.findIndex(function(e){return e.index===n});return(0,g.jsx)(Y,{layer:r>=0?o.notes[r].layer.toLayerStatus(d,t.instruments):0,data:e,theme:y,noteText:s.getNoteText(n,i,a),instrument:s.name,noteImage:e.noteImage,clickAction:m},e.index)}catch(e){return"Err"}})]}),t.settings.useKeyboardSideButtons.value&&(0,g.jsx)("button",{onPointerDown:function(){return n.selectColumnFromDirection(1)},className:"keyboard-column-selection-buttons ".concat(t.isPlaying?"":"keyboard-column-selection-buttons-visible"),style:{paddingLeft:"0.5rem",justifyContent:"flex-start",visibility:t.isPlaying?"hidden":"visible"},children:(0,g.jsx)(p.Dli,{})})]}),(0,g.jsxs)("div",{className:"tempo-changers-wrapper ".concat(r?"tempo-changers-wrapper-hidden":""),children:[(0,g.jsx)("div",{className:"bottom-right-text",children:"Tempo"}),v.nq.map(function(e){return(0,g.jsx)("button",{onClick:function(){return f(e)},style:(0,c._)((0,l._)({},1===e.changer?{backgroundColor:y.get("primary").toString(),color:y.getText("primary").toString()}:{backgroundColor:"#"+e.color.toString(16)}),{outline:t.currentColumn.tempoChanger===e.id?"3px ".concat(y.get("composer_accent").toString()," solid"):"unset",outlineOffset:"-3px"}),children:e.text},e.id)})]})]})}var Q=n(8810),K=n(3805),$=n.n(K),ee=n(6767),et=n.n(ee),en=n(7564),es=n(3531);en.Xd.LINE_SCALE_MODE=en.F4.NORMAL;var er=v.h8.horizontalLineBreak,ei=(v.h8.standards,v.h8.layersCombination),eo=v.h8.breakpoints,ea=function e(t){var n=t.width,s=t.height,r=t.margin,o=t.timelineHeight,a=t.app,l=t.breakpointsApp,c=t.colors,u=this;(0,i._)(this,e),this.destroy=function(){u.cache.columns.forEach(function(e){return e.destroy(!0)}),u.cache.standard.forEach(function(e){return e.destroy(!0)}),u.cache.columnsLarger.forEach(function(e){return e.destroy(!0)}),u.cache.standardLarger.forEach(function(e){return e.destroy(!0)}),u.cache.breakpoints.forEach(function(e){return e.destroy(!0)}),Object.values(u.cache.notes).forEach(function(e){return e.destroy(!0)}),u.app=null,u.breakpointsApp=null},this.generate=function(){v.nq.forEach(function(e){var t=u.drawColumn(e,1);t&&u.cache.columns.push(t)}),u.colors.bars.forEach(function(e){var t=u.drawColumn(e,1);t&&u.cache.standard.push(t)}),u.colors.bars.forEach(function(e){var t=u.drawColumn(e,3);t&&u.cache.standardLarger.push(t)}),ei.forEach(function(e){var t=u.noteWidth,n=u.noteHeight,s=u.noteWidth>20?3:2,r=new R.u(e),i=new en.K3;if(r.test(0)&&i.beginFill(new(et())(u.colors.mainLayer).rgbNumber()).lineStyle(1,new(et())(u.colors.mainLayer).rgbNumber()).drawRoundedRect(u.margin/2-.25,u.margin/2,Math.ceil(t-u.margin),Math.ceil(n-u.margin),s).endFill(),r.test(1)&&i.lineStyle(4===u.margin?3:2,new(et())(u.colors.secondLayer).rgbNumber()).drawRoundedRect(u.margin/2-.25,u.margin/2,Math.ceil(t-u.margin),Math.ceil(n-u.margin),s).endFill(),r.test(2)&&i.beginFill(new(et())(u.colors.secondLayer).rgbNumber()).lineStyle(1,new(et())(u.colors.secondLayer).rgbNumber()).drawCircle(t/2-.25,n/2,n/3-.5).endFill(),r.test(3)){var o=4===u.margin?3:2;i.lineStyle(o,new(et())(u.colors.secondLayer).darken(.15).rgbNumber()).moveTo(u.margin/2+.5,n/2).lineTo(t-u.margin+.5,n/2).endFill()}if(u.app){var a=u.app.renderer.generateTexture(i,{resolution:2,scaleMode:es.aH$.LINEAR,region:new es.AeJ(0,0,u.noteWidth,u.noteHeight)});u.cache.notes[e]=a,i.destroy(!0)}}),v.nq.forEach(function(e){var t=u.drawColumn(e,2);t&&u.cache.columnsLarger.push(t)}),eo.forEach(function(e){var t=new en.K3,n=u.timelineHeight/6;if("short"===e.type){if(t.beginFill(u.colors.accent.rgbNumber()),t.drawCircle(n,u.timelineHeight/2,n).endFill(),!u.breakpointsApp)return;var s=u.breakpointsApp.renderer.generateTexture(t,{scaleMode:es.aH$.LINEAR,resolution:2,region:new es.AeJ(0,0,2*n,u.timelineHeight)});u.cache.breakpoints.push(s),t.destroy(!0)}else{if(t.beginFill(u.colors.accent.rgbNumber()).moveTo(0,u.height).lineTo(u.noteWidth/2,u.height).lineTo(0,u.height-u.noteHeight).endFill(),t.beginFill(u.colors.accent.rgbNumber()).moveTo(u.width,u.height).lineTo(u.noteWidth/2,u.height).lineTo(u.width,u.height-u.noteHeight).endFill(),t.beginFill(u.colors.accent.rgbNumber()).moveTo(0,0).lineTo(u.noteWidth/2,0).lineTo(0,u.noteHeight).endFill(),t.beginFill(u.colors.accent.rgbNumber()).moveTo(u.width,0).lineTo(u.noteWidth/2,0).lineTo(u.width,u.noteHeight).endFill(),!u.app)return;var r=u.app.renderer.generateTexture(t,{scaleMode:es.aH$.LINEAR,resolution:2});u.cache.breakpoints.push(r),t.destroy(!0)}})},this.drawColumn=function(e,t){var n,s=new en.K3;s.beginFill(e.color),s.drawRect(0,0,u.width,u.height),s.lineStyle(t,3355443).moveTo(u.width,0).lineTo(u.width,u.height),s.lineStyle(1,3355443);for(var r=1;r<3;r++){var i=u.noteHeight*er*r;s.moveTo(0,i),s.lineTo(u.width,i)}if(u.app){var o=u.app.renderer.generateTexture(s,{scaleMode:es.aH$.LINEAR,resolution:(null===(n=window)||void 0===n?void 0:n.devicePixelRatio)||1,region:new es.AeJ(0,0,u.width,u.height)});return s.destroy(!0),o}},this.cache={columns:[],notes:{},standard:[],columnsLarger:[],standardLarger:[],breakpoints:[]},this.width=n,this.height=s,this.timelineHeight=void 0===o?30:o,this.margin=void 0===r?4:r,this.noteWidth=this.width,this.noteHeight=this.height/v.WO,this.colors=c,this.app=a,this.breakpointsApp=l,this.generate()},el=n(9218);function ec(e){var t=e.notes,n=e.index,s=e.sizes,r=e.cache,i=e.instruments,o=e.backgroundCache,a=e.isBreakpoint,l=e.isSelected,c=e.isToolsSelected,u=e.currentLayer;return(0,g.jsxs)(Q.W2,{eventMode:"static",x:s.width*n,children:[(0,g.jsxs)(Q.jy,{texture:o,children:[(l||c)&&(0,g.jsx)(Q.jy,{texture:c&&!l?r.standard[3]:r.standard[2],alpha:c&&!l?.4:.8,zIndex:1}),a&&(0,g.jsx)(Q.jy,{texture:r.breakpoints[1]})]}),t.map(function(e){var t=e.layer.toLayerStatus(u,i);return 0===t?null:(0,g.jsx)(Q.jy,{texture:r.notes[t],y:v.zW[e.index]*s.height/v.WO},e.index)})]})}function eu(e){var t=e.onClick,n=e.children,s=e.tooltip,r=e.style,i=e.ariaLabel;return(0,g.jsxs)("button",{className:"timeline-button ".concat((0,E.h)(s)),onClick:t,style:r,"aria-label":i,children:[n,s&&(0,g.jsx)(E.u,{children:s})]})}var ed=n(9714),eh=function(e){(0,a._)(n,e);var t=(0,h._)(n);function n(e){(0,i._)(this,n),(s=t.call(this,e)).cleanup=[],s.resetPointerDown=function(){s.stageSelected=!1,s.sliderSelected=!1,s.stagePreviousPositon=0},s.handleThemeChange=function(){s.setState({theme:{timeline:{hex:N.f6.layer("primary",.1).hex(),hexNumber:N.f6.layer("primary",.1).rgbNumber(),selected:N.f6.get("composer_accent").negate().rgbNumber(),border:N.f6.get("composer_accent").rgbNumber()},sideButtons:{hex:N.f6.get("primary").darken(.08).hex(),rgb:(0,C.nA)(N.f6.get("primary").darken(.08)).join(",")},main:{background:N.f6.get("primary").rgbNumber(),backgroundHex:N.f6.get("primary").hexa(),backgroundOpacity:Math.max(N.f6.get("primary").alpha(),.8)}}},function(){var e;s.recalculateCacheAndSizes(),(null===(e=s.notesStageRef)||void 0===e?void 0:e.current)&&(s.notesStageRef.current.app.renderer.background.color=s.state.theme.main.background)})},s.recalculateCacheAndSizes=function(){s.cacheRecalculateDebounce&&clearTimeout(s.cacheRecalculateDebounce),s.cacheRecalculateDebounce=setTimeout(function(){if((null===(e=s.notesStageRef)||void 0===e?void 0:e.current)&&(null===(t=s.breakpointsStageRef)||void 0===t?void 0:t.current)){var e,t,n=document.body.getBoundingClientRect(),r=s.state.numberOfColumnsPerCanvas,i=s.props.data.inPreview,o=(0,C.VN)(.85*n.width-45),a=(0,C.VN)(.45*n.height);"Sky"===v.iC&&(a=(0,C.VN)(.95*a)),i&&(o=(0,C.VN)(o*(n.width<900?.8:.55)),a=(0,C.VN)(a*(n.width<900?.8:.6)));var l=(0,C.VN)(o/r),c=s.state.cache;s.setState({width:Math.floor(o),height:Math.floor(a),column:{width:l,height:a},cache:s.generateCache(l,a,$()()?2:4,$()()?25:30)},function(){setTimeout(function(){null==c||c.destroy()},500)})}},50)},s.handleWheel=function(e){s.props.functions.selectColumn(s.props.data.selected+Math.sign(e.deltaY),!0)},s.handleClick=function(e,t){var n=e.globalX,r=s.state,i=r.width,o=r.numberOfColumnsPerCanvas,a=s.props.data;if(s.stageXMovement=0,s.stageMovementAmount=0,"up"===t&&(s.sliderSelected=!1),"down-slider"===t){s.sliderSelected=!0;var l=i/a.columns.length,c=l*(o+1),u=l*a.selected-o/2*l;s.onSlider=n>u&&n<u+c,s.sliderOffset=u+c/2-n,s.throttleScroll=Number.MAX_SAFE_INTEGER,s.handleSliderSlide(e)}"down-stage"===t&&(s.stagePreviousPositon=n,s.stageSelected=!0)},s.handleClickStage=function(e){s.handleClick(e,"down-stage")},s.handleClickStageUp=function(e){if(s.stageSelected=!1,0===s.stageMovementAmount){var t=s.state.numberOfColumnsPerCanvas/2*s.state.column.width,n=Math.floor((e.globalX-t)/s.state.column.width+1);if(0!==n){var r=s.props,i=r.data,o=r.functions,a=i.selected+Math.round(n);o.selectColumn((0,C.uZ)(a,0,i.columns.length-1))}}},s.handleClickDown=function(e){s.handleClick(e,"down-slider")},s.handleClickUp=function(e){s.handleClick(e,"up")},s.handleStageSlide=function(e){var t=e.globalX,n=s.stagePreviousPositon-t;if(s.stagePreviousPositon=t,s.stageSelected){var r=s.state.column.width,i=s.props,o=i.data,a=i.functions;s.stageXMovement+=n;var l=(s.stageXMovement-s.stageMovementAmount*r)/r;if(1>Math.abs(l))return;s.stageMovementAmount+=Math.round(l);var c=o.selected+Math.round(l);a.selectColumn((0,C.uZ)(c,0,o.columns.length-1),!0)}},s.handleBreakpoints=function(e){var t=s.props.data,n=t.selected,r=t.columns,i=t.breakpoints,o=1===e?i.filter(function(e){return e>n}).sort(function(e,t){return e-t}):i.filter(function(e){return e<n}).sort(function(e,t){return t-e});0!==o.length&&r.length>=o[0]&&o[0]>=0&&s.props.functions.selectColumn(o[0])},s.handleSliderSlide=function(e){var t=e.globalX;if(s.sliderSelected){if(s.throttleScroll++<4)return;var n=s.state,r=n.width,i=n.column,o=s.props.data;s.hasSlided=!0,s.throttleScroll=0;var a=i.width*o.columns.length,l=Math.floor((s.onSlider?t+s.sliderOffset:t)/r*a/i.width);s.props.functions.selectColumn((0,C.uZ)(l,0,o.columns.length-1),!0)}},s.testStageHitarea={contains:function(e,t){if(s.stageSelected)return!0;var n=s.state.column.width*s.props.data.columns.length;return!(e<0)&&!(e>n)&&!(t<0)&&!(t>s.state.height)}},s.testTimelineHitarea={contains:function(e,t){return!!s.sliderSelected||!(e<0)&&!(e>s.state.width)&&!(t<0)&&!(t>s.state.timelineHeight)}};var s,r=Number(s.props.data.settings.columnsPerCanvas.value);return s.state={width:Math.floor(300),height:Math.floor(150),pixelRatio:1.4,numberOfColumnsPerCanvas:r,column:{width:(0,C.VN)(300/r),height:150},timelineHeight:30,currentBreakpoint:-1,theme:{timeline:{hex:N.f6.layer("primary",.1).toString(),hexNumber:N.f6.layer("primary",.1).rgbNumber(),selected:N.f6.get("composer_accent").negate().rgbNumber(),border:N.f6.get("composer_accent").rgbNumber()},sideButtons:{hex:N.f6.get("primary").darken(.08).toString(),rgb:(0,C.nA)(N.f6.get("primary").darken(.08)).join(",")},main:{background:N.f6.get("primary").rgbNumber(),backgroundHex:N.f6.get("primary").toString(),backgroundOpacity:N.f6.get("primary").alpha()}},cache:null},s.notesStageRef=(0,f.createRef)(),s.breakpointsStageRef=(0,f.createRef)(),s.stageSelected=!1,s.sliderSelected=!1,s.hasSlided=!1,s.stagePreviousPositon=0,s.stageMovementAmount=0,s.sliderOffset=0,s.stageXMovement=0,s.throttleScroll=0,s.onSlider=!1,s.cacheRecalculateDebounce=0,s}var s=n.prototype;return s.componentDidMount=function(){var e,t,n,s,r=this,i=this.state.numberOfColumnsPerCanvas,o=document.body.getBoundingClientRect(),a=(0,C.VN)(.85*o.width-45),l=(0,C.VN)(.45*o.height);"Sky"===v.iC&&(l=(0,C.VN)(.95*l)),this.setState({width:Math.floor(a),height:Math.floor(l),pixelRatio:null!==(s=window.devicePixelRatio)&&void 0!==s?s:1.4,numberOfColumnsPerCanvas:i,column:{width:(0,C.VN)(a/i),height:l},timelineHeight:$()()?25:30},function(){window.addEventListener("resize",r.recalculateCacheAndSizes),r.recalculateCacheAndSizes()}),window.addEventListener("pointerup",this.resetPointerDown),window.addEventListener("blur",this.resetPointerDown);var c=(0,ed.JZ)("composer","composer_canvas",function(e){var t=e.shortcut.name;"next_breakpoint"===t&&r.handleBreakpoints(1),"previous_breakpoint"===t&&r.handleBreakpoints(-1)});null===(n=this.notesStageRef)||void 0===n||null===(t=n.current)||void 0===t||null===(e=t._canvas)||void 0===e||e.addEventListener("wheel",this.handleWheel);var u=(0,G.B)(this.handleThemeChange);this.cleanup.push(u,c)},s.componentWillUnmount=function(){var e,t,n,s;window.removeEventListener("pointerup",this.resetPointerDown),window.removeEventListener("blur",this.resetPointerDown),window.removeEventListener("resize",this.recalculateCacheAndSizes),this.cacheRecalculateDebounce&&clearTimeout(this.cacheRecalculateDebounce),null===(n=this.notesStageRef)||void 0===n||null===(t=n.current)||void 0===t||null===(e=t._canvas)||void 0===e||e.removeEventListener("wheel",this.handleWheel),this.cleanup.forEach(function(e){return e()}),null===(s=this.state.cache)||void 0===s||s.destroy(),this.notesStageRef=null,this.breakpointsStageRef=null},s.generateCache=function(e,t,n,s){var r,i,o={l:N.f6.get("primary"),d:N.f6.get("primary")};return(o.l=.05>o.l.luminosity()?o.l.lighten(.4):o.l.lighten(.1),o.d=.05>o.d.luminosity()?o.d.lighten(.15):o.d.darken(.03),(null===(r=this.notesStageRef)||void 0===r?void 0:r.current)&&(null===(i=this.breakpointsStageRef)||void 0===i?void 0:i.current))?new ea({width:e,height:t,margin:n,timelineHeight:s,app:this.notesStageRef.current.app,breakpointsApp:this.breakpointsStageRef.current.app,colors:{accent:N.f6.get("composer_accent").rotate(20).darken(.5),mainLayer:N.f6.get("composer_main_layer"),secondLayer:N.f6.get("composer_secondary_layer"),bars:[{color:o.l.rgbNumber()},{color:o.d.rgbNumber()},{color:N.f6.get("composer_accent").rgbNumber()},{color:N.f6.get("composer_accent").negate().rgbNumber()}]}}):null},s.render=function(){var e,t=this,n=this.state,s=n.width,r=n.timelineHeight,i=n.height,o=n.theme,a=n.numberOfColumnsPerCanvas,l=n.pixelRatio,c=this.props,u=c.data,d=c.functions,h=null===(e=this.state.cache)||void 0===e?void 0:e.cache,m=this.state.column,f=-((u.selected-a/2+1)*m.width),v=Number(u.settings.beatMarks.value),y=0===v?12:4*v,x=s/u.columns.length,b=Math.floor(x*(s/m.width+1)),j=x*u.selected-x*(a/2),C=u.breakpoints.includes(u.selected),w=o.sideButtons.rgb;return(0,g.jsxs)("div",{className:"canvas-wrapper "+(u.inPreview?"canvas-wrapper-in-preview":""),style:{width:s,backgroundColor:h?"unset":o.main.backgroundHex},children:[(0,g.jsxs)("div",{className:"canvas-relative",children:[(0,g.jsx)(Q.Hf,{width:s,height:i,raf:!1,onMount:this.recalculateCacheAndSizes,style:{opacity:o.main.backgroundOpacity},renderOnComponentChange:!0,options:{backgroundColor:o.main.background,autoDensity:!0,resolution:l},ref:this.notesStageRef,children:h&&!u.isRecordingAudio&&(0,g.jsx)(Q.W2,{x:f,eventMode:"static",pointerdown:this.handleClickStage,pointerup:this.handleClickStageUp,pointermove:this.handleStageSlide,interactiveChildren:!1,hitArea:this.testStageHitarea,children:u.columns.map(function(e,t){if(!((n=u.selected)-(s=a/2+2)<t)||!(t<n+s))return null;var n,s,r=(t+1)%4==0?h.columnsLarger:h.columns,i=(t+1)%4==0?h.standardLarger:h.standard,o=0===e.tempoChanger?i[Number(t%(2*y)>=y)]:r[e.tempoChanger];return(0,g.jsx)(ec,{cache:h,notes:e.notes,index:t,sizes:m,instruments:u.song.instruments,currentLayer:u.currentLayer,backgroundCache:o,isToolsSelected:u.selectedColumns.includes(t),isSelected:t===u.selected,isBreakpoint:u.breakpoints.includes(t)},t)})})}),!u.settings.useKeyboardSideButtons.value&&(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)("button",{onPointerDown:function(){return d.selectColumn(u.selected-1)},className:"canvas-buttons ".concat(u.isPlaying?"":"canvas-buttons-visible"),style:{left:"0",paddingRight:"0.5rem",justifyContent:"flex-start",background:"linear-gradient(90deg, rgba(".concat(w,",0.80) 30%, rgba(").concat(w,",0.30) 80%, rgba(").concat(w,",0) 100%)")},children:(0,g.jsx)(p.bUI,{})}),(0,g.jsx)("button",{onPointerDown:function(){return d.selectColumn(u.selected+1)},className:"canvas-buttons ".concat(u.isPlaying?"":"canvas-buttons-visible"),style:{right:"0",paddingLeft:"0.5rem",justifyContent:"flex-end",background:"linear-gradient(270deg, rgba(".concat(w,",0.80) 30%, rgba(").concat(w,",0.30) 80%, rgba(").concat(w,",0) 100%)")},children:(0,g.jsx)(p.Dli,{})})]})]}),(0,g.jsx)("div",{className:"timeline-wrapper-bg row",children:(0,g.jsxs)("div",{className:"timeline-wrapper",style:{height:this.state.timelineHeight},children:[(0,g.jsx)(eu,{onClick:function(){return t.handleBreakpoints(-1)},tooltip:"Previous Breakpoint",style:{backgroundColor:o.timeline.hex},ariaLabel:"Previous Breakpoint",children:(0,g.jsx)(el.Z,{children:(0,g.jsx)(p.qSR,{size:16})})}),(0,g.jsx)(eu,{onClick:function(){return t.handleBreakpoints(1)},tooltip:"Next breakpoint",style:{marginLeft:0,backgroundColor:o.timeline.hex},ariaLabel:"Next Breakpoint",children:(0,g.jsx)(el.Z,{children:(0,g.jsx)(p.Nqc,{size:16})})}),(0,g.jsx)("div",{className:"timeline-scroll",style:{backgroundColor:o.timeline.hex},children:(0,g.jsxs)(Q.Hf,{width:s,height:r,options:{backgroundAlpha:0,autoDensity:!0,resolution:l},raf:!1,ref:this.breakpointsStageRef,renderOnComponentChange:!0,children:[h&&(0,g.jsxs)(Q.W2,{width:s,height:r,eventMode:"static",pointerdown:this.handleClickDown,pointerup:this.handleClickUp,pointermove:this.handleSliderSlide,interactiveChildren:!1,hitArea:this.testTimelineHitarea,children:[(0,g.jsx)(Q.TC,{draw:function(e){e.clear(),e.beginFill(o.timeline.hexNumber),e.drawRect(0,0,s,r)}}),u.selectedColumns.length?(0,g.jsx)(Q.TC,{draw:function(e){var t=u.selectedColumns[0]||0,n=u.selectedColumns[u.selectedColumns.length-1],s=t*x,i=n*x-s;e.clear(),e.beginFill(o.timeline.selected,.6),e.drawRect(s,0,i,r)}}):null,u.breakpoints.map(function(e){return(0,g.jsx)(Q.jy,{texture:h.breakpoints[0],interactive:!1,anchor:[.5,0],x:s/(u.columns.length-1)*e},e)})]}),(0,g.jsx)(Q.TC,{draw:function(e){e.clear(),e.lineStyle(3,o.timeline.border,.8),e.drawRoundedRect(0,0,b,r-3,6)},x:j,y:1.5})]})}),(0,g.jsx)(eu,{onClick:d.toggleBreakpoint,style:{backgroundColor:o.timeline.hex},tooltip:C?"Remove breakpoint":"Add breakpoint",ariaLabel:C?"Remove breakpoint":"Add breakpoint",children:(0,g.jsx)(el.Z,{children:C?(0,g.jsx)(p.wbB,{size:16},"minus"):(0,g.jsx)(p.EIY,{size:16},"plus")})})]})})]})},n}(f.Component),em=n(7671),eg=n(781),ef=n(7362),ep=n(5453),ev=n(125),ey=n(1108),ex=n(750),eb=n(1866),ej=n(4931),eC=n(2650),ew=n(8434),ek=n(7008),eS=n(1328),eN=n(7053),e_=n(2132),eT=n(1182),eR=n(2881),eP=n(1664),eA=n.n(eP),eL=n(8737),eM=["vsrg"];function eI(e){var t,n=e.data,s=e.functions,i=e.theme,o=e.folders,a=s.removeSong,l=s.toggleMenu,c=s.renameSong,d=s.loadSong,h=s.downloadSong,v={backgroundColor:i.layer("primary",.15).toString()},y=(0,u._)((0,f.useState)(!1),2),x=y[0],b=y[1],j=(0,u._)((0,f.useState)(n.name),2),C=j[0],w=j[1];return((0,f.useEffect)(function(){w(n.name)},[n.name]),"vsrg"===n.type)?(0,g.jsx)("div",{className:"row",children:"Invalid song"}):(0,g.jsxs)("div",{className:"song-row",children:[(0,g.jsxs)("div",{className:"song-name ".concat((0,E.h)(!0)),onClick:(0,r._)(function(){var e;return(0,m.Jh)(this,function(t){switch(t.label){case 0:if(x)return[2];return S.kg.showPill("Loading song..."),[4,eT.v.getOneSerializedFromStorable(n)];case 1:if(e=t.sent(),S.kg.hidePill(),!e)return[2,S.kg.error("Could not find song")];return d(e),l(!1),[2]}})}),children:[x?(0,g.jsx)("input",{className:"song-name-input ".concat(x?"song-rename":""),disabled:!x,onChange:function(e){return w(e.target.value)},style:{width:"100%",color:"var(--primary-text)"},value:C}):(0,g.jsx)("div",{style:{marginLeft:"0.3rem"},children:C}),(0,g.jsx)(E.u,{children:x?"Song name":"Open in composer"})]}),(0,g.jsx)("div",{className:"song-buttons-wrapper",children:(0,g.jsxs)(ey.Rk,{Icon:p.LCi,ignoreClickOutside:x,style:v,tooltip:"More options",onClose:function(){return b(!1)},children:[(0,g.jsxs)(D.J,{className:"row row-centered",style:{padding:"0.4rem"},onClick:function(){x&&(c(C,n.id),b(!1)),b(!x)},children:[(0,g.jsx)(p.tU3,{style:{marginRight:"0.4rem"}}),(0,g.jsx)(ey.Qr,{text:x?"Save":"Rename"})]}),(0,g.jsxs)(ey.tc,{style:{padding:"0 0.4rem"},children:[(0,g.jsx)(p.$nz,{style:{marginRight:"0.4rem"}}),(0,g.jsxs)("select",{className:"dropdown-select",value:n.folderId||"_None",onChange:(t=(0,r._)(function(e){var t,s;return(0,m.Jh)(this,function(r){switch(r.label){case 0:return t=e.target.value,[4,eT.v.getOneSerializedFromStorable(n)];case 1:if(!(s=r.sent()))return[2,S.kg.error("Could not find song")];return eC.k.addSongToFolder(s,"_None"!==t?t:null),[2]}})}),function(e){return t.apply(this,arguments)}),children:[(0,g.jsx)("option",{value:"_None",children:"None"}),o.map(function(e){return(0,g.jsx)("option",{value:e.id,children:e.name},e.id)})]})]}),(0,g.jsxs)(ey.tc,{style:{width:"100%"},onClick:(0,r._)(function(){var e,t;return(0,m.Jh)(this,function(s){switch(s.label){case 0:return(null===(e=n)||void 0===e?void 0:e.type)==="recorded"&&S.kg.warn("Converting recorded song to composed, audio might not be accurate"),[4,eT.v.getOneSerializedFromStorable(n)];case 1:if(!(t=s.sent()))return[2,S.kg.error("Could not find song")];return d(t),l(!1),[2]}})}),children:[(0,g.jsx)(p.fmQ,{style:{marginRight:"0.4rem"},size:14}),(0,g.jsx)(ey.Qr,{text:"Edit song"})]}),(0,g.jsxs)(ey.tc,{onClick:(0,r._)(function(){var e;return(0,m.Jh)(this,function(t){switch(t.label){case 0:return[4,eT.v.getOneSerializedFromStorable(n)];case 1:if(!(e=t.sent()))return[2,S.kg.error("Could not find song")];return h(e),[2]}})}),children:[(0,g.jsx)(p.aBF,{style:{marginRight:"0.4rem"}}),(0,g.jsx)(ey.Qr,{text:"Download"})]}),("recorded"===n.type||"composed"===n.type)&&(0,g.jsxs)(ey.tc,{onClick:(0,r._)(function(){return(0,m.Jh)(this,function(e){switch(e.label){case 0:return[4,eT.v.fromStorableSong(n)];case 1:return h(e.sent().toMidi()),[2]}})}),children:[(0,g.jsx)(p.aBF,{style:{marginRight:"0.4rem"},size:14}),(0,g.jsx)(ey.Qr,{text:"Download MIDI"})]}),(0,g.jsxs)(ey.tc,{onClick:(0,r._)(function(){var e,t;return(0,m.Jh)(this,function(s){switch(s.label){case 0:return[4,eT.v.fromStorableSong(n)];case 1:return(t=(e=s.sent()).clone()).name="".concat(e.name," - (clone)"),[4,eC.k.addSong(t)];case 2:return s.sent(),S.kg.log("Cloned song: ".concat(n.name)),[2]}})}),children:[(0,g.jsx)(p.d_e,{style:{marginRight:"0.4rem"}}),(0,g.jsx)(ey.Qr,{text:"Clone song"})]}),(0,g.jsxs)(ey.tc,{onClick:function(){return a(n.name,n.id)},children:[(0,g.jsx)(p.Xm5,{color:"#ed4557",style:{marginRight:"0.4rem"}}),(0,g.jsx)(ey.Qr,{text:"Delete"})]})]})})]})}var eE=(0,f.memo)(function(e){var t,n,s,i=e.data,o=e.functions,a=e.inPreview,l=(0,u._)((0,f.useState)(!1),2),c=l[0],d=l[1],h=(0,u._)((0,f.useState)(!1),2),y=h[0],x=h[1],C=(0,eL.Z)().IS_MIDI_AVAILABLE,w=(0,u._)((0,ek.n)(),1)[0],N=(0,u._)((0,ej.j)(),1)[0],_=(0,u._)((0,f.useState)("Settings"),2),T=_[0],R=_[1],A=o.loadSong,L=o.changePage,M=o.renameSong,I=o.handleSettingChange,E=o.changeVolume,B=o.createNewSong,H=o.changeMidiVisibility,O=o.updateThisSong,F=(0,u._)((0,G.F)(),1)[0],J=(0,eN.ZP)(function(e){$()()?x(!1):d(!1)},{active:c&&y,ignoreFocusable:!0});(0,f.useEffect)(function(){return eS.w.register("Escape",function(){x(!1)},{id:"composer_menu"}),function(){return eS.w.unregisterById("composer_menu")}},[]);var V=(0,f.useCallback)(function(e){"boolean"!=typeof e&&(e=void 0),x(function(t){return void 0!==e?e:!t})},[]),z=(0,f.useCallback)((t=(0,r._)(function(e,t){return(0,m.Jh)(this,function(n){switch(n.label){case 0:return[4,(0,ex.jH)('Are you sure you want to delete the song: "'.concat(e,'"?'))];case 1:if(!n.sent())return[3,3];return[4,eC.k.removeSong(t)];case 2:n.sent(),ep.Z.userSongs("delete",{page:"composer"}),n.label=3;case 3:return[2]}})}),function(e,n){return t.apply(this,arguments)}),[]),Z=(0,f.useCallback)((0,r._)(function(){var e;return(0,m.Jh)(this,function(t){switch(t.label){case 0:return[4,(0,ex.cJ)("Write the folder name")];case 1:if(!(e=t.sent()))return[2];return ew.p.createFolder(e),[2]}})}),[]),W=(0,f.useCallback)(function(e){if(e===T&&c)return d(!1);d(!0),e&&(R(e),ep.Z.UIEvent("menu",{tab:e}))},[c,T]),U=(0,f.useCallback)((n=(0,r._)(function(e){var t,n,s,r,i,o,a,l,c,u,d;return(0,m.Jh)(this,function(h){switch(h.label){case 0:t=!0,n=!1,s=void 0,h.label=1;case 1:h.trys.push([1,8,9,10]),r=e[Symbol.iterator](),h.label=2;case 2:if(t=(i=r.next()).done)return[3,7];o=i.value,h.label=3;case 3:return h.trys.push([3,5,,6]),a=Array.isArray(o.data)?o.data:[o.data],[4,e_.bV.importAndLog(a)];case 4:return h.sent(),[3,6];case 5:if(console.error(l=h.sent()),null===(c=(u=o.file.name).includes)||void 0===c?void 0:c.call(u,".mid"))return[2,S.kg.error("Midi files should be imported in the composer")];return l&&console.error(l),S.kg.error("Error importing file, invalid format",8e3),[3,6];case 6:return t=!0,[3,2];case 7:return[3,10];case 8:return d=h.sent(),n=!0,s=d,[3,10];case 9:try{t||null==r.return||r.return()}finally{if(n)throw s}return[7];case 10:return[2]}})}),function(e){return n.apply(this,arguments)}),[]),X=(0,f.useCallback)((s=(0,r._)(function(e){var t,n,s;return(0,m.Jh)(this,function(r){switch(r.label){case 0:if(r.trys.push([0,3,,4]),!(e instanceof j.Midi))return[3,2];return[4,(0,ex.jH)("If you use MIDI, the song will loose some information, if you want to share the song with others, use the other format (button above). Do you still want to download?")];case 1:if(!r.sent())return[2];return[2,e_.bV.downloadMidi(e)];case 2:return e.data.appName=v.iC,t=e.name,n=eT.v.parseSong(e),s=["Sky"===v.iC&&(n instanceof k.l||n instanceof eR.M)?n.toOldFormat():n.serialize()],e_.bV.downloadSong(s,"".concat(t,".").concat(v.iC.toLowerCase(),"sheet")),S.kg.success("Song downloaded"),ep.Z.userSongs("download",{page:"composer"}),[3,4];case 3:return console.log(r.sent()),S.kg.error("Error downloading song"),[3,4];case 4:return[2]}})}),function(e){return s.apply(this,arguments)}),[]),Y=c&&y?"side-menu menu-open":"side-menu",q=i.hasChanges?"margin-top-auto not-saved":"margin-top-auto",Q=y?"menu menu-visible":"menu";return(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)("div",{className:"hamburger ignore_click_outside",onClick:function(){return x(!y)},children:(0,g.jsx)(el.Z,{children:(0,g.jsx)(p.Fm7,{})})}),(0,g.jsxs)("div",{className:"menu-wrapper ".concat(a?"menu-wrapper-absolute":""),ref:J,children:[(0,g.jsxs)("div",{className:Q,children:[(0,g.jsx)(em.s,{onClick:function(){return V()},className:"close-menu",ariaLabel:"Close menu",children:(0,g.jsx)(p.aHS,{className:"icon"})}),(0,g.jsx)(em.s,{onClick:O,className:q,ariaLabel:"Save",children:(0,g.jsx)(el.Z,{children:(0,g.jsx)(p.TvB,{className:"icon"})})}),(0,g.jsx)(em.s,{onClick:function(){return W("Songs")},isActive:c&&"Songs"===T,ariaLabel:"Song menu",children:(0,g.jsx)(el.Z,{children:(0,g.jsx)(p.HcQ,{className:"icon"})})}),(0,g.jsx)(em.s,{onClick:function(){return W("Settings")},isActive:c&&"Settings"===T,ariaLabel:"Settings menu",children:(0,g.jsx)(el.Z,{children:(0,g.jsx)(p.p4t,{className:"icon"})})}),(0,g.jsx)(em.s,{onClick:function(){return L("Home")},ariaLabel:"Open home menu",children:(0,g.jsx)(el.Z,{children:(0,g.jsx)(p.xng,{className:"icon"})})})]}),(0,g.jsxs)("div",{className:Y,children:[(0,g.jsxs)(eg.Z,{current:T,id:"Songs",children:[(0,g.jsxs)("div",{className:"songs-buttons-wrapper",children:[(0,g.jsx)(P.k,{children:(0,g.jsxs)("ul",{children:[(0,g.jsx)("li",{children:"Click the song name to load it"}),(0,g.jsx)("li",{children:"You can use different instruments for each layer"}),(0,g.jsx)("li",{children:"Tempo changers help you make faster parts of a song without having very high bpm"}),(0,g.jsx)("li",{children:"You can quickly create a song by importing a MIDI file and editing it"}),(0,g.jsx)("li",{children:"You can add breakpoints to the timeline (the bar below the composer) to quickly jump between parts of a song"})]})}),(0,g.jsx)(D.J,{onClick:function(){H(!0),V()},style:{marginLeft:"auto"},children:"Create from MIDI"}),(0,g.jsx)(D.J,{onClick:B,children:"Create new song"})]}),(0,g.jsx)(ev.G,{songs:w,exclude:eM,SongComponent:eI,style:{marginTop:"0.6rem"},onCreateFolder:Z,componentProps:{theme:F,folders:N,functions:{loadSong:A,removeSong:z,toggleMenu:V,downloadSong:X,renameSong:M}}}),(0,g.jsx)("div",{className:"row",style:{justifyContent:"flex-end",gap:"0.2rem"},children:(0,g.jsx)(b.G,{onPick:U,onError:function(e,t){e&&console.error(e);var n=null==t?void 0:t.some(function(e){var t;return null==e?void 0:null===(t=e.name)||void 0===t?void 0:t.endsWith(".mid")}),s=(null==t?void 0:t.length)===1;n&&s?(S.kg.warn("Opening the midi importer to import a MIDI file, please reselect the file",6e3),H(!0),V()):S.kg.error('Error importing file, invalid format, if it\'s a MIDI file, use the "Create from MIDI" button',8e3)},as:"json",multiple:!0,children:(0,g.jsx)(D.J,{children:"Import song sheet"})})}),(0,g.jsx)("div",{className:"songs-buttons-wrapper",style:{marginTop:"auto"},children:(0,g.jsx)(D.J,{style:{marginTop:"0.5rem"},className:"record-btn",onClick:function(){return o.startRecordingAudio(!i.isRecordingAudio)},toggled:i.isRecordingAudio,children:i.isRecordingAudio?"Stop recording audio":"Start recording audio"})})]}),(0,g.jsxs)(eg.Z,{current:T,id:"Settings",children:[(0,g.jsx)(eb.A,{settings:i.settings,onUpdate:I,changeVolume:E}),(0,g.jsxs)("div",{className:"settings-row-wrap",children:[C&&(0,g.jsx)(eA(),{href:"keybinds",children:(0,g.jsx)(D.J,{style:{width:"fit-content"},children:"Connect MIDI keyboard"})}),(0,g.jsx)(eA(),{href:"theme",onClick:function(e){return e.preventDefault()},children:(0,g.jsx)(D.J,{onClick:function(){return L("theme")},style:{width:"fit-content"},children:"Change app theme"})})]}),(0,g.jsx)(ef.Z,{})]})]})]})]})},function(e,t){return e.data.settings===t.data.settings&&e.data.hasChanges===t.data.hasChanges&&e.data.isRecordingAudio===t.data.isRecordingAudio}),eB=n(5839),eH=n(1205),eO=n(2809),eD=n(6138),eF=n(7557);function eJ(e){var t=e.children,n=e.tooltip,s=e.onClick,r=e.style,i=e.ariaLabel;return(0,g.jsxs)("button",{className:"tool ".concat((0,E.h)(n)),onClick:s,style:r,"aria-label":i,children:[t,n&&(0,g.jsx)(E.u,{children:n})]})}var eV=n(5684),ez=n(7516),eZ=n(5736),eW=n(7600),eU=n.n(eW),eX=["circle","border","line"];function eY(e){var t=e.instrument,n=e.onChange,s=e.onDelete,r=e.onClose,i=e.onChangePosition,o=e.currentLayer,a=e.instruments,c=(0,eN.ZP)(r,{active:!0,ignoreFocusable:!0});return t?(0,g.jsxs)("div",{className:"floating-instrument-settings box-shadow",ref:c,children:[(0,g.jsxs)("div",{className:"row space-between",children:["Layer name",(0,g.jsx)("input",{type:"text",maxLength:50,className:"input",style:{width:"7.4rem"},value:t.alias,onChange:function(e){return n(t.set({alias:e.target.value}))},placeholder:(0,C.yX)(t.name)})]}),(0,g.jsxs)("div",{className:"row space-between",style:{marginTop:"0.4rem"},children:["Instrument",(0,g.jsx)(eZ.O,{style:{width:"8rem"},selected:t.name,onChange:function(e){return n(t.set({name:e}))}})]}),(0,g.jsxs)("div",{className:"row space-between",style:{marginTop:"0.4rem"},children:["Pitch",(0,g.jsx)(A.x,{style:{padding:"0.3rem",width:"8rem"},selected:t.pitch,onChange:function(e){return n(t.set({pitch:e}))},children:(0,g.jsx)("option",{value:"",children:"Use song pitch"})})]}),(0,g.jsxs)("div",{className:"row space-between",style:{marginTop:"0.4rem"},children:["Note icon",(0,g.jsx)("select",{className:eU().select,style:{padding:"0.3rem",width:"8rem"},value:t.icon,onChange:function(e){n(t.set({icon:e.target.value})),e.target.blur()},children:eX.map(function(e){return(0,g.jsx)("option",{value:e,children:(0,C.kC)(e)},e)})})]}),(0,g.jsxs)("div",{className:"row",style:{marginTop:"1rem",alignItems:"center"},children:["Volume",(0,g.jsxs)("span",{style:(0,l._)({marginLeft:"0.4rem",width:"3rem"},t.volume>100&&{color:"hsl(0, ".concat(-40+t.volume,"%, 61%)"),marginLeft:"0.4rem"}),children:[t.volume,"%"]}),(0,g.jsx)(P.k,{buttonStyle:{width:"1.2rem",height:"1.2rem"},width:10,children:"If you hear distortion, reduce the volume"})]}),(0,g.jsxs)("div",{className:"row",children:[(0,g.jsx)("input",{type:"range",style:{flex:"1",opacity:t.muted?"0.6":"1"},min:0,max:125,value:t.volume,onChange:function(e){return n(t.set({volume:Number(e.target.value)}))}}),(0,g.jsx)(D.J,{className:"flex-centered",toggled:t.muted,style:{padding:0,minWidth:"unset",width:"1.6rem",height:"1.6rem",borderRadius:"2rem"},onClick:function(){(0!==t.volume||t.muted)&&n(t.set({muted:!t.muted}))},children:t.muted||0===t.volume?(0,g.jsx)(p.xZH,{}):(0,g.jsx)(p.rxG,{})})]}),(0,g.jsxs)("div",{className:"row space-between",style:{marginTop:"1rem"},children:[(0,g.jsxs)(D.J,{onClick:function(){return i(-1)},disabled:0===o,className:"flex-centered",style:{padding:"0.5rem",flex:"1",marginRight:"0.4rem"},children:[(0,g.jsx)(p.ZTc,{style:{marginRight:"0.2rem"}})," Move up"]}),(0,g.jsxs)(D.J,{onClick:function(){return i(1)},disabled:o===a.length-1,className:"flex-centered",style:{padding:"0.5rem",flex:"1"},children:[(0,g.jsx)(p.NWQ,{style:{marginRight:"0.2rem"}})," Move down"]})]}),(0,g.jsxs)("div",{className:"row space-between",style:{marginTop:"0.4rem"},children:[(0,g.jsxs)(D.J,{className:"row-centered",style:{padding:"0.4rem",width:"fit-content"},onClick:s,children:[(0,g.jsx)(p.Xm5,{color:"var(--red)",style:{marginRight:"0.3rem"}}),"Delete"]}),(0,g.jsx)(D.J,{onClick:r,style:{padding:"0.4rem",width:"fit-content"},children:"Ok"})]})]}):(0,g.jsx)("div",{className:"floating-instrument-settings  box-shadow",children:"No instrument selected"})}var eG=(0,f.memo)(function(e){var t=e.instruments,n=e.onInstrumentAdd,s=e.onInstrumentChange,r=e.onInstrumentDelete,i=e.selected,o=e.onLayerSelect,a=e.onChangePosition,l=(0,u._)((0,G.F)(),1)[0],c=(0,u._)((0,f.useState)(!1),2),d=c[0],h=c[1],m=(0,f.useCallback)(function(){h(!1)},[]);return(0,g.jsxs)(g.Fragment,{children:[d&&(0,g.jsx)(eY,{instrument:t[i],currentLayer:i,instruments:t,onChange:function(e){return s(e,i)},onDelete:function(){r(i),m()},onChangePosition:a,onClose:m}),(0,g.jsxs)("div",{className:"column instruments-button-wrapper",children:[t.map(function(e,t){return(0,g.jsx)(eq,{theme:l,instrument:e,isSelected:t===i,onEditClick:function(){return h(!d)},onClick:function(){return o(t)},onVisibleToggle:function(n){return s(e.set({visible:n}),t)}},e.name+t)}),(0,g.jsx)("div",{style:{minHeight:"1rem"}}),(0,g.jsx)(D.J,{onClick:function(e){n(),setTimeout(function(){var t;null===(t=e.target)||void 0===t||t.scrollIntoView()},50)},ariaLabel:"Add new instrument",className:"new-instrument-button flex-centered",children:(0,g.jsx)(p.wEH,{size:16,color:"var(--icon-color)"})})]})]})},function(e,t){return e.instruments===t.instruments&&e.selected===t.selected});function eq(e){var t=e.instrument,n=e.onClick,s=e.isSelected,r=e.theme,i=e.onEditClick,o=e.onVisibleToggle,a=(0,f.useRef)(null);(0,f.useEffect)(function(){s&&a.current&&a.current.scrollIntoView({behavior:"auto",block:"nearest"})},[s,a]);var l=r.getText("primary");return l=l.isDark()?l.lighten(.2):l.darken(.15),(0,g.jsxs)("div",{ref:a,className:"instrument-button flex-centered ".concat(s?"instrument-button-selected":""),style:s?{backgroundColor:r.get("primary").mix(r.get("accent")).toString()}:{},children:[!s&&(0,g.jsxs)("div",{className:"row",style:{position:"absolute",gap:"0.2rem",top:"0.2rem",left:"0.3rem"},children:[!t.visible&&(0,g.jsx)(p.tgn,{color:l.hex(),size:14}),t.muted&&(0,g.jsx)(p.xZH,{color:l.hex(),size:14})]}),!s&&(0,g.jsxs)("div",{style:{position:"absolute",top:"0.4rem",right:"0.4rem",height:"fit-content"},children:["circle"===t.icon&&(0,g.jsx)(p.gbA,{size:8,style:{display:"block"},color:l.hex()}),"border"===t.icon&&(0,g.jsx)(ez.orY,{size:12,style:{display:"block",marginRight:"-2px",marginTop:"-2px",strokeWidth:"2px"},color:l.hex()}),"line"===t.icon&&(0,g.jsx)(p.iFH,{size:8,style:{display:"block"},color:l.hex()})]}),(0,g.jsx)(D.J,{onClick:n,style:{backgroundColor:"transparent",width:"100%"},className:"flex-grow flex-centered instrument-name-button",children:(0,g.jsx)("span",{className:"text-ellipsis",style:{width:"6rem"},children:t.alias||(0,C.yX)(t.name)})}),s&&(0,g.jsxs)("div",{className:"instrument-settings",children:[(0,g.jsx)(D.J,{onClick:function(){return i()},ariaLabel:"Settings",className:"flex-centered",children:(0,g.jsx)(p.p4t,{size:15})}),(0,g.jsx)(D.J,{onClick:function(){return o(!t.visible)},ariaLabel:t.visible?"Hide":"Show",className:"flex-centered",children:t.visible?(0,g.jsx)(p.dSq,{size:16}):(0,g.jsx)(p.tgn,{size:16})})]})]})}var eQ=n(4995),eK=n(1163),e$=n(6880),e0=n(8868),e1=function(e){(0,a._)(n,e);var t=(0,h._)(n);function n(e){(0,i._)(this,n),(_=t.call(this,e)).unblock=function(){},_.cleanup=[];var o,a,h,g,f,p,y,x,b,j,w,_,T=(0,s._)(_);_.init=(o=(0,r._)(function(e){var t,n,s;return(0,m.Jh)(this,function(r){switch(r.label){case 0:return[4,T.syncInstruments()];case 1:r.sent(),eF.n.setReverb(e.caveMode.value),eD.mP.addListener(T.handleMidi),v.nq.forEach(function(e,t){eS.w.registerNumber(t+1,function(){return T.handleTempoChanger(e)},{id:"composer_keyboard"})}),r.label=2;case 2:if(r.trys.push([2,4,,5]),!(t=T.props.songId))return[2];return[4,eT.v.getSongById(t)];case 3:if(!(n=r.sent()))return[2];return T.loadSong(n),[3,5];case 4:return s=r.sent(),console.log("Error loading song"),console.error(s),[3,5];case 5:return[2]}})}),function(e){return o.apply(this,arguments)}),_.handleKeyboardShortcut=function(e){var t=e.shortcut,n=e.event;if(!n.repeat&&(_.state.isPlaying||n.shiftKey)){var s=_.currentInstrument.getNoteFromCode(t.name);null!==s&&_.handleClick(s)}},_.handleShortcut=function(e){var t,n,s,r,i=e.shortcut,o=e.event,a=_.state,l=a.isPlaying,c=a.layer,u=a.layers,d=a.settings,h=a.song,m=i.name;if("next_column"!==m||l||_.selectColumn(h.selected+1),"previous_column"!==m||l||_.selectColumn(h.selected-1),"remove_column"!==m||l||_.removeColumns(1,h.selected),"add_column"!==m||l||_.addColumns(1,h.selected),"previous_layer"===m){var g=c-1;g>=0&&_.changeLayer(g)}if("next_layer"===m){var f=c+1;f<u.length&&_.changeLayer(f)}if("toggle_play"===m){if(o.repeat)return;(null===(t=o.target)||void 0===t?void 0:t.tagName)==="BUTTON"&&(null===(n=o.target)||void 0===n||n.blur()),_.togglePlay(),d.syncTabs.value&&(null===(r=_.broadcastChannel)||void 0===r||null===(s=r.postMessage)||void 0===s||s.call(r,l?"play":"stop"))}},_.handleUnload=function(e){e.preventDefault(),e.returnValue=""},_.handleAutoSave=function(){_.changes++,_.changes>5&&_.state.settings.autosave.value&&"Untitled"!==_.state.song.name&&_.updateSong(_.state.song)},_.handleMidi=function(e){var t=(0,u._)(e,3),n=t[0],s=t[1],r=t[2];if(_.mounted){var i=_.state,o=i.song,a=i.layer;if(eD.mP.isDown(n)&&0!==r){eD.mP.settings.notes.filter(function(e){return e.midi===s}).forEach(function(e){_.handleClick(_.currentInstrument.notes[e.index])});var l=eD.mP.settings.shortcuts.find(function(e){return e.midi===s});if(!l)return;switch(l.type){case"toggle_play":_.togglePlay();break;case"next_column":_.selectColumn(o.selected+1);break;case"previous_column":_.selectColumn(o.selected-1);break;case"add_column":_.addColumns(1,o.selected);break;case"remove_column":_.removeColumns(1,o.selected);break;case"change_layer":var c=a+1;c>=_.state.layers.length&&(c=0),_.changeLayer(c)}}}},_.updateSettings=function(e){eV.j.updateComposerSettings(void 0!==e?e:_.state.settings)},_.handleSettingChange=function(e){var t=e.data,n=e.key,s=_.state,r=s.song,i=s.settings;i[n]=(0,c._)((0,l._)({},i[n]),{value:t.value}),t.songSetting&&(r[n]=t.value),"caveMode"===n&&eF.n.setReverb(t.value),_.setState({settings:(0,l._)({},i),song:r},_.updateSettings)},_.addInstrument=function(){var e=_.state.song,t=e0.X.get().IS_UMA_MODE;if(e.instruments.length>=R.u.MAX_LAYERS&&!t)return S.kg.error("You can't add more than ".concat(R.u.MAX_LAYERS," instruments!"));e.addInstrument(v.BX[0]),_.setState({song:e}),_.syncInstruments(e)};var P=(0,s._)(_);_.removeInstrument=(a=(0,r._)(function(e){var t,n,s;return(0,m.Jh)(this,function(r){switch(r.label){case 0:if(n=(t=P.state).song,(s=t.layers).length<=1)return[2,S.kg.warn("You can't remove all layers!")];return[4,(0,ex.jH)("Are you sure you want to remove ".concat(s[e].name,"? ALL NOTES OF THIS LAYER WILL BE DELETED"))];case 1:return r.sent()&&(n.removeInstrument(e),P.syncInstruments(n),P.setState({song:n,layer:Math.max(0,e-1)})),[2]}})}),function(e){return a.apply(this,arguments)}),_.editInstrument=function(e,t){var n=_.state.song;n.instruments[t]=e.clone(),n.instruments=(0,d._)(n.instruments),_.syncInstruments(n),_.setState({song:n})};var A=(0,s._)(_);_.syncInstruments=(h=(0,r._)(function(e){var t,n,s;return(0,m.Jh)(this,function(i){switch(i.label){case 0:var o;if(t=A.state.layers,e||(e=A.state.song),t.splice(e.instruments.length).forEach(function(e){eF.n.disconnect(e.endNode),e.dispose()}),n=e.instruments.map((o=(0,r._)(function(e,n){var s,r,i;return(0,m.Jh)(this,function(o){switch(o.label){case 0:if(void 0!==t[n])return[3,2];return s=new eB.ZP(e.name),t[n]=s,[4,s.load(eF.n.getAudioContext())];case 1:if(o.sent()||S.kg.error("There was an error loading the instrument"),!A.mounted)return[2,s.dispose()];return eF.n.connect(s.endNode),s.changeVolume(e.volume),[2,s];case 2:if(t[n].name!==e.name)return[3,3];return t[n].changeVolume(e.volume),[2,t[n]];case 3:return r=t[n],eF.n.disconnect(r.endNode),r.dispose(),i=new eB.ZP(e.name),t[n]=i,[4,i.load(eF.n.getAudioContext())];case 4:if(o.sent()||S.kg.error("There was an error loading the instrument"),!A.mounted)return[2,i.dispose()];return eF.n.connect(i.endNode),i.changeVolume(e.volume),[2,i];case 5:return[2]}})}),function(e,t){return o.apply(this,arguments)})),!A.mounted)return[2];return[4,Promise.all(n)];case 1:return s=i.sent(),A.setState({layers:s}),[2]}})}),function(e){return h.apply(this,arguments)}),_.changeVolume=function(e){var t=_.state.settings,n=Number(e.key.split("layer")[1])-1;t[e.key]=(0,c._)((0,l._)({},t[e.key]),{volume:e.value}),_.state.layers[n].changeVolume(e.value),_.setState({settings:(0,l._)({},t)},_.updateSettings)};var L=(0,s._)(_);_.startRecordingAudio=(g=(0,r._)(function(e){var t,n;return(0,m.Jh)(this,function(s){switch(s.label){case 0:if(!L.mounted)return[2];if(!e)return L.setState({isRecordingAudio:!1}),[2,L.togglePlay(!1)];return eF.n.startRecording(),L.setState({isRecordingAudio:!0}),[4,(0,C.gw)(300)];case 1:return s.sent(),[4,L.togglePlay(!0)];case 2:if(s.sent(),!L.mounted)return[2];return L.setState({isRecordingAudio:!1}),[4,eF.n.stopRecording()];case 3:if(!(t=s.sent()))return[2];return[4,(0,ex.cJ)("Write the song name, press cancel to ignore")];case 4:n=s.sent(),s.label=5;case 5:if(s.trys.push([5,8,,9]),!n)return[3,7];return[4,eH.Z.downloadBlob(t.data,n+".wav")];case 6:s.sent(),s.label=7;case 7:return[3,9];case 8:return console.error(s.sent()),S.kg.error("There was an error downloading the audio, maybe it's too big?"),[3,9];case 9:return[2]}})}),function(e){return g.apply(this,arguments)}),_.playSound=function(e,t,n){var s=_.state.layers[e],r=null==s?void 0:s.notes[t];if(void 0!==r&&!_.state.song.instruments[e].muted){var i=_.state.song.instruments[e].pitch||_.state.settings.pitch.value;s.play(r.index,i,n)}},_.changePitch=function(e){var t=_.state.settings;t.pitch=(0,c._)((0,l._)({},t.pitch),{value:e}),_.setState({settings:(0,l._)({},t)},_.updateSettings)},_.handleClick=function(e){var t=_.state,n=t.song,s=t.layer,r=n.selectedColumn,i=r.getNoteIndex(e.index);if(null===i)r.addNote(e.index).setLayer(s,!0);else{var o=r.notes[i];o.toggleLayer(s),o.layer.isEmpty()&&r.removeAtIndex(i)}_.setState({song:n}),_.handleAutoSave(),_.playSound(s,e.index)};var M=(0,s._)(_);_.renameSong=(f=(0,r._)(function(e,t){var n;return(0,m.Jh)(this,function(s){switch(s.label){case 0:return n=M.state.song,[4,eC.k.renameSong(t,e)];case 1:return s.sent(),M.state.song.id===t&&(n.name=e,M.setState({song:n})),[2]}})}),function(e,t){return f.apply(this,arguments)}),_.addSong=(p=(0,r._)(function(e){var t;return(0,m.Jh)(this,function(n){switch(n.label){case 0:return[4,eC.k.addSong(e)];case 1:return t=n.sent(),e.id=t,[2,e]}})}),function(e){return p.apply(this,arguments)});var I=(0,s._)(_);_.updateSong=(y=(0,r._)(function(e){var t;return(0,m.Jh)(this,function(n){switch(n.label){case 0:if("Untitled"!==e.name)return[3,3];return[4,(0,ex.cJ)("Write song name, press cancel to ignore")];case 1:if(null===(t=n.sent())||!I.mounted)return[2,!1];return e.name=t,I.changes=0,I.setState({}),[4,I.addSong(e)];case 2:return n.sent(),[2,!0];case 3:var s;return[2,new Promise((s=(0,r._)(function(t){var n,s;return(0,m.Jh)(this,function(r){switch(r.label){case 0:return[4,eT.v.getSongById(e.id)];case 1:if(!(n=r.sent()))return[3,3];return e.folderId=n.folderId,[4,eC.k.updateSong(e)];case 2:return r.sent(),console.log("song saved:",e.name),I.changes=0,I.setState({}),[3,6];case 3:if(!e.name.includes("- Composed"))return[3,5];return[4,(0,ex.cJ)("Write the song name for the composed version, press cancel to ignore")];case 4:if(null===(s=r.sent()))return[2,t(!1)];return e.name=s,I.addSong(e),[2,t(!0)];case 5:console.log("song doesn't exist"),e.name="Untitled",I.updateSong(e),r.label=6;case 6:return t(!0),[2]}})}),function(e){return s.apply(this,arguments)}))]}})}),function(e){return y.apply(this,arguments)});var E=(0,s._)(_);_.updateThisSong=(0,r._)(function(){return(0,m.Jh)(this,function(e){return E.updateSong(E.state.song),[2]})});var B=(0,s._)(_);_.askForSongUpdate=(0,r._)(function(){return(0,m.Jh)(this,function(e){switch(e.label){case 0:return[4,(0,ex.jH)('You have unsaved changes to the song: "'.concat(B.state.song.name,'" do you want to save now?'),!1)];case 1:return[2,e.sent()]}})});var H=(0,s._)(_);_.createNewSong=(0,r._)(function(){var e,t,n,s;return(0,m.Jh)(this,function(r){switch(r.label){case 0:if(!("Untitled"!==H.state.song.name&&H.changes>0))return[3,3];return[4,H.askForSongUpdate()];case 1:if(null===(e=r.sent()))return[2];if(!e)return[3,3];return[4,H.updateSong(H.state.song)];case 2:r.sent(),r.label=3;case 3:return[4,(0,ex.cJ)("Write song name, press cancel to ignore")];case 4:if(null===(t=r.sent())||(n=new k.l(t,[v.BX[0],v.BX[0],v.BX[0]]),H.changes=0,!H.mounted))return[2];return[4,H.addSong(n)];case 5:if(s=r.sent(),!H.mounted)return[2];return H.setState({song:s,layer:0}),ep.Z.songEvent({type:"create"}),[2]}})});var O=(0,s._)(_);_.loadSong=(x=(0,r._)(function(e){var t,n,s,r,i;return(0,m.Jh)(this,function(o){switch(o.label){case 0:if(o.trys.push([0,5,,6]),t=O.state,n=null,e instanceof k.l?n=e:("recorded"===e.type&&(n=eR.M.deserialize(e).toComposedSong(4),n.name+=" - Composed"),"composed"===e.type&&(n=k.l.deserialize(e))),!n)return[2];if(!(0!==O.changes))return[3,4];if(!(!(s=t.settings.autosave.value&&"Untitled"!==t.song.name)&&t.song.columns.length>0))return[3,2];return[4,(0,ex.jH)('You have unsaved changes to the song: "'.concat(t.song.name,'" do you want to save? UNSAVED CHANGES WILL BE LOST'),!1)];case 1:if(null===(r=o.sent()))return[2];s=r,o.label=2;case 2:if(!s)return[3,4];return[4,O.updateSong(t.song)];case 3:if(o.sent(),t.song.name===n.name)return[2];o.label=4;case 4:if((i=O.state.settings).bpm=(0,c._)((0,l._)({},i.bpm),{value:e.bpm}),i.pitch=(0,c._)((0,l._)({},i.pitch),{value:e.pitch}),!O.mounted)return[2];return O.changes=0,console.log("song loaded"),O.setState({layer:0,song:n,settings:(0,l._)({},i),selectedColumns:[]},function(){return O.syncInstruments()}),[3,6];case 5:return console.error(o.sent()),S.kg.error("There was an error loading this song"),[3,6];case 6:return[2]}})}),function(e){return x.apply(this,arguments)}),_.addColumns=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"end";return new Promise(function(n){var s=_.state.song;s.addColumns(e,t),1===e&&_.selectColumn(s.selected+1),_.handleAutoSave(),_.setState({song:s},n)})},_.removeColumns=function(e,t){var n=_.state,s=n.song,r=n.settings;s.columns.length<4*r.beatMarks.value||(s.removeColumns(e,t),s.columns.length<=s.selected&&_.selectColumn(s.selected-1),_.handleAutoSave(),_.setState({song:s}))};var D=(0,s._)(_);_.togglePlay=(b=(0,r._)(function(e){return(0,m.Jh)(this,function(t){return[2,new Promise(function(t){var n="boolean"==typeof e?e:!D.state.isPlaying;D.setState({isPlaying:n},(0,r._)(function(){var e,n,s,r,i,o,a,l;return(0,m.Jh)(this,function(c){switch(c.label){case 0:D.state.isPlaying&&D.selectColumn(D.state.song.selected,!1,D.state.settings.lookaheadTime.value/1e3),e=0,n=Date.now(),c.label=1;case 1:if(!D.state.isPlaying)return[3,3];return r=(s=D.state).song,i=s.settings,o=r.selectedColumn.getTempoChanger().changer,a=Math.floor(6e4/i.bpm.value*o+e),n=Date.now(),[4,(0,C.gw)(a)];case 2:if(c.sent(),!D.state.isPlaying||!D.mounted)return[3,3];return e=n+a-Date.now(),l=i.lookaheadTime.value/1e3,D.handlePlaybackTick(Math.max(0,l+e/1e3)),[3,1];case 3:return t(),[2]}})}))})]})}),function(e){return b.apply(this,arguments)}),_.handlePlaybackTick=function(e){var t=_.state.song.selected+1;if(_.state.isPlaying&&t>_.state.song.columns.length-1)return _.togglePlay(!1);_.selectColumn(t,!1,e)},_.toggleBreakpoint=function(e){var t=_.state.song;t.toggleBreakpoint(e),_.validateBreakpoints(),_.setState({song:t})},_.handleTempoChanger=function(e){var t=_.state,n=t.song,s=t.selectedColumns;s.length?(_.addToHistory(),s.forEach(function(t){var s;null===(s=n.columns[t])||void 0===s||s.setTempoChanger(e)})):n.selectedColumn.setTempoChanger(e),_.handleAutoSave(),_.setState({song:n})};var F=(0,s._)(_);_.changePage=(j=(0,r._)(function(e){var t,n,s;return(0,m.Jh)(this,function(r){switch(r.label){case 0:if(n=(t=F.state).song,s=t.settings,"Home"===e)return[2,eO.I.open()];if(!(0!==F.changes))return[3,5];if(!s.autosave.value)return[3,2];return[4,F.updateSong(n)];case 1:return r.sent(),[3,5];case 2:return[4,(0,ex.jH)('You have unsaved changes to the song: "'.concat(n.name,'" do you want to save? UNSAVED CHANGES WILL BE LOST'),!1)];case 3:if(!r.sent())return[3,5];return[4,F.updateSong(n)];case 4:if(!r.sent())return[2,console.log("Blocking redirect")];r.label=5;case 5:return F.props.router.events.off("routeChangeStart",F.unblock),F.props.router.push((0,C.k8)(e)),[2]}})}),function(e){return j.apply(this,arguments)}),_.selectColumn=function(e,t,n){var s=_.state,r=s.song,i=s.isToolsVisible,o=s.layers,a=s.copiedColumns,l=_.state.selectedColumns;if(!(e<0)&&!(e>r.columns.length-1)){if(r.selected=e,i&&0===a.length){l.push(e);var c,u,h=(c=Math).min.apply(c,(0,d._)(l));l=Array((u=Math).max.apply(u,(0,d._)(l))-h+1).fill(0).map(function(e,t){return h+t})}_.setState({song:r,selectedColumns:l}),t||r.selectedColumn.notes.forEach(function(e){o.forEach(function(t,s){e.isLayerToggled(s)&&_.playSound(s,e.index,n)})})}},_.selectColumnFromDirection=function(e){_.selectColumn(_.state.song.selected+e)},_.changeLayer=function(e){_.setState({layer:e})},_.toggleTools=function(){_.setState({isToolsVisible:!_.state.isToolsVisible,selectedColumns:_.state.isToolsVisible?[]:[_.state.song.selected],copiedColumns:[],undoHistory:[]})},_.resetSelection=function(){_.setState({copiedColumns:[],selectedColumns:[_.state.song.selected]})},_.addToHistory=function(){var e=_.state,t=e.song,n=e.undoHistory;e.isToolsVisible&&_.setState({undoHistory:(0,d._)(n).concat([t.clone().columns])})},_.undo=function(){var e=_.state,t=e.undoHistory,n=e.song,s=t.pop();s&&(n.columns=s,n.selected=n.columns.length>n.selected?n.selected:n.columns.length-1,_.setState({undoHistory:(0,d._)(t),song:n},function(){setTimeout(function(){_.mounted&&_.setState({})},100)}))},_.copyColumns=function(e){var t=_.state,n=t.selectedColumns,s=t.song.copyColumns(n,e);_.changes++,_.setState({selectedColumns:[],copiedColumns:s})};var J=(0,s._)(_);_.pasteColumns=(w=(0,r._)(function(e,t){var n,s,r;return(0,m.Jh)(this,function(i){return s=(n=J.state).song,r=n.copiedColumns,J.addToHistory(),"all"===t?s.pasteColumns(r,e):Number.isFinite(t)&&s.pasteLayer(r,e,t),J.syncInstruments(),J.changes++,J.setState({song:s}),[2]})}),function(e,t){return w.apply(this,arguments)}),_.eraseColumns=function(e){var t=_.state,n=t.song,s=t.selectedColumns;_.addToHistory(),n.eraseColumns(s,e),_.changes++,_.setState({song:n,selectedColumns:[n.selected]})},_.moveNotesBy=function(e,t){var n=_.state,s=n.song,r=n.selectedColumns;_.addToHistory(),s.moveNotesBy(r,e,t),_.changes++,_.setState({song:s})},_.switchLayerPosition=function(e){var t=_.state,n=t.song,s=t.layer,r=s+e;if(!(r<0)&&!(r>n.instruments.length-1)){n.swapLayer(n.columns.length,0,s,r);var i=n.instruments[s];n.instruments[s]=n.instruments[r],n.instruments[r]=i,n.instruments=(0,d._)(n.instruments),_.changes++,_.syncInstruments(),_.setState({song:n,layer:r})}};var V=(0,s._)(_);_.deleteColumns=(0,r._)(function(){var e,t,n;return(0,m.Jh)(this,function(s){return t=(e=V.state).song,n=e.selectedColumns,V.addToHistory(),t.deleteColumns(n),V.changes++,V.setState({song:t,selectedColumns:[t.selected]},V.validateBreakpoints),[2]})}),_.validateBreakpoints=function(){var e=_.state.song;e.validateBreakpoints(),_.setState({song:e})},_.changeMidiVisibility=function(e){_.setState({isMidiVisible:e}),e&&ep.Z.songEvent({type:"create_MIDI"})};var z=eV.j.getDefaultComposerSettings();return _.state={layers:[new eB.ZP(v.BX[1])],isPlaying:!1,song:new k.l("Untitled",[v.BX[0],v.BX[0],v.BX[0]]),settings:z,layer:0,selectedColumns:[],undoHistory:[],copiedColumns:[],isToolsVisible:!1,isMidiVisible:!1,isRecordingAudio:!1,theme:N.f6},_.state.song.bpm=z.bpm.value,_.mounted=!1,_.changes=0,_.broadcastChannel=null,_}var f=n.prototype;return f.componentDidMount=function(){var e=this;this.mounted=!0;var t=eV.j.getComposerSettings(),n=(0,ed.JZ)("composer","composer_shortcuts",this.handleShortcut),s=(0,ed.JP)("composer_shortcuts_keyboard",this.handleKeyboardShortcut);this.cleanup.push(s,n),this.setState({settings:t}),this.init(t),this.broadcastChannel=window.BroadcastChannel?new BroadcastChannel(v.iC+"_composer"):null,this.broadcastChannel&&this.broadcastChannel.addEventListener("message",function(t){e.state.settings.syncTabs.value&&["play","stop"].includes(null==t?void 0:t.data)&&e.togglePlay("play"===t.data)}),this.unblock=function(t){if(0!==e.changes)throw e.changePage(t),e.props.router.events.emit("routeChangeError"),"routeChange aborted.";e.props.router.events.off("routeChangeStart",e.unblock),e.props.router.push((0,C.k8)(t))},this.props.router.events.on("routeChangeStart",this.unblock),"localhost"!==window.location.hostname&&window.addEventListener("beforeunload",this.handleUnload)},f.componentWillUnmount=function(){var e,t,n=this.state,s=n.layers;this.mounted=!1,eF.n.clear(),s.forEach(function(e){return e.dispose()}),null===(t=this.broadcastChannel)||void 0===t||null===(e=t.close)||void 0===e||e.call(t),n.isPlaying=!1,this.props.router.events.off("routeChangeStart",this.unblock),this.cleanup.forEach(function(e){return e()}),eS.w.unregisterById("composer"),eD.mP.removeListener(this.handleMidi),eF.n.isRecording&&eF.n.stopRecording(),"localhost"!==window.location.hostname&&window.removeEventListener("beforeunload",this.handleUnload)},f.render=function(){var e,t=this,n=this.state,s=n.isMidiVisible,r=n.song,i=n.isPlaying,o=n.copiedColumns,a=n.settings,l=n.isRecordingAudio,c=n.isToolsVisible,u=n.layer,d=n.selectedColumns,h=n.undoHistory,m=(0,C.wU)(r.columns,a.bpm.value,r.selected);return(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(eQ.D,{text:"Composer - ".concat(r.name),description:"Create or edit new songs with the composer, using up to 30 layers, tempo changers, multiple instruments and pitches. You can also convert a MIDI song into the app format."}),s&&(0,g.jsx)(O,{functions:this,data:{instruments:r.instruments,selectedColumn:r.selected}}),(0,g.jsxs)("div",{className:"composer-grid appear-on-mount",children:[(0,g.jsxs)("div",{className:"column composer-left-control",children:[(0,g.jsx)(D.J,{className:"flex-centered",style:{height:"3rem",minHeight:"3rem",borderRadius:"0.3rem",backgroundColor:"var(--primary-darken-10)"},onClick:function(e){if(t.togglePlay(),a.syncTabs.value){var n,s;null===(s=t.broadcastChannel)||void 0===s||null===(n=s.postMessage)||void 0===n||n.call(s,i?"stop":"play")}},ariaLabel:i?"Pause":"Play",children:(0,g.jsx)(el.Z,{children:i?(0,g.jsx)(p.Wh,{size:18,color:"var(--icon-color)"},"pause"):(0,g.jsx)(p.gmG,{size:18,color:"var(--icon-color)"},"play")})}),(0,g.jsx)(eG,{instruments:r.instruments,selected:u,onLayerSelect:this.changeLayer,onInstrumentAdd:this.addInstrument,onInstrumentChange:this.editInstrument,onInstrumentDelete:this.removeInstrument,onChangePosition:this.switchLayerPosition})]}),(0,g.jsx)("div",{className:"top-panel-composer",style:{gridArea:"b"},children:(0,g.jsxs)("div",{className:"row",style:{height:"fit-content",width:"100%"},children:[(0,g.jsx)(eh,{functions:this,data:{inPreview:this.props.inPreview,isRecordingAudio:l,currentLayer:u,isPlaying:i,song:r,settings:a,selectedColumns:d,columns:r.columns,selected:r.selected,breakpoints:r.breakpoints}},a.columnsPerCanvas.value),(0,g.jsxs)("div",{className:"buttons-composer-wrapper-right",children:[(0,g.jsx)(eJ,{onClick:function(){return t.addColumns(1,r.selected)},tooltip:"Add column",ariaLabel:"Add column",children:(0,g.jsx)(el.Z,{children:(0,g.jsx)(y,{className:"tool-icon"})})}),(0,g.jsx)(eJ,{onClick:function(){return t.removeColumns(1,r.selected)},tooltip:"Remove column",ariaLabel:"Remove column",children:(0,g.jsx)(el.Z,{children:(0,g.jsx)(x,{className:"tool-icon"})})}),(0,g.jsx)(eJ,{onClick:function(){return t.addColumns(4*Number(a.beatMarks.value),"end")},tooltip:"Add new page",ariaLabel:"Add new page",children:(0,g.jsx)(el.Z,{children:(0,g.jsx)(p.wEH,{size:16})})}),(0,g.jsx)(eJ,{onClick:this.toggleTools,tooltip:"Open tools",ariaLabel:"Open tools",children:(0,g.jsx)(el.Z,{children:(0,g.jsx)(p.CP_,{size:16})})})]})]})}),(0,g.jsx)(q,{functions:this,data:{isPlaying:i,settings:a,isRecordingAudio:l,currentLayer:u,instruments:r.instruments,keyboard:n.layers[u],currentColumn:r.selectedColumn,pitch:(null===(e=r.instruments[u])||void 0===e?void 0:e.pitch)||a.pitch.value,noteNameType:a.noteNameType.value}})]}),(0,g.jsx)(eE,{data:{isRecordingAudio:l,settings:a,hasChanges:this.changes>0},functions:this,inPreview:this.props.inPreview}),(0,g.jsx)(V,{data:{isToolsVisible:c,layer:u,hasCopiedColumns:o.length>0,selectedColumns:d,undoHistory:h},functions:this}),(0,g.jsxs)("div",{className:"song-info",children:[(0,g.jsx)("div",{className:"text-ellipsis",children:r.name}),(0,g.jsxs)("div",{children:[(0,C.dH)(m.current),"/",(0,C.dH)(m.total)]})]})]})},(0,o._)(n,[{key:"currentInstrument",get:function(){return this.state.layers[this.state.layer]}}]),n}(f.Component);function e2(e){var t,n=e.inPreview,s=e.songId,r=(0,eK.useRouter)(),i=r.query.songId;return(0,g.jsx)(e1,{router:r,songId:null!==(t=null!=i?i:s)&&void 0!==t?t:null,inPreview:null!=n&&n})}e2.getLayout=function(e){return(0,g.jsx)(e$.Z,{page:"Composer",children:e})}}}]);