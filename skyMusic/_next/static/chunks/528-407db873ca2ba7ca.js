(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[528],{6528:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return eB}});var r=n(2678),a=n(1010),s=n(8564),o=n(8007),i=n(2253),c=n(4932),l=n(4586),u=n(3304),d=n(7582),h=n(5893),p=n(7294),g=n(1309),m=n(2169),f=n(8376),y=n(2114),v=n(8949),x=n(5829),S=n(3707);function k(){var e=x.f6.get("note_background");return"Genshin"!==m.iC?e.isDark()?m.kx.text.light:m.kx.text.dark:e.luminosity()>.65?m.kx.text.note:e.isDark()?m.kx.text.light:m.kx.text.dark}var b=(0,p.memo)(function(e){var t,n,r,a=e.note,s=e.approachingNotes,o=e.handleClick,c=e.noteText,l=e.data,u=(0,g._)((0,p.useState)(k()),2),d=u[0],b=u[1];(0,p.useEffect)(function(){return(0,v.N7)(x.f6.state.data,function(){b(k())})},[]);var w=(0,S.$d)(a.data),C=l.approachRate,_=l.instrument,N={transition:"background-color ".concat(w.delay,"ms  ").concat(w.delay===("Genshin"===m.iC?100:200)?"ease":"linear"," , transform 0.15s, border-color 100ms")},P=null===(n=m.as[_])||void 0===n?void 0:n.clickColor;return(0,h.jsxs)("button",{onPointerDown:function(e){e.preventDefault(),o(a)},className:"button-hitbox-bigger",children:[s.map(function(e){return(0,h.jsx)(j,{index:e.index,approachRate:C},e.id)}),0!==w.animationId&&(0,h.jsx)("div",{style:P&&x.f6.isDefault("accent")?{borderColor:P}:{},className:m.Al.noteAnimation},w.animationId),(0,h.jsxs)("div",{className:"".concat(m.Al.note," ").concat(function(e){switch(e){case"clicked":return"click-event";case"toClick":return"note-red";case"toClickNext":return"note-border-click";case"toClickAndNext":return"note-red note-border-click";case"approach-wrong":return"click-event approach-wrong";case"approach-correct":return"click-event approach-correct";default:return""}}(a.status)),style:(0,i._)({},N,P&&"clicked"===w.status&&x.f6.isDefault("accent")?{backgroundColor:P}:{}),children:["Genshin"===m.iC&&(0,h.jsx)(f.Z,{className:"genshin-border",fill:"clicked"===(t=w.status)?"transparent":"toClickNext"===t||"toClickAndNext"===t?"#63aea7":"var(--note-border-fill)"}),(0,h.jsx)(y.Z,{name:a.noteImage,color:x.f6.isDefault("accent")?null===(r=m.as[_])||void 0===r?void 0:r.fill:void 0,background:"clicked"===w.status?P&&x.f6.isDefault("accent")?P:"var(--accent)":"var(--note-background)"}),(0,h.jsx)("div",{className:m.Al.noteName,style:{color:d},children:c})]})]})},function(e,t){return e.note===t.note&&e.data.approachRate===t.data.approachRate&&e.data.instrument===t.data.instrument&&e.handleClick===t.handleClick&&e.noteText===t.noteText&&e.approachingNotes===t.approachingNotes}),j=(0,p.memo)(function(e){var t,n=e.approachRate,r=e.index;return(0,h.jsx)("div",{className:m.Al.approachCircle,style:{animation:"approach ".concat(n,"ms linear"),borderColor:0===(t=Math.floor(r/("Sky"===m.iC?5:7)))?"var(--accent)":1===t?x.f6.get("accent").rotate(180).hex():"var(--accent)"}})},function(e,t){return e.approachRate===t.approachRate&&e.index===t.index}),w=n(2267),C=function(){function e(){var t=this;(0,s._)(this,e),this.state={song:null,playId:0,eventType:"stop",start:0,end:0},this.keyboard=[],this.setKeyboardLayout=function(e){var n;(n=t.keyboard).splice.apply(n,[0,t.keyboard.length].concat((0,l._)(e)))},this.resetKeyboardLayout=function(){t.keyboard.forEach(function(e){return e.setState({status:"",delay:"Genshin"===m.iC?100:200})})},this.resetOutgoingAnimation=function(){t.keyboard.forEach(function(e){return e.setState({animationId:0})})},this.setNoteState=function(e,n){t.keyboard[e].setState(n)},this.setState=function(e){Object.assign(t.state,e)},this.play=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0;t.setState({song:e,start:n,eventType:"play",end:r,playId:t.state.playId+1})},this.practice=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0;t.setState({song:e,start:n,eventType:"practice",end:r,playId:t.state.playId+1})},this.approaching=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0;t.setState({song:e,start:n,eventType:"approaching",end:r,playId:t.state.playId+1})},this.resetSong=function(){t.setState({song:null,eventType:"stop",start:0,end:0,playId:0})},this.restartSong=function(e,n){t.setState({start:e,end:n,playId:t.state.playId+1})},(0,v.rC)(this)}return(0,w._)(e,[{key:"song",get:function(){return this.state.song}},{key:"eventType",get:function(){return this.state.eventType}},{key:"start",get:function(){return this.state.start}}]),e}();(0,d.gn)([v.LO],C.prototype,"state",void 0),(0,d.gn)([v.LO],C.prototype,"keyboard",void 0),(0,d.gn)([v.aD],C.prototype,"setKeyboardLayout",void 0),(0,d.gn)([v.aD],C.prototype,"resetKeyboardLayout",void 0),(0,d.gn)([v.aD],C.prototype,"resetOutgoingAnimation",void 0),(0,d.gn)([v.aD],C.prototype,"setNoteState",void 0),(0,d.gn)([v.aD],C.prototype,"setState",void 0);var _=new C,N=n(6743),P=n(5453),I=function(){function e(){var t=this;(0,s._)(this,e),this.state={position:0,current:0,size:0,end:0},this.pagesState={pages:[],currentPageIndex:0,currentChunkIndex:0,currentPage:[]},this.score={correct:1,wrong:1,score:0,combo:0},this.setSong=function(e){t.setState({size:e.notes.length,position:0,current:0}),t.setPages([])},this.resetScore=function(){t.setScoreState({correct:1,wrong:1,score:0,combo:0})},this.increaseScore=function(e,n){var r=t.score;e?t.setScoreState({correct:r.correct+1,combo:r.combo+1,score:r.score+r.combo*(null!=n?n:1)}):t.setScoreState({wrong:r.wrong+1,combo:0})},this.setPages=function(e){var n,r=e.map(function(e){return e.map(function(e){return e.clone()})});t.setPagesState({pages:r,currentPageIndex:0,currentChunkIndex:0,currentPage:null!==(n=r[0])&&void 0!==n?n:[]})},this.clearPages=function(){t.setPagesState({pages:[],currentPageIndex:0,currentChunkIndex:0,currentPage:[]})},this.setState=function(e){Object.assign(t.state,e)},this.setScoreState=function(e){Object.assign(t.score,e)},this.setPagesState=function(e){Object.assign(t.pagesState,e)},this.setPosition=function(e){t.setState({position:e})},this.incrementCurrent=function(){t.setState({current:t.current+1})},this.incrementChunkPositionAndSetCurrent=function(e){var n,r,a=t.pagesState,s=a.pages,o=a.currentPageIndex;e=null!=e?e:t.current;var i=t.currentChunkIndex+1;if(i>=(null!==(r=null===(n=s[o])||void 0===n?void 0:n.length)&&void 0!==r?r:0)){if(o===s.length-1)return;t.setPagesState({currentPageIndex:o+1,currentChunkIndex:0,currentPage:s[o+1]}),t.setState({current:e})}else t.setPagesState({currentChunkIndex:i}),t.setState({current:e})},this.setCurrent=function(e){t.setState({current:e})},this.setEnd=function(e){t.setState({end:e})},this.setSize=function(e){t.setState({size:e})},(0,v.rC)(this)}return(0,w._)(e,[{key:"currentChunkIndex",get:function(){return this.pagesState.currentChunkIndex}},{key:"currentChunk",get:function(){return this.pagesState.currentPage[this.pagesState.currentChunkIndex]}},{key:"position",get:function(){return this.state.position}},{key:"current",get:function(){return this.state.current}},{key:"size",get:function(){return this.state.size}},{key:"end",get:function(){return this.state.end}}]),e}();(0,d.gn)([v.LO],I.prototype,"state",void 0),(0,d.gn)([v.LO],I.prototype,"pagesState",void 0),(0,d.gn)([v.LO],I.prototype,"score",void 0);var R=new I,T=n(539),A=n(2881),L=n(6138),J=n(9714),D=function(e){(0,o._)(n,e);var t=(0,u._)(n);function n(e){(0,s._)(this,n),(u=t.call(this,e)).approachRate=1500,u.approachingNotesList=[],u.nextChunkDelay=0,u.tickTime=50,u.tickInterval=0,u.songTimestamp=0,u.cleanup=[],u.timeouts=[],u.debouncedStateUpdate=0,u.handleMidi=function(e){var t=(0,g._)(e,3),n=t[0],r=t[1],a=t[2];if(u.mounted){var s=u.props.data.instrument;L.mP.isDown(n)&&0!==a&&L.mP.settings.notes.filter(function(e){return e.midi===r}).forEach(function(e){u.handleClick(s.notes[e.index])})}};var o,i,c,l,u,h=(0,r._)(u);u.handleKeyboard=(o=(0,a._)(function(e){var t,n,r;return(0,d.Jh)(this,function(a){return t=e.event,n=e.shortcut,t.repeat||t.shiftKey||null===(r=h.props.data.instrument.getNoteFromCode(n.name))||h.handleClick(r),[2]})}),function(e){return o.apply(this,arguments)});var p=(0,r._)(u);u.approachingSong=(i=(0,a._)(function(e){var t,n,r,a,s,o,i,c,l,u=arguments;return(0,d.Jh)(this,function(d){for(t=u.length>1&&void 0!==u[1]?u[1]:0,n=(n=u.length>2?u[2]:void 0)||e.notes.length,r=p.props.data.speedChanger,a=[],p.approachRate=p.props.data.approachRate||1500,s=p.approachRate,o=void 0!==e.notes[t]?e.notes[t].time:0,i=t;i<n&&i<e.notes.length;i++)c=e.notes[i],l=new T.Yy({time:Math.floor((c.time-o)/r.value+s),index:c.index}),a.push(l);return R.setSong(e),R.clearPages(),R.resetScore(),p.setState({approachingNotes:N.N3.from("Sky"===m.iC?15:21)}),p.approachingNotesList=a,[2]})}),function(e){return i.apply(this,arguments)}),u.tick=function(){if(u.props.data.hasSong){var e=u.state.approachingNotes,t=u.props.data.speedChanger,n=u.approachingNotesList;n.forEach(function(e){e.time-=u.tickTime});for(var r=!1,a=0,s=0;s<n.length;s++)if(n[s].time<u.approachRate){var o=new T.Yy({time:u.approachRate,index:n[s].index,id:Math.floor(1e4*Math.random())});e[n[s].index].push(o),n.splice(s,1),s--,r=!0}else break;e.forEach(function(e){for(var n=0;n<e.length;n++){var s=e[n];s.time-=u.tickTime,s.clicked&&(s.time<u.approachRate/3?R.increaseScore(!0,t.value):R.increaseScore(!1),s.time=-1),s.time<0&&(s.clicked||R.increaseScore(!1),e.splice(n,1),n--,r=!0,a++)}}),r&&(R.setCurrent(R.current+a),u.setState({approachingNotes:e.map(function(e){return e.slice()})}))}};var f=(0,r._)(u);u.playSong=(c=(0,a._)(function(e){var t,n,r,a,s,o,i,c,l,u,h,p,g,m,y=arguments;return(0,d.Jh)(this,function(d){switch(d.label){case 0:return t=y.length>1&&void 0!==y[1]?y[1]:0,n=(n=y.length>2?y[2]:void 0)||e.notes.length,f.songTimestamp=e.timestamp,r=f.state.keyboard,a=f.applySpeedChange(e.notes).slice(t,n),s=A.M.mergeNotesIntoChunks(a.map(function(e){return e.clone()})),R.setPages((0,N.YY)(s,10)),[4,(0,N.gw)(200)];case 1:d.sent(),i=o=a[0].time,c=0,l=Date.now(),u=0,h=0,d.label=2;case 2:if(!(h<a.length))return[3,6];if(g=a[h].time-i,i=a[h].time,!(g>16))return[3,4];return[4,(0,N.gw)(g+c)];case 3:d.sent(),d.label=4;case 4:if(!f.mounted||f.songTimestamp!==e.timestamp)return[2];f.handleClick(r[a[h].index],a[h].layer),u>=(null!==(m=null===(p=R.currentChunk)||void 0===p?void 0:p.notes.length)&&void 0!==m?m:0)?(u=1,R.incrementChunkPositionAndSetCurrent(t+h+1)):(u++,R.setCurrent(t+h+1)),c=l+i-o-Date.now(),d.label=5;case 5:return h++,[3,2];case 6:return[2]}})}),function(e){return c.apply(this,arguments)}),u.applySpeedChange=function(e){var t=u.props.data.speedChanger;return e.map(function(e){return e.time=e.time/t.value,e})},u.practiceSong=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;n=n||e.notes.length;var r=u.state.keyboard,a=u.applySpeedChange(e.notes).slice(t,n),s=A.M.mergeNotesIntoChunks(a.map(function(e){return e.clone()}));if(0!==s.length){u.nextChunkDelay=0,s[0].notes.forEach(function(e){_.setNoteState(e.index,{status:"toClick",delay:"Genshin"===m.iC?100:200})});var o=s[1];null==o||o.notes.forEach(function(e){var t=r[e.index];if("toClick"===t.status)return t.setStatus("toClickAndNext");t.setStatus("toClickNext")}),u.props.functions.setHasSong(!0),R.setPages((0,N.YY)(s,10)),u.setState({songToPractice:s})}};var y=(0,r._)(u);return u.restartSong=(l=(0,a._)(function(e){return(0,d.Jh)(this,function(t){switch(t.label){case 0:return[4,y.stopSong()];case 1:if(t.sent(),!y.mounted)return[2];return _.restartSong("number"==typeof e?e:R.position,R.end),[2]}})}),function(e){return l.apply(this,arguments)}),u.stopSong=function(){return u.songTimestamp=0,new Promise(function(e){_.resetKeyboardLayout(),u.approachingNotesList=[],u.setState({songToPractice:[],approachingNotes:N.N3.from("Sky"===m.iC?15:21)},e),u.props.functions.setHasSong(!1)})},u.stopAndClear=function(){u.stopSong(),_.resetSong()},u.handleApproachClick=function(e){var t=u.state.approachingNotes[e.index][0];return t&&(t.clicked=!0,t.time<u.approachRate/3)?"approach-correct":"approach-wrong"},u.handlePracticeClick=function(e){var t=u.state,n=t.keyboard,r=t.songToPractice;if(r.length>0){var a=null===(s=r[0])||void 0===s?void 0:s.notes.findIndex(function(t){return t.index===e.index});if(-1!==a){if(r[0].notes.splice(a,1),0===r[0].notes.length&&(r.shift(),R.incrementChunkPositionAndSetCurrent()),r.length>0){var s,o=r[0],i=r[1];o.notes.forEach(function(e){_.setNoteState(e.index,{status:"toClick",delay:o.delay})}),i&&(null==i||i.notes.forEach(function(e){var t=n[e.index];if("toClick"===t.status)return t.setStatus("toClickAndNext");t.setStatus("toClickNext")}))}R.incrementCurrent(),u.setState({songToPractice:r})}}},u.handleClick=function(e,t){var n=u.state.keyboard,r=u.props.data.hasAnimation;if(e){var a=n[e.index].status;_.setNoteState(e.index,{status:"clicked",delay:"play"!==_.eventType?"Genshin"===m.iC?100:200:0,animationId:r&&"approaching"!==_.eventType?Math.floor(1e4*Math.random())+Date.now():0}),u.handlePracticeClick(e),u.props.functions.playSound(e.index,t);var s=u.handleApproachClick(e);"approaching"===_.eventType&&(_.setNoteState(e.index,{status:s}),"approach-wrong"===s&&R.increaseScore(!1)),u.timeouts[e.index]>0&&"play"===_.eventType&&clearTimeout(u.timeouts[e.index]),u.timeouts[e.index]=setTimeout(function(){if(u.timeouts[e.index]=0,["clicked","approach-wrong","approach-correct"].includes(n[e.index].status)){if("toClickNext"===a)return _.setNoteState(e.index,{status:a});_.setNoteState(e.index,{status:""})}},"Sky"===m.iC?200:100)}},u.state={playTimestamp:Date.now(),songToPractice:[],approachingNotes:N.N3.from("Sky"===m.iC?15:21),keyboard:_.keyboard},u.mounted=!0,u}var l=n.prototype;return l.componentDidMount=function(){var e=this;this.tickInterval=setInterval(this.tick,this.tickTime);var t=(0,J.JZ)("player","player_keyboard",function(t){var n=t.shortcut.name;if("restart"===n){if(!e.props.data.hasSong)return;["practice","play","approaching"].includes(_.eventType)&&e.restartSong(0)}"stop"===n&&e.props.data.hasSong&&e.stopAndClear()}),n=(0,J.JP)("player_keyboard_keys",this.handleKeyboard);this.cleanup.push(t,n);var r=this;this.cleanup.push((0,S.VZ)(_.state,(0,a._)(function(){return(0,d.Jh)(this,function(e){return r.debouncedStateUpdate&&clearTimeout(r.debouncedStateUpdate),r.debouncedStateUpdate=setTimeout((0,a._)(function(){var e,t,n,a,s,o,i,c,l;return(0,d.Jh)(this,function(u){switch(u.label){case 0:return e=_.state,t=_.song,n=_.eventType,[4,r.stopSong()];case 1:if(u.sent(),!r.mounted)return[2];if("stop"===n)r.props.functions.setHasSong(!1);else{if(!t)return[2];(c=t.isComposed?t.toRecordedSong().clone():t.clone()).timestamp=Date.now(),l=e.end||(null===(s=c)||void 0===s?void 0:null===(a=s.notes)||void 0===a?void 0:a.length)||0,"play"===n&&r.playSong(c,e.start,l),"practice"===n&&r.practiceSong(c,e.start,l),"approaching"===n&&r.approachingSong(c,e.start,l),r.props.functions.setHasSong(!0),P.Z.songEvent({type:n}),R.setState({size:(null===(i=c)||void 0===i?void 0:null===(o=i.notes)||void 0===o?void 0:o.length)||1,position:e.start,end:l,current:e.start})}return[2]}})}),4),[2]})}))),L.mP.addListener(this.handleMidi),this.cleanup.push(function(){return L.mP.removeListener(e.handleMidi)}),this.cleanup.push((0,S.wo)(_.keyboard,function(){e.setState({keyboard:_.keyboard})}))},l.componentWillUnmount=function(){this.cleanup.forEach(function(e){return e()}),this.songTimestamp=0,_.resetSong(),this.mounted=!1,clearInterval(this.tickInterval)},l.render=function(){var e=this,t=this.state,n=this.props.data,r=n.instrument,a=n.noteNameType,s=n.pitch,o=t.keyboard,l=(0,N.uZ)(n.keyboardSize/100,.5,1.5),u="keyboard"+("play"===_.eventType?" keyboard-playback":"");15===o.length&&(u+=" keyboard-5"),14===o.length&&(u+=" keyboard-5"),8===o.length&&(u+=" keyboard-4"),6===o.length&&(u+=" keyboard-3");var d=1!==l?{transform:"scale(".concat(l,")")}:{};return(0,h.jsx)(h.Fragment,{children:(0,h.jsx)("div",{className:u,style:(0,c._)((0,i._)({},d),{zIndex:2,marginBottom:"".concat(6*l+n.keyboardYPosition/10,"vh")}),children:n.isLoading?(0,h.jsx)("div",{className:"loading",children:"Loading..."}):o.map(function(n){return(0,h.jsx)(b,{note:n,data:{approachRate:e.approachRate,instrument:r.name},approachingNotes:t.approachingNotes[n.index],handleClick:e.handleClick,noteText:r.getNoteText(n.index,a,s)},n.index)})})})},n}(p.Component),M=n(9583),E=n(9352),z=n(8826),F=n(7671),V=n(781),Z=n(7362),O=n(4339),H=n(1182);function B(e){var t,n,r=e.onClick,s=e.data,o=e.importSong,i=e.theme,c=(0,g._)((0,p.useState)(!1),2),l=c[0],u=c[1],m=(0,g._)((0,p.useState)(null),2),f=m[0],y=m[1],v=(t=(0,a._)(function(){var e,t;return(0,d.Jh)(this,function(n){switch(n.label){case 0:if(l)return[2];n.label=1;case 1:if(n.trys.push([1,3,,4]),f)return[2,o(f.clone())];return u(!0),[4,fetch("https://sky-music.herokuapp.com/api/songs?get="+encodeURI(s.file)).then(function(e){return e.json()})];case 2:return e=n.sent(),u(!1),y(e=H.v.parseSong(e)),o(e),[3,4];case 3:return t=n.sent(),u(!1),console.error(t),O.kg.error("Error downloading song"),[3,4];case 4:return[2]}})}),function(){return t.apply(this,arguments)}),x=(n=(0,a._)(function(){var e;return(0,d.Jh)(this,function(t){switch(t.label){case 0:if(l)return[2];t.label=1;case 1:if(t.trys.push([1,3,,4]),f)return[2,r(f,0)];return u(!0),[4,fetch("https://sky-music.herokuapp.com/api/songs?get="+encodeURI(s.file)).then(function(e){return e.json()})];case 2:return e=t.sent(),u(!1),r(e=H.v.parseSong(e),0),y(e),[3,4];case 3:return console.error(t.sent()),u(!1),O.kg.error("Error downloading song"),[3,4];case 4:return[2]}})}),function(){return n.apply(this,arguments)});return(0,h.jsxs)("div",{className:"song-row",children:[(0,h.jsx)("div",{className:"song-name",onClick:x,children:s.name}),(0,h.jsx)("div",{className:"song-buttons-wrapper",children:(0,h.jsx)("button",{className:"song-button",onClick:v,"aria-label":"Import song ".concat(s.name),style:{backgroundColor:i.layer("primary",.2).hex(),marginRight:0},children:l?(0,h.jsx)(M.fCD,{}):(0,h.jsx)(M.aBF,{})})})]})}var K=n(9878),Y=n(2809),U=n(8461),G=n(125),X=n(1664),Q=n.n(X),W=n(8778),$=n(5055),q=n(1446),ee=n(1014),et=n(515),en=n(1108),er=n(2452),ea=n(750),es=n(1866),eo=n(2650),ei=n(4931),ec=n(8434),el=n(7008),eu=n(7053),ed=n(2132),eh=n(5272),ep=n(5684),eg=n(8737),em=n(440),ef=n.n(em),ey=["vsrg"];function ev(e){var t,n=e.data,r=e.functions,s=e.theme,o=e.folders,i=r.removeSong,c=r.toggleMenu,l=r.downloadSong,u=r.renameSong,m={backgroundColor:s.layer("primary",.15).toString()},f=(0,g._)((0,p.useState)(!1),2),y=f[0],v=f[1],x=(0,g._)((0,p.useState)(n.name),2),S=x[0],k=x[1];return((0,p.useEffect)(function(){k(n.name)},[n.name]),"vsrg"===n.type)?(0,h.jsx)("div",{className:"row",children:"Invalid song"}):(0,h.jsxs)("div",{className:"song-row",children:[(0,h.jsxs)("div",{className:"song-name ".concat((0,ee.h)(!0)),onClick:(0,a._)(function(){var e;return(0,d.Jh)(this,function(t){switch(t.label){case 0:if(y)return[2];return e=_.play,[4,H.v.fromStorableSong(n)];case 1:return e.apply(_,[t.sent(),0]),c(!1),[2]}})}),children:[y?(0,h.jsx)("input",{className:"song-name-input ".concat(y?"song-rename":""),disabled:!y,onChange:function(e){return k(e.target.value)},style:{width:"100%",color:"var(--primary-text)"},value:S}):(0,h.jsx)("div",{style:{marginLeft:"0.3rem"},children:S}),(0,h.jsx)(ee.u,{children:y?"Song name":"Play song"})]}),(0,h.jsxs)("div",{className:"song-buttons-wrapper",children:[(0,h.jsx)(K.v,{onClick:(0,a._)(function(){var e;return(0,d.Jh)(this,function(t){switch(t.label){case 0:return[4,H.v.fromStorableSong(n)];case 1:return e=t.sent(),_.practice(e,0,e.notes.length),c(!1),[2]}})}),ariaLabel:"Practice song ".concat(n.name),tooltip:"Practice",style:m,children:(0,h.jsx)(M.Xe,{})}),(0,h.jsx)(K.v,{onClick:(0,a._)(function(){var e;return(0,d.Jh)(this,function(t){switch(t.label){case 0:return[4,H.v.fromStorableSong(n)];case 1:return e=t.sent(),_.approaching(e,0,e.notes.length),c(!1),[2]}})}),tooltip:"Approach mode",ariaLabel:"Play in Approach mode the song ".concat(n.name),style:m,children:(0,h.jsx)(M.muy,{})}),(0,h.jsxs)(en.Rk,{Icon:M.LCi,style:m,ignoreClickOutside:y,tooltip:"More options",onClose:function(){return v(!1)},children:[(0,h.jsxs)(en.tc,{onClick:function(){y&&(u(S,n.id),v(!1)),v(!y)},children:[(0,h.jsx)(M.tU3,{style:{marginRight:"0.4rem"},size:14}),(0,h.jsx)(en.Qr,{text:y?"Save":"Rename"})]}),(0,h.jsxs)(en.tc,{style:{padding:"0 0.4rem"},children:[(0,h.jsx)(M.$nz,{style:{marginRight:"0.4rem"}}),(0,h.jsxs)("select",{className:"dropdown-select",value:n.folderId||"_None",onChange:(t=(0,a._)(function(e){var t,r;return(0,d.Jh)(this,function(a){switch(a.label){case 0:return t=e.target.value,[4,H.v.getOneSerializedFromStorable(n)];case 1:if(!(r=a.sent()))return[2,O.kg.error("Could not find song")];return eo.k.addSongToFolder(r,"_None"!==t?t:null),[2]}})}),function(e){return t.apply(this,arguments)}),children:[(0,h.jsx)("option",{value:"_None",children:"None"}),o.map(function(e){return(0,h.jsx)("option",{value:e.id,children:e.name},e.id)})]})]}),(0,h.jsx)(Q(),{href:{pathname:"composer",query:{songId:n.id}},style:{width:"100%"},children:(0,h.jsxs)(en.tc,{style:{width:"100%"},onClick:function(){(null==n?void 0:n.type)==="recorded"&&O.kg.warn("Converting recorded song to composed, audio might not be accurate")},children:[(0,h.jsx)(M.fmQ,{style:{marginRight:"0.4rem"},size:14}),(0,h.jsx)(en.Qr,{text:"Edit song"})]})}),(0,h.jsxs)(en.tc,{onClick:(0,a._)(function(){return(0,d.Jh)(this,function(e){switch(e.label){case 0:return[4,H.v.fromStorableSong(n)];case 1:return l(e.sent()),[2]}})}),children:[(0,h.jsx)(M.aBF,{style:{marginRight:"0.4rem"},size:14}),(0,h.jsx)(en.Qr,{text:"Download"})]}),(0,h.jsxs)(en.tc,{onClick:(0,a._)(function(){return(0,d.Jh)(this,function(e){switch(e.label){case 0:return[4,H.v.fromStorableSong(n)];case 1:return l(e.sent().toMidi()),[2]}})}),children:[(0,h.jsx)(M.aBF,{style:{marginRight:"0.4rem"},size:14}),(0,h.jsx)(en.Qr,{text:"Download MIDI"})]}),(0,h.jsxs)(en.tc,{onClick:function(){return i(n.name,n.id)},children:[(0,h.jsx)(M.Xm5,{color:"#ed4557",style:{marginRight:"0.4rem"},size:14}),(0,h.jsx)(en.Qr,{text:"Delete"})]})]})]})]})}var ex=function(e){var t,n,r,s=e.functions,o=e.data,i=e.inPreview,c=function(){w(""),L(""),I([])},u=(0,g._)((0,el.n)(),1)[0],f=(0,g._)((0,p.useState)(!1),2),y=f[0],v=f[1],x=(0,g._)((0,p.useState)("Songs"),2),S=x[0],k=x[1],b=(0,g._)((0,p.useState)(""),2),j=b[0],w=b[1],C=(0,g._)((0,p.useState)([]),2),N=C[0],I=C[1],R=(0,g._)((0,p.useState)(""),2),T=R[0],L=R[1],D=(0,eg.Z)().IS_MIDI_AVAILABLE,K=(0,g._)((0,p.useState)(!1),2),X=K[0],en=K[1],eo=(0,g._)((0,$.F)(),1)[0],em=(0,g._)((0,ei.j)(),1)[0],ex=s.handleSettingChange,eS=s.addSong,ek=s.removeSong,eb=s.renameSong,ej=(0,eu.ZP)(function(e){v(!1)},{active:y,ignoreFocusable:!0});(0,p.useEffect)(function(){function e(){return(e=(0,a._)(function(){var e;return(0,d.Jh)(this,function(t){switch(t.label){case 0:if(!(navigator.storage&&navigator.storage.persist))return[3,4];return[4,navigator.storage.persisted()];case 1:if(e=t.sent())return[3,3];return[4,navigator.storage.persist()];case 2:e=t.sent(),t.label=3;case 3:en(e),t.label=4;case 4:return[2]}})})).apply(this,arguments)}return!function(){e.apply(this,arguments)}(),(0,J.JZ)("player","player_menu",function(e){var t=e.shortcut.name;"close_menu"===t&&v(!1),"toggle_menu"===t&&v(function(e){return!e})})},[]);var ew=(t=(0,a._)(function(){var e;return(0,d.Jh)(this,function(t){switch(t.label){case 0:if("Searching..."===T)return[2];if(0===j.trim().length)return[2,L("Please write a non empty name")];return L("Searching..."),[4,fetch("https://sky-music.herokuapp.com/api/songs?search="+encodeURI(j)).then(function(e){return e.json()})];case 1:if((e=t.sent()).error)return L("Please write a non empty name"),[2,O.kg.error(e.error)];return L("success"),I(e),P.Z.songSearch({name:j}),[2]}})}),function(){return t.apply(this,arguments)}),eC=function(e){"boolean"!=typeof e&&(e=null),v(null!==e?e:!y)},e_=function(e){if(e===S&&y)return v(!1);c(),e&&k(e),v(!0),P.Z.UIEvent("menu",{tab:e})},eN=(n=(0,a._)(function(e){var t,n,r,a,s,o,i,c,l,u;return(0,d.Jh)(this,function(d){switch(d.label){case 0:t=!0,n=!1,r=void 0,d.label=1;case 1:d.trys.push([1,8,9,10]),a=e[Symbol.iterator](),d.label=2;case 2:if(t=(s=a.next()).done)return[3,7];o=s.value,d.label=3;case 3:return d.trys.push([3,5,,6]),i=Array.isArray(o.data)?o.data:[o.data],[4,ed.bV.importAndLog(i)];case 4:return d.sent(),[3,6];case 5:if(console.error(d.sent()),null===(c=(l=o.file.name).includes)||void 0===c?void 0:c.call(l,".mid"))return[2,O.kg.error("Midi files should be imported in the composer")];return eR(),[3,6];case 6:return t=!0,[3,2];case 7:return[3,10];case 8:return u=d.sent(),n=!0,r=u,[3,10];case 9:try{t||null==a.return||a.return()}finally{if(n)throw r}return[7];case 10:return[2]}})}),function(e){return n.apply(this,arguments)}),eP=(r=(0,a._)(function(e){var t,n;return(0,d.Jh)(this,function(r){switch(r.label){case 0:if(!(e instanceof er.Midi))return[3,2];return[4,(0,ea.jH)("If you use MIDI, the song will loose some information, if you want to share the song with others, use the other format (button above). Do you still want to download?")];case 1:if(!r.sent())return[2];return[2,ed.bV.downloadMidi(e)];case 2:return t=e.name,n=["Sky"===m.iC?e.toOldFormat():e.serialize()],ed.bV.downloadSong(n,"".concat(t,".").concat(m.iC.toLowerCase(),"sheet")),O.kg.success("Song downloaded"),P.Z.userSongs("download",{page:"player"}),[2]}})}),function(e){return r.apply(this,arguments)}),eI=(0,p.useCallback)((0,a._)(function(){var e;return(0,d.Jh)(this,function(t){switch(t.label){case 0:return[4,(0,ea.cJ)("Write the folder name")];case 1:if(!(e=t.sent()))return[2];return ec.p.createFolder(e),[2]}})}),[]),eR=(0,p.useCallback)(function(e){e&&console.error(e),O.kg.error("Error importing file, invalid format",8e3)},[]);function eT(){return(eT=(0,a._)(function(){var e,t,n,r;return(0,d.Jh)(this,function(a){switch(a.label){case 0:return a.trys.push([0,3,,4]),[4,H.v.getSongs()];case 1:return e=a.sent().map(function(e){if("Sky"===m.iC){if("composed"===e.type)return W.l.deserialize(e).toOldFormat();if("recorded"===e.type)return A.M.deserialize(e).toOldFormat()}return e}),t=new Date().toISOString().split("T")[0],[4,eh.b.getFolders()];case 2:if(n=a.sent(),0===(r=(0,l._)(n).concat((0,l._)(e))).length)return[2,O.kg.warn("There are no songs to backup")];return ed.bV.downloadFiles(r,"".concat(m.iC,"_Backup_").concat(t,".").concat(m.iC.toLowerCase(),"backup")),O.kg.success("Song backup downloaded"),ep.j.setLastBackupWarningTime(Date.now()),[3,4];case 3:return console.error(a.sent()),O.kg.error("Error downloading songs"),[3,4];case 4:return[2]}})})).apply(this,arguments)}var eA=eo.layer("menu_background",.35).lighten(.2),eL=eo.layer("menu_background",.32).desaturate(.4),eJ=eo.getTextColorFromBackground(eA),eD=eo.getTextColorFromBackground(eL);return(0,h.jsxs)("div",{className:"menu-wrapper ".concat(i?"menu-wrapper-absolute":""),ref:ej,children:[(0,h.jsxs)("div",{className:"menu menu-visible menu-main-page",children:[y&&(0,h.jsx)(F.s,{onClick:eC,className:"close-menu",ariaLabel:"Close menu",children:(0,h.jsx)(M.aHS,{className:"icon"})}),(0,h.jsx)(F.s,{onClick:function(){return e_("Help")},className:"margin-top-auto",isActive:"Help"===S&&y,ariaLabel:"Open info menu",children:(0,h.jsx)(M.LL$,{className:"icon"})}),(0,h.jsx)(F.s,{onClick:function(){return e_("Library")},isActive:"Library"===S&&y,ariaLabel:"Open library menu",children:(0,h.jsx)(E.voH,{className:"icon"})}),(0,h.jsx)(F.s,{onClick:function(){return e_("Songs")},isActive:"Songs"===S&&y,ariaLabel:"Open songs menu",children:(0,h.jsx)(M.HcQ,{className:"icon"})}),(0,h.jsx)(F.s,{onClick:function(){return e_("Settings")},isActive:"Settings"===S&&y,ariaLabel:"Open settings",children:(0,h.jsx)(M.p4t,{className:"icon"})}),(0,h.jsx)(F.s,{onClick:Y.I.open,ariaLabel:"Open home menu",children:(0,h.jsx)(M.xng,{className:"icon"})})]}),(0,h.jsxs)("div",{className:y?"side-menu menu-open":"side-menu",children:[(0,h.jsx)(V.Z,{title:"No selection",current:S,id:"No selection",children:"Select a menu"}),(0,h.jsxs)(V.Z,{current:S,id:"Songs",children:[(0,h.jsxs)("div",{className:"songs-buttons-wrapper",children:[(0,h.jsx)(et.k,{children:(0,h.jsxs)("ul",{children:[(0,h.jsx)("li",{children:"Click the song name to play it"}),(0,h.jsx)("li",{children:"You can import songs made by other users (does not accept audio files). Or you can download yours to share"}),(0,h.jsx)("li",{children:"To create your song, you can record the notes you play or create one in the composer"}),(0,h.jsxs)("li",{children:[(0,h.jsx)(M.Xe,{style:{marginRight:"0.2rem"}}),": Start the practice mode"]}),(0,h.jsxs)("li",{children:[(0,h.jsx)(M.muy,{style:{marginRight:"0.2rem"}}),": Start the approaching notes mode"]}),D&&(0,h.jsx)("li",{children:"You can connect a MIDI keyboard to play"})]})}),(0,h.jsx)(Q(),{href:"/composer",style:{marginLeft:"auto"},children:(0,h.jsx)(U.J,{children:"Compose song"})}),(0,h.jsx)(q.G,{onPick:eN,onError:eR,as:"json",multiple:!0,children:(0,h.jsx)(U.J,{children:"Import song sheet"})})]}),(0,h.jsx)(G.G,{songs:u,exclude:ey,onCreateFolder:eI,style:{marginTop:"0.6rem"},SongComponent:ev,componentProps:{theme:eo,folders:em,functions:{removeSong:ek,toggleMenu:eC,downloadSong:eP,renameSong:eb}}}),(0,h.jsx)("div",{style:{marginTop:"auto",paddingTop:"0.5rem",width:"100%",display:"flex",justifyContent:"flex-end"},children:(0,h.jsx)(U.J,{style:{marginLeft:"auto"},onClick:function(){return eT.apply(this,arguments)},children:"Download all songs (backup)"})})]}),(0,h.jsxs)(V.Z,{current:S,id:"Settings",children:[(0,h.jsx)(es.A,{settings:o.settings,changeVolume:s.changeVolume,onUpdate:ex}),(0,h.jsxs)("div",{className:"settings-row-wrap",children:[D&&(0,h.jsx)(Q(),{href:"/keybinds",children:(0,h.jsx)(U.J,{style:{width:"fit-content"},children:"Connect MIDI keyboard"})}),(0,h.jsx)(Q(),{href:"/theme",children:(0,h.jsx)(U.J,{style:{width:"fit-content"},children:"Change app theme"})})]}),(0,h.jsxs)("div",{style:{marginTop:"0.4rem",marginBottom:"0.6rem"},className:(0,ee.h)(!0),children:[X?"Storage is persisted":"Storage is not persisted",X?(0,h.jsx)(ee.u,{position:"top",style:{maxWidth:"unset"},children:"Your data is persisted in the browser, the browser should not automatically clear it. Always make sure to download a backup sometimes, especially when you will not use the app for a long time"}):(0,h.jsx)(ee.u,{position:"top",children:"The browser didn't allow to store data persistently, it might happen that you will loose data when cache is automatically cleared. To get persistent storage, add the app to the home screen. If that still doesn't work, make sure you do a backup often"})]}),(0,h.jsx)(Z.Z,{})]}),(0,h.jsxs)(V.Z,{title:"Library",current:S,id:"Library",children:[(0,h.jsx)("div",{children:"Here you can find songs to learn, they are provided by the sky-music library."}),(0,h.jsxs)("div",{className:"library-search-row",children:[(0,h.jsx)("input",{className:"library-search-input",style:{backgroundColor:eA.toString(),color:eJ.toString()},placeholder:"Song name",onKeyDown:function(e){"Enter"===e.code&&ew()},onInput:function(e){return w(e.target.value)},value:j}),(0,h.jsx)("button",{className:"library-search-btn",onClick:c,style:{backgroundColor:eA.toString(),color:eJ.toString()},children:(0,h.jsx)(M.aHS,{})}),(0,h.jsx)("button",{className:"library-search-btn",onClick:ew,style:{backgroundColor:eA.toString(),color:eJ.toString()},children:(0,h.jsx)(M.U41,{})})]}),(T||N.length>0)&&(0,h.jsx)("div",{className:"library-search-songs-wrapper",style:{backgroundColor:eL.toString(),color:eD.toString()},children:"success"===T?N.length>0?N.map(function(e){return(0,h.jsx)(B,{theme:eo,data:e,importSong:eS,onClick:_.play},e.file)}):(0,h.jsx)("div",{className:"library-search-result-text",children:"No results"}):(0,h.jsx)("div",{className:"library-search-result-text",children:T})})]}),(0,h.jsxs)(V.Z,{title:"Help",current:S,id:"Help",children:[(0,h.jsxs)("div",{className:ef()["help-icon-wrapper"],children:[(0,h.jsx)("a",{href:"https://discord.gg/Arsf65YYHq",children:(0,h.jsx)(M.j2d,{className:ef()["help-icon"]})}),(0,h.jsx)("a",{href:"https://github.com/Specy/genshin-music",children:(0,h.jsx)(M.hJX,{className:ef()["help-icon"]})})]}),(0,h.jsx)(z.p,{}),(0,h.jsx)(Z.Z,{})]})]})]})},eS=n(5839),ek=n(1205),eb=n(7557),ej=n(4995),ew=n(657),eC=n(9218),e_=n(3337),eN=n(9731),eP=n(3750),eI=n(3240),eR=n.n(eI),eT=(0,p.memo)(function(){var e=(0,S.$d)(R.state),t=(0,g._)((0,p.useState)(null),2),n=t[0],r=t[1],a=(0,g._)((0,p.useState)(m.n),2),s=a[0],o=a[1],i=(0,p.useRef)(null),c=(0,p.useRef)(null),l=(0,p.useRef)(null);(0,p.useEffect)(function(){var e=function(){null!==n&&r(null)};if(null!==n)return window.addEventListener("pointerup",e),window.addEventListener("blur",e),function(){window.removeEventListener("pointerup",e),window.removeEventListener("blur",e)}},[n]);var u=function(t,r){if(null!==n||r){var a=r||n,o=s.height,i=s.y,c=t.clientY-i,l=(0,N.uZ)(Math.round((1-c/o)*e.size),0,e.size);"start"===a?l-e.end<-1&&R.setPosition(l):l-e.position>1&&R.setState({end:l})}},d=0!==e.size?e.position/e.size*100:0,f=0!==e.size?e.end/e.size*100:100;return(0,h.jsx)(h.Fragment,{children:(0,h.jsxs)("div",{className:eR()["slider-outer"],ref:l,onPointerUp:function(){r(null)},onPointerMove:u,onPointerDown:function(e){if(l.current&&i.current&&c.current){var t=l.current.getBoundingClientRect(),n=e.clientY,a=i.current.getBoundingClientRect().y,s=c.current.getBoundingClientRect().y,d=Math.abs(a-n),h=Math.abs(s-n);o(t);var p=d>=h?"end":"start";r(d>=h?"end":"start"),u(e,p)}},children:[(0,h.jsx)("div",{className:eR()["slider-full"],children:(0,h.jsx)("div",{className:eR()["slider-current"],style:{transform:"translateY(".concat((100-e.current/e.size*100).toFixed(1),"%)")}})}),(0,h.jsxs)("div",{className:eR()["two-way-slider"],children:[(0,h.jsxs)("div",{className:eR()["two-way-slider-thumb"],style:{bottom:"calc(".concat(f,"% - 18px)")},ref:c,children:[(0,h.jsx)("div",{style:{fontSize:"0.8rem"},children:e.end}),(0,h.jsx)(eC.Z,{children:(0,h.jsx)(eP.Ejc,{width:16,style:{filter:"drop-shadow(rgba(0, 0, 0, 0.4) 0px 2px 2px)"}})})]}),(0,h.jsxs)("div",{className:eR()["two-way-slider-thumb"],style:{bottom:"calc(".concat(d,"% - 14px)")},ref:i,children:[(0,h.jsx)("div",{style:{fontSize:"0.8rem"},children:e.position}),(0,h.jsx)(eC.Z,{children:(0,h.jsx)(eP.Ejc,{width:16,style:{filter:"drop-shadow(rgba(0, 0, 0, 0.4) 0px 2px 2px)"}})})]})]})]})})},function(){return!0}),eA=n(8571),eL=n.n(eA),eJ=new eS.ZP,eD=(0,p.memo)(function(e){var t=e.chunk,n=e.rows,r=e.hasText,a=e.selected,s=e.theme,o=e.keyboardLayout,i="Genshin"===m.iC?7:5,c=(0,g._)((0,p.useState)("var(--primary)"),2),l=c[0],u=c[1];(0,p.useEffect)(function(){u(s.layer("primary",.2).toString())},[s]);var d=Array(i*n).fill(!1);return t.notes.forEach(function(e){d[e.index]=!0}),(0,h.jsx)("div",{className:"".concat(eL()["frame-outer-smaller"]," ").concat(0===t.notes.length?eL()["visualizer-ball"]:""),style:a?{borderColor:"var(--accent)"}:{},children:0===t.notes.length?(0,h.jsx)("div",{}):(0,h.jsx)("div",{className:eL()["visualizer-frame"],style:{gridTemplateColumns:"repeat(".concat(i,",1fr)")},children:d.map(function(e,t){return(0,h.jsx)("div",{className:e?eL()["frame-note-s"]:eL()["frame-note-ns"],style:e?{}:{backgroundColor:l},children:e&&r?eJ.getNoteText(t,o,"C"):null},t)})})})},function(e,t){return e.chunk===t.chunk&&e.rows===t.rows&&e.hasText===t.hasText&&e.selected===t.selected&&e.theme===t.theme}),eM=n(9189),eE=n.n(eM),ez="Genshin"===m.iC?"Keyboard layout":"ABC",eF=(0,p.memo)(function(){var e,t=(0,S.$d)(R.pagesState),n=(0,g._)((0,$.F)(),1)[0];return(0,h.jsx)(h.Fragment,{children:t.pages.length>0&&(0,h.jsx)("div",{className:eE()["player-chunks-page"],children:null===(e=t.currentPage)||void 0===e?void 0:e.map(function(e,r){return(0,h.jsx)(eD,{keyboardLayout:ez,theme:n,selected:r===t.currentChunkIndex,chunk:e,rows:3,hasText:!1},r)})})})},function(){return!0}),eV=(0,p.memo)(function(e){var t=e.onRestart,n=e.onRawSpeedChange,r=e.speedChanger,a=e.hasSong,s=e.isMetronomePlaying,o=e.onToggleMetronome,i=e.isRecordingAudio,c=e.onToggleRecordAudio,l=e.isVisualSheetVisible,u=(0,S.$d)(_.state);return(0,h.jsxs)(h.Fragment,{children:["approaching"===u.eventType&&(0,h.jsx)(eZ,{}),(0,h.jsxs)("div",{className:"column ".concat(eE()["player-controls"]),children:[(0,h.jsx)("div",{children:"approaching"!==u.eventType&&(0,h.jsx)(U.J,{toggled:i,onClick:function(){return c(!i)},children:i?"Finish recording":"Record audio"})}),(0,h.jsxs)("div",{className:"column ".concat(eR()["slider-wrapper"]),style:a?{}:{display:"none"},children:[(0,h.jsxs)("div",{className:"row",style:{width:"100%"},children:[(0,h.jsxs)("div",{className:"".concat((0,ee.h)(!0)," row"),style:{marginRight:"0.4rem",flex:1},children:[(0,h.jsxs)("select",{className:eR()["slider-select"],onChange:n,value:r.name,style:{backgroundImage:"none"},children:[(0,h.jsx)("option",{disabled:!0,children:"Speed"}),m.Qk.map(function(e){return(0,h.jsx)("option",{value:e.name,children:e.name},e.name)})]}),(0,h.jsx)(ee.u,{position:"left",children:"Change speed"})]}),(0,h.jsx)(e_.h,{onClick:function(){_.resetSong(),R.clearPages(),R.resetScore()},style:{flex:1},tooltip:"Stop",ariaLabel:"Stop song",children:(0,h.jsx)(eC.Z,{children:(0,h.jsx)(M.JuG,{})})})]}),(0,h.jsx)(eT,{}),(0,h.jsx)(e_.h,{onClick:t,tooltip:"Restart",ariaLabel:"Restart song",children:(0,h.jsx)(eC.Z,{children:(0,h.jsx)(M.dnK,{})})})]}),(0,h.jsx)(e_.h,{toggled:s,onClick:o,className:"metronome-button",ariaLabel:"Toggle metronome",children:(0,h.jsx)(eN.eHT,{size:22})})]}),l&&(0,h.jsx)(eF,{})]})},function(e,t){return e.speedChanger===t.speedChanger&&e.hasSong===t.hasSong&&e.isMetronomePlaying===t.isMetronomePlaying&&e.isRecordingAudio===t.isRecordingAudio&&e.isVisualSheetVisible===t.isVisualSheetVisible}),eZ=(0,p.memo)(function(){var e=(0,S.$d)(R.score),t=e.combo,n=e.score,r=e.correct,a=e.wrong;return(0,h.jsx)("div",{className:"approaching-accuracy",children:(0,h.jsx)("table",{children:(0,h.jsxs)("tbody",{children:[(0,h.jsxs)("tr",{children:[(0,h.jsx)("td",{className:"sc-2",children:"Accuracy"}),(0,h.jsxs)("td",{className:"sc-1",children:[(r/(r+a-1)*100).toFixed(1),"%"]})]}),(0,h.jsxs)("tr",{children:[(0,h.jsx)("td",{className:"sc-2",children:"Score"}),(0,h.jsx)("td",{className:"sc-1",children:n})]}),(0,h.jsxs)("tr",{children:[(0,h.jsx)("td",{className:"sc-2",children:"Combo"}),(0,h.jsx)("td",{className:"sc-1",children:t})]})]})})})},function(){return!0}),eO=n(6880),eH=function(e){(0,o._)(n,e);var t=(0,u._)(n);function n(e){(0,s._)(this,n),(S=t.call(this,e)).cleanup=[];var o,u,h,p,g,f,y,v,x,S,k=(0,r._)(S);S.init=(o=(0,a._)(function(e){return(0,d.Jh)(this,function(t){switch(t.label){case 0:return[4,eb.n.waitReverb()];case 1:return t.sent(),[4,k.loadInstrument(e.instrument.value)];case 2:return t.sent(),eb.n.setReverb(e.caveMode.value),[2]}})}),function(e){return o.apply(this,arguments)}),S.setHasSong=function(e){S.setState({hasSong:e})},S.changeVolume=function(e){var t=S.state,n=t.settings,r=t.instruments;"instrument"===e.key&&(n.instrument=(0,c._)((0,i._)({},n.instrument),{volume:e.value}),r.forEach(function(t){return t.changeVolume(e.value)})),S.setState({settings:n},S.updateSettings)};var b=(0,r._)(S);S.loadInstrument=(u=(0,a._)(function(e){var t,n,r,a,s,o,i,c;return(0,d.Jh)(this,function(u){switch(u.label){case 0:return n=(t=b.state).settings,r=t.instruments,a=t.instrumentsData,s=r[0],eb.n.disconnect(s.endNode),b.state.instruments[0].dispose(),o=new eS.ZP(e),c=null!==(i=n.instrument.volume)&&void 0!==i?i:100,o.changeVolume(c),b.setState({isLoadingInstrument:!0}),[4,o.load(eb.n.getAudioContext())];case 1:if(u.sent()||O.kg.error("There was an error loading the instrument"),eb.n.connect(o.endNode),!b.mounted)return[2];return _.setKeyboardLayout(o.notes),r[0]=o,a[0]=new T.WH({name:e,volume:c}),b.setState({instruments:(0,l._)(r),isLoadingInstrument:!1,instrumentsData:(0,l._)(a)},function(){return eb.n.setReverb(n.caveMode.value)}),[2]}})}),function(e){return u.apply(this,arguments)}),S.handleSpeedChanger=function(e){var t=m.Qk.find(function(t){return t.name===e.target.value});t&&S.setState({speedChanger:t},function(){return S.restartSong()})};var j=(0,r._)(S);S.restartSong=(h=(0,a._)(function(e){return(0,d.Jh)(this,function(t){return j.mounted&&_.restartSong("number"==typeof e?e:R.position,R.end),[2]})}),function(e){return h.apply(this,arguments)});var w=(0,r._)(S);S.loadInstruments=(p=(0,a._)(function(e){var t,n,r,s;return(0,d.Jh)(this,function(o){switch(o.label){case 0:var l;return n=(t=w.state).instruments,r=t.settings,n.splice(e.length).forEach(function(e){eb.n.disconnect(e.endNode),e.dispose()}),O.kg.showPill("Loading instruments..."),[4,Promise.all(e.map((l=(0,a._)(function(e,t){var r,a,s;return(0,d.Jh)(this,function(o){switch(o.label){case 0:if(void 0!==n[t])return[3,2];return r=new eS.ZP(e.name),n[t]=r,[4,r.load(eb.n.getAudioContext())];case 1:if(o.sent()||O.kg.error("There was an error loading the instrument"),!w.mounted)return[2,r.dispose()];return eb.n.connect(r.endNode),r.changeVolume(e.volume),[2,r];case 2:if(n[t].name!==e.name)return[3,3];return n[t].changeVolume(e.volume),[2,n[t]];case 3:return a=n[t],eb.n.disconnect(a.endNode),a.dispose(),s=new eS.ZP(e.name),n[t]=s,[4,s.load(eb.n.getAudioContext())];case 4:if(o.sent()||O.kg.error("There was an error loading the instrument"),!w.mounted)return[2,s.dispose()];return eb.n.connect(s.endNode),s.changeVolume(e.volume),[2,s];case 5:return[2]}})}),function(e,t){return l.apply(this,arguments)})))];case 1:if(s=o.sent(),!w.mounted)return[2];return n[0]&&(r.instrument=(0,c._)((0,i._)({},r.instrument),{value:n[0].name}),_.setKeyboardLayout(n[0].notes)),w.setState({instruments:s,settings:r,instrumentsData:e},function(){O.kg.hidePill(),w.updateSettings()}),[2]}})}),function(e){return p.apply(this,arguments)}),S.playSound=function(e,t){var n=(0,r._)(S).state,a=n.settings,s=n.instruments,o=n.instrumentsData;n.isRecording&&S.handleRecording(e),t?s.forEach(function(n,r){var s=o[r];if(t.test(r)&&!(null==s?void 0:s.muted)){var i=(null==s?void 0:s.pitch)||a.pitch.value;n.play(e,i)}}):s[0].play(e,a.pitch.value)},S.updateSettings=function(e){ep.j.updatePlayerSettings(void 0!==e?e:S.state.settings)},S.handleSettingChange=function(e){var t=S.state.settings,n=e.data;t[e.key]=(0,c._)((0,i._)({},t[e.key]),{value:n.value}),"instrument"===e.key&&S.loadInstrument(n.value),"caveMode"===e.key&&eb.n.setReverb(n.value),"bpm"===e.key&&(ew.A.bpm=n.value),"metronomeBeats"===e.key&&(ew.A.beats=n.value),"metronomeVolume"===e.key&&ew.A.changeVolume(n.value),S.setState({settings:t},S.updateSettings)},S.addSong=(g=(0,a._)(function(e){var t,n,r;return(0,d.Jh)(this,function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),[4,eo.k.addSong(e)];case 1:return t=a.sent(),e.id=t,r=null!==(n=e.type)&&void 0!==n?n:e.data.isComposedVersion?"composed":"recorded",O.kg.success("Song added to the ".concat(r," tab!"),4e3),[3,3];case 2:return console.error(a.sent()),[2,O.kg.error("There was an error importing the song")];case 3:return[2]}})}),function(e){return g.apply(this,arguments)});var C=(0,r._)(S);S.removeSong=(f=(0,a._)(function(e,t){var n;return(0,d.Jh)(this,function(r){switch(r.label){case 0:return[4,(0,ea.jH)('Are you sure you want to delete the song: "'.concat(e,'" ?'))];case 1:if(n=r.sent(),!C.mounted)return[2];if(!n)return[3,3];return[4,eo.k.removeSong(t)];case 2:r.sent(),P.Z.userSongs("delete",{page:"player"}),r.label=3;case 3:return[2]}})}),function(e,t){return f.apply(this,arguments)}),S.renameSong=(y=(0,a._)(function(e,t){return(0,d.Jh)(this,function(n){switch(n.label){case 0:return[4,eo.k.renameSong(t,e)];case 1:return n.sent(),[2]}})}),function(e,t){return y.apply(this,arguments)}),S.handleRecording=function(e){S.state.isRecording&&S.recording.addNote(e)},S.toggleMetronome=function(){var e=S.state,t=e.isMetronomePlaying,n=e.settings;S.setState({isMetronomePlaying:!t}),t?ew.A.stop():(ew.A.bpm=n.bpm.value,ew.A.beats=n.metronomeBeats.value,ew.A.changeVolume(n.metronomeVolume.value),ew.A.start())};var N=(0,r._)(S);S.toggleRecord=(v=(0,a._)(function(e){var t,n,r,a,s,o;return(0,d.Jh)(this,function(i){switch(i.label){case 0:if("boolean"!=typeof e&&(e=null),!(!(t=null!==e?e:!N.state.isRecording)&&N.recording.notes.length>0))return[3,2];return r=(n=N.state).instruments,a=n.settings,[4,(0,ea.cJ)("Write song name, press cancel to ignore")];case 1:if(s=i.sent(),!N.mounted)return[2];return null!==s&&((o=new A.M(s,N.recording.notes,[r[0].name])).bpm=a.bpm.value,o.pitch=a.pitch.value,N.addSong(o),P.Z.userSongs("record",{page:"player"})),[3,3];case 2:N.recording=new T.xd,i.label=3;case 3:return N.setState({isRecording:t}),[2]}})}),function(e){return v.apply(this,arguments)});var I=(0,r._)(S);return S.toggleRecordAudio=(x=(0,a._)(function(e){var t,n,r;return(0,d.Jh)(this,function(a){switch(a.label){case 0:if(!I.mounted)return[2];if("boolean"!=typeof e&&(e=null),t=null!==e?e:!I.state.isRecordingAudio,I.setState({isRecordingAudio:t}),!t)return[3,1];return eb.n.startRecording(),[3,8];case 1:return[4,eb.n.stopRecording()];case 2:return n=a.sent(),[4,(0,ea.cJ)("Write the song name, press cancel to ignore")];case 3:if(r=a.sent(),!I.mounted||!n)return[2];a.label=4;case 4:if(a.trys.push([4,7,,8]),!r)return[3,6];return[4,ek.Z.downloadBlob(n.data,r+".wav")];case 5:a.sent(),a.label=6;case 6:return[3,8];case 7:return console.error(a.sent()),O.kg.error("There was an error downloading the audio, maybe it's too big?"),[3,8];case 8:return[2]}})}),function(e){return x.apply(this,arguments)}),S.recording=new T.xd,S.state={instruments:[new eS.ZP(m.BX[0])],instrumentsData:[new T.WH({name:m.BX[0]})],settings:ep.j.getDefaultPlayerSettings(),isLoadingInstrument:!0,isRecording:!1,isRecordingAudio:!1,isMetronomePlaying:!1,hasSong:!1,speedChanger:m.Qk.find(function(e){return"x1"===e.name})},S.mounted=!1,S}var p=n.prototype;return p.componentDidMount=function(){var e=this;return(0,a._)(function(){var t,n,r,a;return(0,d.Jh)(this,function(s){switch(s.label){case 0:return t=ep.j.getPlayerSettings(),e.setState({settings:t}),e.mounted=!0,(n=e.state.instruments[0])&&_.setKeyboardLayout(n.notes),r=(0,J.JZ)("player","player",function(t){"toggle_record"===t.shortcut.name&&e.toggleRecord()}),e.cleanup.push(r),[4,e.init(t)];case 1:return s.sent(),a=(0,S.VZ)(_.state,function(t){var n=t.eventType,r=t.song,a=e.state.settings;a.syncSongData.value&&null!==r&&(["play","practice","approaching"].includes(n)&&e.handleSettingChange({data:(0,c._)((0,i._)({},a.pitch),{value:r.pitch}),key:"pitch"}),e.loadInstruments(r.instruments))}),e.cleanup.push(a),[2]}})})()},p.componentWillUnmount=function(){_.resetSong(),_.resetKeyboardLayout(),R.clearPages(),R.resetScore(),eb.n.clear(),O.kg.hidePill(),this.state.instruments.forEach(function(e){return e.dispose()}),this.cleanup.forEach(function(e){return e()}),this.mounted=!1,ew.A.stop()},p.render=function(){var e=this,t=this.state,n=this.renameSong,r=this.playSound,a=this.setHasSong,s=this.removeSong,o=this.handleSettingChange,i=this.changeVolume,c=this.addSong,l=this.toggleMetronome,u=t.settings,d=t.isLoadingInstrument,p=t.hasSong,g=t.isRecordingAudio,m=t.isRecording,f=t.isMetronomePlaying,y=t.speedChanger;return(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(ej.D,{text:"Player",description:"Learn how to play songs and record them. Use the approaching circles mode or the guided tutorial to learn sections of a song at your own pace"}),(0,h.jsx)(ex,{functions:{addSong:c,removeSong:s,handleSettingChange:o,changeVolume:i,renameSong:n},data:{settings:u},inPreview:this.props.inPreview}),(0,h.jsxs)("div",{className:"right-panel appear-on-mount",children:[(0,h.jsx)("div",{className:"upper-right",children:!p&&(0,h.jsx)(U.J,{toggled:m,onClick:function(){return e.toggleRecord()},style:{marginTop:"0.8rem"},children:m?"Stop":"Record"})}),(0,h.jsx)("div",{className:"keyboard-wrapper",children:(0,h.jsx)(D,{data:{isLoading:d,instrument:t.instruments[0],pitch:u.pitch.value,keyboardSize:u.keyboardSize.value,noteNameType:u.noteNameType.value,hasSong:p,hasAnimation:u.noteAnimation.value,approachRate:u.approachSpeed.value,keyboardYPosition:u.keyboardYPosition.value,speedChanger:y},functions:{playSound:r,setHasSong:a}})})]}),(0,h.jsx)(eV,{isRecordingAudio:g,isVisualSheetVisible:u.showVisualSheet.value,onToggleRecordAudio:this.toggleRecordAudio,onRestart:this.restartSong,isMetronomePlaying:f,onToggleMetronome:l,onRawSpeedChange:this.handleSpeedChanger,hasSong:p,speedChanger:y})]})},n}(p.Component);function eB(e){var t=e.inPreview;return(0,h.jsx)(eH,{inPreview:t})}eB.getLayout=function(e){return(0,h.jsx)(eO.Z,{page:"Main",children:e})}},3240:function(e){e.exports={"two-way-slider":"Slider_two-way-slider__OTXQc","two-way-slider-thumb":"Slider_two-way-slider-thumb__2_Aes","slider-outer":"Slider_slider-outer__zmRWX","slider-full":"Slider_slider-full__DCpU3","slider-current":"Slider_slider-current__7APyO","slider-select":"Slider_slider-select__AoI4F","slider-wrapper":"Slider_slider-wrapper__SlHqG"}},9189:function(e){e.exports={"player-chunks-page":"VisualSheet_player-chunks-page___KXnE","player-controls":"VisualSheet_player-controls___eyTi"}},8571:function(e){e.exports={"visualizer-frame":"SheetFrame_visualizer-frame__hKOAF","frame-outer-background":"SheetFrame_frame-outer-background__JvXAX","frame-outer":"SheetFrame_frame-outer__zmvyW","frame-outer-smaller":"SheetFrame_frame-outer-smaller__4lkX_","frame-note-s":"SheetFrame_frame-note-s__NV3o0","frame-note-ns":"SheetFrame_frame-note-ns__IOvrz","visualizer-ball":"SheetFrame_visualizer-ball__gDeJV"}}}]);