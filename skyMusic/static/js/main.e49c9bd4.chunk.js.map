{"version":3,"sources":["appConfig.js","components/GenshinNoteBorder.js","pages/Main/Components/Note.js","pages/Main/SongStore.js","lib/Utils.js","components/Memoized.js","pages/Main/Keyboard.js","assets/images/mainpage.png","assets/images/composer.png","assets/images/songs.png","components/HelpTab/index.js","components/MenuItem.js","components/MenuPanel.js","components/MenuClose.js","components/Switch/index.js","components/SettingsRow.js","components/DonateButton.js","components/LibrarySearchedSong.js","pages/Main/Components/Menu.js","Database.js","lib/SettingsObj.js","lib/Instrument.js","lib/AudioRecorder.js","components/AsyncPrompts.js","pages/Main/index.js","assets/icons/addCell.svg","assets/icons/removeCell.svg","lib/hooks/useDebounce.js","pages/Composer/MidiParser.js","pages/Composer/Components/ComposerTools.js","pages/Composer/Components/ComposerNote.js","pages/Composer/Components/MultiSwitch.js","pages/Composer/ComposerKeyboard.js","pages/Composer/Cache.js","pages/Composer/Canvas.js","pages/Composer/Components/Menu.js","pages/Composer/index.js","components/SimpleMenu.js","pages/ErrorPage/index.js","pages/Changelog/index.js","assets/images/partners/windsong-db.jpg","pages/Partners/index.js","pages/Home/index.js","pages/Help/index.js","pages/SheetVisualizer/index.js","serviceWorkerRegistration.js","components/FloatingMessage.js","assets/images/paypalme.png","assets/images/buymeacoffee.svg","pages/Donate/index.js","assets/images/kofi.png","assets/icons/rotate.svg","index.js"],"names":["appName","process","appVersion","console","log","updateMessage","trim","pages","cssClasses","noteComposer","note","noteAnimation","approachCircle","noteName","audioContext","window","AudioContext","webkitAudioContext","instruments","notesPerColumn","instrumentsData","Lyre","notes","Zither","effects","filter","clickColor","DunDun","Bells","Trumpet","Contrabass","Drum","Flute","Guitar","HandPan","ToyUkulele","Harp","Horn","Piano","Pipa","Kalimba","WinterPiano","Xylophone","Ocarina","layoutData","keyboardLayout","split","mobileLayout","keyboardCodes","keyNames","Sky","Genshin","speedChangers","map","e","name","value","pitchArr","composerNotePositions","reverse","importNotePositions","layoutImages","cacheData","noteData","background","border","center","horizontalLineBreak","standards","color","layersCombination","breakpoints","type","isTwa","JSON","parse","sessionStorage","getItem","NoteBorder","props","fill","className","width","height","viewBox","xmlns","style","d","getApproachCircleColor","index","numOfNotes","Math","floor","ApproachCircle","animation","approachRate","borderColor","parseBorderFill","status","Note","state","this","data","approachingNotes","outgoingAnimation","fadeTime","instrument","transition","parseClass","onPointerDown","preventDefault","handleClick","id","key","backgroundColor","draggable","alt","src","noteImage","noteText","Component","songStore","observable","song","eventType","start","Recording","init","Date","getTime","addNote","length","push","Song","version","bpm","pitch","isComposed","isComposedVersion","Object","entries","forEach","entry","LoggerEvent","title","text","timeout","trigger","dispatchEvent","event","undefined","CustomEvent","detail","FileDownloader","download","file","dataType","encodeURIComponent","el","document","createElement","body","appendChild","setAttribute","click","remove","TempoChangers","changer","ComposedSong","columns","selected","Array","column","Column","tempoChanger","NotesTable","ComposerSongDeSerialization","Number","obj","isNaN","columnObj","ColumnNote","ComposerToRecording","recordedSong","bpmPerMs","totalTime","ComposerSongSerialization","columnArr","layer","prepareSongDownload","finalSong","stringify","oldFormatNotes","convertedNotes","noteObj","time","l","composedToOldFormat","recordedToOldFormat","pitchLevel","indexOf","songNotes","bitsPerPage","isEncrypted","prepareSongImport","isArray","includes","getSongType","Error","result","self","findIndex","n","genshinLayout","RecordingToComposed","oldSkyToNewFormat","newSkyFormatToGenshin","precision","bpmToMs","composed","converted","groupedNotes","previousTime","row","shift","amount","i","splice","elapsedTime","emptyColumns","noteColumn","numberToLayer","groupByIndex","group","mergeLayers","grouped","groupByNotes","combinations","columnNote","difference","paddingColumns","finalPadding","col","threshold","getPitchChanger","pow","toFixed","number","final","join","delayMs","ms","Promise","resolve","workerTimers","memo","children","prev","next","Keyboard","approachingSong","a","startDelay","speedChanger","setState","approachingScore","correct","wrong","score","combo","changeSliderState","approachingNotesList","tick","hasSong","sliderState","stateNotes","tickTime","hasChanges","removed","clicked","random","apNote","position","playSong","songTimestamp","timestamp","keyboard","applySpeedChange","previous","pastError","delay","size","practiceSong","songLength","chunks","previousChunkDelay","chunk","startTime","j","firstChunk","nextChunkDelay","secondChunk","keyboardNote","functions","setHasSong","songToPractice","handleSpeedChanger","find","restartSong","override","lostReference","stopSong","setTimeout","isInteger","res","handleSliderEvent","target","handleKeyboard","repeat","activeElement","tagName","shiftKey","code","replace","getNoteFromCode","handleApproachClick","approachingNote","handlePracticeClick","indexClicked","nextChunk","nextNextChunk","onlySound","hasAnimation","approachStatus","playSound","propKeyboard","layout","playTimestamp","disposeStore","tickInterval","addEventListener","setInterval","observe","object","removeEventListener","clearInterval","keyboardSize","keyboardClass","Score","onClick","Memoized","min","onChange","max","disabled","transform","marginBottom","isLoading","instrumentName","isAnimated","getNoteText","noteNameType","layoutLength","HelpTab","mainPageImg","isMobile","Key","songsImg","composerImg","action","MenuPanel","visible","MenuClose","Switch","checked","update","objKey","changeVolume","useState","valueHook","setter","volume","volumeHook","setterVolume","sendChangeSelect","useEffect","options","placeholder","onBlur","onPointerUp","p","DonateButton","SearchedSong","importSong","fetching","setFetching","cache","setCache","fetch","encodeURI","then","json","error","play","Menu","blur","open","checkPersistentStorage","navigator","storage","persist","persisted","isPersisted","isPersistentStorage","handleSearchInput","searchInput","clearSearch","searchedSongs","searchStatus","searchSongs","fetchedSongs","toggleMenu","newState","selectSideMenu","selection","selectedMenu","changeSelectedSongType","selectedSongType","reader","FileReader","songsInput","addSong","fileName","readAsText","downloadSong","_id","songName","song1","toLowerCase","downloadAllSongs","toDownload","songs","fileDownloader","date","toISOString","sideClass","handleSettingChange","changePage","composedSongs","searchedSongFunctions","SongRow","marginTop","paddingTop","display","justifyContent","marginLeft","settings","onKeyDown","onInput","href","deleteSong","removeSong","Database","db","ZangoDb","Db","collections","collection","toArray","findOne","query","insert","DB","getSongs","ComposerSettings","settingVesion","songSetting","layer2","layer3","beatMarks","columnsPerCanvas","caveMode","autosave","backgroundImage","syncTabs","MainPageSettings","approachSpeed","Instrument","String","newVolume","volumeNode","gain","deleted","player","createBufferSource","buffer","buffers","connect","playbackRate","onended","stop","disconnect","load","emptyBuffer","createBuffer","sampleRate","requests","url","arrayBuffer","decodeAudioData","catch","all","loaded","node","delete","createGain","instrumentData","noteNames","mobile","NoteData","ArrayBuffer","AudioRecorder","createMediaStreamDestination","MediaRecorder","recorder","stream","MediaRecorderPolyfill","toUrl","URL","createObjectURL","once","urlBlob","anchor","toWav","blobToAudio","wav","blob","Blob","DataView","fileReader","onloadend","audioBuffer","readAsArrayBuffer","asyncPrompt","question","overlay","container","cancel","ok","input","innerText","append","disposed","inputListener","classList","add","cancelListener","dispose","okListener","handleOverlay","path","clearDOM","focus","asyncConfirm","cancellable","element","querySelectorAll","App","loadInstrument","loadReverb","toggleReverbNodes","thereIsSong","toggleRecord","resetDrag","isDragging","handleDragOver","handleDrag","handleDrop","from","dataTransfer","files","hasReverb","mounted","reverbNode","destination","updateSettings","getSettings","storedSettings","localStorage","newInstrument","isLoadingInstrument","isRecording","handleRecording","setItem","setting","syncSongs","songExists","existsSong","recording","askForSongName","promptString","toggleRecordAudio","isRecordingAudio","reverbVolumeNode","r","b","impulse_response","convolver","createConvolver","gainNode","keyboardFunctions","keyboardData","menuFunctions","menuData","AppButton","active","isInTwa","referrer","setIfInTWA","useDebounce","debouncedValue","setDebouncedValue","handler","clearTimeout","Track","editTrack","dataShown","setDataShown","textAlign","family","cursor","numberOfAccidentals","numberOfOutOfRange","MidiImport","handleFile","midi","Midi","header","tempos","keySignatures","tracks","track","offset","convertMidi","includeAccidentals","outOfRange","totalNotes","midiNote","convertedNote","isAccidental","convertMidiNote","sort","lastColumn","selectedColumn","loadSong","accidentals","command","changeOffset","parseInt","changePitch","toggleAccidentals","changeBpm","changeMidiVisibility","margin","maxWidth","textOverflow","overflow","marginRight","alignItems","NumberInput","changeValue","step","elementValue","setElementValue","debounced","ComposerTools","toggleTools","copyColumns","eraseColumns","pasteColumns","deleteColumns","copiedColumns","currentTarget","ComposerNote","canRender","layers","clickAction","selectedColor","buttonsClass","onSelect","ComposerKeyboard","notesIndexes","currentColumn","hiddenSideMenu","isPlaying","changeLayer","handleTempoChanger","toString","ComposerCache","timelineHeight","destroy","app","generate","canvas","drawColumn","toDataURL","standardColumn","standard","standardLarger","roundNess","noteWidth","noteHeight","ctx","getContext","fillStyle","roundRect","strokeStyle","lineWidth","beginPath","ballHeight","arc","PI","columnsLarger","breakpoint","moveTo","lineTo","notesFigures","PIXI","borderWidth","fillRect","stroke","y","x","radius","tl","tr","br","bl","defaultRadius","side","quadraticCurveTo","closePath","NumOfColumnsPerCanvas","ComposerCanvas","resetPointerDown","stageSelected","sliderSelected","stagePreviousPositon","handleBreakpoints","handleWheel","selectColumn","sign","deltaY","global","relativeColumnWidth","stageSize","stagePosition","onSlider","sliderOffset","throttleScroll","MAX_SAFE_INTEGER","handleSlide","handleStageSlide","clamp","ceil","abs","newPosition","direction","v","globalX","hasSlided","totalWidth","relativePos","sizes","getBoundingClientRect","parentWidth","nearestEven","screen","currentBreakpoint","canvasRef","React","createRef","current","_canvas","xPos","counterLimit","switcher","counter","raf","renderOnComponentChange","ref","interactive","pointerdown","pointermove","pos","currentPos","boundaries","isVisible","tempoChangersCache","standardCache","backgroundCache","isToolsSelected","toolsColumns","isSelected","isBreakpoint","antialias","autoDensity","pointerup","draw","g","clear","beginFill","drawRect","fillX","image","lineStyle","drawRoundedRect","drawStage","toggleBreakpoint","pointertap","interactiveChildren","alpha","zIndex","num","round","toggleMenuVisible","updateSong","currentSong","createNewSong","songFunctions","hasUnsaved","menuClass","menuOpen","startRecordingAudio","Composer","promises","setupAudioDestination","handleAutoSave","changes","ins","togglePlay","letter","broadcastChannel","postMessage","nextLayer","removeColumns","addColumns","layerIndex","replaceAt","currentNote","askForSongUpdate","confirm","songColumns","msPerBPM","handleTick","newIndex","indexOfBreakpoint","validateBreakpoints","page","ignoreAudio","toolsVisible","copiedColums","copiedColumn","copiedNote","columnIndex","visibility","midiVisible","playbackInterval","BroadcastChannel","onmessage","location","hostname","returnValue","close","end","totalLength","currentLength","increment","total","calculateLength","canvasFunctions","canvasData","toolsData","toolsFunctions","midiParserFunctions","midiParserData","addCell","removeCell","formatMillis","millis","minutes","seconds","string","replacement","valueOf","substring","SimpleMenu","rel","ErrorPage","deleteAllSongs","resetSettings","removeItem","Changelogpage","changelogs","ChangelogRow","item","arr","Partners","Partner","description","Iframe","PartnerImg","img","WindsongDBImg","to","borderRadius","objectFit","frameBorder","allow","allowFullScreen","Home","askForStorage","hasVisited","homeClass","isInPosition","innerWidth","toggleHome","hasPersistentStorage","MainContentelement","icon","Separator","PageRedirect","setDontShowHome","canShow","readOnly","Help","fontSize","SheetVisualizer","setSongs","sheet","setSheet","framesPerRow","setFramesPerRow","setCurrentSong","setSelectedSongType","setFrames","newAmount","frame","querySelector","flexDirection","print","gridTemplateColumns","SheetFrame","rows","columnsPerRow","exists","selectedStyle","isLocalhost","Boolean","match","registerValidSW","swUrl","config","serviceWorker","register","registration","onupdatefound","installingWorker","installing","onstatechange","controller","onUpdate","onSuccess","FloatingMessage","classes","Donate","paypalImg","buyMeACoffeeImg","Index","homeData","selectedPage","homeVisible","lastState","closeWelcomeScreen","hideMessage","floatingMessage","checkUpdate","updateChecked","storedVersion","logEvent","canShowHome","exact","rotateImg","ReactDOM","render","StrictMode","getElementById","origin","headers","response","contentType","get","ready","unregister","reload","checkValidServiceWorker","serviceWorkerRegistration"],"mappings":"6fAAMA,EAAUC,MACVC,EAAa,MACnBC,QAAQC,IAAR,UAAeJ,EAAf,aAA2BE,IAC3B,IAAMG,EACA,8NAIAC,OAOAC,EAAQ,CAAC,GAAI,WAAY,YAAa,YAAY,SAAU,WAAW,OAAO,OAAQ,mBAEtFC,EAAa,CACfC,aAA0B,YAAZT,EAAwB,gBAAkB,oBACxDU,KAAkB,YAAZV,EAAwB,OAAS,WACvCW,cAA2B,YAAZX,EAAwB,iBAAmB,qBAC1DY,eAA4B,YAAZZ,EAAwB,kBAAoB,sBAC5Da,SAAsB,YAAZb,EAAwB,YAAc,iBAE9Cc,EAAe,IAAKC,OAAOC,cAAgBD,OAAOE,oBAElDC,EAA0B,YAAZlB,EACd,CACE,OACA,SACA,aACA,UACH,CACG,QACA,aACA,SACA,OACA,OACA,UACA,OACA,cACA,YACA,QACA,UACA,UACA,aACA,OACA,QACA,SACA,WAEFmB,EAA6B,YAAZnB,EAAwB,GAAK,GAC9CoB,EAAkB,CACpBC,KAAM,CACFC,MAAO,IAEXC,OAAO,CACHD,MAAO,GACPE,QAAS,CACLC,OAAQ,eAEZC,WAAY,WAEhB,aAAa,CACTJ,MAAO,GACPE,QAAS,CACLC,OAAQ,eAEZC,WAAY,WAEhBC,OAAQ,CACJL,MAAO,GAEXM,MAAO,CACHN,MAAO,GAEXO,QAAQ,CACJP,MAAO,IAEXQ,WAAY,CACRR,MAAO,IAEXS,KAAM,CACFT,MAAO,GAEXU,MAAO,CACHV,MAAO,IAEXW,OAAQ,CACJX,MAAO,IAEXY,QAAS,CACLZ,MAAO,GAEXa,WAAW,CACPb,MAAM,IAEVc,KAAM,CACFd,MAAO,IAEXe,KAAM,CACFf,MAAO,IAEXgB,MAAO,CACHhB,MAAO,IAEXiB,KAAM,CACFjB,MAAO,IAEXkB,QAAS,CACLlB,MAAO,IAEXmB,YAAa,CACTnB,MAAO,IAEXoB,UAAW,CACPpB,MAAO,IAEXqB,QAAQ,CACJrB,MAAM,KAKRsB,EAAa,CACf,GAAI,CACAC,eAAgB,4CAEKC,MAAM,KAE3BC,aAAc,iEAEcD,MAAM,KAElCE,cAAe,iEAEaF,MAAM,MAEtC,EAAG,CACCD,eAAgB,kBACDC,MAAM,KAErBC,aAAc,0BACKD,MAAM,KAEzBE,cAAe,0BACAF,MAAM,MAEzB,GAAI,CACAD,eAAgB,gCAECC,MAAM,KAEvBC,aAAc,+CAEQD,MAAM,KAE5BE,cAAe,+CAEOF,MAAM,OAI9BG,EAAW,CACbC,IAAK,CACD,EAAG,CAAC,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,KAC1E,EAAG,CAAC,KAAM,KAAM,IAAK,KAAM,KAAM,KAAM,IAAK,KAAM,KAAM,IAAK,KAAM,KAAM,KAAM,IAAK,MACpF,EAAG,CAAC,IAAK,IAAK,KAAM,IAAK,IAAK,IAAK,KAAM,IAAK,IAAK,KAAM,IAAK,IAAK,IAAK,KAAM,KAC9E,EAAG,CAAC,KAAM,IAAK,IAAK,KAAM,KAAM,IAAK,IAAK,KAAM,IAAK,IAAK,KAAM,KAAM,IAAK,IAAK,MAChF,EAAG,CAAC,IAAK,KAAM,KAAM,IAAK,IAAK,KAAM,KAAM,IAAK,KAAM,KAAM,IAAK,IAAK,KAAM,KAAM,KAClF,EAAG,CAAC,IAAK,IAAK,IAAK,KAAM,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,KAAM,IAAK,IAAK,IAAK,KAC5E,EAAG,CAAC,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,IAAK,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,IAAK,MACtF,EAAG,CAAC,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,KAAM,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,KAAM,KAC5E,EAAG,CAAC,KAAM,KAAM,IAAK,KAAM,KAAM,IAAK,IAAK,KAAM,KAAM,IAAK,KAAM,KAAM,IAAK,IAAK,MAClF,EAAG,CAAC,IAAK,IAAK,KAAM,IAAK,IAAK,KAAM,KAAM,IAAK,IAAK,KAAM,IAAK,IAAK,KAAM,KAAM,KAChF,GAAI,CAAC,KAAM,IAAK,IAAK,KAAM,IAAK,IAAK,IAAK,KAAM,IAAK,IAAK,KAAM,IAAK,IAAK,IAAK,MAC/E,GAAI,CAAC,IAAK,KAAM,KAAM,IAAK,KAAM,KAAM,KAAM,IAAK,KAAM,KAAM,IAAK,KAAM,KAAM,KAAM,MAEzFC,QAAQ,CACJ,EAAG,CAAC,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,KACxG,EAAG,CAAC,KAAM,KAAM,IAAK,KAAM,KAAM,KAAM,IAAK,KAAM,KAAM,IAAK,KAAM,KAAM,KAAM,IAAK,KAAO,KAAM,IAAK,KAAM,KAAM,KAAM,IAAK,MAC7H,EAAG,CAAC,IAAK,IAAK,KAAM,IAAK,IAAK,IAAK,KAAM,IAAK,IAAK,KAAM,IAAK,IAAK,IAAK,KAAM,IAAK,IAAK,KAAM,IAAK,IAAK,IAAK,KAAM,KACnH,EAAG,CAAC,KAAM,IAAK,IAAK,KAAM,KAAM,IAAK,IAAK,KAAM,IAAK,IAAK,KAAM,KAAM,IAAK,IAAK,KAAM,IAAK,IAAK,KAAM,KAAM,IAAK,IAAK,MACtH,EAAG,CAAC,IAAK,KAAM,KAAM,IAAK,IAAK,KAAM,KAAM,IAAK,KAAM,KAAM,IAAK,IAAK,KAAM,KAAM,IAAK,KAAM,KAAM,IAAK,IAAK,KAAM,KAAM,KACzH,EAAG,CAAC,IAAK,IAAK,IAAK,KAAM,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,KAAM,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,KAAM,IAAK,IAAK,IAAK,KAChH,EAAG,CAAC,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,IAAK,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,IAAK,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,IAAK,MAC/H,EAAG,CAAC,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,KAAM,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,KAAM,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,KAAM,KAChH,EAAG,CAAC,KAAM,KAAM,IAAK,KAAM,KAAM,IAAK,IAAK,KAAM,KAAM,IAAK,KAAM,KAAM,IAAK,IAAK,KAAM,KAAM,IAAK,KAAM,KAAM,IAAK,IAAK,MACzH,EAAG,CAAC,IAAK,IAAK,KAAM,IAAK,IAAK,KAAM,KAAM,IAAK,IAAK,KAAM,IAAK,IAAK,KAAM,KAAM,IAAK,IAAK,KAAM,IAAK,IAAK,KAAM,KAAM,KACtH,GAAI,CAAC,KAAM,IAAK,IAAK,KAAM,IAAK,IAAK,IAAK,KAAM,IAAK,IAAK,KAAM,IAAK,IAAK,IAAK,KAAM,IAAK,IAAK,KAAM,IAAK,IAAK,IAAK,MACpH,GAAI,CAAC,IAAK,KAAM,KAAM,IAAK,KAAM,KAAM,KAAM,IAAK,KAAM,KAAM,IAAK,KAAM,KAAM,KAAM,IAAK,KAAM,KAAM,IAAK,KAAM,KAAM,KAAM,OAG/HC,EAAgB,CAAC,IAAK,GAAI,IAAK,EAAE,KAAK,IAAI,GAAGC,KAAI,SAAAC,GACnD,MAAO,CACHC,KAAK,IAAD,OAAMD,GACVE,MAAOF,MAITG,EAAW,CAAC,IAAK,KAAM,IAAK,KAAM,IAAK,IAAK,KAAM,IAAK,KAAM,IAAK,KAAM,KAExEC,EAAqC,YAAZ1D,EAAwB,CAAC,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAAG2D,UAAY,CAAC,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,GAAG,GAAG,GAAG,GAAG,IAAIA,UAE/LC,EAAkC,YAAZ5D,EAAwB,CAAC,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAM,CAAC,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,GAAG,GAAG,GAAG,GAAG,IAE3I6D,EAAe,CACjB,GAAI,qDAAqDf,MAAM,KAC/D,EAAe,QAAZ9C,EAAmB,0BAA0B8C,MAAM,KAAO,0BAA0BA,MAAM,KAC7F,GAAI,iEAAiEA,MAAM,MAGzEgB,EAAY,CACdC,SAAU,CACNC,WAAY,UACZC,OAAQ,UACRC,OAAQ,WAEZC,oBAAqBhD,EAAiB,EACtCiD,UAAW,CACP,CACIC,MAAO,SAEX,CACIA,MAAO,SAEX,CACIA,MAAO,SAEX,CACIA,MAAO,WAGfC,kBAAmB,CAAC,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,OACrEC,YAAa,CACT,CACIC,KAAM,QACNH,MAAO,WAEX,CACIG,KAAM,OACNH,MAAO,aAMnB,SAASI,IAEL,OADYC,KAAKC,MAAMC,eAAeC,QAAQ,U,WCxPnC,SAASC,EAAWC,GAC/B,IAAQC,EAAoBD,EAApBC,KAAMC,EAAcF,EAAdE,UACd,OAAO,qBACHC,MAAM,QACNC,OAAO,QACPF,UAAWA,EACXG,QAAQ,cACRC,MAAM,6BACNC,MAAO,CAAEN,KAAMA,GAAQ,WANpB,SAQH,sBACIO,EAAE,yiCCsDd,SAASC,EAAuBC,GAC5B,IAAIC,EAAyB,QAAZ1F,EAAoB,EAAI,EAGzC,MADa,CAAC,UAAW,UAAW,WAD1B2F,KAAKC,MAAMH,EAAQC,IAKjC,SAASG,EAAed,GACpB,OAAO,qBACHE,UAAWzE,EAAWI,eACtB0E,MAAO,CACHQ,UAAU,YAAD,OAAcf,EAAMgB,aAApB,aACTC,YAAaR,EAAuBT,EAAMU,UAMtD,SAASQ,EAAgBC,GACrB,IAAIlB,EAAO,UAGX,MAFe,YAAXkB,EAAsBlB,EAAO,cACb,gBAAXkB,GAAuC,mBAAXA,IAA6BlB,EAAO,WAClEA,EAiBImB,M,kDApGX,WAAYpB,GAAQ,IAAD,8BACf,cAAMA,IACDqB,MAAQ,GAFE,E,0CAMnB,WAAU,IAAD,IACGrB,EAAUsB,KAAVtB,MACAuB,EAAwDvB,EAAxDuB,KAAMC,EAAkDxB,EAAlDwB,iBAAkBC,EAAgCzB,EAAhCyB,kBAAmBC,EAAa1B,EAAb0B,SAC3CP,EAAqCI,EAArCJ,OAAQH,EAA6BO,EAA7BP,aAAcW,EAAeJ,EAAfI,WACxBZ,EAAY,CACda,WAAW,oBAAD,OAAsB5B,EAAM0B,SAA5B,eAA2CA,KAA0B,YAAZzG,EAAwB,IAAM,KAAO,OAAS,SAAvG,2CAERiF,EAyEd,SAAoBiB,GAChB,IAAIjB,EAAYzE,EAAWE,KAC3B,OAAQwF,GACJ,IAAK,UAAWjB,GAAa,eAAgB,MAC7C,IAAK,UAAWA,GAAa,YAAa,MAC1C,IAAK,cAAeA,GAAa,qBAAsB,MACvD,IAAK,iBAAkBA,GAAa,8BAA+B,MACnE,IAAK,iBAAkBA,GAAa,8BAA+B,MACnE,IAAK,mBAAoBA,GAAa,gCAG1C,OAAOA,EApFe2B,CAAWV,GACvB1E,GAAU,UAAAJ,EAAgBsF,UAAhB,eAA6BlF,UAAW,GAClDE,EAAU,UAAGN,EAAgBsF,UAAnB,aAAG,EAA6BhF,WAEhD,OAAO,yBACHmF,cAAe,SAACvD,GACZA,EAAEwD,iBACF/B,EAAMgC,YAAYT,IAEtBrB,UAAU,uBALP,UAOFsB,EAAiBlD,KAAI,SAAC3C,GACnB,OAAO,cAACmF,EAAD,CAEHJ,MAAOa,EAAKb,MACZM,aAAcA,GAFTrF,EAAKsG,OAKjBR,EAAkBnD,KAAI,SAAAC,GACnB,OAAO,qBAEH2B,UAAWzE,EAAWG,eADjB2C,EAAE2D,QAIf,sBACIhC,UAAWA,EACXK,MAAK,2BACEQ,GACCpE,GAAyB,YAAXwE,EAAuB,CAAEgB,gBAAiBxF,GAAe,IAJnF,UAOI,qBACIyF,UAAU,QACVC,IAAI,GACJC,IAAKtC,EAAMuC,UACXhC,MAAO9D,IAEE,YAAZxB,GAAyB,cAAC,EAAD,CACtBiF,UAAU,iBACVD,KAAMiB,EAAgBC,KAE1B,qBAAKjB,UAAWzE,EAAWK,SAA3B,SACKkE,EAAMwC,qB,GAxDRC,aCFNC,EAAYC,YAAW,CAChCpB,KAAM,CACFqB,KAAM,GACNC,UAAW,GACXC,MAAO,K,gBCHTC,EACL,aAAe,IAAD,gCAIdC,KAAO,WACN,EAAKF,OAAQ,IAAIG,MAAOC,UAAY,IACpC9H,QAAQC,IAAI,0BANC,KAQd8H,QAAU,SAACzC,GACgB,IAAtB,EAAKnE,MAAM6G,QAAc,EAAKJ,OAClC,IACIrH,EAAO,CAAC+E,GADM,IAAIuC,MAAOC,UACI,EAAKJ,OACtC,EAAKvG,MAAM8G,KAAK1H,IAXhB2F,KAAKwB,OAAQ,IAAIG,MAAOC,UACxB5B,KAAK/E,MAAQ,IAcT+G,EACL,WAAY9E,GAA8B,IAAD,OAAvBjC,EAAuB,uDAAf,GAAIgF,EAAW,uDAAJ,GAAI,oBACxCD,KAAK9C,KAAOA,EACZ8C,KAAKiC,QAAU,EACfjC,KAAK/E,MAAQA,EACb+E,KAAKkC,IAAM,IACXlC,KAAKmC,MAAQ,IACbnC,KAAKC,KAAO,CACXmC,YAAY,EACZC,mBAAmB,EACnB1I,QAASA,GAEV2I,OAAOC,QAAQtC,GAAMuC,SAAQ,SAACC,GAC7B,EAAKxC,KAAKwC,EAAM,IAAMA,EAAM,OAKzBC,EACL,WAAYC,EAAOC,EAAMC,GAAU,IAAD,gCAalCC,QAAU,WACTpI,OAAOqI,cAAc,EAAKC,QAb1BhD,KAAK2C,MAAQA,EACb3C,KAAK6C,QAAUA,EACf7C,KAAK4C,KAAOA,OACIK,IAAZJ,IAAuB7C,KAAK6C,QAAU,KAC1C7C,KAAKgD,MAAQ,IAAIE,YAAY,WAAY,CACxCC,OAAQ,CACPR,MAAO3C,KAAK2C,MACZC,KAAM5C,KAAK4C,KACXC,QAAS7C,KAAK6C,YA0BZO,EACL,WAAYjF,GAAO,IAAD,gCAIlBkF,SAAW,SAACC,EAAMpG,GACjB,IAAI+C,EAAO,EAAKsD,SAAWC,mBAAmBF,GAC1CG,EAAKC,SAASC,cAAc,KAChCF,EAAGxE,MAAQ,eACXyE,SAASE,KAAKC,YAAYJ,GAC1BA,EAAGK,aAAa,OAAQ7D,GACxBwD,EAAGK,aAAa,WAAY5G,GAC5BuG,EAAGM,QACHN,EAAGO,eAXUf,IAAT9E,IAAoBA,EAAO,aAC/B6B,KAAKuD,SAAW,QAAUpF,EAAO,mBAc7B8F,EAAgB,CACrB,CACCtD,GAAI,EACJiC,KAAM,IACNsB,QAAS,EACTlG,MAAO,SACL,CACF2C,GAAI,EACJiC,KAAM,MACNsB,QAAS,GACTlG,MAAO,SACL,CACF2C,GAAI,EACJiC,KAAM,MACNsB,QAAS,EAAI,EACblG,MAAO,SACL,CACF2C,GAAI,EACJiC,KAAM,MACNsB,QAAS,EAAI,EACblG,MAAO,UAIHmG,EACL,WAAYjH,GAA8B,IAAD,OAAvBjC,EAAuB,uDAAf,GAAIgF,EAAW,uDAAJ,GAAI,oBACxCA,EAAKmC,YAAa,EAClBnC,EAAKoC,mBAAoB,EACzBrC,KAAKiC,QAAU,EACfjC,KAAKC,KAAOA,EACZD,KAAK9C,KAAOA,EACZ8C,KAAKkC,IAAM,IACXlC,KAAKmC,MAAQ,IACbnC,KAAK/E,MAAQA,EACb+E,KAAKnF,YAAc,CAACA,EAAY,GAAIA,EAAY,GAAIA,EAAY,IAChEmF,KAAK9B,YAAc,CAAC,GACpB8B,KAAKoE,QAAU,GACfpE,KAAKqE,SAAW,EAChB,IAAIC,MAAM,KAAK3F,OAAO6D,SAAQ,SAACvF,GAC9B,IAAIsH,EAAS,IAAIC,GACjBD,EAAOE,aAAe,EACtB,EAAKL,QAAQrC,KAAKwC,OAKrB,SAASG,EAAW5C,GACnB,OAAO,IAAIwC,MAAMxC,GAAQnD,OAAO3B,KAAI,WAAO,MAAO,MAGnD,SAAS2H,EAA4BrD,GAAO,IAAD,IACpCY,EAAM0C,OAAOtD,EAAKY,KAClB2C,EAAM,CACX5E,KAAMqB,EAAKrB,KACX/C,KAAMoE,EAAKpE,KACXgF,IAAK4C,MAAM5C,GAAO,IAAMA,EACxBC,MAAK,UAAEb,EAAKa,aAAP,QAAgB,IACrBtH,YAAayG,EAAKzG,aAAe,CAACA,EAAY,GAAIA,EAAY,GAAIA,EAAY,IAC9EqD,YAAW,UAAEoD,EAAKpD,mBAAP,QAAsB,GACjCjD,MAAO,GACPoJ,SAAU,EACVD,QAAS,IAUV,OARA9C,EAAK8C,QAAQ5B,SAAQ,SAAA+B,GACpB,IAAMQ,EAAY,IAAIP,GACtBO,EAAUN,aAAeF,EAAO,GAChCA,EAAO,GAAG/B,SAAQ,SAAAnI,GACjB0K,EAAU9J,MAAM8G,KAAK,IAAIiD,GAAW3K,EAAK,GAAIA,EAAK,QAEnDwK,EAAIT,QAAQrC,KAAKgD,MAEXF,EAGR,SAASI,EAAoB3D,GAC5B,IAAM4D,EAAe,IAAIlD,EAAKV,EAAKpE,MAC7BiI,EAAW7F,KAAKC,MAAM,IAAQ+B,EAAKY,KACrCkD,EAAY,IAOhB,OANA9D,EAAK8C,QAAQ5B,SAAQ,SAAA+B,GACpBA,EAAO,GAAG/B,SAAQ,SAAAnI,GACjB6K,EAAajK,MAAM8G,KAAK,CAAC1H,EAAK,GAAI+K,OAEnCA,GAAa9F,KAAKC,MAAM4F,EAAWlB,EAAcM,EAAO,IAAIL,YAEtDgB,EAGR,SAASG,GAA0B/D,GAClC,IAAMY,EAAM0C,OAAOtD,EAAKY,KAClB2C,EAAM,CACX5E,KAAMqB,EAAKrB,KACX/C,KAAMoE,EAAKpE,KACXgF,IAAK4C,MAAM5C,GAAO,IAAMA,EACxBC,MAAOb,EAAKa,MACZjE,YAAaoD,EAAKpD,YAClBrD,YAAayG,EAAKzG,YAClBuJ,QAAS,IAeV,OAbAS,EAAI5E,KAAKtG,QAAUA,EAKnB2H,EAAK8C,QAAQ5B,SAAQ,SAAA+B,GACpB,IAAIe,EAAY,CAACf,EAAOE,cACpBxJ,EAAQsJ,EAAOtJ,MAAM+B,KAAI,SAAA3C,GAC5B,MAAO,CAACA,EAAK+E,MAAO/E,EAAKkL,UAE1BD,EAAU,GAAKrK,EACf4J,EAAIT,QAAQrC,KAAKuD,MAEXT,EAGR,SAASW,GAAoBlE,GAAO,IAAD,EAC9BmE,EAAYpH,KAAKC,MAAMD,KAAKqH,UAAUpE,IACtCqE,EAAiB,GAWrB,OATCA,GADD,UAAIF,EAAUxF,YAAd,aAAI,EAAgBoC,mBAiCrB,SAA6Bf,GAC5B,IAAIsE,EAAiB,GACjBT,EAAW7F,KAAKC,MAAM,IAAQ+B,EAAKY,KACnCkD,EAAY,IAoBhB,OAnBA9D,EAAK8C,QAAQ5B,SAAQ,SAAA+B,GACpBA,EAAO,GAAG/B,SAAQ,SAAAnI,GACjB,IAAIkL,EAAQ,EACI,QAAZlL,EAAK,KAAckL,EAAQ,GACf,QAAZlL,EAAK,KAAckL,EAAQ,GACf,QAAZlL,EAAK,KAAckL,EAAQ,GACf,QAAZlL,EAAK,KAAckL,EAAQ,GACf,QAAZlL,EAAK,KAAckL,EAAQ,GACf,QAAZlL,EAAK,KAAckL,EAAQ,GACf,QAAZlL,EAAK,KAAckL,EAAQ,GAC/B,IAAIM,EAAU,CACbjF,KAAM2E,EAAQ,EAAI,EAAIA,GAAS,MAAQlL,EAAK,GAC5CyL,KAAMV,GAEHG,EAAQ,IAAGM,EAAQE,EAAI,GAC3BH,EAAe7D,KAAK8D,MAErBT,GAAa9F,KAAKC,MAAM4F,EAAWlB,EAAcM,EAAO,IAAIL,YAEtD0B,EAvDWI,CAAoBP,GA0DvC,SAA6BnE,GAC5B,IAAIsE,EAAiB,GAOrB,OANAtE,EAAKrG,MAAMuH,SAAQ,SAAAnI,GAClBuL,EAAe7D,KAAK,CACnB+D,KAAMzL,EAAK,GACXuG,IAAK,OAASvG,EAAK,QAGduL,EAhEWK,CAAoBR,GAEtCA,EAAUrD,WAAaqD,EAAUxF,KAAKoC,kBACtCoD,EAAUS,WAAa9I,EAAS+I,QAAQV,EAAUtD,OAClDsD,EAAUW,UAAYT,EACtBF,EAAUY,YAAc,GACxBZ,EAAUa,aAAc,EACjB,CAACb,GAGT,SAASc,GAAkBjF,GAAO,IAAD,IAC5BgD,MAAMkC,QAAQlF,IAASA,EAAKQ,OAAS,IAAGR,EAAOA,EAAK,IACxD,IAAInD,EAuDL,SAAqBmD,GACpB,IACC,QAAkB2B,IAAd3B,EAAKrB,KAQR,OAAIqB,EAAKrB,KAAKoC,kBACY,kBAAdf,EAAKpE,MACQ,kBAAboE,EAAKY,IAD0B,OAErC9E,EAASqJ,SAASnF,EAAKa,QACxBmC,MAAMkC,QAAQlF,EAAKpD,aAClBoD,EAAKpD,YAAY4D,OAAS,GACM,kBAAxBR,EAAKpD,YAAY,GAAwB,OAKlDoG,MAAMkC,QAAQlF,EAAK8C,SAClB9C,EAAK8C,QAAQtC,OAAS,GAEA,kBADZR,EAAK8C,QAAQ,GACR,GAAwB,OAKrC,cAFC,OAdmC,OAkBlB,kBAAd9C,EAAKpE,MACQ,kBAAboE,EAAKY,IAD0B,OAErC9E,EAASqJ,SAASnF,EAAKa,OACrB,cADoC,OA5B5C,GADAb,EAAK4E,WAAa5E,EAAK4E,YAAc,OACdjD,IAAnB3B,EAAK8E,UACR,MAAO,SAgCR,MAAOnJ,GAER,OADAnD,QAAQC,IAAIkD,GACL,OAER,MAAO,OAjGIyJ,CAAYpF,GACvB,GAAa,SAATnD,EAEH,MADA,IAAIuE,EAAY,QAAS,gBAAgBI,UACnC,IAAI6D,MAAM,sBAKjB,GAHa,WAATxI,IACHmD,EAmHF,SAA2BA,GAC1B,IAAIsF,EAAS,IAAI5E,EAAK,SACtB,IACC,IAAME,EAAM0C,OAAOtD,EAAKY,MACxB0E,EAAS,IAAI5E,EAAKV,EAAKpE,OAChBgF,IAAM4C,MAAM5C,GAAO,IAAMA,EAChC0E,EAAOzE,MAAS/E,EAASkE,EAAK4E,YAAc,IAAO,IAEnD5E,EAAK8E,UAAY9E,EAAK8E,UAAUhL,QAAO,SAACf,EAAM+E,EAAOyH,GAAd,OACtCzH,IAAUyH,EAAKC,WAAU,SAACC,GACzB,OAAOA,EAAEnG,IAAInE,MAAM,OAAO,KAAOpC,EAAKuG,IAAInE,MAAM,OAAO,IAAMsK,EAAEjB,OAASzL,EAAKyL,WAG/DxE,EAAK8E,UACX5D,SAAQ,SAAAnI,GAAS,IAAD,EACrB4F,EAAO5F,EAAKuG,IAAInE,MAAM,OAC1BmK,EAAO3L,MAAM8G,KAAK,CAACiF,GAAc/G,EAAK,IAAK5F,EAAKyL,KAA9B,UAAoCzL,EAAK0L,SAAzC,QAA8CnB,OAAO3E,EAAK,SAGzE,EAAC,EAAM,QAAQwG,SAASnF,EAAKc,YAChCwE,EAASvB,GAA0B4B,GAAoBL,IAEvDA,EAAO3L,MAAQ2L,EAAO3L,MAAM+B,KAAI,SAAAC,GAAC,MAAI,CAACA,EAAE,GAAIA,EAAE,OAI9C,MAAOA,GAER,OADAnD,QAAQC,IAAIkD,GACL,IAAI+E,EAAK,wCAEjB,OAAO4E,EAjJCM,CAAkB5F,IAEV,QAAZ3H,GAA4C,SAAvB,UAAA2H,EAAKrB,YAAL,eAAWtG,SAEnC,MADA,IAAI+I,EAAY,QAAS,gBAAgBI,UACnC,IAAI6D,MAAM,sBAKjB,MAHgB,YAAZhN,GAAgD,SAAvB,UAAA2H,EAAKrB,YAAL,eAAWtG,WACvC2H,EAyFF,SAA+BA,GAC1BA,EAAKrB,KAAKoC,oBACbf,EAAKzG,YAAcyG,EAAKzG,YAAYmC,KAAI,SAAAqD,GAAU,MAAI,UACtDiB,EAAK8C,QAAQ5B,SAAQ,SAAA+B,GACpBA,EAAO,GAAKA,EAAO,GAAGvH,KAAI,SAAA3C,GACzB,MAAO,CAAC2M,GAAc3M,EAAK,IAAKA,EAAK,WAKnCiH,EAAKrB,KAAKoC,oBACdf,EAAKrG,MAAQqG,EAAKrG,MAAM+B,KAAI,SAAA3C,GAE3B,OADAA,EAAK,GAAK2M,GAAc3M,EAAK,IACtBA,MAGT,OAAOiH,EAzGC6F,CAAsB7F,IAEvBA,EAqFR,IAAM0F,GAAgBzJ,EAsDtB,SAAS0J,GAAoB3F,GAAqB,IAAhB8F,EAAe,uDAAH,EACzCC,EAAU/H,KAAKC,MAAM,IAAQ+B,EAAKY,KAClCoF,EAAW,IAAInD,EAAa7C,EAAKpE,KAAM,IAC3CoK,EAASpF,IAAMZ,EAAKY,IACpBoF,EAASnF,MAAQb,EAAKa,MACtB,IAAIlH,EAAQqG,EAAKrG,MAEbsM,EAAY,GAChB,GAAiB,IAAdH,EAAiB,CAGb,IAFA,IAAII,EAAe,GACrBC,EAAexM,EAAM,GAAG,GACfA,EAAM6G,OAAS,GAAG,CAGrB,IAFA,IAAI4F,EAAM,CAACzM,EAAM0M,SACbC,EAAS,EACJC,EAAI,EAAGA,EAAI5M,EAAM6G,OAAQ+F,IAC1BH,EAAI,GAAG,GAAKzM,EAAM4M,GAAG,GAAKR,EAAU,GAAGO,IAE/CJ,EAAazF,KAAb,UAAsB2F,EAAtB,YAA8BzM,EAAM6M,OAAO,EAAGF,MAElD,IAAIxD,EAAU,GACdoD,EAAahF,SAAQ,SAAAvH,GACjB,IAAIZ,EAAOY,EAAM,GACjB,GAAKZ,EAAL,CACA,IAAI0N,EAAc1N,EAAK,GAAKoN,EAC5BA,EAAepN,EAAK,GACpB,IAAI2N,EAAe1I,KAAKC,OAAOwI,EAAcV,GAAWA,GACpDW,GAAgB,GAAG,IAAI1D,MAAM0D,GAAcrJ,KAAK,GAAG6D,SAAQ,kBAAM4B,EAAQrC,KAAK,IAAIyC,OACtF,IAAIyD,EAAa,IAAIzD,GACrByD,EAAWhN,MAAQA,EAAM+B,KAAI,SAAA3C,GACzB,OAAO,IAAI2K,GAAW3K,EAAK,GAAI6N,GAAc7N,EAAK,IAAM,OAE5D+J,EAAQrC,KAAKkG,OAEjB7D,EAAQ5B,SAAQ,SAAA+B,GACZ,IAAIiD,EAAeW,GAAa5D,GAChCA,EAAOtJ,MAAQuM,EAAaxK,KAAI,SAAAoL,GAE5B,OADAA,EAAM,GAAG7C,MAAQ8C,GAAYD,GACtBA,EAAM,SAG3Bb,EAAYnD,OAIZ,IAFA,IAAIkE,EAAUC,GAAatN,EAAOoM,EAAU,GACxCmB,EAAe,CAACnB,EAAS/H,KAAKC,MAAM8H,EAAU,GAAI/H,KAAKC,MAAM8H,EAAU,GAAI/H,KAAKC,MAAM8H,EAAU,IAFhG,WAGKQ,GAHL,MAICtD,EAAS,IAAIC,GACjBD,EAAOtJ,MAAQqN,EAAQT,GAAG7K,KAAI,SAAA3C,GAC7B,IAAIoO,EAAa,IAAIzD,GAAW3K,EAAK,IAMrC,OALgB,IAAZA,EAAK,KAAUoO,EAAWlD,MAAQ,OACtB,IAAZlL,EAAK,KAAUoO,EAAWlD,MAAQ,OACtB,IAAZlL,EAAK,KAAUoO,EAAWlD,MAAQ,OACtB,IAAZlL,EAAK,KAAUoO,EAAWlD,MAAQ,YACtBtC,IAAZ5I,EAAK,KAAkBoO,EAAWlD,MAAQ,OACvCkD,KAKR,IAHA,IACIC,GADOJ,EAAQT,EAAI,IAAM,CAAC,CAAC,EAAG,EAAG,KACf,GAAG,GAAKS,EAAQT,GAAG,GAAG,GACxCc,EAAiB,GACdD,GAAcF,EAAa,IACjC,GAAIE,EAAaF,EAAa,IAAM,EACnCE,GAAcF,EAAa,GAC3BG,EAAe5G,KAAK,QACd,GAAI2G,EAAaF,EAAa,IAAM,EAAI,CAE9C,GADAE,GAAcF,EAAa,GACxBpB,GAAa,EAAG,SACnBuB,EAAe5G,KAAK,QACd,GAAI2G,EAAaF,EAAa,IAAM,EAAG,CAE7C,GADAE,GAAcF,EAAa,GACxBpB,GAAa,EAAG,SACnBuB,EAAe5G,KAAK,QACd,GAAI2G,EAAaF,EAAa,IAAM,EAAG,CAE7C,GADAE,GAAcF,EAAa,GACxBpB,GAAa,EAAG,SACnBuB,EAAe5G,KAAK,GAGtB,IAAI6G,EAAe,GACnBrE,EAAOE,aAAekE,EAAehB,SAAW,EAChDgB,EAAiBA,EAAenG,SAAQ,SAACqG,EAAKhB,GAC7C,IAAItD,EAAS,IAAIC,GACjBD,EAAOE,aAAeoE,EACtBD,EAAa7G,KAAKwC,OAEnB,EAAAgD,GAAUxF,KAAV,SAAewC,GAAf,OAA0BqE,KAvClBf,EAAI,EAAGA,EAAIS,EAAQxG,OAAQ+F,IAAM,EAAjCA,GA2CV,OADAP,EAASlD,QAAUmD,EACZD,E,IAGF9C,GACL,aAAe,oBACdxE,KAAK/E,MAAQ,GACb+E,KAAKyE,aAAe,GAKtB,SAAS8D,GAAatN,EAAO6N,GAE5B,IADA,IAAIlC,EAAS,GACN3L,EAAM6G,OAAS,GAAG,CAGxB,IAFA,IAAI4F,EAAM,CAACzM,EAAM0M,SACbC,EAAS,EACJC,EAAI,EAAGA,EAAI5M,EAAM6G,OAAQ+F,IAC7BH,EAAI,GAAG,GAAKzM,EAAM4M,GAAG,GAAKiB,GAAWlB,IAE1ChB,EAAO7E,KAAP,UAAgB2F,EAAhB,YAAwBzM,EAAM6M,OAAO,EAAGF,MAEzC,OAAOhB,E,IAGF5B,GACL,WAAY5F,GAAuB,IAAhBmG,EAAe,uDAAP,MAAO,oBACjCvF,KAAKZ,MAAQA,EACbY,KAAKuF,MAAQA,GAIf,SAASwD,GAAgB5G,GACxB,IAAI/C,EAAQhC,EAAS+I,QAAQhE,GAE7B,OADI/C,EAAQ,IAAGA,EAAQ,GAChBwF,OAAOtF,KAAK0J,IAAI,EAAG5J,EAAQ,IAAI6J,QAAQ,IAG/C,SAASf,GAAcgB,GACtB,IAAI3D,EAAQ,MAIZ,OAHe,IAAX2D,IAAc3D,EAAQ,OACX,IAAX2D,IAAc3D,EAAQ,OACX,IAAX2D,IAAc3D,EAAQ,OACnBA,EAGR,SAAS8C,GAAYpN,GACpB,IAAIkO,EAAQ,MAAM1M,MAAM,IAMxB,OALAxB,EAAMuH,SAAQ,SAAAvH,GACbA,EAAMsK,MAAM9I,MAAM,IAAI+F,SAAQ,SAACvF,EAAG4K,GACvB,MAAN5K,IAAWkM,EAAMtB,GAAK,WAGrBsB,EAAMC,KAAK,IAGnB,SAASjB,GAAa5D,GACrB,IAAItJ,EAAQ,GAQZ,OAPAsJ,EAAOtJ,MAAMuH,SAAQ,SAAAnI,GAChBY,EAAMZ,EAAK+E,OACdnE,EAAMZ,EAAK+E,OAAO2C,KAAK1H,GAEvBY,EAAMZ,EAAK+E,OAAS,CAAC/E,MAGhBY,EAAMG,QAAO,SAAA6B,GAAC,OAAIqH,MAAMkC,QAAQvJ,MAGxC,SAASoM,GAAQC,GACb,OAAO,IAAIC,SAAQ,SAAAC,GACfC,IAAwBD,EAASF,MClhB1BI,uBAAK,YAAiB,IAAfC,EAAc,EAAdA,SAClB,OAAO,mCACFA,OAEP,SAACC,EAAKC,GACJ,OAAyB,OAAtBA,EAAKF,SAAS/I,KAAsC,OAAtBgJ,EAAKD,SAAS/I,IAAqBgJ,EAAKD,SAAS/I,MAAQiJ,EAAKF,SAAS/I,SAC/EqC,IAAlB2G,EAAKD,YCEVG,I,wDACF,WAAYpL,GAAQ,IAAD,uBACf,cAAMA,IAoEVqL,gBArEmB,uCAqED,WAAOzI,GAAP,iBAAA0I,EAAA,sDACV/O,EAAQ,GACZ,EAAKyE,aAAe,EAAKhB,MAAMuB,KAAKP,cAAgB,KAChDuK,EAAa,EAAKvK,aACtB4B,EAAKrG,MAAMuH,SAAQ,SAAAnI,GACf,IAAIwK,EAAM,CACNiB,KAAMxG,KAAKC,MAAMlF,EAAK,GAAK,EAAK0F,MAAMmK,aAAa/M,MAAQ8M,GAC3D7K,MAAO/E,EAAK,IAEhBY,EAAM8G,KAAK8C,MAEf,EAAKsF,SAAS,CACVjK,iBAAkBwE,EAAuB,QAAZ/K,EAAoB,GAAK,IACtDyQ,iBAAkB,CACdC,QAAS,EACTC,MAAO,EACPC,MAAO,EACPC,MAAO,KAGf,EAAKC,kBAAkB,EAAGxP,EAAM6G,QAChC,EAAK4I,qBAAuBzP,EArBd,2CArEC,wDA6FnB0P,KAAO,WACH,GAAK,EAAKjM,MAAMuB,KAAK2K,QAArB,CACA,MAA0E,EAAK7K,MAAvEG,EAAR,EAAQA,iBAAkB2K,EAA1B,EAA0BA,YAAaT,EAAvC,EAAuCA,iBAAmBF,EAA1D,EAA0DA,aACtDY,EAAa5K,EACbjF,EAAQ,EAAKyP,qBACjBzP,EAAMuH,SAAQ,SAAAnI,GACVA,EAAKyL,MAAQ,EAAKiF,YAItB,IAFA,IAAIC,GAAa,EACbC,EAAU,EACLpD,EAAI,EAAGA,EAAI5M,EAAM6G,QAClB7G,EAAM4M,GAAG/B,KAAO,EAAKpG,aADKmI,IAE1BiD,EAAW7P,EAAM4M,GAAGzI,OAAO2C,KAAK,CAC5BmJ,SAAS,EACTpF,KAAM,EAAKpG,aACXiB,GAAIrB,KAAKC,MAAsB,IAAhBD,KAAK6L,YAExBlQ,EAAM6M,OAAOD,EAAG,GAChBA,IACAmD,GAAa,EAKrBF,EAAWtI,SAAQ,SAAAnI,GACf,IAAK,IAAIwN,EAAI,EAAGA,EAAIxN,EAAKyH,OAAQ+F,IAAK,CAClC,IAAIuD,EAAS/Q,EAAKwN,GAClBuD,EAAOtF,MAAQ,EAAKiF,SAChBK,EAAOF,UACHE,EAAOtF,KAAO,EAAKpG,aAAe,GAClC0K,EAAiBC,UACjBD,EAAiBI,QACjBJ,EAAiBG,OAASH,EAAiBI,MAAQN,EAAa/M,QAEhEiN,EAAiBE,QACjBF,EAAiBI,MAAQ,GAE7BY,EAAOtF,MAAQ,GAEfsF,EAAOtF,KAAO,IACTsF,EAAOF,UACRd,EAAiBE,QACjBF,EAAiBI,MAAQ,GAE7BnQ,EAAKyN,OAAOD,EAAG,GACfA,IACAmD,GAAa,EACbC,SAIPD,IACL,EAAKP,kBAAkBI,EAAYQ,SAAWJ,GAC9C,EAAKd,SAAS,CACVjK,iBAAkB4K,EAClBV,iBAAkBA,OApJP,EAwJnBkB,SAxJmB,uCAwJR,WAAOhK,GAAP,2CAAA0I,EAAA,yDAAaxI,EAAb,+BAAqB,EAC5B,EAAK+J,cAAgBjK,EAAKkK,UAClBC,EAAa,EAAK1L,MAAlB0L,SAEa,KADjBxQ,EAAQ,EAAKyQ,iBAAiBpK,EAAKrG,QAC7B6G,OAJH,iDAKH6J,EAAW1Q,EAAM,GAAG,GACpB2Q,EAAY,EACZnE,GAAe,IAAI9F,MAAOC,UACrBiG,EAAIrG,EARN,aAQaqG,EAAI5M,EAAM6G,QARvB,oBASC+J,EAAQ5Q,EAAM4M,GAAG,GAAK8D,EAC1BA,EAAW1Q,EAAM4M,GAAG,GAChBxN,EAAOY,EAAM4M,GAAG,GACpBJ,GAAe,IAAI9F,MAAOC,YACtBiK,EAAQ,IAbT,kCAamBxC,GAAQwC,EAAQD,GAbnC,WAcC,EAAKL,gBAAkBjK,EAAKkK,UAd7B,mDAeHC,EAASpR,GAAMwF,OAAS,UACxB,EAAKa,YAAY+K,EAASpR,IAC1B,EAAK8P,SAAS,CACVsB,WACAZ,YAAa,CACTQ,SAAUxD,EAAE,EACZiE,KAAM7Q,EAAM6G,UAGpB8J,GAAY,IAAIjK,MAAOC,UAAY6F,EAAeoE,EAxB/C,QAQ+BhE,IAR/B,4DAxJQ,wDAoLnB6D,iBAAmB,SAACzQ,GAChB,OAAOA,EAAM+B,KAAI,SAAA3C,GAEb,OADAA,EAAK,GAAKA,EAAK,GAAK,EAAK0F,MAAMmK,aAAa/M,MACrC9C,MAvLI,EA0LnB0R,aAAe,SAACzK,GAAqB,IAAfE,EAAc,uDAAN,EAClBiK,EAAa,EAAK1L,MAAlB0L,SACJxQ,EAAQ,EAAKyQ,iBAAiBpK,EAAKrG,OACnC+Q,EAAa/Q,EAAM6G,OACvB7G,EAAM6M,OAAO,EAAGtG,GAGhB,IAFA,IAAIyK,EAAS,GACTC,EAAqB,EAChBrE,EAAI,EAAG5M,EAAM6G,OAAS,EAAG+F,IAAK,CAMnC,IALA,IAAIsE,EAAQ,CACRlR,MAAO,CAACA,EAAM0M,SACdkE,MAAO,GAEPO,EAAYD,EAAMlR,MAAM6G,OAAS,EAAIqK,EAAMlR,MAAM,GAAG,GAAK,EACpDoR,EAAI,EAAGA,EAAIpR,EAAM6G,QAAUuK,EAAI,GAAIA,IAAK,CAC7C,IAAI3D,EAAazN,EAAMoR,GAAG,GAAKF,EAAMlR,MAAM,GAAG,GAAK,GAC/CyN,EAAa,IACbyD,EAAMlR,MAAM8G,KAAK9G,EAAM0M,SACvB0E,KAGRF,EAAMN,MAAQK,EACdA,EAAqBjR,EAAM6G,OAAS,EAAI7G,EAAM,GAAG,GAAKmR,EAAY,EAClEH,EAAOlK,KAAKoK,GAEhB,GAAsB,IAAlBF,EAAOnK,OAAX,CACA,IAAIwK,EAAaL,EAAO,GACxB,EAAKM,eAAiB,EACtB,IAAIC,EAAcP,EAAO,GACzBK,EAAWrR,MAAMuH,SAAQ,SAAAnI,GACrBoR,EAASpR,EAAK,IAAIwF,OAAS,UAC3B4L,EAASpR,EAAK,IAAIwR,MAAoB,YAAZlS,EAAwB,IAAM,OAEjD,OAAX6S,QAAW,IAAXA,KAAavR,MAAMuH,SAAQ,SAAAnI,GACvB,IAAIoS,EAAehB,EAASpR,EAAK,IACjC,GAA4B,YAAxBoS,EAAa5M,OAAsB,OAAO4M,EAAa5M,OAAS,iBACpE4M,EAAa5M,OAAS,iBAE1B,EAAKnB,MAAMgO,UAAUC,YAAW,GAChC,EAAKxC,SAAS,CACVyC,eAAgBX,EAChBR,WACAZ,YAAa,CACTQ,SAAU7J,EACVsK,KAAME,OArOC,EAyOnBa,mBAAqB,SAAC1P,GAClB,IAAI+G,EAAUnH,EAAc+P,MAAK,SAAA7P,GAAC,OAAIA,EAAEC,OAASC,KACjD,EAAKgN,SAAS,CACVD,aAAchG,GAChB,EAAK6I,cA7OQ,EA+OnBA,YA/OmB,uCA+ON,WAAOC,GAAP,iBAAAhD,EAAA,6DACLiD,EAAgB5O,KAAKC,MAAMD,KAAKqH,UAAUtE,EAAUnB,OAChD4K,EAAgB,EAAK9K,MAArB8K,YAFC,SAGH,EAAKqC,WAHF,OAITC,YAAW,WACP,IAAI3L,EAAQJ,EAAUnB,KAAKuB,MACM,aAA7BJ,EAAUnB,KAAKsB,YACfC,EAAQqJ,EAAYQ,WAAaR,EAAYiB,KAAO,EAAIjB,EAAYQ,UAExEjK,EAAUnB,KAAV,2BACOgN,GADP,IAEIzL,MAAOoD,OAAOwI,UAAUJ,GAAYA,EAAWxL,MAEpD,KAbM,2CA/OM,wDA8PnB0L,SAAW,WACP,OAAO,IAAI3D,SAAQ,SAAA8D,GACf,EAAK9B,cAAgB,EACrB,IAAQE,EAAa,EAAK1L,MAAlB0L,SACRA,EAASjJ,SAAQ,SAAAnI,GACbA,EAAKwF,OAAS,GACdxF,EAAKwR,MAAoB,YAAZlS,EAAwB,IAAM,OAE/C,EAAK+Q,qBAAuB,GAC5B,EAAKP,SAAS,CACVsB,WACAmB,eAAgB,GAChB1M,iBAAkBwE,EAAuB,QAAZ/K,EAAoB,GAAK,KACvD0T,GAEH,EAAK3O,MAAMgO,UAAUC,YAAW,OA7QrB,EAiRnBW,kBAAoB,SAACtK,GACjB,EAAKyH,kBAAkB7F,OAAO5B,EAAMuK,OAAOpQ,SAlR5B,EAoRnBsN,kBApRmB,uCAoRC,WAAOY,GAAP,2BAAArB,EAAA,sDAAiB8B,EAAjB,+BAAwB,EAAK/L,MAAM8K,YAAYiB,KAC/D,EAAK3B,SAAS,CACVU,YAAa,CACTQ,WACAS,UAJQ,2CApRD,wDA4RnB0B,eA5RmB,uCA4RH,WAAOxK,GAAP,uBAAAgH,EAAA,yDACJyB,EAAa,EAAK1L,MAAlB0L,UACJzI,EAAMyK,OAFE,oDAG2B,UAAnC/J,SAASgK,cAAcC,QAHf,qDAIT3K,EAAM4K,SAJG,sBAKD5K,EAAM6K,KALL,OAMC,SAND,OAaC,SAbD,2BAOI,EAAKnP,MAAMuB,KAAK2K,QAPpB,uDAQG,CAAC,WAAW,UAAU,eAAenE,SAASrF,EAAUnB,KAAKsB,WARhE,0CASU,EAAKwL,YAAY,IAT3B,+CAcI,EAAKrO,MAAMuB,KAAK2K,QAdpB,oEAeM,EAAKsC,WAfX,iCAgBO9L,EAAUnB,KA8M1B,CACHqB,KAAM,GACNC,UAAW,OACXC,MAAO,IAjOK,oEAqBJqM,EArBI,UAqBG7K,EAAM6K,YArBT,aAqBG,EAAYC,QAAQ,MAAO,IAClC1O,EAAQ,EAAKV,MAAMuB,KAAKwL,SAASsC,gBAAgBF,IACjDxT,EAAOoR,EAASrM,KACV,EAAKsB,YAAYrG,GAxBnB,4CA5RG,wDAyTnB2T,oBAAsB,SAAC3T,GACnB,IACI4T,EADyB,EAAKlO,MAA1BG,iBAC+B7F,EAAK+E,OAAO,GACnD,OAAI6O,IACAA,EAAgB/C,SAAU,EACvB+C,EAAgBnI,KAAO,EAAKpG,aAAe,GAAU,mBAErD,kBAhUQ,EAkUnBwO,oBAAsB,SAAC7T,GACnB,MAAkD,EAAK0F,MAA/C0L,EAAR,EAAQA,SAAUmB,EAAlB,EAAkBA,eAAgB/B,EAAlC,EAAkCA,YAClC,GAAI+B,EAAe9K,OAAS,EAAG,CAAC,IAAD,EACvBqM,EAAY,UAAGvB,EAAe,UAAlB,aAAG,EAAmB3R,MAAM6L,WAAU,SAAA7J,GAAC,OAAIA,EAAE,KAAO5C,EAAK+E,SACzE,IAAsB,IAAlB+O,EAAqB,CAGrB,GAFAvB,EAAe,GAAG3R,MAAM6M,OAAOqG,EAAc,GACN,IAAnCvB,EAAe,GAAG3R,MAAM6G,QAAc8K,EAAejF,QACrDiF,EAAe9K,OAAS,EAAG,CAC3B,IAAIsM,EAAYxB,EAAe,GAC3ByB,EAAgBzB,EAAe,GACnCwB,EAAUnT,MAAMuH,SAAQ,SAAAnI,GACpBoR,EAASpR,EAAK,IAAIwF,OAAS,UAC3B4L,EAASpR,EAAK,IAAIwR,MAAQuC,EAAUvC,SAGrCwC,IACc,OAAbA,QAAa,IAAbA,KAAepT,MAAMuH,SAAQ,SAAAnI,GACzB,IAAIoS,EAAehB,EAASpR,EAAK,IACjC,GAA4B,YAAxBoS,EAAa5M,OAAsB,OAAO4M,EAAa5M,OAAS,iBACpE4M,EAAa5M,OAAS,kBAIlC,EAAKsK,SAAS,CACVyC,eAAgBA,EAChB/B,YAAa,CACTiB,KAAMjB,EAAYiB,KAClBT,SAAUR,EAAYQ,SAAW,QA7VlC,EAmWnB3K,YAAc,SAACrG,EAAMiU,GACjB,MAAuC,EAAKvO,MAApC0L,EAAR,EAAQA,SAAUtL,EAAlB,EAAkBA,kBACZoO,EAAe,EAAK7P,MAAMuB,KAAKsO,aACrC9C,EAASpR,EAAK+E,OAAOS,OAAS,UAC9B4L,EAASpR,EAAK+E,OAAOyM,MAAoB,YAAZlS,EAAwB,IAAM,IAC3D,EAAKuU,oBAAoB7T,GACzB,IAAImU,EAAiB,EAAKR,oBAAoB3T,GAI9C,GAHgC,gBAA7B+G,EAAUnB,KAAKsB,YACdkK,EAASpR,EAAK+E,OAAOS,OAAS2O,GAE/BD,GAA4C,gBAA5BnN,EAAUnB,KAAKsB,UAA2B,CACzD,IAAIX,EAAMtB,KAAKC,MAAsB,IAAhBD,KAAK6L,WAAoB,IAAIxJ,MAAOC,UACzDzB,EAAkB9F,EAAK+E,OAAO2C,KAAK,CAACnB,QAExC,EAAKuJ,SAAL,aAAgBsB,YACR8C,EAAcpO,EAAoB,KACxC,WACEgN,YAAW,WACP,GAAIoB,GAA6C,gBAA7BnN,EAAUnB,KAAKsB,UAAnC,CACA,IAAOpB,EAAqB,EAAKJ,MAA1BI,kBACPA,EAAkB9F,EAAK+E,OAAOuI,QAC9B,EAAKwC,SAAS,CAAChK,yBACjB,QAENgN,YAAW,WACF,CAAC,UAAU,iBAAiB,oBAAoB1G,SAASgF,EAASpR,EAAK+E,OAAOS,UACnF4L,EAASpR,EAAK+E,OAAOS,OAAS,GAC9B,EAAKsK,SAAS,CAAEsB,gBACN,QAAZ9R,EAAoB,IAAM,KAC5B,EAAK+E,MAAMgO,UAAU+B,UAAUpU,IA9X/B,IAAIqU,EAAe,EAAKhQ,MAAMuB,KAAKwL,SAFpB,OAGfiD,EAAaC,OAAOnM,SAAQ,SAAAnI,GAAUA,EAAKwF,OAAS,MACpD,EAAKE,MAAQ,CACT6O,eAAe,IAAIjN,MAAOC,UAC1BgL,eAAgB,GAChB1M,iBAAkBwE,EAAuB,QAAZ/K,EAAoB,GAAK,IACtDwG,kBAAmBuE,EAAuB,QAAZ/K,EAAoB,GAAK,IACvD8R,SAAUiD,EAAaC,OACvB9D,YAAa,CACTQ,SAAU,EACVS,KAAM,GAEV1B,iBAAkB,CACdC,QAAS,EACTC,MAAO,EACPC,MAAO,EACPC,MAAO,GAEpBN,aAAcnN,EAAc+P,MAAK,SAAA7P,GAAC,MAAe,OAAXA,EAAEC,SAEnC,EAAKwC,aAAe,KACpB,EAAKgL,qBAAuB,GAC5B,EAAKa,cAAgB,EACrB,EAAKgB,eAAiB,EACtB,EAAKsC,aAAe,aACpB,EAAK9D,SAAW,GAChB,EAAK+D,aAAe,EA5BL,E,qDA+BnB,WAAqB,IAAD,OAChBpU,OAAOqU,iBAAiB,UAAW/O,KAAKwN,gBACxCxN,KAAK8O,aAAeE,YAAYhP,KAAK2K,KAAM3K,KAAK+K,UAChD/K,KAAK6O,aAAeI,YAAQ7N,EAAD,uCAAY,WAAOnB,GAAP,uBAAA+J,EAAA,yDAC/B7M,EAAQ8C,EAAKiP,OAAOjP,KACpB9B,EAAOhB,EAAMoE,UACb0L,EAAgB5O,KAAKC,MAAMD,KAAKqH,UAAUvI,EAAMmE,QACpD,UAAI2L,EAAchN,YAAlB,aAAI,EAAoBoC,qBACpB4K,EAAgBhI,EAAoBgI,IAExCA,EAAczB,WAAY,IAAI7J,MAAOC,UACjCgJ,GAAU,EACD,SAATzM,EAT+B,iCAUzB,EAAK+O,WAVoB,OAW/B,EAAK5B,SAAS2B,EAAe9P,EAAMqE,OACnCoJ,GAAU,EAZqB,WActB,aAATzM,EAd+B,kCAezB,EAAK+O,WAfoB,QAgB/B,EAAKnB,aAAakB,EAAe9P,EAAMqE,OACvCoJ,GAAU,EAjBqB,WAmBtB,gBAATzM,EAnB+B,kCAoBzB,EAAK+O,WApBoB,QAqB/B,EAAKnD,gBAAgBkD,EAAe9P,EAAMqE,OAC1CoJ,GAAU,EAtBqB,WAwBtB,SAATzM,EAxB+B,kCAwBR,EAAK+O,WAxBG,QAyBnC,EAAKxO,MAAMgO,UAAUC,WAAW/B,GAzBG,4CAAZ,yD,kCA4B/B,WACIlQ,OAAOyU,oBAAoB,UAAWnP,KAAKwN,gBAC3CxN,KAAK6O,eACL7O,KAAKuL,cAAgB,EACrB6D,cAAcpP,KAAK8O,gB,oBAgUvB,WAAU,IAAD,OACG/O,EAAiBC,KAAjBD,MACAE,EADiBD,KAAVtB,MACPuB,KACAwL,EAA+B1L,EAA/B0L,SAAUrB,EAAqBrK,EAArBqK,iBACd0B,EAAO7L,EAAKoP,aAAe,IAC3BvD,EAAO,KAAKA,EAAO,IACnBA,EAAO,MAAKA,EAAO,KACvB,IAAIwD,EAAgB,WAGpB,OAFwB,KAApB7D,EAAS3J,SAAewN,GAAiB,eACrB,IAApB7D,EAAS3J,SAAcwN,GAAiB,eACrC,qCACFrP,EAAK2K,SACF,sBAAKhM,UAAU,cAAf,UACkC,gBAA7BwC,EAAUnB,KAAKsB,WACZ,cAACgO,GAAD,CAAOtP,KAAMmK,IAGjB,sBAAKxL,UAAU,iBAAf,UACI,wBAAQA,UAAU,cAAc4Q,QAAS,WACrC,EAAKtC,WACL9L,EAAUnB,KAoG3B,CACHqB,KAAM,GACNC,UAAW,OACXC,MAAO,IAzGS,SAKI,cAACiO,GAAD,UACI,cAAC,IAAD,QAGR,uBACItR,KAAK,QACLS,UAAU,SACV8Q,IAAK,EACLC,SAAU3P,KAAKsN,kBACfsC,IAAK7P,EAAM8K,YAAYiB,KACvB3O,MAAO4C,EAAM8K,YAAYQ,WAE7B,wBAAQzM,UAAU,cAAc4Q,QAAS,WACrC,EAAKzC,eADT,SAGI,cAAC0C,GAAD,UACI,cAAC,IAAD,QAGR,yBACI7Q,UAAU,gBACV+Q,SAAU,SAAC1S,GAAD,OAAO,EAAK4P,mBAAmB5P,EAAEsQ,OAAOpQ,QAClDA,MAAO4C,EAAMmK,aAAahN,KAH9B,UAKI,wBAAQ2S,UAAQ,EAAhB,mBACC9S,EAAcC,KAAI,SAAAC,GACf,OAAO,wBAAQE,MAAOF,EAAEC,KAAjB,SACFD,EAAEC,MAD4BD,EAAEC,kBAQzD,qBACI0B,UAAW0Q,EACXrQ,MAAO,CACH6Q,UAAU,SAAD,OAAWhE,EAAX,KACTiE,aAAqB,GAAPjE,EAAY,IAJlC,SAOK7L,EAAK+P,UACA,qBAAKpR,UAAU,UAAf,wBAEA6M,EAASzO,KAAI,SAAA3C,GACX,IAAI4G,EAAYzD,EAAaiO,EAAS3J,QAAQzH,EAAK+E,OAC/C1B,EAAQ,2BACLrD,GADK,IAERqF,aAAa,EAAKA,aAClBW,WAAY,EAAK3B,MAAMuB,KAAKwL,SAASwE,eACrCC,WAAyC,gBAA7B9O,EAAUnB,KAAKsB,WAAsC,EAAK7C,MAAMuB,KAAKsO,eAErF,OAAO,cAAC,EAAD,CAEHtO,KAAMvC,EACNwC,iBAAkBH,EAAMG,iBAAiB7F,EAAK+E,OAC9Ce,kBAAmBJ,EAAMI,kBAAkB9F,EAAK+E,OAChDgB,SAAU/F,EAAKwR,MACfnL,YAAa,EAAKA,YAClBQ,SAAUiP,GAAYlQ,EAAKmQ,aAAc/V,EAAK+E,MAAOa,EAAKkC,MAAOsJ,EAAS3J,QAC1Eb,UAAS,8BAAyBA,EAAzB,SAPJ5G,EAAK+E,mB,GA/cf+B,cAkevB,SAASoO,GAAM7Q,GACX,MAAwCA,EAAMuB,KAAtCuK,EAAR,EAAQA,MAAOD,EAAf,EAAeA,MAAOF,EAAtB,EAAsBA,QAASC,EAA/B,EAA+BA,MAC/B,OAAO,qBAAK1L,UAAU,uBAAf,SACH,gCACI,kCACI,+BACI,oBAAIA,UAAU,OAAd,sBACA,qBAAIA,UAAU,OAAd,WAAuByL,GAAWA,EAAUC,EAAQ,GAAK,KAAMrB,QAAQ,GAAvE,UAEJ,+BACI,oBAAIrK,UAAU,OAAd,mBACA,oBAAIA,UAAU,OAAd,SAAsB2L,OAE1B,+BACI,oBAAI3L,UAAU,OAAd,mBACA,oBAAIA,UAAU,OAAd,SAAsB4L,cAiB1C,SAAS2F,GAAYC,EAAchR,EAAO+C,EAAOkO,GAC7C,IACI,GAAqB,cAAjBD,EAA8B,OAAOxT,EAASjD,GAASyD,EAAS+I,QAAQhE,IAAQ/C,GACpF,GAAqB,oBAAjBgR,EAAoC,OAAO7T,EAAW8T,GAAc7T,eAAe4C,GACvF,GAAqB,aAAjBgR,EAA6B,OAAO7T,EAAW8T,GAAc3T,aAAa0C,GAChF,MAAOnC,IACT,MAAO,GAEI6M,U,6CCphBA,OAA0B,qCCA1B,OAA0B,qCCA1B,OAA0B,kC,2BCOlC,SAASwG,KACZ,OAAO,qCACH,qBAAK1R,UAAU,aAAf,uBAGA,gCACI,qBAAKoC,IAAKuP,GAAa3R,UAAU,WAAWmC,IAAI,+BAChD,+BACI,sEACA,oFACA,gDACA,2DACA,8FAIHyP,QAAc,qCACX,qBAAK5R,UAAU,aAAf,iCAGA,sBAAKA,UAAU,mBAAf,UACI,qBAAKK,MAAO,CAAE8Q,aAAc,UAA5B,uDAGA,uBAAOnR,UAAU,aAAjB,SACI,kCACI,+BACI,6BAAI,cAAC6R,GAAD,0BAAyB,iDAEjC,+BACI,6BAAI,cAACA,GAAD,0BAAyB,yFAEjC,+BACI,6BAAI,cAACA,GAAD,0BAAyB,wDAEjC,+BACI,6BAAI,cAACA,GAAD,oBAAmB,qDAE3B,+BACI,6BAAI,cAACA,GAAD,0BAAyB,0DASrD,qBAAK7R,UAAU,aAAf,wBAGA,gCACI,qBAAKoC,IAAK0P,GAAU9R,UAAU,WAAWmC,IAAI,4BAC7C,+BACI,gEACA,uDACA,4DACA,mDACA,wEACA,gEAEJ,sBAAKnC,UAAU,SAAf,UACI,gCACI,cAAC,IAAD,IADJ,0BAGA,gCACI,cAAC,KAAD,IADJ,iCAGA,gCACI,cAAC,IAAD,IADJ,gCAOR,qBAAKA,UAAU,aAAf,sBAGA,gCACI,qBAAKoC,IAAK2P,GAAa/R,UAAU,WAAWmC,IAAI,0BAChD,+BACI,sEACA,6DACA,gDACA,2DACA,oEACA,kEACA,2DACA,iEAKHyP,QAAc,qCACX,qBAAK5R,UAAU,aAAf,gCAGA,sBAAKA,UAAU,mBAAf,UAEI,qBAAKK,MAAO,CAAE8Q,aAAc,UAA5B,sDAGA,gCACI,kCACI,+BACI,6BAAI,cAACU,GAAD,sBAAqB,sDAE7B,+BACI,6BAAI,cAACA,GAAD,8BAA6B,iDAErC,+BACI,6BAAI,cAACA,GAAD,0BAAyB,sDAEjC,+BACI,6BAAI,cAACA,GAAD,2BAA0B,8DAElC,+BACI,6BAAI,cAACA,GAAD,4BAA2B,0DAEnC,+BACI,6BAAI,cAACA,GAAD,yBAAwB,0DAEhC,+BACI,6BAAI,cAACA,GAAD,2BAA0B,uDAElC,+BACI,6BAAI,cAACA,GAAD,6BAA4B,sEAEpC,+BACI,6BAAI,cAACA,GAAD,kBAAiB,0DAEzB,+BACI,6BAAI,cAACA,GAAD,kBAAiB,qDAnCrC,qEAwCI,qBAAKxR,MAAO,CAAE8Q,aAAc,mBAWhD,SAASU,GAAI/R,GACT,OAAO,qBAAKE,UAAU,eAAf,SACFF,EAAMiL,WC5JAD,uBAAK,SAAkBhL,GAClC,IAAQE,EAAsCF,EAAtCE,UAAWgS,EAA2BlS,EAA3BkS,OAAQjH,EAAmBjL,EAAnBiL,SAAUxL,EAASO,EAATP,KACrC,OAAO,qBACHS,UAAWA,EAAS,oBAAgBA,GAAc,YAClD4Q,QAAS,yBAAMoB,QAAN,IAAMA,OAAN,EAAMA,EAASzS,IAFrB,SAIFwL,OAEP,SAACC,EAAKC,GACJ,OAAyB,OAAtBA,EAAKF,SAAS/I,KAAsC,OAAtBgJ,EAAKD,SAAS/I,IAAqBgJ,EAAKD,SAAS/I,MAAQiJ,EAAKF,SAAS/I,SAC/EqC,IAAlB2G,EAAKD,UAA0BC,EAAKhL,YAAciL,EAAKjL,aCXnD,SAASiS,GAAUnS,GAC9B,IAAIE,EAAYF,EAAMoS,UAAYpS,EAAMiE,MAAQ,gCAAkC,aAClF,OAAO,sBAAK/D,UAAWA,EAAhB,UACH,qBAAKA,UAAU,aAAf,SACKF,EAAMiE,QAEX,qBAAK/D,UAAU,wBAAf,SACKF,EAAMiL,cCNJ,SAASoH,GAAUrS,GAC9B,OAAO,qBAAK8Q,QAAS,kBAAM9Q,EAAMkS,QAAO,IAAQhS,UAAU,uBAAnD,SACH,cAAC,IAAD,CAASA,UAAU,W,OCDZ,SAASoS,GAAT,GAAqC,IAApBC,EAAmB,EAAnBA,QAAStB,EAAU,EAAVA,SACrC,OAAO,qBAAK/Q,UAAU,iBAAiB4Q,QAAS,kBAAMG,GAAUsB,IAAzD,SACH,qBAAKrS,UAAS,uBAAkBqS,EAAU,kBAAoB,QCFvDvH,uBAAK,YAA8D,IAAvCzJ,EAAsC,EAAtCA,KAAMiR,EAAgC,EAAhCA,OAAQC,EAAwB,EAAxBA,OAAQC,EAAgB,EAAhBA,aAC7D,EAA4BC,mBAASpR,EAAK9C,OAA1C,oBAAOmU,EAAP,KAAkBC,EAAlB,KACA,EAAmCF,mBAASpR,EAAKuR,QAAjD,oBAAOC,EAAP,KAAmBC,EAAnB,KAgCA,SAASC,EAAiB1U,GACtB,IAAIE,EAAQF,EAAEsQ,OAAOpQ,MACjB0H,EAAM,CACNjE,IAAKuQ,EACLlR,KAAK,2BAAKA,GAAN,IAAY9C,WAEpB+T,EAAOrM,GAcX,OAnDA+M,qBAAU,WACNL,EAAOtR,EAAK9C,SACd,CAAC8C,EAAK9C,QAiDO,kBAAXgU,EAAmC,KAChC,sBAAKvS,UAAU,eAAf,UACH,8BACKqB,EAAK/C,OAGK,WAAd+C,EAAK9B,MACC,wBAAQhB,MAAO8C,EAAK9C,MACnBwS,SAAUgC,EADX,SAGE1R,EAAK4R,QAAQ7U,KAAI,SAAAC,GACd,OAAO,wBAAQE,MAAOF,EAAf,SAA2BA,GAAJA,QAKzC,CAAC,SAAU,QAAQwJ,SAASxG,EAAK9B,OAC9B,uBACIA,KAAM8B,EAAK9B,KACXhB,MAAOmU,EACPQ,YAAa7R,EAAK6R,aAAe,GACjCC,OAjDZ,WACI,GAAI9R,EAAK9C,QAAUmU,EAAnB,CACA,IAAIzM,EAAM,CACNjE,IAAKuQ,EACLlR,KAAK,2BAAKA,GAAN,IAAY9C,MAAOmU,KAE3BJ,EAAOrM,KA4CC8K,SArEZ,SAAsB1S,GAClB,IAAMwG,EAAKxG,EAAEsQ,OACTpQ,EAAQsG,EAAGtG,MACG,WAAd8C,EAAK9B,OACLhB,EAAQyH,OAAOzH,GACfsG,EAAGtG,MAAQ,GACPA,EAAQ8C,EAAK6I,UAAU,IAAM3L,EAAQ8C,EAAK6I,UAAU,KAE5DyI,EAAOpU,MAiEQ,aAAd8C,EAAK9B,MACF,cAAC6S,GAAD,CACIC,QAASK,EACT3B,SAjEZ,SAAwBxS,GACpB+T,EAAO,CACHtQ,IAAKuQ,EACLlR,KAAK,2BAAKA,GAAN,IAAY9C,YAEpBoU,EAAOpU,MAgEQ,eAAd8C,EAAK9B,MACF,sBAAKS,UAAU,oBAAf,UACI,wBAAQzB,MAAO8C,EAAK9C,MAChBwS,SAAUgC,EADd,SAGK1R,EAAK4R,QAAQ7U,KAAI,SAAAC,GACd,OAAO,wBAAQE,MAAOF,EAAf,SAA2BA,GAAJA,QAGtC,uBACIkB,KAAK,QACLuR,IAAK,EACLE,IAAK,IACLzS,MAAOsU,EACP9B,SA1DhB,SAAsB1S,GAClByU,EAAa9M,OAAO3H,EAAEsQ,OAAOpQ,SA0DjB6U,YAvDhB,WACIZ,EAAa,CACTxQ,IAAKuQ,EACLhU,MAAOsU,gBAyDjB,SAACQ,EAAElL,GACD,OAAOkL,EAAEhS,KAAK9C,QAAU4J,EAAE9G,KAAK9C,OACxB8U,EAAEhS,KAAKuR,SAAWzK,EAAE9G,KAAKuR,QACzBS,EAAEf,SAAWnK,EAAEmK,UChHX,SAASgB,GAAaxT,GACjC,OAAO,qBAAKE,UAAU,gBAAgB4Q,QAAS,kBAAM9Q,EAAM8Q,QAAQ,WAA5D,oBCGI,SAAS2C,GAAazT,GACjC,IAAQgO,EAA+BhO,EAA/BgO,UAAWzM,EAAoBvB,EAApBuB,KAAMmB,EAAc1C,EAAd0C,UACjBgR,EAAe1F,EAAf0F,WACR,EAAgCf,oBAAS,GAAzC,oBAAOgB,EAAP,KAAiBC,EAAjB,KACA,EAA0BjB,wBAASpO,GAAnC,oBAAOsP,EAAP,KAAcC,EAAd,KACMnP,EAAQ,uCAAG,4BAAA2G,EAAA,0DACTqI,EADS,8DAGLE,EAHK,yCAGSH,EAAWG,IAHpB,cAITD,GAAY,GAJH,SAKQG,MAAM,iDAAmDC,UAAUzS,EAAKqD,OAAOqP,MAAK,SAAA1S,GAAI,OAAIA,EAAK2S,UALzG,OAKLtR,EALK,OAMTgR,GAAY,GACZhR,EAAOiF,GAAkBjF,GACzBkR,EAASlR,GACT8Q,EAAW9Q,GATF,kDAWTgR,GAAY,GACZxY,QAAQ+Y,MAAR,MACA,IAAInQ,EAAY,QAAS,0BAA0BI,UAb1C,0DAAH,qDAgBRgQ,EAAI,uCAAG,4BAAA9I,EAAA,0DACLqI,EADK,8DAGDE,EAHC,yCAIMnR,EAAUnB,KAAO,CACpBsB,UAAW,OACXD,KAAMiR,EACN/Q,MAAO,IAPV,cAUL8Q,GAAY,GAVP,SAWYG,MAAM,iDAAmDC,UAAUzS,EAAKqD,OAAOqP,MAAK,SAAA1S,GAAI,OAAIA,EAAK2S,UAX7G,OAWDtR,EAXC,OAYLgR,GAAY,GACZhR,EAAOiF,GAAkBjF,GACzBkR,EAASlR,GACTF,EAAUnB,KAAO,CACbsB,UAAW,OACXD,KAAMA,EACNE,MAAO,GAlBN,kDAqBL1H,QAAQ+Y,MAAR,MACAP,GAAY,GACZ,IAAI5P,EAAY,QAAS,0BAA0BI,UAvB9C,0DAAH,qDA0BV,OAAO,sBAAKlE,UAAU,WAAf,UACH,qBAAKA,UAAU,YAAY4Q,QAAS,WAChCsD,EAAK7S,IADT,SAGKA,EAAK/C,OAEV,qBAAK0B,UAAU,uBAAf,SACI,wBAAQA,UAAU,cAAc4Q,QAASnM,EAAzC,SACKgP,EAAW,cAAC,IAAD,IAAgB,cAAC,IAAD,W,WC1CtCU,G,kDACF,WAAYrU,GAAQ,IAAD,8BACf,cAAMA,IAkBV8O,eAAiB,SAACxK,GAAW,IAAD,EACpBpC,EAAMoC,EAAM6K,KAChB,GAAuC,UAAnCnK,SAASgK,cAAcC,QAE3B,GADA,UAAAjK,SAASgK,qBAAT,SAAwBsF,OACpBhQ,EAAM4K,UACN,GACS,SADDhN,EAEA,EAAKuJ,SAAS,CAAE8I,MAAO,EAAKlT,MAAMkT,YAM1C,GACS,WADDrS,EAEA,EAAKuJ,SAAS,CAAE8I,MAAM,KAlCnB,EA0CnBC,uBA1CmB,sBA0CM,4BAAAlJ,EAAA,0DACjBmJ,UAAUC,UAAWD,UAAUC,QAAQC,QADtB,gCAEOF,UAAUC,QAAQE,YAFzB,UAEbC,EAFa,uCAGqBJ,UAAUC,QAAQC,UAHvC,OAGCE,EAHD,cAIjB,EAAKpJ,SAAS,CAAEqJ,oBAAqBD,IAJpB,2CA1CN,EAiDnBE,kBAAoB,SAAC7Q,GACjB,EAAKuH,SAAS,CACVuJ,YAAa9Q,KAnDF,EAsDnB+Q,YAAc,WACV,EAAKxJ,SAAS,CACVuJ,YAAa,GACbE,cAAe,GACfC,aAAc,oCA1DH,EA6DnBC,YA7DmB,sBA6DL,gCAAA9J,EAAA,2DAC4B,EAAKjK,MAAnC2T,EADE,EACFA,YACa,iBAFX,EACWG,aADX,oDAGwB,IAA9BH,EAAYzZ,OAAO6H,OAHb,yCAIC,EAAKqI,SAAS,CACjB0J,aAAc,mCALZ,cAQV,EAAK1J,SAAS,CACV0J,aAAc,iBATR,SAWepB,MAAM,oDAAsDC,UAAUgB,IAAcf,MAAK,SAAA1S,GAAI,OAAIA,EAAK2S,UAXrH,YAWNmB,EAXM,QAYOlB,MAZP,wBAaN,EAAK1I,SAAS,CACV0J,aAAc,kCAdZ,kBAgBC,IAAInR,EAAY,QAASqR,EAAalB,OAAO/P,WAhB9C,QAkBV,EAAKqH,SAAS,CACVyJ,cAAeG,EACfF,aAAc,YApBR,4CA7DK,EAoFnBG,WAAa,SAAChH,GACc,mBAAbA,IAAwBA,OAAW/J,GAC9C,IAAIgR,OAAwBhR,IAAb+J,EAAyBA,GAAY,EAAKjN,MAAMkT,KAC/D,EAAK9I,SAAS,CACV8I,KAAMgB,KAxFK,EA2FnBC,eAAiB,SAACC,GACd,GAAIA,IAAc,EAAKpU,MAAMqU,cAAgB,EAAKrU,MAAMkT,KACpD,OAAO,EAAK9I,SAAS,CACjB8I,MAAM,IAGd,EAAKU,cACL,EAAKxJ,SAAS,CACViK,aAAcD,EACdlB,MAAM,KApGK,EAuGnBoB,uBAAyB,SAACnX,GACtB,EAAKiN,SAAS,CACVmK,iBAAkBpX,KAzGP,EA4GnBkV,WAAa,SAAC9O,GACV,IAAMiR,EAAS,IAAIC,WACnBD,EAAOxF,iBAAiB,OAAxB,uCAAgC,WAAO/L,GAAP,yBAAAgH,EAAA,+DAEpByK,EAAapW,KAAKC,MAAM0E,EAAMuK,OAAO3G,QACpCtC,MAAMkC,QAAQiO,KAAaA,EAAa,CAACA,IAHtB,eAIPA,GAJO,gEAKpBnT,EAAOiF,GADFjF,EAJe,mBAMd,EAAK5C,MAAMgO,UAAUgI,QAAQpT,GANf,oMASpBqT,EAAWrR,EAAKpG,KACpBpD,QAAQ+Y,MAAR,QAVwB,OAWpB8B,QAXoB,IAWpBA,GAXoB,UAWpBA,EAAUlO,gBAXU,aAWpB,OAAAkO,EAAqB,SAXD,0CAYb,IAAIjS,EAAY,QAAS,iDAAiDI,WAZ7D,QAcxB,IAAIJ,EAAY,QAAS,wCAAwCI,UAdzC,uEAAhC,uDAkBAyR,EAAOK,WAAWtR,IAhIH,EAkInBuR,aAAe,SAACvT,GACRA,EAAKwT,YAAYxT,EAAKwT,IAC1B,IAAIC,EAAWzT,EAAKpE,KACJ,QAAZvD,IAEA2H,EAAOkE,GAAoBlE,IAE1BgD,MAAMkC,QAAQlF,KAAOA,EAAO,CAACA,IAClCA,EAAKkB,SAAQ,SAAAwS,GACTA,EAAM/U,KAAKtG,QAAUA,KAEzB,IAAIiZ,EAAOvU,KAAKqH,UAAUpE,IACL,IAAI8B,GACVC,SAASuP,EAAxB,UAAiCmC,EAAjC,YAA6Cpb,EAAQsb,cAArD,eACA,IAAIvS,EAAY,UAAW,mBAAmBI,WAhJ/B,EAmJnBoS,iBAAmB,WACf,IAAIC,EAAa,GACjB,EAAKzW,MAAMuB,KAAKmV,MAAM5S,SAAQ,SAAAlB,GACtBA,EAAKwT,YAAYxT,EAAKwT,IACV,QAAZnb,IACA2H,EAAOkE,GAAoBlE,IAE/BgD,MAAMkC,QAAQlF,GAAQ6T,EAAWpT,KAAX,MAAAoT,EAAU,YAAS7T,IAAQ6T,EAAWpT,KAAKT,MAErE,IAAI+T,EAAiB,IAAIjS,EACrBwP,EAAOvU,KAAKqH,UAAUyP,GACtBG,GAAO,IAAI3T,MAAO4T,cAAc9Y,MAAM,KAAK,GAC/C4Y,EAAehS,SAASuP,EAAxB,UAAiCjZ,EAAjC,mBAAmD2b,EAAnD,UACA,IAAI5S,EAAY,UAAW,0BAA0BI,WA9JrD,EAAK/C,MAAQ,CACTkT,MAAM,EACNmB,aAAc,QACdE,iBAAkB,WAClBZ,YAAa,GACbE,cAAe,GACfC,aAAc,iCACdL,qBAAqB,GATV,E,qDAYnB,WACIxT,KAAKkT,yBACLxY,OAAOqU,iBAAiB,UAAW/O,KAAKwN,kB,kCAE5C,WACI9S,OAAOyU,oBAAoB,UAAWnP,KAAKwN,kB,oBAkJ/C,WAAU,IAAD,OACDgI,EAAYxV,KAAKD,MAAMkT,KAAO,sBAAwB,YAC1D,EAA4BjT,KAAKtB,MAAzBuB,EAAR,EAAQA,KAAMyM,EAAd,EAAcA,UACN+I,EAAwB/I,EAAxB+I,oBACR/I,EAAUsH,WAAahU,KAAKgU,WAC5BtH,EAAUmI,aAAe7U,KAAK6U,aAC9B,IAAIa,EAAa1V,KAAKtB,MAAMgO,UAAUgJ,WAClCN,EAAQnV,EAAKmV,MAAMha,QAAO,SAAAkG,GAAI,OAAKA,EAAKrB,KAAKoC,qBAC7CsT,EAAgB1V,EAAKmV,MAAMha,QAAO,SAAAkG,GAAI,OAAIA,EAAKrB,KAAKoC,qBACxD,EAAsDrC,KAAKD,MAAnD8T,EAAR,EAAQA,aAAcD,EAAtB,EAAsBA,cAAeQ,EAArC,EAAqCA,aACjCwB,EAAwB,CACxBxD,WAAY1F,EAAUgI,SAE1B,OAAO,sBAAK9V,UAAU,eAAf,UACH,sBAAKA,UAAU,mCAAf,UACKoB,KAAKD,MAAMkT,MAAQ,cAAClC,GAAD,CAAWH,OAAQ5Q,KAAKgU,aAC5C,cAAC,GAAD,CAAU7V,KAAK,OAAOyS,OAAQ5Q,KAAKkU,eAAgBtV,UAAU,kBAA7D,SACI,cAAC,IAAD,CAAQA,UAAU,WAEtB,cAAC,GAAD,CAAUT,KAAK,UAAUyS,OAAQ5Q,KAAKkU,eAAtC,SACI,cAAC,KAAD,CAAgBtV,UAAU,WAE9B,cAAC,GAAD,CAAUT,KAAK,QAAQyS,OAAQ5Q,KAAKkU,eAApC,SACI,cAAC,IAAD,CAAStV,UAAU,WAEvB,cAAC,GAAD,CAAUT,KAAK,WAAWyS,OAAQ5Q,KAAKkU,eAAvC,SACI,cAAC,IAAD,CAAOtV,UAAU,WAErB,cAAC,GAAD,CAAUT,KAAK,OAAOyS,OAAQ,kBAAM8E,EAAW,SAA/C,SACI,cAAC,IAAD,CAAQ9W,UAAU,cAG1B,sBAAKA,UAAW4W,EAAhB,UACI,cAAC3E,GAAD,CAAWlO,MAAM,eAAemO,QAASsD,IAEzC,eAACvD,GAAD,CAAWlO,MAAM,QAAQmO,QAASsD,EAAlC,UACI,sBAAKxV,UAAU,wBAAf,UACI,wBAAQA,UAAU,iBACd4Q,QAAS,kBAAMkG,EAAW,aAD9B,0BAKA,cAAC,cAAD,CACI/F,SAAU,SAACrM,GAAD,OAAU,EAAK8O,WAAW9O,IADxC,SAGI,wBAAQ1E,UAAU,iBAAlB,8BAMR,sBAAKA,UAAU,uBAAf,UACI,wBACIA,UAA2C,aAAhCoB,KAAKD,MAAMuU,iBAAkC,4BAA8B,eACtF9E,QAAS,kBAAM,EAAK6E,uBAAuB,aAF/C,sBAMA,wBACIzV,UAA2C,aAAhCoB,KAAKD,MAAMuU,iBAAkC,4BAA8B,eACtF9E,QAAS,kBAAM,EAAK6E,uBAAuB,aAF/C,yBAOJ,qBAAKzV,UAAU,gBAAf,SACqC,aAAhCoB,KAAKD,MAAMuU,iBACNc,EAAMpY,KAAI,SAAAsE,GACR,OAAO,cAACuU,GAAD,CACH5V,KAAMqB,EAENoL,UAAWA,GADNpL,EAAKpE,SAKhByY,EAAc3Y,KAAI,SAAAsE,GAChB,OAAO,cAACuU,GAAD,CACH5V,KAAMqB,EAENoL,UAAWA,GADNpL,EAAKpE,WAO1B,qBAAK+B,MAAO,CAAE6W,UAAW,OAAQC,WAAY,SAAUlX,MAAO,OAAQmX,QAAS,OAAQC,eAAgB,YAAvG,SACI,wBACIrX,UAAU,iBACVK,MAAO,CAAEiX,WAAY,QACrB1G,QAASxP,KAAKkV,iBAHlB,8CAUR,eAACrE,GAAD,CAAWlO,MAAM,WAAWmO,QAASsD,EAArC,UACK9R,OAAOC,QAAQtC,EAAKkW,UAAUnZ,KAAI,YAAkB,IAAD,oBAAf4D,EAAe,KAAVX,EAAU,KAChD,OAAO,cAAC,GAAD,CAEHkR,OAAQvQ,EACRX,KAAMA,EACNmR,aAAc1E,EAAU0E,aACxBF,OAAQuE,GAJH7U,MAOb,qBAAK3B,MAAO,CAAE6W,UAAW,SAAU/F,aAAc,UAAjD,SACK/P,KAAKD,MAAMyT,oBAAsB,uBAAyB,8BAE7DpV,KAAW,cAAC8T,GAAD,CAAc1C,QAASkG,OAIxC,eAAC7E,GAAD,CAAWlO,MAAM,UAAUmO,QAASsD,EAApC,UACI,gHAGA,sBAAKxV,UAAU,qBAAf,UACI,uBACIA,UAAU,uBACVkT,YAAY,YACZsE,UAAW,SAACnZ,GACO,UAAXA,EAAE4Q,MAAkB,EAAKiG,eAEjCuC,QAAS,SAACpZ,GAAD,OAAO,EAAKwW,kBAAkBxW,EAAEsQ,OAAOpQ,QAChDA,MAAO6C,KAAKD,MAAM2T,cAEtB,wBAAQ9U,UAAU,qBAAqB4Q,QAASxP,KAAK2T,YAArD,SACI,cAAC,IAAD,MAEJ,wBAAQ/U,UAAU,qBAAqB4Q,QAASxP,KAAK8T,YAArD,SACI,cAAC,IAAD,SAGR,qBAAKlV,UAAU,+BAAf,SACsB,YAAjBiV,EACGD,EAAc9R,OAAS,EACjB8R,EAAc5W,KAAI,SAAAsE,GAAI,OACpB,cAAC,GAAD,CAEIrB,KAAMqB,EACNoL,UAAWkJ,EACXxU,UAAWA,EAJf,SAMKE,EAAKpE,MALDoE,EAAKgC,SAOhB,qBAAK1E,UAAU,6BAAf,wBAGJ,qBAAKA,UAAU,6BAAf,SACGiV,SAKjB,eAAChD,GAAD,CAAWlO,MAAM,OAAOmO,QAASsD,EAAjC,UACI,sBAAKxV,UAAU,oBAAf,UACI,mBAAG0X,KAAK,gCAAR,SACI,cAAC,IAAD,CAAW1X,UAAU,gBAEzB,mBAAG0X,KAAK,yCAAR,SACI,cAAC,IAAD,CAAU1X,UAAU,mBAI5B,cAAC0R,GAAD,KACElS,KAAW,cAAC8T,GAAD,CAAc1C,QAASkG,iB,GA1UrCvU,aAgVnB,SAAS0U,GAAQnX,GACb,IAAIuB,EAAOvB,EAAMuB,KACbsW,EAAa7X,EAAMgO,UAAU8J,WAC7BxC,EAAatV,EAAMgO,UAAUsH,WAC7Ba,EAAenW,EAAMgO,UAAUmI,aAEnC,OAAO,sBAAKjW,UAAU,WAAf,UACH,qBAAKA,UAAU,YAAY4Q,QAAS,WAChCpO,EAAUnB,KAAO,CACbsB,UAAW,OACXD,KAAMrB,EACNuB,MAAO,GAEXwS,GAAW,IANf,SAQK/T,EAAK/C,OAEV,sBAAK0B,UAAU,uBAAf,UACI,wBAAQA,UAAU,cAAc4Q,QAAS,WACrCpO,EAAUnB,KAAO,CACbsB,UAAW,WACXD,KAAMrB,EACNuB,MAAO,GAEXwS,GAAW,IANf,SASI,cAAC,IAAD,MAGJ,wBAAQpV,UAAU,cAAc4Q,QAAS,WACrCpO,EAAUnB,KAAO,CACbsB,UAAW,cACXD,KAAMrB,EACNuB,MAAO,GAEXwS,GAAW,IANf,SASI,cAAC,KAAD,MAEJ,wBAAQpV,UAAU,cAAc4Q,QAAS,kBAAMqF,EAAa5U,IAA5D,SACI,cAAC,IAAD,MAGJ,wBAAQrB,UAAU,cAAc4Q,QAAS,kBAAM+G,EAAWtW,EAAK/C,OAA/D,SACI,cAAC,IAAD,CAASc,MAAM,oBAQhB+U,U,oBCrZT0D,G,WAEF,aAAc,yBADdC,GAAK,IAAIC,KAAQC,GAAGjd,EAAS,CAAEyb,MAAO,KAElCpV,KAAK6W,YAAc,CACfzB,MAAOpV,KAAK0W,GAAGI,WAAW,U,mFAGlC,sBAAA9M,EAAA,sEACiBhK,KAAK6W,YAAYzB,MAAMtI,OAAOiK,UAD/C,wF,sHAGA,WAAkBpW,GAAlB,SAAAqJ,EAAA,sEACiBhK,KAAK6W,YAAYzB,MAAM4B,QAAQ,CAAClC,IAAKnU,IADtD,wF,sHAGA,WAAiBsW,GAAjB,SAAAjN,EAAA,sEACiBhK,KAAK6W,YAAYzB,MAAM4B,QAAQC,GADhD,oCAC2DhU,EAD3D,+E,sHAGA,WAAiBgU,EAAMhX,GAAvB,SAAA+J,EAAA,+EACWhK,KAAK6W,YAAYzB,MAAMlE,OAAO+F,EAAOhX,IADhD,gD,8EAGA,SAAQqB,GACJ,OAAOtB,KAAK6W,YAAYzB,MAAM8B,OAAO5V,K,wBAEzC,SAAW2V,GACP,OAAOjX,KAAK6W,YAAYzB,MAAMpR,OAAOiT,O,KAIvCE,GAAK,IAAIV,GACfU,GAAGC,WC3BI,IAAMC,GAAmB,CAC5BC,cAAe3d,EAAU,GACzB0G,WAAY,CACRnD,KAAM,uBACNiB,KAAM,aACNoZ,aAAa,EACbpa,MAAOtC,EAAY,GACnB2W,OAAQ,IACRK,QAAShX,GAEb2c,OAAQ,CACJta,KAAM,uBACNiB,KAAM,aACNoZ,aAAa,EACbpa,MAAOtC,EAAY,GACnB2W,OAAQ,IACRK,QAAShX,GAEb4c,OAAQ,CACJva,KAAM,uBACNiB,KAAM,aACNoZ,aAAa,EACbpa,MAAOtC,EAAY,GACnB2W,OAAQ,IACRK,QAAShX,GAEbqH,IAAK,CACDhF,KAAM,MACNiB,KAAM,SACNoZ,aAAa,EACbzO,UAAW,CAAC,EAAG,MACf3L,MAAO,KAEXua,UAAW,CACPxa,KAAM,aACNiB,KAAM,SACNoZ,aAAa,EACbpa,MAAO,EACP0U,QAAS,CACL,EACA,IAGRzB,aAAc,CACVlT,KAAM,iBACNiB,KAAM,SACNoZ,aAAa,EACbpa,MAAmB,YAAZxD,EACD6W,sBACI,WACA,kBACJ,YACNqB,QAAqB,YAAZlY,EACH,CACE,YACA,kBACA,YAEF,CACE,YACA,oBAGZwI,MAAO,CACHjF,KAAM,QACNiB,KAAM,SACNoZ,aAAa,EACbpa,MAAO,IACP0U,QAAS,CACL,IACA,KACA,IACA,KACA,IACA,IACA,KACA,IACA,KACA,IACA,KACA,MAGR8F,iBAAkB,CACdza,KAAM,4BACNiB,KAAM,SACNoZ,aAAa,EACbpa,MAAO,GACP0U,QAAS,CACL,GACA,GACA,GACA,GACA,GACA,GACA,KAGR+F,SAAU,CACN1a,KAAM,qBACNiB,KAAM,WACNoZ,aAAa,EACbpa,OAAO,GAEX0a,SAAU,CACN3a,KAAM,mBACNiB,KAAM,WACNoZ,aAAa,EACbpa,OAAO,GAEX2a,gBAAiB,CACb5a,KAAM,yBACNiB,KAAM,OACNoZ,aAAa,EACbpa,MAAO,GACP2U,YAAa,cAEjBiG,SAAU,CACN7a,KAAM,iCACNiB,KAAM,WACNoZ,aAAa,EACbpa,OAAO,IAMF6a,GAAmB,CAC5BV,cAAe3d,EAAU,GACzB0G,WAAY,CACRnD,KAAM,aACNiB,KAAM,aACNoZ,aAAa,EACbpa,MAAOtC,EAAY,GACnB2W,OAAQ,IACRK,QAAShX,GAEbsH,MAAO,CACHjF,KAAM,QACNiB,KAAM,SACNoZ,aAAa,EACbpa,MAAO,IACP0U,QAAS,CACL,IACA,KACA,IACA,KACA,IACA,IACA,KACA,IACA,KACA,IACA,KACA,MAGR+F,SAAU,CACN1a,KAAM,qBACNiB,KAAM,WACNoZ,aAAa,EACbpa,OAAO,GAEXkS,aAAc,CACVnS,KAAM,gBACNiB,KAAM,SACNoZ,aAAa,EACbpa,MAAO,IACP2L,UAAW,CAAC,EAAG,MAEnBsH,aAAc,CACVlT,KAAM,iBACNiB,KAAM,SACNoZ,aAAa,EACbpa,MAAmB,YAAZxD,EACD6W,sBACI,WACA,kBACJ,YAENqB,QAAqB,YAAZlY,EACH,CACE,YACA,kBACA,YAEF,CACE,YACA,oBAGZse,cAAe,CACX/a,KAAM,qBACNiB,KAAM,SACNoZ,aAAa,EACbpa,MAAO,KACP2L,UAAW,CAAC,EAAG,MAEnBgP,gBAAiB,CACb5a,KAAM,yBACNiB,KAAM,OACNoZ,aAAa,EACbpa,MAAO,GACP2U,YAAa,cAEjBxX,cAAe,CACX4C,KAAM,iBACNiB,KAAM,WACNoZ,aAAa,EACbpa,OAAO,IClNM+a,GACjB,WAAYjI,GAAiB,IAAD,gCAwB5BlC,gBAAkB,SAACF,GACf,IAAIzO,EAAQ,EAAK5C,eAAesK,WAAU,SAAA7J,GAAC,OAAIA,IAAMkb,OAAOtK,MAC5D,OAAkB,IAAXzO,EAAeA,EAAQ,MA1BN,KA6B5BgS,aAAe,SAACxJ,GACZ,IAAIwQ,EAAYxT,QAAQgD,EAAS,KAAKqB,QAAQ,IAC3CrB,EAAS,IAAGwQ,EAAY,GAC3B,EAAKC,WAAWC,KAAKnb,MAAQib,GAhCL,KAmC5BtF,KAAO,SAACzY,EAAM8H,GACV,IAAG,EAAKoW,QAAR,CACA,IAAIC,EAAS/d,EAAage,qBAC1BD,EAAOE,OAAS,EAAKC,QAAQte,GAC7Bme,EAAOI,QAAQ,EAAKP,YACpBG,EAAOK,aAAa1b,MAAQgF,EAC5BqW,EAAOhX,MAAM,GACbgX,EAAOM,QAAU,WACbN,EAAOO,OACPP,EAAOQ,gBA5Ca,KA+C5BC,KA/C4B,sBA+CrB,8BAAAjP,EAAA,6DACCkP,EAAcze,EAAa0e,aAAa,EAAG1e,EAAa2e,WAAY3e,EAAa2e,YAC/EC,EAAW,EAAK1K,OAAO3R,KAAI,SAAA3C,GAC7B,OAAO,IAAIkP,SAAQ,SAAAC,GACfiJ,MAAMpY,EAAKif,KACN3G,MAAK,SAAA/L,GAAM,OAAIA,EAAO2S,iBACtB5G,MAAK,SAAA+F,GACFje,EAAa+e,gBAAgBd,EAAQlP,GAAS,WAC1CA,EAAQ0P,MAEXO,OAAM,SAAAxc,GAAMuM,EAAQ0P,SACtBO,OAAM,SAAAxc,GAAMuM,EAAQ0P,YAXhC,SAckB3P,QAAQmQ,IAAIL,GAd9B,cAcH,EAAKV,QAdF,OAeH,EAAKgB,QAAS,EAfX,mBAgBI,GAhBJ,2CA/CqB,KAiE5BX,WAAa,WACT,EAAKX,WAAWW,cAlEQ,KAoE5BJ,QAAU,SAACgB,GACP,EAAKvB,WAAWO,QAAQgB,IArEA,KAuE5BC,OAAS,WACL,EAAKb,aACL,EAAKT,SAAU,EACf,EAAKI,QAAU,MAzEf3Y,KAAKiQ,oBAAoChN,IAAnBgN,EAA+BpV,EAAY,GAAKoV,EACjEpV,EAAY4L,SAASzG,KAAKiQ,kBAAiBjQ,KAAKiQ,eAAiBpV,EAAY,IAClFmF,KAAK2O,OAAS,GACd3O,KAAK2Y,QAAU,GACf3Y,KAAK2Z,QAAS,EACd3Z,KAAKuY,SAAU,EACfvY,KAAKqY,WAAa5d,EAAaqf,aAC/B,IAAMC,EAAiBhf,EAAgBiF,KAAKiQ,gBAC5CjQ,KAAKxD,eAAiBD,EAAWwd,EAAe9e,OAAOuB,eACvDwD,KAAKtD,aAAeH,EAAWwd,EAAe9e,OAAOyB,aACrDsD,KAAKrD,cAAgBJ,EAAWwd,EAAe9e,OAAO0B,cAEtDqD,KAAKxD,eAAegG,SAAQ,SAAChI,EAAUqN,GACnC,IAAImS,EAAY,CACZvO,SAAUjR,EACVyf,OAAQ,EAAKvd,aAAamL,IAE1ByR,EAAG,yBAAqB,EAAKrJ,eAA1B,YAA4CpI,EAA5C,QACP,EAAK8G,OAAO5M,KAAK,IAAImY,GAASrS,EAAGmS,EAAWV,OAGhDtZ,KAAKqY,WAAWC,KAAKnb,MAAQ,IAwD/B+c,GACF,WAAY9a,EAAO4a,EAAWV,GAAM,oBAChCtZ,KAAKZ,MAAQA,EACbY,KAAKga,UAAYA,EACjBha,KAAKsZ,IAAMA,EACXtZ,KAAK0Y,OAAS,IAAIyB,YAAY,I,6BCnFjBC,G,WACjB,aAAe,oBACXpa,KAAK4Z,KAAOnf,EAAa4f,+BACrB3f,OAAO4f,cAIPta,KAAKua,SAAW,IAAID,cAActa,KAAK4Z,KAAKY,SAH5C1gB,QAAQC,IAAI,2BACZiG,KAAKua,SAAW,IAAIE,KAAsBza,KAAK4Z,KAAKY,S,yCAK5D,WACIxa,KAAKua,SAAS/Y,U,kBAElB,WAAQ,IAAD,OACH,OAAO,IAAI+H,SAAQ,SAAAC,GACf,EAAK+Q,SAASxL,iBAAiB,iBAAiB,SAAU9R,GACtDuM,EAAQ,CACJvJ,KAAMhD,EAAEgD,KACRya,MAAO,WACH,OAAOC,IAAIC,gBAAgB3d,EAAEgD,WAGtC,CAAE4a,MAAM,IACX,EAAKN,SAASxB,Y,6DAItB,WAAe+B,EAASnG,GAAxB,mBAAA3K,EAAA,6DACU+Q,EAASrX,SAASC,cAAc,KAD1C,KAEgBqX,KAFhB,SAE4BC,GAAYH,GAFxC,mBAEUI,GAFV,cAGQC,EAAO,IAAIC,KAAK,CAAC,IAAIC,SAASH,IAAO,CACrC/c,KAAM,cAEV4c,EAAO1X,SAAWsR,EAClBoG,EAAOzE,KAAOqE,IAAIC,gBAAgBO,GAClCJ,EAAOhX,QARX,4C,gEAYJ,SAASkX,GAAYE,GACjB,OAAO,IAAI5R,SAAQ,SAAAC,GACf,IAAM/O,EAAe,IAAIE,aACnB2gB,EAAa,IAAI9G,WACvB8G,EAAWC,UAAY,WACnB9gB,EAAa+e,gBAAgB8B,EAAW1U,QAAQ,SAAC4U,GAC7ChS,EAAQgS,OAGhBF,EAAWG,kBAAkBN,M,SCjDtBO,G,iFAAf,WAA2BC,GAA3B,SAAA3R,EAAA,+EACW,IAAIT,SAAQ,SAAAC,GACf,IAAMoS,EAAUlY,SAASC,cAAc,OACjCkY,EAAYnY,SAASC,cAAc,OACnCf,EAAOc,SAASC,cAAc,OAC9B+D,EAAMhE,SAASC,cAAc,OAC7BmY,EAASpY,SAASC,cAAc,UAChCoY,EAAKrY,SAASC,cAAc,UAC5BqY,EAAQtY,SAASC,cAAc,SAErCiY,EAAQhd,UAAY,iBACpBod,EAAM7d,KAAO,OACb0d,EAAUjd,UAAY,kBACtBod,EAAMlK,YAAc,aACpBkK,EAAMpd,UAAY,eAClBkd,EAAOld,UAAY,gBACnBmd,EAAGnd,UAAY,yBACf8I,EAAI9I,UAAY,aAChBmd,EAAGE,UAAY,KACfH,EAAOG,UAAY,SACnBrZ,EAAKqZ,UAAYN,EAEjBjU,EAAIwU,OAAOJ,EAAQC,GACnBF,EAAUK,OAAOtZ,EAAMoZ,EAAOtU,GAC9BkU,EAAQM,OAAOL,GACfnY,SAASE,KAAKC,YAAY+X,GAE1B,IAAIO,GAAW,EACf,SAASC,IACFD,IACwB,KAAvBH,EAAM7e,MAAMlD,OACZ8hB,EAAGM,UAAUC,IAAI,YAEjBP,EAAGM,UAAUrY,OAAO,aAG5B,SAASuY,IACFJ,IACH3S,EAAQ,MACRgT,KAEJ,SAASC,IACL,IAAGN,GACwB,KAAvBH,EAAM7e,MAAMlD,OAAhB,CACA,GAA2B,aAAvB+hB,EAAM7e,MAAMlD,OAEZ,OADA+hB,EAAM7e,MAAQ,GACP,IAAIuF,EAAY,UAAW,8CAA8CI,UAEpF0G,EAAQwS,EAAM7e,MAAMlD,QACpBuiB,KAGJ,SAAShP,EAAexK,GACpB,IAAMpC,EAAMoC,EAAM6K,KACP,UAARjN,GAAiB6b,IACT,WAAR7b,GAAkB2b,IAGzB,SAASG,EAAczf,GAChBA,EAAE0f,KAAK,KAAOf,GAASW,IAU9B,SAASC,IACLZ,EAAQzM,oBAAoB,QAAQuN,GACpCX,EAAG5M,oBAAoB,QAAQsN,GAC/BX,EAAO3M,oBAAoB,QAAQoN,GACnC7hB,OAAOyU,oBAAoB,UAAU3B,GACrCwO,EAAM7M,oBAAoB,QAAQiN,GAClCD,GAAW,EACXP,EAAQS,UAAUC,IAAI,yBACtBT,EAAUQ,UAAUC,IAAI,0BACxBnP,YAAW,kBAAMyP,GAAShB,KAAU,KAhBxCI,EAAMa,QACNjB,EAAQ7M,iBAAiB,QAAQ2N,GACjCZ,EAAO/M,iBAAiB,QAASwN,GACjCR,EAAGhN,iBAAiB,QAAS0N,GAC7B/hB,OAAOqU,iBAAiB,UAAUvB,GAClCwO,EAAMjN,iBAAiB,QAASqN,OAnExC,4C,+BAmFeU,G,iFAAf,WAA4BnB,GAA5B,2BAAA3R,EAAA,6DAAqC+S,IAArC,mDACW,IAAIxT,SAAQ,SAAAC,GACf,IAAMoS,EAAUlY,SAASC,cAAc,OACjCkY,EAAYnY,SAASC,cAAc,OACnCf,EAAOc,SAASC,cAAc,OAC9B+D,EAAMhE,SAASC,cAAc,OAC7BmY,EAASpY,SAASC,cAAc,UAChCoY,EAAKrY,SAASC,cAAc,UAElCiY,EAAQhd,UAAY,iBACpBid,EAAUjd,UAAY,kBACtBgE,EAAKqZ,UAAYN,EACjBG,EAAOld,UAAY,gBACnBmd,EAAGnd,UAAY,gBACf8I,EAAI9I,UAAY,aAChBmd,EAAGE,UAAY,MACfF,EAAG9c,MAAMtB,WAAa,UACtBme,EAAO7c,MAAMtB,WAAa,UAC1Bme,EAAOG,UAAY,KAEnBvU,EAAIwU,OAAOJ,EAAQC,GACnBF,EAAUK,OAAOtZ,EAAK8E,GACtBkU,EAAQM,OAAOL,GACfnY,SAASE,KAAKC,YAAY+X,GAE1B,IAAIO,GAAW,EACf,SAASM,IACFN,IACH3S,GAAQ,GACRgT,KAEJ,SAASD,IACFJ,IACH3S,GAAQ,GACRgT,KAEJ,SAAShP,EAAexK,GACpB,IAAMpC,EAAMoC,EAAM6K,KACP,UAARjN,GAAiB6b,IACT,WAAR7b,GAAoBmc,GAAaR,IAExC,SAASG,EAAczf,GAChBA,EAAE0f,KAAK,KAAOf,GAAWmB,GAAaR,IAO7C,SAASC,IACLL,GAAW,EACXL,EAAO3M,oBAAoB,QAAQoN,GACnCR,EAAG5M,oBAAoB,QAAQsN,GAC/B/hB,OAAOyU,oBAAoB,UAAU3B,GACrCoO,EAAQzM,oBAAoB,QAAQuN,GACpCd,EAAQS,UAAUC,IAAI,yBACtBT,EAAUQ,UAAUC,IAAI,0BACxBnP,YAAW,kBAAMyP,GAAShB,KAAU,KAbxCA,EAAQ7M,iBAAiB,QAAQ2N,GACjCZ,EAAO/M,iBAAiB,QAASwN,GACjCR,EAAGhN,iBAAiB,QAAS0N,GAC7B/hB,OAAOqU,iBAAiB,UAAUvB,GAClC9J,SAASgK,cAAcsF,WAhD/B,2C,yBA8DA,SAAS4J,GAASI,GACdA,EAAQC,iBAAiB,KAAKza,SAAQ,SAAAiB,GAAE,OAAIA,EAAGO,YAC/CgZ,EAAQhZ,S,WCzINkZ,G,kDACL,WAAYxe,GAAQ,IAAD,uBAClB,cAAMA,IAoBPgD,KArBmB,sBAqBZ,4BAAAsI,EAAA,6DACEmM,EAAa,EAAKpW,MAAlBoW,SADF,SAEA,EAAKgH,eAAehH,EAAS9V,WAAWlD,OAFxC,uBAGA,EAAKigB,aAHL,OAIN,EAAKC,kBAAkBlH,EAASyB,SAASza,OAJnC,2CArBY,EAyDnBqQ,eAzDmB,uCAyDH,WAAOxK,GAAP,eAAAgH,EAAA,yDACPsT,EAAgB,EAAKvd,MAArBud,aACEta,EAAMyK,OAFD,oDAG8B,UAAnC/J,SAASgK,cAAcC,QAHlB,qDAIN3K,EAAM4K,SAJA,sBAKE5K,EAAM6K,KALR,OAMI,SANJ,8BAOOyP,IAClB,EAAKC,eACLva,EAAMvC,kBATK,qGAzDG,wDA4EnB+c,UAAY,SAACvgB,GACZ,EAAKkN,SAAS,CACbsT,YAAY,KA9EK,EAiFnBC,eAAiB,SAACzgB,GACjBA,EAAEwD,iBACF,EAAK0J,SAAS,CACbsT,YAAY,KApFK,EAuFnBE,WAAa,SAAC1gB,GACbA,EAAEwD,iBACF,EAAK0J,SAAS,CACbsT,YAAY,KA1FK,EA6FnB9Q,WAAa,SAAC1M,GACb,EAAKkK,SAAS,CACbmT,YAAard,KA/FI,EAkGnB2d,WAlGmB,uCAkGN,WAAO3gB,GAAP,mBAAA+M,EAAA,6DACZ,EAAKwT,YACLvgB,EAAEwD,iBAFU,SAGM8I,QAAQmQ,IAAIpV,MAAMuZ,KAAK5gB,EAAE6gB,aAAaC,OAAO/gB,KAAI,SAAAsG,GAAI,OAAIA,EAAKV,WAHpE,OAGRwS,EAHQ,OAIHvN,EAAI,EAJD,YAIIA,EAAIuN,EAAMtT,QAJd,iCAMNR,EAAOiF,GAAkBlI,KAAKC,MAAM8W,EAAMvN,KANpC,UAOJ,EAAK6M,QAAQpT,GAPT,0DASVxH,QAAQ+Y,MAAR,MATU,QAIsBhL,IAJtB,yEAlGM,wDAgHnBwV,kBAAoB,SAACW,GACpB,GAAI,EAAKC,QAAT,CACA,IAAQ5d,EAAe,EAAKN,MAApBM,WACR,GAAI2d,EAAW,CACd,IAAK,EAAKE,WAAY,OAAOpkB,QAAQC,IAAI,8BACzCsG,EAAW2Y,aACX3Y,EAAWuY,QAAQ,EAAKsF,iBAExB7d,EAAW2Y,aACX3Y,EAAWuY,QAAQ,EAAKne,aAAa0jB,eAzHpB,EA4HnB/M,aAAe,SAACvM,GACT,IAAIsR,EAAW,EAAKpW,MAAMoW,SACV,eAAZtR,EAAIjE,MACbuV,EAAS9V,WAAT,2BAA0B8V,EAAS9V,YAAnC,IAA+CmR,OAAQ3M,EAAI1H,QAClD,EAAK4C,MAAMM,WAAW+Q,aAAavM,EAAI1H,QAE3C,EAAKgN,SAAS,CACVgM,SAAUA,IACX,kBAAM,EAAKiI,qBApIF,EAsInBC,YAAc,WACb,IAAIC,EAAiBC,aAAa/f,QAAQ7E,EAAU,kBACpD,IACC2kB,EAAiBjgB,KAAKC,MAAMggB,GAC3B,MAAOrhB,GACRqhB,EAAiB,KAElB,OAAuB,OAAnBA,EACCA,EAAehH,gBAAkBU,GAAiBV,eACrD,EAAK8G,eAAepG,IACbA,IAEDsG,EAEDtG,IApJW,EAsJnBmF,eAtJmB,uCAsJF,WAAOjgB,GAAP,mBAAA8M,EAAA,6DAChB,YAAKjK,MAAMM,kBAAX,mBAAuBwZ,cAAvB,kBACI2E,EAAgB,IAAItG,GAAWhb,IACrBkU,aAAa,EAAKrR,MAAMoW,SAAS9V,WAAWmR,QAAU,KACpE,EAAKrH,SAAS,CAAEsU,qBAAqB,IAJrB,SAKVD,EAAcvF,OALJ,UAMZ,EAAKgF,QANO,iDAOhBO,EAAc5F,QAAQ,EAAKne,aAAa0jB,aACxC,EAAKhU,SAAS,CACb9J,WAAYme,EACZC,qBAAqB,IACnB,kBAAM,EAAKpB,kBAAkB,EAAKtd,MAAMoW,SAASyB,SAASza,UAX7C,4CAtJE,wDA2LnBsR,UAAY,SAACpU,GACZ,IAAQ0F,EAAR,eAAQA,MACAoW,EAAapW,EAAboW,cACKlT,IAAT5I,IACA0F,EAAM2e,aAAa,EAAKC,gBAAgBtkB,GAC5C,EAAK0F,MAAMM,WAAWyS,KAAKzY,EAAK+E,MAAO2J,GAAgBoN,EAAShU,MAAMhF,UAhMpD,EAkMnBihB,eAAiB,SAACpR,GACjB,IAAIjN,EAEHA,OADgBkD,IAAb+J,EACKA,EAEA,EAAKjN,MAAMoW,SAEpBoI,aAAaK,QAAQjlB,EAAU,iBAAkB0E,KAAKqH,UAAU3F,KAzM9C,EA2MnB0V,oBAAsB,SAACoJ,GACtB,IAAI1I,EAAW,EAAKpW,MAAMoW,SACtBlW,EAAO4e,EAAQ5e,KACnBkW,EAAS0I,EAAQje,KAAjB,2BAA4BuV,EAAS0I,EAAQje,MAA7C,IAAmDzD,MAAO8C,EAAK9C,QAC3C,eAAhB0hB,EAAQje,KACX,EAAKuc,eAAeld,EAAK9C,OAEN,aAAhB0hB,EAAQje,KACX,EAAKyc,kBAAkBpd,EAAK9C,OAE7B,EAAKgN,SAAS,CACbgM,SAAUA,GACR,EAAKiI,iBAvNU,EAyNnBU,UAzNmB,sBAyNP,sBAAA9U,EAAA,6EAEGmN,GAAGC,WAFN,yBAEVhC,MAFU,WACNjL,SADM,2DAzNO,EA8NnB4U,WA9NmB,uCA8NN,WAAO7hB,GAAP,SAAA8M,EAAA,sEACCmN,GAAG6H,WAAW,CAAE9hB,KAAMA,IADvB,mFA9NM,wDAiOnBwX,QAjOmB,uCAiOT,WAAOpT,GAAP,SAAA0I,EAAA,+EAEE,EAAK+U,WAAWzd,EAAKpE,MAFvB,2DAGA,IAAIwF,EAAY,UAAW,2CAA6CpB,EAAKpE,MAAM4F,WAHnF,uBAKFqU,GAAGzC,QAAQpT,GALT,OAMR,EAAKwd,YACL,IAAIpc,EAAY,UAAhB,4BAAgDpB,EAAKrB,KAAKoC,kBAAoB,WAAa,WAA3F,SAA8G,KAAMS,UAP5G,yDASRhJ,QAAQ+Y,MAAR,MATQ,kBAUD,IAAInQ,EAAY,QAAS,yCAAyCI,WAVjE,0DAjOS,wDAqPnB0T,WArPmB,uCAqPN,WAAOtZ,GAAP,eAAA8M,EAAA,sEACO8S,GAAa,8CAAD,OAA+C5f,EAA/C,QADnB,UACR0J,EADQ,OAER,EAAKqX,QAFG,qDAGRrX,EAHQ,gCAILuQ,GAAGX,WAAW,CAAEtZ,KAAMA,IAJjB,OAKX,EAAK4hB,YALM,2CArPM,wDA6PnBH,gBAAkB,SAACtkB,GACd,EAAK0F,MAAM2e,aACd,EAAKO,UAAUpd,QAAQxH,EAAK+E,QA/PX,EAkQnB8f,eAAiB,WAChB,OAAO,IAAI3V,QAAJ,uCAAY,WAAMC,GAAN,iBAAAQ,EAAA,sDACdmV,EAAe,0CADD,uBAGIzD,GAAYyD,GAHhB,UAIA,QADbpK,EAHa,iDAIavL,EAAQ,OAJrB,UAKA,KAAbuL,EALa,kCAMN,EAAKgK,WAAWhK,GANV,oCAOfoK,EAAe,6BAA+BpK,EAP/B,iDASRvL,EAAQuL,IATA,gCAYhBoK,EAAe,0CAZC,mEAAZ,wDAnQW,EAqRnB5B,aArRmB,uCAqRJ,WAAOvQ,GAAP,mBAAAhD,EAAA,yDACU,mBAAbgD,IAAwBA,OAAW/J,IAC1CgR,OAAwBhR,IAAb+J,EAAyBA,GAAY,EAAKjN,MAAM2e,gBAC9C,EAAKO,UAAUhkB,MAAM6G,OAAS,GAHjC,iCAIQ,EAAKod,iBAJb,UAITnK,EAJS,OAKT,EAAKkJ,QALI,kDAMT3c,EAAO,IAAIU,EAAK+S,EAAU,EAAKkK,UAAUhkB,QACxCkH,MAAQ,EAAKpC,MAAMoW,SAAShU,MAAMhF,MACtB,OAAb4X,GAAmB,EAAKL,QAAQpT,GARvB,wBAUb,EAAK2d,UAAY,IAAIxd,EAVR,QAYd,EAAK1B,MAAM2e,YAAczK,EACzB,EAAK9J,SAAS,CACb8I,KAAM,EAAKlT,MAAM2e,cAdJ,4CArRI,wDAsSnBU,kBAtSmB,uCAsSC,WAAOpS,GAAP,2BAAAhD,EAAA,yDACf,EAAKiU,QADU,oDAEK,mBAAbjR,IAAwBA,OAAW/J,GACtC5C,EAAe,EAAKN,MAApBM,WAHW,iBAIXka,EAJW,EAIXA,SACFyD,EAAY,EAAKje,MAAMoW,SAASyB,SAASza,QACzC8W,OAAwBhR,IAAb+J,EAAyBA,GAAY,EAAKjN,MAAMsf,kBAN9C,iBAQdrB,EACH,EAAKsB,iBAAiB1G,QAAQ2B,EAASX,MAEvCvZ,EAAWuY,QAAQ2B,EAASX,MAE7BW,EAAS/Y,QAbS,yCAeI+Y,EAASxB,OAfb,eAedkG,EAfc,iBAgBGvD,GAAY,+CAhBf,WAgBd/G,EAhBc,OAiBd,EAAKsJ,QAjBS,mDAkBdtJ,GAAU4F,EAASlX,SAAS4b,EAAUhf,KAAM0U,EAAW,QAC3D,EAAK0I,kBAAkBW,GACvB,EAAKsB,iBAAiBtG,aACtB,EAAKsG,iBAAiB1G,QAAQne,EAAa0jB,aArBzB,QAwBnB,EAAKhU,SAAS,CACbkV,iBAAkBpL,IAzBA,4CAtSD,sDAElB,EAAKgL,UAAY,IAAIxd,EACrB,IAAI0U,EAAW,EAAKkI,cAHF,OAIlB,EAAKte,MAAQ,CACZM,WAAY,IAAI6X,GAChBuG,qBAAqB,EACrBC,aAAa,EACbW,kBAAkB,EAClBjK,MAAO,GACPe,SAAUA,EACVsH,YAAY,EACZH,aAAa,GAEd,EAAKW,SAAU,EACf,EAAKC,gBAAajb,EAClB,EAAKqc,sBAAmBrc,EACxB,EAAKxI,aAAeA,EACpB,EAAK8f,SAAW,IAAIH,GAlBF,E,qDA2BnB,WACC1W,SAASE,KAAKmL,iBAAiB,YAAa/O,KAAK2d,YACjDja,SAASE,KAAKmL,iBAAiB,YAAa/O,KAAKwd,WACjD9Z,SAASE,KAAKmL,iBAAiB,WAAY/O,KAAK0d,gBAChDha,SAASE,KAAKmL,iBAAiB,OAAQ/O,KAAK4d,YACtCljB,OAAOqU,iBAAiB,UAAW/O,KAAKwN,gBAE9CxN,KAAKie,SAAU,EACfje,KAAK8e,YACL9e,KAAK0B,S,kCAEN,WACCgC,SAASE,KAAKuL,oBAAoB,YAAanP,KAAK2d,YACpDja,SAASE,KAAKuL,oBAAoB,YAAanP,KAAKwd,WACpD9Z,SAASE,KAAKuL,oBAAoB,OAAQnP,KAAK4d,YAC/Cla,SAASE,KAAKuL,oBAAoB,WAAYnP,KAAK0d,gBAC7ChjB,OAAOyU,oBAAoB,UAAWnP,KAAKwN,gBAEjDpM,EAAUnB,KAAO,CAChBqB,KAAM,GACNC,UAAW,OACXC,MAAO,GAERxB,KAAKie,SAAU,EACfje,KAAKvF,kBAAewI,EACpBjD,KAAKua,cAAWtX,EAChBjD,KAAKke,gBAAajb,EAClBjD,KAAKsf,sBAAmBrc,EACxBjD,KAAKD,MAAMM,WAAWwZ,W,wBA4GvB,WAAc,IAAD,OACZ,OAAO,IAAItQ,SAAQ,SAAAC,GAClBiJ,MAAM,8BACJE,MAAK,SAAA4M,GAAC,OAAIA,EAAEhG,iBACZ5G,MAAK,SAAA6M,GACD,EAAKvB,SACT,EAAKxjB,aAAa+e,gBAAgBgG,GAAG,SAACC,GACrC,GAAI,EAAKxB,QAAT,CACA,IAAIyB,EAAY,EAAKjlB,aAAaklB,kBAC9BC,EAAW,EAAKnlB,aAAaqf,aACjC8F,EAAStH,KAAKnb,MAAQ,IACtBuiB,EAAUhH,OAAS+G,EACnBC,EAAU9G,QAAQgH,GAClBA,EAAShH,QAAQ,EAAKne,aAAa0jB,aACnC,EAAKmB,iBAAmBM,EACxB,EAAK1B,WAAawB,EAClBlW,WAECiQ,OAAM,SAACxc,GACTnD,QAAQC,IAAI,oBAAqBkD,W,+BAyDrC,WACC,IAAIyF,EAAY,UAAW,0DAA0DI,UACrF1B,EAAUnB,KAAO,CAChBqB,KAAM,GAAIC,UAAW,OAAQC,MAAO,K,oBAgFtC,WACC,IAAQzB,EAAUC,KAAVD,MACF8f,EAAoB,CACzBpV,kBAAmBzK,KAAKyK,kBACxBgE,UAAWzO,KAAKyO,UAChB9B,WAAY3M,KAAK2M,YAEZmT,EAAe,CACpB9P,UAAWjQ,EAAM0e,oBACjBhT,SAAU1L,EAAMM,WAChB8B,MAAOpC,EAAMoW,SAAShU,MAAMhF,MAC5BkS,aAActP,EAAMoW,SAAS9G,aAAalS,MAC1CiT,aAAcrQ,EAAMoW,SAAS/F,aAAajT,MAC1CyN,QAAS7K,EAAMud,YACf/O,aAAcxO,EAAMoW,SAAS7b,cAAc6C,MAC3CuC,aAAcK,EAAMoW,SAAS8B,cAAc9a,OAEtC4iB,EAAgB,CACrBrL,QAAS1U,KAAK0U,QACd8B,WAAYxW,KAAKwW,WACjBd,WAAY1V,KAAKtB,MAAMgX,WACvBD,oBAAqBzV,KAAKyV,oBAC1BrE,aAAcpR,KAAKoR,cAEd4O,EAAW,CAChB5K,MAAOrV,EAAMqV,MACbe,SAAUpW,EAAMoW,UAGjB,OAAO,sBAAKvX,UAAU,eAAeK,MAAO,CAAE6Y,gBAAgB,OAAD,OAAS/X,EAAMoW,SAAS2B,gBAAgB3a,MAAxC,MAAtD,UACwB,gBAA7BiE,EAAUnB,KAAKsB,WACf,qBAAK3C,UAAU,gBAAf,SACC,cAACqhB,GAAD,CACCC,OAAQngB,EAAMsf,iBACdtb,MAAO/D,KAAKof,kBAFb,SAIErf,EAAMsf,iBAAmB,mBAAqB,mBAKjDtf,EAAM0d,YAAc,qBAAK7e,UAAU,cAAf,4BAGrB,cAAC,GAAD,CAAM8N,UAAWqT,EAAe9f,KAAM+f,IACtC,sBAAKphB,UAAU,cAAf,UACC,qBAAKA,UAAU,cAAf,UACGoB,KAAKD,MAAMud,aAEZ,cAAC2C,GAAD,CACCC,OAAQngB,EAAM2e,YACd3a,MAAO/D,KAAKud,aACZte,MAAO,CAAC6W,UAAW,UAHpB,SAKE/V,EAAM2e,YAAc,OAAS,aAKjC,qBAAK9f,UAAU,mBAAmBK,MAAO,CAAC8Q,aAAc,OAAxD,SACC,cAAC,GAAD,CAEC9P,KAAM6f,EACNpT,UAAWmT,GAFN9f,EAAMM,WAAW4P,4B,GAhYV9O,aAmZlB,SAAS8e,GAAUvhB,GAClB,IAAIE,EAAY,mBAAqBF,EAAMwhB,OAAS,WAAa,IACjE,OAAO,wBAAQthB,UAAWA,EAAW4Q,QAAS9Q,EAAMqF,MAAO9E,MAAK,eAAQP,EAAMO,OAAS,IAAhF,SACLP,EAAMiL,YATT,WACC,GAAIvL,IAAS,OAAOtE,QAAQC,IAAI,SAChC,IAAIomB,EAAUzc,SAAS0c,SAAS3Z,SAAS,kBACzClI,eAAeqgB,QAAQ,QAASuB,GAEjCE,GAOenD,UCraA,OAA0B,oCCA1B,OAA0B,uC,SCgB1BoD,OAff,SAAqBnjB,EAAO0O,GAC1B,MAA4CwF,mBAASlU,GAArD,oBAAOojB,EAAP,KAAuBC,EAAvB,KAYA,OAXA5O,qBACE,WACE,IAAM6O,EAAUtT,YAAW,WACzBqT,EAAkBrjB,KACjB0O,GACH,OAAO,WACL6U,aAAaD,MAGjB,CAACtjB,EAAO0O,IAEH0U,GCqST,SAASI,GAAMjiB,GACX,IAAQuB,EAA2BvB,EAA3BuB,KAAMb,EAAqBV,EAArBU,MAAOwhB,EAAcliB,EAAdkiB,UACrB,EAAkCvP,oBAAS,GAA3C,oBAAOwP,EAAP,KAAkBC,EAAlB,KACA,OAAO,sBAAKliB,UAAU,oBAAf,UACH,sBAAKA,UAAU,qBAAf,UACI,sBAAKA,UAAU,oBAAf,UACI,uBAAOT,KAAK,WAAWwR,SAAU,kBAAMiR,EAAU,QAAS,CAAExhB,MAAOA,KAAU6R,QAAShR,EAAKoE,WAC1FpE,EAAK/C,KAFV,KAEkB+C,EAAKhF,MAAM6G,OAF7B,OAIA,sBAAKlD,UAAU,oBAAf,UACI,qBAAKK,MAAO,CAAE8hB,UAAW,UAAzB,SACK9gB,EAAKI,WAAW2gB,SAErB,yBACIrR,SAAU,SAAC3M,GAAD,OAAW4d,EAAU,QAAS,CAAExhB,MAAOA,EAAOmG,MAAOX,OAAO5B,EAAMuK,OAAOpQ,UACnFA,MAAO8C,EAAKsF,MACZ3G,UAAU,cAHd,UAKI,wBAAQzB,MAAM,IAAd,qBACA,wBAAQA,MAAM,IAAd,qBACA,wBAAQA,MAAM,IAAd,wBAGJ,cAAC,IAAD,CACI2O,KAAM,GACN9N,MAAO6iB,EAAY,qBAAuB,QAC1CrR,QAAS,kBAAMsR,GAAcD,IAC7BI,OAAO,kBAKnB,sBAAKriB,UAAU,kBAAkBK,MAAO,CAAE+W,QAAS6K,EAAY,OAAS,QAAxE,UACI,sBAAKjiB,UAAU,sBAAf,UACI,8CACA,8BAAMqB,EAAKI,WAAWnD,UAE1B,sBAAK0B,UAAU,sBAAf,UACI,mDACA,8BAAMqB,EAAKhF,MAAM6G,YAErB,sBAAKlD,UAAU,sBAAf,UACI,+CACA,8BAAMqB,EAAKihB,yBAEf,sBAAKtiB,UAAU,sBAAf,UACI,gDACA,8BAAMqB,EAAKkhB,8BAMZC,O,kDAhWX,WAAY1iB,GAAQ,IAAD,8BACf,cAAMA,IAaV2iB,WAAa,SAAC/d,GACV,IAAMiR,EAAS,IAAIC,WACnBD,EAAOxF,iBAAiB,QAAQ,SAAC/L,GAAW,IAAD,IACnCse,EACJ,IACIA,EAAO,IAAIC,QAAKve,EAAMuK,OAAO3G,QAC/B,MAAO3J,GACLnD,QAAQ+Y,MAAM5V,GAElB,IAAKqkB,EAAM,OAAO,IAAI5e,EAAY,QAAS,yCAA0C,KAAMI,UAC3F,IAAIZ,EAAG,UAAGof,EAAKE,OAAOC,OAAO,UAAtB,aAAG,EAAuBvf,IAC7BtB,EAAG,UAAG0gB,EAAKE,OAAOE,cAAc,UAA7B,aAAG,EAA8B9gB,IACxC0gB,EAAKK,OAAOnf,SAAQ,SAACof,EAAO/Z,GACxB+Z,EAAMvd,UAAW,EACjBud,EAAMrc,MAAQ,EACdqc,EAAM1kB,KAAO0kB,EAAM1kB,MAAN,kBAAyB2K,EAAI,GAC1C+Z,EAAMV,oBAAsB,EAC5BU,EAAMT,mBAAqB,KAE/B,EAAKhX,SAAS,CACVmX,KAAMA,EACN3M,SAAUrR,EAAKpG,KACfgF,IAAK5C,KAAKC,MAAY,EAAN2C,IAAY,IAC5B2f,OAAQ,EACR1f,MAAO/E,EAASqJ,SAAS7F,GAAOA,EAAM,MACvC,WAAgC,OAApB,EAAKb,MAAMuhB,MAAe,EAAKQ,oBAElDvN,EAAOkH,kBAAkBnY,IAzCV,EA4CnBwe,YAAc,WACV,MAAyD,EAAK/hB,MAAtDuhB,EAAR,EAAQA,KAAMpf,EAAd,EAAcA,IAAK2f,EAAnB,EAAmBA,OAAQE,EAA3B,EAA2BA,mBAAoB5f,EAA/C,EAA+CA,MAC3Cwf,EAASL,EAAKK,OAAOvmB,QAAO,SAAAwmB,GAAK,OAAIA,EAAMvd,YAC3CpJ,EAAQ,GACRimB,EAAsB,EACtBc,EAAa,EACbC,EAAa,EACjBN,EAAOnf,SAAQ,SAAAof,GACXA,EAAMV,oBAAsB,EAC5BU,EAAMT,mBAAqB,EAC3BS,EAAM3mB,MAAMuH,SAAQ,SAAA0f,GAChBD,IACA,IAAIE,EAwUpB,SAAyBD,GACrB,IAAI7nB,EAAO,KACP+nB,GAAe,EACnB,GAAgB,QAAZzoB,EACA,OAAQuoB,GACJ,KAAK,GAAI7nB,EAAO,EAAG,MACnB,KAAK,GAAIA,EAAO,EAAG+nB,GAAe,EAAM,MACxC,KAAK,GAAI/nB,EAAO,EAAG,MACnB,KAAK,GAAIA,EAAO,EAAG+nB,GAAe,EAAM,MACxC,KAAK,GAAI/nB,EAAO,EAAG,MACnB,KAAK,GAAIA,EAAO,EAAG,MACnB,KAAK,GAAIA,EAAO,EAAG+nB,GAAe,EAAM,MACxC,KAAK,GAAI/nB,EAAO,EAAG,MACnB,KAAK,GAAIA,EAAO,EAAG+nB,GAAe,EAAM,MACxC,KAAK,GAAI/nB,EAAO,EAAG,MACnB,KAAK,GAAIA,EAAO,EAAG+nB,GAAe,EAAM,MACxC,KAAK,GAAI/nB,EAAO,EAAG,MACnB,KAAK,GAAIA,EAAO,EAAG,MACnB,KAAK,GAAIA,EAAO,EAAG+nB,GAAe,EAAM,MACxC,KAAK,GAAI/nB,EAAO,EAAG,MACnB,KAAK,GAAIA,EAAO,EAAG+nB,GAAe,EAAM,MACxC,KAAK,GAAI/nB,EAAO,EAAG,MACnB,KAAK,GAAIA,EAAO,GAAI,MACpB,KAAK,GAAIA,EAAO,GAAI+nB,GAAe,EAAM,MACzC,KAAK,GAAI/nB,EAAO,GAAI,MACpB,KAAK,GAAIA,EAAO,GAAI+nB,GAAe,EAAM,MACzC,KAAK,GAAI/nB,EAAO,GAAI,MACpB,KAAK,GAAIA,EAAO,GAAI+nB,GAAe,EAAM,MACzC,KAAK,GAAI/nB,EAAO,GAAI,MACpB,KAAK,GAAIA,EAAO,GAAI,MACpB,QAASA,EAAO,KAGxB,GAAgB,YAAZV,EACA,OAAQuoB,GACJ,KAAK,GAAI7nB,EAAO,GAAI,MACpB,KAAK,GAAIA,EAAO,GAAI+nB,GAAe,EAAM,MACzC,KAAK,GAAI/nB,EAAO,GAAI,MACpB,KAAK,GAAIA,EAAO,GAAI+nB,GAAe,EAAM,MACzC,KAAK,GAAI/nB,EAAO,GAAI,MACpB,KAAK,GAAIA,EAAO,GAAI,MACpB,KAAK,GAAIA,EAAO,GAAI+nB,GAAe,EAAM,MACzC,KAAK,GAAI/nB,EAAO,GAAI,MACpB,KAAK,GAAIA,EAAO,GAAI+nB,GAAe,EAAM,MACzC,KAAK,GAAI/nB,EAAO,GAAI,MACpB,KAAK,GAAIA,EAAO,GAAI+nB,GAAe,EAAM,MACzC,KAAK,GAAI/nB,EAAO,GAAI,MACpB,KAAK,GAAIA,EAAO,EAAG,MACnB,KAAK,GAAIA,EAAO,EAAG+nB,GAAe,EAAM,MACxC,KAAK,GAAI/nB,EAAO,EAAG,MACnB,KAAK,GAAIA,EAAO,EAAG+nB,GAAe,EAAM,MACxC,KAAK,GAAI/nB,EAAO,EAAG,MACnB,KAAK,GAAIA,EAAO,GAAI,MACpB,KAAK,GAAIA,EAAO,GAAI+nB,GAAe,EAAM,MACzC,KAAK,GAAI/nB,EAAO,GAAI,MACpB,KAAK,GAAIA,EAAO,GAAI+nB,GAAe,EAAM,MACzC,KAAK,GAAI/nB,EAAO,GAAI,MACpB,KAAK,GAAIA,EAAO,GAAI+nB,GAAe,EAAM,MACzC,KAAK,GAAI/nB,EAAO,GAAI,MACpB,KAAK,GAAIA,EAAO,EAAG,MACnB,KAAK,GAAIA,EAAO,EAAG+nB,GAAe,EAAM,MACxC,KAAK,GAAI/nB,EAAO,EAAG,MACnB,KAAK,GAAIA,EAAO,EAAG+nB,GAAe,EAAM,MACxC,KAAK,GAAI/nB,EAAO,EAAG,MACnB,KAAK,GAAIA,EAAO,EAAG,MACnB,KAAK,GAAIA,EAAO,EAAG+nB,GAAe,EAAM,MACxC,KAAK,GAAI/nB,EAAO,EAAG,MACnB,KAAK,GAAIA,EAAO,EAAG+nB,GAAe,EAAM,MACxC,KAAK,GAAI/nB,EAAO,EAAG,MACnB,KAAK,GAAIA,EAAO,EAAG+nB,GAAe,EAAM,MACxC,KAAK,GAAI/nB,EAAO,EAAG,MACnB,QAASA,EAAO,KAGxB,MAAO,CACHA,KAAMA,EACN+nB,aAAcA,GApZcC,CAAgBH,EAASZ,KAAOO,GAChDxnB,EAAO,CACPyL,KAAMxG,KAAKC,MAAsB,IAAhB2iB,EAASpc,MAC1BzL,KAAM8nB,EAAc9nB,KACpBkL,MAAOqc,EAAMrc,OAEb4c,EAAcC,eACdlB,IACAU,EAAMV,uBAEQ,OAAd7mB,EAAKA,MACD0nB,GAAuBI,EAAcC,cACrCnnB,EAAM8G,KAAK1H,IAGf2nB,IACAJ,EAAMT,4BAIlBlmB,EAAQA,EAAMqnB,MAAK,SAACtY,EAAGwV,GAAJ,OAAUxV,EAAElE,KAAO0Z,EAAE1Z,QAGxC,IAFA,IAAIuB,EAAU/H,KAAKC,MAAM,IAAQ2C,GAC7BsF,EAAe,GACZvM,EAAM6G,OAAS,GAAG,CAGrB,IAFA,IAAI4F,EAAM,CAACzM,EAAM0M,SACbC,EAAS,EACJC,EAAI,EAAGA,EAAI5M,EAAM6G,OAAQ+F,IAC1BH,EAAI,GAAG5B,KAAO7K,EAAM4M,GAAG/B,KAAOuB,EAAU,GAAGO,IAEnDJ,EAAazF,KAAb,UAAsB2F,EAAtB,YAA8BzM,EAAM6M,OAAO,EAAGF,MAElD,IAAIxD,EAAU,GACVqD,EAAe,EACnBD,EAAahF,SAAQ,SAAAvH,GACjB,IAAIZ,EAAOY,EAAM,GACjB,GAAKZ,EAAL,CACA,IAAI0N,EAAc1N,EAAKyL,KAAO2B,EAC9BA,EAAepN,EAAKyL,KACpB,IAAIkC,EAAe1I,KAAKC,OAAOwI,EAAcV,GAAWA,GACpDW,GAAgB,GAAG,IAAI1D,MAAM0D,GAAcrJ,KAAK,GAAG6D,SAAQ,kBAAM4B,EAAQrC,KAAK,IAAIyC,OACtF,IAAIyD,EAAa,IAAIzD,GACrByD,EAAWhN,MAAQA,EAAM+B,KAAI,SAAA3C,GACzB,OAAO,IAAI2K,GAAW3K,EAAKA,KAAM6N,GAAc7N,EAAKkL,WAExDnB,EAAQrC,KAAKkG,OAEjB7D,EAAQ5B,SAAQ,SAAA+B,GACZ,IAAIiD,EAAeW,GAAa5D,GAChCA,EAAOtJ,MAAQuM,EAAaxK,KAAI,SAAAoL,GAE5B,OADAA,EAAM,GAAG7C,MAAQ8C,GAAYD,GACtBA,EAAM,SAGrB,IAAI9G,EAAO,IAAI6C,EAAa,YAC5B7C,EAAK8C,QAAUA,EACf9C,EAAKY,IAAMA,EACXZ,EAAKzG,YAAc,EAAK6D,MAAMuB,KAAKpF,YACnCyG,EAAKa,MAAQA,EACb,IAAIogB,EAAa,EAAK7jB,MAAMuB,KAAKuiB,eAEjC,GADAlhB,EAAK+C,SAAWke,EAAajhB,EAAK8C,QAAQtC,OAASygB,EAAa,EACpC,IAAxBjhB,EAAK8C,QAAQtC,OACb,OAAO,IAAIY,EAAY,QAAS,qBAAsB,KAAMI,UAEhE,EAAKpE,MAAMgO,UAAU+V,SAASnhB,GAC9B,EAAK6I,SAAS,CACVuY,YAAaxB,EACbe,WAAYA,EACZD,WAAYA,KA3HD,EA+HnBpB,UAAY,SAAC+B,EAAS1iB,GAClB,IAAI0hB,EAAS,EAAK5hB,MAAMuhB,KAAKK,OACb,UAAZgB,IAEAhB,EAAO1hB,EAAKb,OAAOiF,UAAYsd,EAAO1hB,EAAKb,OAAOiF,UAEtC,UAAZse,IACAhB,EAAO1hB,EAAKb,OAAOmG,MAAQtF,EAAKsF,OAGpC,EAAK4E,SAAS,CACVmX,KAAM,EAAKvhB,MAAMuhB,OAClB,WAAgC,OAApB,EAAKvhB,MAAMuhB,MAAe,EAAKQ,kBA3I/B,EA6InBc,aAAe,SAACzlB,GACZA,EAAQ0lB,SAAS1lB,GACZyH,OAAOwI,UAAUjQ,KAAQA,EAAQ,GAClC,EAAK4C,MAAM8hB,SAAW1kB,GAC1B,EAAKgN,SAAS,CACV0X,OAAQ1kB,IACT,WAAgC,OAApB,EAAK4C,MAAMuhB,MAAe,EAAKQ,kBAnJ/B,EAqJnBgB,YAAc,SAAC3lB,GACX,EAAKuB,MAAMgO,UAAUoW,YAAY3lB,GACjC,EAAKgN,SAAS,CACVhI,MAAOhF,KAxJI,EA2JnB4lB,kBAAoB,WAChB,EAAK5Y,SAAS,CACV4X,oBAAqB,EAAKhiB,MAAMgiB,qBACjC,WAAgC,OAApB,EAAKhiB,MAAMuhB,MAAe,EAAKQ,kBA9J/B,EAgKnBkB,UAAY,SAAC7lB,GACTA,EAAQ0lB,SAAS1lB,GACZyH,OAAOwI,UAAUjQ,KAAQA,EAAQ,GAClC,EAAK4C,MAAMmC,MAAQ/E,GACvB,EAAKgN,SAAS,CACVjI,IAAK/E,IACN,WAAgC,OAApB,EAAK4C,MAAMuhB,MAAe,EAAKQ,kBApK9C,EAAK/hB,MAAQ,CACT4U,SAAU,GACV2M,KAAM,KACNpf,IAAK,IACL2f,OAAQ,EACR1f,MAAO,IACPugB,YAAa,EACbV,WAAY,EACZC,WAAY,EACZF,oBAAoB,GAXT,E,0CAwKnB,WACI,IAAQV,EAAuErhB,KAAvEqhB,WAAYT,EAA2D5gB,KAA3D4gB,UAAW7gB,EAAgDC,KAAhDD,MAAOijB,EAAyChjB,KAAzCgjB,UAAWJ,EAA8B5iB,KAA9B4iB,aAAcE,EAAgB9iB,KAAhB8iB,YACvDnO,EAAgG5U,EAAhG4U,SAAU2M,EAAsFvhB,EAAtFuhB,KAAMpf,EAAgFnC,EAAhFmC,IAAK2f,EAA2E9hB,EAA3E8hB,OAAQ1f,EAAmEpC,EAAnEoC,MAAOugB,EAA4D3iB,EAA5D2iB,YAAaV,EAA+CjiB,EAA/CiiB,WAAYC,EAAmCliB,EAAnCkiB,WAAYF,EAAuBhiB,EAAvBgiB,mBAEzEkB,EADcjjB,KAAKtB,MAAnBgO,UACAuW,qBACR,OAAO,sBAAKrkB,UAAU,gBAAf,UACH,sBACIA,UAAU,4BACVK,MAAO,CAAEJ,MAAO,QAFpB,UAII,cAAC,cAAD,CAAY8Q,SAAU0R,EAAtB,SACI,wBAAQziB,UAAU,WAAlB,uCAIJ,qBAAKK,MAAO,CAAEikB,OAAQ,WAAYC,SAAU,OAAQC,aAAc,WAAYC,SAAU,UAAxF,SACK1O,IAEL,wBACI/V,UAAU,WACVK,MAAO,CAAEiX,WAAY,QACrB1G,QAAS,kBAAMyT,GAAqB,IAHxC,sBAQJ,uBAAOrkB,UAAU,mBAAmBK,MAAO,CAAEJ,MAAO,QAApD,SACI,kCACI,+BACI,6BACI,qBAAKI,MAAO,CAAEqkB,YAAa,UAA3B,oBAEJ,oBAAIrkB,MAAO,CAAE+W,QAAS,OAAQC,eAAgB,WAAYsN,WAAY,UAAtE,SACI,cAACC,GAAD,CACIrmB,MAAO+E,EACPuhB,YAAaT,EACbnX,MAAO,IACP6X,KAAM,SAIlB,+BACI,6BACI,qBAAKzkB,MAAO,CAAEqkB,YAAa,UAA3B,gCAEJ,6BACI,cAACE,GAAD,CACIrmB,MAAO0kB,EACP4B,YAAab,EACb/W,MAAO,IACP6X,KAAM,SAIlB,+BACI,6BACI,qBAAKzkB,MAAO,CAAEqkB,YAAa,UAA3B,sBAEJ,oBAAIrkB,MAAO,CAAE+W,QAAS,OAAQC,eAAgB,WAAYsN,WAAY,UAAtE,SACI,yBACI3kB,UAAU,cACVzB,MAAOgF,EACPwN,SAAU,SAAC3M,GAAD,OAAW8f,EAAY9f,EAAMuK,OAAOpQ,QAC9C8B,MAAO,CAAE4B,gBAAiB,UAAWhC,MAAO,QAJhD,UAMI,wBAAQ1B,MAAM,IAAd,eACA,wBAAQA,MAAM,KAAd,gBACA,wBAAQA,MAAM,IAAd,eACA,wBAAQA,MAAM,KAAd,gBACA,wBAAQA,MAAM,IAAd,eACA,wBAAQA,MAAM,IAAd,eACA,wBAAQA,MAAM,KAAd,gBACA,wBAAQA,MAAM,IAAd,eACA,wBAAQA,MAAM,KAAd,gBACA,wBAAQA,MAAM,IAAd,eACA,wBAAQA,MAAM,KAAd,gBACA,wBAAQA,MAAM,IAAd,uBAIZ,+BACI,6BACI,qBAAK8B,MAAO,CAAEqkB,YAAa,UAA3B,oCAEJ,oBAAIrkB,MAAO,CAAE+W,QAAS,OAAQC,eAAgB,YAA9C,SACI,uBAAO9X,KAAK,WACR8S,QAAS8Q,EACTpS,SAAU3P,KAAK+iB,8BAMzB,OAATzB,GAAiB,qBAAK1iB,UAAU,+BAA+BK,MAAO,CAAEJ,MAAO,QAA9D,SACd,sBAAKD,UAAU,cAAcK,MAAO,CAAEJ,MAAO,QAA7C,UACI,qDADJ,OAEKyiB,QAFL,IAEKA,OAFL,EAEKA,EAAMK,OAAO3kB,KAAI,SAAC4kB,EAAO/Z,GAAR,OACd,cAAC8Y,GAAD,CACI1gB,KAAM2hB,EAENxiB,MAAOyI,EACP+Y,UAAWA,GAFN/Y,WAQX,OAATyZ,GAAiB,gCACd,kCACI,+BACI,+CACA,uBACA,6BAAKW,OAET,+BACI,+CACA,uBACA,6BAAKS,OAET,+BACI,gDACA,uBACA,6BAAKV,mB,GAnSJ7gB,aAmWzB,SAASqiB,GAAY9kB,GACjB,IAAQ+kB,EAA8C/kB,EAA9C+kB,YAAatmB,EAAiCuB,EAAjCvB,MAArB,EAAsDuB,EAA1BmN,aAA5B,MAAoC,IAApC,IAAsDnN,EAAbglB,YAAzC,MAAgD,EAAhD,EACA,EAAwCrS,mBAASlU,GAAjD,oBAAOwmB,EAAP,KAAqBC,EAArB,KACMC,EAAYvD,GAAYqD,EAAc9X,GAQ5C,OAPA+F,qBAAU,WACN6R,EAAYI,KAEb,CAACA,IACJjS,qBAAU,WACNgS,EAAgBzmB,KACjB,CAACA,IACG,sBAAK8B,MAAO,CAAE+W,QAAS,OAAQC,eAAgB,YAA/C,UACH,wBACIzG,QAAS,kBAAMoU,EAAgBD,EAAeD,IAC9C9kB,UAAU,iBAFd,eAIA,uBACIT,KAAK,OACLhB,MAAOwmB,EACPhU,SAAU,SAAC1S,GAAD,OAAO2mB,EAAgB3mB,EAAEsQ,OAAOpQ,QAC1CyB,UAAU,aACVK,MAAO,CAAEikB,OAAQ,cAErB,wBACI1T,QAAS,kBAAMoU,EAAgBD,EAAeD,IAC9C9kB,UAAU,iBAFd,kBChYO,SAASklB,GAAcplB,GAClC,IAAQuB,EAAoBvB,EAApBuB,KAAMyM,EAAchO,EAAdgO,UACNqX,EAAwErX,EAAxEqX,YAAaC,EAA2DtX,EAA3DsX,YAAaC,EAA8CvX,EAA9CuX,aAAcC,EAAgCxX,EAAhCwX,aAAcC,EAAkBzX,EAAlByX,cACtDrT,EAA2B7Q,EAA3B6Q,QAASsT,EAAkBnkB,EAAlBmkB,cAEjB,OAAO,sBAAKxlB,UAAWkS,EAAU,+BAAiC,iBAA3D,UACH,sBAAKlS,UAAU,YAAf,UACI,mFAGA,wBAAQ4Q,QAASuU,EAAjB,sBAIJ,sBAAKnlB,UAAU,wBAAf,UACI,sBAAKA,UAAU,aAAf,UACI,wBACIiR,SAAmC,IAAzBuU,EAActiB,OACxB0N,QAAS,SAACvS,GACNA,EAAEonB,cAAcrR,OAChBgR,EAAY,QAEhBplB,UAAoC,IAAzBwlB,EAActiB,OAAe,2BAA6B,GANzE,kBAUA,yBACI+N,SAAmC,IAAzBuU,EAActiB,OACxB0N,QAAS,SAACvS,GACNA,EAAEonB,cAAcrR,OAChBgR,EAAY/jB,EAAKsF,QAErB3G,UAAoC,IAAzBwlB,EAActiB,OAAe,2BAA6B,GANzE,wBAQgB7B,EAAKsF,YAGzB,sBAAK3G,UAAU,aAAf,UACI,wBACIiR,SAAmC,IAAzBuU,EAActiB,OACxB0N,QAAS,SAACvS,GACNA,EAAEonB,cAAcrR,OAChBkR,GAAa,IAJrB,mBASA,wBACIrU,SAAmC,IAAzBuU,EAActiB,OACxB0N,QAAS,SAACvS,GACNA,EAAEonB,cAAcrR,OAChBkR,GAAa,IAJrB,uBAUJ,sBAAKtlB,UAAU,aAAf,UACI,wBACIiR,SAAmC,IAAzBuU,EAActiB,OACxB0N,QAAS,SAACvS,GACNA,EAAEonB,cAAcrR,OAChBiR,EAAa,QAJrB,mBASA,yBACIpU,SAAmC,IAAzBuU,EAActiB,OACxB0N,QAAS,SAACvS,GACNA,EAAEonB,cAAcrR,OAChBiR,EAAahkB,EAAKsF,QAJ1B,yBAOiBtF,EAAKsF,YAI1B,wBACIsK,SAAmC,IAAzBuU,EAActiB,OACxB0N,QAAS2U,EAFb,0B,IC/BGG,G,kDA5CX,WAAY5lB,GAAQ,IAAD,8BACf,cAAMA,IACDqB,MAAQ,GAFE,E,yDAMnB,SAAsB8J,EAAMD,GACxB,IAAI2a,GAAY,EAGhB,OADAA,GADAA,EAAYA,GAAYvkB,KAAKtB,MAAM8lB,SAAW3a,EAAK2a,QAAUxkB,KAAKtB,MAAMwC,WAAa2I,EAAK3I,WACjElB,KAAKtB,MAAM2B,aAAewJ,EAAKxJ,a,oBAG5D,WAAU,IAAD,SACE3B,EAASsB,KAATtB,MACCuB,EAA4BvB,EAA5BuB,KAAMukB,EAAsB9lB,EAAtB8lB,OAAOnkB,EAAe3B,EAAf2B,WACjBzB,EAAYzE,EAAWC,aACT,MAAdoqB,EAAO,KAAY5lB,GAAa,YAClB,MAAd4lB,EAAO,KAAY5lB,GAAa,YAClB,MAAd4lB,EAAO,KAAY5lB,GAAa,YACpC,IACIzD,GAAU,UAAAJ,EAAgBsF,UAAhB,eAA6BlF,UAAW,GACtD,OAAO,wBAAQqF,cAAe,kBAAM,EAAK9B,MAAM+lB,YAAYxkB,IAAOrB,UAAU,gBAArE,SACH,sBAAKA,UAAWA,EAAhB,UACI,qBACIkC,UAAU,QACVC,IAAKd,EAAK+Z,UAAUC,OACpBjZ,IAAKtC,EAAMuC,UACXhC,MAAO9D,IAIE,YAAZxB,GAAyB,cAAC,EAAD,CACtBiF,UAAU,mBAEd,qBAAKA,UAfa,wBAiBlB,qBAAKA,UAAuB,QAAZjF,EAAoB,gBAAkB,YAAtD,SACK+E,EAAMwC,oB,GAtCAC,aCFZuI,mBAAK,SAAqBhL,GACrC,IAAQmT,EAA6DnT,EAA7DmT,QAASxN,EAAoD3F,EAApD2F,SAAUqgB,EAA0ChmB,EAA1CgmB,cAAeC,EAA2BjmB,EAA3BimB,aAAcC,EAAalmB,EAAbkmB,SACxD,OAAO,mCACF/S,EAAQ7U,KAAI,SAAAC,GACT,OAAO,wBACHgC,MAAO,CAAE4B,gBAAiB5D,IAAMoH,EAAWqgB,EAAgB,IAC3D9lB,UAAW+lB,EACXnV,QAAS,kBAAMoV,EAAS3nB,IAHrB,SAMFA,GAFIA,WAMnB,SAACgV,EAAElL,GAAK,IAAD,IACL,OAAO,UAAAkL,EAAEJ,eAAF,eAAW/P,WAAX,UAAsBiF,EAAE8K,eAAxB,aAAsB,EAAW/P,SACjCmQ,EAAE5N,WAAa0C,EAAE1C,UACjB4N,EAAE2S,WAAa7d,EAAE6d,YC4DbC,G,kDAzEX,WAAYnmB,GAAQ,IAAD,8BACf,cAAMA,IACDqB,MAAQ,GAFE,E,0CAQnB,WACI,MAA4BC,KAAKtB,MAAzBuB,EAAR,EAAQA,KAAMyM,EAAd,EAAcA,UACVoY,EAAe7kB,EAAK8kB,cAAc9pB,MAAM+B,KAAI,SAACC,GAAD,OAAOA,EAAEmC,SACrD4lB,EAAiB/kB,EAAKglB,UAAY,UAAY,GAC9C3V,EAAgB,WAGpB,OAFoC,KAAhCrP,EAAKwL,SAASkD,OAAO7M,SAAewN,GAAiB,eACrB,IAAhCrP,EAAKwL,SAASkD,OAAO7M,SAAcwN,GAAiB,eACjD,gCACH,sBAAK1Q,UAAW0Q,EAAhB,UACiC,IAAhCrP,EAAKwL,SAASkD,OAAO7M,OAAe,qBAAKlD,UAAU,UAAf,wBAA4C,KAC5EqB,EAAKwL,SAASkD,OAAO3R,KAAI,SAAC3C,EAAMwN,GAC7B,IAAIzI,EAAQ0lB,EAAa3e,QAAQ0B,GAC7B3G,EAAW,GACXD,EAAY,GAChB,IACIA,EAAYzD,EAAayC,EAAKwL,SAASkD,OAAO7M,QAAQzH,EAAK+E,OAClC,cAAtBa,EAAKmQ,eAA8BlP,EAAWtE,EAASjD,GAASyD,EAAS+I,QAAQlG,EAAKkC,QAAQ9H,EAAK+E,QAC7E,oBAAtBa,EAAKmQ,eAAoClP,EAAW3E,EAAW0D,EAAKwL,SAASkD,OAAO7M,QAAQtF,eAAenC,EAAK+E,QAC1F,aAAtBa,EAAKmQ,eAA6BlP,EAAW3E,EAAW0D,EAAKwL,SAASkD,OAAO7M,QAAQpF,aAAarC,EAAK+E,QAC7G,MAAMnC,IACP,OAAO,cAAC,GAAD,CAEHunB,OAAQplB,GAAS,EAAIa,EAAK8kB,cAAc9pB,MAAMmE,GAAOmG,MAAQ,MAC7DtF,KAAM5F,EACN6G,SAAUA,EACVb,WAAYJ,EAAKwL,SAASwE,eAC1BhP,UAAS,8BAAyBA,EAAzB,QACTwjB,YAAa/X,EAAUhM,aANlBrG,EAAK+E,aAUtB,sBAAKR,UAAW,uBAAyBomB,EAAzC,UACI,sBAAKpmB,UAAW,wBAAhB,UACI,qBAAKA,UAAU,oBAAf,mBAGA,cAAC,GAAD,CACI+lB,aAAc,eACdD,cAAe,UACf7S,QAAS,CAAC,EAAG,EAAG,GAChB+S,SAAUlY,EAAUwY,YACpB7gB,SAAUpE,EAAKsF,WAGvB,sBAAK3G,UAAU,yBAAf,UACI,qBAAKA,UAAU,oBAAf,mBAGCqB,EAAKgE,cAAcjH,KAAI,SAACC,GACrB,OAAO,wBAEHuS,QAAS,kBAAM9C,EAAUyY,mBAAmBloB,IAC5CgC,MAAO,CAAE4B,gBAAiB,IAAM5D,EAAEe,MAAMonB,SAAS,KAH9C,SAKFnoB,EAAE2F,MAJE3F,EAAE0D,oB,GA3DJQ,a,0BCDvBzD,GAA6ED,EAA7EC,SAAUI,GAAmEL,EAAnEK,oBAAqBC,GAA8CN,EAA9CM,UAAWE,GAAmCR,EAAnCQ,kBAAmBC,GAAgBT,EAAhBS,YAExDmnB,GACT,WAAYxmB,EAAOC,GAA0C,IAAD,OAAjCokB,EAAiC,uDAAxB,EAAGoC,EAAqB,uDAAJ,GAAI,yBAsB5DC,QAAU,WACN,EAAKC,IAAID,WAvB+C,KAyB5DE,SAAW,WACPxhB,EAAczB,SAAQ,SAAAiC,GAClB,IAAIihB,EAASC,GAAWlhB,EAAc,EAAM,GAC5C,EAAK8N,MAAMnO,QAAQrC,KAAK2jB,EAAOE,gBAEnC7nB,GAAUyE,SAAQ,SAAAqjB,GACd,IAAIH,EAASC,GAAWE,EAAgB,EAAM,GAC9C,EAAKtT,MAAMuT,SAAS/jB,KAAK2jB,EAAOE,gBAEpC7nB,GAAUyE,SAAQ,SAAAqjB,GACd,IAAIH,EAASC,GAAWE,EAAgB,EAAM,GAC9C,EAAKtT,MAAMwT,eAAehkB,KAAK2jB,EAAOE,gBAE1C3nB,GAAkBuE,SAAQ,SAAAnI,GACtB,IAAI2rB,EAAY,EAAKC,UAAY,GAAK,EAAI,EACtCP,EAAShiB,SAASC,cAAc,UACpC+hB,EAAO5mB,OAAS,EAAKonB,WACrBR,EAAO7mB,MAAQ,EAAKonB,UACpB,IAAIE,EAAMT,EAAOU,WAAW,MA4B5B,GA3BgB,MAAZ/rB,EAAK,KACL8rB,EAAIE,UAAY3oB,GAASC,WACzB2oB,GACIH,EACA,EAAKjD,OAAS,EACd,EAAKA,OAAS,EACd,EAAK+C,UAAY,EAAK/C,OAAS,EAC/B,EAAKgD,WAAa,EAAKhD,OAAS,EAChC8C,GACA,GACA,IAGQ,MAAZ3rB,EAAK,KACL8rB,EAAII,YAAc7oB,GAASE,OAC3BuoB,EAAIK,UAAY,EAChBF,GACIH,EACA,EAAKjD,OAAS,EACd,EAAKA,OAAS,EACd,EAAK+C,UAAY,EAAK/C,OAAS,EAC/B,EAAKgD,WAAa,EAAKhD,OAAS,EAChC8C,GACA,GACA,IAGQ,MAAZ3rB,EAAK,GAAY,CACjB8rB,EAAIM,YACJN,EAAIE,UAAY3oB,GAASG,OACzB,IAAI6oB,EAAa,EAAKR,WAAa,EACnCC,EAAIQ,IAAI,EAAKV,UAAY,EAAI,GAAK,EAAKC,WAAa,EAAI,GAAKQ,EAAY,EAAG,EAAIpnB,KAAKsnB,IACrFT,EAAIxnB,OAER,EAAK4T,MAAMtX,MAAMZ,GAAQqrB,EAAOE,eAEpC3hB,EAAczB,SAAQ,SAAAiC,GAClB,IAAIihB,EAASC,GAAWlhB,EAAc,EAAM,GAC5C,EAAK8N,MAAMsU,cAAc9kB,KAAK2jB,EAAOE,gBAEzC1nB,GAAYsE,SAAQ,SAAAskB,GAChB,IAAIpB,EAAShiB,SAASC,cAAc,UACpC,GAAwB,UAApBmjB,EAAW3oB,KAAkB,CAC7B,IAAI2N,EAAO,EAAKwZ,eAAiB,EACjCI,EAAO5mB,OAAS,EAAKwmB,eACrBI,EAAO7mB,MAAe,EAAPiN,EACf,IAAIqa,EAAMT,EAAOU,WAAW,MAC5BD,EAAIE,UAAYS,EAAW9oB,MAC3BmoB,EAAIQ,IAAI7a,EAAM,EAAKwZ,eAAiB,EAAGxZ,EAAM,EAAG,EAAIxM,KAAKsnB,IACzDT,EAAIxnB,OACJ,EAAK4T,MAAMrU,YAAY6D,KAAK2jB,EAAOE,iBAChC,CACHF,EAAO5mB,OAAS,EAAKA,OACrB4mB,EAAO7mB,MAAQ,EAAKA,MACpB,IAAIsnB,EAAMT,EAAOU,WAAW,MAC5BD,EAAIE,UAAYS,EAAW9oB,MAM3BmoB,EAAIM,YACJN,EAAIY,OAAO,EAAG,EAAKjoB,QACnBqnB,EAAIa,OAAO,EAAKf,UAAY,EAAG,EAAKnnB,QACpCqnB,EAAIa,OAAO,EAAG,EAAKloB,OAAS,EAAKonB,YACjCC,EAAIxnB,OACJwnB,EAAIM,YACJN,EAAIY,OAAO,EAAKloB,MAAO,EAAKC,QAC5BqnB,EAAIa,OAAO,EAAKf,UAAY,EAAG,EAAKnnB,QACpCqnB,EAAIa,OAAO,EAAKnoB,MAAO,EAAKC,OAAS,EAAKonB,YAC1CC,EAAIxnB,OACJwnB,EAAIM,YACJN,EAAIY,OAAO,EAAG,GACdZ,EAAIa,OAAO,EAAKf,UAAY,EAAG,GAC/BE,EAAIa,OAAO,EAAG,EAAKd,YACnBC,EAAIxnB,OACJwnB,EAAIM,YACJN,EAAIY,OAAO,EAAKloB,MAAO,GACvBsnB,EAAIa,OAAO,EAAKf,UAAY,EAAG,GAC/BE,EAAIa,OAAO,EAAKnoB,MAAO,EAAKqnB,YAC5BC,EAAIxnB,OAEJ,EAAK4T,MAAMrU,YAAY6D,KAAK2jB,EAAOE,kBA7H3C5lB,KAAKnB,MAAQA,EACbmB,KAAKlB,OAASA,EACdkB,KAAKuS,MAAQ,CACTnO,QAAS,GACTnJ,MAAO,GACP6qB,SAAU,GACVe,cAAe,GACfd,eAAgB,GAChB7nB,YAAa,IAEjB8B,KAAKinB,aAAe,GACpBjnB,KAAKslB,eAAiBA,EACtBtlB,KAAKkjB,OAASA,EACdljB,KAAKimB,UAAYjmB,KAAKnB,MACtBmB,KAAKkmB,WAAalmB,KAAKlB,OAAShE,EAChCkF,KAAKwlB,IAAM,IAAI0B,KAAiB,CAC5BroB,MAAOA,EACPC,OAAQA,IAEZkB,KAAKylB,YAiHb,SAASE,GAAWlhB,EAAcoC,EAAMsgB,GACpC,IAAIzB,EAAShiB,SAASC,cAAc,UACpC+hB,EAAO5mB,OAAS+H,EAAK/H,OACrB4mB,EAAO7mB,MAAQgI,EAAKhI,MACpB,IAAIsnB,EAAMT,EAAOU,WAAW,MAC5BD,EAAIE,UAAY,IAAM5hB,EAAazG,MAAMonB,SAAS,IAClDe,EAAIiB,SAAS,EAAG,EAAGvgB,EAAKhI,MAAOgI,EAAK/H,QACpCqnB,EAAII,YAA8B,IAAhBY,EAAoB,QAAU,UAChDhB,EAAIK,UAAYW,EAChBhB,EAAIM,YACJN,EAAIY,OAAOlgB,EAAKhI,MAAO,GACvBsnB,EAAIa,OAAOngB,EAAKhI,MAAOgI,EAAK/H,QAC5BqnB,EAAIkB,SACJlB,EAAII,YAAc,UAClB,IAAK,IAAI1e,EAAI,EAAGA,EAAI,EAAGA,IAAK,CACxBse,EAAIK,UAAY,EAChB,IAAIc,EAAIzgB,EAAKqf,WAAapoB,GAAsB+J,EAChDse,EAAIY,OAAO,EAAGO,GACdnB,EAAIa,OAAOngB,EAAKhI,MAAOyoB,GAG3B,OADAnB,EAAIkB,SACG3B,EAGX,SAASY,GAAUH,EAAKoB,EAAGD,EAAGzoB,EAAOC,EAAQ0oB,EAAQ7oB,EAAM0oB,GAOvD,GANsB,qBAAXA,IACPA,GAAS,GAES,qBAAXG,IACPA,EAAS,GAES,kBAAXA,EACPA,EAAS,CAAEC,GAAID,EAAQE,GAAIF,EAAQG,GAAIH,EAAQI,GAAIJ,OAChD,CACH,IAAIK,EAAgB,CAAEJ,GAAI,EAAGC,GAAI,EAAGC,GAAI,EAAGC,GAAI,GAC/C,IAAK,IAAIE,KAAQD,EACbL,EAAOM,GAAQN,EAAOM,IAASD,EAAcC,GAGrD3B,EAAIM,YACJN,EAAIY,OAAOQ,EAAIC,EAAOC,GAAIH,GAC1BnB,EAAIa,OAAOO,EAAI1oB,EAAQ2oB,EAAOE,GAAIJ,GAClCnB,EAAI4B,iBAAiBR,EAAI1oB,EAAOyoB,EAAGC,EAAI1oB,EAAOyoB,EAAIE,EAAOE,IACzDvB,EAAIa,OAAOO,EAAI1oB,EAAOyoB,EAAIxoB,EAAS0oB,EAAOG,IAC1CxB,EAAI4B,iBAAiBR,EAAI1oB,EAAOyoB,EAAIxoB,EAAQyoB,EAAI1oB,EAAQ2oB,EAAOG,GAAIL,EAAIxoB,GACvEqnB,EAAIa,OAAOO,EAAIC,EAAOI,GAAIN,EAAIxoB,GAC9BqnB,EAAI4B,iBAAiBR,EAAGD,EAAIxoB,EAAQyoB,EAAGD,EAAIxoB,EAAS0oB,EAAOI,IAC3DzB,EAAIa,OAAOO,EAAGD,EAAIE,EAAOC,IACzBtB,EAAI4B,iBAAiBR,EAAGD,EAAGC,EAAIC,EAAOC,GAAIH,GAC1CnB,EAAI6B,YACArpB,GACAwnB,EAAIxnB,OAEJ0oB,GACAlB,EAAIkB,SCxLZ,IAAIY,GAAwB,GAEPC,G,kDACjB,WAAYxpB,GAAQ,IAAD,uBACf,cAAMA,IAiCVypB,iBAAmB,SAAClrB,GAChB,EAAKmrB,eAAgB,EACrB,EAAKC,gBAAiB,EACtB,EAAKC,qBAAuB,GArCb,EAkDnB9a,eAAiB,SAACxK,GAEd,OADUA,EAAM6K,MAEZ,IAAK,aAAc,EAAK0a,kBAAkB,GACtC,MACJ,IAAK,YAAa,EAAKA,mBAAmB,KAvD/B,EA6DnBC,YAAc,SAACvrB,GACX,EAAKyB,MAAMgO,UAAU+b,aAAa,EAAK/pB,MAAMuB,KAAKoE,SAAW/E,KAAKopB,KAAKzrB,EAAE0rB,SAAS,IA9DnE,EAgEnBjoB,YAAc,SAACzD,EAAGkB,GACd,IAAMopB,EAAItqB,EAAEgD,KAAK2oB,OAAOrB,EAChB1oB,EAAU,EAAKkB,MAAflB,MACAoB,EAAS,EAAKvB,MAAduB,KAIR,GAHa,OAAT9B,IACA,EAAKkqB,gBAAiB,GAEb,SAATlqB,EAAiB,CACjB,EAAKkqB,gBAAiB,EACtB,IAAMQ,EAAsBhqB,EAAQoB,EAAKmE,QAAQtC,OAC3CgnB,EAAYD,GAAuBZ,GAAwB,GAC3Dc,EAAgBF,EAAsB5oB,EAAKoE,SAAY4jB,GAAwB,EAAKY,EAC1F,EAAKG,SAAWzB,EAAIwB,GAAiBxB,EAAIwB,EAAgBD,EACzD,EAAKG,aAAeF,EAAgBD,EAAY,EAAIvB,EACpD,EAAK2B,eAAiBtkB,OAAOukB,iBAC7B,EAAKC,YAAYnsB,GAER,cAATkB,IACA,EAAKmqB,qBAAuBf,EAC5B,EAAKa,eAAgB,IAnFV,EAsFnBiB,iBAAmB,SAACpsB,GAChB,IAAIsqB,EAAItqB,EAAEgD,KAAK2oB,OAAOrB,EACtB,IAA2B,IAAvB,EAAKa,cAAwB,CAC7B,GAAI,EAAKc,iBAAmB,EAAG,OAC/B,EAAKA,eAAiB,EACtB,MAA4B,EAAKxqB,MAAzBuB,EAAR,EAAQA,KAAMyM,EAAd,EAAcA,UACR9E,EAAS0hB,GAAMhqB,KAAKiqB,KAAKjqB,KAAKkqB,IAAI,EAAKlB,qBAAuBf,GAAK,GAAI,EAAG,GAC1EmB,EAAO,EAAKJ,qBAAuBf,GAAK,EAAI,EAClD,EAAKe,qBAAuBf,EAC5B,IAAMkC,EAAcxpB,EAAKoE,SAAWqkB,EAAO9gB,EAC3C,GAAI3H,EAAKoE,WAAaolB,EAAa,OACnC/c,EAAU+b,aAAaa,GAAMG,EAAa,EAAGxpB,EAAKmE,QAAQtC,OAAS,IAAI,KAjG5D,EAoGnBymB,kBAAoB,SAACmB,GACjB,MAA2C,EAAKhrB,MAAMuB,KAA9CoE,EAAR,EAAQA,SAAUD,EAAlB,EAAkBA,QAASlG,EAA3B,EAA2BA,YACvB4oB,EAA2B,IAAd4C,EACXxrB,EAAY9C,QAAO,SAACuuB,GAAD,OAAOA,EAAItlB,KAAUie,MAAK,SAACtY,EAAGwV,GAAJ,OAAUxV,EAAIwV,KAC3DthB,EAAY9C,QAAO,SAACuuB,GAAD,OAAOA,EAAItlB,KAAUie,MAAK,SAACtY,EAAGwV,GAAJ,OAAUA,EAAIxV,KACvC,IAAtB8c,EAAWhlB,QACXsC,EAAQtC,QAAUglB,EAAW,IAAMA,EAAW,IAAM,GACpD,EAAKpoB,MAAMgO,UAAU+b,aAAa3B,EAAW,KA3GlC,EA8GnBsC,YAAc,SAACnsB,GACX,IAAM2sB,EAAU3sB,EAAEgD,KAAK2oB,OAAOrB,EAC9B,GAAI,EAAKc,eAAgB,CACrB,GAAI,EAAKa,iBAAmB,EAAG,OAC/B,MAA0B,EAAKnpB,MAAvBlB,EAAR,EAAQA,MAAO0F,EAAf,EAAeA,OACPtE,EAAS,EAAKvB,MAAduB,KACR,EAAK4pB,WAAY,EACjB,EAAKX,eAAiB,EACtB,IAAMY,EAAavlB,EAAO1F,MAAQoB,EAAKmE,QAAQtC,OACzCylB,EAAI,EAAKyB,SAAYY,EAAU,EAAKX,aAAgBW,EACtDG,EAAczqB,KAAKC,MAAMgoB,EAAI1oB,EAAQirB,EAAavlB,EAAO1F,OAC7D,EAAKH,MAAMgO,UAAU+b,aAAasB,GAAa,KAvHnD,IAAIC,EAAQtmB,SAASE,KAAKqmB,wBAC1B,EAAKD,MAAQA,EACb/B,GAAwBrjB,OAAO,EAAKlG,MAAMuB,KAAKkW,SAASwB,iBAAiBxa,OACzE,IAsRoB+sB,EAtRhBrrB,EAAQsrB,GAA0B,IAAdH,EAAMnrB,OAC1BC,EAASqrB,GAA2B,IAAfH,EAAMlrB,QAE3BpE,OAAO0vB,OAAOvrB,MAAQmrB,EAAMlrB,SAC5BD,EAAQsrB,GAA2B,IAAfH,EAAMlrB,QAC1BA,EAASqrB,GAA0B,IAAdH,EAAMnrB,QAEf,QAAZlF,IAAmBmF,EAASqrB,GAAqB,IAATrrB,IAC5C,EAAKiB,MAAQ,CACTlB,MAAOS,KAAKC,MAAMV,GAClBC,OAAQQ,KAAKC,MAAMT,GACnByF,OAAQ,CACJ1F,OA0QYqrB,EA1QcC,GAAYtrB,GA2Q3CsrB,GAAYD,EAAcjC,KA1QrBnpB,OAAQA,GAEZwmB,eAAgB9U,OAAa,GAAK,GAClC6Z,mBAAoB,GAExB,EAAKC,UAAYC,IAAMC,YACvB,IAAItH,EAAS1S,OAAa,EAAI,EAxBf,OAyBf,EAAK+B,MAAQ,IAAI8S,GAAc,EAAKtlB,MAAMwE,OAAO1F,MAAOC,EAAQokB,EAAQ,EAAKnjB,MAAMulB,gBACnF,EAAK8C,eAAgB,EACrB,EAAKC,gBAAiB,EACtB,EAAKwB,WAAY,EACjB,EAAKvB,qBAAuB,EAC5B,EAAKW,aAAe,EACpB,EAAKC,eAAiB,EACtB,EAAKF,UAAW,EAhCD,E,qDAuCnB,WACItuB,OAAOqU,iBAAiB,YAAa/O,KAAKmoB,kBAC1CztB,OAAOqU,iBAAiB,UAAW/O,KAAKwN,gBACxCxN,KAAKsqB,UAAUG,QAAQC,QAAQ3b,iBAAiB,QAAS/O,KAAKwoB,e,kCAElE,WACI9tB,OAAOyU,oBAAoB,YAAanP,KAAKmoB,kBAC7CztB,OAAOyU,oBAAoB,UAAWnP,KAAKwN,gBAC3CxN,KAAKsqB,UAAUG,QAAQC,QAAQvb,oBAAoB,QAASnP,KAAKwoB,aACjExoB,KAAKuS,MAAMgT,Y,oBA6Ef,WAAU,IAAD,OACL,EAA0CvlB,KAAKD,MAAvClB,EAAR,EAAQA,MAAOymB,EAAf,EAAeA,eAAgBxmB,EAA/B,EAA+BA,OAC/B,EAA4BkB,KAAKtB,MAAzBuB,EAAR,EAAQA,KAAMyM,EAAd,EAAcA,UACR6F,EAAQvS,KAAKuS,MAAMA,MACnByX,EAAQhqB,KAAKD,MAAMwE,OACnBomB,GAAQ1qB,EAAKoE,SAAW4jB,GAAwB,EAAI,IAAO+B,EAAMnrB,MACjE6Y,EAAY9S,OAAO3E,EAAKkW,SAASuB,UAAUva,OAC3CytB,EAA6B,IAAdlT,EAAkB,GAAK,EAAIA,EAAY,EACtDmR,EAAsBhqB,EAAQoB,EAAKmE,QAAQtC,OAC7C+oB,GAAW,EACXC,EAAU,EACVhC,EAAYxpB,KAAKC,MAAMspB,GAAuBZ,GAAwB,IACtEa,EAAYjqB,IAAOiqB,EAAYjqB,GACnC,IAAMkqB,EAAgBF,EAAsB5oB,EAAKoE,UAAY4jB,GAAwB,EAAI,GAAKY,EAC9F,OAAO,sBAAKjqB,UAAU,iBAAiBK,MAAO,CAAEJ,MAAOA,EAAQ,GAAxD,UACH,cAAC,SAAD,CACIA,MAAOA,EACPC,OAAQA,EACRisB,KAAK,EACLC,yBAAyB,EACzBnZ,QAAS,CACLhR,gBAAiB,SAGrBoqB,IAAKjrB,KAAKsqB,UATd,SAWI,cAAC,aAAD,CACIvP,OAAQ,CAAC,GAAK,IACdwM,EAAGoD,EACHO,aAAa,EACbC,YAAa,SAACluB,GAAD,OAAO,EAAKyD,YAAYzD,EAAG,cACxCmuB,YAAa,SAACnuB,GAAD,OAAO,EAAKosB,iBAAiBpsB,IAL9C,SAOKgD,EAAKmE,QAAQpH,KAAI,SAACuH,EAAQsD,GAKvB,GAJIijB,IAAYF,IACZC,GAAYA,EACZC,EAAU,IAkItC,SAAmBO,EAAKC,GACpB,IAAIxiB,EAAYmf,GAAwB,EAAI,EACxCsD,EAAa,CAACD,EAAaxiB,EAAWwiB,EAAaxiB,GACvD,OAAOyiB,EAAW,GAAKF,GAAOA,EAAME,EAAW,GAnItBC,CAAU3jB,EAAG5H,EAAKoE,UAAW,OAAO,KACzC,IAAMonB,GAAsB5jB,EAAI,GAAK,IAAM,EAAI0K,EAAMsU,cAAgBtU,EAAMnO,QACrEsnB,GAAiB7jB,EAAI,GAAK,IAAM,EAAI0K,EAAMwT,eAAiBxT,EAAMuT,SACjEnoB,EAAqC,IAAxB4G,EAAOE,aAAqBinB,EAAc9mB,OAAOimB,IAAaY,EAAmBlnB,EAAOE,cAC3G,OAAO,cAAC,GAAD,CACH8N,MAAOA,EAEPtS,KAAMsE,EACNnF,MAAOyI,EACPmiB,MAAOA,EACP2B,gBAAiBhuB,EACjBiuB,gBAAiB3rB,EAAK4rB,aAAaplB,SAASoB,GAC5C9D,MAAO2I,EAAU+b,aACjBqD,WAAYjkB,IAAM5H,EAAKoE,SACvB0nB,aAAc9rB,EAAK/B,YAAYuI,SAASoB,IARnCA,SArBZ7H,KAAKD,MAAMlB,OAoCpB,sBAAKD,UAAU,mBAAmBK,MAAO,CAAEH,OAAQkB,KAAKD,MAAMulB,gBAA9D,UACI,qBAAK1mB,UAAU,kBAAkB4Q,QAAS,kBAAM,EAAK+Y,mBAAmB,IAAxE,SACI,cAAC9Y,GAAD,UACI,cAAC,IAAD,QAGR,qBAAK7Q,UAAU,kBAAkB4Q,QAAS,kBAAM,EAAK+Y,kBAAkB,IAAItpB,MAAO,CAAEiX,WAAY,GAAhG,SACI,cAACzG,GAAD,UACI,cAAC,IAAD,QAGR,qBAAK7Q,UAAU,kBAAf,SACI,eAAC,SAAD,CACIC,MAAOA,EACPC,OAAQwmB,EACRzT,QAAS,CAAEma,WAAW,EAAMC,aAAa,EAAMprB,gBAAiB,SAChEkqB,KAAK,EACLC,yBAAyB,EAL7B,UAOI,eAAC,aAAD,CACInsB,MAAOA,EACPC,OAAQwmB,EACR4F,aAAa,EACbC,YAAa,SAACluB,GAAD,OAAO,EAAKyD,YAAYzD,EAAG,SACxCivB,UAAW,SAACjvB,GAAD,OAAO,EAAKyD,YAAYzD,EAAG,OACtCmuB,YAAaprB,KAAKopB,YANtB,UAQI,cAAC,YAAD,CAAU+C,KAAM,SAAClvB,IA0B7C,SAAemvB,EAAGvtB,EAAOC,GACrBstB,EAAEC,QACFD,EAAEE,UAAU,QAAU,GACtBF,EAAEG,SAAS,EAAG,EAAG1tB,EAAOC,GA7ByB0tB,CAAMvvB,EAAG4B,EAAOymB,MACxCrlB,EAAK/B,YAAYlB,KAAI,SAAA8pB,GAClB,OAAO,cAAC,UAAD,CACH2F,MAAOla,EAAMrU,YAAY,GAEzBqpB,EAAGsB,EAAsB/B,GADpBA,SAMjB,cAAC,YAAD,CAAUqF,KAAM,SAAClvB,GAAD,OAsBxC,SAAmBmvB,EAAGvtB,EAAOC,GACzBstB,EAAEC,QACFD,EAAEM,UAAU,EAAG,QAAU,IACzBN,EAAEO,gBAAgB,EAAG,EAAG9tB,EAAQ,EAAGC,EAAS,EAAG,GAzBJ8tB,CAAU3vB,EAAG6rB,EAAWxD,IAAiBiC,EAAGwB,EAAezB,EAAG,SAG7F,qBAAK1oB,UAAU,kBAAkB4Q,QAAS9C,EAAUmgB,iBAApD,SACI,cAACpd,GAAD,UACKxP,EAAK/B,YAAYuI,SAASxG,EAAKoE,UAC1B,cAAC,IAAD,GAAmB,SACnB,cAAC,IAAD,GAAkB,sB,GArOJlD,aA0P5C,SAASqD,GAAO9F,GACZ,IAAMuB,EAAiGvB,EAAjGuB,KAAMb,EAA2FV,EAA3FU,MAAO4qB,EAAoFtrB,EAApFsrB,MAAOjmB,EAA6ErF,EAA7EqF,MAAOwO,EAAsE7T,EAAtE6T,MAAOoZ,EAA+DjtB,EAA/DitB,gBAAiBI,EAA8CrtB,EAA9CqtB,aAAcD,EAAgCptB,EAAhCotB,WAAYF,EAAoBltB,EAApBktB,gBACnF,OAAO,eAAC,aAAD,CACHkB,WAAY,kBAAM/oB,EAAM3E,IACxB8rB,aAAa,EACb3D,EAAGyC,EAAMnrB,MAAQO,EAHd,UAKH,eAAC,UAAD,CACIqtB,MAAOd,EACPoB,qBAAqB,EAFzB,UAIKjB,GAAcF,EAAkB,cAAC,UAAD,CAC7Ba,MAAOb,IAAoBE,EAAavZ,EAAMuT,SAAS,GAAKvT,EAAMuT,SAAS,GAC3EkH,MAAOpB,EAAkB,GAAM,GAC/BqB,OAAQ,IAEA,KACXlB,EAAe,cAAC,UAAD,CACZU,MAAOla,EAAMrU,YAAY,KAEjB,QAEf+B,EAAKhF,MAAM+B,KAAI,SAAC3C,GACb,OAAO,cAAC,UAAD,CAEHoyB,MAAOla,EAAMtX,MAAMZ,EAAKkL,OACxB+hB,EAAGjqB,EAAsBhD,EAAK+E,OAAS4qB,EAAMlrB,OAAShE,GAFjDT,EAAK+E,aAS1B,IAAMkqB,GAAQ,SAAC4D,EAAKxd,EAAKE,GAAX,OAAmBtQ,KAAKoQ,IAAIpQ,KAAKsQ,IAAIsd,EAAKxd,GAAME,IAK9D,SAASua,GAAY+C,GACjB,OAAO,EAAI5tB,KAAK6tB,MAAMD,EAAM,GClGhC,SAASrX,GAAQnX,GACb,IAAQuB,EAAoBvB,EAApBuB,KAAMyM,EAAchO,EAAdgO,UACN8J,EAAmD9J,EAAnD8J,WAAYxC,EAAuCtH,EAAvCsH,WAAYyO,EAA2B/V,EAA3B+V,SAAU5N,EAAiBnI,EAAjBmI,aAC1C,OAAO,sBAAKjW,UAAU,WAAf,UACH,qBAAKA,UAAU,YAAY4Q,QAAS,WAChCiT,EAASxiB,GACT+T,GAAW,IAFf,SAIK/T,EAAK/C,OAEV,sBAAK0B,UAAU,uBAAf,UACI,wBAAQA,UAAU,cAAc4Q,QAAS,kBAAMqF,EAAa5U,IAA5D,SACI,cAACwP,GAAD,UACI,cAAC,IAAD,QAGR,wBAAQ7Q,UAAU,cAAc4Q,QAAS,kBAAMgH,EAAWvW,EAAK/C,OAA/D,SACI,cAACuS,GAAD,UACI,cAAC,IAAD,CAASzR,MAAM,sBASpB+U,O,kDAzNX,WAAYrU,GAAQ,IAAD,8BACf,cAAMA,IAaV8O,eAAiB,SAACxK,GAAW,IAAD,EACpBpC,EAAMoC,EAAM6K,KAChB,GAAuC,UAAnCnK,SAASgK,cAAcC,UAC3B,UAAAjK,SAASgK,qBAAT,SAAwBsF,OAEf,WADDpS,GAEI,EAAKb,MAAMkT,MAAM,EAAKvU,MAAMgO,UAAU0gB,oBAC1C,EAAKjjB,SAAS,CAAE8I,MAAM,KArBf,EA2BnBe,WAAa,SAAChH,GACc,mBAAbA,IAAwBA,OAAW/J,GAC9C,IAAIgR,OAAwBhR,IAAb+J,EAAyBA,GAAY,EAAKjN,MAAMkT,KAC/D,EAAK9I,SAAS,CACV8I,KAAMgB,KAEO,IAAbA,GACA,EAAKvV,MAAMgO,UAAU0gB,qBAlCV,EAqCnB/Y,uBAAyB,SAACnX,GACtB,EAAKiN,SAAS,CACVmK,iBAAkBpX,KAvCP,EA0CnBgX,eAAiB,SAACC,GACd,GAAIA,IAAc,EAAKpU,MAAMqU,cAAgB,EAAKrU,MAAMkT,KACpD,OAAO,EAAK9I,SAAS,CACjB8I,MAAM,IAGd,EAAK9I,SAAS,CACViK,aAAcD,EACdlB,MAAM,KAlDK,EAqDnB4B,aAAe,SAACvT,GACRA,EAAKwT,YAAYxT,EAAKwT,IACtBxT,EAAKrB,KAAKoC,oBACVf,EAAO+D,GAA0B/D,IAErC,IAAIyT,EAAWzT,EAAKpE,KACJ,QAAZvD,IAEA2H,EAAOkE,GAAoBlE,IAE1BgD,MAAMkC,QAAQlF,KAAOA,EAAO,CAACA,IAClCA,EAAKkB,SAAQ,SAAAwS,GACTA,EAAM/U,KAAKtG,QAAUA,KAEzB,IAAIiZ,EAAOvU,KAAKqH,UAAUpE,IACL,IAAI8B,GACVC,SAASuP,EAAxB,UAAiCmC,EAAjC,YAA6Cpb,EAAQsb,cAArD,eACA,IAAIvS,EAAY,UAAW,mBAAmBI,WAtE/B,EAwEnBuqB,WAAa,WACX,EAAK3uB,MAAMgO,UAAU2gB,WAAW,EAAK3uB,MAAMuB,KAAKqtB,cAvE9C,EAAKvtB,MAAQ,CACTkT,MAAM,EACNmB,aAAc,WACdE,iBAAkB,YALP,E,qDAQnB,WACI5Z,OAAOqU,iBAAiB,UAAW/O,KAAKwN,kB,kCAE5C,WACI9S,OAAOyU,oBAAoB,UAAWnP,KAAKwN,kB,oBA+D/C,WAAU,IAAD,OACL,EAA4BxN,KAAKtB,MAAzBuB,EAAR,EAAQA,KAAMyM,EAAd,EAAcA,UACV8I,EAAYxV,KAAKD,MAAMkT,KAAO,sBAAwB,YACtDmB,EAAepU,KAAKD,MAAMqU,aACtBqO,EAA6G/V,EAA7G+V,SAAUjM,EAAmG9J,EAAnG8J,WAAYd,EAAuFhJ,EAAvFgJ,WAAYD,EAA2E/I,EAA3E+I,oBAAqBrE,EAAsD1E,EAAtD0E,aAAcmc,EAAwC7gB,EAAxC6gB,cAAetK,EAAyBvW,EAAzBuW,qBACxFuK,EAAgB,CAChB/K,SAAUA,EACVjM,WAAYA,EACZxC,WAAYhU,KAAKgU,WACjBa,aAAc7U,KAAK6U,cAEnBO,EAAQnV,EAAKmV,MAAMha,QAAO,SAAAkG,GAAI,cAAI,UAACA,EAAKrB,YAAN,aAAC,EAAWoC,sBAC9CsT,EAAgB1V,EAAKmV,MAAMha,QAAO,SAAAkG,GAAI,uBAAIA,EAAKrB,YAAT,aAAI,EAAWoC,qBACrDorB,EAAaxtB,EAAK+K,WAAa,4BAA8B,kBAC7D0iB,EAAYztB,EAAK0tB,SAAW,oBAAsB,OACtD,OAAO,sBAAK/uB,UAAU,eAAf,UACH,sBAAKA,UAAW8uB,EAAhB,UACI,cAAC3c,GAAD,CAAWH,OAAQ5Q,KAAKgU,aACxB,cAAC,GAAD,CAAU7V,KAAK,OAAOyS,OAAQ5Q,KAAKqtB,WAAYzuB,UAAW6uB,EAA1D,SACI,cAAChe,GAAD,UACI,cAAC,IAAD,CAAQ7Q,UAAU,aAG1B,cAAC,GAAD,CAAUT,KAAK,QAAQyS,OAAQ5Q,KAAKkU,eAApC,SACI,cAACzE,GAAD,UACI,cAAC,IAAD,CAAS7Q,UAAU,aAG3B,cAAC,GAAD,CAAUT,KAAK,WAAWyS,OAAQ5Q,KAAKkU,eAAvC,SACI,cAACzE,GAAD,UACI,cAAC,IAAD,CAAO7Q,UAAU,aAGzB,cAAC,GAAD,CAAUT,KAAK,OAAOyS,OAAQ,kBAAM8E,EAAW,SAA/C,SACI,cAACjG,GAAD,UACI,cAAC,IAAD,CAAQ7Q,UAAU,gBAI9B,sBAAKA,UAAW4W,EAAhB,UACI,cAAC3E,GAAD,CAAWlO,MAAM,eAAemO,QAASsD,IAEzC,eAACvD,GAAD,CAAWlO,MAAM,QAAQmO,QAASsD,EAAlC,UACI,sBAAKxV,UAAU,wBAAf,UACI,wBAAQA,UAAU,iBAAiB4Q,QAAS,WAAQyT,GAAqB,GAAO,EAAKjP,cAArF,8BAGA,wBAAQpV,UAAU,iBAAiB4Q,QAAS+d,EAA5C,gCAIJ,sBAAK3uB,UAAU,uBAAf,UACI,wBACIA,UAA2C,aAAhCoB,KAAKD,MAAMuU,iBAAkC,4BAA8B,eACtF9E,QAAS,kBAAM,EAAK6E,uBAAuB,aAF/C,sBAMA,wBACIzV,UAA2C,aAAhCoB,KAAKD,MAAMuU,iBAAkC,4BAA8B,eACtF9E,QAAS,kBAAM,EAAK6E,uBAAuB,aAF/C,yBAOJ,qBAAKzV,UAAU,gBAAgBK,MAAO,CAAE8Q,aAAc,UAAtD,SACqC,aAAhC/P,KAAKD,MAAMuU,iBACNc,EAAMpY,KAAI,SAAAsE,GACR,OAAO,cAAC,GAAD,CACHrB,KAAMqB,EAENoL,UAAW8gB,GADNlsB,EAAKpE,SAMhByY,EAAc3Y,KAAI,SAAAsE,GAChB,OAAO,cAAC,GAAD,CACHrB,KAAMqB,EAENoL,UAAW8gB,GADNlsB,EAAKpE,WAQ1B,qBAAK0B,UAAU,wBAAwBK,MAAO,CAAE6W,UAAW,QAA3D,SACI,wBACIlX,UAAS,oCAA+BqB,EAAKof,iBAAmB,WAAa,IAC7E7P,QAAS,kBAAM9C,EAAUkhB,qBAAqB3tB,EAAKof,mBAFvD,SAIKpf,EAAKof,iBAAmB,uBAAyB,+BAK9D,eAACxO,GAAD,CAAWlO,MAAM,WAAWmO,QAASsD,EAArC,UACK9R,OAAOC,QAAQtC,EAAKkW,UAAUnZ,KAAI,YAAkB,IAAD,oBAAf4D,EAAe,KAAVX,EAAU,KAChD,OAAO,cAAC,GAAD,CAEHkR,OAAQvQ,EACRX,KAAMA,EACNmR,aAAcA,EACdF,OAAQuE,GAJH7U,OAOXxC,KAAW,cAAC8T,GAAD,CAAc1C,QAASkG,iB,GAvLrCvU,aCYb0sB,G,kDACF,WAAYnvB,GAAQ,IAAD,uBACf,cAAMA,IAkEVgD,KAnEmB,sBAmEZ,8BAAAsI,EAAA,yDACH,EAAK8U,YACG3I,EAAa,EAAKpW,MAAlBoW,SACF2X,EAAW,CACb,EAAK3Q,eAAehH,EAAS9V,WAAWlD,MAAO,GAC/C,EAAKggB,eAAehH,EAASqB,OAAOra,MAAO,GAC3C,EAAKggB,eAAehH,EAASsB,OAAOta,MAAO,KAE3C,EAAK8gB,QARN,gCAQqB1U,QAAQmQ,IAAIoU,GARjC,WASC,EAAK7P,QATN,gCASqB,EAAKb,aAT1B,OAUC,EAAKa,SAAS,EAAK8P,sBAAsB5X,EAASyB,SAASza,OAV5D,4CAnEY,EAqFnB6wB,eAAiB,WACb,EAAKC,UACD,EAAKA,QAAU,GAAK,EAAKluB,MAAMoW,SAAS0B,SAAS1a,OACpB,aAAzB,EAAK4C,MAAMuB,KAAKpE,MAChB,EAAKmwB,WAAW,EAAKttB,MAAMuB,OAzFpB,EAqHnB+c,YAAc,WACV,IAAIC,EAAiBC,aAAa/f,QAAQ7E,EAAU,sBACpD,IACI2kB,EAAiBjgB,KAAKC,MAAMggB,GAC9B,MAAOrhB,GACLqhB,EAAiB,KAErB,OAAuB,OAAnBA,EACIA,EAAehH,gBAAkBD,GAAiBC,eAClD,EAAK8G,eAAe/G,IACbA,IAEJiH,EAEJjH,IAnIQ,EAsInB+G,eAAiB,SAACpR,GACd,IAAIjN,EAEAA,OADakD,IAAb+J,EACQA,EAEA,EAAKjN,MAAMoW,SAEvBoI,aAAaK,QAAQjlB,EAAU,qBAAsB0E,KAAKqH,UAAU3F,KA7IrD,EAgJnB0V,oBAAsB,SAACoJ,GACnB,IAAQ9e,EAAR,eAAQA,MACJoW,EAAWpW,EAAMoW,SACjBlW,EAAO4e,EAAQ5e,KACnBkW,EAAS0I,EAAQje,KAAjB,2BAA4BuV,EAAS0I,EAAQje,MAA7C,IAAmDzD,MAAO8C,EAAK9C,QAC3D8C,EAAKsX,cACLxX,EAAMuB,KAAKud,EAAQje,KAAOX,EAAK9C,OAEf,eAAhB0hB,EAAQje,KAAsB,EAAKuc,eAAeld,EAAK9C,MAAO,GAC9C,WAAhB0hB,EAAQje,KAAkB,EAAKuc,eAAeld,EAAK9C,MAAO,GAC1C,WAAhB0hB,EAAQje,KAAkB,EAAKuc,eAAeld,EAAK9C,MAAO,GAC1C,aAAhB0hB,EAAQje,KAAoB,EAAKmtB,sBAAsB9tB,EAAK9C,OAChE,EAAKgN,SAAS,CACVgM,SAAUA,EACV7U,KAAM,EAAKvB,MAAMuB,OAClB,WACC,EAAK8c,qBAhKM,EAoKnBjB,eApKmB,uCAoKF,WAAOjgB,EAAMqI,GAAb,uBAAAyE,EAAA,yDACR,EAAKiU,QADG,oDAEL9H,EAAa,EAAKpW,MAAlBoW,SACM,IAAV5Q,EAHS,wBAIT,EAAKxF,MAAMM,WAAWwZ,SAClB2E,EAAgB,IAAItG,GAAWhb,GAL1B,SAMHshB,EAAcvF,OANX,UAOJ,EAAKgF,QAPD,mDAQTO,EAAcpN,aAAa+E,EAAS9V,WAAWmR,QAC/C,EAAKrH,SAAS,CACV9J,WAAYme,IAVP,+BAaLA,EAAgB,IAAItG,GAAWhb,IAC/BsnB,EAAS,EAAKzkB,MAAMykB,QACjBjf,EAAQ,GAAGsU,SAClB2K,EAAOjf,EAAQ,GAAKiZ,EAhBX,UAiBHA,EAAcvF,OAjBX,WAkBJ,EAAKgF,QAlBD,mDAmBTO,EAAcpN,aAAd,UAA2B+E,EAAS,QAAD,OAAS5Q,WAA5C,aAA2B,EAA2BiM,QACtD,EAAKrH,SAAS,CACVqa,OAAQA,IArBH,QAwBb,EAAKuJ,sBAAsB5X,EAASyB,SAASza,OAxBhC,4CApKE,0DA8LnBiU,aAAe,SAACvM,GACZ,IAAIsR,EAAW,EAAKpW,MAAMoW,SACV,eAAZtR,EAAIjE,MACJuV,EAAS9V,WAAT,2BAA0B8V,EAAS9V,YAAnC,IAA+CmR,OAAQ3M,EAAI1H,QAC3D,EAAK4C,MAAMM,WAAW+Q,aAAavM,EAAI1H,QAE3B,WAAZ0H,EAAIjE,MACJuV,EAASqB,OAAT,2BAAsBrB,EAASqB,QAA/B,IAAuChG,OAAQ3M,EAAI1H,QACnD,EAAK4C,MAAMykB,OAAO,GAAGpT,aAAavM,EAAI1H,QAE1B,WAAZ0H,EAAIjE,MACJuV,EAASsB,OAAT,2BAAsBtB,EAASsB,QAA/B,IAAuCjG,OAAQ3M,EAAI1H,QACnD,EAAK4C,MAAMykB,OAAO,GAAGpT,aAAavM,EAAI1H,QAE1C,EAAKgN,SAAS,CACVgM,SAAUA,IACX,kBAAM,EAAKiI,qBA9MC,EAgNnB2P,sBAAwB,SAAC/P,GACrB,GAAK,EAAKC,QAAV,CACA,MAA+B,EAAKle,MAA5BM,EAAR,EAAQA,WAAYmkB,EAApB,EAAoBA,OACA,CAACnkB,EAAYmkB,EAAO,GAAIA,EAAO,IACvChiB,SAAQ,SAAA0rB,GAChB,GAAIlQ,EAAW,CACX,IAAK,EAAKE,WAAY,OAAOpkB,QAAQC,IAAI,8BACzCm0B,EAAIlV,aACJkV,EAAItV,QAAQ,EAAKsF,iBAEjBgQ,EAAIlV,aACJkV,EAAItV,QAAQ,EAAKne,aAAa0jB,kBA3NvB,EA+NnByP,oBA/NmB,uCA+NG,WAAO5gB,GAAP,+BAAAhD,EAAA,yDACb,EAAKiU,QADQ,oDAEbjR,EAFa,uBAGd,EAAK7C,SAAS,CAAEkV,kBAAkB,IAHpB,kBAIP,EAAK8O,YAAW,IAJT,gBAMa,EAAKpuB,MAA5BM,EANU,EAMVA,WAAYmkB,EANF,EAMEA,OACd3pB,EAAc,CAACwF,EAAYmkB,EAAO,GAAIA,EAAO,IAC7CxG,EAAY,EAAKje,MAAMoW,SAASyB,SAASza,MAR7B,iBASVod,EATU,EASVA,SACJyD,EACA,EAAKsB,iBAAiB1G,QAAQ2B,EAASX,MAEvC/e,EAAY2H,SAAQ,SAAAnC,GAChBA,EAAWuY,QAAQ2B,EAASX,SAGpCW,EAAS/Y,QACT,EAAK2I,SAAS,CAAEkV,kBAAkB,IAlBhB,UAmBZ,EAAK8O,YAAW,GAnBJ,WAoBb,EAAKlQ,QApBQ,oEAqBI1D,EAASxB,OArBb,eAqBdkG,EArBc,OAsBlB,EAAK9U,SAAS,CAAEkV,kBAAkB,IAtBhB,UAuBG3D,GAAY,+CAvBf,YAuBd/G,EAvBc,SAwBJ4F,EAASlX,SAAS4b,EAAUhf,KAAM0U,EAAW,QACtD,EAAKsJ,QAzBQ,mDA0BlB,EAAKqB,iBAAiBtG,aACtB,EAAKsG,iBAAiB1G,QAAQne,EAAa0jB,aAC3C,EAAK4P,sBAAsB/P,GA5BT,4CA/NH,wDA6PnBxQ,eAAiB,SAACxK,GACd,GAAuC,UAAnCU,SAASgK,cAAcC,QAA3B,CACA,MAAiD,EAAK5N,MAA9CM,EAAR,EAAQA,WAAYkF,EAApB,EAAoBA,MAAOif,EAA3B,EAA2BA,OAAQS,EAAnC,EAAmCA,UAC/BrkB,EAAMoC,EAAM6K,KAEhB,GAD2BoX,GAAajiB,EAAM4K,SACtB,CACpB,IAAIwgB,EAAM,OAAGxtB,QAAH,IAAGA,OAAH,EAAGA,EAAKkN,QAAQ,MAAO,IAC7BzT,EAAOgG,EAAW0N,gBAAgBqgB,GAEtC,OADa,OAAT/zB,GAAe,EAAKqG,YAAYL,EAAWsO,OAAOtU,IAC9CuG,GACJ,IAAK,QAAU,IAAD,IAEV,GADA,EAAKutB,cACA,EAAKpuB,MAAMoW,SAAS4B,SAAS5a,MAAO,MACzC,YAAKkxB,wBAAL,mBAAuBC,mBAAvB,gBAAqC,cAM7C,OAAQ1tB,GACJ,IAAK,OAAQ,EAAK6nB,aAAa,EAAK1oB,MAAMuB,KAAK+C,SAAW,GAAI,MAC9D,IAAK,OAAQ,EAAKokB,aAAa,EAAK1oB,MAAMuB,KAAK+C,SAAW,GAAI,MAC9D,IAAK,SAAU,EAAK8gB,mBAAmBlhB,EAAc,IAAK,MAC1D,IAAK,SAAU,EAAKkhB,mBAAmBlhB,EAAc,IAAK,MAC1D,IAAK,SAAU,EAAKkhB,mBAAmBlhB,EAAc,IAAK,MAC1D,IAAK,SAAU,EAAKkhB,mBAAmBlhB,EAAc,IAAK,MAC1D,IAAK,QAAU,IAAD,IAEV,GADA,EAAKkqB,cACA,EAAKpuB,MAAMoW,SAAS4B,SAAS5a,MAAO,MACzC,YAAKkxB,wBAAL,mBAAuBC,mBAAvB,gBAAqC,QACrC,MAEJ,IAAK,UACD,IAAIC,EAAYhpB,EAAQ,EACpBgpB,EAAY,GAAG,EAAKrJ,YAAYqJ,GACpC,MAEJ,IAAK,YACD,IAAIA,EAAYhpB,EAAQ,EACpBgpB,EAAY/J,EAAO1iB,OAAS,GAAG,EAAKojB,YAAYqJ,GACpD,MAEJ,IAAK,OAAQ,EAAKC,cAAc,EAAG,EAAKzuB,MAAMuB,KAAK+C,UAAW,MAC9D,IAAK,OAAQ,EAAKoqB,WAAW,EAAG,EAAK1uB,MAAMuB,KAAK+C,aAxSzC,EA8SnBoK,UAAY,SAACpO,EAAYjB,GACrB,IACI,IAAI/E,EAAOgG,EAAWsO,OAAOvP,GAC7B,QAAa6D,IAAT5I,EAAoB,OACxBgG,EAAWyS,KAAKzY,EAAK+E,MAAO2J,GAAgB,EAAKhJ,MAAMoW,SAAShU,MAAMhF,QACxE,MAAOF,MAnTM,EAuTnB6lB,YAAc,SAAC3lB,GACX,IAAQgZ,EAAa,EAAKpW,MAAlBoW,SACRA,EAAShU,MAAT,2BAAqBgU,EAAShU,OAA9B,IAAqChF,UACrC,EAAKgN,SAAS,CACVgM,SAAUA,IACX,kBAAM,EAAKiI,qBA5TC,EA8TnB1d,YAAc,SAACrG,GACX,IAAIkK,EAAS,EAAKxE,MAAMuB,KAAK8C,QAAQ,EAAKrE,MAAMuB,KAAK+C,UACjDjF,EAAQmF,EAAOtJ,MAAM6L,WAAU,SAACC,GAChC,OAAO1M,EAAK+E,QAAU2H,EAAE3H,SAExBsvB,EAAa,EAAK3uB,MAAMwF,MAAQ,EACpC,GAAInG,EAAQ,EAAG,CACX,IAAIqJ,EAAa,IAAIzD,GAAW3K,EAAK+E,OACrCqJ,EAAWlD,MAAQopB,GAAUlmB,EAAWlD,MAAOmpB,EAAY,KAC3DnqB,EAAOtJ,MAAM8G,KAAK0G,OACf,CACH,IAAImmB,EAAcrqB,EAAOtJ,MAAMmE,GAC/BwvB,EAAYrpB,MAAQopB,GAAUC,EAAYrpB,MAAOmpB,EAA8C,MAAlCE,EAAYrpB,MAAMmpB,GAAsB,IAAM,KACjF,QAAtBE,EAAYrpB,OAAiBhB,EAAOtJ,MAAM6M,OAAO1I,EAAO,GAEhE,EAAK+K,SAAS,CACV7I,KAAM,EAAKvB,MAAMuB,OAErB,EAAK0sB,iBACL,IAAI3tB,EAAa,EAAKN,MAAMM,WACxB,EAAKN,MAAMwF,MAAQ,IACnBlF,EAAa,EAAKN,MAAMykB,OAAO,EAAKzkB,MAAMwF,MAAQ,IAEtD,EAAKkJ,UAAUpO,EAAYhG,EAAK+E,QArVjB,EAuVnB0f,UAvVmB,sBAuVP,4BAAA9U,EAAA,sEACUmN,GAAGC,WADb,UACJhC,EADI,OAEH,EAAK6I,QAFF,iDAGR7I,EAAQA,EAAMpY,KAAI,SAAAsE,GACd,OAAIA,EAAKrB,KAAKoC,kBACHsC,EAA4BrD,GAEhCA,KAEX,EAAK6I,SAAS,CACVwL,cAAeP,EACfA,MAAOA,IAXH,2CAvVO,EAqWnBV,QArWmB,uCAqWT,WAAOpT,GAAP,SAAA0I,EAAA,sEACI,EAAK+U,WAAWzd,EAAKpE,MADzB,2DAEK,IAAIwF,EAAY,UAAW,2CAA6CpB,EAAKpE,MAAM4F,WAFxF,uBAIAqU,GAAGzC,QAAQrP,GAA0B/D,IAJrC,OAKN,EAAKwd,YALC,2CArWS,wDA4WnBuO,WA5WmB,uCA4WN,WAAO/rB,GAAP,eAAA0I,EAAA,yDACS,aAAd1I,EAAKpE,KADA,gCAEY,EAAKgiB,iBAFjB,UAGQ,QADThiB,EAFC,SAGiB,EAAK+gB,QAHtB,wDAIL3c,EAAKpE,KAAOA,EACZ,EAAK+wB,QAAU,EALV,kBAME,EAAKvZ,QAAQpT,IANf,gCAQF,IAAIiI,QAAJ,uCAAY,WAAMC,GAAN,iBAAAQ,EAAA,6DACXmM,EAAW,EAAKpW,MAAMoW,SADX,SAEL,EAAK4I,WAAWzd,EAAKpE,MAFhB,0CAGXoE,EAAKzG,YAAY,GAAKsb,EAAS9V,WAAWlD,MAC1CmE,EAAKzG,YAAY,GAAKsb,EAASqB,OAAOra,MACtCmE,EAAKzG,YAAY,GAAKsb,EAASsB,OAAOta,MAL3B,SAMLga,GAAGkW,WAAW,CAAEnwB,KAAMoE,EAAKpE,MAAQmI,GAA0B/D,IANxD,OAOXxH,QAAQC,IAAI,cAAeuH,EAAKpE,MAChC,EAAK+wB,QAAU,EACf,EAAKnP,YATM,4BAWPxd,EAAKpE,KAAKuJ,SAAS,cAXZ,kCAYU,EAAKyY,eAAe,oDAZ9B,WAaM,QADThiB,EAZG,kDAamBsM,KAbnB,eAcPlI,EAAKpE,KAAOA,EAdL,UAeDia,GAAGzC,QAAQrP,GAA0B/D,IAfpC,eAgBP,EAAKwd,YAhBE,kBAiBAtV,KAjBA,QAmBX1P,QAAQC,IAAI,sBACZuH,EAAKpE,KAAO,WACZ,EAAKmwB,WAAW/rB,GArBL,QAuBfkI,IAvBe,4CAAZ,wDARE,4CA5WM,wDA8YnB0V,eAAiB,SAACvD,GACd,OAAO,IAAIpS,QAAJ,uCAAY,WAAMC,GAAN,iBAAAQ,EAAA,sDACXmV,EAAexD,GAAY,0CADhB,uBAGUD,GAAYyD,GAHtB,UAIM,QADbpK,EAHO,iDAImBvL,EAAQ,OAJ3B,UAKM,KAAbuL,EALO,kCAMG,EAAKgK,WAAWhK,GANnB,oCAOHoK,EAAe,6BAA+BpK,EAP3C,iDASIvL,EAAQuL,IATZ,gCAYPoK,EAAexD,GAAY,0CAZpB,mEAAZ,wDA/YQ,EAianBkT,iBAAmB,WACf,OAAO,IAAItlB,QAAJ,uCAAY,WAAMC,GAAN,eAAAQ,EAAA,sEACI8S,GAAa,0CAAD,OAA2C,EAAK/c,MAAMuB,KAAKpE,KAA3D,+BADhB,OACX0J,EADW,OAEf4C,EAAQ5C,GAFO,2CAAZ,wDAlaQ,EAuanBmY,WAvamB,uCAuaN,WAAO7hB,GAAP,SAAA8M,EAAA,sEACImN,GAAG6H,WAAW,CAAE9hB,KAAMA,IAD1B,mFAvaM,wDA0anBqwB,cA1amB,sBA0aH,8BAAAvjB,EAAA,2DACiB,aAAzB,EAAKjK,MAAMuB,KAAKpE,MAAuB,EAAK+wB,QAAU,GAD9C,gCAEgB,EAAKY,mBAFrB,kDAIE,EAAKxB,WAAW,EAAKttB,MAAMuB,MAJ7B,uBAOK,EAAK4d,eAAe,+CAPzB,UAQC,QADThiB,EAPQ,8DASRoE,EAAO,IAAI6C,EAAajH,GAC5B,EAAK+wB,QAAU,EACV,EAAKhQ,QAXE,mDAYZ,EAAK9T,SAAS,CACV7I,KAAMA,IACP,kBAAM,EAAKoT,QAAQpT,MAdV,4CA1aG,EA0bnBkV,WA1bmB,uCA0bN,WAAOtZ,GAAP,SAAA8M,EAAA,sEACW8S,GAAa,6CAA+C5f,GADvE,kDAEUia,GAAGX,WAAW,CAAEtZ,KAAMA,IAFhC,OAGT,EAAK4hB,YAHI,2CA1bM,wDAgcnB2D,SAhcmB,uCAgcR,WAAOnhB,GAAP,mBAAA0I,EAAA,yDACDjK,EAAQ,EAAKA,OACnBuB,EAAOjD,KAAKC,MAAMD,KAAKqH,UAAUpE,KACvBrB,KAAKoC,qBAEXf,EAAO2F,GAAoB3F,EAAM,IAC5BpE,MAAQ,eAEI,IAAjB,EAAK+wB,QARF,qBASCa,EAAU/uB,EAAMoW,SAAS0B,SAAS1a,OAA6B,aAApB4C,EAAMuB,KAAKpE,SAC1C6C,EAAMuB,KAAK8C,QAAQtC,OAAS,GAVzC,gCAWiBgb,GAAa,0CAAD,OAA2C/c,EAAMuB,KAAKpE,KAAtD,wDAX7B,OAWC4xB,EAXD,kBAaCA,EAbD,kCAagB,EAAKzB,WAAWttB,EAAMuB,MAbtC,YAeH6U,EAAW,EAAKpW,MAAMoW,UACjBjU,IAAT,2BAAmBiU,EAASjU,KAA5B,IAAiC/E,MAAOmE,EAAKY,MAC7CiU,EAAShU,MAAT,2BAAqBgU,EAAShU,OAA9B,IAAqChF,MAAOmE,EAAKa,QAC5C,EAAK8b,QAlBH,mDAmBH9H,EAAS9V,WAAWlD,QAAUmE,EAAKzG,YAAY,KAC/C,EAAKsiB,eAAe7b,EAAKzG,YAAY,GAAI,GACzCsb,EAAS9V,WAAT,2BAA0B8V,EAAS9V,YAAnC,IAA+ClD,MAAOmE,EAAKzG,YAAY,MAEvEsb,EAASqB,OAAOra,QAAUmE,EAAKzG,YAAY,KAC3C,EAAKsiB,eAAe7b,EAAKzG,YAAY,GAAI,GACzCsb,EAASqB,OAAT,2BAAsBrB,EAASqB,QAA/B,IAAuCra,MAAOmE,EAAKzG,YAAY,MAE/Dsb,EAASsB,OAAOta,QAAUmE,EAAKzG,YAAY,KAC3C,EAAKsiB,eAAe7b,EAAKzG,YAAY,GAAI,GACzCsb,EAASsB,OAAT,2BAAsBtB,EAASsB,QAA/B,IAAuCta,MAAOmE,EAAKzG,YAAY,MAEnE,EAAKozB,QAAU,EACfn0B,QAAQC,IAAI,eACZ,EAAKoQ,SAAS,CACV7I,KAAMA,EACN6U,SAAUA,EACV0V,aAAc,KApCX,4CAhcQ,wDAwenB4C,WAAa,WAAmC,IAAlC7mB,EAAiC,uDAAxB,EAAGyD,EAAqB,uDAAV,MACjC,OAAO,IAAI9B,SAAQ,SAAAC,GACf,IAAIpF,EAAU,IAAIE,MAAMsD,GAAQjJ,OAAO3B,KAAI,kBAAM,IAAIwH,MACjDuqB,EAAc,EAAKhvB,MAAMuB,KAAK8C,QACjB,QAAbiH,EACA0jB,EAAYhtB,KAAZ,MAAAgtB,EAAW,YAAS3qB,IAEpB2qB,EAAYjnB,OAAZ,MAAAinB,EAAW,CAAQ1jB,EAAW,EAAG,GAAtB,mBAA4BjH,KAE5B,IAAXwD,GAAc,EAAK6gB,aAAa,EAAK1oB,MAAMuB,KAAK+C,SAAW,GAC/D,EAAK2pB,iBACL,EAAK7jB,SAAS,CAAE7I,KAAM,EAAKvB,MAAMuB,MAAQkI,OAnf9B,EAufnBglB,cAAgB,SAAC5mB,EAAQyD,GACrB,IAAI/J,EAAO,EAAKvB,MAAMuB,KAClBA,EAAK8C,QAAQtC,OAAS,KACZ,IAAIwC,MAAMsD,GAAQjJ,OAAO3B,KAAI,SAACC,EAAG4K,GAAJ,OAAUwD,EAAWxD,KACxDrF,SAAQ,SAAApD,GACRkC,EAAKpD,YAAYuI,SAASrH,IAAQ,EAAKytB,iBAAiBztB,MAEhEkC,EAAK8C,QAAQ0D,OAAOuD,EAAUzD,GAC1BtG,EAAK8C,QAAQtC,QAAUR,EAAK+C,UAAU,EAAKokB,aAAannB,EAAK+C,SAAW,GAC5E,EAAK2pB,iBACL,EAAK7jB,SAAS,CAAE7I,KAAMA,MAjgBP,EAqgBnB6sB,WArgBmB,uCAqgBN,WAAOnhB,GAAP,SAAAhD,EAAA,+EACF,IAAIT,SAAQ,SAAAC,GACf,IAAIyK,EAA+B,mBAAbjH,EAAyBA,GAAY,EAAKjN,MAAMklB,UACtE,EAAK9a,SAAS,CACV8a,UAAWhR,GADf,sBAEG,wCAAAjK,EAAA,sDACK,EAAKjK,MAAMklB,WAAW,EAAKwD,aAAa,EAAK1oB,MAAMuB,KAAK+C,UACxDuH,EAAY,EACZnE,GAAe,IAAI9F,MAAOC,UAH/B,WAIQ,EAAK7B,MAAMklB,UAJnB,0BAKgC,EAAKllB,MAAxBuB,EALb,EAKaA,KAAM6U,EALnB,EAKmBA,SACV1R,EAAeR,EAAc3C,EAAK8C,QAAQ9C,EAAK+C,UAAUI,cACzDuqB,EAAW1vB,KAAKC,MAAM,IAAQ4W,EAASjU,IAAI/E,MAAQsH,EAAaP,SAAW0H,EAC/EnE,GAAe,IAAI9F,MAAOC,UAR/B,UASWyH,GAAQ2lB,GATnB,WAUU,EAAKjvB,MAAMklB,WAAc,EAAKhH,QAVxC,qDAWK,EAAKgR,aACLrjB,EAAYnE,EAAeunB,GAAW,IAAIrtB,MAAOC,UAZtD,uBAcC4H,IAdD,iDALE,2CArgBM,wDA8hBnBylB,WAAa,WACT,IAAIC,EAAW,EAAKnvB,MAAMuB,KAAK+C,SAAW,EAC1C,GAAI,EAAKtE,MAAMklB,WAAaiK,EAAW,EAAKnvB,MAAMuB,KAAK8C,QAAQtC,OAAS,EACpE,OAAO,EAAKqsB,YAAW,GAE3B,EAAK1F,aAAa,EAAK1oB,MAAMuB,KAAK+C,SAAW,IAniB9B,EAsiBnB+oB,kBAAoB,WAChB,EAAKjjB,SAAS,CAAEwjB,UAAW,EAAK5tB,MAAM4tB,YAviBvB,EAyiBnBd,iBAAmB,SAAC7f,GAChB,IAAI1L,EAAO,EAAKvB,MAAMuB,KAClBlC,EAA4B,kBAAb4N,EAAwBA,EAAW1L,EAAK+C,SACvD8qB,EAAoB7tB,EAAKpD,YAAYiI,QAAQ/G,GAC7C+vB,GAAqB,GAAK7tB,EAAK8C,QAAQtC,OAAS1C,EAChDkC,EAAKpD,YAAY4J,OAAOqnB,EAAmB,GACpC7tB,EAAK8C,QAAQtC,OAAS1C,GAC7BkC,EAAKpD,YAAY6D,KAAK3C,GAE1B,EAAKgwB,sBACL,EAAKjlB,SAAS,CAAE7I,KAAMA,KAnjBP,EAqjBnB6jB,mBAAqB,SAACjhB,GAClB,IAAI5C,EAAO,EAAKvB,MAAMuB,KACtBA,EAAK8C,QAAQ,EAAKrE,MAAMuB,KAAK+C,UAAUI,aAAeP,EAAQvD,GAC9D,EAAKqtB,iBACL,EAAK7jB,SAAS,CAAE7I,KAAMA,KAzjBP,EA2jBnBoU,WA3jBmB,uCA2jBN,WAAO2Z,GAAP,SAAArlB,EAAA,yDACY,IAAjB,EAAKikB,QADA,qBAED,EAAKluB,MAAMoW,SAAS0B,SAAS1a,MAF5B,gCAGK,EAAKkwB,WAAW,EAAKttB,MAAMuB,MAHhC,8CAKmBwb,GAAa,0CAAD,OAA2C,EAAK/c,MAAMuB,KAAKpE,KAA3D,wDAAqH,GALpJ,oDAOS,EAAKmwB,WAAW,EAAKttB,MAAMuB,MAPpC,QAYT,EAAK5C,MAAMgX,WAAW2Z,GAZb,4CA3jBM,wDAykBnB5G,aAAe,SAACrpB,EAAOkwB,GACnB,IAAMvvB,EAAQ,EAAKA,MACfuB,EAAOvB,EAAMuB,KACjB,KAAIlC,EAAQ,GAAKA,EAAQkC,EAAK8C,QAAQtC,OAAS,GAA/C,CACA,IAAIijB,EAAgBhlB,EAAMuB,KAAK8C,QAAQhF,GACvCkC,EAAK+C,SAAWjF,EAChB,IAAIysB,EAAe9rB,EAAM8rB,aACzB,GAAI9rB,EAAMwvB,cAA6C,IAA7B,EAAKC,aAAa1tB,OAAc,CACtD+pB,EAAa9pB,KAAK3C,GAClB,IAAIsQ,EAAMpQ,KAAKoQ,IAAL,MAAApQ,KAAI,YAAQusB,IAClBjc,EAAMtQ,KAAKsQ,IAAL,MAAAtQ,KAAI,YAAQusB,IACtBA,EAAe,IAAIvnB,MAAMsL,EAAMF,EAAM,GAAG/Q,OAAO3B,KAAI,SAACC,EAAG4K,GAAJ,OAAU6H,EAAM7H,KAEvE,EAAKsC,SAAS,CACV7I,KAAMA,EACNuqB,aAAcA,IAGdyD,GACJvK,EAAc9pB,MAAMuH,SAAQ,SAAAnI,GACF,MAAlBA,EAAKkL,MAAM,IAAY,EAAKkJ,UAAU1O,EAAMM,WAAYhG,EAAK+E,OAC3C,MAAlB/E,EAAKkL,MAAM,IAAY,EAAKkJ,UAAU1O,EAAMykB,OAAO,GAAInqB,EAAK+E,OAC1C,MAAlB/E,EAAKkL,MAAM,IAAY,EAAKkJ,UAAU1O,EAAMykB,OAAO,GAAInqB,EAAK+E,YA/lBrD,EAkmBnB8lB,YAAc,SAAC3f,GACX,EAAK4E,SAAS,CACV5E,MAAOA,KApmBI,EAwmBnBwe,YAAc,WACV,EAAK5Z,SAAS,CACVolB,cAAe,EAAKxvB,MAAMwvB,aAC1B1D,aAAc,EAAK9rB,MAAMwvB,aAAe,GAAK,CAAC,EAAKxvB,MAAMuB,KAAK+C,YAElE,EAAKmrB,aAAe,IA7mBL,EA+mBnBxL,YAAc,SAACze,GACX,EAAKiqB,aAAe,GACpB,EAAKzvB,MAAM8rB,aAAarpB,SAAQ,SAACpD,GAC7B,IAAImF,EAAS,EAAKxE,MAAMuB,KAAK8C,QAAQhF,QACtB6D,IAAXsB,GAAsB,EAAKirB,aAAaztB,KAAKwC,MAErD,EAAKirB,aAAenxB,KAAKC,MAAMD,KAAKqH,UAAU,EAAK8pB,eACrC,QAAVjqB,IACA,EAAKiqB,aAAe,EAAKA,aAAaxyB,KAAI,SAAAuH,GAOtC,OANAA,EAAOtJ,MAAQsJ,EAAOtJ,MAAMG,QAAO,SAAA6B,GAAC,MAA2B,MAAvBA,EAAEsI,MAAMA,EAAQ,MACxDhB,EAAOtJ,MAAQsJ,EAAOtJ,MAAM+B,KAAI,SAAAC,GAG5B,OAFAA,EAAEsI,MAAQ,MACVtI,EAAEsI,MAAQopB,GAAU1xB,EAAEsI,MAAOA,EAAQ,EAAG,KACjCtI,KAEJsH,MAGf,EAAK4F,SAAS,CAAE0hB,aAAc,MAjoBf,EAmoBnB3H,aAnoBmB,uCAmoBJ,WAAOhN,GAAP,mBAAAlN,EAAA,sDACP1I,EAAO,EAAKvB,MAAMuB,KAClB8iB,EAAgB/lB,KAAKC,MAAMD,KAAKqH,UAAU,EAAK8pB,eAC9CtY,EAGDkN,EAAc5hB,SAAQ,SAACitB,EAAc5nB,GACjC,IAAItD,EAASjD,EAAK8C,QAAQ9C,EAAK+C,SAAWwD,QAC3B5E,IAAXsB,GACAkrB,EAAax0B,MAAMuH,SAAQ,SAAAktB,GACvB,IAAItwB,EAAQmF,EAAOtJ,MAAM6L,WAAU,SAAAzM,GAAI,OAAIq1B,EAAWtwB,QAAU/E,EAAK+E,SACrE,GAAIA,EAAQ,EACRmF,EAAOtJ,MAAM8G,KAAK2tB,QAElB,IAAK,IAAIrjB,EAAI,EAAGA,EAAI,EAAGA,IACS,MAAxBqjB,EAAWnqB,MAAM8G,KACjB9H,EAAOtJ,MAAMmE,GAAOmG,MAAQopB,GAAUpqB,EAAOtJ,MAAMmE,GAAOmG,MAAO8G,EAAG,WAZ5F,EAAA/K,EAAK8C,SAAQ0D,OAAb,SAAoBxG,EAAK+C,SAAU,GAAnC,mBAAyC+f,KAoB7C,EAAKja,SAAS,CAAE7I,KAAMA,IAxBX,2CAnoBI,wDA6pBnB2iB,aAAe,SAAC1e,GACZ,IAAIjE,EAAO,EAAKvB,MAAMuB,KACR,QAAViE,EACA,EAAKxF,MAAM8rB,aAAarpB,SAAQ,SAAAmtB,QAEb1sB,IADF3B,EAAK8C,QAAQurB,KACAruB,EAAK8C,QAAQurB,GAAa10B,MAAQ,OAGhE,EAAK8E,MAAM8rB,aAAarpB,SAAQ,SAAAmtB,QAEb1sB,IADF3B,EAAK8C,QAAQurB,IAEtBruB,EAAK8C,QAAQurB,GAAa10B,MAAMuH,SAAQ,SAAAnI,GACpCA,EAAKkL,MAAQopB,GAAUt0B,EAAKkL,MAAOA,EAAQ,EAAG,WAM9D,EAAK4E,SAAS,CAAE7I,KAAMA,KA/qBP,EAirBnB8tB,oBAAsB,WAClB,IAAMlxB,EAAc,EAAK6B,MAAMuB,KAAKpD,YAAY9C,QAAO,SAAA0rB,GAAU,OAAIA,EAAa,EAAK/mB,MAAMuB,KAAK8C,QAAQtC,UACpGR,EAAO,EAAKvB,MAAMuB,KACxBA,EAAKpD,YAAcA,EACnB,EAAKiM,SAAS,CAAE7I,KAAMA,KArrBP,EAurBnB6iB,cAvrBmB,sBAurBH,4BAAAna,EAAA,0DACN1I,EAAO,EAAKvB,MAAMuB,MACnB8C,QAAU9C,EAAK8C,QAAQhJ,QAAO,SAAC6B,EAAG4K,GAAJ,OAAW,EAAK9H,MAAM8rB,aAAaplB,SAASoB,MAC3EvG,EAAK+C,SAAW/C,EAAK8C,QAAQtC,OAAS,IAAGR,EAAK+C,SAAW/C,EAAK8C,QAAQtC,OAAS,GAC/ER,EAAK+C,UAAY,IAAG/C,EAAK+C,SAAW,GACZ,IAAxB/C,EAAK8C,QAAQtC,OALL,gCAKyB,EAAK2sB,WAAW,GAAI,GAL7C,OAMZ,EAAKtkB,SAAS,CACV7I,KAAMA,EACNuqB,aAAc,IACf,EAAKuD,qBATI,2CAvrBG,EAksBnBnM,qBAAuB,SAAC2M,GACpB,EAAKzlB,SAAS,CAAE0lB,YAAaD,KAhsB7B,IAAMzZ,EAAW,EAAKkI,cAHP,OAIf,EAAKyR,sBAAmB7sB,EACxB,EAAKxI,aAAeA,EACpB,EAAKyjB,gBAAajb,EAClB,EAAKqc,sBAAmBrc,EACxB,EAAKsX,SAAW,IAAIH,GACpB,EAAKra,MAAQ,CACTM,WAAY,IAAI6X,GAChBsM,OAAQ,CAAC,IAAItM,GAAc,IAAIA,IAC/B9C,MAAO,GACP6P,WAAW,EACX3jB,KAAM,IAAI6C,EAAa,YACvBgS,SAAUA,EACVwX,UAAU,EACVpoB,MAAO,EACPsmB,aAAc,GACd0D,cAAc,EACdM,aAAa,EACbxQ,kBAAkB,GAEtB,EAAKtf,MAAMuB,KAAKY,IAAMiU,EAASjU,IAAI/E,MACnC,EAAK4C,MAAMuB,KAAKzG,YAAc,CAC1Bsb,EAAS9V,WAAWlD,MACpBgZ,EAASqB,OAAOra,MAChBgZ,EAASsB,OAAOta,OAEpB,EAAK8gB,SAAU,EACf,EAAKuR,aAAe,GACpB,EAAKvB,QAAU,EACf,EAAKI,iBAAmB,GAhCT,E,qDAmCnB,WAAqB,IAAD,OAChBruB,KAAKie,SAAU,EACfje,KAAK0B,OACLhH,OAAOqU,iBAAiB,UAAW/O,KAAKwN,gBACxCxN,KAAKquB,iBAAmB3zB,OAAOq1B,iBAAmB,IAAIA,iBAAiBp2B,EAAU,aAAe,GAChGqG,KAAKquB,iBAAiB2B,UAAY,SAAChtB,GAC1B,EAAKjD,MAAMoW,SAAS4B,SAAS5a,OAC7B,CAAC,OAAQ,QAAQsJ,SAAjB,OAA0BzD,QAA1B,IAA0BA,OAA1B,EAA0BA,EAAO/C,OACtC,EAAKkuB,WAA0B,SAAfnrB,EAAM/C,OAEO,cAA7BvF,OAAOu1B,SAASC,UAChBx1B,OAAOqU,iBAAiB,gBAAgB,SAAC/L,GACrCA,EAAMvC,iBACNuC,EAAMmtB,YAAc,Q,kCAKhC,WAAwB,IAAD,IACnBnwB,KAAKie,SAAU,EACfvjB,OAAOyU,oBAAoB,UAAWnP,KAAKwN,gBAC3C,MAA+BxN,KAAKD,MAA5BM,EAAR,EAAQA,WAAYmkB,EAApB,EAAoBA,OACpB,UAAAxkB,KAAKquB,wBAAL,mBAAuB+B,aAAvB,iBACoB,CAAC/vB,EAAYmkB,EAAO,GAAIA,EAAO,IACvChiB,SAAQ,SAAAnC,GAAU,OAAIA,EAAWwZ,YAC7C7Z,KAAKke,gBAAajb,EAClBjD,KAAKsf,sBAAmBrc,EACxBjD,KAAKvF,kBAAewI,EACRjD,KAAKD,MACXklB,WAAY,I,+BAetB,WACIjlB,KAAKmK,SAAS,CACV7I,KAAM,IAAI6C,EAAa,cAE3B,IAAIzB,EAAY,UAAW,0DAA0DI,Y,wBAWzF,WAAc,IAAD,OACT,OAAO,IAAIyG,SAAQ,SAAAC,GACfiJ,MAAM,8BACDE,MAAK,SAAA4M,GAAC,OAAIA,EAAEhG,iBACZ5G,MAAK,SAAA6M,GACG,EAAKvB,SACV,EAAKxjB,aAAa+e,gBAAgBgG,GAAG,SAACC,GAClC,GAAK,EAAKxB,QAAV,CACA,IAAIyB,EAAY,EAAKjlB,aAAaklB,kBAC9BC,EAAW,EAAKnlB,aAAaqf,aACjC8F,EAAStH,KAAKnb,MAAQ,IACtBuiB,EAAUhH,OAAS+G,EACnBC,EAAU9G,QAAQgH,GAClBA,EAAShH,QAAQ,EAAKne,aAAa0jB,aACnC,EAAKD,WAAawB,EAClB,EAAKJ,iBAAmBM,EACxBpW,WAELiQ,OAAM,SAACxc,GACNnD,QAAQC,IAAI,oBAAqBkD,W,oBAolBjD,WAAU,IAAD,OACG8C,EAAUC,KAAVD,MACA8vB,EAAsB9vB,EAAtB8vB,YAAavuB,EAASvB,EAATuB,KAEf0K,EAkKd,SAAyB5H,EAASlC,EAAKmuB,GAKnC,IAJA,IAAMlrB,EAAW7F,KAAKC,MAAM,IAAQ2C,GAChCouB,EAAc,EACdC,EAAgB,EAChBC,EAAY,EACR3oB,EAAI,EAAGA,EAAGzD,EAAQtC,OAAQ+F,IAC9B2oB,EAAYrrB,EAAWlB,EAAcG,EAAQyD,GAAGpD,cAAcP,QAC3D2D,EAAIwoB,IAAKE,GAAiBC,GAC7BF,GAAeE,EAEnB,MAAO,CACHC,MAAOH,EACP7F,QAAS8F,GA9KUG,CAAgBpvB,EAAK8C,QAASrE,EAAMoW,SAASjU,IAAI/E,MAAOmE,EAAK+C,UAC1E2b,EAAW,CACb5K,MAAOrV,EAAMqV,MACbkY,YAAavtB,EAAMuB,KACnB6U,SAAUpW,EAAMoW,SAChBnL,WAAYhL,KAAKiuB,QACjBN,SAAU5tB,EAAM4tB,SAChBtO,iBAAkBtf,EAAMsf,kBAEtBU,EAAgB,CAClB0C,SAAUziB,KAAKyiB,SACfjM,WAAYxW,KAAKwW,WACjB+W,cAAevtB,KAAKutB,cACpB7X,WAAY1V,KAAK0V,WACjB2X,WAAYrtB,KAAKqtB,WACjB5X,oBAAqBzV,KAAKyV,oBAC1B2X,kBAAmBptB,KAAKotB,kBACxBhc,aAAcpR,KAAKoR,aACnB6R,qBAAsBjjB,KAAKijB,qBAC3B2K,oBAAqB5tB,KAAK4tB,qBAExB/N,EAAoB,CACtBnf,YAAaV,KAAKU,YAClBykB,mBAAoBnlB,KAAKmlB,mBACzBD,YAAallB,KAAKklB,aAEhBpF,EAAe,CACjBrU,SAAU1L,EAAMM,WAChB0kB,cAAehlB,EAAMuB,KAAK8C,QAAQrE,EAAMuB,KAAK+C,UAC7CJ,cAAeA,EACfsB,MAAOxF,EAAMwF,MACbpD,MAAOpC,EAAMoW,SAAShU,MAAMhF,MAC5B8nB,UAAWllB,EAAMklB,UACjB7U,aAAcrQ,EAAMoW,SAAS/F,aAAajT,OAExCwzB,EAAkB,CACpBlI,aAAczoB,KAAKyoB,aACnBoE,iBAAkB7sB,KAAK6sB,kBAErB+D,EAAa,CACfxsB,QAAS9C,EAAK8C,QACdC,SAAU/C,EAAK+C,SACf8R,SAAUpW,EAAMoW,SAChBjY,YAAa6B,EAAMuB,KAAKpD,YACxB2tB,aAAc9rB,EAAM8rB,cAElBgF,EAAY,CACd/f,QAAS9Q,KAAKD,MAAMwvB,aACpBnL,cAAepkB,KAAKwvB,aACpBjqB,MAAOvF,KAAKD,MAAMwF,OAEhBurB,EAAiB,CACnB/M,YAAa/jB,KAAK+jB,YAClBE,aAAcjkB,KAAKikB,aACnBE,cAAenkB,KAAKmkB,cACpBH,YAAahkB,KAAKgkB,YAClBE,aAAclkB,KAAKkkB,cAEjB6M,EAAsB,CACxBtO,SAAUziB,KAAKyiB,SACfQ,qBAAsBjjB,KAAKijB,qBAC3BH,YAAa9iB,KAAK8iB,aAEhBkO,EAAiB,CACnBn2B,YAAa,CAACkF,EAAMM,YAAP,mBAAsBN,EAAMykB,SAAQxnB,KAAI,SAAAuI,GAAK,OAAIA,EAAM0K,kBACpEuS,eAAgBlhB,EAAK+C,UAGzB,OAAO,sBAAKzF,UAAU,eAAeK,MAAO,CAAE6Y,gBAAgB,OAAD,OAAS/X,EAAMoW,SAAS2B,gBAAgB3a,MAAxC,MAAtD,UACF0yB,GAAe,cAAC,GAAD,CAAYnjB,UAAWqkB,EAAqB9wB,KAAM+wB,IAClE,qBAAKpyB,UAAU,YAAY4Q,QAASxP,KAAKotB,kBAAzC,SACI,cAAC3d,GAAD,UACI,cAAC,IAAD,QAGR,sBAAK7Q,UAAU,uBAAf,UACI,qBAAKA,UAAU,gBAAf,SACI,sBAAKA,UAAU,qBAAf,UACI,sBAAKA,UAAU,2BAAf,UACI,qBAAKA,UAAU,OAAO4B,cAAe,kBAAM,EAAKioB,aAAannB,EAAK+C,SAAW,IAA7E,SACI,cAACoL,GAAD,UACI,cAAC,IAAD,QAIR,qBAAK7Q,UAAU,OAAO4Q,QAAS,kBAAM,EAAKiZ,aAAannB,EAAK+C,SAAW,IAAvE,SACI,cAACoL,GAAD,UACI,cAAC,IAAD,QAIR,qBAAK7Q,UAAU,OAAO4Q,QAASxP,KAAKmuB,WAApC,SACI,cAAC1e,GAAD,UACKzP,KAAKD,MAAMklB,UACN,cAAC,IAAD,GAAa,SACb,cAAC,IAAD,GAAY,eAK9B,cAAC,GAAD,CAEIvY,UAAWikB,EACX1wB,KAAM2wB,GAFD5wB,KAAKD,MAAMoW,SAASwB,iBAAiBxa,OAI9C,sBAAKyB,UAAU,iCAAf,UAEI,qBAAKA,UAAU,OAAO4Q,QAAS,kBAAM,EAAKif,WAAW,EAAGntB,EAAK+C,WAA7D,SACI,qBAAKrD,IAAKiwB,GAASryB,UAAU,YAAYmC,IAAI,qBAEjD,qBAAKnC,UAAU,OAAO4Q,QAAS,kBAAM,EAAKgf,cAAc,EAAGltB,EAAK+C,WAAhE,SACI,qBAAKrD,IAAKkwB,GAAYtyB,UAAU,YAAYmC,IAAI,oBAEpD,qBAAKnC,UAAU,OAAO4Q,QAAS,kBAAM,EAAKif,WAAiD,EAAtC,EAAK1uB,MAAMoW,SAASuB,UAAUva,MAAW,QAA9F,SACI,cAACsS,GAAD,UACI,cAAC,IAAD,QAGR,qBAAK7Q,UAAU,OAAO4Q,QAASxP,KAAK+jB,YAApC,SACI,cAACtU,GAAD,UACI,cAAC,IAAD,gBAOpB,cAAC,GAAD,CACI/C,UAAWmT,EACX5f,KAAM6f,OAGd,cAAC,GAAD,CACI7f,KAAM+f,EACNtT,UAAWqT,IAEf,cAAC+D,GAAD,CACI7jB,KAAM4wB,EACNnkB,UAAWokB,IAEf,sBAAKlyB,UAAU,YAAf,UACI,8BACK0C,EAAKpE,OAEV,gCACKi0B,GAAanlB,EAAWye,SAD7B,IAGK0G,GAAanlB,EAAWykB,oB,GA71BtBtvB,aAm2BvB,SAASgwB,GAAaC,GAClB,IAAIC,EAAU/xB,KAAKC,MAAM6xB,EAAS,KAC9BE,GAAYF,EAAS,IAAS,KAAMnoB,QAAQ,GAChD,OACgB,KAAZqoB,EACOD,EAAU,EAAK,MAChBA,EAAU,KAAOC,EAAU,GAAK,IAAM,IAAMA,EAmB1D,SAAS3C,GAAU4C,EAAQnyB,EAAOoyB,GAC9B,OAAIpyB,GAASmyB,EAAOzvB,OACTyvB,EAAOE,UAEXF,EAAOG,UAAU,EAAGtyB,GAASoyB,EAAcD,EAAOG,UAAUtyB,EAAQ,GAEhEyuB,UCl5BR,SAAS8D,GAAT,GAAuD,IAAlCjlB,EAAiC,EAAjCA,UAAW/C,EAAsB,EAAtBA,SAAU/K,EAAY,EAAZA,UAC7C,EAAwByS,oBAAS,GAAjC,oBAAO4B,EAAP,KACA,GADA,KACwC5B,mBAAS,aAAjD,oBAAO+C,EAAP,KACQsB,GADR,KAC0ChJ,EAAlCgJ,YAAkChJ,EAAtB0gB,kBAkBpB,OAAO,sBAAKxuB,UAAW,iBAAmBA,GAAwB,IAA3D,UACH,sBAAKA,UAAU,oBAAoBK,MAAO,CAAEgX,eAAgB,YAA5D,UAEKtM,EAED,cAAC,GAAD,CAAUxL,KAAK,UAAf,SACI,mBAAGmY,KAAK,gCAAgC/I,OAAO,SAASqkB,IAAI,aAA5D,SACI,cAAC,IAAD,CAAWhzB,UAAU,aAI7B,cAAC,GAAD,CAAUT,KAAK,OAAOyS,OAAQ,kBAAM8E,EAAW,SAA/C,SACI,cAAC,IAAD,CAAQ9W,UAAU,cAI1B,qBAAKA,UAAWqU,EAAO,sBAAwB,YAA/C,SACI,cAACpC,GAAD,CAAWlO,MAAM,eAAemO,QAASsD,S,WCpC/Cyd,G,kDACF,WAAYnzB,GAAQ,IAAD,8BACf,cAAMA,IAQVwW,iBAAmB,WACf,IAAIC,EAAa,GACC,EAAKpV,MAAfqV,MACF5S,SAAQ,SAAAlB,GACNA,EAAKwT,YAAYxT,EAAKwT,IACX,QAAZnb,IACC2H,EAAOkE,GAAoBlE,IAE/BgD,MAAMkC,QAAQlF,GAAQ6T,EAAWpT,KAAX,MAAAoT,EAAU,YAAS7T,IAAQ6T,EAAWpT,KAAKT,MAErE,IAAI+T,EAAiB,IAAIjS,EACrBwP,EAAOvU,KAAKqH,UAAUyP,GACtBG,GAAO,IAAI3T,MAAO4T,cAAc9Y,MAAM,KAAK,GAC/C4Y,EAAehS,SAASuP,EAAxB,UAAgCjZ,EAAhC,mBAAkD2b,EAAlD,UACA,IAAI5S,EAAY,UAAW,0BAA0BI,WAvBtC,EAyBnBgc,UAzBmB,sBAyBP,sBAAA9U,EAAA,6EAESmN,GAAGC,WAFZ,yBAEJhC,MAFI,WACHjL,SADG,2DAzBO,EA8BnBoM,WA9BmB,uCA8BN,WAAOrZ,GAAP,SAAA8M,EAAA,sEACC8S,GAAa,6CAA+C5f,GAD7D,kDAECia,GAAGX,WAAW,CAAEtZ,KAAMA,IAFvB,OAGL,EAAK4hB,YAHA,2CA9BM,wDAqCnBgT,eArCmB,sBAqCF,sBAAA9nB,EAAA,sEACH8S,GAAa,8CADV,kDAEH3F,GAAGX,WAAW,IAFX,OAGT,EAAKsI,YAHI,2CArCE,EA2CnBiT,cAAgB,WACZxT,aAAayT,WAAWr4B,EAAQ,sBAChC4kB,aAAayT,WAAWr4B,EAAQ,kBAChC,IAAI+I,EAAY,UAAW,4BAA4BI,WA9CxC,EAgDnB+R,aAAe,SAACvT,GACRA,EAAKwT,YAAYxT,EAAKwT,IAC1B,IAAIC,EAAWzT,EAAKpE,KACL,QAAZvD,IACC2H,EAAOkE,GAAoBlE,IAE3BgD,MAAMkC,QAAQlF,KAAOA,EAAO,CAACA,IACjCA,EAAKkB,SAAQ,SAAAwS,GACTA,EAAM/U,KAAKtG,QAAUA,KAEzB,IAAIiZ,EAAOvU,KAAKqH,UAAUpE,IACL,IAAI8B,GACVC,SAASuP,EAAxB,UAAgCmC,EAAhC,YAA4Cpb,EAAQsb,cAApD,eACA,IAAIvS,EAAY,UAAW,mBAAmBI,WA3D9C,EAAK/C,MAAQ,CACTqV,MAAO,IAHI,E,qDAMnB,WACIpV,KAAK8e,c,oBAwDT,WAAU,IAAD,OACL,OAAO,sBAAKlgB,UAAU,iBAAf,UACH,cAAC+yB,GAAD,CAAYjlB,UAAW,CAACgJ,WAAY1V,KAAKtB,MAAMgX,cAC/C,sBAAK9W,UAAU,qBAAf,yCACgC,uBADhC,uGAKA,sBAAKA,UAAU,wBAAf,UACI,wBAAQA,UAAU,iBAAiB4Q,QAASxP,KAAK+xB,cAAjD,4BAGA,wBAAQnzB,UAAU,iBAAiB4Q,QAASxP,KAAK8xB,eAAjD,iCAIJ,qBAAKlzB,UAAU,sBAAf,SACKoB,KAAKD,MAAMqV,MAAMpY,KAAI,SAAAsE,GAAI,OACtB,cAAC,GAAD,CAEIrB,KAAMqB,EACNoL,UAAW,CACP6J,WAAY,EAAKA,WACjB1B,aAAc,EAAKA,eAL3B,OACSvT,QADT,IACSA,OADT,EACSA,EAAMpE,kB,GAnFXiE,aAgGxB,SAAS0U,GAAQnX,GACb,IAAIuB,EAAOvB,EAAMuB,KACbsW,EAAa7X,EAAMgO,UAAU6J,WAC7B1B,EAAenW,EAAMgO,UAAUmI,aACnC,OAAO,sBAAKjW,UAAU,WAAf,UACH,qBAAKA,UAAU,YAAf,SACKqB,EAAK/C,OAEV,sBAAK0B,UAAU,uBAAf,UACI,wBAAQA,UAAU,cAAc4Q,QAAS,kBAAMqF,EAAa5U,IAA5D,SACI,cAAC,IAAD,MAGJ,wBAAQrB,UAAU,cAAc4Q,QAAS,kBAAM+G,EAAWtW,EAAK/C,OAA/D,SACI,cAAC,IAAD,CAASc,MAAM,oBAMhB6zB,U,OCxHA,SAASI,GAAcvzB,GAClC,OAAO,sBAAKE,UAAU,iBAAf,UACH,qBAAKA,UAAU,uBAAf,uBAGA,cAAC+yB,GAAD,CAAYjlB,UAAW,CAACgJ,WAAYhX,EAAMgX,YAA1C,SACI,cAAC,GAAD,UACI,mBAAGY,KAAK,yCAAyC1X,UAAU,OAAO2O,OAAO,SAASqkB,IAAI,aAAtF,SACI,cAAC,IAAD,UAIXM,GAAWl1B,KAAI,SAAAC,GAAC,OAAI,cAACk1B,GAAD,CACjBlyB,KAAMhD,GACDA,EAAEgF,YAEX,qBAAKrD,UAAU,wBAMvB,SAASuzB,GAAazzB,GAClB,MAA0CA,EAAMuB,KAAxCgC,EAAR,EAAQA,QAASU,EAAjB,EAAiBA,MAAOsrB,EAAxB,EAAwBA,QAAS3Y,EAAjC,EAAiCA,KACjC,OAAO,sBAAK1W,UAAU,oBAAf,UACH,sBAAKA,UAAU,kBAAf,UACI,qBAAKA,UAAU,QAAf,SACKqD,IAEL,qBAAKrD,UAAU,QAAf,SACK0W,OAGT,sBAAK1W,UAAU,iBAAf,UACI,qBAAKA,UAAU,QAAf,SACK+D,IAEL,6BACKsrB,EAAQjxB,KAAI,SAACC,EAAG4K,GAAJ,OACT,6BACK5K,EAAER,MAAM,MAAMO,KAAI,SAACo1B,EAAMvqB,EAAGwqB,GACzB,OAAU,IAANxqB,EACO,8BAAcuqB,GAAJvqB,GAEd,mBAAWjJ,UAAU,eAArB,SACFwzB,GADUvqB,OALdA,cAgB7B,IAAMqqB,GAAa,CACf,CACIjwB,QAAS,MACTU,MAAO,mBACP2S,KAAM,eACN2Y,QAAS,CACL,yBACA,0DACA,iDAHK,gFAKL,kCAGR,CACIhsB,QAAS,QACTU,MAAO,mBACP2S,KAAM,eACN2Y,QAAS,CACL,4CACA,kBACA,iCACA,oBAGR,CACIhsB,QAAS,MACTU,MAAO,sBACP2S,KAAM,eACN2Y,QAAS,CACL,oBACA,iCACA,+CACA,kBACA,sBACA,gCACA,8CACA,sBAGR,CACIhsB,QAAS,MACTU,MAAO,sBACP2S,KAAM,eACN2Y,QAAS,CAAC,wKAAD,kjBAcV,CACChsB,QAAS,MACTU,MAAO,SACP2S,KAAM,eACN2Y,QAAS,CACL,6BACA,iCAEL,CACChsB,QAAS,MACTU,MAAO,qBACP2S,KAAM,eACN2Y,QAAS,CACL,yCACA,mDACA,8BACA,+BACA,2BAEL,CACChsB,QAAS,MACTU,MAAO,cACP2S,KAAM,eACN2Y,QAAS,CAAC,wdAQX,CACChsB,QAAS,MACTU,MAAO,eACP2S,KAAM,eACN2Y,QAAS,CACL,kFACA,cAEL,CACChsB,QAAS,MACTU,MAAO,kBACP2S,KAAM,eACN2Y,QAAS,CACL,sBACA,gBACA,gCACA,cAEL,CACChsB,QAAS,MACTU,MAAO,oBACP2S,KAAM,eACN2Y,QAAS,CACL,sEACA,4EAEL,CACChsB,QAAS,MACTU,MAAO,uBACP2S,KAAM,eACN2Y,QAAS,CACL,4JACA,YACA,uCAEL,CACChsB,QAAS,MACTU,MAAO,UACP2S,KAAM,eACN2Y,QAAS,CACL,4BACA,2CACA,uBACA,mBACA,+BACA,+CACA,0EClMG,I,OAAA,IAA0B,yCCI1B,SAASqE,GAAS5zB,GAC7B,OAAO,sBAAKE,UAAU,gBAAf,UACH,cAAC+yB,GAAD,CAAYjlB,UAAW,CAAEgJ,WAAYhX,EAAMgX,cAC3C,sBAAK9W,UAAU,kBAAf,UACI,cAAC2zB,GAAD,CACIr1B,KAAK,QACLs1B,YAAY,wEAFhB,SAII,cAACC,GAAD,CACIzxB,IAAI,4CACJ2B,MAAM,YAGd,cAAC4vB,GAAD,CACIr1B,KAAK,oBACLs1B,YAAY,4DAFhB,SAII,cAACC,GAAD,CACIzxB,IAAI,4CACJ2B,MAAM,wBAGd,cAAC4vB,GAAD,CACIr1B,KAAK,YACLs1B,YAAW,sEAFf,SAII,cAACC,GAAD,CACIzxB,IAAI,4CACJ2B,MAAM,UAGd,cAAC4vB,GAAD,CACIr1B,KAAK,cACLs1B,YAAY,0DAFhB,SAII,cAACE,GAAD,CACIC,IAAKC,GACLC,GAAG,6FACH9xB,IAAI,wBASxB,SAAS2xB,GAAWh0B,GAChB,OAAO,mBACH4X,KAAM5X,EAAMm0B,GACZ5zB,MAAO,CAACJ,MAAO,UAAWC,OAAQ,UAAWukB,SAAU,SAAUyP,aAAc,UAC/EvlB,OAAO,SACPqkB,IAAI,aAJD,SAMH,qBACI5wB,IAAKtC,EAAMi0B,IACX1zB,MAAO,CAACJ,MAAO,OAAQk0B,UAAW,SAClChyB,IAAKrC,EAAMqC,QAIvB,SAAS0xB,GAAO/zB,GACZ,OAAO,wBACHsC,IAAKtC,EAAMsC,IACX2B,MAAOjE,EAAMsC,IACbgyB,YAAY,IACZC,MAAM,+BACNC,iBAAe,IAIvB,SAASX,GAAQ7zB,GACb,OAAO,sBAAKE,UAAU,UAAf,UACH,qBAAKA,UAAU,gBAAf,SACKF,EAAMxB,OAEX,qBAAK0B,UAAU,sBAAf,SACKF,EAAM8zB,cAEV9zB,EAAMiL,Y,OC9EA,SAASwpB,GAAKz0B,GACzB,IAAMm0B,EAAKn0B,EAAMgX,WACTzV,EAAoCvB,EAApCuB,KAAMmzB,EAA8B10B,EAA9B00B,cAAeC,EAAe30B,EAAf20B,WACvBC,EAAYrzB,EAAKszB,aAAe,OAAS,oBACzCzM,EAAapsB,OAAO84B,WAAa,IACvC,OAAO,sBAAK50B,UAAW00B,EAAhB,UACH,cAAC,IAAD,CAAS10B,UAAU,aAAa4Q,QAAS,kBAAM9Q,EAAM+0B,YAAW,OAC9D3M,IAAeuM,IAAe,sBAAKz0B,UAAU,WAAf,UAC5B,sBAAKA,UAAU,aAAf,UACKjF,EADL,oBAGA,sBAAKiF,UAAU,gBAAf,sEAC8DjF,SAKhE05B,GAAc,sBAAKz0B,UAAU,eAAf,UACZ,iCACMR,KAAW,qBAAKQ,UAAU,eAAf,sGAGb,sBAAMA,UAAU,eAAhB,UACI,qBAAKA,UAAU,WAAf,qBADJ,iGAICqB,EAAKyzB,qBACF,gCACI,qBAAK90B,UAAU,WAAf,qBADJ,yGAIE,QAGV,qBAAKK,MAAO,CAAC+W,QAAQ,OAAQC,eAAe,YAA5C,SACI,wBAAQrX,UAAU,sBAAsB4Q,QAAS4jB,EAAjD,0BAMR,sBAAKx0B,UAAU,eAAf,UACI,cAAC+0B,GAAD,CACIC,KAAM,cAAC,IAAD,IACNjxB,MAAM,WACNhF,WAAU,8BACV6R,QAAS,kBAAMqjB,EAAG,aAJtB,uFAQA,cAACc,GAAD,CACIC,KAAM,cAAC,KAAD,IACNjxB,MAAM,SACNhF,WAAU,0BACV6R,QAAS,kBAAMqjB,EAAG,KAJtB,sHAUJ,cAACgB,GAAD,4BACA,sBAAKj1B,UAAU,wBAAf,UACI,cAACk1B,GAAD,CAActkB,QAAS,kBAAMqjB,EAAG,cAAhC,wBAGEz0B,KACE,cAAC01B,GAAD,CAActkB,QAAS,kBAAMqjB,EAAG,WAAhC,oBAIJ,cAACiB,GAAD,CAActkB,QAAS,kBAAMqjB,EAAG,aAAhC,sBAGA,cAACiB,GAAD,CAActkB,QAAS,kBAAMqjB,EAAG,SAAhC,kBAGA,cAACiB,GAAD,CAActkB,QAAS,kBAAMqjB,EAAG,oBAAhC,iCAIJ,sBAAKj0B,UAAU,uBAAuB4Q,QAAS,kBAAM9Q,EAAMq1B,iBAAiB9zB,EAAK+zB,UAAjF,UACI,uBAAO71B,KAAK,WAAW8S,SAAUhR,EAAK+zB,QAASC,UAAQ,IAD3D,kBAIA,qBAAKr1B,UAAU,cAAf,SACI,+DAC0C,YAAZjF,EAAwB,SAAW,MADjE,gEASZ,SAASm6B,GAAap1B,GAClB,OAAO,wBAAQ8Q,QAAS9Q,EAAM8Q,QAAvB,SACF9Q,EAAMiL,WAIf,SAASgqB,GAAmBj1B,GACxB,OAAO,sBAAKE,UAAU,uBAAuB4Q,QAAS9Q,EAAM8Q,QAArD,UACH,qBAAK5Q,UAAU,0BAA0BK,MAAO,CAAE6Y,gBAAgB,OAAD,OAASpZ,EAAMf,WAAf,QAEjE,sBAAKiB,UAAU,oBAAf,UACI,sBAAKA,UAAU,qBAAf,UACKF,EAAMk1B,KADX,IACkBl1B,EAAMiE,SAExB,qBAAK/D,UAAU,oBAAf,SACKF,EAAMiL,WAEX,qBAAK/K,UAAU,oBAAf,SACI,kDAQhB,SAASi1B,GAAUn1B,GACf,OAAO,qBAAKE,UAAU,iBAAf,SACFF,EAAMiL,W,OC3HA,SAASuqB,GAAKx1B,GACzB,OAAO,sBAAKE,UAAU,YAAf,UACH,cAAC+yB,GAAD,CAAYjlB,UAAW,CAACgJ,WAAYhX,EAAMgX,cAC1C,sBAAK9W,UAAU,eAAf,UACI,qBAAKK,MAAO,CAACk1B,SAAU,OAAQjR,OAAQ,UAAvC,gCAGA,sBAAKjkB,MAAO,CAACiX,WAAY,QAAzB,mHAGI,uBAAK,uBAHT,4DAKI,oBAAGI,KAAK,gCAAgCrX,MAAO,CAACjB,MAAO,oBAAvD,UACA,4CADA,qBALJ,KAQM,0BAEN,cAACsS,GAAD,U,OCdG,SAAS8jB,GAAgB11B,GACpC,MAA0B2S,mBAAS,IAAnC,oBAAO+D,EAAP,KAAcif,EAAd,KACA,EAA0BhjB,mBAAS,IAAnC,oBAAOijB,EAAP,KAAcC,EAAd,KACA,EAAwCljB,mBAAS,GAAjD,oBAAOmjB,EAAP,KAAqBC,EAArB,KACA,EAAsCpjB,mBAAS,IAA/C,oBAAOic,EAAP,KAAoBoH,EAApB,KACA,EAAgDrjB,mBAAS,YAAzD,oBAAOiD,EAAP,KAAyBqgB,EAAzB,KAEA,SAASC,EAAUhtB,GACf,IAAMitB,EAAYL,EAAe5sB,EAC3BktB,EAAQpxB,SAASqxB,cAAc,iBAChCD,GAASD,EAAY,IACZC,EAAM7K,wBAAwBprB,MAChC,IAAiB,IAAX+I,GAClB6sB,EAAgBI,IAUpB,SAASn0B,EAAYY,GAAO,IAAD,EACvBozB,EAAepzB,GACf,IAAI2L,EAAgB5O,KAAKC,MAAMD,KAAKqH,UAAUpE,KAC9C,UAAI2L,EAAchN,YAAlB,aAAI,EAAoBoC,qBACpB4K,EAAgBhI,EAAoBgI,IAKxC,IAHA,IAAIhS,EAAQgS,EAAchS,MACtBgR,EAAS,GACTC,EAAqB,EAChBrE,EAAI,EAAG5M,EAAM6G,OAAS,EAAG+F,IAAK,CAMnC,IALA,IAAIsE,EAAQ,CACRlR,MAAO,CAACA,EAAM0M,SACdkE,MAAO,GAEPO,EAAYD,EAAMlR,MAAM6G,OAAS,EAAIqK,EAAMlR,MAAM,GAAG,GAAK,EACpDoR,EAAI,EAAGA,EAAIpR,EAAM6G,QAAUuK,EAAI,GAAIA,IAAK,CAC5BpR,EAAMoR,GAAG,GAAKF,EAAMlR,MAAM,GAAG,GAAK,GAClC,IACbkR,EAAMlR,MAAM8G,KAAK9G,EAAM0M,SACvB0E,KAGRF,EAAMN,MAAQK,EACdA,EAAqBjR,EAAM6G,OAAS,EAAI7G,EAAM,GAAG,GAAKmR,EAAY,EAClEH,EAAOlK,KAAKoK,GAEhBooB,EAAStoB,GAEb,OAnCA2F,qBAAU,WAAM,4CACZ,sBAAA5H,EAAA,kEACIqqB,EADJ,SACmBld,GAAGC,WADtB,8EADY,uBAAC,WAAD,wBAIZ6B,KACD,IA8BI,qBAAKra,UAAU,iBAAf,SACH,sBAAKK,MAAO,CAAE+W,QAAS,OAAQuN,WAAY,SAAUyR,cAAe,UAApE,UACI,cAACrD,GAAD,CAAYjlB,UAAW,CAAEgJ,WAAYhX,EAAMgX,YAAc9W,UAAU,YACnE,gCACI,sBAAKA,UAAU,kCAAkCK,MAAO,CAAE6W,UAAW,KAArE,UACI,sBAAKlX,UAAU,uBAAf,UACI,wBACIA,UAAgC,aAArB0V,EAAkC,4BAA8B,eAC3E9E,QAAS,kBAAMmlB,EAAoB,aAFvC,sBAMA,wBACI/1B,UAAgC,aAArB0V,EAAkC,4BAA8B,eAC3E9E,QAAS,kBAAMmlB,EAAoB,aAFvC,yBAOJ,qBAAK/1B,UAAU,gBAAf,SACKwW,EAAMha,QAAO,SAACkG,GAAD,cAA+B,aAArBgT,EAAA,UAAkChT,EAAKrB,YAAvC,aAAkC,EAAWoC,oBAAoB,UAACf,EAAKrB,YAAN,aAAC,EAAWoC,sBACnGrF,KAAI,SAACsE,GAAD,OACF,cAAC,GAAD,CAEImpB,QAASnpB,IAASgsB,EAClBrtB,KAAMqB,EACNoL,UAAW,CACP3I,MAAOrD,IALf,OACSY,QADT,IACSA,OADT,EACSA,EAAMpE,cAW3B,sBAAK0B,UAAU,oCAAf,UACI,wBAAQ4Q,QAAS,kBAAM9U,OAAOu6B,SAASr2B,UAAU,iBAAjD,0BAGA,sBAAKK,MAAO,CAAE+W,QAAS,OAAQuN,WAAY,UAA3C,sBACciR,EACV,wBAAQ51B,UAAU,uBACd4Q,QAAS,kBAAMolB,GAAW,IAD9B,eAIA,wBAAQh2B,UAAU,uBACd4Q,QAAS,kBAAMolB,EAAU,IAD7B,wBAOZ,oBAAIh2B,UAAU,UAAd,gBACK0uB,QADL,IACKA,OADL,EACKA,EAAapwB,OAElB,sBAAK+B,MAAO,CAAEjB,MAAO,kBAAoBY,UAAU,UAAnD,UACI,6BAAK0uB,EAAYpwB,MAAQ,qBACzB,qBAAK+B,MAAO,CAAEjB,MAAO,oBAArB,uGAKJ,qBACIY,UAAU,0BACVK,MAAO,CAAEi2B,oBAAoB,UAAD,OAAYV,EAAZ,UAFhC,SAKKF,EAAMt3B,KAAI,SAAC83B,EAAOjtB,GAAR,OACP,cAACstB,GAAD,CAGIX,aAAcA,EACdM,MAAOA,EACPM,KAAM,GAHDvtB,aAY7B,SAASstB,GAAWz2B,GAChB,IAAQo2B,EAAgBp2B,EAAhBo2B,MAAOM,EAAS12B,EAAT02B,KACTC,EAA4B,YAAZ17B,EAAwB,EAAI,EAC5CsB,EAAQ,IAAIqJ,MAAM+wB,EAAgBD,GAAMz2B,KAAK,GAInD,OAHAm2B,EAAM75B,MAAMuH,SAAQ,SAAAnI,GAChBY,EAAMZ,EAAK,IAAM,KAEd,qBAAKuE,UAAU,cAAf,SACH,qBAAKA,UAAU,kBAAkBK,MAAO,CAAEi2B,oBAAoB,UAAD,OAAYG,EAAZ,UAA7D,SACKp6B,EAAM+B,KAAI,SAACs4B,EAAQztB,GAChB,OAAO,qBAAKjJ,UAAW02B,EAAS,eAAiB,iBAAsBztB,UASvF,SAASgO,GAAQnX,GACb,IAAQuB,EAAkBvB,EAAlBuB,KACFs1B,EADoB72B,EAAZ+rB,QACkB,CAAE5pB,gBAAiB,sBAAyB,GAC5E,OAAO,qBACHjC,UAAU,WACVK,MAAOs2B,EACP/lB,QAAS,kBAAM9Q,EAAMgO,UAAU3I,MAAM9D,IAHlC,SAIH,qBAAKrB,UAAU,YAAf,SACKqB,EAAK/C,SC1JlB,IAAMs4B,GAAcC,QACW,cAA7B/6B,OAAOu1B,SAASC,UAEe,UAA7Bx1B,OAAOu1B,SAASC,UAEhBx1B,OAAOu1B,SAASC,SAASwF,MAAM,2DAoCnC,SAASC,GAAgBC,EAAOC,GAC9B1iB,UAAU2iB,cACPC,SAASH,GACTjjB,MAAK,SAACqjB,GACLA,EAAaC,cAAgB,WAC3B,IAAMC,EAAmBF,EAAaG,WACd,MAApBD,IAGJA,EAAiBE,cAAgB,WACA,cAA3BF,EAAiBn2B,QACfoT,UAAU2iB,cAAcO,YAI1Bv8B,QAAQC,IACN,+GAKE87B,GAAUA,EAAOS,UACnBT,EAAOS,SAASN,KAMlBl8B,QAAQC,IAAI,sCAGR87B,GAAUA,EAAOU,WACnBV,EAAOU,UAAUP,WAO5Bvc,OAAM,SAAC5G,GACN/Y,QAAQ+Y,MAAM,4CAA6CA,M,sBC7FlD,SAAS2jB,GAAgB93B,GACpC,IAAQiE,EAAiCjE,EAAjCiE,MAAOC,EAA0BlE,EAA1BkE,KAAMkO,EAAoBpS,EAApBoS,QAAStB,EAAW9Q,EAAX8Q,QAC7BinB,EAAU3lB,EAAU,4CAA8C,mBACnE,OAAO,sBAAKlS,UAAW63B,EAASjnB,QAASA,EAAlC,UACP,qBAAK5Q,UAAU,yBAAf,SACK+D,IAEL,qBAAK/D,UAAU,wBAAf,SACKgE,O,WCRM,OAA0B,qCCA1B,OAA0B,yCCK1B,SAAS8zB,GAAOh4B,GAC3B,OAAO,sBAAKE,UAAU,cAAf,UACH,cAAC+yB,GAAD,CAAYjlB,UAAW,CAACgJ,WAAYhX,EAAMgX,cAC1C,sBAAK9W,UAAU,cAAf,yPAIwB,uBAJxB,gMAQI,uBAAM,uBARV,uGAYA,sBAAKA,UAAU,mBAAf,UACI,mBAAG0X,KAAK,6BAA6B/I,OAAO,SAAS3O,UAAU,SAASgzB,IAAI,aAA5E,SACI,qBAAK5wB,IAAK21B,GAAW51B,IAAI,WAAW9B,MAAO,CAAEH,OAAQ,YAEzD,mBAAGwX,KAAK,0BAA0B/I,OAAO,SAAS3O,UAAU,OAAOgzB,IAAI,aAAvE,SACI,qBAAK5wB,ICzBN,qnMDyBoBD,IAAI,OAAO9B,MAAO,CAAEH,OAAQ,YAEnD,mBAAGwX,KAAK,qCAAqC/I,OAAO,SAASqkB,IAAI,aAAjE,SACI,qBAAK5wB,IAAK41B,GAAiB71B,IAAI,eAAe9B,MAAO,CAAEH,OAAQ,kBE5BhE,WAA0B,mCCkBnC+3B,G,kDACL,WAAYn4B,GAAQ,IAAD,uBAClB,cAAMA,IA6BPgX,WAAa,SAAC2Z,GACb,GAAa,SAATA,EAAiB,OAAO,EAAKoE,YAAW,GACxC,EAAK1zB,MAAM+2B,SAAShmB,SAAS,EAAK2iB,YAAW,GACjD,EAAKtpB,SAAS,CACb4sB,aAAc1H,EACd2H,aAAa,KAnCI,EAsCnBvD,WAAa,WAAuB,IAAtBzmB,EAAqB,wDAE5BiqB,EAAY,EAAKl3B,MAAM+2B,SAC7B,GAAI9pB,EACH,OAAO,EAAK7C,SAAS,CACpB2sB,SAAS,2BAAMG,GAAP,IAAkBnmB,SAAS,EAAMyiB,cAAc,MAGzD,EAAKppB,SAAS,CACb2sB,SAAS,2BAAMG,GAAP,IAAkB1D,cAAc,MACtC,WACFpmB,YAAW,WACV,EAAKhD,SAAS,CACb2sB,SAAS,2BAAMG,GAAP,IAAkBnmB,SAAS,QAElC,SArDc,EAwDnBijB,gBAAkB,WAAuB,IAAtB/mB,EAAqB,wDACvCuR,aAAaK,QAAQjlB,EAAU,YAAaqT,GAC5C,IAAMiqB,EAAY,EAAKl3B,MAAM+2B,SAC7B,EAAK3sB,SAAS,CACb2sB,SAAS,2BAAMG,GAAP,IAAkBjD,QAAShnB,OA5DlB,EAuEnBomB,cAvEmB,sBAuEH,sBAAAppB,EAAA,mEAEVmJ,UAAUC,UAAWD,UAAUC,QAAQC,QAF7B,gCAGMF,UAAUC,QAAQC,UAHxB,eAKZ,IAAI3Q,EAAY,UAAW,8BAA8BI,UAL7C,uDAWdhJ,QAAQC,IAAR,MACA,IAAI2I,EAAY,QAAS,yDAAyDI,UAZpE,QAcf,EAAKo0B,qBAdU,yDAvEG,EAuFnBA,mBAAqB,WACpB3Y,aAAaK,QAAQjlB,EAAU,YAAY,GAC3C,EAAKwQ,SAAS,CACbkpB,YAAY,KA1FK,EA6FnB8D,YAAc,WACb,IAAIp3B,EAAQ,EAAKA,MACjBA,EAAMq3B,gBAAgBtmB,SAAU,EAChC,EAAK3G,SAAS,CACbitB,gBAAiBr3B,EAAMq3B,mBAjGN,EAoGnBC,YApGmB,sBAoGL,8BAAArtB,EAAA,sEACPX,GAAQ,KADD,WAET,EAAKiuB,cAFI,oDAGTC,EAAgBhZ,aAAa/f,QAAQ7E,EAAU,YAC9C,EAAKoG,MAAMszB,WAJH,yCAKL9U,aAAaK,QAAQjlB,EAAU,WAAYE,IALtC,UAQTA,IAAe09B,IAClB,IAAI70B,EAAY,cAAyB1I,EAAe,KAAM8I,UAC9Dyb,aAAaK,QAAQjlB,EAAU,WAAYE,IAE5C,EAAKy9B,eAAgB,EAChB,EAAKv3B,MAAMszB,WAbH,uDAcTlgB,UAAUC,UAAWD,UAAUC,QAAQC,QAd9B,kCAeYF,UAAUC,QAAQE,YAf9B,WAeRC,EAfQ,yCAgB0BJ,UAAUC,QAAQC,UAhB5C,QAgBME,EAhBN,eAiBZzZ,QAAQC,IAAIwZ,EAAc,oBAAsB,yBAjBpC,4CApGK,EAyHnBikB,SAAW,SAAC3kB,IACXA,EAAQA,EAAM1P,QACRqI,WAAY,IAAI7J,MAAOC,UACR,kBAAViR,IACX,EAAK1I,SAAS,CACbitB,gBAAiB,CAChB5rB,UAAWqH,EAAMrH,UACjBsF,SAAS,EACTlO,KAAMiQ,EAAMjQ,KACZD,MAAOkQ,EAAMlQ,SAGfwK,YAAW,WACN,EAAKpN,MAAMq3B,gBAAgB5rB,YAAcqH,EAAMrH,WACnD,EAAKrB,SAAS,CACbitB,gBAAiB,CAChB5rB,UAAW,EACXsF,SAAS,EACTlO,KAAM,GACND,MAAO,QAGPkQ,EAAMhQ,WA7IT,IAAI8Z,EAAOjiB,OAAOu1B,SAAS3Z,KAAK7Z,MAAM,KACtCkgB,EAAuB,IAAhBA,EAAK7a,OAAe,GAAK6a,EAAOA,EAAKA,EAAK7a,OAAS,GACrD5H,EAAMuM,SAASkW,KAAOA,EAAO,IAClC,IAAM0W,EAAa9U,aAAa/f,QAAQ7E,EAAU,YAC9C89B,EAAclZ,aAAa/f,QAAQ7E,EAAU,aAN/B,OAOlB89B,EAA8B,OAAhBA,EAAuB,OAASA,EAC9C,EAAK13B,MAAQ,CACZq3B,gBAAiB,CAChB5rB,UAAW,EACXsF,SAAS,EACTlO,KAAM,OACND,MAAO,SAERm0B,SAAU,CACT9C,QAAyB,SAAhByD,EACT3mB,QAAyB,SAAhB2mB,EACTlE,cAAc,EACdG,qBAAsB+B,QAAQtiB,UAAUC,SAAWD,UAAUC,QAAQC,UAEtE0jB,aAAcpa,EACd0W,WAA2B,SAAfA,GAEb,EAAKiE,eAAgB,EAxBH,E,qDA0BnB,WACC58B,OAAOqU,iBAAiB,WAAY/O,KAAKw3B,UACzCx3B,KAAKq3B,gB,+BAmCN,WACCr3B,KAAKmK,SAAS,CACb4sB,aAAc,gB,kCAGhB,WACCr8B,OAAOyU,oBAAoB,WAAYnP,KAAKw3B,Y,oBA4E7C,WACC,MAAkDx3B,KAAKD,MAA/Cq3B,EAAR,EAAQA,gBAAiB/D,EAAzB,EAAyBA,WAAYyD,EAArC,EAAqCA,SACrC,OAAO,sBAAKl4B,UAAU,QAAf,UAEN,cAAC43B,GAAD,CACC7zB,MAAOy0B,EAAgBz0B,MACvBmO,QAASsmB,EAAgBtmB,QACzBtB,QAASxP,KAAKm3B,YACdv0B,KAAMw0B,EAAgBx0B,OAEtBk0B,EAAShmB,SAAW,cAAC,GAAD,CACpB2iB,WAAYzzB,KAAKyzB,WACjB/d,WAAY1V,KAAK0V,WACjBqe,gBAAiB/zB,KAAK+zB,gBACtBX,cAAepzB,KAAKozB,cACpBC,WAAYA,EACZpzB,KAAM62B,IAEP,eAAC,KAAD,WACC,cAAC,KAAD,CAAUjE,GAAI,IAAM7yB,KAAKD,MAAMg3B,eACF,cAA5B/2B,KAAKD,MAAMg3B,aACT,cAAC,KAAD,CAAOW,OAAK,EAAC/a,KAAM,aAAnB,SACD,cAAC,GAAD,CAAWjH,WAAY1V,KAAK0V,eAE3B,qCACD,cAAC,KAAD,CAAOgiB,OAAK,EAAC/a,KAAM,aAAnB,SACC,cAAC,GAAD,CAAWjH,WAAY1V,KAAK0V,eAE7B,cAAC,KAAD,CAAOgiB,OAAK,EAAC/a,KAAK,IAAlB,SACC,cAAC,GAAD,CAAKjH,WAAY1V,KAAK0V,eAGvB,cAAC,KAAD,CAAOgiB,OAAK,EAAC/a,KAAK,YAAlB,SACC,cAAC,GAAD,CAAUjH,WAAY1V,KAAK0V,eAG5B,cAAC,KAAD,CAAOgiB,OAAK,EAAC/a,KAAK,UAAlB,SACC,cAAC,GAAD,CAAQjH,WAAY1V,KAAK0V,eAG1B,cAAC,KAAD,CAAOgiB,OAAK,EAAC/a,KAAK,aAAlB,SACC,cAACsV,GAAD,CAAevc,WAAY1V,KAAK0V,eAGjC,cAAC,KAAD,CAAOgiB,OAAK,EAAC/a,KAAK,YAAlB,SACC,cAAC,GAAD,CAAUjH,WAAY1V,KAAK0V,eAG5B,cAAC,KAAD,CAAOgiB,OAAK,EAAC/a,KAAK,QAAlB,SACC,cAAC,GAAD,CAAMjH,WAAY1V,KAAK0V,eAExB,cAAC,KAAD,CAAOgiB,OAAK,EAAC/a,KAAK,mBAAlB,SACC,cAAC,GAAD,CAAiBjH,WAAY1V,KAAK0V,qBAKtC,sBAAK9W,UAAU,gBAAf,UACC,qBAAKoC,IAAK22B,GAAW52B,IAAI,iCAD1B,gG,GA3MiBI,aAoNpBy2B,IAASC,OACR,cAAC,IAAMC,WAAP,UACC,cAAC,GAAD,MAEDp0B,SAASq0B,eAAe,SAIzB,WACC,GAAI35B,IAAS,OAAOtE,QAAQC,IAAI,SAChC,IAAIomB,EAAUzc,SAAS0c,SAAS3Z,SAAS,kBACzClI,eAAeqgB,QAAQ,QAASuB,GAIjCE,GPjOO,SAAkBwV,GACvB,GAA6C,kBAAmB1iB,UAAW,CAGzE,GADkB,IAAIwH,IAAI/gB,IAAwBc,OAAOu1B,SAAS3Z,MACpD0hB,SAAWt9B,OAAOu1B,SAAS+H,OAIvC,OAGFt9B,OAAOqU,iBAAiB,QAAQ,WAC9B,IAAM6mB,EAAK,UAAMh8B,IAAN,sBACP47B,KAgEV,SAAiCI,EAAOC,GAEtCpjB,MAAMmjB,EAAO,CACXqC,QAAS,CAAE,iBAAkB,YAE5BtlB,MAAK,SAACulB,GAEL,IAAMC,EAAcD,EAASD,QAAQG,IAAI,gBAEnB,MAApBF,EAASr4B,QACO,MAAfs4B,IAA8D,IAAvCA,EAAYhyB,QAAQ,cAG5CgN,UAAU2iB,cAAcuC,MAAM1lB,MAAK,SAACqjB,GAClCA,EAAasC,aAAa3lB,MAAK,WAC7BjY,OAAOu1B,SAASsI,eAKpB5C,GAAgBC,EAAOC,MAG1Bpc,OAAM,WACL3f,QAAQC,IAAI,oEAtFVy+B,CAAwB5C,EAAOC,GAI/B1iB,UAAU2iB,cAAcuC,MAAM1lB,MAAK,WACjC7Y,QAAQC,IACN,+GAMJ47B,GAAgBC,EAAOC,OOuM/B4C,I","file":"static/js/main.e49c9bd4.chunk.js","sourcesContent":["const appName = process.env.REACT_APP_NAME || [\"Sky\",\"Genshin\"][1]\r\nconst appVersion = '2.2'\r\nconsole.log(`${appName}-V${appVersion}`)\r\nconst updateMessage = appName === 'Genshin' \r\n    ? ` - Added sheet visualizer\r\n        - Changed timeline behaviour when dragging the scroll bar\r\n        - Changed import conversion algorithm for converting recorded to composed songs\r\n        - Improved performance\r\n    `.trim()\r\n    : ` - Added sheet visualizer\r\n        - Changed timeline behaviour when dragging the scroll bar\r\n        - Changed import conversion algorithm for converting recorded to composed songs\r\n        - Improved performance\r\n    `.trim()\r\n\r\nconst pages = [\"\", \"Composer\", \"ErrorPage\", \"Changelog\",\"Donate\", \"Partners\",\"Home\",\"Help\", \"SheetVisualizer\"]\r\n\r\nconst cssClasses = {\r\n    noteComposer: appName === \"Genshin\" ? \"note-composer\" : \"note-composer-sky\",\r\n    note: appName === \"Genshin\" ? \"note\" : \"note-sky\",\r\n    noteAnimation: appName === 'Genshin' ? \"note-animation\" : \"note-animation-sky\",\r\n    approachCircle: appName === \"Genshin\" ? \"approach-circle\" : \"approach-circle-sky\",\r\n    noteName: appName === \"Genshin\" ? \"note-name\" : \"note-name-sky\"\r\n}\r\nconst audioContext = new (window.AudioContext || window.webkitAudioContext)()\r\n\r\nconst instruments = appName === \"Genshin\" \r\n    ? [\r\n        \"Lyre\",\r\n        \"Zither\",\r\n        \"Old-Zither\",\r\n        \"DunDun\"\r\n   ]:[\r\n        \"Piano\",\r\n        \"Contrabass\",\r\n        \"Guitar\",\r\n        \"Harp\",\r\n        \"Horn\",\r\n        \"Trumpet\",\r\n        \"Pipa\",\r\n        \"WinterPiano\",\r\n        \"Xylophone\",\r\n        \"Flute\",\r\n        \"Ocarina\",\r\n        \"Kalimba\",\r\n        \"ToyUkulele\",\r\n        \"Drum\",\r\n        \"Bells\",\r\n        \"DunDun\",\r\n        \"HandPan\"\r\n    ]\r\nconst notesPerColumn = appName === \"Genshin\" ? 21 : 15\r\nconst instrumentsData = {\r\n    Lyre: {\r\n        notes: 21\r\n    },\r\n    Zither:{\r\n        notes: 21,\r\n        effects: {\r\n            filter: 'sepia(100%)',\r\n        },\r\n        clickColor: '#ddcba8'\r\n    },\r\n    \"Old-Zither\":{\r\n        notes: 21,\r\n        effects: {\r\n            filter: 'sepia(100%)',\r\n        },\r\n        clickColor: '#ddcba8'\r\n    },\r\n    DunDun: {\r\n        notes: 8\r\n    },\r\n    Bells: {\r\n        notes: 8\r\n    },\r\n    Trumpet:{\r\n        notes: 15\r\n    },\r\n    Contrabass: {\r\n        notes: 15\r\n    },\r\n    Drum: {\r\n        notes: 8\r\n    },\r\n    Flute: {\r\n        notes: 15\r\n    },\r\n    Guitar: {\r\n        notes: 15\r\n    },\r\n    HandPan: {\r\n        notes: 8\r\n    },\r\n    ToyUkulele:{\r\n        notes:15\r\n    },\r\n    Harp: {\r\n        notes: 15\r\n    },\r\n    Horn: {\r\n        notes: 15\r\n    },\r\n    Piano: {\r\n        notes: 15\r\n    },\r\n    Pipa: {\r\n        notes: 15\r\n    },\r\n    Kalimba: {\r\n        notes: 15\r\n    },\r\n    WinterPiano: {\r\n        notes: 15\r\n    },\r\n    Xylophone: {\r\n        notes: 15\r\n    },\r\n    Ocarina:{\r\n        notes:15\r\n    }\r\n}\r\n\r\n\r\nconst layoutData = {\r\n    21: {\r\n        keyboardLayout: (\"Q W E R T Y U \" +\r\n            \"A S D F G H J \" +\r\n            \"Z X C V B N M\").split(\" \"),\r\n\r\n        mobileLayout: (\"do re mi fa so la ti \" +\r\n            \"do re mi fa so la ti \" +\r\n            \"do re mi fa so la ti\").split(\" \"),\r\n\r\n        keyboardCodes: (\"81 87 69 82 84 89 85 \" +\r\n            \"65 83 68 70 71 72 74 \" +\r\n            \"90 88 67 86 66 78 77\").split(\" \")\r\n    },\r\n    8: {\r\n        keyboardLayout: (\"Q W E R \" +\r\n            \"A S D F\").split(\" \"),\r\n\r\n        mobileLayout: (\"do re mi fa \" +\r\n            \"do re mi fa\").split(\" \"),\r\n\r\n        keyboardCodes: (\"81 87 69 82 \" +\r\n        \"65 83 68 70\").split(\" \")\r\n    },\r\n    15: {\r\n        keyboardLayout: (\"Q W E R T \" +\r\n            \"A S D F G \" +\r\n            \"Z X C V B\").split(\" \"),\r\n\r\n        mobileLayout: (\"do re mi fa so \" +\r\n            \"do re mi fa so \" +\r\n            \"do re mi fa so\").split(\" \"),\r\n\r\n        keyboardCodes: (\"81 87 69 82 84 \" +\r\n            \"65 83 68 70 71 \" +\r\n            \"90 88 67 86 66\").split(\" \")\r\n    }\r\n}\r\n\r\nconst keyNames = {\r\n    Sky: {\r\n        0: [\"C\", \"D\", \"E\", \"F\", \"G\", \"A\", \"B\", \"C\", \"D\", \"E\", \"F\", \"G\", \"A\", \"B\", \"C\"],\r\n        1: [\"Db\", \"Eb\", \"F\", \"Gb\", \"Ab\", \"Bb\", \"C\", \"Db\", \"Eb\", \"F\", \"Gb\", \"Ab\", \"Bb\", \"C\", \"Db\"],\r\n        2: [\"D\", \"E\", \"F#\", \"G\", \"A\", \"B\", \"C#\", \"D\", \"E\", \"F#\", \"G\", \"A\", \"B\", \"C#\", \"D\"],\r\n        3: [\"Eb\", \"F\", \"G\", \"Ab\", \"Bb\", \"C\", \"D\", \"Eb\", \"F\", \"G\", \"Ab\", \"Bb\", \"C\", \"D\", \"Eb\"],\r\n        4: [\"E\", \"F#\", \"G#\", \"A\", \"B\", \"C#\", \"D#\", \"E\", \"F#\", \"G#\", \"A\", \"B\", \"C#\", \"D#\", \"E\"],\r\n        5: [\"F\", \"G\", \"A\", \"Bb\", \"C\", \"D\", \"E\", \"F\", \"G\", \"A\", \"Bb\", \"C\", \"D\", \"E\", \"F\"],\r\n        6: [\"Gb\", \"Ab\", \"Bb\", \"Cb\", \"Db\", \"Eb\", \"F\", \"Gb\", \"Ab\", \"Bb\", \"Cb\", \"Db\", \"Eb\", \"F\", \"Gb\"],\r\n        7: [\"G\", \"A\", \"B\", \"C\", \"D\", \"E\", \"F#\", \"G\", \"A\", \"B\", \"C\", \"D\", \"E\", \"F#\", \"G\"],\r\n        8: [\"Ab\", \"Bb\", \"C\", \"Db\", \"Eb\", \"F\", \"G\", \"Ab\", \"Bb\", \"C\", \"Db\", \"Eb\", \"F\", \"G\", \"Ab\"],\r\n        9: [\"A\", \"B\", \"C#\", \"D\", \"E\", \"F#\", \"G#\", \"A\", \"B\", \"C#\", \"D\", \"E\", \"F#\", \"G#\", \"A\"],\r\n        10: [\"Bb\", \"C\", \"D\", \"Eb\", \"F\", \"G\", \"A\", \"Bb\", \"C\", \"D\", \"Eb\", \"F\", \"G\", \"A\", \"Bb\"],\r\n        11: [\"B\", \"C#\", \"D#\", \"E\", \"F#\", \"G#\", \"A#\", \"B\", \"C#\", \"D#\", \"E\", \"F#\", \"G#\", \"A#\", \"B\"]\r\n    },\r\n    Genshin:{\r\n        0: [\"C\", \"D\", \"E\", \"F\", \"G\", \"A\", \"B\", \"C\", \"D\", \"E\", \"F\", \"G\", \"A\", \"B\", \"C\", \"D\", \"E\", \"F\", \"G\", \"A\", \"B\"],\r\n        1: [\"Db\", \"Eb\", \"F\", \"Gb\", \"Ab\", \"Bb\", \"C\", \"Db\", \"Eb\", \"F\", \"Gb\", \"Ab\", \"Bb\", \"C\", \"Db\" , \"Eb\", \"F\", \"Gb\", \"Ab\", \"Bb\", \"C\", \"Db\"],\r\n        2: [\"D\", \"E\", \"F#\", \"G\", \"A\", \"B\", \"C#\", \"D\", \"E\", \"F#\", \"G\", \"A\", \"B\", \"C#\", \"D\", \"E\", \"F#\", \"G\", \"A\", \"B\", \"C#\", \"D\"],\r\n        3: [\"Eb\", \"F\", \"G\", \"Ab\", \"Bb\", \"C\", \"D\", \"Eb\", \"F\", \"G\", \"Ab\", \"Bb\", \"C\", \"D\", \"Eb\", \"F\", \"G\", \"Ab\", \"Bb\", \"C\", \"D\", \"Eb\"],\r\n        4: [\"E\", \"F#\", \"G#\", \"A\", \"B\", \"C#\", \"D#\", \"E\", \"F#\", \"G#\", \"A\", \"B\", \"C#\", \"D#\", \"E\", \"F#\", \"G#\", \"A\", \"B\", \"C#\", \"D#\", \"E\"],\r\n        5: [\"F\", \"G\", \"A\", \"Bb\", \"C\", \"D\", \"E\", \"F\", \"G\", \"A\", \"Bb\", \"C\", \"D\", \"E\", \"F\", \"G\", \"A\", \"Bb\", \"C\", \"D\", \"E\", \"F\"],\r\n        6: [\"Gb\", \"Ab\", \"Bb\", \"Cb\", \"Db\", \"Eb\", \"F\", \"Gb\", \"Ab\", \"Bb\", \"Cb\", \"Db\", \"Eb\", \"F\", \"Gb\", \"Ab\", \"Bb\", \"Cb\", \"Db\", \"Eb\", \"F\", \"Gb\"],\r\n        7: [\"G\", \"A\", \"B\", \"C\", \"D\", \"E\", \"F#\", \"G\", \"A\", \"B\", \"C\", \"D\", \"E\", \"F#\", \"G\", \"A\", \"B\", \"C\", \"D\", \"E\", \"F#\", \"G\"],\r\n        8: [\"Ab\", \"Bb\", \"C\", \"Db\", \"Eb\", \"F\", \"G\", \"Ab\", \"Bb\", \"C\", \"Db\", \"Eb\", \"F\", \"G\", \"Ab\", \"Bb\", \"C\", \"Db\", \"Eb\", \"F\", \"G\", \"Ab\"],\r\n        9: [\"A\", \"B\", \"C#\", \"D\", \"E\", \"F#\", \"G#\", \"A\", \"B\", \"C#\", \"D\", \"E\", \"F#\", \"G#\", \"A\", \"B\", \"C#\", \"D\", \"E\", \"F#\", \"G#\", \"A\"],\r\n        10: [\"Bb\", \"C\", \"D\", \"Eb\", \"F\", \"G\", \"A\", \"Bb\", \"C\", \"D\", \"Eb\", \"F\", \"G\", \"A\", \"Bb\", \"C\", \"D\", \"Eb\", \"F\", \"G\", \"A\", \"Bb\"],\r\n        11: [\"B\", \"C#\", \"D#\", \"E\", \"F#\", \"G#\", \"A#\", \"B\", \"C#\", \"D#\", \"E\", \"F#\", \"G#\", \"A#\", \"B\", \"C#\", \"D#\", \"E\", \"F#\", \"G#\", \"A#\", \"B\"]\r\n    }\r\n}\r\nconst speedChangers = [0.25,0.5,0.75,1,1.25,1.5,2].map(e => {\r\n    return {\r\n        name: `x${e}`,\r\n        value: e\r\n    }\r\n})\r\n\r\nconst pitchArr = [\"C\", \"Db\", \"D\", \"Eb\", \"E\", \"F\", \"Gb\", \"G\", \"Ab\", \"A\", \"Bb\", \"B\"] \r\n\r\nconst composerNotePositions =  appName === \"Genshin\" ? [14, 15, 16, 17, 18, 19, 20, 7, 8, 9, 10, 11, 12, 13, 0, 1, 2, 3, 4, 5, 6].reverse() : [15,16,17,18,19,20,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14].reverse()\r\n\r\nconst importNotePositions = appName === \"Genshin\" ? [14, 15, 16, 17, 18, 19, 20, 7, 8, 9, 10, 11, 12, 13, 0] :  [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14]\r\n\r\nconst layoutImages = {\r\n    15: \"dmcr dm cr dm cr cr dm dmcr dm cr cr dm cr dm dmcr\".split(\" \"),\r\n    8: appName === \"Sky\"? \"cr dm cr dm cr dm cr dm\".split(\" \") : \"do re mi fa do re mi fa\".split(\" \"),\r\n    21: \"do re mi fa so la ti do re mi fa so la ti do re mi fa so la ti\".split(\" \")\r\n}\r\n\r\nconst cacheData = {\r\n    noteData: {\r\n        background: \"#d3bd8e\",\r\n        border: \"#de4545\",\r\n        center: \"#de4545\"\r\n    },\r\n    horizontalLineBreak: notesPerColumn / 3,\r\n    standards: [\r\n        {\r\n            color: 0x515c6f //lighter\r\n        },\r\n        {\r\n            color: 0x485363 //darker\r\n        },\r\n        {\r\n            color: 0x1a968b //selected\r\n        },\r\n        {\r\n            color: 0xd6722f\r\n        }\r\n    ],\r\n    layersCombination: [\"000\", \"001\", \"010\", \"011\", \"100\", \"101\", \"110\", \"111\"],\r\n    breakpoints: [\r\n        {\r\n            type: \"short\",\r\n            color: \"#282875\"\r\n        },\r\n        {\r\n            type: \"long\",\r\n            color: \"#282875\"\r\n        }\r\n    ]\r\n}\r\n\r\n\r\nfunction isTwa() {\r\n    let isTwa = JSON.parse(sessionStorage.getItem('isTwa'))\r\n    return isTwa\r\n}\r\nexport {\r\n    instruments,\r\n    instrumentsData,\r\n    composerNotePositions,\r\n    importNotePositions,\r\n    appName,\r\n    layoutData,\r\n    cssClasses,\r\n    notesPerColumn,\r\n    keyNames,\r\n    pitchArr,\r\n    layoutImages,\r\n    appVersion,\r\n    speedChangers,\r\n    audioContext,\r\n    pages,\r\n    isTwa,\r\n    cacheData,\r\n    updateMessage\r\n}","export default function NoteBorder(props) {\r\n    const { fill, className } = props\r\n    return <svg\r\n        width=\"156mm\"\r\n        height=\"156mm\"\r\n        className={className}\r\n        viewBox=\"0 0 156 156\"\r\n        xmlns=\"http://www.w3.org/2000/svg\"\r\n        style={{ fill: fill || '#eae5ce' }}\r\n    >\r\n        <path\r\n            d=\"M 78.00026,10.550111 C 51.476969,10.181626 25.897505,27.22936 15.85058,51.745551 5.361171,75.829889 10.788685,105.74811 29.175285,124.53663 46.865842,143.57562 76.01089,150.52219 100.41467,141.63611 125.70972,133.0432 144.35989,108.19482 145.36211,81.471209 147.04137,55.492614 131.98362,29.525813 108.70692,17.929174 99.25071,13.06968 88.62966,10.533948 78.00026,10.550111 Z m 0,0.140044 c 2.58037,3.675401 5.16075,7.3508 7.74113,11.026201 24.63414,2.976727 45.57649,23.919913 48.5469,48.555693 3.66955,2.57607 7.33909,5.15214 11.00864,7.72821 -3.6711,2.57728 -7.34219,5.15455 -11.01328,7.73183 -2.97314,24.642991 -23.92605,45.594011 -48.5712,48.558271 -2.57073,3.66162 -5.14146,7.32324 -7.71219,10.98486 -2.57073,-3.66162 -5.141461,-7.32324 -7.712192,-10.98486 -24.643357,-2.96412 -45.595396,-23.91214 -48.570678,-48.553111 -3.673332,-2.57899 -7.346667,-5.15799 -11.019999,-7.73699 3.677467,-2.58193 7.354932,-5.16386 11.0324,-7.74578 2.977996,-24.622822 23.903746,-45.560994 48.529337,-48.537607 2.580378,-3.675573 5.160752,-7.351144 7.741132,-11.026717 z\"\r\n        />\r\n    </svg>\r\n}","import React, { Component } from 'react'\r\nimport { cssClasses, appName, instrumentsData } from \"appConfig\"\r\nimport GenshinNoteBorder from 'components/GenshinNoteBorder'\r\nclass Note extends Component {\r\n    constructor(props) {\r\n        super(props)\r\n        this.state = {\r\n        }\r\n        //TODO convert this into functional component\r\n    }\r\n    render() {\r\n        const { props } = this\r\n        const { data, approachingNotes, outgoingAnimation, fadeTime } = props\r\n        const { status, approachRate, instrument } = data\r\n        const animation = {\r\n            transition: `background-color ${props.fadeTime}ms  ${fadeTime === (appName === 'Genshin' ? 100 : 200) ? 'ease' : 'linear'} , transform 0.15s, border-color 100ms`\r\n        }\r\n        const className = parseClass(status)\r\n        const effects = instrumentsData[instrument]?.effects || {}\r\n        const clickColor = instrumentsData[instrument]?.clickColor\r\n\r\n        return <button\r\n            onPointerDown={(e) => {\r\n                e.preventDefault()\r\n                props.handleClick(data)\r\n            }}\r\n            className=\"button-hitbox-bigger\"\r\n        >\r\n            {approachingNotes.map((note) => {\r\n                return <ApproachCircle\r\n                    key={note.id}\r\n                    index={data.index}\r\n                    approachRate={approachRate}\r\n                />\r\n            })}\r\n            {outgoingAnimation.map(e => {\r\n                return <div\r\n                    key={e.key}\r\n                    className={cssClasses.noteAnimation}\r\n                />\r\n            })}\r\n            <div\r\n                className={className}\r\n                style={{\r\n                    ...animation,\r\n                    ...(clickColor && status === 'clicked' ? { backgroundColor: clickColor } : {})\r\n                }}\r\n            >\r\n                <img\r\n                    draggable=\"false\"\r\n                    alt=''\r\n                    src={props.noteImage}\r\n                    style={effects}\r\n                />\r\n                {appName === 'Genshin' && <GenshinNoteBorder\r\n                    className='genshin-border'\r\n                    fill={parseBorderFill(status)}\r\n                />}\r\n                <div className={cssClasses.noteName}>\r\n                    {props.noteText}\r\n                </div>\r\n            </div>\r\n        </button>\r\n    }\r\n}\r\nfunction getApproachCircleColor(index) {\r\n    let numOfNotes = appName === \"Sky\" ? 5 : 7\r\n    let row = Math.floor(index / numOfNotes)\r\n    let colors = [\"#3da399\", \"#ffb347\", \"#3da399\"]\r\n    return colors[row]\r\n}\r\n\r\nfunction ApproachCircle(props) {\r\n    return <div\r\n        className={cssClasses.approachCircle}\r\n        style={{\r\n            animation: `approach ${props.approachRate}ms linear`,\r\n            borderColor: getApproachCircleColor(props.index),\r\n        }}\r\n    >\r\n    </div>\r\n}\r\n\r\nfunction parseBorderFill(status) {\r\n    let fill = '#eae5ce'\r\n    if (status === \"clicked\") fill = \"transparent\"\r\n    else if (status === 'toClickNext' || status === 'toClickAndNext') fill = '#63aea7'\r\n    return fill\r\n}\r\n\r\nfunction parseClass(status) {\r\n    let className = cssClasses.note\r\n    switch (status) {\r\n        case 'clicked': className += \" click-event\"; break;\r\n        case 'toClick': className += \" note-red\"; break;\r\n        case 'toClickNext': className += \" note-border-click\"; break;\r\n        case 'toClickAndNext': className += \" note-red note-border-click\"; break;\r\n        case 'approach-wrong': className += \" click-event approach-wrong\"; break;\r\n        case 'approach-correct': className += \" click-event approach-correct\"; break;\r\n        default: break;\r\n    }\r\n    return className\r\n}\r\n\r\nexport default Note","import { observable } from \"mobx\";\r\nexport const songStore = observable({\r\n    data: {\r\n        song: {},\r\n        eventType: '',\r\n        start: 0\r\n    }\r\n})","import { importNotePositions, appName, instruments, pitchArr } from \"appConfig\"\r\nimport * as workerTimers from 'worker-timers';\r\nclass Recording {\r\n\tconstructor() {\r\n\t\tthis.start = new Date().getTime()\r\n\t\tthis.notes = []\r\n\t}\r\n\tinit = () => {\r\n\t\tthis.start = new Date().getTime() - 100\r\n\t\tconsole.log(\"Started new recording\")\r\n\t}\r\n\taddNote = (index) => {\r\n\t\tif (this.notes.length === 0) this.init()\r\n\t\tlet currentTime = new Date().getTime()\r\n\t\tlet note = [index, currentTime - this.start]\r\n\t\tthis.notes.push(note)\r\n\t}\r\n}\r\n\r\nclass Song {\r\n\tconstructor(name, notes = [], data = {}) {\r\n\t\tthis.name = name\r\n\t\tthis.version = 1\r\n\t\tthis.notes = notes\r\n\t\tthis.bpm = 220\r\n\t\tthis.pitch = \"C\"\r\n\t\tthis.data = {\r\n\t\t\tisComposed: false,\r\n\t\t\tisComposedVersion: false,\r\n\t\t\tappName: appName\r\n\t\t}\r\n\t\tObject.entries(data).forEach((entry) => {\r\n\t\t\tthis.data[entry[0]] = entry[1]\r\n\t\t})\r\n\t}\r\n}\r\n\r\nclass LoggerEvent {\r\n\tconstructor(title, text, timeout) {\r\n\t\tthis.title = title\r\n\t\tthis.timeout = timeout\r\n\t\tthis.text = text\r\n\t\tif (timeout === undefined) this.timeout = 3000\r\n\t\tthis.event = new CustomEvent(\"logEvent\", {\r\n\t\t\tdetail: {\r\n\t\t\t\ttitle: this.title,\r\n\t\t\t\ttext: this.text,\r\n\t\t\t\ttimeout: this.timeout\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\ttrigger = () => {\r\n\t\twindow.dispatchEvent(this.event)\r\n\t}\r\n}\r\n\r\nclass NoteData {\r\n\tconstructor(index, noteNames, url) {\r\n\t\tthis.index = index\r\n\t\tthis.noteNames = noteNames\r\n\t\tthis.url = url\r\n\t\tthis.buffer = new ArrayBuffer(8)\r\n\t\tthis.clicked = false\r\n\t}\r\n}\r\n\r\nclass PlayingSong {\r\n\tconstructor(notes) {\r\n\t\tthis.timestamp = new Date().getTime()\r\n\t\tthis.notes = notes\r\n\t}\r\n}\r\n\r\nclass FileDownloader {\r\n\tconstructor(type) {\r\n\t\tif (type === undefined) type = \"text/json\"\r\n\t\tthis.dataType = \"data:\" + type + \";charset=utf-8,\"\r\n\t}\r\n\tdownload = (file, name) => {\r\n\t\tlet data = this.dataType + encodeURIComponent(file)\r\n\t\tvar el = document.createElement(\"a\")\r\n\t\tel.style = \"display:none\"\r\n\t\tdocument.body.appendChild(el)\r\n\t\tel.setAttribute(\"href\", data)\r\n\t\tel.setAttribute(\"download\", name)\r\n\t\tel.click();\r\n\t\tel.remove();\r\n\t}\r\n}\r\n\r\nconst TempoChangers = [\r\n\t{\r\n\t\tid: 0,\r\n\t\ttext: \"1\",\r\n\t\tchanger: 1,\r\n\t\tcolor: 0x515c6f\r\n\t}, {\r\n\t\tid: 1,\r\n\t\ttext: \"1/2\",\r\n\t\tchanger: 1 / 2,\r\n\t\tcolor: 0x517553\r\n\t}, {\r\n\t\tid: 2,\r\n\t\ttext: \"1/4\",\r\n\t\tchanger: 1 / 4,\r\n\t\tcolor: 0x434c7d\r\n\t}, {\r\n\t\tid: 3,\r\n\t\ttext: \"1/8\",\r\n\t\tchanger: 1 / 8,\r\n\t\tcolor: 0x774D6D\r\n\t}\r\n]\r\n\r\nclass ComposedSong {\r\n\tconstructor(name, notes = [], data = {}) {\r\n\t\tdata.isComposed = true\r\n\t\tdata.isComposedVersion = true\r\n\t\tthis.version = 1\r\n\t\tthis.data = data\r\n\t\tthis.name = name\r\n\t\tthis.bpm = 220\r\n\t\tthis.pitch = \"C\"\r\n\t\tthis.notes = notes\r\n\t\tthis.instruments = [instruments[0], instruments[0], instruments[0]]\r\n\t\tthis.breakpoints = [0]\r\n\t\tthis.columns = []\r\n\t\tthis.selected = 0\r\n\t\tnew Array(100).fill().forEach((e) => {\r\n\t\t\tlet column = new Column()\r\n\t\t\tcolumn.tempoChanger = 0\r\n\t\t\tthis.columns.push(column)\r\n\t\t})\r\n\t}\r\n}\r\n\r\nfunction NotesTable(length){\r\n\treturn new Array(length).fill().map(() => {return []})\r\n}\r\n\r\nfunction ComposerSongDeSerialization(song) {\r\n\tconst bpm = Number(song.bpm)\r\n\tconst obj = {\r\n\t\tdata: song.data,\r\n\t\tname: song.name,\r\n\t\tbpm: isNaN(bpm) ? 220 : bpm,\r\n\t\tpitch: song.pitch ?? \"C\",\r\n\t\tinstruments: song.instruments || [instruments[0], instruments[0], instruments[0]],\r\n\t\tbreakpoints: song.breakpoints ?? [],\r\n\t\tnotes: [],\r\n\t\tselected: 0,\r\n\t\tcolumns: []\r\n\t}\r\n\tsong.columns.forEach(column => {\r\n\t\tconst columnObj = new Column()\r\n\t\tcolumnObj.tempoChanger = column[0]\r\n\t\tcolumn[1].forEach(note => {\r\n\t\t\tcolumnObj.notes.push(new ColumnNote(note[0], note[1]))\r\n\t\t})\r\n\t\tobj.columns.push(columnObj)\r\n\t})\r\n\treturn obj\r\n}\r\n\r\nfunction ComposerToRecording(song) {\r\n\tconst recordedSong = new Song(song.name)\r\n\tconst bpmPerMs = Math.floor(60000 / song.bpm)\r\n\tlet totalTime = 100\r\n\tsong.columns.forEach(column => {\r\n\t\tcolumn[1].forEach(note => {\r\n\t\t\trecordedSong.notes.push([note[0], totalTime])\r\n\t\t})\r\n\t\ttotalTime += Math.floor(bpmPerMs * TempoChangers[column[0]].changer)\r\n\t})\r\n\treturn recordedSong\r\n}\r\n\r\nfunction ComposerSongSerialization(song) {\r\n\tconst bpm = Number(song.bpm)\r\n\tconst obj = {\r\n\t\tdata: song.data,\r\n\t\tname: song.name,\r\n\t\tbpm: isNaN(bpm) ? 220 : bpm,\r\n\t\tpitch: song.pitch,\r\n\t\tbreakpoints: song.breakpoints,\r\n\t\tinstruments: song.instruments,\r\n\t\tcolumns: []\r\n\t}\r\n\tobj.data.appName = appName\r\n\t/*\r\n\t\tnotes = [tempoChanger,notes] ----> note = [index,layer]\r\n\t\ttempoChanger = Number\r\n\t*/\r\n\tsong.columns.forEach(column => {\r\n\t\tlet columnArr = [column.tempoChanger]\r\n\t\tlet notes = column.notes.map(note => {\r\n\t\t\treturn [note.index, note.layer]\r\n\t\t})\r\n\t\tcolumnArr[1] = notes\r\n\t\tobj.columns.push(columnArr)\r\n\t})\r\n\treturn obj\r\n}\r\n\r\nfunction prepareSongDownload(song) {\r\n\tlet finalSong = JSON.parse(JSON.stringify(song)) //lose reference\r\n\tlet oldFormatNotes = {}\r\n\tif (finalSong.data?.isComposedVersion) {\r\n\t\toldFormatNotes = composedToOldFormat(finalSong)\r\n\t} else {\r\n\t\toldFormatNotes = recordedToOldFormat(finalSong)\r\n\t}\r\n\tfinalSong.isComposed = finalSong.data.isComposedVersion\r\n\tfinalSong.pitchLevel = pitchArr.indexOf(finalSong.pitch)\r\n\tfinalSong.songNotes = oldFormatNotes\r\n\tfinalSong.bitsPerPage = 16\r\n\tfinalSong.isEncrypted = false\r\n\treturn [finalSong] //for compatibility, add back to an array, it will be ignored when importing\r\n}\r\n\r\nfunction prepareSongImport(song) {\r\n\tif (Array.isArray(song) && song.length > 0) song = song[0]\r\n\tlet type = getSongType(song)\r\n\tif (type === \"none\") {\r\n\t\tnew LoggerEvent(\"Error\", \"Invalid song\").trigger()\r\n\t\tthrow new Error(\"Error Invalid song\")\r\n\t}\r\n\tif (type === \"oldSky\") {\r\n\t\tsong = oldSkyToNewFormat(song)\r\n\t}\r\n\tif (appName === 'Sky' && song.data?.appName !== 'Sky') {\r\n\t\tnew LoggerEvent(\"Error\", \"Invalid song\").trigger()\r\n\t\tthrow new Error(\"Error Invalid song\")\r\n\t}\r\n\tif (appName === 'Genshin' && song.data?.appName === 'Sky') {\r\n\t\tsong = newSkyFormatToGenshin(song)\r\n\t}\r\n\treturn song\r\n}\r\n\r\nfunction composedToOldFormat(song) {\r\n\tlet convertedNotes = []\r\n\tlet bpmPerMs = Math.floor(60000 / song.bpm)\r\n\tlet totalTime = 100\r\n\tsong.columns.forEach(column => {\r\n\t\tcolumn[1].forEach(note => {\r\n\t\t\tlet layer = 1\r\n\t\t\tif (note[1] === '111') layer = 3\r\n\t\t\tif (note[1] === '011') layer = 2\r\n\t\t\tif (note[1] === '101') layer = 3\r\n\t\t\tif (note[1] === '001') layer = 2\r\n\t\t\tif (note[1] === '110') layer = 3\r\n\t\t\tif (note[1] === '010') layer = 2\r\n\t\t\tif (note[1] === '100') layer = 1\r\n\t\t\tlet noteObj = {\r\n\t\t\t\tkey: (layer > 2 ? 2 : layer) + 'Key' + note[0],\r\n\t\t\t\ttime: totalTime\r\n\t\t\t}\r\n\t\t\tif (layer > 2) noteObj.l = 3\r\n\t\t\tconvertedNotes.push(noteObj)\r\n\t\t})\r\n\t\ttotalTime += Math.floor(bpmPerMs * TempoChangers[column[0]].changer)\r\n\t})\r\n\treturn convertedNotes\r\n}\r\n\r\nfunction recordedToOldFormat(song) {\r\n\tlet convertedNotes = []\r\n\tsong.notes.forEach(note => {\r\n\t\tconvertedNotes.push({\r\n\t\t\ttime: note[1],\r\n\t\t\tkey: \"1Key\" + note[0]\r\n\t\t})\r\n\t})\r\n\treturn convertedNotes\r\n}\r\n\r\nfunction getSongType(song) {\r\n\ttry {\r\n\t\tif (song.data === undefined) {\r\n\t\t\t//oldSky format\r\n\t\t\tsong.pitchLevel = song.pitchLevel || 0\r\n\t\t\tif (song.songNotes !== undefined) {\r\n\t\t\t\treturn \"oldSky\"\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t//current format\r\n\t\t\tif (song.data.isComposedVersion) {\r\n\t\t\t\tif (typeof song.name !== \"string\") return \"none\"\r\n\t\t\t\tif (typeof song.bpm !== \"number\") return \"none\"\r\n\t\t\t\tif (!pitchArr.includes(song.pitch)) return \"none\"\r\n\t\t\t\tif (Array.isArray(song.breakpoints)) {\r\n\t\t\t\t\tif (song.breakpoints.length > 0) {\r\n\t\t\t\t\t\tif (typeof song.breakpoints[0] !== \"number\") return \"none\"\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn \"none\"\r\n\t\t\t\t}\r\n\t\t\t\tif (Array.isArray(song.columns)) {\r\n\t\t\t\t\tif (song.columns.length > 0) {\r\n\t\t\t\t\t\tlet column = song.columns[0]\r\n\t\t\t\t\t\tif (typeof column[0] !== \"number\") return \"none\"\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn \"none\"\r\n\t\t\t\t}\r\n\t\t\t\treturn \"newComposed\"\r\n\t\t\t} else {\r\n\t\t\t\tif (typeof song.name !== \"string\") return \"none\"\r\n\t\t\t\tif (typeof song.bpm !== \"number\") return \"none\"\r\n\t\t\t\tif (!pitchArr.includes(song.pitch)) return \"none\"\r\n\t\t\t\treturn \"newRecorded\"\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t} catch (e) {\r\n\t\tconsole.log(e)\r\n\t\treturn \"none\"\r\n\t}\r\n\treturn \"none\"\r\n}\r\n\r\nconst genshinLayout = importNotePositions\r\n\r\nfunction newSkyFormatToGenshin(song) {\r\n\tif (song.data.isComposedVersion) {\r\n\t\tsong.instruments = song.instruments.map(instrument => 'Lyre')\r\n\t\tsong.columns.forEach(column => {\r\n\t\t\tcolumn[1] = column[1].map(note => {\r\n\t\t\t\treturn [genshinLayout[note[0]], note[1]]\r\n\t\t\t})\r\n\r\n\t\t})\r\n\t}\r\n\tif (!song.data.isComposedVersion) {\r\n\t\tsong.notes = song.notes.map(note => {\r\n\t\t\tnote[0] = genshinLayout[note[0]]\r\n\t\t\treturn note\r\n\t\t})\r\n\t}\r\n\treturn song\r\n}\r\n\r\nfunction oldSkyToNewFormat(song) {\r\n\tlet result = new Song(\"Error\")\r\n\ttry {\r\n\t\tconst bpm = Number(song.bpm)\r\n\t\tresult = new Song(song.name)\r\n\t\tresult.bpm = isNaN(bpm) ? 220 : bpm\r\n\t\tresult.pitch = (pitchArr[song.pitchLevel || 0]) || \"C\"\r\n\t\t//remove duplicate notes\r\n\t\tsong.songNotes = song.songNotes.filter((note, index, self) =>\r\n\t\t\tindex === self.findIndex((n) => {\r\n\t\t\t\treturn n.key.split('Key')[1] === note.key.split('Key')[1] && n.time === note.time\r\n\t\t\t})\r\n\t\t)\r\n\t\tlet songNotes = song.songNotes\r\n\t\tsongNotes.forEach(note => {\r\n\t\t\tlet data = note.key.split(\"Key\")\r\n\t\t\tresult.notes.push([genshinLayout[data[1]], note.time, note.l ?? Number(data[0])])\r\n\t\t})\r\n\r\n\t\tif ([true, \"true\"].includes(song.isComposed)) {\r\n\t\t\tresult = ComposerSongSerialization(RecordingToComposed(result))\r\n\t\t} else {\r\n\t\t\tresult.notes = result.notes.map(e => [e[0], e[1]])\r\n\t\t}\r\n\r\n\r\n\t} catch (e) {\r\n\t\tconsole.log(e)\r\n\t\treturn new Song(\"Error importing song, invalid format\")\r\n\t}\r\n\treturn result\r\n}\r\n\r\nfunction RecordingToComposed(song,precision = 4) {\r\n\tlet bpmToMs = Math.floor(60000 / song.bpm)\r\n\tlet composed = new ComposedSong(song.name, [])\r\n\tcomposed.bpm = song.bpm\r\n\tcomposed.pitch = song.pitch\r\n\tlet notes = song.notes\r\n\t//remove duplicates\r\n\tlet converted = []\r\n\tif(precision === 1 ){\r\n        let groupedNotes = []\r\n\t\tlet previousTime = notes[0][1]\r\n        while (notes.length > 0) {\r\n            let row = [notes.shift()]\r\n            let amount = 0\r\n            for (let i = 0; i < notes.length; i++) {\r\n                if (row[0][1] > notes[i][1] - bpmToMs / 9) amount++\r\n            }\r\n            groupedNotes.push([...row, ...notes.splice(0, amount)])\r\n        }\r\n        let columns = []\r\n        groupedNotes.forEach(notes => {\r\n            let note = notes[0]\r\n            if (!note) return\r\n            let elapsedTime = note[1] - previousTime\r\n            previousTime = note[1]\r\n            let emptyColumns = Math.floor((elapsedTime - bpmToMs) / bpmToMs)\r\n            if (emptyColumns > -1) new Array(emptyColumns).fill(0).forEach(() => columns.push(new Column())) // adds empty columns\r\n            let noteColumn = new Column()\r\n            noteColumn.notes = notes.map(note => {\r\n                return new ColumnNote(note[0], numberToLayer(note[2] || 0))\r\n            })\r\n            columns.push(noteColumn)\r\n        })\r\n        columns.forEach(column => { //merges notes of different layer\r\n            let groupedNotes = groupByIndex(column)\r\n            column.notes = groupedNotes.map(group => {\r\n                group[0].layer = mergeLayers(group)\r\n                return group[0]\r\n            })\r\n        })\r\n\t\tconverted = columns\r\n\t}else{\r\n\t\tlet grouped = groupByNotes(notes, bpmToMs / 9)\r\n\t\tlet combinations = [bpmToMs, Math.floor(bpmToMs / 2), Math.floor(bpmToMs / 4), Math.floor(bpmToMs / 8)]\r\n\t\tfor (let i = 0; i < grouped.length; i++) {\r\n\t\t\tlet column = new Column()\r\n\t\t\tcolumn.notes = grouped[i].map(note => {\r\n\t\t\t\tlet columnNote = new ColumnNote(note[0])\r\n\t\t\t\tif (note[2] === 0) columnNote.layer = \"100\"\r\n\t\t\t\tif (note[2] === 1) columnNote.layer = \"100\"\r\n\t\t\t\tif (note[2] === 2) columnNote.layer = \"010\"\r\n\t\t\t\tif (note[2] === 3) columnNote.layer = \"110\"\r\n\t\t\t\tif (note[2] === undefined) columnNote.layer = \"100\"\r\n\t\t\t\treturn columnNote\r\n\t\t\t})\r\n\t\t\tlet next = grouped[i + 1] || [[0, 0, 0]]\r\n\t\t\tlet difference = next[0][1] - grouped[i][0][1]\r\n\t\t\tlet paddingColumns = []\r\n\t\t\twhile (difference >= combinations[3]) {\r\n\t\t\t\tif (difference / combinations[0] >= 1) {\r\n\t\t\t\t\tdifference -= combinations[0]\r\n\t\t\t\t\tpaddingColumns.push(0)\r\n\t\t\t\t} else if (difference / combinations[1] >= 1 ) {\r\n\t\t\t\t\tdifference -= combinations[1]\r\n\t\t\t\t\tif(precision <= 1) continue\r\n\t\t\t\t\tpaddingColumns.push(1)\t\r\n\t\t\t\t} else if (difference / combinations[2] >= 1) {\r\n\t\t\t\t\tdifference -= combinations[2]\r\n\t\t\t\t\tif(precision <= 2) continue\r\n\t\t\t\t\tpaddingColumns.push(2)\r\n\t\t\t\t} else if (difference / combinations[3] >= 1) {\r\n\t\t\t\t\tdifference -= combinations[3]\r\n\t\t\t\t\tif(precision <= 3) continue\r\n\t\t\t\t\tpaddingColumns.push(3)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tlet finalPadding = []\r\n\t\t\tcolumn.tempoChanger = paddingColumns.shift() || 0\r\n\t\t\tpaddingColumns = paddingColumns.forEach((col, i) => {\r\n\t\t\t\tlet column = new Column()\r\n\t\t\t\tcolumn.tempoChanger = col\r\n\t\t\t\tfinalPadding.push(column)\r\n\t\t\t})\r\n\t\t\tconverted.push(column, ...finalPadding)\r\n\t\t}\r\n\t}\r\n\tcomposed.columns = converted\r\n\treturn composed\r\n}\r\n\r\nclass Column {\r\n\tconstructor() {\r\n\t\tthis.notes = []\r\n\t\tthis.tempoChanger = 0\r\n\r\n\t}\r\n}\r\n\r\nfunction groupByNotes(notes, threshold) {\r\n\tlet result = []\r\n\twhile (notes.length > 0) {\r\n\t\tlet row = [notes.shift()]\r\n\t\tlet amount = 0\r\n\t\tfor (let i = 0; i < notes.length; i++) {\r\n\t\t\tif (row[0][1] > notes[i][1] - threshold) amount++\r\n\t\t}\r\n\t\tresult.push([...row, ...notes.splice(0, amount)])\r\n\t}\r\n\treturn result\r\n}\r\n\r\nclass ColumnNote {\r\n\tconstructor(index, layer = \"000\") {\r\n\t\tthis.index = index\r\n\t\tthis.layer = layer\r\n\t}\r\n}\r\n\r\nfunction getPitchChanger(pitch) {\r\n\tlet index = pitchArr.indexOf(pitch)\r\n\tif (index < 0) index = 0\r\n\treturn Number(Math.pow(2, index / 12).toFixed(4))\r\n}\r\n\r\nfunction numberToLayer(number) {\r\n\tlet layer = \"100\"\r\n\tif (number === 0) layer = \"100\"\r\n\tif (number === 1) layer = \"010\"\r\n\tif (number === 2) layer = \"001\"\r\n\treturn layer\r\n}\r\n\r\nfunction mergeLayers(notes) {\r\n\tlet final = \"000\".split(\"\")\r\n\tnotes.forEach(notes => {\r\n\t\tnotes.layer.split(\"\").forEach((e, i) => {\r\n\t\t\tif (e === \"1\") final[i] = \"1\"\r\n\t\t})\r\n\t})\r\n\treturn final.join(\"\")\r\n}\r\n\r\nfunction groupByIndex(column) {\r\n\tlet notes = []\r\n\tcolumn.notes.forEach(note => {\r\n\t\tif (notes[note.index]) {\r\n\t\t\tnotes[note.index].push(note)\r\n\t\t} else {\r\n\t\t\tnotes[note.index] = [note]\r\n\t\t}\r\n\t})\r\n\treturn notes.filter(e => Array.isArray(e))\r\n}\r\n\r\nfunction delayMs(ms) {\r\n    return new Promise(resolve => {\r\n        workerTimers.setTimeout(resolve, ms)\r\n    })\r\n}\r\n\r\nexport {\r\n\tRecording,\r\n\tSong,\r\n\tNoteData,\r\n\tFileDownloader,\r\n\tLoggerEvent,\r\n\tPlayingSong,\r\n\tComposedSong,\r\n\tColumnNote,\r\n\tColumn,\r\n\tTempoChangers,\r\n\tComposerSongSerialization,\r\n\tComposerSongDeSerialization,\r\n\tComposerToRecording,\r\n\tgetPitchChanger,\r\n\tgetSongType,\r\n\toldSkyToNewFormat,\r\n\tRecordingToComposed,\r\n\tprepareSongDownload,\r\n\tnewSkyFormatToGenshin,\r\n\tprepareSongImport,\r\n\tpitchArr,\r\n\tgroupByNotes,\r\n\tnumberToLayer,\r\n\tmergeLayers,\r\n\tgroupByIndex,\r\n\tdelayMs,\r\n\tNotesTable\r\n}","import { memo } from 'react'\r\n\r\nexport default memo(({children}) => {\r\n    return <>\r\n        {children}\r\n    </>\r\n},(prev,next) => {\r\n    if(next.children.key !== null || prev.children.key !== null) return prev.children.key === next.children.key\r\n    return prev.children !== undefined \r\n})","import React, { Component } from 'react'\r\nimport { observe } from 'mobx'\r\nimport { FaSyncAlt, FaStop } from 'react-icons/fa'\r\nimport { keyNames, pitchArr, layoutImages, appName, layoutData,speedChangers } from \"appConfig\"\r\nimport Note from \"./Components/Note\"\r\nimport { songStore } from './SongStore'\r\nimport { delayMs, ComposerToRecording, NotesTable } from \"lib/Utils\"\r\nimport Memoized from 'components/Memoized'\r\nimport \"./Keyboard.css\"\r\n\r\nclass Keyboard extends Component {\r\n    constructor(props) {\r\n        super(props)\r\n        let propKeyboard = this.props.data.keyboard\r\n        propKeyboard.layout.forEach(note => { note.status = '' })\r\n        this.state = {\r\n            playTimestamp: new Date().getTime(),\r\n            songToPractice: [],\r\n            approachingNotes: NotesTable(appName === 'Sky' ? 15 : 21),\r\n            outgoingAnimation: NotesTable(appName === 'Sky' ? 15 : 21),\r\n            keyboard: propKeyboard.layout,\r\n            sliderState: {\r\n                position: 0,\r\n                size: 0\r\n            },\r\n            approachingScore: {\r\n                correct: 1,\r\n                wrong: 1,\r\n                score: 0,\r\n                combo: 0\r\n            },\r\n\t\t\tspeedChanger: speedChangers.find(e => e.name === 'x1'),\r\n        }\r\n        this.approachRate = 1500\r\n        this.approachingNotesList = []\r\n        this.songTimestamp = 0\r\n        this.nextChunkDelay = 0\r\n        this.disposeStore = () => { }\r\n        this.tickTime = 50\r\n        this.tickInterval = 0\r\n    }\r\n\r\n    componentDidMount() {\r\n        window.addEventListener('keydown', this.handleKeyboard)\r\n        this.tickInterval = setInterval(this.tick, this.tickTime)\r\n        this.disposeStore = observe(songStore, async (data) => {\r\n            let value = data.object.data\r\n            let type = value.eventType\r\n            let lostReference = JSON.parse(JSON.stringify(value.song))\r\n            if (lostReference.data?.isComposedVersion) {\r\n                lostReference = ComposerToRecording(lostReference)\r\n            }\r\n            lostReference.timestamp = new Date().getTime()\r\n            let hasSong = false\r\n            if (type === 'play') {\r\n                await this.stopSong()\r\n                this.playSong(lostReference, value.start)\r\n                hasSong = true\r\n            }\r\n            if (type === 'practice') {\r\n                await this.stopSong()\r\n                this.practiceSong(lostReference, value.start)\r\n                hasSong = true\r\n            }\r\n            if (type === 'approaching') {\r\n                await this.stopSong()\r\n                this.approachingSong(lostReference, value.start)\r\n                hasSong = true\r\n            }\r\n            if (type === 'stop') await this.stopSong()\r\n            this.props.functions.setHasSong(hasSong)\r\n        })\r\n    }\r\n    componentWillUnmount() {\r\n        window.removeEventListener('keydown', this.handleKeyboard)\r\n        this.disposeStore()\r\n        this.songTimestamp = 0\r\n        clearInterval(this.tickInterval)\r\n    }\r\n\r\n    approachingSong = async (song) => {\r\n        let notes = []\r\n        this.approachRate = this.props.data.approachRate || 1500 \r\n        let startDelay = this.approachRate\r\n        song.notes.forEach(note => {\r\n            let obj = {\r\n                time: Math.floor(note[1] / this.state.speedChanger.value + startDelay),\r\n                index: note[0]\r\n            }\r\n            notes.push(obj)\r\n        })\r\n        this.setState({\r\n            approachingNotes: NotesTable(appName === 'Sky' ? 15 : 21),\r\n            approachingScore: {\r\n                correct: 1,\r\n                wrong: 1,\r\n                score: 0,\r\n                combo: 0\r\n            }\r\n        })\r\n        this.changeSliderState(0, notes.length)\r\n        this.approachingNotesList = notes\r\n    }\r\n\r\n    tick = () => {\r\n        if (!this.props.data.hasSong) return\r\n        const { approachingNotes, sliderState, approachingScore , speedChanger} = this.state\r\n        let stateNotes = approachingNotes\r\n        let notes = this.approachingNotesList\r\n        notes.forEach(note => {\r\n            note.time -= this.tickTime\r\n        })\r\n        let hasChanges = false\r\n        let removed = 0\r\n        for (let i = 0; i < notes.length; i++) {\r\n            if (notes[i].time < this.approachRate) {\r\n                stateNotes[notes[i].index].push({\r\n                    clicked: false,\r\n                    time: this.approachRate,\r\n                    id: Math.floor(Math.random() * 10000)\r\n                })\r\n                notes.splice(i, 1)\r\n                i--\r\n                hasChanges = true\r\n            } else {\r\n                break\r\n            }\r\n        }\r\n        stateNotes.forEach(note => {\r\n            for (let i = 0; i < note.length; i++) {\r\n                let apNote = note[i]\r\n                apNote.time -= this.tickTime\r\n                if (apNote.clicked) {\r\n                    if (apNote.time < this.approachRate / 3) {\r\n                        approachingScore.correct++\r\n                        approachingScore.combo++\r\n                        approachingScore.score += approachingScore.combo * speedChanger.value\r\n                    } else {\r\n                        approachingScore.wrong++\r\n                        approachingScore.combo = 0\r\n                    }\r\n                    apNote.time = -1 //so that it can be removed after\r\n                }\r\n                if (apNote.time < 0) {\r\n                    if (!apNote.clicked) {\r\n                        approachingScore.wrong++\r\n                        approachingScore.combo = 0\r\n                    }\r\n                    note.splice(i, 1)\r\n                    i--\r\n                    hasChanges = true\r\n                    removed++\r\n                }\r\n            }\r\n        })\r\n        if (!hasChanges) return\r\n        this.changeSliderState(sliderState.position + removed)\r\n        this.setState({\r\n            approachingNotes: stateNotes,\r\n            approachingScore: approachingScore\r\n        })\r\n    }\r\n\r\n    playSong = async (song, start = 0) => {\r\n        this.songTimestamp = song.timestamp\r\n        const { keyboard } = this.state\r\n        let notes = this.applySpeedChange(song.notes)\r\n        if (notes.length === 0) return\r\n        let previous = notes[0][1]\r\n        let pastError = 0\r\n        let previousTime = new Date().getTime()\r\n        for (let i = start; i < notes.length; i++) {\r\n            let delay = notes[i][1] - previous\r\n            previous = notes[i][1]\r\n            let note = notes[i][0]\r\n            previousTime = new Date().getTime()\r\n            if (delay > 16) await delayMs(delay - pastError)\r\n            if (this.songTimestamp !== song.timestamp) return\r\n            keyboard[note].status = 'clicked'\r\n            this.handleClick(keyboard[note])\r\n            this.setState({\r\n                keyboard,\r\n                sliderState: {\r\n                    position: i+1,\r\n                    size: notes.length\r\n                }\r\n            })\r\n            pastError = new Date().getTime() - previousTime - delay\r\n        }\r\n\r\n    }\r\n    applySpeedChange = (notes) => {\r\n        return notes.map(note => {\r\n            note[1] = note[1] / this.state.speedChanger.value\r\n            return note\r\n        })\r\n    }\r\n    practiceSong = (song, start = 0) => {\r\n        const { keyboard } = this.state\r\n        let notes = this.applySpeedChange(song.notes)\r\n        let songLength = notes.length\r\n        notes.splice(0, start)\r\n        let chunks = []\r\n        let previousChunkDelay = 0\r\n        for (let i = 0; notes.length > 0; i++) {\r\n            let chunk = {\r\n                notes: [notes.shift()],\r\n                delay: 0\r\n            }\r\n            let startTime = chunk.notes.length > 0 ? chunk.notes[0][1] : 0\r\n            for (let j = 0; j < notes.length && j < 20; j++) {\r\n                let difference = notes[j][1] - chunk.notes[0][1] - 50 //TODO add threshold here\r\n                if (difference < 0) {\r\n                    chunk.notes.push(notes.shift())\r\n                    j--\r\n                }\r\n            }\r\n            chunk.delay = previousChunkDelay\r\n            previousChunkDelay = notes.length > 0 ? notes[0][1] - startTime : 0\r\n            chunks.push(chunk)\r\n        }\r\n        if (chunks.length === 0) return\r\n        let firstChunk = chunks[0]\r\n        this.nextChunkDelay = 0\r\n        let secondChunk = chunks[1]\r\n        firstChunk.notes.forEach(note => { \r\n            keyboard[note[0]].status = 'toClick' \r\n            keyboard[note[0]].delay = appName === 'Genshin' ? 100 : 200\r\n        })\r\n        secondChunk?.notes.forEach(note => {\r\n            let keyboardNote = keyboard[note[0]]\r\n            if (keyboardNote.status === 'toClick') return keyboardNote.status = 'toClickAndNext'\r\n            keyboardNote.status = 'toClickNext'\r\n        })\r\n        this.props.functions.setHasSong(true)\r\n        this.setState({\r\n            songToPractice: chunks,\r\n            keyboard,\r\n            sliderState: {\r\n                position: start,\r\n                size: songLength\r\n            }\r\n        })\r\n    }\r\n    handleSpeedChanger = (value) =>{\r\n        let changer = speedChangers.find(e => e.name === value)\r\n        this.setState({\r\n            speedChanger: changer\r\n        },this.restartSong)\r\n    }\r\n    restartSong =async (override) => {\r\n        let lostReference = JSON.parse(JSON.stringify(songStore.data))\r\n        const { sliderState } = this.state\r\n        await this.stopSong()\r\n        setTimeout(() => {\r\n            let start = songStore.data.start\r\n            if (songStore.data.eventType === 'practice'){\r\n                start = sliderState.position === sliderState.size ? 0 : sliderState.position\r\n            }\r\n            songStore.data = {\r\n                ...lostReference,\r\n                start: Number.isInteger(override) ? override : start\r\n            }\r\n        }, 200)\r\n    }\r\n    stopSong = () => {\r\n        return new Promise(res => {\r\n            this.songTimestamp = 0\r\n            const { keyboard } = this.state\r\n            keyboard.forEach(note => {\r\n                note.status = ''\r\n                note.delay = appName === 'Genshin' ? 100 : 200\r\n            })\r\n            this.approachingNotesList = []\r\n            this.setState({\r\n                keyboard,\r\n                songToPractice: [],\r\n                approachingNotes: NotesTable(appName === 'Sky' ? 15 : 21)\r\n            }, res)\r\n\r\n            this.props.functions.setHasSong(false)\r\n        })\r\n\r\n    }\r\n    handleSliderEvent = (event) => {\r\n        this.changeSliderState(Number(event.target.value))\r\n    }\r\n    changeSliderState = async (position, size = this.state.sliderState.size) => {\r\n        this.setState({\r\n            sliderState: {\r\n                position,\r\n                size\r\n            }\r\n        })\r\n    }\r\n    handleKeyboard =async (event) => {\r\n        const { keyboard } = this.state\r\n        if (event.repeat) return\r\n        if (document.activeElement.tagName === \"INPUT\") return\r\n        if(event.shiftKey){\r\n            switch(event.code){\r\n                case \"KeyR\" : {\r\n                    if(!this.props.data.hasSong) return\r\n                    if(['practice','playing','approaching'].includes(songStore.data.eventType)){\r\n                       return this.restartSong(0)\r\n                    }\r\n                    break;\r\n                }\r\n                case \"KeyS\" : {\r\n                    if(!this.props.data.hasSong) return\r\n                    await this.stopSong()\r\n                    return songStore.data = returnStopSong()\r\n                }\r\n                default: break;\r\n            }\r\n        }else{\r\n            let code = event.code?.replace(\"Key\", \"\")\r\n            let index = this.props.data.keyboard.getNoteFromCode(code)\r\n            let note = keyboard[index]\r\n            if (note) this.handleClick(note)\r\n        }\r\n\r\n    }\r\n\r\n    handleApproachClick = (note) => {\r\n        const { approachingNotes } = this.state\r\n        let approachingNote = approachingNotes[note.index][0]\r\n        if (approachingNote) {\r\n            approachingNote.clicked = true\r\n            if(approachingNote.time < this.approachRate / 3) return \"approach-correct\"\r\n        }\r\n        return \"approach-wrong\"\r\n    }\r\n    handlePracticeClick = (note) => {\r\n        const { keyboard, songToPractice, sliderState } = this.state\r\n        if (songToPractice.length > 0) {\r\n            let indexClicked = songToPractice[0]?.notes.findIndex(e => e[0] === note.index)\r\n            if (indexClicked !== -1) {\r\n                songToPractice[0].notes.splice(indexClicked, 1)\r\n                if (songToPractice[0].notes.length === 0) songToPractice.shift()\r\n                if (songToPractice.length > 0) {\r\n                    let nextChunk = songToPractice[0]\r\n                    let nextNextChunk = songToPractice[1]\r\n                    nextChunk.notes.forEach(note => {\r\n                        keyboard[note[0]].status = 'toClick'\r\n                        keyboard[note[0]].delay = nextChunk.delay\r\n                    })\r\n\r\n                    if(nextNextChunk){\r\n                        nextNextChunk?.notes.forEach(note => {\r\n                            let keyboardNote = keyboard[note[0]]\r\n                            if (keyboardNote.status === 'toClick') return keyboardNote.status = 'toClickAndNext'\r\n                            keyboardNote.status = 'toClickNext'\r\n                        })\r\n                    }\r\n                }\r\n                this.setState({\r\n                    songToPractice: songToPractice,\r\n                    sliderState: {\r\n                        size: sliderState.size,\r\n                        position: sliderState.position + 1\r\n                    }\r\n                })\r\n            }\r\n        }\r\n    }\r\n    handleClick = (note, onlySound) => {\r\n        const { keyboard, outgoingAnimation} = this.state\r\n        const hasAnimation = this.props.data.hasAnimation\r\n        keyboard[note.index].status = 'clicked'\r\n        keyboard[note.index].delay = appName === 'Genshin' ? 100 : 200\r\n        this.handlePracticeClick(note)\r\n        let approachStatus = this.handleApproachClick(note)\r\n        if(songStore.data.eventType === 'approaching'){\r\n            keyboard[note.index].status = approachStatus\r\n        }\r\n        if(hasAnimation && songStore.data.eventType !=='approaching'){\r\n            let key = Math.floor(Math.random() * 10000) + new Date().getTime()\r\n            outgoingAnimation[note.index].push({key})\r\n        }\r\n        this.setState({ keyboard,\r\n            ...(hasAnimation? outgoingAnimation : {})\r\n        },() => {\r\n            setTimeout(() => {\r\n                if(!hasAnimation || songStore.data.eventType === 'approaching') return\r\n                const {outgoingAnimation} = this.state\r\n                outgoingAnimation[note.index].shift()\r\n                this.setState({outgoingAnimation})\r\n            },750)\r\n        })\r\n        setTimeout(() => {\r\n            if (!['clicked','approach-wrong','approach-correct'].includes(keyboard[note.index].status)) return\r\n            keyboard[note.index].status = ''\r\n            this.setState({ keyboard })\r\n        },appName === 'Sky' ? 200 : 100)\r\n        this.props.functions.playSound(note)\r\n    }\r\n    render() {\r\n        const { state, props } = this\r\n        const { data } = props\r\n        const { keyboard, approachingScore } = state\r\n        let size = data.keyboardSize / 100\r\n        if (size < 0.5) size = 0.5\r\n        if (size > 1.5) size = 1.5\r\n        let keyboardClass = \"keyboard\"\r\n        if (keyboard.length === 15) keyboardClass += \" keyboard-5\"\r\n        if (keyboard.length === 8) keyboardClass += \" keyboard-4\"\r\n        return <>\r\n            {data.hasSong &&\r\n                <div className=\"upper-right\">\r\n                    {songStore.data.eventType === 'approaching' &&\r\n                        <Score data={approachingScore} />\r\n                    }\r\n\r\n                    <div className=\"slider-wrapper\">\r\n                        <button className=\"song-button\" onClick={() => {\r\n                            this.stopSong()\r\n                            songStore.data = returnStopSong()\r\n                        }\r\n                        }>\r\n                            <Memoized>\r\n                                <FaStop />\r\n                            </Memoized>\r\n                        </button>\r\n                        <input\r\n                            type=\"range\"\r\n                            className=\"slider\"\r\n                            min={0}\r\n                            onChange={this.handleSliderEvent}\r\n                            max={state.sliderState.size}\r\n                            value={state.sliderState.position}\r\n                        ></input>\r\n                        <button className=\"song-button\" onClick={() => {\r\n                            this.restartSong()\r\n                        }}>\r\n                            <Memoized>\r\n                                <FaSyncAlt />\r\n                            </Memoized>\r\n                        </button>\r\n                        <select \r\n                            className='slider-select'\r\n                            onChange={(e) => this.handleSpeedChanger(e.target.value)}\r\n                            value={state.speedChanger.name}\r\n                        >\r\n                            <option disabled>Speed</option>\r\n                            {speedChangers.map(e => {\r\n                                return <option value={e.name} key={e.name}>\r\n                                    {e.name}\r\n                                </option>\r\n                            })}\r\n                        </select>\r\n                    </div>\r\n                </div>\r\n            }\r\n            <div\r\n                className={keyboardClass}\r\n                style={{\r\n                    transform: `scale(${size})`,\r\n                    marginBottom: size * 30 - 15\r\n                }}\r\n            >\r\n                {data.isLoading \r\n                    ? <div className=\"loading\">Loading...</div> \r\n                    \r\n                    : keyboard.map(note => {\r\n                        let noteImage = layoutImages[keyboard.length][note.index]\r\n                        let noteData = {\r\n                            ...note,\r\n                            approachRate:this.approachRate,\r\n                            instrument: this.props.data.keyboard.instrumentName,\r\n                            isAnimated: songStore.data.eventType === 'approaching' ? false : this.props.data.hasAnimation\r\n                        }\r\n                        return <Note\r\n                            key={note.index}\r\n                            data={noteData}\r\n                            approachingNotes={state.approachingNotes[note.index]}\r\n                            outgoingAnimation={state.outgoingAnimation[note.index]}\r\n                            fadeTime={note.delay}\r\n                            handleClick={this.handleClick}\r\n                            noteText={getNoteText(data.noteNameType, note.index, data.pitch, keyboard.length)}\r\n                            noteImage={`./assets/icons/keys/${noteImage}.svg`}\r\n                        />\r\n    \r\n                    })\r\n                }\r\n\r\n            </div>\r\n        </>\r\n\r\n\r\n    }\r\n}\r\nfunction Score(props) {\r\n    const { combo, score, correct, wrong} = props.data\r\n    return <div className='approaching-accuracy'>\r\n        <table>\r\n            <tbody>\r\n                <tr>\r\n                    <td className='sc-2'>Accuracy</td>\r\n                    <td className='sc-1'>{(correct / (correct + wrong - 1) * 100 ).toFixed(1)}%</td>\r\n                </tr>\r\n                <tr>\r\n                    <td className='sc-2'>Score</td>\r\n                    <td className='sc-1'>{score}</td>\r\n                </tr>\r\n                <tr>\r\n                    <td className='sc-2'>Combo</td>\r\n                    <td className='sc-1'>{combo}</td>\r\n                </tr>\r\n            </tbody>\r\n        </table>\r\n    </div>\r\n\r\n\r\n\r\n}\r\nfunction returnStopSong() {\r\n    return {\r\n        song: {},\r\n        eventType: 'stop',\r\n        start: 0\r\n    }\r\n}\r\n\r\nfunction getNoteText(noteNameType, index, pitch, layoutLength) {\r\n    try {\r\n        if (noteNameType === \"Note name\") return keyNames[appName][pitchArr.indexOf(pitch)][index]\r\n        if (noteNameType === \"Keyboard layout\") return layoutData[layoutLength].keyboardLayout[index]\r\n        if (noteNameType === \"Do Re Mi\") return layoutData[layoutLength].mobileLayout[index]\r\n    } catch (e) { }\r\n    return ''\r\n}\r\nexport default Keyboard","export default __webpack_public_path__ + \"static/media/mainpage.53c2a740.png\";","export default __webpack_public_path__ + \"static/media/composer.69d0b59e.png\";","export default __webpack_public_path__ + \"static/media/songs.4892a692.png\";","import mainPageImg from 'assets/images/mainpage.png'\r\nimport composerImg from 'assets/images/composer.png'\r\nimport songsImg from 'assets/images/songs.png'\r\nimport { FaCrosshairs, FaDownload } from 'react-icons/fa'\r\nimport { BsCircle } from 'react-icons/bs'\r\nimport isMobile from 'is-mobile'\r\nimport './HelpComponent.css'\r\nexport function HelpTab() {\r\n    return <>\r\n        <div className='help-title'>\r\n            Main page\r\n        </div>\r\n        <div>\r\n            <img src={mainPageImg} className='help-img' alt='tutorial for the main page' />\r\n            <ol>\r\n                <li>Record the keyboard as an audio file</li>\r\n                <li>Current note position, you can change it to reload</li>\r\n                <li>Playback speed</li>\r\n                <li>Approaching circles score</li>\r\n                <li>Approaching circle, click when it's close to the note</li>\r\n            </ol>\r\n        </div>\r\n        {\r\n            !isMobile() && <>\r\n                <div className='help-title'>\r\n                    Main page shortcuts\r\n                </div>\r\n                <div className='help-margin-left'>\r\n                    <div style={{ marginBottom: '0.5rem' }}>\r\n                        The main page has shortcuts for PC users:\r\n                    </div>\r\n                    <table className='keys-table'>\r\n                        <tbody>\r\n                            <tr>\r\n                                <td><Key>Shift + R</Key></td><td>reload song </td>\r\n                            </tr>\r\n                            <tr>\r\n                                <td><Key>Shift + R</Key></td><td>Start/Stop recording when there are no songs playing</td>\r\n                            </tr>\r\n                            <tr>\r\n                                <td><Key>Shift + M</Key></td><td>Open/Close the menu</td>\r\n                            </tr>\r\n                            <tr>\r\n                                <td><Key>Esc</Key></td><td> Close the menu </td>\r\n                            </tr>\r\n                            <tr>\r\n                                <td><Key>Shift + S</Key></td><td>stop song </td>\r\n                            </tr>\r\n                        </tbody>\r\n                    </table>\r\n                </div>\r\n\r\n            </>\r\n        }\r\n\r\n        <div className='help-title'>\r\n            Songs menu\r\n        </div>\r\n        <div>\r\n            <img src={songsImg} className='help-img' alt='tutorial for songs page' />\r\n            <ol>\r\n                <li>Open composer to create a song</li>\r\n                <li>Import song (as json)</li>\r\n                <li>Play song (click the name)</li>\r\n                <li>Practice the song</li>\r\n                <li>Play with the approaching circles mode</li>\r\n                <li>Download the song (as json)</li>\r\n            </ol>\r\n            <div className=\"column\">\r\n                <div>\r\n                    <FaCrosshairs /> = practice the song\r\n                </div>\r\n                <div>\r\n                    <BsCircle /> = Approaching circles mode\r\n                </div>\r\n                <div>\r\n                    <FaDownload /> = download the song\r\n                </div>\r\n\r\n            </div>\r\n        </div>\r\n\r\n        <div className='help-title'>\r\n            Composer\r\n        </div>\r\n        <div>\r\n            <img src={composerImg} className='help-img' alt=\"tutorial for composer\" />\r\n            <ol>\r\n                <li>Go to the next / previous breakpoint</li>\r\n                <li>Timeline of the breakpoints</li>\r\n                <li>Open the tools</li>\r\n                <li>Add 16 columns to the end</li>\r\n                <li>Remove the current selected column</li>\r\n                <li>Add column after the current one</li>\r\n                <li>Change layer (instrument)</li>\r\n                <li>Change column's duration</li>\r\n            </ol>\r\n        </div>\r\n\r\n        {\r\n            !isMobile() && <>\r\n                <div className='help-title'>\r\n                    Composer shortcuts\r\n                </div>\r\n                <div className='help-margin-left'>\r\n\r\n                    <div style={{ marginBottom: '0.5rem' }}>\r\n                        The composer has shortcuts for PC users:\r\n                    </div>\r\n                    <table>\r\n                        <tbody>\r\n                            <tr>\r\n                                <td><Key>A / D</Key></td><td>move left / right</td>\r\n                            </tr>\r\n                            <tr>\r\n                                <td><Key>1 / 2 / 3 / 4</Key></td><td>change tempo</td>\r\n                            </tr>\r\n                            <tr>\r\n                                <td><Key>Space bar</Key></td><td>play / pause song</td>\r\n                            </tr>\r\n                            <tr>\r\n                                <td><Key>Arrow Left</Key></td><td>go to previous breakpoint</td>\r\n                            </tr>\r\n                            <tr>\r\n                                <td><Key>Arrow Right</Key></td><td>go to next breakpoint</td>\r\n                            </tr>\r\n                            <tr>\r\n                                <td><Key>Arrow Up</Key></td><td>select previous layer</td>\r\n                            </tr>\r\n                            <tr>\r\n                                <td><Key>Arrow Down</Key></td><td>select next layer </td>\r\n                            </tr>\r\n                            <tr>\r\n                                <td><Key>Shift + Note</Key></td><td>Adds/remove a note in the column </td>\r\n                            </tr>\r\n                            <tr>\r\n                                <td><Key>Q</Key></td><td>remove current column</td>\r\n                            </tr>\r\n                            <tr>\r\n                                <td><Key>E</Key></td><td>add column </td>\r\n                            </tr>\r\n                        </tbody>\r\n                    </table>\r\n                    When playing a song, you can press on the PC keyboard to add notes\r\n                    <div style={{ marginBottom: \"1rem\" }}>\r\n\r\n                    </div>\r\n                </div>\r\n\r\n            </>\r\n        }\r\n    </>\r\n}\r\n\r\n\r\nfunction Key(props) {\r\n    return <div className='keyboard-key'>\r\n        {props.children}\r\n    </div>\r\n}","import { memo } from \"react\"\r\nexport default memo(function MenuItem(props) {\r\n    const { className, action, children, type } = props\r\n    return <div\r\n        className={className ? `menu-item ${className}` : \"menu-item\"}\r\n        onClick={() => action?.(type)}\r\n    >\r\n        {children}\r\n    </div>\r\n},(prev,next) => {\r\n    if(next.children.key !== null || prev.children.key !== null) return prev.children.key === next.children.key\r\n    return prev.children !== undefined && prev.className === next.className\r\n})","export default function MenuPanel(props) {\r\n    let className = props.visible === props.title ? \"menu-panel menu-panel-visible\" : \"menu-panel\"\r\n    return <div className={className}>\r\n        <div className=\"menu-title\">\r\n            {props.title}\r\n        </div>\r\n        <div className=\"panel-content-wrapper\">\r\n            {props.children}\r\n        </div>\r\n    </div>\r\n}","import { FaTimes } from 'react-icons/fa'\r\nexport default function MenuClose(props) {\r\n    return <div onClick={() => props.action(false)} className=\"close-menu menu-item\">\r\n        <FaTimes className=\"icon\" />\r\n    </div>\r\n}","import './switch.css'\r\n\r\nexport default function Switch({checked, onChange}){\r\n    return <div className=\"switch-wrapper\" onClick={() => onChange(!checked)}>\r\n        <div className={`switch-inner ${checked ? 'switch-inner-on' : ''}`}>\r\n           \r\n        </div>\r\n    </div>\r\n}","import { useState, useEffect,memo } from 'react'\r\nimport Switch from 'components/Switch'\r\nexport default memo(function SettingsRow({ data, update, objKey, changeVolume }) {\r\n    const [valueHook, setter] = useState(data.value)\r\n    const [volumeHook, setterVolume] = useState(data.volume)\r\n    useEffect(() => {\r\n        setter(data.value)\r\n    },[data.value])\r\n\r\n    function handleChange(e) {\r\n        const el = e.target\r\n        let value = el.value\r\n        if (data.type === \"number\") {\r\n            value = Number(value)\r\n            el.value = \"\" //have to do this to remove a react bug that adds a 0 at the start\r\n            if (value < data.threshold[0] || value > data.threshold[1])  return\r\n        }\r\n        setter(value)\r\n    }\r\n\r\n    function handleCheckbox(value){\r\n        update({\r\n            key: objKey,\r\n            data: {...data, value}\r\n        }) \r\n        setter(value)\r\n    }\r\n\r\n    function sendChange() {\r\n        if (data.value === valueHook) return\r\n        let obj = {\r\n            key: objKey,\r\n            data: {...data, value: valueHook}\r\n        }\r\n        update(obj)\r\n    }\r\n    function sendChangeSelect(e) {\r\n        let value = e.target.value\r\n        let obj = {\r\n            key: objKey,\r\n            data: {...data, value}\r\n        }\r\n        update(obj)\r\n    }\r\n\r\n    function handleVolume(e) {\r\n        setterVolume(Number(e.target.value))\r\n    }\r\n\r\n    function sendVolumeChange() {\r\n        changeVolume({\r\n            key: objKey,\r\n            value: volumeHook\r\n        })\r\n    }\r\n\r\n    if (objKey === \"settingVesion\") return null\r\n    return <div className=\"settings-row\">\r\n        <div>\r\n            {data.name}\r\n        </div>\r\n\r\n        {data.type === \"select\"\r\n            && <select value={data.value}\r\n                onChange={sendChangeSelect}\r\n            >\r\n                {data.options.map(e => {\r\n                    return <option value={e} key={e}>{e}</option>\r\n                })}\r\n            </select>\r\n        }\r\n\r\n        {[\"number\", \"text\"].includes(data.type) &&\r\n            <input\r\n                type={data.type}\r\n                value={valueHook}\r\n                placeholder={data.placeholder || \"\"}\r\n                onBlur={sendChange}\r\n                onChange={handleChange}\r\n            />\r\n        }\r\n\r\n        {data.type === 'checkbox' && \r\n            <Switch \r\n                checked={valueHook}\r\n                onChange={handleCheckbox}\r\n            />\r\n        }\r\n\r\n        {data.type === \"instrument\" &&\r\n            <div className=\"instrument-picker\">\r\n                <select value={data.value}\r\n                    onChange={sendChangeSelect}\r\n                >\r\n                    {data.options.map(e => {\r\n                        return <option value={e} key={e}>{e}</option>\r\n                    })}\r\n                </select>\r\n                <input\r\n                    type=\"range\"\r\n                    min={1}\r\n                    max={100}\r\n                    value={volumeHook}\r\n                    onChange={handleVolume}\r\n                    onPointerUp={sendVolumeChange}\r\n                />\r\n            </div>\r\n        }\r\n    </div>\r\n},(p,n) => {\r\n    return p.data.value === n.data.value\r\n        && p.data.volume === n.data.volume\r\n        && p.update === n.update\r\n})","export default function DonateButton(props){\r\n    return <div className=\"donate-button\" onClick={() => props.onClick(\"Donate\")}>\r\n        Donate\r\n    </div>\r\n}","import { useState } from 'react'\r\nimport { FaDownload, FaSpinner } from 'react-icons/fa';\r\nimport { LoggerEvent, prepareSongImport } from \"lib/Utils\"\r\n\r\nexport default function SearchedSong(props) {\r\n    const { functions, data, songStore } = props\r\n    const { importSong } = functions\r\n    const [fetching, setFetching] = useState(false)\r\n    const [cache, setCache] = useState(undefined)\r\n    const download = async function () {\r\n        if (fetching) return\r\n        try {\r\n            if (cache) return importSong(cache)\r\n            setFetching(true)\r\n            let song = await fetch('https://sky-music.herokuapp.com/api/songs?get=' + encodeURI(data.file)).then(data => data.json())\r\n            setFetching(false)\r\n            song = prepareSongImport(song)\r\n            setCache(song)\r\n            importSong(song)\r\n        } catch (e) {\r\n            setFetching(false)\r\n            console.error(e)\r\n            new LoggerEvent(\"Error\", \"Error downloading song\").trigger()\r\n        }\r\n    }\r\n    const play = async function () {\r\n        if (fetching) return\r\n        try {\r\n            if (cache) {\r\n                return songStore.data = {\r\n                    eventType: 'play',\r\n                    song: cache,\r\n                    start: 0\r\n                }\r\n            }\r\n            setFetching(true)\r\n            let song = await fetch('https://sky-music.herokuapp.com/api/songs?get=' + encodeURI(data.file)).then(data => data.json())\r\n            setFetching(false)\r\n            song = prepareSongImport(song)\r\n            setCache(song)\r\n            songStore.data = {\r\n                eventType: 'play',\r\n                song: song,\r\n                start: 0\r\n            }\r\n        } catch (e) {\r\n            console.error(e)\r\n            setFetching(false)\r\n            new LoggerEvent(\"Error\", \"Error downloading song\").trigger()\r\n        }\r\n    }\r\n    return <div className=\"song-row\">\r\n        <div className=\"song-name\" onClick={() => {\r\n            play(data)\r\n        }}>\r\n            {data.name}\r\n        </div>\r\n        <div className=\"song-buttons-wrapper\">\r\n            <button className=\"song-button\" onClick={download}>\r\n                {fetching ? <FaSpinner /> : <FaDownload />}\r\n            </button>\r\n        </div>\r\n    </div>\r\n}","import { Component } from 'react'\r\nimport { FaMusic, FaTimes, FaCog, FaTrash, FaCrosshairs, FaDownload, FaInfo, FaSearch, FaHome } from 'react-icons/fa';\r\nimport { FaDiscord, FaGithub } from 'react-icons/fa';\r\nimport { BsCircle } from 'react-icons/bs'\r\nimport { RiPlayListFill } from 'react-icons/ri'\r\nimport { FileDownloader, LoggerEvent, prepareSongImport, prepareSongDownload } from \"lib/Utils\"\r\nimport { FilePicker } from \"react-file-picker\"\r\nimport { appName, isTwa } from \"appConfig\"\r\nimport { songStore } from '../SongStore'\r\nimport { HelpTab } from 'components/HelpTab'\r\nimport MenuItem from 'components/MenuItem'\r\nimport MenuPanel from 'components/MenuPanel'\r\nimport MenuClose from 'components/MenuClose'\r\nimport SettingsRow from 'components/SettingsRow'\r\nimport DonateButton from 'components/DonateButton'\r\nimport LibrarySearchedSong from 'components/LibrarySearchedSong'\r\nimport \"./menu.css\"\r\nclass Menu extends Component {\r\n    constructor(props) {\r\n        super(props)\r\n        this.state = {\r\n            open: false,\r\n            selectedMenu: \"Songs\",\r\n            selectedSongType: \"recorded\",\r\n            searchInput: '',\r\n            searchedSongs: [],\r\n            searchStatus: 'Write a song name then search!',\r\n            isPersistentStorage: false\r\n        }\r\n    }\r\n    componentDidMount() {\r\n        this.checkPersistentStorage()\r\n        window.addEventListener(\"keydown\", this.handleKeyboard)\r\n    }\r\n    componentWillUnmount() {\r\n        window.removeEventListener(\"keydown\", this.handleKeyboard)\r\n    }\r\n    handleKeyboard = (event) => {\r\n        let key = event.code\r\n        if (document.activeElement.tagName === \"INPUT\") return\r\n        document.activeElement?.blur()\r\n        if (event.shiftKey) {\r\n            switch (key) {\r\n                case \"KeyM\": {\r\n                    this.setState({ open: !this.state.open })\r\n                    break\r\n                }\r\n                default: break;\r\n            }\r\n        } else {\r\n            switch (key) {\r\n                case \"Escape\": {\r\n                    this.setState({ open: false })\r\n                    break\r\n                }\r\n                default: break;\r\n            }\r\n        }\r\n\r\n    }\r\n    checkPersistentStorage = async () => {\r\n        if (navigator.storage && navigator.storage.persist) {\r\n            let isPersisted = await navigator.storage.persisted()\r\n            if (!isPersisted) isPersisted = await navigator.storage.persist()\r\n            this.setState({ isPersistentStorage: isPersisted })\r\n        }\r\n    }\r\n    handleSearchInput = (text) => {\r\n        this.setState({\r\n            searchInput: text\r\n        })\r\n    }\r\n    clearSearch = () => {\r\n        this.setState({\r\n            searchInput: '',\r\n            searchedSongs: [],\r\n            searchStatus: 'Write a song name then search!'\r\n        })\r\n    }\r\n    searchSongs = async () => {\r\n        const { searchInput, searchStatus } = this.state\r\n        if (searchStatus === \"Searching...\") return\r\n        if (searchInput.trim().length === 0) {\r\n            return this.setState({\r\n                searchStatus: 'Please write a non empty name'\r\n            })\r\n        }\r\n        this.setState({\r\n            searchStatus: 'Searching...'\r\n        })\r\n        let fetchedSongs = await fetch('https://sky-music.herokuapp.com/api/songs?search=' + encodeURI(searchInput)).then(data => data.json())\r\n        if (fetchedSongs.error) {\r\n            this.setState({\r\n                searchStatus: 'Please write a non empty name'\r\n            })\r\n            return new LoggerEvent(\"Error\", fetchedSongs.error).trigger()\r\n        }\r\n        this.setState({\r\n            searchedSongs: fetchedSongs,\r\n            searchStatus: 'success'\r\n        })\r\n    }\r\n    toggleMenu = (override) => {\r\n        if (typeof override !== \"boolean\") override = undefined\r\n        let newState = override !== undefined ? override : !this.state.open\r\n        this.setState({\r\n            open: newState,\r\n        })\r\n    }\r\n    selectSideMenu = (selection) => {\r\n        if (selection === this.state.selectedMenu && this.state.open) {\r\n            return this.setState({\r\n                open: false,\r\n            })\r\n        }\r\n        this.clearSearch()\r\n        this.setState({\r\n            selectedMenu: selection,\r\n            open: true\r\n        })\r\n    }\r\n    changeSelectedSongType = (name) => {\r\n        this.setState({\r\n            selectedSongType: name\r\n        })\r\n    }\r\n    importSong = (file) => {\r\n        const reader = new FileReader();\r\n        reader.addEventListener('load', async (event) => {\r\n            try {\r\n                let songsInput = JSON.parse(event.target.result)\r\n                if (!Array.isArray(songsInput)) songsInput = [songsInput]\r\n                for (let song of songsInput) {\r\n                    song = prepareSongImport(song)\r\n                    await this.props.functions.addSong(song)\r\n                }\r\n            } catch (e) {\r\n                let fileName = file.name\r\n                console.error(e)\r\n                if (fileName?.includes?.(\".mid\")) {\r\n                    return new LoggerEvent(\"Error\", \"Midi files should be imported in the composer\").trigger()\r\n                }\r\n                new LoggerEvent(\"Error\", \"Error importing song, invalid format\").trigger()\r\n\r\n            }\r\n        })\r\n        reader.readAsText(file)\r\n    }\r\n    downloadSong = (song) => {\r\n        if (song._id) delete song._id\r\n        let songName = song.name\r\n        if (appName === \"Sky\") {\r\n            //adds old format into the sheet\r\n            song = prepareSongDownload(song)\r\n        }\r\n        if (!Array.isArray(song)) song = [song]\r\n        song.forEach(song1 => {\r\n            song1.data.appName = appName\r\n        })\r\n        let json = JSON.stringify(song)\r\n        let fileDownloader = new FileDownloader()\r\n        fileDownloader.download(json, `${songName}.${appName.toLowerCase()}sheet.json`)\r\n        new LoggerEvent(\"Success\", \"Song downloaded\").trigger()\r\n    }\r\n\r\n    downloadAllSongs = () => {\r\n        let toDownload = []\r\n        this.props.data.songs.forEach(song => {\r\n            if (song._id) delete song._id\r\n            if (appName === \"Sky\") {\r\n                song = prepareSongDownload(song)\r\n            }\r\n            Array.isArray(song) ? toDownload.push(...song) : toDownload.push(song)\r\n        })\r\n        let fileDownloader = new FileDownloader()\r\n        let json = JSON.stringify(toDownload)\r\n        let date = new Date().toISOString().split('T')[0]\r\n        fileDownloader.download(json, `${appName}_Backup_${date}.json`)\r\n        new LoggerEvent(\"Success\", \"Song backup downloaded\").trigger()\r\n    }\r\n\r\n    render() {\r\n        let sideClass = this.state.open ? \"side-menu menu-open\" : \"side-menu\"\r\n        const { data, functions } = this.props\r\n        const { handleSettingChange } = functions\r\n        functions.toggleMenu = this.toggleMenu\r\n        functions.downloadSong = this.downloadSong\r\n        let changePage = this.props.functions.changePage\r\n        let songs = data.songs.filter(song => !song.data.isComposedVersion)\r\n        let composedSongs = data.songs.filter(song => song.data.isComposedVersion)\r\n        const { searchStatus, searchedSongs, selectedMenu } = this.state\r\n        let searchedSongFunctions = {\r\n            importSong: functions.addSong,\r\n        }\r\n        return <div className=\"menu-wrapper\">\r\n            <div className=\"menu menu-visible menu-main-page\">\r\n                {this.state.open && <MenuClose action={this.toggleMenu} />}\r\n                <MenuItem type=\"Help\" action={this.selectSideMenu} className=\"margin-top-auto\">\r\n                    <FaInfo className=\"icon\" />\r\n                </MenuItem>\r\n                <MenuItem type=\"Library\" action={this.selectSideMenu}>\r\n                    <RiPlayListFill className='icon' />\r\n                </MenuItem>\r\n                <MenuItem type=\"Songs\" action={this.selectSideMenu} >\r\n                    <FaMusic className=\"icon\" />\r\n                </MenuItem>\r\n                <MenuItem type=\"Settings\" action={this.selectSideMenu}>\r\n                    <FaCog className=\"icon\" />\r\n                </MenuItem>\r\n                <MenuItem type=\"Home\" action={() => changePage(\"home\")}>\r\n                    <FaHome className=\"icon\" />\r\n                </MenuItem>\r\n            </div>\r\n            <div className={sideClass}>\r\n                <MenuPanel title=\"No selection\" visible={selectedMenu}>\r\n                </MenuPanel>\r\n                <MenuPanel title=\"Songs\" visible={selectedMenu}>\r\n                    <div className=\"songs-buttons-wrapper\">\r\n                        <button className=\"genshin-button\"\r\n                            onClick={() => changePage(\"Composer\")}\r\n                        >\r\n                            Compose song\r\n                        </button>\r\n                        <FilePicker\r\n                            onChange={(file) => this.importSong(file)}\r\n                        >\r\n                            <button className=\"genshin-button\">\r\n                                Import song\r\n                            </button>\r\n                        </FilePicker>\r\n\r\n                    </div>\r\n                    <div className=\"tab-selector-wrapper\">\r\n                        <button\r\n                            className={this.state.selectedSongType === \"recorded\" ? \"tab-selector tab-selected\" : \"tab-selector\"}\r\n                            onClick={() => this.changeSelectedSongType(\"recorded\")}\r\n                        >\r\n                            Recorded\r\n                        </button>\r\n                        <button\r\n                            className={this.state.selectedSongType === \"composed\" ? \"tab-selector tab-selected\" : \"tab-selector\"}\r\n                            onClick={() => this.changeSelectedSongType(\"composed\")}\r\n                        >\r\n                            Composed\r\n                        </button>\r\n                    </div>\r\n                    <div className=\"songs-wrapper\">\r\n                        {this.state.selectedSongType === \"recorded\"\r\n                            ? songs.map(song => {\r\n                                return <SongRow\r\n                                    data={song}\r\n                                    key={song.name}\r\n                                    functions={functions}\r\n                                >\r\n                                </SongRow>\r\n                            })\r\n                            : composedSongs.map(song => {\r\n                                return <SongRow\r\n                                    data={song}\r\n                                    key={song.name}\r\n                                    functions={functions}\r\n                                >\r\n                                </SongRow>\r\n                            })\r\n                        }\r\n                    </div>\r\n                    <div style={{ marginTop: \"auto\", paddingTop: '0.5rem', width: '100%', display: 'flex', justifyContent: 'flex-end' }}>\r\n                        <button\r\n                            className='genshin-button'\r\n                            style={{ marginLeft: 'auto' }}\r\n                            onClick={this.downloadAllSongs}\r\n                        >\r\n                            Download all songs (backup)\r\n                        </button>\r\n                    </div>\r\n                </MenuPanel>\r\n\r\n                <MenuPanel title=\"Settings\" visible={selectedMenu}>\r\n                    {Object.entries(data.settings).map(([key, data]) => {\r\n                        return <SettingsRow\r\n                            key={key}\r\n                            objKey={key}\r\n                            data={data}\r\n                            changeVolume={functions.changeVolume}\r\n                            update={handleSettingChange}\r\n                        />\r\n                    })}\r\n                    <div style={{ marginTop: '0.2rem', marginBottom: '0.6rem' }}>\r\n                        {this.state.isPersistentStorage ? \"Storage is persisted\" : \"Storage is not persisted\"}\r\n                    </div>\r\n                    {!isTwa() && <DonateButton onClick={changePage} />}\r\n\r\n                </MenuPanel>\r\n\r\n                <MenuPanel title=\"Library\" visible={selectedMenu}>\r\n                    <div>\r\n                        Here you can find songs to learn, they are provided by the sky-music library.\r\n                    </div>\r\n                    <div className='library-search-row' >\r\n                        <input\r\n                            className='library-search-input'\r\n                            placeholder='Song name'\r\n                            onKeyDown={(e) => {\r\n                                if (e.code === \"Enter\") this.searchSongs()\r\n                            }}\r\n                            onInput={(e) => this.handleSearchInput(e.target.value)}\r\n                            value={this.state.searchInput}\r\n                        />\r\n                        <button className='library-search-btn' onClick={this.clearSearch}>\r\n                            <FaTimes />\r\n                        </button>\r\n                        <button className='library-search-btn' onClick={this.searchSongs}>\r\n                            <FaSearch />\r\n                        </button>\r\n                    </div>\r\n                    <div className='library-search-songs-wrapper'>\r\n                        {searchStatus === \"success\" ?\r\n                            searchedSongs.length > 0\r\n                                ? searchedSongs.map(song =>\r\n                                    <LibrarySearchedSong\r\n                                        key={song.file}\r\n                                        data={song}\r\n                                        functions={searchedSongFunctions}\r\n                                        songStore={songStore}\r\n                                    >\r\n                                        {song.name}\r\n                                    </LibrarySearchedSong>)\r\n                                : <div className='library-search-result-text'>\r\n                                    No results\r\n                                </div>\r\n                            : <div className='library-search-result-text'>\r\n                                {searchStatus}\r\n                            </div>\r\n                        }\r\n                    </div>\r\n                </MenuPanel>\r\n                <MenuPanel title=\"Help\" visible={selectedMenu}>\r\n                    <div className='help-icon-wrapper'>\r\n                        <a href='https://discord.gg/Arsf65YYHq' >\r\n                            <FaDiscord className='help-icon' />\r\n                        </a>\r\n                        <a href='https://github.com/Specy/genshin-music' >\r\n                            <FaGithub className='help-icon' />\r\n                        </a>\r\n\r\n                    </div>\r\n                    <HelpTab />\r\n                    {!isTwa() && <DonateButton onClick={changePage} />}\r\n                </MenuPanel>\r\n            </div>\r\n        </div>\r\n    }\r\n}\r\nfunction SongRow(props) {\r\n    let data = props.data\r\n    let deleteSong = props.functions.removeSong\r\n    let toggleMenu = props.functions.toggleMenu\r\n    let downloadSong = props.functions.downloadSong\r\n\r\n    return <div className=\"song-row\">\r\n        <div className=\"song-name\" onClick={() => {\r\n            songStore.data = {\r\n                eventType: 'play',\r\n                song: data,\r\n                start: 0\r\n            }\r\n            toggleMenu(false)\r\n        }}>\r\n            {data.name}\r\n        </div>\r\n        <div className=\"song-buttons-wrapper\">\r\n            <button className=\"song-button\" onClick={() => {\r\n                songStore.data = {\r\n                    eventType: 'practice',\r\n                    song: data,\r\n                    start: 0\r\n                }\r\n                toggleMenu(false)\r\n            }}\r\n            >\r\n                <FaCrosshairs />\r\n            </button>\r\n\r\n            <button className=\"song-button\" onClick={() => {\r\n                songStore.data = {\r\n                    eventType: 'approaching',\r\n                    song: data,\r\n                    start: 0\r\n                }\r\n                toggleMenu(false)\r\n            }}\r\n            >\r\n                <BsCircle />\r\n            </button>\r\n            <button className=\"song-button\" onClick={() => downloadSong(data)}>\r\n                <FaDownload />\r\n\r\n            </button>\r\n            <button className=\"song-button\" onClick={() => deleteSong(data.name)}>\r\n                <FaTrash color=\"#ed4557\" />\r\n            </button>\r\n        </div>\r\n    </div>\r\n}\r\n\r\n\r\n\r\nexport default Menu","import ZangoDb from \"zangodb\"\r\nimport { appName } from \"appConfig\"\r\nclass Database{\r\n    db = new ZangoDb.Db(appName, { songs: [] })\r\n    constructor(){\r\n        this.collections = {\r\n            songs: this.db.collection(\"songs\")\r\n        }\r\n    }\r\n    async getSongs(){\r\n        return await this.collections.songs.find().toArray()\r\n    }\r\n    async getSongById(id){\r\n        return await this.collections.songs.findOne({_id: id})\r\n    }\r\n    async existsSong(query){\r\n        return await this.collections.songs.findOne(query) !== undefined\r\n    }\r\n    async updateSong(query,data){\r\n        return this.collections.songs.update(query, data)\r\n    }\r\n    addSong(song){\r\n        return this.collections.songs.insert(song)\r\n    }\r\n    removeSong(query){\r\n        return this.collections.songs.remove(query)\r\n    }\r\n}\r\n\r\nconst DB = new Database()\r\nDB.getSongs()\r\nexport {\r\n    Database,\r\n    DB\r\n}","import { isMobile } from \"is-mobile\"\r\nimport { instruments, appName } from \"appConfig\"\r\n\r\nexport const ComposerSettings = {\r\n    settingVesion: appName + 17,\r\n    instrument: {\r\n        name: \"Instrument (Layer 1)\",\r\n        type: \"instrument\",\r\n        songSetting: false,\r\n        value: instruments[0],\r\n        volume: 100,\r\n        options: instruments\r\n    },\r\n    layer2: {\r\n        name: \"Instrument (Layer 2)\",\r\n        type: \"instrument\",\r\n        songSetting: false,\r\n        value: instruments[0],\r\n        volume: 100,\r\n        options: instruments\r\n    },\r\n    layer3: {\r\n        name: \"Instrument (Layer 3)\",\r\n        type: \"instrument\",\r\n        songSetting: false,\r\n        value: instruments[0],\r\n        volume: 100,\r\n        options: instruments\r\n    },\r\n    bpm: {\r\n        name: \"Bpm\",\r\n        type: \"number\",\r\n        songSetting: true,\r\n        threshold: [0, 1600],\r\n        value: 220\r\n    },\r\n    beatMarks: {\r\n        name: \"Beat marks\",\r\n        type: \"select\",\r\n        songSetting: false,\r\n        value: 3,\r\n        options: [\r\n            3,\r\n            4\r\n        ]\r\n    },\r\n    noteNameType: {\r\n        name: \"Note name type\",\r\n        type: \"select\",\r\n        songSetting: false,\r\n        value: appName === \"Genshin\"\r\n            ? isMobile()\r\n                ? \"Do Re Mi\"\r\n                : \"Keyboard layout\"\r\n            : \"Note name\",\r\n        options: appName === \"Genshin\"\r\n            ? [\r\n                \"Note name\",\r\n                \"Keyboard layout\",\r\n                \"Do Re Mi\"\r\n            ]\r\n            : [\r\n                \"Note name\",\r\n                \"Keyboard layout\"\r\n            ]\r\n    },\r\n    pitch: {\r\n        name: \"Pitch\",\r\n        type: \"select\",\r\n        songSetting: true,\r\n        value: \"C\",\r\n        options: [\r\n            \"C\",\r\n            \"Db\",\r\n            \"D\",\r\n            \"Eb\",\r\n            \"E\",\r\n            \"F\",\r\n            \"Gb\",\r\n            \"G\",\r\n            \"Ab\",\r\n            \"A\",\r\n            \"Bb\",\r\n            \"B\",\r\n        ]\r\n    },\r\n    columnsPerCanvas: {\r\n        name: \"Number of visible columns\",\r\n        type: \"select\",\r\n        songSetting: false,\r\n        value: 35,\r\n        options: [\r\n            20,\r\n            25,\r\n            30,\r\n            35,\r\n            40,\r\n            45,\r\n            50\r\n        ]\r\n    },\r\n    caveMode: {\r\n        name: \"Reverb (cave mode)\",\r\n        type: \"checkbox\",\r\n        songSetting: false,\r\n        value: false,\r\n    },\r\n    autosave: {\r\n        name: \"Autosave changes\",\r\n        type: \"checkbox\",\r\n        songSetting: false,\r\n        value: false,\r\n    },\r\n    backgroundImage: {\r\n        name: \"Background image (url)\",\r\n        type: \"text\",\r\n        songSetting: false,\r\n        value: \"\",\r\n        placeholder: \"Write here\"\r\n    },\r\n    syncTabs: {\r\n        name: \"Autoplay in all tabs (pc only)\",\r\n        type: \"checkbox\",\r\n        songSetting: false,\r\n        value: false\r\n    }\r\n}\r\n\r\n\r\n\r\nexport const MainPageSettings = {\r\n    settingVesion: appName + 17,\r\n    instrument: {\r\n        name: \"Instrument\",\r\n        type: \"instrument\",\r\n        songSetting: false,\r\n        value: instruments[0],\r\n        volume: 100,\r\n        options: instruments\r\n    },\r\n    pitch: {\r\n        name: \"Pitch\",\r\n        type: \"select\",\r\n        songSetting: true,\r\n        value: \"C\",\r\n        options: [\r\n            \"C\",\r\n            \"Db\",\r\n            \"D\",\r\n            \"Eb\",\r\n            \"E\",\r\n            \"F\",\r\n            \"Gb\",\r\n            \"G\",\r\n            \"Ab\",\r\n            \"A\",\r\n            \"Bb\",\r\n            \"B\",\r\n        ]\r\n    },\r\n    caveMode: {\r\n        name: \"Reverb (cave mode)\",\r\n        type: \"checkbox\",\r\n        songSetting: false,\r\n        value: false,\r\n    },\r\n    keyboardSize: {\r\n        name: \"Keyboard size\",\r\n        type: \"number\",\r\n        songSetting: false,\r\n        value: 100,\r\n        threshold: [0, 200]\r\n    },\r\n    noteNameType: {\r\n        name: \"Note name type\",\r\n        type: \"select\",\r\n        songSetting: false,\r\n        value: appName === \"Genshin\"\r\n            ? isMobile()\r\n                ? \"Do Re Mi\"\r\n                : \"Keyboard layout\"\r\n            : \"Note name\",\r\n\r\n        options: appName === \"Genshin\"\r\n            ? [\r\n                \"Note name\",\r\n                \"Keyboard layout\",\r\n                \"Do Re Mi\"\r\n            ]\r\n            : [\r\n                \"Note name\",\r\n                \"Keyboard layout\"\r\n            ]\r\n    },\r\n    approachSpeed: {\r\n        name: \"Approach Rate (AR)\",\r\n        type: \"number\",\r\n        songSetting: false,\r\n        value: 1500,\r\n        threshold: [0, 5000]\r\n    },\r\n    backgroundImage: {\r\n        name: \"Background image (url)\",\r\n        type: \"text\",\r\n        songSetting: false,\r\n        value: \"\",\r\n        placeholder: \"Write here\"\r\n    },\r\n    noteAnimation: {\r\n        name: \"Note animation\",\r\n        type: \"checkbox\",\r\n        songSetting: false,\r\n        value: false\r\n    }\r\n}","import { instrumentsData, layoutData, instruments,audioContext } from \"appConfig\"\r\n\r\nexport default class Instrument {\r\n    constructor(instrumentName) {\r\n        this.instrumentName = instrumentName === undefined ? instruments[0] : instrumentName\r\n        if (!instruments.includes(this.instrumentName)) this.instrumentName = instruments[0] \r\n        this.layout = []\r\n        this.buffers = []\r\n        this.loaded = false\r\n        this.deleted = false\r\n        this.volumeNode = audioContext.createGain()\r\n        const instrumentData = instrumentsData[this.instrumentName]\r\n        this.keyboardLayout = layoutData[instrumentData.notes].keyboardLayout\r\n        this.mobileLayout = layoutData[instrumentData.notes].mobileLayout\r\n        this.keyboardCodes = layoutData[instrumentData.notes].keyboardCodes\r\n        \r\n        this.keyboardLayout.forEach((noteName, i) => {\r\n            let noteNames = {\r\n                keyboard: noteName,\r\n                mobile: this.mobileLayout[i]\r\n            }\r\n            let url = `./assets/audio/${this.instrumentName}/${i}.mp3`\r\n            this.layout.push(new NoteData(i, noteNames, url))\r\n        })\r\n\r\n        this.volumeNode.gain.value = 0.8\r\n    }\r\n    getNoteFromCode = (code) => {\r\n        let index = this.keyboardLayout.findIndex(e => e === String(code))\r\n        return index !== -1 ? index : null\r\n    }\r\n\r\n    changeVolume = (amount) => {\r\n        let newVolume = Number((amount / 135).toFixed(2))\r\n        if(amount < 5) newVolume = 0\r\n        this.volumeNode.gain.value = newVolume\r\n    }\r\n\r\n    play = (note, pitch) => {\r\n        if(this.deleted) return\r\n        let player = audioContext.createBufferSource()\r\n        player.buffer = this.buffers[note]\r\n        player.connect(this.volumeNode)\r\n        player.playbackRate.value = pitch\r\n        player.start(0)\r\n        player.onended = () => {\r\n            player.stop()\r\n            player.disconnect()\r\n        }\r\n    }\r\n    load = async () => {\r\n        let emptyBuffer = audioContext.createBuffer(2, audioContext.sampleRate, audioContext.sampleRate)\r\n        const requests = this.layout.map(note => {\r\n            return new Promise(resolve => {\r\n                fetch(note.url)\r\n                    .then(result => result.arrayBuffer())\r\n                    .then(buffer => {\r\n                        audioContext.decodeAudioData(buffer, resolve, () => {\r\n                            resolve(emptyBuffer)\r\n                        })\r\n                        .catch(e => {resolve(emptyBuffer)})\r\n                    }).catch(e => {resolve(emptyBuffer)})\r\n            })\r\n        })\r\n        this.buffers = await Promise.all(requests)\r\n        this.loaded = true\r\n        return true\r\n    }\r\n    disconnect = () =>{\r\n        this.volumeNode.disconnect()\r\n    }\r\n    connect = (node) => {\r\n        this.volumeNode.connect(node)\r\n    }\r\n    delete = () => {\r\n        this.disconnect()\r\n        this.deleted = true\r\n        this.buffers = null\r\n    }\r\n}\r\n\r\nclass NoteData {\r\n    constructor(index, noteNames, url) {\r\n        this.index = index\r\n        this.noteNames = noteNames\r\n        this.url = url\r\n        this.buffer = new ArrayBuffer(8)\r\n    }\r\n}","import { audioContext } from \"appConfig\";\r\nimport toWav from 'audiobuffer-to-wav'\r\nimport MediaRecorderPolyfill from 'audio-recorder-polyfill'\r\nexport default class AudioRecorder {\r\n    constructor() {\r\n        this.node = audioContext.createMediaStreamDestination()\r\n        if(!window.MediaRecorder){\r\n            console.log(\"Audio recorder Polyfill\")\r\n            this.recorder = new MediaRecorderPolyfill(this.node.stream)\r\n        }else{\r\n            this.recorder = new MediaRecorder(this.node.stream)\r\n        }\r\n    }\r\n    start() {\r\n        this.recorder.start()\r\n    }\r\n    stop() {\r\n        return new Promise(resolve => {\r\n            this.recorder.addEventListener('dataavailable', function (e) {\r\n                resolve({\r\n                    data: e.data,\r\n                    toUrl: () => {\r\n                        return URL.createObjectURL(e.data);\r\n                    }\r\n                })\r\n            }, { once: true })\r\n            this.recorder.stop()\r\n        })\r\n    }\r\n\r\n    async download(urlBlob, fileName) {\r\n        const anchor = document.createElement(\"a\")\r\n        const wav = toWav(await blobToAudio(urlBlob))\r\n        var blob = new Blob([new DataView(wav)], {\r\n            type: 'audio/wav'\r\n        })\r\n        anchor.download = fileName\r\n        anchor.href = URL.createObjectURL(blob)\r\n        anchor.click();\r\n    }\r\n}\r\n\r\nfunction blobToAudio(blob) {\r\n    return new Promise(resolve => {\r\n        const audioContext = new AudioContext();\r\n        const fileReader = new FileReader();\r\n        fileReader.onloadend = () => {\r\n            audioContext.decodeAudioData(fileReader.result, (audioBuffer) => {\r\n                resolve(audioBuffer)\r\n            });\r\n        };\r\n        fileReader.readAsArrayBuffer(blob);\r\n    })\r\n}","import { LoggerEvent } from \"lib/Utils\"\r\n\r\nasync function asyncPrompt(question) {\r\n    return new Promise(resolve => {\r\n        const overlay = document.createElement(\"div\")\r\n        const container = document.createElement(\"div\")\r\n        const text = document.createElement(\"div\")\r\n        const row = document.createElement(\"div\")\r\n        const cancel = document.createElement(\"button\")\r\n        const ok = document.createElement(\"button\")\r\n        const input = document.createElement(\"input\")\r\n\r\n        overlay.className = 'prompt-overlay'\r\n        input.type = \"text\"\r\n        container.className = \"floating-prompt\"\r\n        input.placeholder = \"Write here\"\r\n        input.className = \"prompt-input\"\r\n        cancel.className = \"prompt-button\"\r\n        ok.className = \"prompt-button disabled\"\r\n        row.className = \"prompt-row\"\r\n        ok.innerText = \"Ok\"\r\n        cancel.innerText = \"Cancel\"\r\n        text.innerText = question\r\n\r\n        row.append(cancel, ok)\r\n        container.append(text, input, row)\r\n        overlay.append(container)\r\n        document.body.appendChild(overlay)\r\n\r\n        let disposed = false\r\n        function inputListener(){\r\n            if(disposed) return\r\n            if (input.value.trim() === \"\") {\r\n                ok.classList.add(\"disabled\")\r\n            } else {\r\n                ok.classList.remove(\"disabled\")\r\n            }\r\n        }\r\n        function cancelListener(){\r\n            if(disposed) return\r\n            resolve(null)\r\n            dispose()\r\n        }\r\n        function okListener(){\r\n            if(disposed) return\r\n            if (input.value.trim() === '') return\r\n            if (input.value.trim() === \"Untitled\") {\r\n                input.value = \"\"\r\n                return new LoggerEvent(\"Warning\", '\"Untitled\" is a reserved word, use another').trigger()\r\n            }\r\n            resolve(input.value.trim())\r\n            dispose()\r\n        }\r\n\r\n        function handleKeyboard(event){\r\n            const key = event.code\r\n            if(key === 'Enter') okListener()\r\n            if(key === 'Escape') cancelListener()\r\n        }\r\n\r\n        function handleOverlay(e){\r\n            if(e.path[0] === overlay) cancelListener()\r\n        }\r\n\r\n        input.focus()\r\n        overlay.addEventListener(\"click\",handleOverlay)\r\n        cancel.addEventListener(\"click\", cancelListener)\r\n        ok.addEventListener(\"click\", okListener)\r\n        window.addEventListener('keydown',handleKeyboard)\r\n        input.addEventListener(\"input\", inputListener)\r\n\r\n        function dispose(){\r\n            overlay.removeEventListener(\"click\",handleOverlay)\r\n            ok.removeEventListener('click',okListener)\r\n            cancel.removeEventListener('click',cancelListener)\r\n            window.removeEventListener('keydown',handleKeyboard)\r\n            input.removeEventListener('input',inputListener)\r\n            disposed = true\r\n            overlay.classList.add(\"prompt-overlay-hidden\")\r\n            container.classList.add(\"floating-prompt-hidden\")\r\n            setTimeout(() => clearDOM(overlay), 200)\r\n        }\r\n    })\r\n}\r\n\r\nasync function asyncConfirm(question,cancellable = true) {\r\n    return new Promise(resolve => {\r\n        const overlay = document.createElement(\"div\")\r\n        const container = document.createElement(\"div\")\r\n        const text = document.createElement(\"div\")\r\n        const row = document.createElement(\"div\")\r\n        const cancel = document.createElement(\"button\")\r\n        const ok = document.createElement(\"button\")\r\n\r\n        overlay.className = 'prompt-overlay'\r\n        container.className = \"floating-prompt\"\r\n        text.innerText = question\r\n        cancel.className = \"prompt-button\"\r\n        ok.className = \"prompt-button\"\r\n        row.className = \"prompt-row\"\r\n        ok.innerText = \"Yes\"\r\n        ok.style.background = '#628c83'\r\n        cancel.style.background = '#a9525a'\r\n        cancel.innerText = \"No\"\r\n        \r\n        row.append(cancel, ok)\r\n        container.append(text,row)\r\n        overlay.append(container)\r\n        document.body.appendChild(overlay)\r\n\r\n        let disposed = false\r\n        function okListener(){\r\n            if(disposed) return\r\n            resolve(true)\r\n            dispose()\r\n        }\r\n        function cancelListener(){\r\n            if(disposed) return\r\n            resolve(false)\r\n            dispose()\r\n        }\r\n        function handleKeyboard(event){\r\n            const key = event.code\r\n            if(key === 'Enter') okListener()\r\n            if(key === 'Escape' && cancellable) cancelListener()\r\n        }\r\n        function handleOverlay(e){\r\n            if(e.path[0] === overlay && cancellable) cancelListener()\r\n        }\r\n        overlay.addEventListener(\"click\",handleOverlay)\r\n        cancel.addEventListener(\"click\", cancelListener)\r\n        ok.addEventListener(\"click\", okListener)\r\n        window.addEventListener('keydown',handleKeyboard)\r\n        document.activeElement.blur()\r\n        function dispose(){\r\n            disposed = true\r\n            cancel.removeEventListener('click',cancelListener)\r\n            ok.removeEventListener('click',okListener)\r\n            window.removeEventListener('keydown',handleKeyboard)\r\n            overlay.removeEventListener(\"click\",handleOverlay)\r\n            overlay.classList.add(\"prompt-overlay-hidden\")\r\n            container.classList.add(\"floating-prompt-hidden\")\r\n            setTimeout(() => clearDOM(overlay), 200)\r\n        }\r\n    })\r\n}\r\n\r\nfunction clearDOM(element){\r\n    element.querySelectorAll('*').forEach(el => el.remove())\r\n    element.remove()\r\n}\r\n\r\nexport {\r\n    asyncConfirm,\r\n    asyncPrompt\r\n}","import React, { Component } from 'react';\r\nimport Keyboard from \"./Keyboard\"\r\nimport Menu from \"./Components/Menu\"\r\nimport { DB } from 'Database';\r\nimport { songStore } from './SongStore'\r\nimport { Song, Recording, LoggerEvent, prepareSongImport, getPitchChanger } from \"lib/Utils\"\r\nimport { MainPageSettings } from \"lib/SettingsObj\"\r\nimport Instrument from 'lib/Instrument';\r\nimport AudioRecorder from 'lib/AudioRecorder';\r\nimport { asyncConfirm, asyncPrompt } from \"components/AsyncPrompts\"\r\nimport { appName, audioContext , isTwa} from \"appConfig\"\r\nimport './App.css';\r\nclass App extends Component {\r\n\tconstructor(props) {\r\n\t\tsuper(props)\r\n\t\tthis.recording = new Recording()\r\n\t\tlet settings = this.getSettings()\r\n\t\tthis.state = {\r\n\t\t\tinstrument: new Instrument(),\r\n\t\t\tisLoadingInstrument: true,\r\n\t\t\tisRecording: false,\r\n\t\t\tisRecordingAudio: false,\r\n\t\t\tsongs: [],\r\n\t\t\tsettings: settings,\r\n\t\t\tisDragging: false,\r\n\t\t\tthereIsSong: false\r\n\t\t}\r\n\t\tthis.mounted = false\r\n\t\tthis.reverbNode = undefined\r\n\t\tthis.reverbVolumeNode = undefined\r\n\t\tthis.audioContext = audioContext\r\n\t\tthis.recorder = new AudioRecorder()\r\n\t}\r\n\r\n\tinit = async () => {\r\n\t\tconst { settings } = this.state\r\n\t\tawait this.loadInstrument(settings.instrument.value)\r\n\t\tawait this.loadReverb()\r\n\t\tthis.toggleReverbNodes(settings.caveMode.value)\r\n\t}\r\n\tcomponentDidMount() {\r\n\t\tdocument.body.addEventListener('dragenter', this.handleDrag)\r\n\t\tdocument.body.addEventListener('dragleave', this.resetDrag)\r\n\t\tdocument.body.addEventListener('dragover', this.handleDragOver)\r\n\t\tdocument.body.addEventListener('drop', this.handleDrop)\r\n        window.addEventListener('keydown', this.handleKeyboard)\r\n\r\n\t\tthis.mounted = true\r\n\t\tthis.syncSongs()\r\n\t\tthis.init()\r\n\t}\r\n\tcomponentWillUnmount() {\r\n\t\tdocument.body.removeEventListener('dragenter', this.handleDrag)\r\n\t\tdocument.body.removeEventListener('dragleave', this.resetDrag)\r\n\t\tdocument.body.removeEventListener('drop', this.handleDrop)\r\n\t\tdocument.body.removeEventListener('dragover', this.handleDragOver)\r\n        window.removeEventListener('keydown', this.handleKeyboard)\r\n\r\n\t\tsongStore.data = {\r\n\t\t\tsong: {},\r\n\t\t\teventType: 'stop',\r\n\t\t\tstart: 0\r\n\t\t}\r\n\t\tthis.mounted = false\r\n\t\tthis.audioContext = undefined\r\n\t\tthis.recorder = undefined\r\n\t\tthis.reverbNode = undefined\r\n\t\tthis.reverbVolumeNode = undefined\r\n\t\tthis.state.instrument.delete()\r\n\t}\r\n\thandleKeyboard =async (event) => {\r\n\t\tconst { thereIsSong } = this.state\r\n        if (event.repeat) return\r\n        if (document.activeElement.tagName === \"INPUT\") return\r\n        if(event.shiftKey){\r\n            switch(event.code){\r\n                case \"KeyR\" : {\r\n                    if(!thereIsSong){\r\n\t\t\t\t\t\tthis.toggleRecord()\r\n\t\t\t\t\t\tevent.preventDefault()\r\n\t\t\t\t\t}\r\n                    break;\r\n                }\r\n\t\t\t\tdefault: break;\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n\tresetDrag = (e) => {\r\n\t\tthis.setState({\r\n\t\t\tisDragging: false\r\n\t\t})\r\n\t}\r\n\thandleDragOver = (e) => {\r\n\t\te.preventDefault()\r\n\t\tthis.setState({\r\n\t\t\tisDragging: true\r\n\t\t})\r\n\t}\r\n\thandleDrag = (e) => {\r\n\t\te.preventDefault()\r\n\t\tthis.setState({\r\n\t\t\tisDragging: true\r\n\t\t})\r\n\t}\r\n\tsetHasSong = (data) => {\r\n\t\tthis.setState({\r\n\t\t\tthereIsSong: data\r\n\t\t})\r\n\t}\r\n\thandleDrop = async (e) => {\r\n\t\tthis.resetDrag()\r\n\t\te.preventDefault()\r\n\t\tlet songs = await Promise.all(Array.from(e.dataTransfer.files).map(file => file.text()))\r\n\t\tfor (let i = 0; i < songs.length; i++) {\r\n\t\t\ttry {\r\n\t\t\t\tlet song = prepareSongImport(JSON.parse(songs[i]))\r\n\t\t\t\tawait this.addSong(song)\r\n\t\t\t} catch (e) {\r\n\t\t\t\tconsole.error(e)\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t}\r\n\ttoggleReverbNodes = (hasReverb) => {\r\n\t\tif(!this.mounted) return\r\n\t\tconst { instrument } = this.state\r\n\t\tif (hasReverb) {\r\n\t\t\tif (!this.reverbNode) return console.log(\"Couldn't connect to reverb\")\r\n\t\t\tinstrument.disconnect()\r\n\t\t\tinstrument.connect(this.reverbNode)\r\n\t\t} else {\r\n\t\t\tinstrument.disconnect()\r\n\t\t\tinstrument.connect(this.audioContext.destination)\r\n\t\t}\r\n\t}\r\n\tchangeVolume = (obj) => {\r\n        let settings = this.state.settings\r\n        if (obj.key === \"instrument\") {\r\n\t\t\tsettings.instrument = {...settings.instrument, volume: obj.value}\r\n            this.state.instrument.changeVolume(obj.value)\r\n        }\r\n        this.setState({\r\n            settings: settings\r\n        }, () => this.updateSettings())\r\n    }\r\n\tgetSettings = () => {\r\n\t\tlet storedSettings = localStorage.getItem(appName + \"_Main_Settings\")\r\n\t\ttry {\r\n\t\t\tstoredSettings = JSON.parse(storedSettings)\r\n\t\t} catch (e) {\r\n\t\t\tstoredSettings = null\r\n\t\t}\r\n\t\tif (storedSettings !== null) {\r\n\t\t\tif (storedSettings.settingVesion !== MainPageSettings.settingVesion) {\r\n\t\t\t\tthis.updateSettings(MainPageSettings)\r\n\t\t\t\treturn MainPageSettings\r\n\t\t\t}\r\n\t\t\treturn storedSettings\r\n\t\t}\r\n\t\treturn MainPageSettings\r\n\t}\r\n\tloadInstrument = async (name) => {\r\n\t\tthis.state.instrument?.delete?.()\r\n\t\tlet newInstrument = new Instrument(name)\r\n\t\tnewInstrument.changeVolume(this.state.settings.instrument.volume || 100)\r\n\t\tthis.setState({ isLoadingInstrument: true })\r\n\t\tawait newInstrument.load()\r\n\t\tif(!this.mounted) return \r\n\t\tnewInstrument.connect(this.audioContext.destination)\r\n\t\tthis.setState({\r\n\t\t\tinstrument: newInstrument,\r\n\t\t\tisLoadingInstrument: false\r\n\t\t}, () => this.toggleReverbNodes(this.state.settings.caveMode.value))\r\n\t}\r\n\tloadReverb() {\r\n\t\treturn new Promise(resolve => {\r\n\t\t\tfetch(\"./assets/audio/reverb4.wav\")\r\n\t\t\t\t.then(r => r.arrayBuffer())\r\n\t\t\t\t.then(b => {\r\n\t\t\t\t\tif(!this.mounted) return\r\n\t\t\t\t\tthis.audioContext.decodeAudioData(b, (impulse_response) => {\r\n\t\t\t\t\t\tif(!this.mounted) return\r\n\t\t\t\t\t\tlet convolver = this.audioContext.createConvolver()\r\n\t\t\t\t\t\tlet gainNode = this.audioContext.createGain()\r\n\t\t\t\t\t\tgainNode.gain.value = 2.5\r\n\t\t\t\t\t\tconvolver.buffer = impulse_response\r\n\t\t\t\t\t\tconvolver.connect(gainNode)\r\n\t\t\t\t\t\tgainNode.connect(this.audioContext.destination)\r\n\t\t\t\t\t\tthis.reverbVolumeNode = gainNode\r\n\t\t\t\t\t\tthis.reverbNode = convolver\r\n\t\t\t\t\t\tresolve()\r\n\t\t\t\t\t})\r\n\t\t\t\t}).catch((e) => {\r\n\t\t\t\t\tconsole.log(\"Error with reverb\", e)\r\n\t\t\t\t})\r\n\t\t})\r\n\r\n\t}\r\n\tplaySound = (note) => {\r\n\t\tconst { state } = this\r\n\t\tconst { settings } = state\r\n\t\tif (note === undefined) return\r\n\t\tif (state.isRecording) this.handleRecording(note)\r\n\t\tthis.state.instrument.play(note.index, getPitchChanger(settings.pitch.value))\r\n\t}\r\n\tupdateSettings = (override) => {\r\n\t\tlet state\r\n\t\tif (override !== undefined) {\r\n\t\t\tstate = override\r\n\t\t} else {\r\n\t\t\tstate = this.state.settings\r\n\t\t}\r\n\t\tlocalStorage.setItem(appName + \"_Main_Settings\", JSON.stringify(state))\r\n\t}\r\n\thandleSettingChange = (setting) => {\r\n\t\tlet settings = this.state.settings\r\n\t\tlet data = setting.data\r\n\t\tsettings[setting.key] = {...settings[setting.key], value: data.value}\r\n\t\tif (setting.key === \"instrument\") {\r\n\t\t\tthis.loadInstrument(data.value)\r\n\t\t}\r\n\t\tif (setting.key === 'caveMode') {\r\n\t\t\tthis.toggleReverbNodes(data.value)\r\n\t\t}\r\n\t\tthis.setState({\r\n\t\t\tsettings: settings,\r\n\t\t}, this.updateSettings)\r\n\t}\r\n\tsyncSongs = async () => {\r\n\t\tthis.setState({\r\n\t\t\tsongs: await DB.getSongs()\r\n\t\t})\r\n\t}\r\n\tsongExists = async (name) => {\r\n\t\treturn await DB.existsSong({ name: name })\r\n\t}\r\n\taddSong = async (song) => {\r\n\t\ttry {\r\n\t\t\tif (await this.songExists(song.name)) {\r\n\t\t\t\treturn new LoggerEvent(\"Warning\", \"A song with this name already exists! \\n\" + song.name).trigger()\r\n\t\t\t}\r\n\t\t\tawait DB.addSong(song)\r\n\t\t\tthis.syncSongs()\r\n\t\t\tnew LoggerEvent(\"Success\", `Song added to the ${song.data.isComposedVersion ? \"Composed\" : \"Recorded\"} tab!`, 4000).trigger()\r\n\t\t} catch (e) {\r\n\t\t\tconsole.error(e)\r\n\t\t\treturn new LoggerEvent(\"Error\", 'There was an error importing the song').trigger()\r\n\t\t}\r\n\r\n\t}\r\n\tcomponentDidCatch() {\r\n\t\tnew LoggerEvent(\"Warning\", \"There was an error with the song! Restoring default...\").trigger()\r\n\t\tsongStore.data = {\r\n\t\t\tsong: {}, eventType: 'stop', start: 0\r\n\t\t}\r\n\t}\r\n\tremoveSong = async (name) => {\r\n\t\tlet result = await asyncConfirm(`Are you sure you want to delete the song: \"${name}\" ?`)\r\n\t\tif(!this.mounted) return\r\n\t\tif (result) {\r\n\t\t\tawait DB.removeSong({ name: name })\r\n\t\t\tthis.syncSongs()\r\n\t\t}\r\n\t}\r\n\thandleRecording = (note) => {\r\n\t\tif (this.state.isRecording) {\r\n\t\t\tthis.recording.addNote(note.index)\r\n\t\t}\r\n\t}\r\n\taskForSongName = () => {\r\n\t\treturn new Promise(async resolve => {\r\n\t\t\tlet promptString = \"Write song name, press cancel to ignore\"\r\n\t\t\twhile (true) {\r\n\t\t\t\tlet songName = await asyncPrompt(promptString)\r\n\t\t\t\tif (songName === null) return resolve(null)\r\n\t\t\t\tif (songName !== \"\") {\r\n\t\t\t\t\tif (await this.songExists(songName)) {\r\n\t\t\t\t\t\tpromptString = \"This song already exists: \" + songName\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\treturn resolve(songName)\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tpromptString = \"Write song name, press cancel to ignore\"\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t})\r\n\r\n\t}\r\n\ttoggleRecord = async (override) => {\r\n\t\tif (typeof override !== \"boolean\") override = undefined\r\n\t\tlet newState = override !== undefined ? override : !this.state.isRecording\r\n\t\tif (!newState && this.recording.notes.length > 0) { //if there was a song recording\r\n\t\t\tlet songName = await this.askForSongName()\r\n\t\t\tif(!this.mounted) return\r\n\t\t\tlet song = new Song(songName, this.recording.notes)\r\n\t\t\tsong.pitch = this.state.settings.pitch.value\r\n\t\t\tif (songName !== null) this.addSong(song)\r\n\t\t} else {\r\n\t\t\tthis.recording = new Recording()\r\n\t\t}\r\n\t\tthis.state.isRecording = newState\r\n\t\tthis.setState({\r\n\t\t\topen: this.state.isRecording\r\n\t\t})\r\n\t}\r\n\ttoggleRecordAudio = async (override) => {\r\n\t\tif(!this.mounted) return\r\n\t\tif (typeof override !== \"boolean\") override = undefined\r\n\t\tconst { instrument } = this.state\r\n\t\tconst { recorder } = this\r\n\t\tconst hasReverb = this.state.settings.caveMode.value\r\n\t\tconst newState = override !== undefined ? override : !this.state.isRecordingAudio\r\n\t\tif (newState) {\r\n\t\t\tif (hasReverb) {\r\n\t\t\t\tthis.reverbVolumeNode.connect(recorder.node)\r\n\t\t\t} else {\r\n\t\t\t\tinstrument.connect(recorder.node)\r\n\t\t\t}\r\n\t\t\trecorder.start()\r\n\t\t} else {\r\n\t\t\tlet recording = await recorder.stop()\r\n\t\t\tlet fileName = await asyncPrompt(\"Write the song name, press cancel to ignore\")\r\n\t\t\tif(!this.mounted) return\r\n\t\t\tif (fileName) recorder.download(recording.data, fileName + '.wav')\r\n\t\t\tthis.toggleReverbNodes(hasReverb)\r\n\t\t\tthis.reverbVolumeNode.disconnect()\r\n\t\t\tthis.reverbVolumeNode.connect(audioContext.destination)\r\n\r\n\t\t}\r\n\t\tthis.setState({\r\n\t\t\tisRecordingAudio: newState\r\n\t\t})\r\n\t}\r\n\trender() {\r\n\t\tconst { state } = this\r\n\t\tconst keyboardFunctions = {\r\n\t\t\tchangeSliderState: this.changeSliderState,\r\n\t\t\tplaySound: this.playSound,\r\n\t\t\tsetHasSong: this.setHasSong\r\n\t\t}\r\n\t\tconst keyboardData = {\r\n\t\t\tisLoading: state.isLoadingInstrument,\r\n\t\t\tkeyboard: state.instrument,\r\n\t\t\tpitch: state.settings.pitch.value,\r\n\t\t\tkeyboardSize: state.settings.keyboardSize.value,\r\n\t\t\tnoteNameType: state.settings.noteNameType.value,\r\n\t\t\thasSong: state.thereIsSong,\r\n\t\t\thasAnimation: state.settings.noteAnimation.value,\r\n\t\t\tapproachRate: state.settings.approachSpeed.value\r\n\t\t}\r\n\t\tconst menuFunctions = {\r\n\t\t\taddSong: this.addSong,\r\n\t\t\tremoveSong: this.removeSong,\r\n\t\t\tchangePage: this.props.changePage,\r\n\t\t\thandleSettingChange: this.handleSettingChange,\r\n\t\t\tchangeVolume: this.changeVolume\r\n\t\t}\r\n\t\tconst menuData = {\r\n\t\t\tsongs: state.songs,\r\n\t\t\tsettings: state.settings\r\n\t\t}\r\n\r\n\t\treturn <div className='app bg-image' style={{ backgroundImage: `url(${state.settings.backgroundImage.value})` }}>\r\n\t\t\t{songStore.data.eventType !== 'approaching' &&\r\n\t\t\t\t<div className='record-button'>\r\n\t\t\t\t\t<AppButton\r\n\t\t\t\t\t\tactive={state.isRecordingAudio}\r\n\t\t\t\t\t\tclick={this.toggleRecordAudio}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t{state.isRecordingAudio ? \"Finish recording\" : \"Record audio\"}\r\n\t\t\t\t\t</AppButton>\r\n\t\t\t\t</div>\r\n\t\t\t}\r\n\r\n\t\t\t{state.isDragging && <div className='drag-n-drop'>\r\n\t\t\t\tDrop file here\r\n\t\t\t</div>}\r\n\t\t\t<Menu functions={menuFunctions} data={menuData} />\r\n\t\t\t<div className=\"right-panel\">\r\n\t\t\t\t<div className=\"upper-right\">\r\n\t\t\t\t\t{!this.state.thereIsSong\r\n\t\t\t\t\t\t&&\r\n\t\t\t\t\t\t<AppButton\r\n\t\t\t\t\t\t\tactive={state.isRecording}\r\n\t\t\t\t\t\t\tclick={this.toggleRecord}\r\n\t\t\t\t\t\t\tstyle={{marginTop: \"0.8rem\"}}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t{state.isRecording ? \"Stop\" : \"Record\"}\r\n\t\t\t\t\t\t</AppButton>\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"keyboard-wrapper\" style={{marginBottom: '2vh'}}>\r\n\t\t\t\t\t<Keyboard\r\n\t\t\t\t\t\tkey={state.instrument.instrumentName}\r\n\t\t\t\t\t\tdata={keyboardData}\r\n\t\t\t\t\t\tfunctions={keyboardFunctions}\r\n\t\t\t\t\t/>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\r\n\r\n\t}\r\n}\r\n\r\n\r\nfunction setIfInTWA() {\r\n\tif (isTwa()) return console.log('inTWA')\r\n\tlet isInTwa = document.referrer.includes('android-app://')\r\n\tsessionStorage.setItem('isTwa', isInTwa)\r\n}\r\nsetIfInTWA()\r\nfunction AppButton(props) {\r\n\tlet className = \"genshin-button \" + (props.active ? \"selected\" : \"\")\r\n\treturn <button className={className} onClick={props.click} style={{ ...(props.style || {}) }}>\r\n\t\t{props.children}\r\n\t</button>\r\n}\r\nexport default App;\r\n","export default __webpack_public_path__ + \"static/media/addCell.73b6c8e9.svg\";","export default __webpack_public_path__ + \"static/media/removeCell.e266ba1a.svg\";","import { useState, useEffect } from 'react';\r\nfunction useDebounce(value, delay) {\r\n  const [debouncedValue, setDebouncedValue] = useState(value);\r\n  useEffect(\r\n    () => {\r\n      const handler = setTimeout(() => {\r\n        setDebouncedValue(value);\r\n      }, delay);\r\n      return () => {\r\n        clearTimeout(handler);\r\n      };\r\n    },\r\n    [value, delay]\r\n  );\r\n  return debouncedValue;\r\n}\r\nexport default useDebounce;","import React, { Component, useEffect, useState } from 'react'\r\nimport { FilePicker } from \"react-file-picker\"\r\nimport { Midi } from '@tonejs/midi'\r\nimport { LoggerEvent, pitchArr, ColumnNote, Column, numberToLayer, ComposedSong, groupByIndex, mergeLayers } from 'lib/Utils'\r\nimport { appName } from 'appConfig'\r\nimport { FaInfoCircle } from 'react-icons/fa'\r\nimport useDebounce from 'lib/hooks/useDebounce'\r\nclass MidiImport extends Component {\r\n    constructor(props) {\r\n        super(props)\r\n        this.state = {\r\n            fileName: '',\r\n            midi: null, \r\n            bpm: 220,\r\n            offset: 0,\r\n            pitch: 'C',\r\n            accidentals: 0,\r\n            outOfRange: 0,\r\n            totalNotes: 0,\r\n            includeAccidentals: true\r\n        }\r\n    }\r\n    handleFile = (file) => {\r\n        const reader = new FileReader();\r\n        reader.addEventListener('load', (event) => {\r\n            let midi\r\n            try {\r\n                midi = new Midi(event.target.result)\r\n            } catch (e) {\r\n                console.error(e)\r\n            }\r\n            if (!midi) return new LoggerEvent('Error', 'There was an error importing this file', 2000).trigger()\r\n            let bpm = midi.header.tempos[0]?.bpm\r\n            let key = midi.header.keySignatures[0]?.key\r\n            midi.tracks.forEach((track, i) => {\r\n                track.selected = true\r\n                track.layer = 0\r\n                track.name = track.name || `Track n.${i + 1}`\r\n                track.numberOfAccidentals = 0\r\n                track.numberOfOutOfRange = 0\r\n            })\r\n            this.setState({\r\n                midi: midi,\r\n                fileName: file.name,\r\n                bpm: Math.floor(bpm * 4) || 220,\r\n                offset: 0,\r\n                pitch: pitchArr.includes(key) ? key : 'C',\r\n            }, () => { if (this.state.midi !== null) this.convertMidi() })\r\n        })\r\n        reader.readAsArrayBuffer(file)\r\n    }\r\n\r\n    convertMidi = () => {\r\n        const { midi, bpm, offset, includeAccidentals, pitch } = this.state\r\n        let tracks = midi.tracks.filter(track => track.selected)\r\n        let notes = []\r\n        let numberOfAccidentals = 0\r\n        let outOfRange = 0\r\n        let totalNotes = 0\r\n        tracks.forEach(track => {\r\n            track.numberOfAccidentals = 0\r\n            track.numberOfOutOfRange = 0\r\n            track.notes.forEach(midiNote => {\r\n                totalNotes++\r\n                let convertedNote = convertMidiNote(midiNote.midi - offset)\r\n                let note = {\r\n                    time: Math.floor(midiNote.time * 1000),\r\n                    note: convertedNote.note,\r\n                    layer: track.layer\r\n                }\r\n                if (convertedNote.isAccidental) {\r\n                    numberOfAccidentals++\r\n                    track.numberOfAccidentals++\r\n                }\r\n                if (note.note !== null) {\r\n                    if (includeAccidentals || !convertedNote.isAccidental) {\r\n                        notes.push(note)\r\n                    }\r\n                } else {\r\n                    outOfRange++\r\n                    track.numberOfOutOfRange++\r\n                }\r\n            })\r\n        })\r\n        notes = notes.sort((a, b) => a.time - b.time)\r\n        let bpmToMs = Math.floor(60000 / bpm)\r\n        let groupedNotes = []\r\n        while (notes.length > 0) {\r\n            let row = [notes.shift()]\r\n            let amount = 0\r\n            for (let i = 0; i < notes.length; i++) {\r\n                if (row[0].time > notes[i].time - bpmToMs / 9) amount++\r\n            }\r\n            groupedNotes.push([...row, ...notes.splice(0, amount)])\r\n        }\r\n        let columns = []\r\n        let previousTime = 0\r\n        groupedNotes.forEach(notes => {\r\n            let note = notes[0]\r\n            if (!note) return\r\n            let elapsedTime = note.time - previousTime\r\n            previousTime = note.time\r\n            let emptyColumns = Math.floor((elapsedTime - bpmToMs) / bpmToMs)\r\n            if (emptyColumns > -1) new Array(emptyColumns).fill(0).forEach(() => columns.push(new Column())) // adds empty columns\r\n            let noteColumn = new Column()\r\n            noteColumn.notes = notes.map(note => {\r\n                return new ColumnNote(note.note, numberToLayer(note.layer))\r\n            })\r\n            columns.push(noteColumn)\r\n        })\r\n        columns.forEach(column => { //merges notes of different layer\r\n            let groupedNotes = groupByIndex(column)\r\n            column.notes = groupedNotes.map(group => {\r\n                group[0].layer = mergeLayers(group)\r\n                return group[0]\r\n            })\r\n        })\r\n        let song = new ComposedSong(\"Untitled\")\r\n        song.columns = columns\r\n        song.bpm = bpm\r\n        song.instruments = this.props.data.instruments\r\n        song.pitch = pitch\r\n        let lastColumn = this.props.data.selectedColumn\r\n        song.selected = lastColumn < song.columns.length ? lastColumn : 0\r\n        if (song.columns.length === 0) {\r\n            return new LoggerEvent(\"Error\", \"There are no notes\", 2000).trigger()\r\n        }\r\n        this.props.functions.loadSong(song)\r\n        this.setState({\r\n            accidentals: numberOfAccidentals,\r\n            totalNotes: totalNotes,\r\n            outOfRange: outOfRange\r\n        })\r\n    }\r\n\r\n    editTrack = (command, data) => {\r\n        let tracks = this.state.midi.tracks\r\n        if (command === 'index') {\r\n\r\n            tracks[data.index].selected = !tracks[data.index].selected\r\n        }\r\n        if (command === 'layer') {\r\n            tracks[data.index].layer = data.layer\r\n        }\r\n\r\n        this.setState({\r\n            midi: this.state.midi\r\n        }, () => { if (this.state.midi !== null) this.convertMidi() })\r\n    }\r\n    changeOffset = (value) => {\r\n        value = parseInt(value)\r\n        if (!Number.isInteger(value)) value = 0\r\n        if (this.state.offset === value) return\r\n        this.setState({\r\n            offset: value\r\n        }, () => { if (this.state.midi !== null) this.convertMidi() })\r\n    }\r\n    changePitch = (value) => {\r\n        this.props.functions.changePitch(value)\r\n        this.setState({\r\n            pitch: value\r\n        })\r\n    }\r\n    toggleAccidentals = () => {\r\n        this.setState({\r\n            includeAccidentals: !this.state.includeAccidentals\r\n        }, () => { if (this.state.midi !== null) this.convertMidi() })\r\n    }\r\n    changeBpm = (value) => {\r\n        value = parseInt(value)\r\n        if (!Number.isInteger(value)) value = 0\r\n        if (this.state.bpm === value) return\r\n        this.setState({\r\n            bpm: value\r\n        }, () => { if (this.state.midi !== null) this.convertMidi() })\r\n    }\r\n    render() {\r\n        const { handleFile, editTrack, state, changeBpm, changeOffset, changePitch } = this\r\n        const { fileName, midi, bpm, offset, pitch, accidentals, outOfRange, totalNotes, includeAccidentals } = state\r\n        const { functions } = this.props\r\n        const { changeMidiVisibility } = functions\r\n        return <div className='floating-midi'>\r\n            <div\r\n                className='midi-row separator-border'\r\n                style={{ width: '100%' }}\r\n            >\r\n                <FilePicker onChange={handleFile}>\r\n                    <button className=\"midi-btn\">\r\n                        Click to load midi file\r\n                    </button>\r\n                </FilePicker>\r\n                <div style={{ margin: '0 0.5rem', maxWidth: '8rem', textOverflow: 'ellipsis', overflow: 'hidden' }}>\r\n                    {fileName}\r\n                </div>\r\n                <button\r\n                    className='midi-btn'\r\n                    style={{ marginLeft: 'auto' }}\r\n                    onClick={() => changeMidiVisibility(false)}\r\n                >\r\n                    Close\r\n                </button>\r\n            </div>\r\n            <table className='separator-border' style={{ width: \"100%\" }}>\r\n                <tbody>\r\n                    <tr>\r\n                        <td>\r\n                            <div style={{ marginRight: '0.5rem' }}>Bpm:</div>\r\n                        </td>\r\n                        <td style={{ display: 'flex', justifyContent: 'flex-end', alignItems: \"center\" }}>\r\n                            <NumberInput\r\n                                value={bpm}\r\n                                changeValue={changeBpm}\r\n                                delay={600}\r\n                                step={5}\r\n                            />\r\n                        </td>\r\n                    </tr>\r\n                    <tr>\r\n                        <td>\r\n                            <div style={{ marginRight: '0.5rem' }}>Scale notes by: </div>\r\n                        </td>\r\n                        <td>\r\n                            <NumberInput\r\n                                value={offset}\r\n                                changeValue={changeOffset}\r\n                                delay={600}\r\n                                step={1}\r\n                            />\r\n                        </td>\r\n                    </tr>\r\n                    <tr>\r\n                        <td>\r\n                            <div style={{ marginRight: '0.5rem' }}>Pitch:</div>\r\n                        </td>\r\n                        <td style={{ display: 'flex', justifyContent: 'flex-end', alignItems: \"center\" }}>\r\n                            <select\r\n                                className='midi-select'\r\n                                value={pitch}\r\n                                onChange={(event) => changePitch(event.target.value)}\r\n                                style={{ backgroundColor: '#576377', width: '5rem' }}\r\n                            >\r\n                                <option value=\"C\">C</option>\r\n                                <option value=\"Db\">Db</option>\r\n                                <option value=\"D\">D</option>\r\n                                <option value=\"Eb\">Eb</option>\r\n                                <option value=\"E\">E</option>\r\n                                <option value=\"F\">F</option>\r\n                                <option value=\"Gb\">Gb</option>\r\n                                <option value=\"G\">G</option>\r\n                                <option value=\"Ab\">Ab</option>\r\n                                <option value=\"A\">A</option>\r\n                                <option value=\"Bb\">Bb</option>\r\n                                <option value=\"B\">B</option>\r\n                            </select>\r\n                        </td>\r\n                    </tr>\r\n                    <tr>\r\n                        <td>\r\n                            <div style={{ marginRight: '0.5rem' }}>Include accidentals:</div>\r\n                        </td>\r\n                        <td style={{ display: 'flex', justifyContent: 'flex-end' }}>\r\n                            <input type='checkbox'\r\n                                checked={includeAccidentals}\r\n                                onChange={this.toggleAccidentals}\r\n                            />\r\n                        </td>\r\n                    </tr>\r\n                </tbody>\r\n            </table>\r\n            {midi !== null && <div className='midi-column separator-border' style={{ width: '100%' }}>\r\n                <div className='midi-column' style={{ width: '100%' }}>\r\n                    <div>Select midi tracks</div>\r\n                    {midi?.tracks.map((track, i) =>\r\n                        <Track\r\n                            data={track}\r\n                            key={i}\r\n                            index={i}\r\n                            editTrack={editTrack}\r\n                        />\r\n                    )}\r\n                </div>\r\n            </div>\r\n            }\r\n            {midi !== null && <table>\r\n                <tbody>\r\n                    <tr>\r\n                        <td>Total notes: </td>\r\n                        <td />\r\n                        <td>{totalNotes}</td>\r\n                    </tr>\r\n                    <tr>\r\n                        <td>Accidentals: </td>\r\n                        <td />\r\n                        <td>{accidentals}</td>\r\n                    </tr>\r\n                    <tr>\r\n                        <td>Out of range: </td>\r\n                        <td />\r\n                        <td>{outOfRange}</td>\r\n                    </tr>\r\n                </tbody>\r\n            </table>\r\n            }\r\n        </div>\r\n    }\r\n}\r\n\r\nfunction Track(props) {\r\n    const { data, index, editTrack } = props\r\n    const [dataShown, setDataShown] = useState(false)\r\n    return <div className='midi-track-column'>\r\n        <div className='midi-track-wrapper'>\r\n            <div className='midi-track-center'>\r\n                <input type='checkbox' onChange={() => editTrack(\"index\", { index: index })} checked={data.selected} />\r\n                {data.name} ({data.notes.length})\r\n            </div>\r\n            <div className='midi-track-center'>\r\n                <div style={{ textAlign: 'center' }}>\r\n                    {data.instrument.family}\r\n                </div>\r\n                <select\r\n                    onChange={(event) => editTrack('layer', { index: index, layer: Number(event.target.value) })}\r\n                    value={data.layer}\r\n                    className='midi-select'\r\n                >\r\n                    <option value='0'>Layer 1</option>\r\n                    <option value='1'>Layer 2</option>\r\n                    <option value='2'>Layer 3</option>\r\n                </select>\r\n\r\n                <FaInfoCircle\r\n                    size={22}\r\n                    color={dataShown ? \"rgb(207, 122, 130)\" : \"white\"}\r\n                    onClick={() => setDataShown(!dataShown)}\r\n                    cursor='pointer'\r\n                />\r\n            </div>\r\n\r\n        </div>\r\n        <div className='midi-track-data' style={{ display: dataShown ? \"flex\" : \"none\" }}>\r\n            <div className='midi-track-data-row'>\r\n                <div>Instrument:</div>\r\n                <div>{data.instrument.name}</div>\r\n            </div>\r\n            <div className='midi-track-data-row'>\r\n                <div>Number of notes:</div>\r\n                <div>{data.notes.length}</div>\r\n            </div>\r\n            <div className='midi-track-data-row'>\r\n                <div>Accidentals:</div>\r\n                <div>{data.numberOfAccidentals}</div>\r\n            </div>\r\n            <div className='midi-track-data-row'>\r\n                <div>Out of range:</div>\r\n                <div>{data.numberOfOutOfRange}</div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n}\r\n\r\nexport default MidiImport\r\n\r\nfunction NumberInput(props) {\r\n    const { changeValue, value, delay = 500, step = 1 } = props\r\n    const [elementValue, setElementValue] = useState(value)\r\n    const debounced = useDebounce(elementValue, delay)\r\n    useEffect(() => {\r\n        changeValue(debounced)\r\n        // eslint-disable-next-line react-hooks/exhaustive-deps\r\n    }, [debounced]);\r\n    useEffect(() => {\r\n        setElementValue(value)\r\n    }, [value])\r\n    return <div style={{ display: 'flex', justifyContent: 'flex-end' }} >\r\n        <button\r\n            onClick={() => setElementValue(elementValue - step)}\r\n            className='midi-btn-small'\r\n        >-</button>\r\n        <input\r\n            type=\"text\"\r\n            value={elementValue}\r\n            onChange={(e) => setElementValue(e.target.value)}\r\n            className='midi-input'\r\n            style={{ margin: '0 0.3rem' }}\r\n        />\r\n        <button\r\n            onClick={() => setElementValue(elementValue + step)}\r\n            className='midi-btn-small'\r\n        >+</button>\r\n    </div>\r\n}\r\n\r\nfunction convertMidiNote(midiNote) {\r\n    let note = null\r\n    let isAccidental = false\r\n    if (appName === 'Sky') {\r\n        switch (midiNote) {\r\n            case 60: note = 0; break;\r\n            case 61: note = 0; isAccidental = true; break;\r\n            case 62: note = 1; break;\r\n            case 63: note = 1; isAccidental = true; break;\r\n            case 64: note = 2; break;\r\n            case 65: note = 3; break;\r\n            case 66: note = 3; isAccidental = true; break;\r\n            case 67: note = 4; break;\r\n            case 68: note = 4; isAccidental = true; break;\r\n            case 69: note = 5; break;\r\n            case 70: note = 5; isAccidental = true; break;\r\n            case 71: note = 6; break;\r\n            case 72: note = 7; break;\r\n            case 73: note = 7; isAccidental = true; break;\r\n            case 74: note = 8; break;\r\n            case 75: note = 8; isAccidental = true; break;\r\n            case 76: note = 9; break;\r\n            case 77: note = 10; break;\r\n            case 78: note = 10; isAccidental = true; break;\r\n            case 79: note = 11; break;\r\n            case 80: note = 11; isAccidental = true; break;\r\n            case 81: note = 12; break;\r\n            case 82: note = 12; isAccidental = true; break;\r\n            case 83: note = 13; break;\r\n            case 84: note = 14; break;\r\n            default: note = null;\r\n        }\r\n    }\r\n    if (appName === 'Genshin') {\r\n        switch (midiNote) {\r\n            case 48: note = 14; break;\r\n            case 49: note = 14; isAccidental = true; break;\r\n            case 50: note = 15; break;\r\n            case 51: note = 15; isAccidental = true; break;\r\n            case 52: note = 16; break;\r\n            case 53: note = 17; break;\r\n            case 54: note = 17; isAccidental = true; break;\r\n            case 55: note = 18; break;\r\n            case 56: note = 18; isAccidental = true; break;\r\n            case 57: note = 19; break;\r\n            case 58: note = 19; isAccidental = true; break;\r\n            case 59: note = 20; break;\r\n            case 60: note = 7; break;\r\n            case 61: note = 7; isAccidental = true; break;\r\n            case 62: note = 8; break;\r\n            case 63: note = 8; isAccidental = true; break;\r\n            case 64: note = 9; break;\r\n            case 65: note = 10; break;\r\n            case 66: note = 10; isAccidental = true; break;\r\n            case 67: note = 11; break;\r\n            case 68: note = 11; isAccidental = true; break;\r\n            case 69: note = 12; break;\r\n            case 70: note = 12; isAccidental = true; break;\r\n            case 71: note = 13; break;\r\n            case 72: note = 0; break;\r\n            case 73: note = 0; isAccidental = true; break;\r\n            case 74: note = 1; break;\r\n            case 75: note = 1; isAccidental = true; break;\r\n            case 76: note = 2; break;\r\n            case 77: note = 3; break;\r\n            case 78: note = 3; isAccidental = true; break;\r\n            case 79: note = 4; break;\r\n            case 80: note = 4; isAccidental = true; break;\r\n            case 81: note = 5; break;\r\n            case 82: note = 5; isAccidental = true; break;\r\n            case 83: note = 6; break;\r\n            default: note = null;\r\n        }\r\n    }\r\n    return {\r\n        note: note,\r\n        isAccidental: isAccidental\r\n    }\r\n}","\r\nexport default function ComposerTools(props) {\r\n    const { data, functions } = props\r\n    const { toggleTools, copyColumns, eraseColumns, pasteColumns, deleteColumns } = functions\r\n    const { visible, copiedColumns } = data\r\n\r\n    return <div className={visible ? \"floating-tools tools-visible\" : \"floating-tools\"}>\r\n        <div className=\"tools-row\">\r\n            <div>\r\n                Scroll to the left / right to select the columns\r\n            </div>\r\n            <button onClick={toggleTools}>\r\n                Close\r\n            </button>\r\n        </div>\r\n        <div className=\"tools-buttons-wrapper\">\r\n            <div className='tools-half'>\r\n                <button\r\n                    disabled={copiedColumns.length !== 0}\r\n                    onClick={(e) => {\r\n                        e.currentTarget.blur()\r\n                        copyColumns('all')\r\n                    }}\r\n                    className={copiedColumns.length !== 0 ? \"tools-button-highlighted\" : \"\"}\r\n                >\r\n                    Copy\r\n                </button>\r\n                <button\r\n                    disabled={copiedColumns.length !== 0}\r\n                    onClick={(e) => {\r\n                        e.currentTarget.blur()\r\n                        copyColumns(data.layer)\r\n                    }}\r\n                    className={copiedColumns.length !== 0 ? \"tools-button-highlighted\" : \"\"}\r\n                >\r\n                    Copy layer {data.layer}\r\n                </button>\r\n            </div>\r\n            <div className='tools-half'>\r\n                <button\r\n                    disabled={copiedColumns.length === 0}\r\n                    onClick={(e) => {\r\n                        e.currentTarget.blur()\r\n                        pasteColumns(false)\r\n                    }}\r\n                >\r\n                    Paste\r\n                </button>\r\n                <button\r\n                    disabled={copiedColumns.length === 0}\r\n                    onClick={(e) => {\r\n                        e.currentTarget.blur()\r\n                        pasteColumns(true)\r\n                    }}\r\n                >\r\n                    Insert\r\n                </button>\r\n            </div>\r\n            <div className='tools-half'>\r\n                <button\r\n                    disabled={copiedColumns.length !== 0}\r\n                    onClick={(e) => {\r\n                        e.currentTarget.blur()\r\n                        eraseColumns('all')\r\n                    }}\r\n                >\r\n                    Erase\r\n                </button>\r\n                <button\r\n                    disabled={copiedColumns.length !== 0}\r\n                    onClick={(e) => {\r\n                        e.currentTarget.blur()\r\n                        eraseColumns(data.layer)\r\n                    }}\r\n                >\r\n                    Erase layer {data.layer}\r\n                </button>\r\n            </div>\r\n\r\n            <button\r\n                disabled={copiedColumns.length !== 0}\r\n                onClick={deleteColumns}\r\n            >\r\n                Delete\r\n            </button>\r\n        </div>\r\n    </div>\r\n}","import React, { Component } from 'react'\r\nimport { cssClasses, appName , instrumentsData} from \"appConfig\" \r\nimport GenshinNoteBorder from 'components/GenshinNoteBorder'\r\nclass ComposerNote extends Component {\r\n    constructor(props) {\r\n        super(props)\r\n        this.state = {\r\n\r\n        }\r\n    }\r\n    shouldComponentUpdate(next, prev) {\r\n        let canRender = false\r\n        canRender = canRender ||this.props.layers !== next.layers || this.props.noteText !== next.noteText\r\n        canRender = canRender || this.props.instrument !== next.instrument\r\n        return canRender\r\n    }\r\n    render() {\r\n        const {props} = this\r\n        const { data, layers,instrument } = props\r\n        let className = cssClasses.noteComposer\r\n        if (layers[0] === \"1\") className += \" layer-1\"\r\n        if (layers[1] === \"1\") className += \" layer-2\"\r\n        if (layers[2] === \"1\") className += \" layer-3\"\r\n        let layer3Class = \"Sky\" ? \"layer-3-ball-bigger\" : \"layer-3-ball\"\r\n        let effects = instrumentsData[instrument]?.effects || {}\r\n        return <button onPointerDown={() => this.props.clickAction(data)} className=\"button-hitbox\">\r\n            <div className={className} >\r\n                <img\r\n                    draggable=\"false\"\r\n                    alt={data.noteNames.mobile}\r\n                    src={props.noteImage}\r\n                    style={effects}\r\n                >\r\n                  \r\n                </img>\r\n                {appName === 'Genshin' && <GenshinNoteBorder\r\n                    className='genshin-border'\r\n                />}\r\n                <div className={layer3Class}>\r\n                </div>\r\n                <div className={appName === \"Sky\" ? \"note-name-sky\" : \"note-name\"}>\r\n                    {props.noteText}\r\n                </div>\r\n            </div>\r\n        </button>\r\n    }\r\n}\r\n\r\nexport default ComposerNote","import { memo } from \"react\"\r\nexport default memo(function MultiSwitch(props){\r\n    const { options, selected, selectedColor, buttonsClass, onSelect } = props\r\n    return <>\r\n        {options.map(e => {\r\n            return <button\r\n                style={{ backgroundColor: e === selected ? selectedColor : \"\" }}\r\n                className={buttonsClass}\r\n                onClick={() => onSelect(e)}\r\n                key={e}\r\n            >\r\n                {e}\r\n            </button>\r\n        })}\r\n    </>\r\n},(p,n)=>{\r\n    return p.options?.length === n.options?.length \r\n        && p.selected === n.selected\r\n        && p.onSelect === n.onSelect\r\n})","import React, { Component } from 'react'\r\nimport ComposerNote from \"./Components/ComposerNote\"\r\nimport MultiSwitch from \"./Components/MultiSwitch\"\r\nimport { appName, keyNames, pitchArr , layoutImages,layoutData } from \"appConfig\"\r\nclass ComposerKeyboard extends Component {\r\n    constructor(props) {\r\n        super(props)\r\n        this.state = {\r\n\r\n        }\r\n        //TODO convert this into a functional component\r\n    }\r\n\r\n    render() {\r\n        const { data, functions } = this.props\r\n        let notesIndexes = data.currentColumn.notes.map((e) => e.index)\r\n        let hiddenSideMenu = data.isPlaying ? \" hidden\" : \"\"\r\n        let keyboardClass = \"keyboard\"\r\n        if (data.keyboard.layout.length === 15) keyboardClass += \" keyboard-5\"\r\n        if (data.keyboard.layout.length === 8) keyboardClass += \" keyboard-4\"\r\n        return <div>\r\n            <div className={keyboardClass}>\r\n            {data.keyboard.layout.length === 0 ? <div className=\"loading\">Loading...</div> : null}\r\n                {data.keyboard.layout.map((note, i) => {\r\n                    let index = notesIndexes.indexOf(i)\r\n                    let noteText = \"\"\r\n                    let noteImage = \"\"\r\n                    try{    \r\n                        noteImage = layoutImages[data.keyboard.layout.length][note.index]  \r\n                        if(data.noteNameType === \"Note name\") noteText = keyNames[appName][pitchArr.indexOf(data.pitch)][note.index]\r\n                        if(data.noteNameType === \"Keyboard layout\") noteText = layoutData[data.keyboard.layout.length].keyboardLayout[note.index]\r\n                        if(data.noteNameType === \"Do Re Mi\") noteText = layoutData[data.keyboard.layout.length].mobileLayout[note.index]\r\n                    }catch(e){}\r\n                    return <ComposerNote\r\n                        key={note.index}\r\n                        layers={index >= 0 ? data.currentColumn.notes[index].layer : \"000\"}\r\n                        data={note}\r\n                        noteText={noteText}\r\n                        instrument={data.keyboard.instrumentName}\r\n                        noteImage={`./assets/icons/keys/${noteImage}.svg`}\r\n                        clickAction={functions.handleClick}\r\n                    />\r\n                })}\r\n            </div>\r\n            <div className={\"bottom-right-wrapper\" + hiddenSideMenu}>\r\n                <div className={\"layer-buttons-wrapper\"}>\r\n                    <div className=\"bottom-right-text\">\r\n                        Layer\r\n                    </div>\r\n                    <MultiSwitch\r\n                        buttonsClass={\"layer-button\"}\r\n                        selectedColor={\"#63aea7\"}\r\n                        options={[1, 2, 3]}\r\n                        onSelect={functions.changeLayer}\r\n                        selected={data.layer}\r\n                    />\r\n                </div>\r\n                <div className=\"tempo-changers-wrapper\">\r\n                    <div className=\"bottom-right-text\">\r\n                        Tempo\r\n                    </div>\r\n                    {data.TempoChangers.map((e) => {\r\n                        return <button\r\n                            key={e.id}\r\n                            onClick={() => functions.handleTempoChanger(e)}\r\n                            style={{ backgroundColor: \"#\" + e.color.toString(16) }}\r\n                        >\r\n                            {e.text}\r\n                        </button>\r\n                    })}\r\n                </div>\r\n            </div>\r\n        </div>\r\n    }\r\n}\r\n\r\n\r\n\r\nexport default ComposerKeyboard","import { TempoChangers } from \"lib/Utils\"\r\nimport * as PIXI from \"pixi.js\"\r\nimport { cacheData, notesPerColumn } from \"appConfig\"\r\nconst { noteData, horizontalLineBreak, standards, layersCombination, breakpoints } = cacheData\r\n\r\nexport class ComposerCache {\r\n    constructor(width, height, margin = 4, timelineHeight = 30) {\r\n        this.width = width\r\n        this.height = height\r\n        this.cache = {\r\n            columns: [],\r\n            notes: {},\r\n            standard: [],\r\n            columnsLarger: [],\r\n            standardLarger: [],\r\n            breakpoints: []\r\n        }\r\n        this.notesFigures = []\r\n        this.timelineHeight = timelineHeight\r\n        this.margin = margin\r\n        this.noteWidth = this.width\r\n        this.noteHeight = this.height / notesPerColumn\r\n        this.app = new PIXI.Application({\r\n            width: width,\r\n            height: height,\r\n        })\r\n        this.generate()\r\n    }\r\n    destroy = () => {\r\n        this.app.destroy()\r\n    }\r\n    generate = () => {\r\n        TempoChangers.forEach(tempoChanger => {\r\n            let canvas = drawColumn(tempoChanger, this, 1)\r\n            this.cache.columns.push(canvas.toDataURL())\r\n        })\r\n        standards.forEach(standardColumn => {\r\n            let canvas = drawColumn(standardColumn, this, 1)\r\n            this.cache.standard.push(canvas.toDataURL())\r\n        })\r\n        standards.forEach(standardColumn => {\r\n            let canvas = drawColumn(standardColumn, this, 3)\r\n            this.cache.standardLarger.push(canvas.toDataURL())\r\n        })\r\n        layersCombination.forEach(note => {\r\n            let roundNess = this.noteWidth > 20 ? 4 : 2\r\n            let canvas = document.createElement(\"canvas\")\r\n            canvas.height = this.noteHeight\r\n            canvas.width = this.noteWidth\r\n            let ctx = canvas.getContext(\"2d\")\r\n            if (note[0] === \"1\") {\r\n                ctx.fillStyle = noteData.background\r\n                roundRect(\r\n                    ctx,\r\n                    this.margin / 2,\r\n                    this.margin / 2,\r\n                    this.noteWidth - this.margin - 1,\r\n                    this.noteHeight - this.margin - 1,\r\n                    roundNess,\r\n                    true,\r\n                    false\r\n                )\r\n            }\r\n            if (note[1] === \"1\") {\r\n                ctx.strokeStyle = noteData.border\r\n                ctx.lineWidth = 2\r\n                roundRect(\r\n                    ctx,\r\n                    this.margin / 2,\r\n                    this.margin / 2,\r\n                    this.noteWidth - this.margin - 1,\r\n                    this.noteHeight - this.margin - 1,\r\n                    roundNess,\r\n                    false,\r\n                    true\r\n                )\r\n            }\r\n            if (note[2] === \"1\") {\r\n                ctx.beginPath()\r\n                ctx.fillStyle = noteData.center\r\n                let ballHeight = this.noteHeight / 4\r\n                ctx.arc(this.noteWidth / 2 - 0.5, this.noteHeight / 2 - 0.5, ballHeight, 0, 2 * Math.PI);\r\n                ctx.fill()\r\n            }\r\n            this.cache.notes[note] = canvas.toDataURL()\r\n        })\r\n        TempoChangers.forEach(tempoChanger => {\r\n            let canvas = drawColumn(tempoChanger, this, 2)\r\n            this.cache.columnsLarger.push(canvas.toDataURL())\r\n        })\r\n        breakpoints.forEach(breakpoint => {\r\n            let canvas = document.createElement(\"canvas\")\r\n            if (breakpoint.type === \"short\") {\r\n                let size = this.timelineHeight / 6\r\n                canvas.height = this.timelineHeight\r\n                canvas.width = size * 2\r\n                let ctx = canvas.getContext(\"2d\")\r\n                ctx.fillStyle = breakpoint.color\r\n                ctx.arc(size, this.timelineHeight / 2, size, 0, 2 * Math.PI);\r\n                ctx.fill()\r\n                this.cache.breakpoints.push(canvas.toDataURL())\r\n            } else {\r\n                canvas.height = this.height\r\n                canvas.width = this.width\r\n                let ctx = canvas.getContext(\"2d\")\r\n                ctx.fillStyle = breakpoint.color\r\n                /*\r\n               ctx.strokeStyle = breakpoint.color\r\n               ctx.lineWidth = 3\r\n                ctx.strokeRect(1,1,this.width - 3,this.height - 2)\r\n                */\r\n                ctx.beginPath();\r\n                ctx.moveTo(0, this.height)\r\n                ctx.lineTo(this.noteWidth / 2, this.height)\r\n                ctx.lineTo(0, this.height - this.noteHeight)\r\n                ctx.fill();\r\n                ctx.beginPath();\r\n                ctx.moveTo(this.width, this.height)\r\n                ctx.lineTo(this.noteWidth / 2, this.height)\r\n                ctx.lineTo(this.width, this.height - this.noteHeight)\r\n                ctx.fill();\r\n                ctx.beginPath();\r\n                ctx.moveTo(0, 0)\r\n                ctx.lineTo(this.noteWidth / 2, 0)\r\n                ctx.lineTo(0, this.noteHeight)\r\n                ctx.fill();\r\n                ctx.beginPath();\r\n                ctx.moveTo(this.width, 0)\r\n                ctx.lineTo(this.noteWidth / 2, 0)\r\n                ctx.lineTo(this.width, this.noteHeight)\r\n                ctx.fill();\r\n\r\n                this.cache.breakpoints.push(canvas.toDataURL())\r\n            }\r\n        })\r\n    }\r\n}\r\n\r\n\r\nfunction drawColumn(tempoChanger, self, borderWidth) {\r\n    let canvas = document.createElement(\"canvas\")\r\n    canvas.height = self.height\r\n    canvas.width = self.width\r\n    let ctx = canvas.getContext(\"2d\")\r\n    ctx.fillStyle = \"#\" + tempoChanger.color.toString(16)\r\n    ctx.fillRect(0, 0, self.width, self.height)\r\n    ctx.strokeStyle = borderWidth === 2 ? \"black\" : \"#333333\"\r\n    ctx.lineWidth = borderWidth\r\n    ctx.beginPath()\r\n    ctx.moveTo(self.width, 0)\r\n    ctx.lineTo(self.width, self.height)\r\n    ctx.stroke()\r\n    ctx.strokeStyle = \"#333333\"\r\n    for (let i = 1; i < 3; i++) {\r\n        ctx.lineWidth = 1\r\n        let y = self.noteHeight * horizontalLineBreak * i\r\n        ctx.moveTo(0, y)\r\n        ctx.lineTo(self.width, y)\r\n    }\r\n    ctx.stroke()\r\n    return canvas\r\n}\r\n\r\nfunction roundRect(ctx, x, y, width, height, radius, fill, stroke) {\r\n    if (typeof stroke === 'undefined') {\r\n        stroke = true;\r\n    }\r\n    if (typeof radius === 'undefined') {\r\n        radius = 5;\r\n    }\r\n    if (typeof radius === 'number') {\r\n        radius = { tl: radius, tr: radius, br: radius, bl: radius };\r\n    } else {\r\n        var defaultRadius = { tl: 0, tr: 0, br: 0, bl: 0 };\r\n        for (var side in defaultRadius) {\r\n            radius[side] = radius[side] || defaultRadius[side];\r\n        }\r\n    }\r\n    ctx.beginPath();\r\n    ctx.moveTo(x + radius.tl, y);\r\n    ctx.lineTo(x + width - radius.tr, y);\r\n    ctx.quadraticCurveTo(x + width, y, x + width, y + radius.tr);\r\n    ctx.lineTo(x + width, y + height - radius.br);\r\n    ctx.quadraticCurveTo(x + width, y + height, x + width - radius.br, y + height);\r\n    ctx.lineTo(x + radius.bl, y + height);\r\n    ctx.quadraticCurveTo(x, y + height, x, y + height - radius.bl);\r\n    ctx.lineTo(x, y + radius.tl);\r\n    ctx.quadraticCurveTo(x, y, x + radius.tl, y);\r\n    ctx.closePath();\r\n    if (fill) {\r\n        ctx.fill();\r\n    }\r\n    if (stroke) {\r\n        ctx.stroke();\r\n    }\r\n\r\n}\r\n","import React, { Component } from 'react'\r\nimport { Stage, Container, Graphics, Sprite } from '@inlet/react-pixi';\r\nimport { FaStepBackward, FaStepForward, FaPlusCircle, FaMinusCircle } from 'react-icons/fa';\r\nimport isMobile from \"is-mobile\"\r\nimport \"./Composer.css\"\r\nimport { ComposerCache } from \"./Cache\"\r\n\r\nimport { composerNotePositions, notesPerColumn, appName } from \"../../appConfig\"\r\nimport Memoized from 'components/Memoized';\r\nlet NumOfColumnsPerCanvas = 35\r\n\r\nexport default class ComposerCanvas extends Component {\r\n    constructor(props) {\r\n        super(props)\r\n        let sizes = document.body.getBoundingClientRect()\r\n        this.sizes = sizes\r\n        NumOfColumnsPerCanvas = Number(this.props.data.settings.columnsPerCanvas.value)\r\n        let width = nearestEven(sizes.width * 0.84)\r\n        let height = nearestEven(sizes.height * 0.45)\r\n\r\n        if (window.screen.width < sizes.height) {\r\n            width = nearestEven(sizes.height * 0.84)\r\n            height = nearestEven(sizes.width * 0.45)\r\n        }\r\n        if (appName === \"Sky\") height = nearestEven(height * 0.95)\r\n        this.state = {\r\n            width: Math.floor(width),\r\n            height: Math.floor(height),\r\n            column: {\r\n                width: calcMinColumnWidth(nearestEven(width)),\r\n                height: height\r\n            },\r\n            timelineHeight: isMobile() ? 25 : 30,\r\n            currentBreakpoint: -1\r\n        }\r\n        this.canvasRef = React.createRef()\r\n        let margin = isMobile() ? 1 : 4\r\n        this.cache = new ComposerCache(this.state.column.width, height, margin, this.state.timelineHeight)\r\n        this.stageSelected = false\r\n        this.sliderSelected = false\r\n        this.hasSlided = false\r\n        this.stagePreviousPositon = 0\r\n        this.sliderOffset = 0\r\n        this.throttleScroll = 0\r\n        this.onSlider = false\r\n    }\r\n    resetPointerDown = (e) => {\r\n        this.stageSelected = false\r\n        this.sliderSelected = false\r\n        this.stagePreviousPositon = 0\r\n    }\r\n    componentDidMount() {\r\n        window.addEventListener(\"pointerup\", this.resetPointerDown)\r\n        window.addEventListener(\"keydown\", this.handleKeyboard)\r\n        this.canvasRef.current._canvas.addEventListener(\"wheel\", this.handleWheel)\r\n    }\r\n    componentWillUnmount() {\r\n        window.removeEventListener(\"pointerup\", this.resetPointerDown)\r\n        window.removeEventListener(\"keydown\", this.handleKeyboard)\r\n        this.canvasRef.current._canvas.removeEventListener(\"wheel\", this.handleWheel)\r\n        this.cache.destroy()\r\n    }\r\n    handleKeyboard = (event) => {\r\n        let key = event.code\r\n        switch (key) {\r\n            case \"ArrowRight\": this.handleBreakpoints(1)\r\n                break;\r\n            case \"ArrowLeft\": this.handleBreakpoints(-1)\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n    }\r\n    handleWheel = (e) => {\r\n        this.props.functions.selectColumn(this.props.data.selected + Math.sign(e.deltaY), true)\r\n    }\r\n    handleClick = (e, type) => {\r\n        const x = e.data.global.x\r\n        const { width } = this.state\r\n        const { data } = this.props\r\n        if (type === \"up\") {\r\n            this.sliderSelected = false\r\n        }\r\n        if (type === \"down\") {\r\n            this.sliderSelected = true\r\n            const relativeColumnWidth = width / data.columns.length\r\n            const stageSize = relativeColumnWidth * (NumOfColumnsPerCanvas + 1)\r\n            const stagePosition = relativeColumnWidth * data.selected - (NumOfColumnsPerCanvas / 2) * relativeColumnWidth\r\n            this.onSlider = x > stagePosition && x < stagePosition + stageSize\r\n            this.sliderOffset = stagePosition + stageSize / 2 - x\r\n            this.throttleScroll = Number.MAX_SAFE_INTEGER\r\n            this.handleSlide(e)\r\n        }\r\n        if (type === \"downStage\") {\r\n            this.stagePreviousPositon = x\r\n            this.stageSelected = true\r\n        }\r\n    }\r\n    handleStageSlide = (e) => {\r\n        let x = e.data.global.x\r\n        if (this.stageSelected === true) {\r\n            if (this.throttleScroll++ < 5) return\r\n            this.throttleScroll = 0\r\n            const { data, functions } = this.props\r\n            const amount = clamp(Math.ceil(Math.abs(this.stagePreviousPositon - x) / 8), 0, 4)\r\n            const sign = this.stagePreviousPositon < x ? -1 : 1\r\n            this.stagePreviousPositon = x\r\n            const newPosition = data.selected + sign * amount\r\n            if (data.selected === newPosition) return\r\n            functions.selectColumn(clamp(newPosition, 0, data.columns.length - 1), true)\r\n        }\r\n    }\r\n    handleBreakpoints = (direction) => {\r\n        const { selected, columns, breakpoints } = this.props.data\r\n        let breakpoint = direction === 1 //1 = right, -1 = left\r\n            ? breakpoints.filter((v) => v > selected).sort((a, b) => a - b)\r\n            : breakpoints.filter((v) => v < selected).sort((a, b) => b - a)\r\n        if (breakpoint.length === 0) return\r\n        if (columns.length >= breakpoint[0] && breakpoint[0] >= 0) {\r\n            this.props.functions.selectColumn(breakpoint[0])\r\n        }\r\n    }\r\n    handleSlide = (e) => {\r\n        const globalX = e.data.global.x\r\n        if (this.sliderSelected) {\r\n            if (this.throttleScroll++ < 4) return\r\n            const { width, column } = this.state\r\n            const { data } = this.props\r\n            this.hasSlided = true\r\n            this.throttleScroll = 0\r\n            const totalWidth = column.width * data.columns.length\r\n            const x = this.onSlider ? (globalX + this.sliderOffset) : globalX\r\n            let relativePos = Math.floor(x / width * totalWidth / column.width)\r\n            this.props.functions.selectColumn(relativePos, true)\r\n        }\r\n    }\r\n\r\n    render() {\r\n        const { width, timelineHeight, height } = this.state\r\n        const { data, functions } = this.props\r\n        const cache = this.cache.cache\r\n        const sizes = this.state.column\r\n        const xPos = (data.selected - NumOfColumnsPerCanvas / 2 + 1) * - sizes.width\r\n        const beatMarks = Number(data.settings.beatMarks.value)\r\n        const counterLimit = beatMarks === 0 ? 11 : 4 * beatMarks - 1\r\n        const relativeColumnWidth = width / data.columns.length\r\n        let switcher = false\r\n        let counter = 0\r\n        let stageSize = Math.floor(relativeColumnWidth * (NumOfColumnsPerCanvas + 1))\r\n        if (stageSize > width) stageSize = width\r\n        const stagePosition = relativeColumnWidth * data.selected - (NumOfColumnsPerCanvas / 2 - 1) * relativeColumnWidth\r\n        return <div className=\"canvas-wrapper\" style={{ width: width + 2 }}>\r\n            <Stage\r\n                width={width}\r\n                height={height}\r\n                raf={false}\r\n                renderOnComponentChange={true}\r\n                options={{\r\n                    backgroundColor: 0x495466,\r\n                }}\r\n                key={this.state.width}\r\n                ref={this.canvasRef}\r\n            >\r\n                <Container\r\n                    anchor={[0.5, 0.5]}\r\n                    x={xPos}\r\n                    interactive={true}\r\n                    pointerdown={(e) => this.handleClick(e, \"downStage\")}\r\n                    pointermove={(e) => this.handleStageSlide(e)}\r\n                >\r\n                    {data.columns.map((column, i) => {\r\n                        if (counter++ > counterLimit) {\r\n                            switcher = !switcher\r\n                            counter = 0\r\n                        }\r\n                        if (!isVisible(i, data.selected)) return null\r\n                        const tempoChangersCache = (i + 1) % 4 === 0 ? cache.columnsLarger : cache.columns\r\n                        const standardCache = (i + 1) % 4 === 0 ? cache.standardLarger : cache.standard\r\n                        const background = column.tempoChanger === 0 ? standardCache[Number(switcher)] : tempoChangersCache[column.tempoChanger]\r\n                        return <Column\r\n                            cache={cache}\r\n                            key={i}\r\n                            data={column}\r\n                            index={i}\r\n                            sizes={sizes}\r\n                            backgroundCache={background}\r\n                            isToolsSelected={data.toolsColumns.includes(i)}\r\n                            click={functions.selectColumn}\r\n                            isSelected={i === data.selected}\r\n                            isBreakpoint={data.breakpoints.includes(i)}\r\n                        />\r\n\r\n                    })}\r\n\r\n                </Container>\r\n            </Stage>\r\n            <div className=\"timeline-wrapper\" style={{ height: this.state.timelineHeight }}>\r\n                <div className=\"timeline-button\" onClick={() => this.handleBreakpoints(-1)}>\r\n                    <Memoized>\r\n                        <FaStepBackward />\r\n                    </Memoized>\r\n                </div>\r\n                <div className=\"timeline-button\" onClick={() => this.handleBreakpoints(1)} style={{ marginLeft: 0 }}>\r\n                    <Memoized>\r\n                        <FaStepForward />  \r\n                    </Memoized>\r\n                </div>\r\n                <div className='timeline-scroll'>\r\n                    <Stage\r\n                        width={width}\r\n                        height={timelineHeight}\r\n                        options={{ antialias: true, autoDensity: true, backgroundColor: 0x515c6f }}\r\n                        raf={false}\r\n                        renderOnComponentChange={true}\r\n                    >\r\n                        <Container\r\n                            width={width}\r\n                            height={timelineHeight}\r\n                            interactive={true}\r\n                            pointerdown={(e) => this.handleClick(e, \"down\")}\r\n                            pointerup={(e) => this.handleClick(e, \"up\")}\r\n                            pointermove={this.handleSlide}\r\n                        >\r\n                            <Graphics draw={(e) => { fillX(e, width, timelineHeight) }} />\r\n                            {data.breakpoints.map(breakpoint => {\r\n                                return <Sprite\r\n                                    image={cache.breakpoints[0]}\r\n                                    key={breakpoint}\r\n                                    x={relativeColumnWidth * breakpoint}\r\n                                >\r\n                                </Sprite>\r\n                            })}\r\n                        </Container>\r\n                        <Graphics draw={(e) => drawStage(e, stageSize, timelineHeight)} x={stagePosition} y={2} />\r\n                    </Stage>\r\n                </div>\r\n                <div className=\"timeline-button\" onClick={functions.toggleBreakpoint}>\r\n                    <Memoized>\r\n                        {data.breakpoints.includes(data.selected) \r\n                            ? <FaMinusCircle key='minus'/>\r\n                            : <FaPlusCircle key='plus'/>\r\n                        }   \r\n                    </Memoized>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    }\r\n}\r\n\r\nfunction fillX(g, width, height) {\r\n    g.clear()\r\n    g.beginFill(0x515c6f, 1)\r\n    g.drawRect(0, 0, width, height)\r\n}\r\n\r\nfunction drawStage(g, width, height) {\r\n    g.clear()\r\n    g.lineStyle(3, 0x1a968b, 0.8)\r\n    g.drawRoundedRect(0, 0, width - 2, height - 4, 6)\r\n}\r\n\r\nfunction Column(props) {\r\n    let { data, index, sizes, click, cache, backgroundCache, isBreakpoint, isSelected, isToolsSelected } = props\r\n    return <Container\r\n        pointertap={() => click(index)}\r\n        interactive={true}\r\n        x={sizes.width * index}\r\n    >\r\n        <Sprite\r\n            image={backgroundCache}\r\n            interactiveChildren={false}\r\n        >\r\n            {isSelected || isToolsSelected ? <Sprite\r\n                image={isToolsSelected && !isSelected ? cache.standard[3] : cache.standard[2]}\r\n                alpha={isToolsSelected ? 0.4 : 0.6}\r\n                zIndex={1}\r\n            >\r\n            </Sprite> : null}\r\n            {isBreakpoint ? <Sprite\r\n                image={cache.breakpoints[1]}\r\n            >\r\n            </Sprite> : null}\r\n        </Sprite>\r\n        {data.notes.map((note) => {\r\n            return <Sprite\r\n                key={note.index}\r\n                image={cache.notes[note.layer]}\r\n                y={composerNotePositions[note.index] * sizes.height / notesPerColumn}\r\n            >\r\n            </Sprite>\r\n        })}\r\n\r\n    </Container>\r\n}\r\nconst clamp = (num, min, max) => Math.min(Math.max(num, min), max);\r\nfunction calcMinColumnWidth(parentWidth) {\r\n    return nearestEven(parentWidth / NumOfColumnsPerCanvas)\r\n}\r\n\r\nfunction nearestEven(num) {\r\n    return 2 * Math.round(num / 2);\r\n}\r\n\r\nfunction isVisible(pos, currentPos) {\r\n    let threshold = NumOfColumnsPerCanvas / 2 + 2\r\n    let boundaries = [currentPos - threshold, currentPos + threshold]\r\n    return boundaries[0] < pos && pos < boundaries[1]\r\n}","import React, { Component } from 'react'\r\nimport { FaMusic, FaSave, FaCog, FaHome, FaTrash, FaDownload } from 'react-icons/fa';\r\nimport { FileDownloader, LoggerEvent, ComposerSongSerialization, prepareSongDownload } from \"lib/Utils\"\r\nimport { appName, isTwa } from 'appConfig'\r\nimport MenuItem from 'components/MenuItem'\r\nimport MenuPanel from 'components/MenuPanel'\r\nimport MenuClose from 'components/MenuClose'\r\nimport SettingsRow from 'components/SettingsRow'\r\nimport DonateButton from 'components/DonateButton'\r\nimport Memoized from 'components/Memoized';\r\n\r\nclass Menu extends Component {\r\n    constructor(props) {\r\n        super(props)\r\n        this.state = {\r\n            open: false,\r\n            selectedMenu: \"Settings\",\r\n            selectedSongType: \"composed\",\r\n        }\r\n    }\r\n    componentDidMount() {\r\n        window.addEventListener(\"keydown\", this.handleKeyboard)\r\n    }\r\n    componentWillUnmount() {\r\n        window.removeEventListener(\"keydown\", this.handleKeyboard)\r\n    }\r\n    handleKeyboard = (event) => {\r\n        let key = event.code\r\n        if (document.activeElement.tagName === \"INPUT\") return\r\n        document.activeElement?.blur()\r\n        switch (key) {\r\n            case \"Escape\": {\r\n                if (this.state.open) this.props.functions.toggleMenuVisible()\r\n                this.setState({ open: false })\r\n                break\r\n            }\r\n            default: break;\r\n        }\r\n    }\r\n    toggleMenu = (override) => {\r\n        if (typeof override !== \"boolean\") override = undefined\r\n        let newState = override !== undefined ? override : !this.state.open\r\n        this.setState({\r\n            open: newState,\r\n        })\r\n        if (newState === false) {\r\n            this.props.functions.toggleMenuVisible()\r\n        }\r\n    }\r\n    changeSelectedSongType = (name) => {\r\n        this.setState({\r\n            selectedSongType: name\r\n        })\r\n    }\r\n    selectSideMenu = (selection) => {\r\n        if (selection === this.state.selectedMenu && this.state.open) {\r\n            return this.setState({\r\n                open: false,\r\n            })\r\n        }\r\n        this.setState({\r\n            selectedMenu: selection,\r\n            open: true\r\n        })\r\n    }\r\n    downloadSong = (song) => {\r\n        if (song._id) delete song._id\r\n        if (song.data.isComposedVersion) {\r\n            song = ComposerSongSerialization(song)\r\n        }\r\n        let songName = song.name\r\n        if (appName === \"Sky\") {\r\n            //adds old format into the sheet\r\n            song = prepareSongDownload(song)\r\n        }\r\n        if (!Array.isArray(song)) song = [song]\r\n        song.forEach(song1 => {\r\n            song1.data.appName = appName\r\n        })\r\n        let json = JSON.stringify(song)\r\n        let fileDownloader = new FileDownloader()\r\n        fileDownloader.download(json, `${songName}.${appName.toLowerCase()}sheet.json`)\r\n        new LoggerEvent(\"Success\", \"Song downloaded\").trigger()\r\n    }\r\n    updateSong = () => {\r\n      this.props.functions.updateSong(this.props.data.currentSong)  \r\n    }\r\n    render() {\r\n        const { data, functions } = this.props\r\n        let sideClass = this.state.open ? \"side-menu menu-open\" : \"side-menu\"\r\n        let selectedMenu = this.state.selectedMenu\r\n        const { loadSong, removeSong, changePage, handleSettingChange, changeVolume, createNewSong, changeMidiVisibility } = functions\r\n        let songFunctions = {\r\n            loadSong: loadSong,\r\n            removeSong: removeSong,\r\n            toggleMenu: this.toggleMenu,\r\n            downloadSong: this.downloadSong\r\n        }\r\n        let songs = data.songs.filter(song => !song.data?.isComposedVersion)\r\n        let composedSongs = data.songs.filter(song => song.data?.isComposedVersion)\r\n        let hasUnsaved = data.hasChanges ? \"margin-top-auto not-saved\" : \"margin-top-auto\"\r\n        let menuClass = data.menuOpen ? \"menu menu-visible\" : \"menu\"\r\n        return <div className=\"menu-wrapper\">\r\n            <div className={menuClass}>\r\n                <MenuClose action={this.toggleMenu} />\r\n                <MenuItem type=\"Save\" action={this.updateSong} className={hasUnsaved}>\r\n                    <Memoized>\r\n                        <FaSave className=\"icon\" />\r\n                    </Memoized>\r\n                </MenuItem>\r\n                <MenuItem type=\"Songs\" action={this.selectSideMenu}>\r\n                    <Memoized>\r\n                        <FaMusic className=\"icon\" />\r\n                    </Memoized>\r\n                </MenuItem>\r\n                <MenuItem type=\"Settings\" action={this.selectSideMenu}>\r\n                    <Memoized>\r\n                        <FaCog className=\"icon\" />\r\n                    </Memoized>\r\n                </MenuItem>\r\n                <MenuItem type=\"Home\" action={() => changePage(\"home\")}>\r\n                    <Memoized>\r\n                        <FaHome className=\"icon\" />\r\n                    </Memoized>\r\n                </MenuItem>\r\n            </div>\r\n            <div className={sideClass}>\r\n                <MenuPanel title=\"No selection\" visible={selectedMenu}>\r\n                </MenuPanel>\r\n                <MenuPanel title=\"Songs\" visible={selectedMenu}>\r\n                    <div className=\"songs-buttons-wrapper\">\r\n                        <button className=\"genshin-button\" onClick={() => { changeMidiVisibility(true); this.toggleMenu() }}>\r\n                            Create from MIDI\r\n                        </button>\r\n                        <button className=\"genshin-button\" onClick={createNewSong}>\r\n                            Create new song\r\n                        </button>\r\n                    </div>\r\n                    <div className=\"tab-selector-wrapper\">\r\n                        <button\r\n                            className={this.state.selectedSongType === \"recorded\" ? \"tab-selector tab-selected\" : \"tab-selector\"}\r\n                            onClick={() => this.changeSelectedSongType(\"recorded\")}\r\n                        >\r\n                            Recorded\r\n                        </button>\r\n                        <button\r\n                            className={this.state.selectedSongType === \"composed\" ? \"tab-selector tab-selected\" : \"tab-selector\"}\r\n                            onClick={() => this.changeSelectedSongType(\"composed\")}\r\n                        >\r\n                            Composed\r\n                        </button>\r\n                    </div>\r\n                    <div className=\"songs-wrapper\" style={{ marginBottom: '0.5rem' }}>\r\n                        {this.state.selectedSongType === \"recorded\"\r\n                            ? songs.map(song => {\r\n                                return <SongRow\r\n                                    data={song}\r\n                                    key={song.name}\r\n                                    functions={songFunctions}\r\n                                >\r\n                                </SongRow>\r\n                            })\r\n\r\n                            : composedSongs.map(song => {\r\n                                return <SongRow\r\n                                    data={song}\r\n                                    key={song.name}\r\n                                    functions={songFunctions}\r\n                                >\r\n                                </SongRow>\r\n                            })\r\n                        }\r\n\r\n                    </div>\r\n                    <div className=\"songs-buttons-wrapper\" style={{ marginTop: 'auto' }}>\r\n                        <button\r\n                            className={`genshin-button record-btn ${data.isRecordingAudio ? \"selected\" : \"\"}`}\r\n                            onClick={() => functions.startRecordingAudio(!data.isRecordingAudio)}\r\n                        >\r\n                            {data.isRecordingAudio ? \"Stop recording audio\" : \"Start recording audio\"}\r\n                        </button>\r\n                    </div>\r\n\r\n                </MenuPanel>\r\n                <MenuPanel title=\"Settings\" visible={selectedMenu}>\r\n                    {Object.entries(data.settings).map(([key, data]) => {\r\n                        return <SettingsRow\r\n                            key={key}\r\n                            objKey={key}\r\n                            data={data}\r\n                            changeVolume={changeVolume}\r\n                            update={handleSettingChange}\r\n                        />\r\n                    })}\r\n                    {!isTwa() && <DonateButton onClick={changePage} />}\r\n                </MenuPanel>\r\n            </div>\r\n        </div>\r\n    }\r\n}\r\n\r\n\r\nfunction SongRow(props) {\r\n    const { data, functions } = props\r\n    const { removeSong, toggleMenu, loadSong, downloadSong } = functions\r\n    return <div className=\"song-row\">\r\n        <div className=\"song-name\" onClick={() => {\r\n            loadSong(data)\r\n            toggleMenu(false)\r\n        }}>\r\n            {data.name}\r\n        </div>\r\n        <div className=\"song-buttons-wrapper\">\r\n            <button className=\"song-button\" onClick={() => downloadSong(data)}>\r\n                <Memoized>\r\n                    <FaDownload />\r\n                </Memoized>\r\n            </button>\r\n            <button className=\"song-button\" onClick={() => removeSong(data.name)}>\r\n                <Memoized>\r\n                    <FaTrash color=\"#ed4557\" />\r\n                </Memoized>\r\n            </button>\r\n        </div>\r\n    </div>\r\n}\r\n\r\n\r\n\r\nexport default Menu","import React, { Component } from 'react'\r\nimport { FaPlay, FaPlus, FaPause, FaBars, FaChevronLeft, FaChevronRight, FaTools } from 'react-icons/fa';\r\n\r\nimport addCell from \"assets/icons/addCell.svg\"\r\nimport removeCell from \"assets/icons/removeCell.svg\"\r\nimport { appName, audioContext } from \"appConfig\"\r\n\r\nimport MidiImport from \"./MidiParser\"\r\nimport ComposerTools from \"./Components/ComposerTools\"\r\nimport ComposerKeyboard from \"./ComposerKeyboard\"\r\nimport ComposerCanvas from \"./Canvas\"\r\nimport Menu from \"./Components/Menu\"\r\nimport Memoized from 'components/Memoized';\r\nimport { asyncConfirm, asyncPrompt } from \"components/AsyncPrompts\"\r\nimport { ComposerSettings } from \"lib/SettingsObj\"\r\nimport Instrument from \"lib/Instrument\"\r\nimport {\r\n    ComposedSong, LoggerEvent, ColumnNote, Column, TempoChangers,\r\n    ComposerSongSerialization, ComposerSongDeSerialization, getPitchChanger, RecordingToComposed, delayMs\r\n} from \"lib/Utils\"\r\nimport AudioRecorder from 'lib/AudioRecorder'\r\nimport { DB } from 'Database';\r\n\r\nclass Composer extends Component {\r\n    constructor(props) {\r\n        super(props)\r\n\r\n        const settings = this.getSettings()\r\n        this.playbackInterval = undefined\r\n        this.audioContext = audioContext\r\n        this.reverbNode = undefined\r\n        this.reverbVolumeNode = undefined\r\n        this.recorder = new AudioRecorder()\r\n        this.state = {\r\n            instrument: new Instrument(),\r\n            layers: [new Instrument(), new Instrument()],\r\n            songs: [],\r\n            isPlaying: false,\r\n            song: new ComposedSong(\"Untitled\"),\r\n            settings: settings,\r\n            menuOpen: false,\r\n            layer: 1,\r\n            toolsColumns: [],\r\n            toolsVisible: false,\r\n            midiVisible: false,\r\n            isRecordingAudio: false\r\n        }\r\n        this.state.song.bpm = settings.bpm.value\r\n        this.state.song.instruments = [\r\n            settings.instrument.value,\r\n            settings.layer2.value, \r\n            settings.layer3.value\r\n        ]\r\n        this.mounted = false\r\n        this.copiedColums = []\r\n        this.changes = 0\r\n        this.broadcastChannel = {}\r\n    }\r\n\r\n    componentDidMount() {\r\n        this.mounted = true\r\n        this.init()\r\n        window.addEventListener(\"keydown\", this.handleKeyboard)\r\n        this.broadcastChannel = window.BroadcastChannel ? new BroadcastChannel(appName + '_composer') : {}\r\n        this.broadcastChannel.onmessage = (event) => {\r\n            if (!this.state.settings.syncTabs.value) return\r\n            if (!['play', 'stop'].includes(event?.data)) return\r\n            this.togglePlay(event.data === 'play')\r\n        }\r\n        if (window.location.hostname !== \"localhost\") {\r\n            window.addEventListener(\"beforeunload\", (event) => {\r\n                event.preventDefault()\r\n                event.returnValue = ''\r\n            })\r\n        }\r\n\r\n    }\r\n    componentWillUnmount() {\r\n        this.mounted = false\r\n        window.removeEventListener('keydown', this.handleKeyboard)\r\n        const { instrument, layers } = this.state\r\n        this.broadcastChannel?.close?.()\r\n        const instruments = [instrument, layers[0], layers[1]]\r\n        instruments.forEach(instrument => instrument.delete())\r\n        this.reverbNode = undefined\r\n        this.reverbVolumeNode = undefined\r\n        this.audioContext = undefined\r\n        let state = this.state\r\n        state.isPlaying = false\r\n    }\r\n\r\n    init = async () => {\r\n        this.syncSongs()\r\n        const { settings } = this.state\r\n        const promises = [\r\n            this.loadInstrument(settings.instrument.value, 1),\r\n            this.loadInstrument(settings.layer2.value, 2),\r\n            this.loadInstrument(settings.layer3.value, 3)\r\n        ]\r\n        if (this.mounted) await Promise.all(promises)\r\n        if (this.mounted) await this.loadReverb()\r\n        if (this.mounted) this.setupAudioDestination(settings.caveMode.value)\r\n    }\r\n    componentDidCatch() {\r\n        this.setState({\r\n            song: new ComposedSong(\"Untitled\")\r\n        })\r\n        new LoggerEvent(\"Warning\", \"There was an error with the song! Restoring default...\").trigger()\r\n    }\r\n    handleAutoSave = () => {\r\n        this.changes++\r\n        if (this.changes > 5 && this.state.settings.autosave.value) {\r\n            if (this.state.song.name !== \"Untitled\") {\r\n                this.updateSong(this.state.song)\r\n            }\r\n\r\n        }\r\n    }\r\n    loadReverb() {\r\n        return new Promise(resolve => {\r\n            fetch(\"./assets/audio/reverb4.wav\")\r\n                .then(r => r.arrayBuffer())\r\n                .then(b => {\r\n                    if (!this.mounted) return\r\n                    this.audioContext.decodeAudioData(b, (impulse_response) => {\r\n                        if (!this.mounted) return\r\n                        let convolver = this.audioContext.createConvolver()\r\n                        let gainNode = this.audioContext.createGain()\r\n                        gainNode.gain.value = 2.5\r\n                        convolver.buffer = impulse_response\r\n                        convolver.connect(gainNode)\r\n                        gainNode.connect(this.audioContext.destination)\r\n                        this.reverbNode = convolver\r\n                        this.reverbVolumeNode = gainNode\r\n                        resolve()\r\n                    })\r\n                }).catch((e) => {\r\n                    console.log(\"Error with reverb\", e)\r\n                })\r\n        })\r\n    }\r\n    getSettings = () => {\r\n        let storedSettings = localStorage.getItem(appName + \"_Composer_Settings\")\r\n        try {\r\n            storedSettings = JSON.parse(storedSettings)\r\n        } catch (e) {\r\n            storedSettings = null\r\n        }\r\n        if (storedSettings !== null) {\r\n            if (storedSettings.settingVesion !== ComposerSettings.settingVesion) {\r\n                this.updateSettings(ComposerSettings)\r\n                return ComposerSettings\r\n            }\r\n            return storedSettings\r\n        }\r\n        return ComposerSettings\r\n    }\r\n\r\n    updateSettings = (override) => {\r\n        let state\r\n        if (override !== undefined) {\r\n            state = override\r\n        } else {\r\n            state = this.state.settings\r\n        }\r\n        localStorage.setItem(appName + \"_Composer_Settings\", JSON.stringify(state))\r\n    }\r\n\r\n    handleSettingChange = (setting) => {\r\n        const { state } = this\r\n        let settings = state.settings\r\n        let data = setting.data\r\n        settings[setting.key] = {...settings[setting.key], value: data.value}\r\n        if (data.songSetting) {\r\n            state.song[setting.key] = data.value\r\n        }\r\n        if (setting.key === \"instrument\") this.loadInstrument(data.value, 1)\r\n        if (setting.key === \"layer2\") this.loadInstrument(data.value, 2)\r\n        if (setting.key === \"layer3\") this.loadInstrument(data.value, 3)\r\n        if (setting.key === \"caveMode\") this.setupAudioDestination(data.value)\r\n        this.setState({\r\n            settings: settings,\r\n            song: this.state.song\r\n        }, () => {\r\n            this.updateSettings()\r\n        })\r\n    }\r\n\r\n    loadInstrument = async (name, layer) => {\r\n        if (!this.mounted) return\r\n        const { settings } = this.state\r\n        if (layer === 1) {\r\n            this.state.instrument.delete()\r\n            let newInstrument = new Instrument(name)\r\n            await newInstrument.load()\r\n            if (!this.mounted) return\r\n            newInstrument.changeVolume(settings.instrument.volume)\r\n            this.setState({\r\n                instrument: newInstrument\r\n            })\r\n        } else {\r\n            let newInstrument = new Instrument(name)\r\n            let layers = this.state.layers\r\n            layers[layer - 2].delete()\r\n            layers[layer - 2] = newInstrument\r\n            await newInstrument.load()\r\n            if (!this.mounted) return\r\n            newInstrument.changeVolume(settings[`layer${layer}`]?.volume)\r\n            this.setState({\r\n                layers: layers\r\n            })\r\n        }\r\n        this.setupAudioDestination(settings.caveMode.value)\r\n    }\r\n    changeVolume = (obj) => {\r\n        let settings = this.state.settings\r\n        if (obj.key === \"instrument\") {\r\n            settings.instrument = {...settings.instrument, volume: obj.value}\r\n            this.state.instrument.changeVolume(obj.value)\r\n        }\r\n        if (obj.key === \"layer2\") {\r\n            settings.layer2 = {...settings.layer2, volume: obj.value}\r\n            this.state.layers[0].changeVolume(obj.value)\r\n        }\r\n        if (obj.key === \"layer3\") {\r\n            settings.layer3 = {...settings.layer3, volume: obj.value}\r\n            this.state.layers[1].changeVolume(obj.value)\r\n        }\r\n        this.setState({\r\n            settings: settings\r\n        }, () => this.updateSettings())\r\n    }\r\n    setupAudioDestination = (hasReverb) => {\r\n        if (!this.mounted) return\r\n        const { instrument, layers } = this.state\r\n        const instruments = [instrument, layers[0], layers[1]]\r\n        instruments.forEach(ins => {\r\n            if (hasReverb) {\r\n                if (!this.reverbNode) return console.log(\"Couldn't connect to reverb\")\r\n                ins.disconnect()\r\n                ins.connect(this.reverbNode)\r\n            } else {\r\n                ins.disconnect()\r\n                ins.connect(this.audioContext.destination)\r\n            }\r\n        })\r\n    }\r\n    startRecordingAudio = async (override) => { //will record untill the song stops\r\n        if (!this.mounted) return\r\n        if (!override) {\r\n            this.setState({ isRecordingAudio: false })\r\n            return this.togglePlay(false)\r\n        }\r\n        const { instrument, layers } = this.state\r\n        const instruments = [instrument, layers[0], layers[1]]\r\n        const hasReverb = this.state.settings.caveMode.value\r\n        const { recorder } = this\r\n        if (hasReverb) {\r\n            this.reverbVolumeNode.connect(recorder.node)\r\n        } else {\r\n            instruments.forEach(instrument => {\r\n                instrument.connect(recorder.node)\r\n            })\r\n        }\r\n        recorder.start()\r\n        this.setState({ isRecordingAudio: true })\r\n        await this.togglePlay(true) //wait till song finishes\r\n        if (!this.mounted) return\r\n        let recording = await recorder.stop()\r\n        this.setState({ isRecordingAudio: false })\r\n        let fileName = await asyncPrompt(\"Write the song name, press cancel to ignore\")\r\n        if (fileName) recorder.download(recording.data, fileName + '.wav')\r\n        if (!this.mounted) return\r\n        this.reverbVolumeNode.disconnect()\r\n        this.reverbVolumeNode.connect(audioContext.destination)\r\n        this.setupAudioDestination(hasReverb)\r\n    }\r\n    handleKeyboard = (event) => {\r\n        if (document.activeElement.tagName === \"INPUT\") return\r\n        const { instrument, layer, layers, isPlaying } = this.state\r\n        let key = event.code\r\n        const shouldEditKeyboard = isPlaying || event.shiftKey\r\n        if (shouldEditKeyboard) {\r\n            let letter = key?.replace(\"Key\", \"\")\r\n            let note = instrument.getNoteFromCode(letter)\r\n            if (note !== null) this.handleClick(instrument.layout[note])\r\n            switch (key) {\r\n                case \"Space\": {\r\n                    this.togglePlay()\r\n                    if (!this.state.settings.syncTabs.value) break;\r\n                    this.broadcastChannel?.postMessage?.(\"stop\")\r\n                    break;\r\n                }\r\n                default: break;\r\n            }\r\n        } else {\r\n            switch (key) {\r\n                case \"KeyD\": this.selectColumn(this.state.song.selected + 1); break;\r\n                case \"KeyA\": this.selectColumn(this.state.song.selected - 1); break;\r\n                case \"Digit1\": this.handleTempoChanger(TempoChangers[0]); break;\r\n                case \"Digit2\": this.handleTempoChanger(TempoChangers[1]); break;\r\n                case \"Digit3\": this.handleTempoChanger(TempoChangers[2]); break;\r\n                case \"Digit4\": this.handleTempoChanger(TempoChangers[3]); break;\r\n                case \"Space\": {\r\n                    this.togglePlay()\r\n                    if (!this.state.settings.syncTabs.value) break;\r\n                    this.broadcastChannel?.postMessage?.(\"play\")\r\n                    break;\r\n                }\r\n                case \"ArrowUp\": {\r\n                    let nextLayer = layer - 1\r\n                    if (nextLayer > 0) this.changeLayer(nextLayer)\r\n                    break;\r\n                }\r\n                case \"ArrowDown\": {\r\n                    let nextLayer = layer + 1\r\n                    if (nextLayer < layers.length + 2) this.changeLayer(nextLayer)\r\n                    break;\r\n                }\r\n                case \"KeyQ\": this.removeColumns(1, this.state.song.selected); break;\r\n                case \"KeyE\": this.addColumns(1, this.state.song.selected); break;\r\n                default: break;\r\n            }\r\n        }\r\n\r\n    }\r\n    playSound = (instrument, index) => {\r\n        try {\r\n            let note = instrument.layout[index]\r\n            if (note === undefined) return\r\n            instrument.play(note.index, getPitchChanger(this.state.settings.pitch.value))\r\n        } catch (e) {\r\n\r\n        }\r\n    }\r\n    changePitch = (value) => {\r\n        const { settings } = this.state\r\n        settings.pitch = {...settings.pitch, value}\r\n        this.setState({\r\n            settings: settings\r\n        }, () => this.updateSettings())\r\n    }\r\n    handleClick = (note) => {\r\n        let column = this.state.song.columns[this.state.song.selected]\r\n        let index = column.notes.findIndex((n) => {\r\n            return note.index === n.index\r\n        })\r\n        let layerIndex = this.state.layer - 1\r\n        if (index < 0) { //if it doesn't exist, create a new one\r\n            let columnNote = new ColumnNote(note.index)\r\n            columnNote.layer = replaceAt(columnNote.layer, layerIndex, \"1\")\r\n            column.notes.push(columnNote)\r\n        } else { //if it exists, toggle the current layer and if it's 000 delete it\r\n            let currentNote = column.notes[index]\r\n            currentNote.layer = replaceAt(currentNote.layer, layerIndex, currentNote.layer[layerIndex] === \"0\" ? \"1\" : \"0\")\r\n            if (currentNote.layer === \"000\") column.notes.splice(index, 1)\r\n        }\r\n        this.setState({\r\n            song: this.state.song\r\n        })\r\n        this.handleAutoSave()\r\n        let instrument = this.state.instrument\r\n        if (this.state.layer > 1) {\r\n            instrument = this.state.layers[this.state.layer - 2]\r\n        }\r\n        this.playSound(instrument, note.index)\r\n    }\r\n    syncSongs = async () => {\r\n        let songs = await DB.getSongs()\r\n        if (!this.mounted) return\r\n        songs = songs.map(song => {\r\n            if (song.data.isComposedVersion) {\r\n                return ComposerSongDeSerialization(song)\r\n            }\r\n            return song\r\n        })\r\n        this.setState({\r\n            composedSongs: songs,\r\n            songs: songs\r\n        })\r\n    }\r\n    addSong = async (song) => {\r\n        if (await this.songExists(song.name)) {\r\n            return new LoggerEvent(\"Warning\", \"A song with this name already exists! \\n\" + song.name).trigger()\r\n        }\r\n        await DB.addSong(ComposerSongSerialization(song))\r\n        this.syncSongs()\r\n    }\r\n    updateSong = async (song) => {\r\n        if (song.name === \"Untitled\") {\r\n            let name = await this.askForSongName()\r\n            if (name === null || !this.mounted) return\r\n            song.name = name\r\n            this.changes = 0\r\n            return this.addSong(song)\r\n        }\r\n        return new Promise(async resolve => {\r\n            let settings = this.state.settings\r\n            if (await this.songExists(song.name)) {\r\n                song.instruments[0] = settings.instrument.value\r\n                song.instruments[1] = settings.layer2.value\r\n                song.instruments[2] = settings.layer3.value\r\n                await DB.updateSong({ name: song.name }, ComposerSongSerialization(song))\r\n                console.log(\"song saved:\", song.name)\r\n                this.changes = 0\r\n                this.syncSongs()\r\n            } else {\r\n                if (song.name.includes(\"- Composed\")) {\r\n                    let name = await this.askForSongName(\"Write composed song name, press cancel to ignore\")\r\n                    if (name === null) return resolve()\r\n                    song.name = name\r\n                    await DB.addSong(ComposerSongSerialization(song))\r\n                    this.syncSongs()\r\n                    return resolve()\r\n                }\r\n                console.log(\"song doesn't exist\")\r\n                song.name = \"Untitled\"\r\n                this.updateSong(song)\r\n            }\r\n            resolve()\r\n        })\r\n    }\r\n    askForSongName = (question) => {\r\n        return new Promise(async resolve => {\r\n            let promptString = question || \"Write song name, press cancel to ignore\"\r\n            while (true) {\r\n                let songName = await asyncPrompt(promptString)\r\n                if (songName === null) return resolve(null)\r\n                if (songName !== \"\") {\r\n                    if (await this.songExists(songName)) {\r\n                        promptString = \"This song already exists: \" + songName\r\n                    } else {\r\n                        return resolve(songName)\r\n                    }\r\n                } else {\r\n                    promptString = question || \"Write song name, press cancel to ignore\"\r\n                }\r\n            }\r\n        })\r\n\r\n    }\r\n    askForSongUpdate = () => {\r\n        return new Promise(async resolve => {\r\n            let result = await asyncConfirm(`You have unsaved changes to the song: \"${this.state.song.name}\" do you want to save now?`)\r\n            resolve(result)\r\n        })\r\n    }\r\n    songExists = async (name) => {\r\n        return await DB.existsSong({ name: name })\r\n    }\r\n    createNewSong = async () => {\r\n        if (this.state.song.name !== \"Untitled\" && this.changes > 0) {\r\n            let wantsToSave = await this.askForSongUpdate()\r\n            if (wantsToSave) {\r\n                await this.updateSong(this.state.song)\r\n            }\r\n        }\r\n        let name = await this.askForSongName(\"Write new song name, press cancel to ignore\")\r\n        if (name === null) return\r\n        let song = new ComposedSong(name)\r\n        this.changes = 0\r\n        if (!this.mounted) return\r\n        this.setState({\r\n            song: song\r\n        }, () => this.addSong(song))\r\n    }\r\n    removeSong = async (name) => {\r\n        let confirm = await asyncConfirm(\"Are you sure you want to delete the song: \" + name)\r\n        if (confirm) await DB.removeSong({ name: name })\r\n        this.syncSongs()\r\n    }\r\n\r\n    loadSong = async (song) => {\r\n        const state = this.state\r\n        song = JSON.parse(JSON.stringify(song)) //lose reference\r\n        if (!song.data.isComposedVersion) {\r\n            //if(song.bpm <= 220)  song.bpm *= 2\r\n            song = RecordingToComposed(song, 4)\r\n            song.name += \" - Composed\"\r\n        }\r\n        if (this.changes !== 0) {\r\n            let confirm = state.settings.autosave.value && state.song.name !== \"Untitled\"\r\n            if (!confirm && state.song.columns.length > 0) {\r\n                confirm = await asyncConfirm(`You have unsaved changes to the song: \"${state.song.name}\" do you want to save? UNSAVED CHANGES WILL BE LOST`)\r\n            }\r\n            if (confirm) await this.updateSong(state.song)\r\n        }\r\n        let settings = this.state.settings\r\n        settings.bpm = {...settings.bpm, value: song.bpm}\r\n        settings.pitch = {...settings.pitch, value: song.pitch}\r\n        if (!this.mounted) return\r\n        if (settings.instrument.value !== song.instruments[0]) {\r\n            this.loadInstrument(song.instruments[0], 1)\r\n            settings.instrument = {...settings.instrument, value: song.instruments[0]}\r\n        }\r\n        if (settings.layer2.value !== song.instruments[1]) {\r\n            this.loadInstrument(song.instruments[1], 2)\r\n            settings.layer2 = {...settings.layer2, value: song.instruments[1]}\r\n        }\r\n        if (settings.layer3.value !== song.instruments[2]) {\r\n            this.loadInstrument(song.instruments[2], 3)\r\n            settings.layer3 = {...settings.layer3, value: song.instruments[2]}\r\n        }\r\n        this.changes = 0\r\n        console.log(\"song loaded\")\r\n        this.setState({\r\n            song: song,\r\n            settings: settings,\r\n            toolsColumns: []\r\n        })\r\n    }\r\n\r\n    addColumns = (amount = 1, position = \"end\") => {\r\n        return new Promise(resolve => {\r\n            let columns = new Array(amount).fill().map(() => new Column())\r\n            let songColumns = this.state.song.columns\r\n            if (position === \"end\") {\r\n                songColumns.push(...columns)\r\n            } else {\r\n                songColumns.splice(position + 1, 0, ...columns)\r\n            }\r\n            if (amount === 1) this.selectColumn(this.state.song.selected + 1)\r\n            this.handleAutoSave()\r\n            this.setState({ song: this.state.song }, resolve)\r\n        })\r\n\r\n    }\r\n    removeColumns = (amount, position) => {\r\n        let song = this.state.song\r\n        if (song.columns.length < 16) return\r\n        let indexes = new Array(amount).fill().map((e, i) => position + i)\r\n        indexes.forEach(index => {\r\n            if (song.breakpoints.includes(index)) this.toggleBreakpoint(index)\r\n        })\r\n        song.columns.splice(position, amount)\r\n        if (song.columns.length <= song.selected) this.selectColumn(song.selected - 1)\r\n        this.handleAutoSave()\r\n        this.setState({ song: song })\r\n    }\r\n    //----------------------------------------------//\r\n\r\n    togglePlay = async (override) => {\r\n        return new Promise(resolve => {\r\n            let newState = typeof override === \"boolean\" ? override : !this.state.isPlaying\r\n            this.setState({\r\n                isPlaying: newState\r\n            }, async () => {\r\n                if (this.state.isPlaying) this.selectColumn(this.state.song.selected)\r\n                let pastError = 0\r\n                let previousTime = new Date().getTime()\r\n                while (this.state.isPlaying) {\r\n                    const { song, settings } = this.state\r\n                    let tempoChanger = TempoChangers[song.columns[song.selected].tempoChanger]\r\n                    let msPerBPM = Math.floor(60000 / settings.bpm.value * tempoChanger.changer) + pastError\r\n                    previousTime = new Date().getTime()\r\n                    await delayMs(msPerBPM)\r\n                    if (!this.state.isPlaying || !this.mounted) break\r\n                    this.handleTick()\r\n                    pastError = previousTime + msPerBPM - new Date().getTime()\r\n                }\r\n                resolve()\r\n            })\r\n        })\r\n    }\r\n\r\n\r\n    handleTick = () => {\r\n        let newIndex = this.state.song.selected + 1\r\n        if (this.state.isPlaying && newIndex > this.state.song.columns.length - 1) {\r\n            return this.togglePlay(false)\r\n        }\r\n        this.selectColumn(this.state.song.selected + 1)\r\n\r\n    }\r\n    toggleMenuVisible = () => {\r\n        this.setState({ menuOpen: !this.state.menuOpen })\r\n    }\r\n    toggleBreakpoint = (override) => {\r\n        let song = this.state.song\r\n        let index = typeof override === \"number\" ? override : song.selected\r\n        let indexOfBreakpoint = song.breakpoints.indexOf(index)\r\n        if (indexOfBreakpoint >= 0 && song.columns.length > index) {\r\n            song.breakpoints.splice(indexOfBreakpoint, 1)\r\n        } else if (song.columns.length > index) {\r\n            song.breakpoints.push(index)\r\n        }\r\n        this.validateBreakpoints()\r\n        this.setState({ song: song })\r\n    }\r\n    handleTempoChanger = (changer) => {\r\n        let song = this.state.song\r\n        song.columns[this.state.song.selected].tempoChanger = changer.id\r\n        this.handleAutoSave()\r\n        this.setState({ song: song })\r\n    }\r\n    changePage = async (page) => {\r\n        if (this.changes !== 0) {\r\n            if (this.state.settings.autosave.value) {\r\n                await this.updateSong(this.state.song)\r\n            } else {\r\n                let confirm = await asyncConfirm(`You have unsaved changes to the song: \"${this.state.song.name}\" do you want to save? UNSAVED CHANGES WILL BE LOST`,false)\r\n                if (confirm) {\r\n                    await this.updateSong(this.state.song)\r\n                }\r\n            }\r\n\r\n        }\r\n        this.props.changePage(page)\r\n    }\r\n    selectColumn = (index, ignoreAudio) => {\r\n        const state = this.state\r\n        let song = state.song\r\n        if (index < 0 || index > song.columns.length - 1) return\r\n        let currentColumn = state.song.columns[index]\r\n        song.selected = index\r\n        let toolsColumns = state.toolsColumns\r\n        if (state.toolsVisible && this.copiedColums.length === 0) {\r\n            toolsColumns.push(index)\r\n            let min = Math.min(...toolsColumns)\r\n            let max = Math.max(...toolsColumns)\r\n            toolsColumns = new Array(max - min + 1).fill().map((e, i) => min + i)\r\n        }\r\n        this.setState({\r\n            song: song,\r\n            toolsColumns: toolsColumns\r\n        })\r\n\r\n        if (ignoreAudio) return\r\n        currentColumn.notes.forEach(note => {\r\n            if (note.layer[0] === \"1\") this.playSound(state.instrument, note.index)\r\n            if (note.layer[1] === \"1\") this.playSound(state.layers[0], note.index)\r\n            if (note.layer[2] === \"1\") this.playSound(state.layers[1], note.index)\r\n        })\r\n    }\r\n    changeLayer = (layer) => {\r\n        this.setState({\r\n            layer: layer\r\n        })\r\n    }\r\n    //-----------------------TOOLS---------------------//\r\n    toggleTools = () => {\r\n        this.setState({\r\n            toolsVisible: !this.state.toolsVisible,\r\n            toolsColumns: this.state.toolsVisible ? [] : [this.state.song.selected]\r\n        })\r\n        this.copiedColums = []\r\n    }\r\n    copyColumns = (layer) => {\r\n        this.copiedColums = []\r\n        this.state.toolsColumns.forEach((index) => {\r\n            let column = this.state.song.columns[index]\r\n            if (column !== undefined) this.copiedColums.push(column)\r\n        })\r\n        this.copiedColums = JSON.parse(JSON.stringify(this.copiedColums)) // removing reference\r\n        if (layer !== 'all') {\r\n            this.copiedColums = this.copiedColums.map(column => {\r\n                column.notes = column.notes.filter(e => e.layer[layer - 1] === '1')\r\n                column.notes = column.notes.map(e => {\r\n                    e.layer = '000'\r\n                    e.layer = replaceAt(e.layer, layer - 1, '1')\r\n                    return e\r\n                })\r\n                return column\r\n            })\r\n        }\r\n        this.setState({ toolsColumns: [] })\r\n    }\r\n    pasteColumns = async (insert) => {\r\n        let song = this.state.song\r\n        let copiedColumns = JSON.parse(JSON.stringify(this.copiedColums))\r\n        if (!insert) {\r\n            song.columns.splice(song.selected, 0, ...copiedColumns)\r\n        } else {\r\n            copiedColumns.forEach((copiedColumn, i) => {\r\n                let column = song.columns[song.selected + i]\r\n                if (column !== undefined) {\r\n                    copiedColumn.notes.forEach(copiedNote => {\r\n                        let index = column.notes.findIndex(note => copiedNote.index === note.index)\r\n                        if (index < 0) {\r\n                            column.notes.push(copiedNote)\r\n                        } else {\r\n                            for (let j = 0; j < 3; j++) {\r\n                                if (copiedNote.layer[j] === '1') {\r\n                                    column.notes[index].layer = replaceAt(column.notes[index].layer, j, 1)\r\n                                }\r\n                            }\r\n                        }\r\n                    })\r\n                }\r\n            })\r\n        }\r\n        this.setState({ song: song })\r\n    }\r\n    eraseColumns = (layer) => {\r\n        let song = this.state.song\r\n        if (layer === 'all') {\r\n            this.state.toolsColumns.forEach(columnIndex => {\r\n                let column = song.columns[columnIndex]\r\n                if (column !== undefined) song.columns[columnIndex].notes = []\r\n            })\r\n        } else {\r\n            this.state.toolsColumns.forEach(columnIndex => {\r\n                let column = song.columns[columnIndex]\r\n                if (column !== undefined) {\r\n                    song.columns[columnIndex].notes.forEach(note => {\r\n                        note.layer = replaceAt(note.layer, layer - 1, '0')\r\n                    })\r\n                }\r\n            })\r\n        }\r\n\r\n        this.setState({ song: song })\r\n    }\r\n    validateBreakpoints = () => {\r\n        const breakpoints = this.state.song.breakpoints.filter(breakpoint => breakpoint < this.state.song.columns.length)\r\n        const song = this.state.song\r\n        song.breakpoints = breakpoints\r\n        this.setState({ song: song })\r\n    }\r\n    deleteColumns = async () => {\r\n        const song = this.state.song\r\n        song.columns = song.columns.filter((e, i) => !this.state.toolsColumns.includes(i))\r\n        if (song.selected > song.columns.length - 1) song.selected = song.columns.length - 1\r\n        if (song.selected <= 0) song.selected = 0\r\n        if (song.columns.length === 0) await this.addColumns(12, 0)\r\n        this.setState({\r\n            song: song,\r\n            toolsColumns: []\r\n        }, this.validateBreakpoints)\r\n    }\r\n    changeMidiVisibility = (visibility) => {\r\n        this.setState({ midiVisible: visibility })\r\n    }\r\n    render() {\r\n        const { state } = this\r\n        const { midiVisible, song } = state\r\n        //TODO export the menu outside this component so it doesnt get re rendered at every change\r\n        const songLength = calculateLength(song.columns, state.settings.bpm.value, song.selected)\r\n        const menuData = {\r\n            songs: state.songs,\r\n            currentSong: state.song,\r\n            settings: state.settings,\r\n            hasChanges: this.changes,\r\n            menuOpen: state.menuOpen,\r\n            isRecordingAudio: state.isRecordingAudio\r\n        }\r\n        const menuFunctions = {\r\n            loadSong: this.loadSong,\r\n            removeSong: this.removeSong,\r\n            createNewSong: this.createNewSong,\r\n            changePage: this.changePage,\r\n            updateSong: this.updateSong,\r\n            handleSettingChange: this.handleSettingChange,\r\n            toggleMenuVisible: this.toggleMenuVisible,\r\n            changeVolume: this.changeVolume,\r\n            changeMidiVisibility: this.changeMidiVisibility,\r\n            startRecordingAudio: this.startRecordingAudio\r\n        }\r\n        const keyboardFunctions = {\r\n            handleClick: this.handleClick,\r\n            handleTempoChanger: this.handleTempoChanger,\r\n            changeLayer: this.changeLayer\r\n        }\r\n        const keyboardData = {\r\n            keyboard: state.instrument,\r\n            currentColumn: state.song.columns[state.song.selected],\r\n            TempoChangers: TempoChangers,\r\n            layer: state.layer,\r\n            pitch: state.settings.pitch.value,\r\n            isPlaying: state.isPlaying,\r\n            noteNameType: state.settings.noteNameType.value,\r\n        }\r\n        const canvasFunctions = {\r\n            selectColumn: this.selectColumn,\r\n            toggleBreakpoint: this.toggleBreakpoint\r\n        }\r\n        const canvasData = {\r\n            columns: song.columns,\r\n            selected: song.selected,\r\n            settings: state.settings,\r\n            breakpoints: state.song.breakpoints,\r\n            toolsColumns: state.toolsColumns\r\n        }\r\n        const toolsData = {\r\n            visible: this.state.toolsVisible,\r\n            copiedColumns: this.copiedColums,\r\n            layer: this.state.layer\r\n        }\r\n        const toolsFunctions = {\r\n            toggleTools: this.toggleTools,\r\n            eraseColumns: this.eraseColumns,\r\n            deleteColumns: this.deleteColumns,\r\n            copyColumns: this.copyColumns,\r\n            pasteColumns: this.pasteColumns\r\n        }\r\n        const midiParserFunctions = {\r\n            loadSong: this.loadSong,\r\n            changeMidiVisibility: this.changeMidiVisibility,\r\n            changePitch: this.changePitch,\r\n        }\r\n        const midiParserData = {\r\n            instruments: [state.instrument, ...state.layers].map(layer => layer.instrumentName),\r\n            selectedColumn: song.selected,\r\n\r\n        }\r\n        return <div className=\"app bg-image\" style={{ backgroundImage: `url(${state.settings.backgroundImage.value})` }}>\r\n            {midiVisible && <MidiImport functions={midiParserFunctions} data={midiParserData} />}\r\n            <div className=\"hamburger\" onClick={this.toggleMenuVisible}>\r\n                <Memoized>\r\n                    <FaBars />\r\n                </Memoized>\r\n            </div>\r\n            <div className=\"right-panel-composer\">\r\n                <div className=\"column fill-x\">\r\n                    <div className=\"top-panel-composer\">\r\n                        <div className=\"buttons-composer-wrapper\">\r\n                            <div className=\"tool\" onPointerDown={() => this.selectColumn(song.selected + 1)}>\r\n                                <Memoized>\r\n                                    <FaChevronRight />\r\n\r\n                                </Memoized>\r\n                            </div>\r\n                            <div className=\"tool\" onClick={() => this.selectColumn(song.selected - 1)}>\r\n                                <Memoized>\r\n                                    <FaChevronLeft />\r\n                                </Memoized>\r\n                            </div>\r\n\r\n                            <div className=\"tool\" onClick={this.togglePlay}>\r\n                                <Memoized>\r\n                                    {this.state.isPlaying \r\n                                        ? <FaPause key='pause'/> \r\n                                        : <FaPlay key='play'/>\r\n                                    }\r\n                                </Memoized>\r\n                            </div>\r\n                        </div>\r\n                        <ComposerCanvas\r\n                            key={this.state.settings.columnsPerCanvas.value}\r\n                            functions={canvasFunctions}\r\n                            data={canvasData}\r\n                        />\r\n                        <div className=\"buttons-composer-wrapper-right\">\r\n\r\n                            <div className=\"tool\" onClick={() => this.addColumns(1, song.selected)}>\r\n                                <img src={addCell} className=\"tool-icon\" alt=\"Add a new cell\" />\r\n                            </div>\r\n                            <div className=\"tool\" onClick={() => this.removeColumns(1, song.selected)}>\r\n                                <img src={removeCell} className=\"tool-icon\" alt=\"Remove a cell\" />\r\n                            </div>\r\n                            <div className=\"tool\" onClick={() => this.addColumns(this.state.settings.beatMarks.value * 4, \"end\")}>\r\n                                <Memoized>\r\n                                    <FaPlus />\r\n                                </Memoized>\r\n                            </div>\r\n                            <div className=\"tool\" onClick={this.toggleTools}>\r\n                                <Memoized>\r\n                                    <FaTools />\r\n                                </Memoized>\r\n                            </div>\r\n\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <ComposerKeyboard\r\n                    functions={keyboardFunctions}\r\n                    data={keyboardData}\r\n                />\r\n            </div>\r\n            <Menu\r\n                data={menuData}\r\n                functions={menuFunctions}\r\n            />\r\n            <ComposerTools\r\n                data={toolsData}\r\n                functions={toolsFunctions}\r\n            />\r\n            <div className=\"song-info\">\r\n                <div>\r\n                    {song.name}\r\n                </div>\r\n                <div>\r\n                    {formatMillis(songLength.current)}\r\n                    /\r\n                    {formatMillis(songLength.total)}\r\n                </div>\r\n            </div>\r\n        </div>\r\n    }\r\n}\r\nfunction formatMillis(millis) {\r\n    let minutes = Math.floor(millis / 60000);\r\n    let seconds = ((millis % 60000) / 1000).toFixed(0);\r\n    return (\r\n        seconds === 60\r\n            ? (minutes + 1) + \":00\"\r\n            : minutes + \":\" + (seconds < 10 ? \"0\" : \"\") + seconds\r\n    )\r\n}\r\nfunction calculateLength(columns, bpm, end) {\r\n    const bpmPerMs = Math.floor(60000 / bpm)\r\n    let totalLength = 0\r\n    let currentLength = 0\r\n    let increment = 0\r\n    for(let i = 0; i< columns.length; i++){\r\n        increment = bpmPerMs * TempoChangers[columns[i].tempoChanger].changer\r\n        if(i < end) currentLength += increment\r\n        totalLength += increment\r\n    }\r\n    return {\r\n        total: totalLength,\r\n        current: currentLength\r\n    }\r\n}\r\n\r\nfunction replaceAt(string, index, replacement) {\r\n    if (index >= string.length) {\r\n        return string.valueOf();\r\n    }\r\n    return string.substring(0, index) + replacement + string.substring(index + 1);\r\n}\r\nexport default Composer\r\n\r\n","import { useState} from 'react'\r\nimport { FaHome, FaDiscord } from 'react-icons/fa';\r\n\r\nimport MenuItem from 'components/MenuItem'\r\nimport MenuPanel from 'components/MenuPanel'\r\n\r\n\r\nexport function SimpleMenu({functions, children, className}) {\r\n    const [open, setOpen] = useState(false)\r\n    const [selectedMenu, setSelectedMenu] = useState(\"Settings\")\r\n    const { changePage, toggleMenuVisible } = functions\r\n    // eslint-disable-next-line\r\n    const toggleMenu = (override) => {\r\n        if (typeof override !== \"boolean\") override = undefined\r\n        let newState = override !== undefined ? override : !open\r\n        setOpen(newState)\r\n        if (newState === false) toggleMenuVisible()\r\n    }\r\n    // eslint-disable-next-line\r\n    const selectSideMenu = (selection) => {\r\n        if (selection === selectedMenu && open) {\r\n            return setOpen(false)\r\n        }\r\n        setSelectedMenu(selection)\r\n        setOpen(true)\r\n    }\r\n\r\n\r\n    return <div className={\"menu-wrapper \" + (className ? className : '')} >\r\n        <div className=\"menu menu-visible\" style={{ justifyContent: 'flex-end' }}>\r\n\r\n            {children}\r\n\r\n            <MenuItem type='Discord'>\r\n                <a href='https://discord.gg/Arsf65YYHq' target='_blank' rel='noreferrer' >\r\n                    <FaDiscord className=\"icon\" />\r\n                </a>\r\n            </MenuItem>\r\n\r\n            <MenuItem type=\"Home\" action={() => changePage(\"home\")}>\r\n                <FaHome className=\"icon\" />\r\n            </MenuItem>\r\n\r\n        </div>\r\n        <div className={open ? \"side-menu menu-open\" : \"side-menu\"}>\r\n            <MenuPanel title=\"No selection\" visible={selectedMenu}>\r\n            </MenuPanel>\r\n        </div>\r\n    </div>\r\n}","import React, { Component } from 'react'\r\nimport { FaTrash, FaDownload} from 'react-icons/fa';\r\nimport { DB } from 'Database';\r\nimport { FileDownloader, LoggerEvent,prepareSongDownload } from \"lib/Utils\"\r\nimport { asyncConfirm } from \"components/AsyncPrompts\"\r\nimport { appName } from \"appConfig\"\r\nimport { SimpleMenu } from 'components/SimpleMenu'\r\nimport './ErrorPage.css'\r\n\r\nclass ErrorPage extends Component {\r\n    constructor(props) {\r\n        super(props)\r\n        this.state = {\r\n            songs: []\r\n        }\r\n    }\r\n    componentDidMount(){\r\n        this.syncSongs()\r\n    }\r\n    downloadAllSongs = () => {\r\n        let toDownload = []\r\n        const { songs } = this.state\r\n        songs.forEach(song => {\r\n            if (song._id) delete song._id\r\n            if(appName === \"Sky\"){\r\n                song = prepareSongDownload(song)\r\n            }\r\n            Array.isArray(song) ? toDownload.push(...song) : toDownload.push(song)\r\n        })\r\n        let fileDownloader = new FileDownloader()\r\n        let json = JSON.stringify(toDownload)\r\n        let date = new Date().toISOString().split('T')[0]\r\n        fileDownloader.download(json,`${appName}_Backup_${date}.json`)\r\n        new LoggerEvent(\"Success\", \"Song backup downloaded\").trigger()\r\n    }\r\n    syncSongs = async () => {\r\n        this.setState({\r\n            songs: await DB.getSongs()\r\n        })\r\n    }\r\n    deleteSong = async (name) => {\r\n        if (await asyncConfirm(\"Are you sure you want to delete the song: \" + name)) {\r\n            await DB.removeSong({ name: name })\r\n            this.syncSongs()\r\n        }\r\n\r\n    }\r\n    deleteAllSongs = async () =>{\r\n        if (await asyncConfirm(\"Are you sure you want to delete ALL SONGS?\")) {\r\n            await DB.removeSong({})\r\n            this.syncSongs()\r\n        }\r\n    }\r\n    resetSettings = () => {\r\n        localStorage.removeItem(appName+\"_Composer_Settings\")\r\n        localStorage.removeItem(appName+\"_Main_Settings\")\r\n        new LoggerEvent(\"Success\", \"Settings have been reset\").trigger()\r\n    }\r\n    downloadSong = (song) => {\r\n        if (song._id) delete song._id\r\n        let songName = song.name\r\n        if(appName === \"Sky\"){\r\n            song = prepareSongDownload(song)\r\n        }\r\n        if(!Array.isArray(song)) song = [song]\r\n        song.forEach(song1 => {\r\n            song1.data.appName = appName\r\n        })\r\n        let json = JSON.stringify(song)\r\n        let fileDownloader = new FileDownloader()\r\n        fileDownloader.download(json,`${songName}.${appName.toLowerCase()}sheet.json`)\r\n        new LoggerEvent(\"Success\", \"Song downloaded\").trigger()\r\n    }\r\n    render() {\r\n        return <div className=\"error-page app\">\r\n            <SimpleMenu functions={{changePage: this.props.changePage}}/>\r\n            <div className=\"error-text-wrapper\">\r\n                There seems to be an error. <br />\r\n                Here you can download or delete your songs,\r\n                try to find what song caused the error and remove it.\r\n            </div>\r\n            <div className=\"error-buttons-wrapper\">\r\n                <button className=\"genshin-button\" onClick={this.resetSettings}>\r\n                    Reset settings\r\n                </button>\r\n                <button className=\"genshin-button\" onClick={this.deleteAllSongs}>\r\n                    Delete all songs\r\n                </button>\r\n            </div>\r\n            <div className=\"error-songs-wrapper\">\r\n                {this.state.songs.map(song => \r\n                    <SongRow\r\n                        key={song?.name}\r\n                        data={song}\r\n                        functions={{\r\n                            deleteSong: this.deleteSong,\r\n                            downloadSong: this.downloadSong\r\n                        }}\r\n                    />\r\n                )}\r\n            </div>\r\n        </div>\r\n    }\r\n}\r\n\r\nfunction SongRow(props) {\r\n    let data = props.data\r\n    let deleteSong = props.functions.deleteSong\r\n    let downloadSong = props.functions.downloadSong\r\n    return <div className=\"song-row\">\r\n        <div className=\"song-name\">\r\n            {data.name}\r\n        </div>\r\n        <div className=\"song-buttons-wrapper\">\r\n            <button className=\"song-button\" onClick={() => downloadSong(data)}>\r\n                <FaDownload />\r\n\r\n            </button>\r\n            <button className=\"song-button\" onClick={() => deleteSong(data.name)}>\r\n                <FaTrash color=\"#ed4557\" />\r\n            </button>\r\n        </div>\r\n    </div>\r\n}\r\n\r\nexport default ErrorPage","import { SimpleMenu } from 'components/SimpleMenu'\r\nimport MenuItem from 'components/MenuItem'\r\nimport { FaGithub } from 'react-icons/fa'\r\nimport './Changelog.css'\r\n\r\nexport default function Changelogpage(props) {\r\n    return <div className='changelog-page'>\r\n        <div className='changelog-page-title'>\r\n            Changelog\r\n        </div>\r\n        <SimpleMenu functions={{changePage: props.changePage}}>\r\n            <MenuItem>\r\n                <a href='https://github.com/Specy/genshin-music' className='icon' target=\"_blank\" rel='noreferrer'>\r\n                    <FaGithub />\r\n                </a>\r\n            </MenuItem>\r\n        </SimpleMenu>\r\n        {changelogs.map(e => <ChangelogRow\r\n            data={e}\r\n            key={e.version}\r\n        />)}\r\n        <div className='changelog-ending'>\r\n\r\n        </div>\r\n    </div>\r\n}\r\n\r\nfunction ChangelogRow(props) {\r\n    const { version, title, changes, date } = props.data\r\n    return <div className='changelog-wrapper'>\r\n        <div className='changelog-title'>\r\n            <div className='clt-1'>\r\n                {version}\r\n            </div>\r\n            <div className='clt-2'>\r\n                {date}\r\n            </div>\r\n        </div>\r\n        <div className='changelog-list'>\r\n            <div className='cll-1'>\r\n                {title}\r\n            </div>\r\n            <ul>\r\n                {changes.map((e, i) =>\r\n                    <li key={i}>\r\n                        {e.split('$l').map((item, i, arr) => {\r\n                            if (i === 0) {\r\n                                return <div key={i}>{item}</div>\r\n                            }\r\n                            return <p key={i} className='cll-new-line'>\r\n                                {item}\r\n                            </p>\r\n                        })}\r\n                    </li>\r\n                )}\r\n            </ul>\r\n        </div>\r\n\r\n    </div>\r\n}\r\nconst changelogs = [\r\n    {\r\n        version: '2.2',\r\n        title: 'Sheet visualizer',\r\n        date: '2022 - 17/01',\r\n        changes: [\r\n            'Added sheet visualizer',\r\n            'Changed timeline behaviour when dragging the scroll bar',\r\n            'Improved performance by 2 times in some places',\r\n            `Changed import conversion algorithm for converting recorded to composed songs`,\r\n            'UI improvements and bug fixes'\r\n        ]\r\n    },\r\n    {\r\n        version: '2.1.1',\r\n        title: 'Zither and icons',\r\n        date: '2021 - 16/12',\r\n        changes: [\r\n            'Changed note icon and animation (Genshin)',\r\n            'Added Help page',\r\n            'Changed zither audio (Genshin)',\r\n            'UI improvements'\r\n        ]\r\n    },\r\n    {\r\n        version: '2.1',\r\n        title: 'Home menu and pages',\r\n        date: '2021 - 11/12',\r\n        changes: [\r\n            'Restructured code',\r\n            'Added opacity to some elements',\r\n            'Changed margins and padding of some elements',\r\n            'Added home page',\r\n            'Added Partners page',\r\n            'Added shortcuts for main page',\r\n            'Fixed loading bug in composer and main page',\r\n            'Added Donate page'\r\n        ]\r\n    },\r\n    {\r\n        version: '2.0',\r\n        title: 'Approaching circles',\r\n        date: '2021 - 28/11',\r\n        changes: [\r\n            `Added Approaching cirlces mode, a new way to learn a song, or a way to challange yourself.\r\n            You can find it in the main page, next to the practice button`,\r\n            `Rewrite of the main page to increase overall performance`,\r\n            `Added changelog page`,\r\n            `Added audio recording feature in main page and composer`,\r\n            `Added tabs autoplay (composer) on pc as a setting`,\r\n            `Added note animations when pressing the note`,\r\n            `Added possibility to change background image from URL`,\r\n            `Updated info page`,\r\n            `In the composer you can now press shift + note name to add a note`,\r\n            `In the composer you can press up/down keys to change layer`,\r\n            `While in the composer on PC, you can now add new notes by simply pressing the PC keyboard while in \"playing\" mode`\r\n        ]\r\n    }, {\r\n        version: '1.7',\r\n        title: 'Zither',\r\n        date: '2021 - 20/10',\r\n        changes: [\r\n            '(For genshin) Added Zither',\r\n            'Added back \"do re mi\" format'\r\n        ]\r\n    }, {\r\n        version: '1.6',\r\n        title: 'Performance tweaks',\r\n        date: '2021 - 17/10',\r\n        changes: [\r\n            'Performance of composer improved by 2x',\r\n            'Added note names for genshin (made it a setting)',\r\n            'Fixed instrument volume bug',\r\n            'Fixed keyboard layout issues',\r\n            'Fixed other small bugs'\r\n        ]\r\n    }, {\r\n        version: '1.5',\r\n        title: 'MIDI import',\r\n        date: '2021 - 14/10',\r\n        changes: [\r\n            `Added to both Sky and Genshin music nightly the MIDI import feature $l\r\n            - Music track selection (select or deselect which tracks to include) $l\r\n            - Instrument track selection (select what instrument to give to each track) $l\r\n            - Track info (get info on how successful your parsing was, accidentals and notes out of range) $l\r\n            - Change note offset (in case that the song is outside of the octaves available) \r\n            `\r\n        ]\r\n    }, {\r\n        version: '1.4',\r\n        title: 'Song library',\r\n        date: '2021 - 28/08',\r\n        changes: [\r\n            'Added song library integration, directly import songs from the app (700+ songs)',\r\n            'Bug fixes'\r\n        ]\r\n    }, {\r\n        version: '1.3',\r\n        title: 'New audio files',\r\n        date: '2021 - 25/08',\r\n        changes: [\r\n            'Changed audio files',\r\n            'Added ocarina',\r\n            'Removed support button in TWA',\r\n            'Bug fixes'\r\n        ]\r\n    }, {\r\n        version: '1.2',\r\n        title: 'Bug fixes and PWA',\r\n        date: '2021 - 18/08',\r\n        changes: [\r\n            \"(For sky) Fixed bug where sheets couldn't be imported in sky studio\",\r\n            'Changed app install to more modern approach with description and images'\r\n        ]\r\n    }, {\r\n        version: '1.1',\r\n        title: 'Sheets compatibility',\r\n        date: '2021 - 07/08',\r\n        changes: [\r\n            '(For sky) Added backwards compatibility for sheets, now sheets made in sky music nightly can be imported into sky music and sky studio (with some losses)',\r\n            'Bug fixes',\r\n            'General improvement in performance'\r\n        ]\r\n    }, {\r\n        version: '1.0',\r\n        title: 'Release',\r\n        date: '2021 - 22/05',\r\n        changes: [\r\n            '3 Instruments composition',\r\n            'Better performance than previous version',\r\n            'Better practice tool',\r\n            'Better interface',\r\n            'Breakpoints for the composer',\r\n            'New features for both composer and main page',\r\n            'Feature rich customisability to make learning and composition easier'\r\n        ]\r\n    }\r\n]\r\n","export default __webpack_public_path__ + \"static/media/windsong-db.e533a22d.jpg\";","import './Partners.css'\r\nimport { SimpleMenu } from 'components/SimpleMenu'\r\nimport WindsongDBImg from 'assets/images/partners/windsong-db.jpg'\r\n\r\nexport default function Partners(props) {\r\n    return <div className='partners-page'>\r\n        <SimpleMenu functions={{ changePage: props.changePage }} />\r\n        <div className='partner-wrapper'>\r\n            <Partner\r\n                name='Specy'\r\n                description='The youtube channel that collects videos created by users of this app'\r\n            >\r\n                <Iframe\r\n                    src='https://www.youtube.com/embed/Sh7kqYVMjwM'\r\n                    title=\"Specy\"\r\n                />\r\n            </Partner>\r\n            <Partner\r\n                name='ChaconneScott_ACG'\r\n                description='YouTube pianist and arranger, features Genshin Impact OST'\r\n            >\r\n                <Iframe\r\n                    src='https://www.youtube.com/embed/ltE8zfGfUVo'\r\n                    title=\"ChaconneScott_ACG\"\r\n                />\r\n            </Partner>\r\n            <Partner\r\n                name='uma✿'\r\n                description={`Arranges music, primarily from anime and games for Sky and Genshin.`}\r\n            >\r\n                <Iframe\r\n                    src='https://www.youtube.com/embed/7aIkAGvp9Y0'\r\n                    title=\"uma\"\r\n                />\r\n            </Partner>\r\n            <Partner\r\n                name='Windsong DB'\r\n                description='A Genshin Impact Database for Instrument Gadget Keymaps'\r\n            >\r\n                <PartnerImg \r\n                    img={WindsongDBImg}\r\n                    to='https://genshin-lyre.notion.site/genshin-lyre/Windsong-DB-8012b5f6939b486d857552c7b60e917f'\r\n                    alt='Windsong DB'\r\n                />\r\n\r\n            </Partner>\r\n        </div>\r\n\r\n    </div>\r\n}\r\n\r\nfunction PartnerImg(props){\r\n    return <a \r\n        href={props.to}\r\n        style={{width: '18.8rem', height: '10.5rem', overflow: 'hidden', borderRadius: '0.3rem'}}\r\n        target='_blank'\r\n        rel='noreferrer'\r\n    >\r\n        <img \r\n            src={props.img} \r\n            style={{width: '100%', objectFit: 'cover'}}\r\n            alt={props.alt}\r\n        />\r\n    </a>\r\n}\r\nfunction Iframe(props) {\r\n    return <iframe\r\n        src={props.src}\r\n        title={props.src}\r\n        frameBorder=\"0\"\r\n        allow=\"autoplay; picture-in-picture\"\r\n        allowFullScreen\r\n    >\r\n    </iframe>\r\n}\r\nfunction Partner(props) {\r\n    return <div className='partner'>\r\n        <div className='partner-title'>\r\n            {props.name}\r\n        </div>\r\n        <div className='partner-description'>\r\n            {props.description}\r\n        </div>\r\n        {props.children}\r\n    </div>\r\n}\r\n","import './Home.css'\r\nimport { FaCompactDisc, FaTimes } from 'react-icons/fa'\r\nimport { BsMusicPlayerFill } from 'react-icons/bs'\r\nimport { appName, isTwa } from 'appConfig'\r\n\r\nexport default function Home(props) {\r\n    const to = props.changePage\r\n    const { data, askForStorage, hasVisited } = props\r\n    const homeClass = data.isInPosition ? \"home\" : \"home home-visible\"\r\n    const breakpoint = window.innerWidth > 900\r\n    return <div className={homeClass}>\r\n        <FaTimes className='close-home' onClick={() => props.toggleHome(false)} />\r\n        {(breakpoint || !hasVisited) && <div className='home-top'>\r\n            <div className='home-title'>\r\n                {appName} Music Nightly\r\n            </div>\r\n            <div className='home-top-text'>\r\n                An app where you can create, practice and play songs for {appName}\r\n            </div>\r\n        </div>  \r\n        }\r\n\r\n        {!hasVisited && <div className='home-welcome'>\r\n            <div>\r\n                {!isTwa() && <div className='home-spacing'>\r\n                    To have the webapp fullscreen and better view, please add the website to the home screen\r\n                </div>}\r\n                <div  className='home-spacing'>\r\n                    <div className=\"red-text\">WARNING</div>:\r\n                    Clearing your browser cache / storage might delete your songs, make sure you make backups\r\n                </div>\r\n                {data.hasPersistentStorage ?\r\n                    <div>\r\n                        <div className=\"red-text\">WARNING</div>: Click the button below to make sure that your browser won't delete your songs if you\r\n                        lack storage\r\n                    </div>\r\n                    : null\r\n                }\r\n            </div>\r\n            <div style={{display:'flex', justifyContent:'flex-end'}}>\r\n                <button className=\"home-accept-storage\" onClick={askForStorage}>\r\n                    Confirm\r\n                </button>\r\n            </div>\r\n\r\n        </div>}\r\n        <div className='home-content'>\r\n            <MainContentelement\r\n                icon={<FaCompactDisc />}\r\n                title='Composer'\r\n                background={`./manifestData/composer.png`}\r\n                onClick={() => to(\"Composer\")}\r\n            >\r\n                Create or edit songs with a fully fledged music composer. Also with MIDI.\r\n            </MainContentelement>\r\n            <MainContentelement\r\n                icon={<BsMusicPlayerFill />}\r\n                title='Player'\r\n                background={`./manifestData/main.png`}\r\n                onClick={() => to(\"\")}\r\n            >\r\n                Play, download, record and import songs. Learn a song with approaching circle\r\n                mode and practice mode.\r\n            </MainContentelement>\r\n        </div>\r\n        <Separator> Other pages </Separator>\r\n        <div className='page-redirect-wrapper'>\r\n            <PageRedirect onClick={() => to(\"Changelog\")}>\r\n                Changelog\r\n            </PageRedirect>\r\n            {!isTwa() &&\r\n                <PageRedirect onClick={() => to(\"Donate\")}>\r\n                    Donate\r\n                </PageRedirect>\r\n            }\r\n            <PageRedirect onClick={() => to(\"Partners\")}>\r\n                Partners\r\n            </PageRedirect>\r\n            <PageRedirect onClick={() => to(\"Help\")}>\r\n                Help\r\n            </PageRedirect>\r\n            <PageRedirect onClick={() => to(\"SheetVisualizer\")}>\r\n                Sheet visualizer\r\n            </PageRedirect>\r\n        </div>\r\n        <div className='home-dont-show-again' onClick={() => props.setDontShowHome(!data.canShow)}>\r\n            <input type='checkbox' checked={!data.canShow} readOnly />\r\n            Hide on open\r\n        </div>\r\n        <div className='home-bottom'> \r\n            <div>\r\n                © All rights reserved by {appName === 'Genshin' ? 'miHoYo' : 'TGC'}. Other properties belong to their respective owners. \r\n            </div>\r\n        </div>\r\n\r\n    </div>\r\n}\r\n\r\n// © 2021 {appName} Music. All rights reserved.   <br />\r\nfunction PageRedirect(props) {\r\n    return <button onClick={props.onClick}>\r\n        {props.children}\r\n    </button>\r\n}\r\n\r\nfunction MainContentelement(props) {\r\n    return <div className='home-content-element' onClick={props.onClick}>\r\n        <div className='home-content-background' style={{ backgroundImage: `url(${props.background})` }}>\r\n        </div>\r\n        <div className='home-content-main'>\r\n            <div className='home-content-title'>\r\n                {props.icon} {props.title}\r\n            </div>\r\n            <div className='home-content-text'>\r\n                {props.children}\r\n            </div>\r\n            <div className='home-content-open'>\r\n                <button>\r\n                    OPEN\r\n                </button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n}\r\n\r\nfunction Separator(props) {\r\n    return <div className='home-separator'>\r\n        {props.children}\r\n    </div>\r\n}","import { HelpTab } from \"components/HelpTab\"\r\nimport { SimpleMenu } from \"components/SimpleMenu\"\r\nimport './Help.css'\r\n\r\nexport default function Help(props){\r\n    return <div className=\"help-page\">\r\n        <SimpleMenu functions={{changePage: props.changePage}}/>\r\n        <div className=\"help-content\">\r\n            <div style={{fontSize: '2rem', margin: '1rem 0'}}>\r\n                Info about the app\r\n            </div>\r\n            <div style={{marginLeft: '1rem'}}>\r\n                In this page you will find an explaination for what all the buttons in the app do and\r\n                how to use them.\r\n                <br/><br/>\r\n                If you Have issues, bugs, or suggestions, please join our \r\n                <a href=\"https://discord.gg/Arsf65YYHq\" style={{color: 'var(--note-text)'}}>\r\n                <>&nbsp;</> Discord server\r\n                </a>\r\n                . <br/>\r\n            </div>\r\n            <HelpTab />\r\n        </div>\r\n    </div>\r\n}","import './SheetVisualizer.css'\r\nimport { useEffect, useState } from 'react'\r\nimport { SimpleMenu } from 'components/SimpleMenu'\r\nimport { DB } from 'Database'\r\nimport { appName } from 'appConfig'\r\nimport { ComposerToRecording } from 'lib/Utils'\r\n\r\nexport default function SheetVisualizer(props) {\r\n    const [songs, setSongs] = useState([])\r\n    const [sheet, setSheet] = useState([])\r\n    const [framesPerRow, setFramesPerRow] = useState(7)\r\n    const [currentSong, setCurrentSong] = useState({})\r\n    const [selectedSongType, setSelectedSongType] = useState('recorded')\r\n\r\n    function setFrames(amount) {\r\n        const newAmount = framesPerRow + amount\r\n        const frame = document.querySelector('.frame-outer')\r\n        if (!frame || newAmount < 1) return\r\n        const width = frame.getBoundingClientRect().width\r\n        if (width < 50 && amount === 1) return\r\n        setFramesPerRow(newAmount)\r\n    }\r\n\r\n    useEffect(() => {\r\n        async function load() {\r\n            setSongs(await DB.getSongs())\r\n        }\r\n        load()\r\n    }, [])\r\n\r\n    function handleClick(song) {\r\n        setCurrentSong(song)\r\n        let lostReference = JSON.parse(JSON.stringify(song))\r\n        if (lostReference.data?.isComposedVersion) {\r\n            lostReference = ComposerToRecording(lostReference)\r\n        }\r\n        let notes = lostReference.notes\r\n        let chunks = []\r\n        let previousChunkDelay = 0\r\n        for (let i = 0; notes.length > 0; i++) {\r\n            let chunk = {\r\n                notes: [notes.shift()],\r\n                delay: 0\r\n            }\r\n            let startTime = chunk.notes.length > 0 ? chunk.notes[0][1] : 0\r\n            for (let j = 0; j < notes.length && j < 20; j++) {\r\n                let difference = notes[j][1] - chunk.notes[0][1] - 50 //TODO add threshold here\r\n                if (difference < 0) {\r\n                    chunk.notes.push(notes.shift())\r\n                    j--\r\n                }\r\n            }\r\n            chunk.delay = previousChunkDelay\r\n            previousChunkDelay = notes.length > 0 ? notes[0][1] - startTime : 0\r\n            chunks.push(chunk)\r\n        }\r\n        setSheet(chunks)\r\n    }\r\n    return <div className='displayer-page'>\r\n        <div style={{ display: 'flex', alignItems: 'center', flexDirection: 'column' }}>\r\n            <SimpleMenu functions={{ changePage: props.changePage }} className='noprint' />\r\n            <div>\r\n                <div className='displayer-songs-wrapper noprint' style={{ marginTop: '0' }}>\r\n                    <div className=\"tab-selector-wrapper\">\r\n                        <button\r\n                            className={selectedSongType === \"recorded\" ? \"tab-selector tab-selected\" : \"tab-selector\"}\r\n                            onClick={() => setSelectedSongType(\"recorded\")}\r\n                        >\r\n                            Recorded\r\n                        </button>\r\n                        <button\r\n                            className={selectedSongType === \"composed\" ? \"tab-selector tab-selected\" : \"tab-selector\"}\r\n                            onClick={() => setSelectedSongType(\"composed\")}\r\n                        >\r\n                            Composed\r\n                        </button>\r\n                    </div>\r\n                    <div className=\"songs-wrapper\">\r\n                        {songs.filter((song) => selectedSongType === 'composed' ? song.data?.isComposedVersion : !song.data?.isComposedVersion\r\n                        ).map((song) =>\r\n                            <SongRow\r\n                                key={song?.name}\r\n                                current={song === currentSong}\r\n                                data={song}\r\n                                functions={{\r\n                                    click: handleClick\r\n                                }}\r\n                            />\r\n                        )}\r\n\r\n                    </div>\r\n                </div>\r\n                <div className='displayer-buttons-wrapper noprint'>\r\n                    <button onClick={() => window.print()} className='genshin-button'>\r\n                        Print as PDF\r\n                    </button>\r\n                    <div style={{ display: 'flex', alignItems: 'center' }}>\r\n                        Per row: {framesPerRow}\r\n                        <button className='displayer-plus-minus'\r\n                            onClick={() => setFrames(-1)}>\r\n                            -\r\n                        </button>\r\n                        <button className='displayer-plus-minus'\r\n                            onClick={() => setFrames(1)}>\r\n                            +\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <h1 className='onprint'>\r\n                {currentSong?.name}\r\n            </h1>\r\n            <div style={{ color: 'var(--whitish)' }} className='noprint'>\r\n                <h2>{currentSong.name || 'No song selected'}</h2>\r\n                <div style={{ color: 'var(--hint-main)' }}>\r\n                    Remember that you can learn a song with the interactive\r\n                    practice tool in the main page\r\n                </div>\r\n            </div>\r\n            <div\r\n                className='displayer-frame-wrapper'\r\n                style={{ gridTemplateColumns: `repeat(${framesPerRow},1fr)` }}\r\n            >\r\n\r\n                {sheet.map((frame, i) =>\r\n                    <SheetFrame\r\n\r\n                        key={i}\r\n                        framesPerRow={framesPerRow}\r\n                        frame={frame}\r\n                        rows={3}\r\n                    />\r\n                )}\r\n            </div>\r\n        </div>\r\n\r\n    </div>\r\n}\r\n\r\nfunction SheetFrame(props) {\r\n    const { frame, rows } = props\r\n    const columnsPerRow = appName === 'Genshin' ? 7 : 5\r\n    const notes = new Array(columnsPerRow * rows).fill(0)\r\n    frame.notes.forEach(note => {\r\n        notes[note[0]] = 1\r\n    })\r\n    return <div className='frame-outer'>\r\n        <div className='displayer-frame' style={{ gridTemplateColumns: `repeat(${columnsPerRow},1fr)` }}>\r\n            {notes.map((exists, i) => {\r\n                return <div className={exists ? 'frame-note-s' : 'frame-note-ns'} key={i}>\r\n\r\n                </div>\r\n            })}\r\n        </div>\r\n    </div>\r\n}\r\n\r\n\r\nfunction SongRow(props) {\r\n    const { data, current } = props\r\n    const selectedStyle = current ? { backgroundColor: 'rgb(124, 116, 106)' } : {}\r\n    return <div\r\n        className=\"song-row\"\r\n        style={selectedStyle}\r\n        onClick={() => props.functions.click(data)}>\r\n        <div className=\"song-name\">\r\n            {data.name}\r\n        </div>\r\n    </div>\r\n}","// This optional code is used to register a service worker.\r\n// register() is not called by default.\r\n\r\n// This lets the app load faster on subsequent visits in production, and gives\r\n// it offline capabilities. However, it also means that developers (and users)\r\n// will only see deployed updates on subsequent visits to a page, after all the\r\n// existing tabs open on the page have been closed, since previously cached\r\n// resources are updated in the background.\r\n\r\n// To learn more about the benefits of this model and instructions on how to\r\n// opt-in, read https://cra.link/PWA\r\n\r\nconst isLocalhost = Boolean(\r\n  window.location.hostname === 'localhost' ||\r\n    // [::1] is the IPv6 localhost address.\r\n    window.location.hostname === '[::1]' ||\r\n    // 127.0.0.0/8 are considered localhost for IPv4.\r\n    window.location.hostname.match(/^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/)\r\n);\r\n\r\nexport function register(config) {\r\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\r\n    // The URL constructor is available in all browsers that support SW.\r\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\r\n    if (publicUrl.origin !== window.location.origin) {\r\n      // Our service worker won't work if PUBLIC_URL is on a different origin\r\n      // from what our page is served on. This might happen if a CDN is used to\r\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\r\n      return;\r\n    }\r\n\r\n    window.addEventListener('load', () => {\r\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\r\n      if (isLocalhost) {\r\n        // This is running on localhost. Let's check if a service worker still exists or not.\r\n        checkValidServiceWorker(swUrl, config);\r\n\r\n        // Add some additional logging to localhost, pointing developers to the\r\n        // service worker/PWA documentation.\r\n        navigator.serviceWorker.ready.then(() => {\r\n          console.log(\r\n            'This web app is being served cache-first by a service ' +\r\n              'worker. To learn more, visit https://cra.link/PWA'\r\n          );\r\n        });\r\n      } else {\r\n        // Is not localhost. Just register service worker\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction registerValidSW(swUrl, config) {\r\n  navigator.serviceWorker\r\n    .register(swUrl)\r\n    .then((registration) => {\r\n      registration.onupdatefound = () => {\r\n        const installingWorker = registration.installing;\r\n        if (installingWorker == null) {\r\n          return;\r\n        }\r\n        installingWorker.onstatechange = () => {\r\n          if (installingWorker.state === 'installed') {\r\n            if (navigator.serviceWorker.controller) {\r\n              // At this point, the updated precached content has been fetched,\r\n              // but the previous service worker will still serve the older\r\n              // content until all client tabs are closed.\r\n              console.log(\r\n                'New content is available and will be used when all ' +\r\n                  'tabs for this page are closed. See https://cra.link/PWA.'\r\n              );\r\n\r\n              // Execute callback\r\n              if (config && config.onUpdate) {\r\n                config.onUpdate(registration);\r\n              }\r\n            } else {\r\n              // At this point, everything has been precached.\r\n              // It's the perfect time to display a\r\n              // \"Content is cached for offline use.\" message.\r\n              console.log('Content is cached for offline use.');\r\n\r\n              // Execute callback\r\n              if (config && config.onSuccess) {\r\n                config.onSuccess(registration);\r\n              }\r\n            }\r\n          }\r\n        };\r\n      };\r\n    })\r\n    .catch((error) => {\r\n      console.error('Error during service worker registration:', error);\r\n    });\r\n}\r\n\r\nfunction checkValidServiceWorker(swUrl, config) {\r\n  // Check if the service worker can be found. If it can't reload the page.\r\n  fetch(swUrl, {\r\n    headers: { 'Service-Worker': 'script' },\r\n  })\r\n    .then((response) => {\r\n      // Ensure service worker exists, and that we really are getting a JS file.\r\n      const contentType = response.headers.get('content-type');\r\n      if (\r\n        response.status === 404 ||\r\n        (contentType != null && contentType.indexOf('javascript') === -1)\r\n      ) {\r\n        // No service worker found. Probably a different app. Reload the page.\r\n        navigator.serviceWorker.ready.then((registration) => {\r\n          registration.unregister().then(() => {\r\n            window.location.reload();\r\n          });\r\n        });\r\n      } else {\r\n        // Service worker found. Proceed as normal.\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    })\r\n    .catch(() => {\r\n      console.log('No internet connection found. App is running in offline mode.');\r\n    });\r\n}\r\n\r\nexport function unregister() {\r\n  if ('serviceWorker' in navigator) {\r\n    navigator.serviceWorker.ready\r\n      .then((registration) => {\r\n        registration.unregister();\r\n      })\r\n      .catch((error) => {\r\n        console.error(error.message);\r\n      });\r\n  }\r\n}\r\n","export default function FloatingMessage(props){\r\n    const { title, text, visible, onClick} = props\r\n\tlet classes = visible ? \"floating-message floating-message-visible\" : \"floating-message\"\r\n    return <div className={classes} onClick={onClick}>\r\n    <div className=\"floating-message-title\">\r\n        {title}\r\n    </div>\r\n    <div className=\"floating-message-text\">\r\n        {text}\r\n    </div>\r\n</div>\r\n}","export default __webpack_public_path__ + \"static/media/paypalme.45abe55e.png\";","export default __webpack_public_path__ + \"static/media/buymeacoffee.b124acdd.svg\";","import './Donate.css'\r\nimport paypalImg from 'assets/images/paypalme.png'\r\nimport buyMeACoffeeImg from 'assets/images/buymeacoffee.svg'\r\nimport kofiImg from 'assets/images/kofi.png'\r\nimport { SimpleMenu } from 'components/SimpleMenu'\r\nexport default function Donate(props) {\r\n    return <div className='donate-page'>\r\n        <SimpleMenu functions={{changePage: props.changePage}}/>\r\n        <div className=\"donate-text\">\r\n            Each App I make takes months of learning and development. Added to that\r\n            are also the costs of hosting. With a higher budget I can afford to not\r\n            worry so much about how much I spend on the server, giving you the best\r\n            possible experience.<br />\r\n            I care about giving users all features without\r\n            having to pay for it, neither having intrusive ads which can be annoying.\r\n            For this same reason, there is no source of income except donations.\r\n            <br /><br />\r\n            I would be really thankful if you could consider donating in order to fund\r\n            development and costs.\r\n        </div>\r\n        <div className=\"donation-wrapper\">\r\n            <a href=\"https://paypal.me/specyDev\" target=\"_blank\" className=\"paypal\" rel=\"noreferrer\">\r\n                <img src={paypalImg} alt=\"paypalme\" style={{ height: \"4rem\" }} />\r\n            </a>\r\n            <a href=\"https://ko-fi.com/specy\" target=\"_blank\" className=\"kofi\" rel=\"noreferrer\">\r\n                <img src={kofiImg} alt=\"kofi\" style={{ height: \"3rem\" }} />\r\n            </a>\r\n            <a href=\"https://www.buymeacoffee.com/specy\" target=\"_blank\" rel=\"noreferrer\">\r\n                <img src={buyMeACoffeeImg} alt=\"buymeacoffee\" style={{ height: \"4rem\" }} />\r\n            </a>\r\n        </div>\r\n    </div>\r\n}","export default \"data:image/png;base64,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\"","export default __webpack_public_path__ + \"static/media/rotate.e7c0f107.svg\";","import React, { Component } from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport App from 'pages/Main';\r\nimport Composer from \"pages/Composer\"\r\nimport ErrorPage from \"pages/ErrorPage\"\r\nimport Changelogpage from 'pages/Changelog'\r\nimport Partners from 'pages/Partners';\r\nimport Home from 'pages/Home';\r\nimport Help from 'pages/Help';\r\nimport SheetVisualizer from 'pages/SheetVisualizer';\r\nimport * as serviceWorkerRegistration from './serviceWorkerRegistration';\r\nimport { HashRouter, Route, Redirect } from \"react-router-dom\";\r\nimport { LoggerEvent, delayMs } from \"lib/Utils\"\r\nimport { appName, appVersion, pages, isTwa, updateMessage } from \"appConfig\"\r\nimport FloatingMessage from 'components/FloatingMessage'\r\nimport Donate from 'pages/Donate';\r\nimport rotateImg from \"assets/icons/rotate.svg\"\r\n\r\nclass Index extends Component {\r\n\tconstructor(props) {\r\n\t\tsuper(props)\r\n\t\tlet path = window.location.href.split(\"/\")\r\n\t\tpath = path.length === 0 ? \"\" : path = path[path.length - 1]\r\n\t\tif (!pages.includes(path)) path = \"\"\r\n\t\tconst hasVisited = localStorage.getItem(appName + \"_Visited\")\r\n\t\tlet canShowHome = localStorage.getItem(appName + \"_ShowHome\")\r\n\t\tcanShowHome = canShowHome === null ? 'true' : canShowHome\r\n\t\tthis.state = {\r\n\t\t\tfloatingMessage: {\r\n\t\t\t\ttimestamp: 0,\r\n\t\t\t\tvisible: false,\r\n\t\t\t\ttext: \"Text\",\r\n\t\t\t\ttitle: \"Title\"\r\n\t\t\t},\r\n\t\t\thomeData: {\r\n\t\t\t\tcanShow: canShowHome === 'true',\r\n\t\t\t\tvisible: canShowHome === 'true',\r\n\t\t\t\tisInPosition: false,\r\n\t\t\t\thasPersistentStorage: Boolean(navigator.storage && navigator.storage.persist)\r\n\t\t\t},\r\n\t\t\tselectedPage: path,\r\n\t\t\thasVisited: hasVisited === 'true'\r\n\t\t}\r\n\t\tthis.updateChecked = false\r\n\t}\r\n\tcomponentDidMount() {\r\n\t\twindow.addEventListener('logEvent', this.logEvent);\r\n\t\tthis.checkUpdate()\r\n\t}\r\n\tchangePage = (page) => {\r\n\t\tif (page === 'home') return this.toggleHome(true)\r\n\t\tif (this.state.homeData.visible) this.toggleHome(false)\r\n\t\tthis.setState({\r\n\t\t\tselectedPage: page,\r\n\t\t\thomeVisible: false\r\n\t\t})\r\n\t}\r\n\ttoggleHome = (override = false) => {\r\n\t\t//TODO please refactor this\r\n\t\tconst lastState = this.state.homeData\r\n\t\tif (override) { //if its to be shown then just show it\r\n\t\t\treturn this.setState({\r\n\t\t\t\thomeData: { ...lastState, visible: true, isInPosition: false }\r\n\t\t\t})\r\n\t\t}\r\n\t\tthis.setState({ //if it needs to be hidden, first trigger the animation\r\n\t\t\thomeData: { ...lastState, isInPosition: true }\r\n\t\t}, () => {\r\n\t\t\tsetTimeout(() => { //then demount it\r\n\t\t\t\tthis.setState({\r\n\t\t\t\t\thomeData: { ...lastState, visible: false }\r\n\t\t\t\t})\r\n\t\t\t}, 150)\r\n\t\t})\r\n\t}\r\n\tsetDontShowHome = (override = false) => {\r\n\t\tlocalStorage.setItem(appName + \"_ShowHome\", override)\r\n\t\tconst lastState = this.state.homeData\r\n\t\tthis.setState({\r\n\t\t\thomeData: { ...lastState, canShow: override }\r\n\t\t})\r\n\t}\r\n\tcomponentDidCatch() {\r\n\t\tthis.setState({\r\n\t\t\tselectedPage: \"ErrorPage\"\r\n\t\t})\r\n\t}\r\n\tcomponentWillUnmount() {\r\n\t\twindow.removeEventListener('logEvent', this.logEvent);\r\n\t}\r\n\taskForStorage = async () => {\r\n\t\ttry {\r\n\t\t\tif (navigator.storage && navigator.storage.persist) {\r\n\t\t\t\tlet result = await navigator.storage.persist()\r\n\t\t\t\tif (result) {\r\n\t\t\t\t\tnew LoggerEvent(\"Success\", \"Storage permission allowed\").trigger()\r\n\t\t\t\t} else {\r\n\t\t\t\t\t//new LoggerEvent(\"Warning\", \"Storage permission refused, will try next time\", 6000).trigger()\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} catch (e) {\r\n\t\t\tconsole.log(e)\r\n\t\t\tnew LoggerEvent(\"Error\", \"There was an error with setting up persistent storage\").trigger()\r\n\t\t}\r\n\t\tthis.closeWelcomeScreen()\r\n\t}\r\n\tcloseWelcomeScreen = () => {\r\n\t\tlocalStorage.setItem(appName + \"_Visited\", true)\r\n\t\tthis.setState({\r\n\t\t\thasVisited: true\r\n\t\t})\r\n\t}\r\n\thideMessage = () => {\r\n\t\tlet state = this.state\r\n\t\tstate.floatingMessage.visible = false\r\n\t\tthis.setState({\r\n\t\t\tfloatingMessage: state.floatingMessage\r\n\t\t})\r\n\t}\r\n\tcheckUpdate = async () => {\r\n\t\tawait delayMs(1000)\r\n\t\tif (this.updateChecked) return\t\r\n\t\tlet storedVersion = localStorage.getItem(appName + \"_Version\")\r\n\t\tif (!this.state.hasVisited) {\r\n\t\t\treturn localStorage.setItem(appName + \"_Version\", appVersion)\r\n\t\t}\r\n\r\n\t\tif (appVersion !== storedVersion) {\r\n\t\t\tnew LoggerEvent(\"Update V\" + appVersion, updateMessage, 6000).trigger()\r\n\t\t\tlocalStorage.setItem(appName + \"_Version\", appVersion)\r\n\t\t}\r\n\t\tthis.updateChecked = true\r\n\t\tif (!this.state.hasVisited) return\r\n\t\tif (navigator.storage && navigator.storage.persist) {\r\n\t\t\tlet isPersisted = await navigator.storage.persisted()\r\n\t\t\tif (!isPersisted) isPersisted = await navigator.storage.persist()\r\n\t\t\tconsole.log(isPersisted ? \"Storage Persisted\" : \"Storage Not persisted\")\r\n\t\t}\r\n\t}\r\n\r\n\tlogEvent = (error) => {\r\n\t\terror = error.detail\r\n\t\terror.timestamp = new Date().getTime()\r\n\t\tif (typeof error !== \"object\") return\r\n\t\tthis.setState({\r\n\t\t\tfloatingMessage: {\r\n\t\t\t\ttimestamp: error.timestamp,\r\n\t\t\t\tvisible: true,\r\n\t\t\t\ttext: error.text,\r\n\t\t\t\ttitle: error.title\r\n\t\t\t}\r\n\t\t})\r\n\t\tsetTimeout(() => {\r\n\t\t\tif (this.state.floatingMessage.timestamp !== error.timestamp) return\r\n\t\t\tthis.setState({\r\n\t\t\t\tfloatingMessage: {\r\n\t\t\t\t\ttimestamp: 0,\r\n\t\t\t\t\tvisible: false,\r\n\t\t\t\t\ttext: \"\",\r\n\t\t\t\t\ttitle: \"\"\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t}, error.timeout)\r\n\t}\r\n\trender() {\r\n\t\tconst { floatingMessage, hasVisited, homeData } = this.state\r\n\t\treturn <div className=\"index\">\r\n\r\n\t\t\t<FloatingMessage\r\n\t\t\t\ttitle={floatingMessage.title}\r\n\t\t\t\tvisible={floatingMessage.visible}\r\n\t\t\t\tonClick={this.hideMessage}\r\n\t\t\t\ttext={floatingMessage.text}\r\n\t\t\t/>\r\n\t\t\t{homeData.visible && <Home\r\n\t\t\t\ttoggleHome={this.toggleHome}\r\n\t\t\t\tchangePage={this.changePage}\r\n\t\t\t\tsetDontShowHome={this.setDontShowHome}\r\n\t\t\t\taskForStorage={this.askForStorage}\r\n\t\t\t\thasVisited={hasVisited}\r\n\t\t\t\tdata={homeData}\r\n\t\t\t/>}\r\n\t\t\t<HashRouter>\r\n\t\t\t\t<Redirect to={\"/\" + this.state.selectedPage}></Redirect>\r\n\t\t\t\t{this.state.selectedPage === \"ErrorPage\"\r\n\t\t\t\t\t? <Route exact path={\"/ErrorPage\"}>\r\n\t\t\t\t\t\t<ErrorPage changePage={this.changePage} />\r\n\t\t\t\t\t</Route>\r\n\t\t\t\t\t: <>\r\n\t\t\t\t\t\t<Route exact path={\"/ErrorPage\"}>\r\n\t\t\t\t\t\t\t<ErrorPage changePage={this.changePage} />\r\n\t\t\t\t\t\t</Route>\r\n\t\t\t\t\t\t<Route exact path=\"/\">\r\n\t\t\t\t\t\t\t<App changePage={this.changePage} />\r\n\t\t\t\t\t\t</Route>\r\n\r\n\t\t\t\t\t\t<Route exact path=\"/Composer\">\r\n\t\t\t\t\t\t\t<Composer changePage={this.changePage} />\r\n\t\t\t\t\t\t</Route>\r\n\r\n\t\t\t\t\t\t<Route exact path=\"/Donate\">\r\n\t\t\t\t\t\t\t<Donate changePage={this.changePage} />\r\n\t\t\t\t\t\t</Route>\r\n\r\n\t\t\t\t\t\t<Route exact path=\"/Changelog\">\r\n\t\t\t\t\t\t\t<Changelogpage changePage={this.changePage} />\r\n\t\t\t\t\t\t</Route>\r\n\r\n\t\t\t\t\t\t<Route exact path=\"/Partners\">\r\n\t\t\t\t\t\t\t<Partners changePage={this.changePage} />\r\n\t\t\t\t\t\t</Route>\r\n\r\n\t\t\t\t\t\t<Route exact path='/Help'>\r\n\t\t\t\t\t\t\t<Help changePage={this.changePage} />\r\n\t\t\t\t\t\t</Route>\r\n\t\t\t\t\t\t<Route exact path='/SheetVisualizer'>\r\n\t\t\t\t\t\t\t<SheetVisualizer changePage={this.changePage} />\r\n\t\t\t\t\t\t</Route>\r\n\t\t\t\t\t</>\r\n\t\t\t\t}\r\n\t\t\t</HashRouter>\r\n\t\t\t<div className=\"rotate-screen\">\r\n\t\t\t\t<img src={rotateImg} alt=\"icon for the rotating screen\">\r\n\t\t\t\t</img>\r\n\t\t\t\tFor a better experience, add the website to the home screen, and rotate your device\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t}\r\n}\r\n\r\nReactDOM.render(\r\n\t<React.StrictMode>\r\n\t\t<Index />\r\n\t</React.StrictMode>,\r\n\tdocument.getElementById('root')\r\n);\r\n\r\n\r\nfunction setIfInTWA() {\r\n\tif (isTwa()) return console.log('inTWA')\r\n\tlet isInTwa = document.referrer.includes('android-app://')\r\n\tsessionStorage.setItem('isTwa', isInTwa)\r\n}\r\n\r\n\r\nsetIfInTWA()\r\nserviceWorkerRegistration.register();"],"sourceRoot":""}