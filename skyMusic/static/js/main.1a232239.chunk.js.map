{"version":3,"sources":["appConfig.js","components/GenshinNoteBorder.js","pages/Main/Components/Note.js","pages/Main/SongStore.js","lib/Utils.js","lib/SettingsObj.js","components/Memoized.js","pages/Main/Components/TopPage.js","lib/Analytics.js","pages/Main/Keyboard.js","assets/images/mainpage.png","assets/images/composer.png","assets/images/songs.png","components/HelpTab/index.js","components/MenuItem.js","components/MenuPanel.js","components/MenuClose.js","components/Switch/index.js","components/SettingsRow.js","components/DonateButton.js","components/LibrarySearchedSong.js","pages/Main/Components/Menu.js","Database.js","lib/Instrument.js","lib/AudioRecorder.js","components/AsyncPrompts.js","pages/Main/index.js","assets/icons/addCell.svg","assets/icons/removeCell.svg","lib/hooks/useDebounce.js","pages/Composer/MidiParser.js","pages/Composer/Components/ComposerTools.js","pages/Composer/Components/ComposerNote.js","pages/Composer/Components/MultiSwitch.js","pages/Composer/ComposerKeyboard.js","pages/Composer/Cache.js","pages/Composer/Canvas.js","pages/Composer/Components/Menu.js","pages/Composer/index.js","components/SimpleMenu.js","pages/ErrorPage/index.js","pages/Changelog/index.js","assets/images/partners/windsong-db.jpg","pages/Partners/index.js","pages/Home/index.js","pages/Help/index.js","pages/SheetVisualizer/index.js","components/BaseNote.js","pages/MidiSetup/Shortcut.js","pages/MidiSetup/index.js","serviceWorkerRegistration.js","components/FloatingMessage.js","assets/images/paypalme.png","assets/images/buymeacoffee.svg","pages/Donate/index.js","assets/images/kofi.png","assets/icons/rotate.svg","index.js"],"names":["appName","process","appVersion","console","log","updateMessage","trim","pages","layersIndexes","cssClasses","noteComposer","note","noteAnimation","approachCircle","noteName","audioContext","window","AudioContext","webkitAudioContext","MIDI_STATUS","isMidiAvailable","navigator","requestMIDIAccess","instruments","notesPerColumn","instrumentsData","Lyre","notes","Zither","effects","filter","clickColor","DunDun","Panflute","Bells","Trumpet","Contrabass","Drum","Flute","Guitar","HandPan","ToyUkulele","Harp","Horn","Piano","Pipa","Kalimba","WinterPiano","Xylophone","Ocarina","layoutData","keyboardLayout","split","mobileLayout","keyboardCodes","abcLayout","keyNames","Sky","Genshin","speedChangers","map","e","name","value","pitchArr","composerNotePositions","reverse","importNotePositions","layoutImages","cacheData","noteData","background","border","center","horizontalLineBreak","standards","color","layersCombination","breakpoints","type","isTwa","JSON","parse","sessionStorage","getItem","NoteBorder","props","fill","className","width","height","viewBox","xmlns","style","d","memo","data","approachingNotes","outgoingAnimation","fadeTime","handleClick","noteImage","noteText","status","approachRate","instrument","animation","transition","parseClass","onPointerDown","preventDefault","index","id","key","backgroundColor","draggable","alt","src","parseBorderFill","p","n","getApproachCircleColor","numOfNotes","Math","floor","ApproachCircle","borderColor","prev","next","songStore","observable","song","eventType","start","Recording","init","Date","getTime","addNote","length","push","this","Song","version","bpm","pitch","isComposed","isComposedVersion","Object","entries","forEach","entry","LoggerEvent","title","text","timeout","trigger","dispatchEvent","event","undefined","CustomEvent","detail","FileDownloader","download","file","dataType","encodeURIComponent","el","document","createElement","body","appendChild","setAttribute","click","remove","TempoChangers","changer","ComposedSong","columns","selected","Array","column","Column","tempoChanger","MIDINote","midi","MIDIShortcut","getNoteText","noteNameType","layoutLength","layout","indexOf","NotesTable","ComposerSongDeSerialization","Number","obj","isNaN","columnObj","ColumnNote","ComposerToRecording","recordedSong","bpmPerMs","totalTime","ComposerSongSerialization","columnArr","layer","prepareSongDownload","finalSong","stringify","oldFormatNotes","convertedNotes","noteObj","time","l","composedToOldFormat","recordedToOldFormat","pitchLevel","songNotes","bitsPerPage","isEncrypted","prepareSongImport","isArray","includes","getSongType","Error","result","self","findIndex","genshinLayout","RecordingToComposed","oldSkyToNewFormat","newSkyFormatToGenshin","precision","bpmToMs","composed","converted","groupedNotes","previousTime","row","shift","amount","i","splice","elapsedTime","emptyColumns","noteColumn","numberToLayer","groupByIndex","group","mergeLayers","grouped","groupByNotes","combinations","columnNote","difference","paddingColumns","finalPadding","col","threshold","getPitchChanger","pow","toFixed","number","final","join","delayMs","ms","Promise","resolve","workerTimers","ComposerSettings","settingVesion","songSetting","volume","options","layer2","layer3","beatMarks","isMobile","columnsPerCanvas","caveMode","autosave","backgroundImage","placeholder","syncTabs","MainPageSettings","keyboardSize","approachSpeed","MIDISettings","enabled","currentSource","shortcuts","getMIDISettings","settings","localStorage","children","stop","restart","sliderState","handleSliderEvent","handleSpeedChanger","speedChanger","approachingScore","Score","onClick","Memoized","min","onChange","max","size","position","disabled","combo","score","correct","wrong","GA","gtag","fn","a","error","action","params","callGA","Analytics","pageView","page","songEvent","userSongs","songSearch","UIEvent","Keyboard","initMidi","onstatechange","MidiAccess","midiInputs","inputs","values","input","done","currentMidiSource","onmidimessage","find","manufacturer","handleMidi","mounted","keyboard","velocity","keyboardNotes","keyboardNote","approachingSong","startDelay","state","setState","changeSliderState","approachingNotesList","tick","hasSong","stateNotes","tickTime","hasChanges","removed","clicked","random","apNote","arr","slice","playSong","songTimestamp","timestamp","applySpeedChange","previous","pastError","delay","practiceSong","songLength","chunks","previousChunkDelay","chunk","startTime","j","firstChunk","nextChunkDelay","secondChunk","functions","setHasSong","songToPractice","target","restartSong","override","lostReference","stopSong","setTimeout","isInteger","res","stopAndClear","handleKeyboard","repeat","activeElement","tagName","shiftKey","code","replace","getNoteFromCode","handleApproachClick","approachingNote","handlePracticeClick","indexClicked","nextChunk","nextNextChunk","hasAnimation","approachStatus","playSound","propKeyboard","playTimestamp","disposeStore","tickInterval","addEventListener","setInterval","observe","object","then","removeEventListener","clearInterval","keyboardClass","transform","marginBottom","isLoading","instrumentName","isAnimated","Component","HelpTab","mainPageImg","Key","songsImg","composerImg","MenuPanel","visible","MenuClose","Switch","checked","update","objKey","changeVolume","useState","valueHook","setter","volumeHook","setterVolume","sendChangeSelect","useEffect","onBlur","onPointerUp","DonateButton","SearchedSong","importSong","fetching","setFetching","cache","setCache","fetch","encodeURI","json","play","Menu","blur","open","checkPersistentStorage","storage","persist","persisted","isPersisted","isPersistentStorage","handleSearchInput","searchInput","clearSearch","searchedSongs","searchStatus","searchSongs","fetchedSongs","toggleMenu","newState","selectSideMenu","selection","selectedMenu","tab","changeSelectedSongType","selectedSongType","reader","FileReader","songsInput","addSong","readAsText","downloadSong","_id","songName","song1","toLowerCase","downloadAllSongs","toDownload","songs","fileDownloader","date","toISOString","sideClass","handleSettingChange","changePage","composedSongs","searchedSongFunctions","SongRow","marginTop","paddingTop","display","justifyContent","marginLeft","onKeyDown","onInput","href","deleteSong","removeSong","Database","db","ZangoDb","Db","collections","collection","toArray","findOne","query","insert","DB","Instrument","String","newVolume","volumeNode","gain","deleted","player","createBufferSource","buffer","buffers","connect","playbackRate","onended","disconnect","load","emptyBuffer","createBuffer","sampleRate","requests","url","arrayBuffer","decodeAudioData","catch","all","loaded","node","delete","createGain","instrumentData","noteNames","mobile","NoteData","ArrayBuffer","AudioRecorder","createMediaStreamDestination","MediaRecorder","recorder","stream","MediaRecorderPolyfill","toUrl","URL","createObjectURL","once","urlBlob","fileName","anchor","toWav","blobToAudio","wav","blob","Blob","DataView","fileReader","onloadend","audioBuffer","readAsArrayBuffer","asyncPrompt","question","overlay","container","cancel","ok","innerText","append","disposed","inputListener","classList","add","cancelListener","dispose","okListener","handleOverlay","path","clearDOM","focus","asyncConfirm","cancellable","element","querySelectorAll","App","loadInstrument","loadReverb","toggleReverbNodes","thereIsSong","toggleRecord","resetDrag","isDragging","handleDragOver","handleDrag","handleDrop","from","dataTransfer","files","hasReverb","reverbNode","destination","updateSettings","getSettings","storedSettings","newInstrument","isLoadingInstrument","isRecording","handleRecording","setItem","setting","syncSongs","getSongs","songExists","existsSong","recording","askForSongName","promptString","toggleRecordAudio","isRecordingAudio","reverbVolumeNode","r","b","impulse_response","convolver","createConvolver","gainNode","keyboardFunctions","keyboardData","menuFunctions","menuData","AppButton","active","isInTwa","referrer","setIfInTWA","useDebounce","debouncedValue","setDebouncedValue","handler","clearTimeout","Track","editTrack","dataShown","setDataShown","textAlign","family","cursor","numberOfAccidentals","numberOfOutOfRange","MidiImport","handleFile","Midi","header","tempos","keySignatures","tracks","track","offset","convertMidi","includeAccidentals","outOfRange","totalNotes","midiNote","convertedNote","isAccidental","convertMidiNote","sort","lastColumn","selectedColumn","loadSong","accidentals","command","changeOffset","parseInt","changePitch","toggleAccidentals","changeBpm","changeMidiVisibility","margin","maxWidth","textOverflow","overflow","marginRight","alignItems","NumberInput","changeValue","step","elementValue","setElementValue","debounced","ComposerTools","toggleTools","copyColumns","eraseColumns","pasteColumns","deleteColumns","copiedColumns","currentTarget","layers","clickAction","selectedColor","buttonsClass","onSelect","ComposerKeyboard","notesIndexes","currentColumn","hiddenSideMenu","isPlaying","changeLayer","handleTempoChanger","toString","ComposerCache","timelineHeight","destroy","generate","canvas","drawColumn","toDataURL","standardColumn","standard","standardLarger","roundNess","noteWidth","noteHeight","ctx","getContext","fillStyle","roundRect","ceil","strokeStyle","lineWidth","beginPath","ballHeight","arc","PI","columnsLarger","breakpoint","moveTo","lineTo","notesFigures","borderWidth","fillRect","stroke","y","x","radius","tl","tr","br","bl","defaultRadius","side","quadraticCurveTo","closePath","NumOfColumnsPerCanvas","ComposerCanvas","resetPointerDown","stageSelected","sliderSelected","stagePreviousPositon","handleBreakpoints","handleWheel","selectColumn","sign","deltaY","global","relativeColumnWidth","stageSize","stagePosition","onSlider","sliderOffset","throttleScroll","MAX_SAFE_INTEGER","handleSlide","handleStageSlide","clamp","abs","newPosition","direction","v","globalX","hasSlided","totalWidth","relativePos","sizes","getBoundingClientRect","parentWidth","nearestEven","screen","currentBreakpoint","canvasRef","React","createRef","current","_canvas","xPos","counterLimit","switcher","counter","raf","renderOnComponentChange","ref","interactive","pointerdown","pointermove","pos","currentPos","boundaries","isVisible","tempoChangersCache","standardCache","backgroundCache","isToolsSelected","toolsColumns","isSelected","isBreakpoint","antialias","autoDensity","pointerup","draw","g","clear","beginFill","drawRect","fillX","image","lineStyle","drawRoundedRect","drawStage","toggleBreakpoint","pointertap","interactiveChildren","alpha","zIndex","num","round","toggleMenuVisible","updateSong","currentSong","createNewSong","songFunctions","hasUnsaved","menuClass","menuOpen","startRecordingAudio","Composer","promises","setupAudioDestination","handleAutoSave","changes","shortcut","togglePlay","addColumns","removeColumns","nextLayer","ins","letter","broadcastChannel","postMessage","layerIndex","replaceAt","currentNote","askForSongUpdate","confirm","songColumns","msPerBPM","handleTick","newIndex","indexOfBreakpoint","validateBreakpoints","ignoreAudio","toolsVisible","copiedColums","copiedColumn","copiedNote","columnIndex","visibility","midiVisible","playbackInterval","BroadcastChannel","onmessage","location","hostname","returnValue","close","end","totalLength","currentLength","increment","total","calculateLength","canvasFunctions","canvasData","toolsData","toolsFunctions","midiParserFunctions","midiParserData","addCell","removeCell","formatMillis","millis","minutes","seconds","string","replacement","valueOf","substring","SimpleMenu","rel","ErrorPage","deleteAllSongs","resetSettings","removeItem","Changelogpage","changelogs","ChangelogRow","item","Partners","Partner","description","Iframe","PartnerImg","img","WindsongDBImg","to","borderRadius","objectFit","frameBorder","allow","allowFullScreen","Home","askForStorage","hasVisited","toggleHome","currentPage","setDontShowHome","homeClass","isInPosition","innerWidth","hasPersistentStorage","MainContentelement","icon","Separator","PageRedirect","canShow","readOnly","Help","fontSize","THRESHOLDS","SheetVisualizer","setSongs","sheet","setSheet","framesPerRow","setFramesPerRow","setCurrentSong","setSelectedSongType","hasText","setHasText","songAsText","setSongAstext","setFrames","newAmount","frame","querySelector","getChunkNoteText","toUpperCase","sheetText","Chunk","emptyChunks","flexDirection","print","gridTemplateColumns","SheetFrame","rows","columnsPerRow","exists","selectedStyle","BaseNote","parseBorderColor","Shortcut","prepareText","MidiSetup","midiStateChange","sources","selectMidi","selectedSource","nextSource","s","saveLayout","deselectNotes","checkIfUsed","selectedNote","selectedShortcut","animate","handleShortcutClick","source","defaultValue","isLocalhost","Boolean","match","registerValidSW","swUrl","config","serviceWorker","register","registration","onupdatefound","installingWorker","installing","controller","onUpdate","onSuccess","FloatingMessage","classes","Donate","paypalImg","buyMeACoffeeImg","Index","handleResize","pageHeight","innerHeight","setHeight","resetHeight","h","minHeight","handleBlur","homeData","selectedPage","homeVisible","page_title","lastState","closeWelcomeScreen","hideMessage","floatingMessage","checkUpdate","updateChecked","storedVersion","logEvent","canShowHome","exact","rotateImg","ReactDOM","render","StrictMode","getElementById","origin","headers","response","contentType","get","ready","unregister","reload","checkValidServiceWorker","serviceWorkerRegistration"],"mappings":"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","file":"static/js/main.1a232239.chunk.js","sourcesContent":["const appName = process.env.REACT_APP_NAME || [\"Sky\", \"Genshin\"][1]\r\nconst appVersion = '2.3'\r\n//TODO make all those variables uppercase\r\nconsole.log(`${appName}-V${appVersion}`)\r\nconst updateMessage = appName === 'Genshin'\r\n    ? ` - Added MIDI Keyboard support on all pages with custom layouts\r\n        - Performance improvements in main page\r\n        - UI improvements and bug fixes\r\n        - Added note names to sheet visualizer and empty cells\r\n        - Added ABC format\r\n    `.trim()\r\n    : ` - Added MIDI Keyboard support on all pages with custom layouts\r\n        - Performance improvements\r\n        - UI improvements and bug fixes\r\n        - Added note names to sheet visualizer and empty cells\r\n        - Added ABC format\r\n        - Added Panflute\r\n    `.trim()\r\n\r\nconst pages = [\"\", \"Composer\", \"ErrorPage\", \"Changelog\", \"Donate\", \"Partners\", \"Home\", \"Help\", \"SheetVisualizer\", \"MidiSetup\"]\r\nconst layersIndexes = [1,2,3]\r\nconst cssClasses = {\r\n    noteComposer: appName === \"Genshin\" ? \"note-composer\" : \"note-composer-sky\",\r\n    note: appName === \"Genshin\" ? \"note\" : \"note-sky\",\r\n    noteAnimation: appName === 'Genshin' ? \"note-animation\" : \"note-animation-sky\",\r\n    approachCircle: appName === \"Genshin\" ? \"approach-circle\" : \"approach-circle-sky\",\r\n    noteName: appName === \"Genshin\" ? \"note-name\" : \"note-name-sky\"\r\n}\r\nconst audioContext = new (window.AudioContext || window.webkitAudioContext)()\r\n\r\nconst MIDI_STATUS = {\r\n    up: 128,\r\n    down: 144\r\n}\r\nconst isMidiAvailable = !!navigator.requestMIDIAccess\r\nconst instruments = appName === \"Genshin\"\r\n    ? [\r\n        \"Lyre\",\r\n        \"Zither\",\r\n        \"Old-Zither\",\r\n        \"DunDun\"\r\n    ] : [\r\n        \"Piano\",\r\n        \"Contrabass\",\r\n        \"Guitar\",\r\n        \"Harp\",\r\n        \"Horn\",\r\n        \"Trumpet\",\r\n        \"Pipa\",\r\n        \"WinterPiano\",\r\n        \"Xylophone\",\r\n        \"Flute\",\r\n        \"Panflute\",\r\n        \"Ocarina\",\r\n        \"Kalimba\",\r\n        \"ToyUkulele\",\r\n        \"Drum\",\r\n        \"Bells\",\r\n        \"DunDun\",\r\n        \"HandPan\"\r\n    ]\r\nconst notesPerColumn = appName === \"Genshin\" ? 21 : 15\r\nconst instrumentsData = {\r\n    Lyre: {\r\n        notes: 21\r\n    },\r\n    Zither: {\r\n        notes: 21,\r\n        effects: {\r\n            filter: 'sepia(100%)',\r\n        },\r\n        clickColor: '#ddcba8'\r\n    },\r\n    \"Old-Zither\": {\r\n        notes: 21,\r\n        effects: {\r\n            filter: 'sepia(100%)',\r\n        },\r\n        clickColor: '#ddcba8'\r\n    },\r\n    DunDun: {\r\n        notes: 8\r\n    },\r\n    Panflute: {\r\n        notes: 15\r\n    },\r\n    Bells: {\r\n        notes: 8\r\n    },\r\n    Trumpet: {\r\n        notes: 15\r\n    },\r\n    Contrabass: {\r\n        notes: 15\r\n    },\r\n    Drum: {\r\n        notes: 8\r\n    },\r\n    Flute: {\r\n        notes: 15\r\n    },\r\n    Guitar: {\r\n        notes: 15\r\n    },\r\n    HandPan: {\r\n        notes: 8\r\n    },\r\n    ToyUkulele: {\r\n        notes: 15\r\n    },\r\n    Harp: {\r\n        notes: 15\r\n    },\r\n    Horn: {\r\n        notes: 15\r\n    },\r\n    Piano: {\r\n        notes: 15\r\n    },\r\n    Pipa: {\r\n        notes: 15\r\n    },\r\n    Kalimba: {\r\n        notes: 15\r\n    },\r\n    WinterPiano: {\r\n        notes: 15\r\n    },\r\n    Xylophone: {\r\n        notes: 15\r\n    },\r\n    Ocarina: {\r\n        notes: 15\r\n    }\r\n}\r\n\r\n\r\nconst layoutData = {\r\n    21: {\r\n        keyboardLayout: (\r\n            \"Q W E R T Y U \" +\r\n            \"A S D F G H J \" +\r\n            \"Z X C V B N M\").split(\" \"),\r\n\r\n        mobileLayout: (\r\n            \"do re mi fa so la ti \" +\r\n            \"do re mi fa so la ti \" +\r\n            \"do re mi fa so la ti\").split(\" \"),\r\n\r\n        keyboardCodes: (\r\n            \"81 87 69 82 84 89 85 \" +\r\n            \"65 83 68 70 71 72 74 \" +\r\n            \"90 88 67 86 66 78 77\").split(\" \"),\r\n        abcLayout: (\r\n            \"A1 A2 A3 A4 A5 A6 A7 \" +\r\n            \"B1 B2 B3 B4 B5 B6 B7 \" +\r\n            \"C1 C2 C3 C4 C5 C6 C7\").split(\" \")\r\n    },\r\n    8: {\r\n        keyboardLayout: (\r\n            \"Q W E R \" +\r\n            \"A S D F\").split(\" \"),\r\n\r\n        mobileLayout: (\r\n            \"do re mi fa \" +\r\n            \"do re mi fa\").split(\" \"),\r\n\r\n        keyboardCodes: (\r\n            \"81 87 69 82 \" +\r\n            \"65 83 68 70\").split(\" \"),\r\n        abcLayout: (\r\n            \"A1 A2 A3 A4\" +\r\n            \"B1 B2 B3 B4\").split(\" \")\r\n    },\r\n    15: {\r\n        keyboardLayout: (\r\n            \"Q W E R T \" +\r\n            \"A S D F G \" +\r\n            \"Z X C V B\").split(\" \"),\r\n\r\n        mobileLayout: (\r\n            \"do re mi fa so \" +\r\n            \"do re mi fa so \" +\r\n            \"do re mi fa so\").split(\" \"),\r\n\r\n        keyboardCodes: (\r\n            \"81 87 69 82 84 \" +\r\n            \"65 83 68 70 71 \" +\r\n            \"90 88 67 86 66\").split(\" \"),\r\n        abcLayout: (\r\n            \"A1 A2 A3 A4 A5 \" +\r\n            \"B1 B2 B3 B4 B5 \" +\r\n            \"C1 C2 C3 C4 C5\").split(\" \")\r\n    }\r\n}\r\n\r\nconst keyNames = {\r\n    Sky: {\r\n        0: [\"C\", \"D\", \"E\", \"F\", \"G\", \"A\", \"B\", \"C\", \"D\", \"E\", \"F\", \"G\", \"A\", \"B\", \"C\"],\r\n        1: [\"Db\", \"Eb\", \"F\", \"Gb\", \"Ab\", \"Bb\", \"C\", \"Db\", \"Eb\", \"F\", \"Gb\", \"Ab\", \"Bb\", \"C\", \"Db\"],\r\n        2: [\"D\", \"E\", \"F#\", \"G\", \"A\", \"B\", \"C#\", \"D\", \"E\", \"F#\", \"G\", \"A\", \"B\", \"C#\", \"D\"],\r\n        3: [\"Eb\", \"F\", \"G\", \"Ab\", \"Bb\", \"C\", \"D\", \"Eb\", \"F\", \"G\", \"Ab\", \"Bb\", \"C\", \"D\", \"Eb\"],\r\n        4: [\"E\", \"F#\", \"G#\", \"A\", \"B\", \"C#\", \"D#\", \"E\", \"F#\", \"G#\", \"A\", \"B\", \"C#\", \"D#\", \"E\"],\r\n        5: [\"F\", \"G\", \"A\", \"Bb\", \"C\", \"D\", \"E\", \"F\", \"G\", \"A\", \"Bb\", \"C\", \"D\", \"E\", \"F\"],\r\n        6: [\"Gb\", \"Ab\", \"Bb\", \"Cb\", \"Db\", \"Eb\", \"F\", \"Gb\", \"Ab\", \"Bb\", \"Cb\", \"Db\", \"Eb\", \"F\", \"Gb\"],\r\n        7: [\"G\", \"A\", \"B\", \"C\", \"D\", \"E\", \"F#\", \"G\", \"A\", \"B\", \"C\", \"D\", \"E\", \"F#\", \"G\"],\r\n        8: [\"Ab\", \"Bb\", \"C\", \"Db\", \"Eb\", \"F\", \"G\", \"Ab\", \"Bb\", \"C\", \"Db\", \"Eb\", \"F\", \"G\", \"Ab\"],\r\n        9: [\"A\", \"B\", \"C#\", \"D\", \"E\", \"F#\", \"G#\", \"A\", \"B\", \"C#\", \"D\", \"E\", \"F#\", \"G#\", \"A\"],\r\n        10: [\"Bb\", \"C\", \"D\", \"Eb\", \"F\", \"G\", \"A\", \"Bb\", \"C\", \"D\", \"Eb\", \"F\", \"G\", \"A\", \"Bb\"],\r\n        11: [\"B\", \"C#\", \"D#\", \"E\", \"F#\", \"G#\", \"A#\", \"B\", \"C#\", \"D#\", \"E\", \"F#\", \"G#\", \"A#\", \"B\"]\r\n    },\r\n    Genshin: {\r\n        0: [\"C\", \"D\", \"E\", \"F\", \"G\", \"A\", \"B\", \"C\", \"D\", \"E\", \"F\", \"G\", \"A\", \"B\", \"C\", \"D\", \"E\", \"F\", \"G\", \"A\", \"B\"],\r\n        1: [\"Db\", \"Eb\", \"F\", \"Gb\", \"Ab\", \"Bb\", \"C\", \"Db\", \"Eb\", \"F\", \"Gb\", \"Ab\", \"Bb\", \"C\", \"Db\", \"Eb\", \"F\", \"Gb\", \"Ab\", \"Bb\", \"C\", \"Db\"],\r\n        2: [\"D\", \"E\", \"F#\", \"G\", \"A\", \"B\", \"C#\", \"D\", \"E\", \"F#\", \"G\", \"A\", \"B\", \"C#\", \"D\", \"E\", \"F#\", \"G\", \"A\", \"B\", \"C#\", \"D\"],\r\n        3: [\"Eb\", \"F\", \"G\", \"Ab\", \"Bb\", \"C\", \"D\", \"Eb\", \"F\", \"G\", \"Ab\", \"Bb\", \"C\", \"D\", \"Eb\", \"F\", \"G\", \"Ab\", \"Bb\", \"C\", \"D\", \"Eb\"],\r\n        4: [\"E\", \"F#\", \"G#\", \"A\", \"B\", \"C#\", \"D#\", \"E\", \"F#\", \"G#\", \"A\", \"B\", \"C#\", \"D#\", \"E\", \"F#\", \"G#\", \"A\", \"B\", \"C#\", \"D#\", \"E\"],\r\n        5: [\"F\", \"G\", \"A\", \"Bb\", \"C\", \"D\", \"E\", \"F\", \"G\", \"A\", \"Bb\", \"C\", \"D\", \"E\", \"F\", \"G\", \"A\", \"Bb\", \"C\", \"D\", \"E\", \"F\"],\r\n        6: [\"Gb\", \"Ab\", \"Bb\", \"Cb\", \"Db\", \"Eb\", \"F\", \"Gb\", \"Ab\", \"Bb\", \"Cb\", \"Db\", \"Eb\", \"F\", \"Gb\", \"Ab\", \"Bb\", \"Cb\", \"Db\", \"Eb\", \"F\", \"Gb\"],\r\n        7: [\"G\", \"A\", \"B\", \"C\", \"D\", \"E\", \"F#\", \"G\", \"A\", \"B\", \"C\", \"D\", \"E\", \"F#\", \"G\", \"A\", \"B\", \"C\", \"D\", \"E\", \"F#\", \"G\"],\r\n        8: [\"Ab\", \"Bb\", \"C\", \"Db\", \"Eb\", \"F\", \"G\", \"Ab\", \"Bb\", \"C\", \"Db\", \"Eb\", \"F\", \"G\", \"Ab\", \"Bb\", \"C\", \"Db\", \"Eb\", \"F\", \"G\", \"Ab\"],\r\n        9: [\"A\", \"B\", \"C#\", \"D\", \"E\", \"F#\", \"G#\", \"A\", \"B\", \"C#\", \"D\", \"E\", \"F#\", \"G#\", \"A\", \"B\", \"C#\", \"D\", \"E\", \"F#\", \"G#\", \"A\"],\r\n        10: [\"Bb\", \"C\", \"D\", \"Eb\", \"F\", \"G\", \"A\", \"Bb\", \"C\", \"D\", \"Eb\", \"F\", \"G\", \"A\", \"Bb\", \"C\", \"D\", \"Eb\", \"F\", \"G\", \"A\", \"Bb\"],\r\n        11: [\"B\", \"C#\", \"D#\", \"E\", \"F#\", \"G#\", \"A#\", \"B\", \"C#\", \"D#\", \"E\", \"F#\", \"G#\", \"A#\", \"B\", \"C#\", \"D#\", \"E\", \"F#\", \"G#\", \"A#\", \"B\"]\r\n    }\r\n}\r\nconst speedChangers = [0.25, 0.5, 0.75, 1, 1.25, 1.5, 2].map(e => {\r\n    return {\r\n        name: `x${e}`,\r\n        value: e\r\n    }\r\n})\r\n\r\nconst pitchArr = [\"C\", \"Db\", \"D\", \"Eb\", \"E\", \"F\", \"Gb\", \"G\", \"Ab\", \"A\", \"Bb\", \"B\"]\r\n\r\nconst composerNotePositions = appName === \"Genshin\" ? [14, 15, 16, 17, 18, 19, 20, 7, 8, 9, 10, 11, 12, 13, 0, 1, 2, 3, 4, 5, 6].reverse() : [15, 16, 17, 18, 19, 20, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14].reverse()\r\n\r\nconst importNotePositions = appName === \"Genshin\" ? [14, 15, 16, 17, 18, 19, 20, 7, 8, 9, 10, 11, 12, 13, 0] : [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14]\r\n\r\nconst layoutImages = {\r\n    15: \"dmcr dm cr dm cr cr dm dmcr dm cr cr dm cr dm dmcr\".split(\" \"),\r\n    8: appName === \"Sky\" ? \"cr dm cr dm cr dm cr dm\".split(\" \") : \"do re mi fa do re mi fa\".split(\" \"),\r\n    21: \"do re mi fa so la ti do re mi fa so la ti do re mi fa so la ti\".split(\" \")\r\n}\r\n\r\nconst cacheData = {\r\n    noteData: {\r\n        background: \"#d3bd8e\",\r\n        border: \"#de4545\",\r\n        center: \"#de4545\"\r\n    },\r\n    horizontalLineBreak: notesPerColumn / 3,\r\n    standards: [\r\n        {\r\n            color: 0x515c6f //lighter\r\n        },{\r\n            color: 0x485363 //darker\r\n        },{\r\n            color: 0x1a968b //selected\r\n        },{\r\n            color: 0xd6722f\r\n        }\r\n    ],\r\n    layersCombination: [\"000\", \"001\", \"010\", \"011\", \"100\", \"101\", \"110\", \"111\"],\r\n    breakpoints: [\r\n        {\r\n            type: \"short\",\r\n            color: \"#282875\"\r\n        },{\r\n            type: \"long\",\r\n            color: \"#282875\"\r\n        }\r\n    ]\r\n}\r\n\r\n\r\nfunction isTwa() {\r\n    let isTwa = JSON.parse(sessionStorage.getItem('isTwa'))\r\n    return isTwa\r\n}\r\n\r\n\r\nexport {\r\n    instruments,\r\n    instrumentsData,\r\n    composerNotePositions,\r\n    importNotePositions,\r\n    appName,\r\n    layoutData,\r\n    cssClasses,\r\n    notesPerColumn,\r\n    keyNames,\r\n    pitchArr,\r\n    layoutImages,\r\n    appVersion,\r\n    speedChangers,\r\n    audioContext,\r\n    pages,\r\n    isTwa,\r\n    cacheData,\r\n    updateMessage,\r\n    MIDI_STATUS,\r\n    isMidiAvailable,\r\n    layersIndexes\r\n}","export default function NoteBorder(props) {\r\n    const { fill, className } = props\r\n    return <svg\r\n        width=\"156mm\"\r\n        height=\"156mm\"\r\n        className={className}\r\n        viewBox=\"0 0 156 156\"\r\n        xmlns=\"http://www.w3.org/2000/svg\"\r\n        style={{ fill: fill || '#eae5ce' }}\r\n    >\r\n        <path\r\n            d=\"M 78.00026,10.550111 C 51.476969,10.181626 25.897505,27.22936 15.85058,51.745551 5.361171,75.829889 10.788685,105.74811 29.175285,124.53663 46.865842,143.57562 76.01089,150.52219 100.41467,141.63611 125.70972,133.0432 144.35989,108.19482 145.36211,81.471209 147.04137,55.492614 131.98362,29.525813 108.70692,17.929174 99.25071,13.06968 88.62966,10.533948 78.00026,10.550111 Z m 0,0.140044 c 2.58037,3.675401 5.16075,7.3508 7.74113,11.026201 24.63414,2.976727 45.57649,23.919913 48.5469,48.555693 3.66955,2.57607 7.33909,5.15214 11.00864,7.72821 -3.6711,2.57728 -7.34219,5.15455 -11.01328,7.73183 -2.97314,24.642991 -23.92605,45.594011 -48.5712,48.558271 -2.57073,3.66162 -5.14146,7.32324 -7.71219,10.98486 -2.57073,-3.66162 -5.141461,-7.32324 -7.712192,-10.98486 -24.643357,-2.96412 -45.595396,-23.91214 -48.570678,-48.553111 -3.673332,-2.57899 -7.346667,-5.15799 -11.019999,-7.73699 3.677467,-2.58193 7.354932,-5.16386 11.0324,-7.74578 2.977996,-24.622822 23.903746,-45.560994 48.529337,-48.537607 2.580378,-3.675573 5.160752,-7.351144 7.741132,-11.026717 z\"\r\n        />\r\n    </svg>\r\n}","import React, { memo } from 'react'\r\nimport { cssClasses, appName, instrumentsData } from \"appConfig\"\r\nimport GenshinNoteBorder from 'components/GenshinNoteBorder'\r\nexport default memo(function Note( { data, approachingNotes, outgoingAnimation, fadeTime, handleClick, noteImage, noteText }) {\r\n    const { status, approachRate, instrument } = data\r\n    const animation = {\r\n        transition: `background-color ${fadeTime}ms  ${fadeTime === (appName === 'Genshin' ? 100 : 200) ? 'ease' : 'linear'} , transform 0.15s, border-color 100ms`\r\n    }\r\n    const className = parseClass(status)\r\n    const effects = instrumentsData[instrument]?.effects || {}\r\n    const clickColor = instrumentsData[instrument]?.clickColor\r\n\r\n    return <button\r\n        onPointerDown={(e) => {\r\n            e.preventDefault()\r\n            handleClick(data)\r\n        }}\r\n        className=\"button-hitbox-bigger\"\r\n    >\r\n        {approachingNotes.map((note) => \r\n            <ApproachCircle\r\n                key={note.id}\r\n                index={data.index}\r\n                approachRate={approachRate}\r\n            />\r\n        )}\r\n        {outgoingAnimation.map(e => \r\n            <div\r\n                key={e.key}\r\n                className={cssClasses.noteAnimation}\r\n            />\r\n        )}\r\n        <div\r\n            className={className}\r\n            style={{\r\n                ...animation,\r\n                ...(clickColor && status === 'clicked' ? { backgroundColor: clickColor } : {})\r\n            }}\r\n        >\r\n            <img\r\n                draggable=\"false\"\r\n                alt=''\r\n                src={noteImage}\r\n                style={effects}\r\n            />\r\n            {appName === 'Genshin' && <GenshinNoteBorder\r\n                className='genshin-border'\r\n                fill={parseBorderFill(status)}\r\n            />}\r\n            <div className={cssClasses.noteName}>\r\n                {noteText}\r\n            </div>\r\n        </div>\r\n    </button>\r\n},(p,n) => {\r\n    return p.data.status === n.data.status && p.data.approachRate === n.data.approachRate && p.data.instrument === n.data.instrument\r\n        && p.noteText === n.noteText && p.fadeTime === n.fadeTime && p.handleClick === n.handleClick && p.noteImage === n.noteImage\r\n        && p.noteText === n.noteText && p.outgoingAnimation === n.outgoingAnimation && p.approachingNotes === n.approachingNotes\r\n})\r\n\r\nfunction getApproachCircleColor(index) {\r\n    let numOfNotes = appName === \"Sky\" ? 5 : 7\r\n    let row = Math.floor(index / numOfNotes)\r\n    let colors = [\"#3da399\", \"#ffb347\", \"#3da399\"]\r\n    return colors[row]\r\n}\r\n\r\nconst ApproachCircle = memo(function ApproachCircle({approachRate, index}) {\r\n    return <div\r\n        className={cssClasses.approachCircle}\r\n        style={{\r\n            animation: `approach ${approachRate}ms linear`,\r\n            borderColor: getApproachCircleColor(index),\r\n        }}\r\n    >\r\n    </div>\r\n},(prev,next)=>{\r\n    return prev.approachRate === next.approachRate && prev.index === next.index\r\n})\r\n\r\nfunction parseBorderFill(status) {\r\n    let fill = '#eae5ce'\r\n    if (status === \"clicked\") fill = \"transparent\"\r\n    else if (status === 'toClickNext' || status === 'toClickAndNext') fill = '#63aea7'\r\n    return fill\r\n}\r\n\r\nfunction parseClass(status) {\r\n    let className = cssClasses.note\r\n    switch (status) {\r\n        case 'clicked': className += \" click-event\"; break;\r\n        case 'toClick': className += \" note-red\"; break;\r\n        case 'toClickNext': className += \" note-border-click\"; break;\r\n        case 'toClickAndNext': className += \" note-red note-border-click\"; break;\r\n        case 'approach-wrong': className += \" click-event approach-wrong\"; break;\r\n        case 'approach-correct': className += \" click-event approach-correct\"; break;\r\n        default: break;\r\n    }\r\n    return className\r\n}\r\n","import { observable } from \"mobx\";\r\nexport const songStore = observable({\r\n    data: {\r\n        song: {},\r\n        eventType: '',\r\n        start: 0\r\n    }\r\n})","import { importNotePositions, appName, instruments, pitchArr, keyNames, layoutData } from \"appConfig\"\r\nimport * as workerTimers from 'worker-timers';\r\nclass Recording {\r\n\tconstructor() {\r\n\t\tthis.start = new Date().getTime()\r\n\t\tthis.notes = []\r\n\t}\r\n\tinit = () => {\r\n\t\tthis.start = new Date().getTime() - 100\r\n\t\tconsole.log(\"Started new recording\")\r\n\t}\r\n\taddNote = (index) => {\r\n\t\tif (this.notes.length === 0) this.init()\r\n\t\tlet currentTime = new Date().getTime()\r\n\t\tlet note = [index, currentTime - this.start]\r\n\t\tthis.notes.push(note)\r\n\t}\r\n}\r\n\r\nclass Song {\r\n\tconstructor(name, notes = [], data = {}) {\r\n\t\tthis.name = name\r\n\t\tthis.version = 1\r\n\t\tthis.notes = notes\r\n\t\tthis.bpm = 220\r\n\t\tthis.pitch = \"C\"\r\n\t\tthis.data = {\r\n\t\t\tisComposed: false,\r\n\t\t\tisComposedVersion: false,\r\n\t\t\tappName: appName\r\n\t\t}\r\n\t\tObject.entries(data).forEach((entry) => {\r\n\t\t\tthis.data[entry[0]] = entry[1]\r\n\t\t})\r\n\t}\r\n}\r\n\r\nclass LoggerEvent {\r\n\tconstructor(title, text, timeout) {\r\n\t\tthis.title = title\r\n\t\tthis.timeout = timeout\r\n\t\tthis.text = text\r\n\t\tif (timeout === undefined) this.timeout = 3000\r\n\t\tthis.event = new CustomEvent(\"logEvent\", {\r\n\t\t\tdetail: {\r\n\t\t\t\ttitle: this.title,\r\n\t\t\t\ttext: this.text,\r\n\t\t\t\ttimeout: this.timeout\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\ttrigger = () => {\r\n\t\twindow.dispatchEvent(this.event)\r\n\t}\r\n}\r\n\r\nclass NoteData {\r\n\tconstructor(index, noteNames, url) {\r\n\t\tthis.index = index\r\n\t\tthis.noteNames = noteNames\r\n\t\tthis.url = url\r\n\t\tthis.buffer = new ArrayBuffer(8)\r\n\t\tthis.clicked = false\r\n\t}\r\n}\r\n\r\nclass PlayingSong {\r\n\tconstructor(notes) {\r\n\t\tthis.timestamp = new Date().getTime()\r\n\t\tthis.notes = notes\r\n\t}\r\n}\r\n\r\nclass FileDownloader {\r\n\tconstructor(type) {\r\n\t\tif (type === undefined) type = \"text/json\"\r\n\t\tthis.dataType = \"data:\" + type + \";charset=utf-8,\"\r\n\t}\r\n\tdownload = (file, name) => {\r\n\t\tlet data = this.dataType + encodeURIComponent(file)\r\n\t\tvar el = document.createElement(\"a\")\r\n\t\tel.style = \"display:none\"\r\n\t\tdocument.body.appendChild(el)\r\n\t\tel.setAttribute(\"href\", data)\r\n\t\tel.setAttribute(\"download\", name)\r\n\t\tel.click();\r\n\t\tel.remove();\r\n\t}\r\n}\r\n\r\nconst TempoChangers = [\r\n\t{\r\n\t\tid: 0,\r\n\t\ttext: \"1\",\r\n\t\tchanger: 1,\r\n\t\tcolor: 0x515c6f\r\n\t}, {\r\n\t\tid: 1,\r\n\t\ttext: \"1/2\",\r\n\t\tchanger: 1 / 2,\r\n\t\tcolor: 0x517553\r\n\t}, {\r\n\t\tid: 2,\r\n\t\ttext: \"1/4\",\r\n\t\tchanger: 1 / 4,\r\n\t\tcolor: 0x434c7d\r\n\t}, {\r\n\t\tid: 3,\r\n\t\ttext: \"1/8\",\r\n\t\tchanger: 1 / 8,\r\n\t\tcolor: 0x774D6D\r\n\t}\r\n]\r\n\r\nclass ComposedSong {\r\n\tconstructor(name, notes = [], data = {}) {\r\n\t\tdata.isComposed = true\r\n\t\tdata.isComposedVersion = true\r\n\t\tthis.version = 1\r\n\t\tthis.data = data\r\n\t\tthis.name = name\r\n\t\tthis.bpm = 220\r\n\t\tthis.pitch = \"C\"\r\n\t\tthis.notes = notes\r\n\t\tthis.instruments = [instruments[0], instruments[0], instruments[0]]\r\n\t\tthis.breakpoints = [0]\r\n\t\tthis.columns = []\r\n\t\tthis.selected = 0\r\n\t\tnew Array(100).fill().forEach((e) => {\r\n\t\t\tlet column = new Column()\r\n\t\t\tcolumn.tempoChanger = 0\r\n\t\t\tthis.columns.push(column)\r\n\t\t})\r\n\t}\r\n}\r\n\r\n\r\nclass MIDINote{\r\n\tindex = 0\r\n\tmidi = 0\r\n\tstatus = 'wrong'\r\n\tconstructor(index,midi){\r\n\t\tthis.index = index\r\n\t\tthis.midi = midi\r\n\t\tthis.status = midi < 0 ? 'wrong' : 'right'\r\n\t}\r\n}\r\nclass MIDIShortcut{\r\n    constructor(type, midi){\r\n        this.type = type\r\n        this.midi = midi\r\n\t\tthis.status = midi < 0 ? 'wrong' : 'right'\r\n    }\r\n}\r\nfunction getNoteText(noteNameType, index, pitch, layoutLength) {\r\n    try {\r\n\t\tconst layout = layoutData[layoutLength]\r\n        if (noteNameType === \"Note name\") return keyNames[appName][pitchArr.indexOf(pitch)][index]\r\n        if (noteNameType === \"Keyboard layout\") return layout.keyboardLayout[index]\r\n        if (noteNameType === \"Do Re Mi\") return layout.mobileLayout[index]\r\n\t\tif (noteNameType === \"ABC\") return layout.abcLayout[index]\r\n    } catch (e) { }\r\n    return ''\r\n}\r\n\r\nfunction NotesTable(length){\r\n\treturn new Array(length).fill().map(() => {return []})\r\n}\r\n\r\nfunction ComposerSongDeSerialization(song) {\r\n\tconst bpm = Number(song.bpm)\r\n\tconst obj = {\r\n\t\tdata: song.data,\r\n\t\tname: song.name,\r\n\t\tbpm: isNaN(bpm) ? 220 : bpm,\r\n\t\tpitch: song.pitch ?? \"C\",\r\n\t\tinstruments: song.instruments || [instruments[0], instruments[0], instruments[0]],\r\n\t\tbreakpoints: song.breakpoints ?? [],\r\n\t\tnotes: [],\r\n\t\tselected: 0,\r\n\t\tcolumns: []\r\n\t}\r\n\tsong.columns.forEach(column => {\r\n\t\tconst columnObj = new Column()\r\n\t\tcolumnObj.tempoChanger = column[0]\r\n\t\tcolumn[1].forEach(note => {\r\n\t\t\tcolumnObj.notes.push(new ColumnNote(note[0], note[1]))\r\n\t\t})\r\n\t\tobj.columns.push(columnObj)\r\n\t})\r\n\treturn obj\r\n}\r\n\r\nfunction ComposerToRecording(song) {\r\n\tconst recordedSong = new Song(song.name)\r\n\tconst bpmPerMs = Math.floor(60000 / song.bpm)\r\n\tlet totalTime = 100\r\n\tsong.columns.forEach(column => {\r\n\t\tcolumn[1].forEach(note => {\r\n\t\t\trecordedSong.notes.push([note[0], totalTime])\r\n\t\t})\r\n\t\ttotalTime += Math.floor(bpmPerMs * TempoChangers[column[0]].changer)\r\n\t})\r\n\treturn recordedSong\r\n}\r\n\r\nfunction ComposerSongSerialization(song) {\r\n\tconst bpm = Number(song.bpm)\r\n\tconst obj = {\r\n\t\tdata: song.data,\r\n\t\tname: song.name,\r\n\t\tbpm: isNaN(bpm) ? 220 : bpm,\r\n\t\tpitch: song.pitch,\r\n\t\tbreakpoints: song.breakpoints,\r\n\t\tinstruments: song.instruments,\r\n\t\tcolumns: []\r\n\t}\r\n\tobj.data.appName = appName\r\n\t/*\r\n\t\tnotes = [tempoChanger,notes] ----> note = [index,layer]\r\n\t\ttempoChanger = Number\r\n\t*/\r\n\tsong.columns.forEach(column => {\r\n\t\tlet columnArr = [column.tempoChanger]\r\n\t\tlet notes = column.notes.map(note => {\r\n\t\t\treturn [note.index, note.layer]\r\n\t\t})\r\n\t\tcolumnArr[1] = notes\r\n\t\tobj.columns.push(columnArr)\r\n\t})\r\n\treturn obj\r\n}\r\n\r\nfunction prepareSongDownload(song) {\r\n\tlet finalSong = JSON.parse(JSON.stringify(song)) //lose reference\r\n\tlet oldFormatNotes = {}\r\n\tif (finalSong.data?.isComposedVersion) {\r\n\t\toldFormatNotes = composedToOldFormat(finalSong)\r\n\t} else {\r\n\t\toldFormatNotes = recordedToOldFormat(finalSong)\r\n\t}\r\n\tfinalSong.isComposed = finalSong.data.isComposedVersion\r\n\tfinalSong.pitchLevel = pitchArr.indexOf(finalSong.pitch)\r\n\tfinalSong.songNotes = oldFormatNotes\r\n\tfinalSong.bitsPerPage = 16\r\n\tfinalSong.isEncrypted = false\r\n\treturn [finalSong] //for compatibility, add back to an array, it will be ignored when importing\r\n}\r\n\r\nfunction prepareSongImport(song) {\r\n\tif (Array.isArray(song) && song.length > 0) song = song[0]\r\n\tlet type = getSongType(song)\r\n\tif (type === \"none\") {\r\n\t\tnew LoggerEvent(\"Error\", \"Invalid song\").trigger()\r\n\t\tthrow new Error(\"Error Invalid song\")\r\n\t}\r\n\tif (type === \"oldSky\") {\r\n\t\tsong = oldSkyToNewFormat(song)\r\n\t}\r\n\tif (appName === 'Sky' && song.data?.appName !== 'Sky') {\r\n\t\tnew LoggerEvent(\"Error\", \"Invalid song\").trigger()\r\n\t\tthrow new Error(\"Error Invalid song\")\r\n\t}\r\n\tif (appName === 'Genshin' && song.data?.appName === 'Sky') {\r\n\t\tsong = newSkyFormatToGenshin(song)\r\n\t}\r\n\treturn song\r\n}\r\n\r\nfunction composedToOldFormat(song) {\r\n\tlet convertedNotes = []\r\n\tlet bpmPerMs = Math.floor(60000 / song.bpm)\r\n\tlet totalTime = 100\r\n\tsong.columns.forEach(column => {\r\n\t\tcolumn[1].forEach(note => {\r\n\t\t\tlet layer = 1\r\n\t\t\tif (note[1] === '111') layer = 3\r\n\t\t\tif (note[1] === '011') layer = 2\r\n\t\t\tif (note[1] === '101') layer = 3\r\n\t\t\tif (note[1] === '001') layer = 2\r\n\t\t\tif (note[1] === '110') layer = 3\r\n\t\t\tif (note[1] === '010') layer = 2\r\n\t\t\tif (note[1] === '100') layer = 1\r\n\t\t\tlet noteObj = {\r\n\t\t\t\tkey: (layer > 2 ? 2 : layer) + 'Key' + note[0],\r\n\t\t\t\ttime: totalTime\r\n\t\t\t}\r\n\t\t\tif (layer > 2) noteObj.l = 3\r\n\t\t\tconvertedNotes.push(noteObj)\r\n\t\t})\r\n\t\ttotalTime += Math.floor(bpmPerMs * TempoChangers[column[0]].changer)\r\n\t})\r\n\treturn convertedNotes\r\n}\r\n\r\nfunction recordedToOldFormat(song) {\r\n\tlet convertedNotes = []\r\n\tsong.notes.forEach(note => {\r\n\t\tconvertedNotes.push({\r\n\t\t\ttime: note[1],\r\n\t\t\tkey: \"1Key\" + note[0]\r\n\t\t})\r\n\t})\r\n\treturn convertedNotes\r\n}\r\n\r\nfunction getSongType(song) {\r\n\ttry {\r\n\t\tif (song.data === undefined) {\r\n\t\t\t//oldSky format\r\n\t\t\tsong.pitchLevel = song.pitchLevel || 0\r\n\t\t\tif (song.songNotes !== undefined) {\r\n\t\t\t\treturn \"oldSky\"\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t//current format\r\n\t\t\tif (song.data.isComposedVersion) {\r\n\t\t\t\tif (typeof song.name !== \"string\") return \"none\"\r\n\t\t\t\tif (typeof song.bpm !== \"number\") return \"none\"\r\n\t\t\t\tif (!pitchArr.includes(song.pitch)) return \"none\"\r\n\t\t\t\tif (Array.isArray(song.breakpoints)) {\r\n\t\t\t\t\tif (song.breakpoints.length > 0) {\r\n\t\t\t\t\t\tif (typeof song.breakpoints[0] !== \"number\") return \"none\"\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn \"none\"\r\n\t\t\t\t}\r\n\t\t\t\tif (Array.isArray(song.columns)) {\r\n\t\t\t\t\tif (song.columns.length > 0) {\r\n\t\t\t\t\t\tlet column = song.columns[0]\r\n\t\t\t\t\t\tif (typeof column[0] !== \"number\") return \"none\"\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn \"none\"\r\n\t\t\t\t}\r\n\t\t\t\treturn \"newComposed\"\r\n\t\t\t} else {\r\n\t\t\t\tif (typeof song.name !== \"string\") return \"none\"\r\n\t\t\t\tif (typeof song.bpm !== \"number\") return \"none\"\r\n\t\t\t\tif (!pitchArr.includes(song.pitch)) return \"none\"\r\n\t\t\t\treturn \"newRecorded\"\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t} catch (e) {\r\n\t\tconsole.log(e)\r\n\t\treturn \"none\"\r\n\t}\r\n\treturn \"none\"\r\n}\r\n\r\nconst genshinLayout = importNotePositions\r\n\r\nfunction newSkyFormatToGenshin(song) {\r\n\tif (song.data.isComposedVersion) {\r\n\t\tsong.instruments = song.instruments.map(instrument => 'Lyre')\r\n\t\tsong.columns.forEach(column => {\r\n\t\t\tcolumn[1] = column[1].map(note => {\r\n\t\t\t\treturn [genshinLayout[note[0]], note[1]]\r\n\t\t\t})\r\n\r\n\t\t})\r\n\t}\r\n\tif (!song.data.isComposedVersion) {\r\n\t\tsong.notes = song.notes.map(note => {\r\n\t\t\tnote[0] = genshinLayout[note[0]]\r\n\t\t\treturn note\r\n\t\t})\r\n\t}\r\n\treturn song\r\n}\r\n\r\nfunction oldSkyToNewFormat(song) {\r\n\tlet result = new Song(\"Error\")\r\n\ttry {\r\n\t\tconst bpm = Number(song.bpm)\r\n\t\tresult = new Song(song.name)\r\n\t\tresult.bpm = isNaN(bpm) ? 220 : bpm\r\n\t\tresult.pitch = (pitchArr[song.pitchLevel || 0]) || \"C\"\r\n\t\t//remove duplicate notes\r\n\t\tsong.songNotes = song.songNotes.filter((note, index, self) =>\r\n\t\t\tindex === self.findIndex((n) => {\r\n\t\t\t\treturn n.key.split('Key')[1] === note.key.split('Key')[1] && n.time === note.time\r\n\t\t\t})\r\n\t\t)\r\n\t\tlet songNotes = song.songNotes\r\n\t\tsongNotes.forEach(note => {\r\n\t\t\tlet data = note.key.split(\"Key\")\r\n\t\t\tresult.notes.push([genshinLayout[data[1]], note.time, note.l ?? Number(data[0])])\r\n\t\t})\r\n\r\n\t\tif ([true, \"true\"].includes(song.isComposed)) {\r\n\t\t\tresult = ComposerSongSerialization(RecordingToComposed(result))\r\n\t\t} else {\r\n\t\t\tresult.notes = result.notes.map(e => [e[0], e[1]])\r\n\t\t}\r\n\r\n\r\n\t} catch (e) {\r\n\t\tconsole.log(e)\r\n\t\treturn new Song(\"Error importing song, invalid format\")\r\n\t}\r\n\treturn result\r\n}\r\n\r\nfunction RecordingToComposed(song,precision = 4) {\r\n\tlet bpmToMs = Math.floor(60000 / song.bpm)\r\n\tlet composed = new ComposedSong(song.name, [])\r\n\tcomposed.bpm = song.bpm\r\n\tcomposed.pitch = song.pitch\r\n\tlet notes = song.notes\r\n\t//remove duplicates\r\n\tlet converted = []\r\n\tif(precision === 1 ){\r\n        let groupedNotes = []\r\n\t\tlet previousTime = notes[0][1]\r\n        while (notes.length > 0) {\r\n            let row = [notes.shift()]\r\n            let amount = 0\r\n            for (let i = 0; i < notes.length; i++) {\r\n                if (row[0][1] > notes[i][1] - bpmToMs / 9) amount++\r\n            }\r\n            groupedNotes.push([...row, ...notes.splice(0, amount)])\r\n        }\r\n        let columns = []\r\n        groupedNotes.forEach(notes => {\r\n            let note = notes[0]\r\n            if (!note) return\r\n            let elapsedTime = note[1] - previousTime\r\n            previousTime = note[1]\r\n            let emptyColumns = Math.floor((elapsedTime - bpmToMs) / bpmToMs)\r\n            if (emptyColumns > -1) new Array(emptyColumns).fill(0).forEach(() => columns.push(new Column())) // adds empty columns\r\n            let noteColumn = new Column()\r\n            noteColumn.notes = notes.map(note => {\r\n                return new ColumnNote(note[0], numberToLayer(note[2] || 0))\r\n            })\r\n            columns.push(noteColumn)\r\n        })\r\n        columns.forEach(column => { //merges notes of different layer\r\n            let groupedNotes = groupByIndex(column)\r\n            column.notes = groupedNotes.map(group => {\r\n                group[0].layer = mergeLayers(group)\r\n                return group[0]\r\n            })\r\n        })\r\n\t\tconverted = columns\r\n\t}else{\r\n\t\tlet grouped = groupByNotes(notes, bpmToMs / 9)\r\n\t\tlet combinations = [bpmToMs, Math.floor(bpmToMs / 2), Math.floor(bpmToMs / 4), Math.floor(bpmToMs / 8)]\r\n\t\tfor (let i = 0; i < grouped.length; i++) {\r\n\t\t\tlet column = new Column()\r\n\t\t\tcolumn.notes = grouped[i].map(note => {\r\n\t\t\t\tlet columnNote = new ColumnNote(note[0])\r\n\t\t\t\tif (note[2] === 0) columnNote.layer = \"100\"\r\n\t\t\t\tif (note[2] === 1) columnNote.layer = \"100\"\r\n\t\t\t\tif (note[2] === 2) columnNote.layer = \"010\"\r\n\t\t\t\tif (note[2] === 3) columnNote.layer = \"110\"\r\n\t\t\t\tif (note[2] === undefined) columnNote.layer = \"100\"\r\n\t\t\t\treturn columnNote\r\n\t\t\t})\r\n\t\t\tlet next = grouped[i + 1] || [[0, 0, 0]]\r\n\t\t\tlet difference = next[0][1] - grouped[i][0][1]\r\n\t\t\tlet paddingColumns = []\r\n\t\t\twhile (difference >= combinations[3]) {\r\n\t\t\t\tif (difference / combinations[0] >= 1) {\r\n\t\t\t\t\tdifference -= combinations[0]\r\n\t\t\t\t\tpaddingColumns.push(0)\r\n\t\t\t\t} else if (difference / combinations[1] >= 1 ) {\r\n\t\t\t\t\tdifference -= combinations[1]\r\n\t\t\t\t\tif(precision <= 1) continue\r\n\t\t\t\t\tpaddingColumns.push(1)\t\r\n\t\t\t\t} else if (difference / combinations[2] >= 1) {\r\n\t\t\t\t\tdifference -= combinations[2]\r\n\t\t\t\t\tif(precision <= 2) continue\r\n\t\t\t\t\tpaddingColumns.push(2)\r\n\t\t\t\t} else if (difference / combinations[3] >= 1) {\r\n\t\t\t\t\tdifference -= combinations[3]\r\n\t\t\t\t\tif(precision <= 3) continue\r\n\t\t\t\t\tpaddingColumns.push(3)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tlet finalPadding = []\r\n\t\t\tcolumn.tempoChanger = paddingColumns.shift() || 0\r\n\t\t\tpaddingColumns = paddingColumns.forEach((col, i) => {\r\n\t\t\t\tlet column = new Column()\r\n\t\t\t\tcolumn.tempoChanger = col\r\n\t\t\t\tfinalPadding.push(column)\r\n\t\t\t})\r\n\t\t\tconverted.push(column, ...finalPadding)\r\n\t\t}\r\n\t}\r\n\tcomposed.columns = converted\r\n\treturn composed\r\n}\r\n\r\nclass Column {\r\n\tconstructor() {\r\n\t\tthis.notes = []\r\n\t\tthis.tempoChanger = 0\r\n\r\n\t}\r\n}\r\n\r\nfunction groupByNotes(notes, threshold) {\r\n\tlet result = []\r\n\twhile (notes.length > 0) {\r\n\t\tlet row = [notes.shift()]\r\n\t\tlet amount = 0\r\n\t\tfor (let i = 0; i < notes.length; i++) {\r\n\t\t\tif (row[0][1] > notes[i][1] - threshold) amount++\r\n\t\t}\r\n\t\tresult.push([...row, ...notes.splice(0, amount)])\r\n\t}\r\n\treturn result\r\n}\r\n\r\nclass ColumnNote {\r\n\tconstructor(index, layer = \"000\") {\r\n\t\tthis.index = index\r\n\t\tthis.layer = layer\r\n\t}\r\n}\r\n\r\nfunction getPitchChanger(pitch) {\r\n\tlet index = pitchArr.indexOf(pitch)\r\n\tif (index < 0) index = 0\r\n\treturn Number(Math.pow(2, index / 12).toFixed(4))\r\n}\r\n\r\nfunction numberToLayer(number) {\r\n\tlet layer = \"100\"\r\n\tif (number === 0) layer = \"100\"\r\n\tif (number === 1) layer = \"010\"\r\n\tif (number === 2) layer = \"001\"\r\n\treturn layer\r\n}\r\n\r\nfunction mergeLayers(notes) {\r\n\tlet final = \"000\".split(\"\")\r\n\tnotes.forEach(notes => {\r\n\t\tnotes.layer.split(\"\").forEach((e, i) => {\r\n\t\t\tif (e === \"1\") final[i] = \"1\"\r\n\t\t})\r\n\t})\r\n\treturn final.join(\"\")\r\n}\r\n\r\nfunction groupByIndex(column) {\r\n\tlet notes = []\r\n\tcolumn.notes.forEach(note => {\r\n\t\tif (notes[note.index]) {\r\n\t\t\tnotes[note.index].push(note)\r\n\t\t} else {\r\n\t\t\tnotes[note.index] = [note]\r\n\t\t}\r\n\t})\r\n\treturn notes.filter(e => Array.isArray(e))\r\n}\r\n\r\nfunction delayMs(ms) {\r\n    return new Promise(resolve => {\r\n        workerTimers.setTimeout(resolve, ms)\r\n    })\r\n}\r\n\r\nexport {\r\n\tRecording,\r\n\tSong,\r\n\tNoteData,\r\n\tFileDownloader,\r\n\tLoggerEvent,\r\n\tPlayingSong,\r\n\tComposedSong,\r\n\tColumnNote,\r\n\tColumn,\r\n\tTempoChangers,\r\n\tComposerSongSerialization,\r\n\tComposerSongDeSerialization,\r\n\tComposerToRecording,\r\n\tgetPitchChanger,\r\n\tgetSongType,\r\n\toldSkyToNewFormat,\r\n\tRecordingToComposed,\r\n\tprepareSongDownload,\r\n\tnewSkyFormatToGenshin,\r\n\tprepareSongImport,\r\n\tpitchArr,\r\n\tgroupByNotes,\r\n\tnumberToLayer,\r\n\tmergeLayers,\r\n\tgroupByIndex,\r\n\tdelayMs,\r\n\tNotesTable,\r\n\tMIDINote,\r\n\tgetNoteText,\r\n\tMIDIShortcut\r\n}","import { isMobile } from \"is-mobile\"\r\nimport { instruments, appName } from \"appConfig\"\r\nimport { MIDINote,MIDIShortcut } from \"./Utils\"\r\nexport const ComposerSettings = {\r\n    settingVesion: appName + 19,\r\n    instrument: {\r\n        name: \"Instrument (Layer 1)\",\r\n        type: \"instrument\",\r\n        songSetting: false,\r\n        value: instruments[0],\r\n        volume: 100,\r\n        options: instruments\r\n    },\r\n    layer2: {\r\n        name: \"Instrument (Layer 2)\",\r\n        type: \"instrument\",\r\n        songSetting: false,\r\n        value: instruments[0],\r\n        volume: 100,\r\n        options: instruments\r\n    },\r\n    layer3: {\r\n        name: \"Instrument (Layer 3)\",\r\n        type: \"instrument\",\r\n        songSetting: false,\r\n        value: instruments[0],\r\n        volume: 100,\r\n        options: instruments\r\n    },\r\n    bpm: {\r\n        name: \"Bpm\",\r\n        type: \"number\",\r\n        songSetting: true,\r\n        threshold: [0, 1600],\r\n        value: 220\r\n    },\r\n    beatMarks: {\r\n        name: \"Beat marks\",\r\n        type: \"select\",\r\n        songSetting: false,\r\n        value: 3,\r\n        options: [\r\n            3,\r\n            4\r\n        ]\r\n    },\r\n    noteNameType: {\r\n        name: \"Note name type\",\r\n        type: \"select\",\r\n        songSetting: false,\r\n        value: appName === \"Genshin\"\r\n            ? isMobile()\r\n                ? \"Do Re Mi\"\r\n                : \"Keyboard layout\"\r\n            : \"Note name\",\r\n        options: appName === \"Genshin\"\r\n            ? [\r\n                \"Note name\",\r\n                \"Keyboard layout\",\r\n                \"Do Re Mi\",\r\n                \"ABC\"\r\n            ]\r\n            : [\r\n                \"Note name\",\r\n                \"Keyboard layout\",\r\n                \"ABC\"\r\n            ]\r\n    },\r\n    pitch: {\r\n        name: \"Pitch\",\r\n        type: \"select\",\r\n        songSetting: true,\r\n        value: \"C\",\r\n        options: [\r\n            \"C\",\r\n            \"Db\",\r\n            \"D\",\r\n            \"Eb\",\r\n            \"E\",\r\n            \"F\",\r\n            \"Gb\",\r\n            \"G\",\r\n            \"Ab\",\r\n            \"A\",\r\n            \"Bb\",\r\n            \"B\",\r\n        ]\r\n    },\r\n    columnsPerCanvas: {\r\n        name: \"Number of visible columns\",\r\n        type: \"select\",\r\n        songSetting: false,\r\n        value: 35,\r\n        options: [\r\n            20,\r\n            25,\r\n            30,\r\n            35,\r\n            40,\r\n            45,\r\n            50\r\n        ]\r\n    },\r\n    caveMode: {\r\n        name: \"Reverb (cave mode)\",\r\n        type: \"checkbox\",\r\n        songSetting: false,\r\n        value: false,\r\n    },\r\n    autosave: {\r\n        name: \"Autosave changes\",\r\n        type: \"checkbox\",\r\n        songSetting: false,\r\n        value: false,\r\n    },\r\n    backgroundImage: {\r\n        name: \"Background image (url)\",\r\n        type: \"text\",\r\n        songSetting: false,\r\n        value: \"\",\r\n        placeholder: \"Write here\"\r\n    },\r\n    syncTabs: {\r\n        name: \"Autoplay in all tabs (pc only)\",\r\n        type: \"checkbox\",\r\n        songSetting: false,\r\n        value: false\r\n    }\r\n}\r\n\r\nexport const MainPageSettings = {\r\n    settingVesion: appName + 19,\r\n    instrument: {\r\n        name: \"Instrument\",\r\n        type: \"instrument\",\r\n        songSetting: false,\r\n        value: instruments[0],\r\n        volume: 100,\r\n        options: instruments\r\n    },\r\n    pitch: {\r\n        name: \"Pitch\",\r\n        type: \"select\",\r\n        songSetting: true,\r\n        value: \"C\",\r\n        options: [\r\n            \"C\",\r\n            \"Db\",\r\n            \"D\",\r\n            \"Eb\",\r\n            \"E\",\r\n            \"F\",\r\n            \"Gb\",\r\n            \"G\",\r\n            \"Ab\",\r\n            \"A\",\r\n            \"Bb\",\r\n            \"B\",\r\n        ]\r\n    },\r\n    caveMode: {\r\n        name: \"Reverb (cave mode)\",\r\n        type: \"checkbox\",\r\n        songSetting: false,\r\n        value: false,\r\n    },\r\n    keyboardSize: {\r\n        name: \"Keyboard size\",\r\n        type: \"number\",\r\n        songSetting: false,\r\n        value: 100,\r\n        threshold: [0, 200]\r\n    },\r\n    noteNameType: {\r\n        name: \"Note name type\",\r\n        type: \"select\",\r\n        songSetting: false,\r\n        value: appName === \"Genshin\"\r\n            ? isMobile()\r\n                ? \"Do Re Mi\"\r\n                : \"Keyboard layout\"\r\n            : \"Note name\",\r\n\r\n        options: appName === \"Genshin\"\r\n            ? [\r\n                \"Note name\",\r\n                \"Keyboard layout\",\r\n                \"Do Re Mi\",\r\n                \"ABC\"\r\n            ]\r\n            : [\r\n                \"Note name\",\r\n                \"Keyboard layout\",\r\n                \"ABC\"\r\n            ]\r\n    },\r\n    approachSpeed: {\r\n        name: \"Approach Rate (AR)\",\r\n        type: \"number\",\r\n        songSetting: false,\r\n        value: 1500,\r\n        threshold: [0, 5000]\r\n    },\r\n    backgroundImage: {\r\n        name: \"Background image (url)\",\r\n        type: \"text\",\r\n        songSetting: false,\r\n        value: \"\",\r\n        placeholder: \"Write here\"\r\n    },\r\n    noteAnimation: {\r\n        name: \"Note animation\",\r\n        type: \"checkbox\",\r\n        songSetting: false,\r\n        value: false\r\n    }\r\n}\r\nexport const MIDISettings = {\r\n    settingVesion: appName + 4,\r\n    enabled: false,\r\n    currentSource: '',\r\n    notes: new Array(appName === 'Genshin' ? 21 : 15).fill(0).map((e,i) => new MIDINote(i,-1)),\r\n    shortcuts: [\r\n        new MIDIShortcut('toggle_play',-1),\r\n        new MIDIShortcut('next_column',-1),\r\n        new MIDIShortcut('previous_column',-1),\r\n        new MIDIShortcut('add_column',-1),\r\n        new MIDIShortcut('remove_column',-1),\r\n        new MIDIShortcut('change_layer',-1)\r\n    ]\r\n}\r\n\r\nexport function getMIDISettings(){\r\n    let settings = localStorage.getItem(appName + '_MIDI_Settings')\r\n    try {\r\n        settings = JSON.parse(settings)\r\n    } catch (e) {\r\n        settings = null\r\n    }\r\n    if (settings !== null) {\r\n        if (settings.settingVesion !== MIDISettings.settingVesion) {\r\n            return MIDISettings\r\n        }\r\n    } else {\r\n        return MIDISettings\r\n    }\r\n    return settings\r\n}\r\n","import { memo } from 'react'\r\n\r\nexport default memo(({children}) => {\r\n    return <>\r\n        {children}\r\n    </>\r\n},(prev,next) => {\r\n    if(next.children.key !== null || prev.children.key !== null) return prev.children.key === next.children.key\r\n    return prev.children !== undefined \r\n})","import { speedChangers } from \"appConfig\"\r\nimport Memoized from \"components/Memoized\";\r\nimport { FaSyncAlt, FaStop } from \"react-icons/fa\";\r\nimport { memo } from \"react\";\r\n\r\nexport default memo(function TopPage({eventType,stop,restart,sliderState, handleSliderEvent,handleSpeedChanger,speedChanger,approachingScore }) {\r\n    return <div className=\"upper-right\">\r\n        {eventType === 'approaching' &&\r\n            <Score data={approachingScore} />\r\n        }\r\n        <div className=\"slider-wrapper\">\r\n            <button className=\"song-button\" onClick={stop}>\r\n                <Memoized>\r\n                    <FaStop />\r\n                </Memoized>\r\n            </button>\r\n            <input\r\n                type=\"range\"\r\n                className=\"slider\"\r\n                min={0}\r\n                onChange={handleSliderEvent}\r\n                max={sliderState.size}\r\n                value={sliderState.position}\r\n            ></input>\r\n            <button className=\"song-button\" onClick={restart}>\r\n                <Memoized>\r\n                    <FaSyncAlt />\r\n                </Memoized>\r\n            </button>\r\n            <select\r\n                className='slider-select'\r\n                onChange={handleSpeedChanger}\r\n                value={speedChanger.name}\r\n            >\r\n                <option disabled>Speed</option>\r\n                {speedChangers.map(e => {\r\n                    return <option value={e.name} key={e.name}>\r\n                        {e.name}\r\n                    </option>\r\n                })}\r\n            </select>\r\n        </div>\r\n    </div>\r\n},(prev,next) => {\r\n    return prev.eventType === next.eventType && prev.speedChanger === next.speedChanger \r\n        && prev.approachingScore === next.approachingScore && prev.sliderState === next.sliderState\r\n})\r\n\r\n\r\nfunction Score(props) {\r\n    const { combo, score, correct, wrong } = props.data\r\n    return <div className='approaching-accuracy'>\r\n        <table>\r\n            <tbody>\r\n                <tr>\r\n                    <td className='sc-2'>Accuracy</td>\r\n                    <td className='sc-1'>{(correct / (correct + wrong - 1) * 100).toFixed(1)}%</td>\r\n                </tr>\r\n                <tr>\r\n                    <td className='sc-2'>Score</td>\r\n                    <td className='sc-1'>{score}</td>\r\n                </tr>\r\n                <tr>\r\n                    <td className='sc-2'>Combo</td>\r\n                    <td className='sc-1'>{combo}</td>\r\n                </tr>\r\n            </tbody>\r\n        </table>\r\n    </div>\r\n}","const GA = window?.gtag\r\nasync function callGA(fn) {\r\n    try {\r\n        return {\r\n            data: await fn()\r\n        }\r\n    } catch (e) {\r\n        if (GA) console.log('Error with GA')\r\n        return { error: e }\r\n    }\r\n}\r\n\r\nfunction event(action, params) {\r\n    return callGA(() => GA('event', action, params))\r\n}\r\n\r\nfunction userSongs(params, type) {\r\n    return event('songs_' + type, params)\r\n}\r\n\r\nfunction songSearch(params) {\r\n    return event('song_search', params)\r\n}\r\n\r\nfunction UIEvent(type, params) {\r\n    return event('UI_' + type, params)\r\n}\r\n\r\nfunction songEvent(params) {\r\n    return event('song_event', params)\r\n}\r\n\r\nfunction pageView(page) {\r\n    return event('page_view', page)\r\n}\r\n\r\nconst Analytics = {\r\n    pageView,\r\n    event,\r\n    songEvent,\r\n    userSongs,\r\n    songSearch,\r\n    UIEvent\r\n}\r\nexport default Analytics","import React, { Component } from 'react'\r\nimport { observe } from 'mobx'\r\nimport { layoutImages, appName, speedChangers, MIDI_STATUS } from \"appConfig\"\r\nimport Note from './Components/Note'\r\nimport { songStore } from './SongStore'\r\nimport { delayMs, ComposerToRecording, NotesTable, getNoteText, LoggerEvent } from \"lib/Utils\"\r\nimport \"./Keyboard.css\"\r\nimport { getMIDISettings } from 'lib/SettingsObj'\r\nimport TopPage from './Components/TopPage'\r\nimport Analytics from 'lib/Analytics';\r\n\r\nexport default class Keyboard extends Component {\r\n    constructor(props) {\r\n        super(props)\r\n        const propKeyboard = this.props.data.keyboard\r\n        propKeyboard.layout.forEach(note => { note.status = '' })\r\n        this.state = {\r\n            playTimestamp: new Date().getTime(),\r\n            songToPractice: [],\r\n            approachingNotes: NotesTable(appName === 'Sky' ? 15 : 21),\r\n            outgoingAnimation: NotesTable(appName === 'Sky' ? 15 : 21),\r\n            keyboard: propKeyboard.layout,\r\n            sliderState: {\r\n                position: 0,\r\n                size: 0\r\n            },\r\n            approachingScore: {\r\n                correct: 1,\r\n                wrong: 1,\r\n                score: 0,\r\n                combo: 0\r\n            },\r\n            speedChanger: speedChangers.find(e => e.name === 'x1'),\r\n        }\r\n        this.MIDISettings = getMIDISettings()\r\n        this.approachRate = 1500\r\n        this.approachingNotesList = []\r\n        this.songTimestamp = 0\r\n        this.nextChunkDelay = 0\r\n        this.disposeStore = () => { }\r\n        this.tickTime = 50\r\n        this.tickInterval = 0\r\n        this.mounted = true\r\n    }\r\n\r\n    componentDidMount() {\r\n        window.addEventListener('keydown', this.handleKeyboard)\r\n        this.tickInterval = setInterval(this.tick, this.tickTime)\r\n        this.disposeStore = observe(songStore, async (data) => {\r\n            let value = data.object.data\r\n            let type = value.eventType\r\n            let lostReference = JSON.parse(JSON.stringify(value.song))\r\n            if (lostReference.data?.isComposedVersion) {\r\n                lostReference = ComposerToRecording(lostReference)\r\n            }\r\n            lostReference.timestamp = new Date().getTime()\r\n            let hasSong = false\r\n            if (type === 'play') {\r\n                await this.stopSong()\r\n                this.playSong(lostReference, value.start)\r\n                hasSong = true\r\n            }\r\n            if (type === 'practice') {\r\n                await this.stopSong()\r\n                this.practiceSong(lostReference, value.start)\r\n                hasSong = true\r\n            }\r\n            if (type === 'approaching') {\r\n                await this.stopSong()\r\n                this.approachingSong(lostReference, value.start)\r\n                hasSong = true\r\n            }\r\n            if (type === 'stop') await this.stopSong()\r\n            if (!this.mounted) return\r\n\r\n            this.props.functions.setHasSong(hasSong)\r\n            if(type !== 'stop') Analytics.songEvent({type})\r\n        })\r\n        if (this.MIDISettings.enabled) {\r\n            if (navigator.requestMIDIAccess) {\r\n                navigator.requestMIDIAccess().then(this.initMidi, () => {\r\n                    new LoggerEvent('Error', 'MIDI permission not accepted').trigger()\r\n                })\r\n            } else {\r\n                new LoggerEvent('Error', 'MIDI is not supported on this browser').trigger()\r\n            }\r\n        }\r\n    }\r\n    componentWillUnmount() {\r\n        window.removeEventListener('keydown', this.handleKeyboard)\r\n        this.disposeStore()\r\n        this.songTimestamp = 0\r\n        this.mounted = false\r\n        if (this.MidiAccess) this.MidiAccess.onstatechange = null\r\n        if (this.currentMidiSource) this.currentMidiSource.onmidimessage = null\r\n        clearInterval(this.tickInterval)\r\n    }\r\n    initMidi = (e) => {\r\n        e.onstatechange = () => this.initMidi(this.MidiAccess)\r\n        this.MidiAccess = e\r\n        const midiInputs = this.MidiAccess.inputs.values()\r\n        const inputs = []\r\n        for (let input = midiInputs.next(); input && !input.done; input = midiInputs.next()) {\r\n            inputs.push(input.value)\r\n        }\r\n        if (this.currentMidiSource) this.currentMidiSource.onmidimessage = null\r\n        this.currentMidiSource = inputs.find(input => {\r\n            return input.name + \" \" + input.manufacturer === this.MIDISettings.currentSource\r\n        })\r\n        if (this.currentMidiSource) this.currentMidiSource.onmidimessage = this.handleMidi\r\n    }\r\n    handleMidi = (e) => {\r\n        if (!this.mounted) return\r\n        const instrument = this.props.data.keyboard\r\n        const { data } = e\r\n        const [eventType, note, velocity] = data\r\n        if (MIDI_STATUS.down === eventType && velocity !== 0) {\r\n            const keyboardNotes = this.MIDISettings.notes.filter(e => e.midi === note)\r\n            keyboardNotes.forEach(keyboardNote => {\r\n                this.handleClick(instrument.layout[keyboardNote.index])\r\n            })\r\n        }\r\n    }\r\n    approachingSong = async (song) => {\r\n        let notes = []\r\n        this.approachRate = this.props.data.approachRate || 1500\r\n        let startDelay = this.approachRate\r\n        song.notes.forEach(note => {\r\n            let obj = {\r\n                time: Math.floor(note[1] / this.state.speedChanger.value + startDelay),\r\n                index: note[0]\r\n            }\r\n            notes.push(obj)\r\n        })\r\n        this.setState({\r\n            approachingNotes: NotesTable(appName === 'Sky' ? 15 : 21),\r\n            approachingScore: {\r\n                correct: 1,\r\n                wrong: 1,\r\n                score: 0,\r\n                combo: 0\r\n            }\r\n        })\r\n        this.changeSliderState(0, notes.length)\r\n        this.approachingNotesList = notes\r\n    }\r\n\r\n    tick = () => {\r\n        if (!this.props.data.hasSong) return\r\n        const { approachingNotes, sliderState, approachingScore, speedChanger } = this.state\r\n        let stateNotes = approachingNotes\r\n        let notes = this.approachingNotesList\r\n        notes.forEach(note => {\r\n            note.time -= this.tickTime\r\n        })\r\n        let hasChanges = false\r\n        let removed = 0\r\n        for (let i = 0; i < notes.length; i++) {\r\n            if (notes[i].time < this.approachRate) {\r\n                stateNotes[notes[i].index].push({\r\n                    clicked: false,\r\n                    time: this.approachRate,\r\n                    id: Math.floor(Math.random() * 10000)\r\n                })\r\n                notes.splice(i, 1)\r\n                i--\r\n                hasChanges = true\r\n            } else {\r\n                break\r\n            }\r\n        }\r\n        stateNotes.forEach(note => {\r\n            for (let i = 0; i < note.length; i++) {\r\n                let apNote = note[i]\r\n                apNote.time -= this.tickTime\r\n                if (apNote.clicked) {\r\n                    if (apNote.time < this.approachRate / 3) {\r\n                        approachingScore.correct++\r\n                        approachingScore.combo++\r\n                        approachingScore.score += approachingScore.combo * speedChanger.value\r\n                    } else {\r\n                        approachingScore.wrong++\r\n                        approachingScore.combo = 0\r\n                    }\r\n                    apNote.time = -1 //so that it can be removed after\r\n                }\r\n                if (apNote.time < 0) {\r\n                    if (!apNote.clicked) {\r\n                        approachingScore.wrong++\r\n                        approachingScore.combo = 0\r\n                    }\r\n                    note.splice(i, 1)\r\n                    i--\r\n                    hasChanges = true\r\n                    removed++\r\n                }\r\n            }\r\n        })\r\n        if (!hasChanges) return\r\n        this.changeSliderState(sliderState.position + removed)\r\n        this.setState({\r\n            approachingNotes: stateNotes.map(arr => arr.slice()), //removes ref\r\n            approachingScore: approachingScore\r\n        })\r\n    }\r\n\r\n    playSong = async (song, start = 0) => {\r\n        this.songTimestamp = song.timestamp\r\n        const { keyboard } = this.state\r\n        let notes = this.applySpeedChange(song.notes)\r\n        if (notes.length === 0) return\r\n        let previous = notes[0][1]\r\n        let pastError = 0\r\n        let previousTime = new Date().getTime()\r\n        for (let i = start; i < notes.length; i++) {\r\n            let delay = notes[i][1] - previous\r\n            previous = notes[i][1]\r\n            let note = notes[i][0]\r\n            previousTime = new Date().getTime()\r\n            if (delay > 16) await delayMs(delay - pastError)\r\n            if (!this.mounted) return\r\n            if (this.songTimestamp !== song.timestamp) return\r\n            keyboard[note].status = 'clicked'\r\n            this.handleClick(keyboard[note])\r\n            this.setState({\r\n                keyboard,\r\n                sliderState: {\r\n                    position: i + 1,\r\n                    size: notes.length\r\n                }\r\n            })\r\n            pastError = new Date().getTime() - previousTime - delay\r\n        }\r\n    }\r\n    applySpeedChange = (notes) => {\r\n        return notes.map(note => {\r\n            note[1] = note[1] / this.state.speedChanger.value\r\n            return note\r\n        })\r\n    }\r\n    practiceSong = (song, start = 0) => {\r\n        const { keyboard } = this.state\r\n        let notes = this.applySpeedChange(song.notes)\r\n        let songLength = notes.length\r\n        notes.splice(0, start)\r\n        let chunks = []\r\n        let previousChunkDelay = 0\r\n        for (let i = 0; notes.length > 0; i++) {\r\n            let chunk = {\r\n                notes: [notes.shift()],\r\n                delay: 0\r\n            }\r\n            let startTime = chunk.notes.length > 0 ? chunk.notes[0][1] : 0\r\n            for (let j = 0; j < notes.length && j < 20; j++) {\r\n                let difference = notes[j][1] - chunk.notes[0][1] - 50 //TODO add threshold here\r\n                if (difference < 0) {\r\n                    chunk.notes.push(notes.shift())\r\n                    j--\r\n                }\r\n            }\r\n            chunk.delay = previousChunkDelay\r\n            previousChunkDelay = notes.length > 0 ? notes[0][1] - startTime : 0\r\n            chunks.push(chunk)\r\n        }\r\n        if (chunks.length === 0) return\r\n        let firstChunk = chunks[0]\r\n        this.nextChunkDelay = 0\r\n        let secondChunk = chunks[1]\r\n        firstChunk.notes.forEach(note => {\r\n            keyboard[note[0]].status = 'toClick'\r\n            keyboard[note[0]].delay = appName === 'Genshin' ? 100 : 200\r\n        })\r\n        secondChunk?.notes.forEach(note => {\r\n            let keyboardNote = keyboard[note[0]]\r\n            if (keyboardNote.status === 'toClick') return keyboardNote.status = 'toClickAndNext'\r\n            keyboardNote.status = 'toClickNext'\r\n        })\r\n        this.props.functions.setHasSong(true)\r\n        this.setState({\r\n            songToPractice: chunks,\r\n            keyboard,\r\n            sliderState: {\r\n                position: start,\r\n                size: songLength\r\n            }\r\n        })\r\n    }\r\n    handleSpeedChanger = (e) => {\r\n        let changer = speedChangers.find(el => el.name === e.target.value)\r\n        this.setState({\r\n            speedChanger: changer\r\n        }, this.restartSong)\r\n    }\r\n    restartSong = async (override) => {\r\n        let lostReference = JSON.parse(JSON.stringify(songStore.data))\r\n        const { sliderState } = this.state\r\n        await this.stopSong()\r\n        if (!this.mounted) return\r\n        setTimeout(() => {\r\n            let start = songStore.data.start\r\n            if (songStore.data.eventType === 'practice') {\r\n                start = sliderState.position === sliderState.size ? 0 : sliderState.position\r\n            }\r\n            songStore.data = {\r\n                ...lostReference,\r\n                start: Number.isInteger(override) ? override : start\r\n            }\r\n        }, 200)\r\n    }\r\n    stopSong = () => {\r\n        return new Promise(res => {\r\n            this.songTimestamp = 0\r\n            const { keyboard } = this.state\r\n            keyboard.forEach(note => {\r\n                note.status = ''\r\n                note.delay = appName === 'Genshin' ? 100 : 200\r\n            })\r\n            this.approachingNotesList = []\r\n            this.setState({\r\n                keyboard,\r\n                songToPractice: [],\r\n                approachingNotes: NotesTable(appName === 'Sky' ? 15 : 21)\r\n            }, res)\r\n            this.props.functions.setHasSong(false)\r\n        })\r\n    }\r\n    stopAndClear = () => {\r\n        this.stopSong()\r\n        songStore.data = returnStopSong()\r\n    }\r\n    handleSliderEvent = (event) => {\r\n        this.changeSliderState(Number(event.target.value))\r\n    }\r\n    changeSliderState = async (position, size = this.state.sliderState.size) => {\r\n        this.setState({\r\n            sliderState: {\r\n                position,\r\n                size\r\n            }\r\n        })\r\n    }\r\n    handleKeyboard = async (event) => {\r\n        const { keyboard } = this.state\r\n        if (event.repeat) return\r\n        if (document.activeElement.tagName === \"INPUT\") return\r\n        if (event.shiftKey) {\r\n            switch (event.code) {\r\n                case \"KeyR\": {\r\n                    if (!this.props.data.hasSong) return\r\n                    if (['practice', 'play', 'approaching'].includes(songStore.data.eventType)) {\r\n                        return this.restartSong(0)\r\n                    }\r\n                    break;\r\n                }\r\n                case \"KeyS\": {\r\n                    if (!this.props.data.hasSong) return\r\n                    return this.stopAndClear()\r\n                }\r\n                default: break;\r\n            }\r\n        } else {\r\n            let code = event.code?.replace(\"Key\", \"\")\r\n            let index = this.props.data.keyboard.getNoteFromCode(code)\r\n            let note = keyboard[index]\r\n            if (note) this.handleClick(note)\r\n        }\r\n\r\n    }\r\n\r\n    handleApproachClick = (note) => {\r\n        const { approachingNotes } = this.state\r\n        let approachingNote = approachingNotes[note.index][0]\r\n        if (approachingNote) {\r\n            approachingNote.clicked = true\r\n            if (approachingNote.time < this.approachRate / 3) return \"approach-correct\"\r\n        }\r\n        return \"approach-wrong\"\r\n    }\r\n    handlePracticeClick = (note) => {\r\n        const { keyboard, songToPractice, sliderState } = this.state\r\n        if (songToPractice.length > 0) {\r\n            let indexClicked = songToPractice[0]?.notes.findIndex(e => e[0] === note.index)\r\n            if (indexClicked !== -1) {\r\n                songToPractice[0].notes.splice(indexClicked, 1)\r\n                if (songToPractice[0].notes.length === 0) songToPractice.shift()\r\n                if (songToPractice.length > 0) {\r\n                    let nextChunk = songToPractice[0]\r\n                    let nextNextChunk = songToPractice[1]\r\n                    nextChunk.notes.forEach(note => {\r\n                        keyboard[note[0]].status = 'toClick'\r\n                        keyboard[note[0]].delay = nextChunk.delay\r\n                    })\r\n                    if (nextNextChunk) {\r\n                        nextNextChunk?.notes.forEach(note => {\r\n                            let keyboardNote = keyboard[note[0]]\r\n                            if (keyboardNote.status === 'toClick') return keyboardNote.status = 'toClickAndNext'\r\n                            keyboardNote.status = 'toClickNext'\r\n                        })\r\n                    }\r\n                }\r\n                this.setState({\r\n                    songToPractice: songToPractice,\r\n                    sliderState: {\r\n                        size: sliderState.size,\r\n                        position: sliderState.position + 1\r\n                    }\r\n                })\r\n            }\r\n        }\r\n    }\r\n    handleClick = (note) => {\r\n        const { keyboard, outgoingAnimation, approachingScore } = this.state\r\n        const hasAnimation = this.props.data.hasAnimation\r\n        keyboard[note.index].status = 'clicked'\r\n        keyboard[note.index].delay = appName === 'Genshin' ? 100 : 200\r\n        this.handlePracticeClick(note)\r\n        const approachStatus = this.handleApproachClick(note)\r\n        if (songStore.data.eventType === 'approaching') {\r\n            keyboard[note.index].status = approachStatus\r\n            if(approachStatus === 'approach-wrong') approachingScore.combo = 0\r\n        }\r\n        if (hasAnimation && songStore.data.eventType !== 'approaching') {\r\n            let key = Math.floor(Math.random() * 10000) + new Date().getTime()\r\n            outgoingAnimation[note.index] = [...outgoingAnimation[note.index], { key }]\r\n        }\r\n        this.setState({\r\n            keyboard,\r\n            ...(songStore.data.eventType === 'approaching' ? approachingScore: {}),\r\n            ...(hasAnimation ? outgoingAnimation : {})\r\n        }, () => {\r\n            if (!hasAnimation || songStore.data.eventType === 'approaching') return\r\n            setTimeout(() => {\r\n                const { outgoingAnimation } = this.state\r\n                outgoingAnimation[note.index].shift()\r\n                outgoingAnimation[note.index] = [...outgoingAnimation[note.index]]\r\n                this.setState({ outgoingAnimation })\r\n            }, 750)\r\n        })\r\n        setTimeout(() => {\r\n            if (!['clicked', 'approach-wrong', 'approach-correct'].includes(keyboard[note.index].status)) return\r\n            keyboard[note.index].status = ''\r\n            this.setState({ keyboard })\r\n        }, appName === 'Sky' ? 200 : 100)\r\n        this.props.functions.playSound(note)\r\n    }\r\n    render() {\r\n        const { state, props } = this\r\n        const { data } = props\r\n        const { keyboard, approachingScore, speedChanger } = state\r\n        let size = data.keyboardSize / 100\r\n        if (size < 0.5) size = 0.5\r\n        if (size > 1.5) size = 1.5\r\n        let keyboardClass = \"keyboard\"\r\n        if (keyboard.length === 15) keyboardClass += \" keyboard-5\"\r\n        if (keyboard.length === 8) keyboardClass += \" keyboard-4\"\r\n        return <>\r\n            {data.hasSong && <TopPage\r\n                eventType={songStore.data.eventType}\r\n                stop={this.stopAndClear}\r\n                restart={this.restartSong}\r\n                handleSliderEvent={this.handleSliderEvent}\r\n                handleSpeedChanger={this.handleSpeedChanger}\r\n                sliderState={state.sliderState}\r\n                speedChanger={speedChanger}\r\n                approachingScore={approachingScore}\r\n            />}\r\n            <div\r\n                className={keyboardClass}\r\n                style={{\r\n                    transform: `scale(${size})`,\r\n                    marginBottom: size * 30 - 15\r\n                }}\r\n            >\r\n                {data.isLoading\r\n                    ? <div className=\"loading\">Loading...</div>\r\n\r\n                    : keyboard.map(note => {\r\n                        let noteImage = layoutImages[keyboard.length][note.index]\r\n                        let noteData = {\r\n                            ...note,\r\n                            approachRate: this.approachRate,\r\n                            instrument: this.props.data.keyboard.instrumentName,\r\n                            isAnimated: songStore.data.eventType === 'approaching' ? false : this.props.data.hasAnimation\r\n                        }\r\n                        return <Note\r\n                            key={note.index}\r\n                            data={noteData}\r\n                            approachingNotes={state.approachingNotes[note.index]}\r\n                            outgoingAnimation={state.outgoingAnimation[note.index]}\r\n                            fadeTime={note.delay}\r\n                            handleClick={this.handleClick}\r\n                            noteText={getNoteText(data.noteNameType, note.index, data.pitch, keyboard.length)}\r\n                            noteImage={`./assets/icons/keys/${noteImage}.svg`}\r\n                        />\r\n\r\n                    })\r\n                }\r\n            </div>\r\n        </>\r\n    }\r\n}\r\n\r\nfunction returnStopSong() {\r\n    return {\r\n        song: {},\r\n        eventType: 'stop',\r\n        start: 0\r\n    }\r\n}\r\n\r\n","export default __webpack_public_path__ + \"static/media/mainpage.53c2a740.png\";","export default __webpack_public_path__ + \"static/media/composer.69d0b59e.png\";","export default __webpack_public_path__ + \"static/media/songs.4892a692.png\";","import mainPageImg from 'assets/images/mainpage.png'\r\nimport composerImg from 'assets/images/composer.png'\r\nimport songsImg from 'assets/images/songs.png'\r\nimport { FaCrosshairs, FaDownload } from 'react-icons/fa'\r\nimport { BsCircle } from 'react-icons/bs'\r\nimport isMobile from 'is-mobile'\r\nimport './HelpComponent.css'\r\nexport function HelpTab() {\r\n    return <>\r\n        <div className='help-title'>\r\n            Main page\r\n        </div>\r\n        <div>\r\n            <img src={mainPageImg} className='help-img' alt='tutorial for the main page' />\r\n            <ol>\r\n                <li>Record the keyboard as an audio file</li>\r\n                <li>Current note position, you can change it to reload</li>\r\n                <li>Playback speed</li>\r\n                <li>Approaching circles score</li>\r\n                <li>Approaching circle, click when it's close to the note</li>\r\n            </ol>\r\n        </div>\r\n        {\r\n            !isMobile() && <>\r\n                <div className='help-title'>\r\n                    Main page shortcuts\r\n                </div>\r\n                <div className='help-margin-left'>\r\n                    <div style={{ marginBottom: '0.5rem' }}>\r\n                        The main page has shortcuts for PC users:\r\n                    </div>\r\n                    <table className='keys-table'>\r\n                        <tbody>\r\n                            <tr>\r\n                                <td><Key>Shift + R</Key></td><td>reload song </td>\r\n                            </tr>\r\n                            <tr>\r\n                                <td><Key>Shift + R</Key></td><td>Start/Stop recording when there are no songs playing</td>\r\n                            </tr>\r\n                            <tr>\r\n                                <td><Key>Shift + M</Key></td><td>Open/Close the menu</td>\r\n                            </tr>\r\n                            <tr>\r\n                                <td><Key>Esc</Key></td><td> Close the menu </td>\r\n                            </tr>\r\n                            <tr>\r\n                                <td><Key>Shift + S</Key></td><td>stop song </td>\r\n                            </tr>\r\n                        </tbody>\r\n                    </table>\r\n                </div>\r\n\r\n            </>\r\n        }\r\n\r\n        <div className='help-title'>\r\n            Songs menu\r\n        </div>\r\n        <div>\r\n            <img src={songsImg} className='help-img' alt='tutorial for songs page' />\r\n            <ol>\r\n                <li>Open composer to create a song</li>\r\n                <li>Import song (as json)</li>\r\n                <li>Play song (click the name)</li>\r\n                <li>Practice the song</li>\r\n                <li>Play with the approaching circles mode</li>\r\n                <li>Download the song (as json)</li>\r\n            </ol>\r\n            <div className=\"column\">\r\n                <div>\r\n                    <FaCrosshairs /> = practice the song\r\n                </div>\r\n                <div>\r\n                    <BsCircle /> = Approaching circles mode\r\n                </div>\r\n                <div>\r\n                    <FaDownload /> = download the song\r\n                </div>\r\n\r\n            </div>\r\n        </div>\r\n\r\n        <div className='help-title'>\r\n            Composer\r\n        </div>\r\n        <div>\r\n            <img src={composerImg} className='help-img' alt=\"tutorial for composer\" />\r\n            <ol>\r\n                <li>Go to the next / previous breakpoint</li>\r\n                <li>Timeline of the breakpoints</li>\r\n                <li>Open the tools</li>\r\n                <li>Add 16 columns to the end</li>\r\n                <li>Remove the current selected column</li>\r\n                <li>Add column after the current one</li>\r\n                <li>Change layer (instrument)</li>\r\n                <li>Change column's duration</li>\r\n            </ol>\r\n        </div>\r\n\r\n        {\r\n            !isMobile() && <>\r\n                <div className='help-title'>\r\n                    Composer shortcuts\r\n                </div>\r\n                <div className='help-margin-left'>\r\n\r\n                    <div style={{ marginBottom: '0.5rem' }}>\r\n                        The composer has shortcuts for PC users:\r\n                    </div>\r\n                    <table>\r\n                        <tbody>\r\n                            <tr>\r\n                                <td><Key>A / D</Key></td><td>move left / right</td>\r\n                            </tr>\r\n                            <tr>\r\n                                <td><Key>1 / 2 / 3 / 4</Key></td><td>change tempo</td>\r\n                            </tr>\r\n                            <tr>\r\n                                <td><Key>Space bar</Key></td><td>play / pause song</td>\r\n                            </tr>\r\n                            <tr>\r\n                                <td><Key>Arrow Left</Key></td><td>go to previous breakpoint</td>\r\n                            </tr>\r\n                            <tr>\r\n                                <td><Key>Arrow Right</Key></td><td>go to next breakpoint</td>\r\n                            </tr>\r\n                            <tr>\r\n                                <td><Key>Arrow Up</Key></td><td>select previous layer</td>\r\n                            </tr>\r\n                            <tr>\r\n                                <td><Key>Arrow Down</Key></td><td>select next layer </td>\r\n                            </tr>\r\n                            <tr>\r\n                                <td><Key>Shift + Note</Key></td><td>Adds/remove a note in the column </td>\r\n                            </tr>\r\n                            <tr>\r\n                                <td><Key>Q</Key></td><td>remove current column</td>\r\n                            </tr>\r\n                            <tr>\r\n                                <td><Key>E</Key></td><td>add column </td>\r\n                            </tr>\r\n                        </tbody>\r\n                    </table>\r\n                    When playing a song, you can press on the PC keyboard to add notes\r\n                    <div style={{ marginBottom: \"1rem\" }}>\r\n\r\n                    </div>\r\n                </div>\r\n\r\n            </>\r\n        }\r\n    </>\r\n}\r\n\r\n\r\nfunction Key(props) {\r\n    return <div className='keyboard-key'>\r\n        {props.children}\r\n    </div>\r\n}","import { memo } from \"react\"\r\nexport default memo(function MenuItem(props) {\r\n    const { className, action, children, type } = props\r\n    return <div\r\n        className={className ? `menu-item ${className}` : \"menu-item\"}\r\n        onClick={() => action?.(type)}\r\n    >\r\n        {children}\r\n    </div>\r\n},(prev,next) => {\r\n    if(next.children.key !== null || prev.children.key !== null) return prev.children.key === next.children.key\r\n    return prev.children !== undefined && prev.className === next.className\r\n})","export default function MenuPanel(props) {\r\n    let className = props.visible === props.title ? \"menu-panel menu-panel-visible\" : \"menu-panel\"\r\n    return <div className={className}>\r\n        <div className=\"menu-title\">\r\n            {props.title}\r\n        </div>\r\n        <div className=\"panel-content-wrapper\">\r\n            {props.children}\r\n        </div>\r\n    </div>\r\n}","import { FaTimes } from 'react-icons/fa'\r\nexport default function MenuClose(props) {\r\n    return <div onClick={() => props.action(false)} className=\"close-menu menu-item\">\r\n        <FaTimes className=\"icon\" />\r\n    </div>\r\n}","import './switch.css'\r\n\r\nexport default function Switch({checked, onChange}){\r\n    return <div className=\"switch-wrapper\" onClick={() => onChange(!checked)}>\r\n        <div className={`switch-inner ${checked ? 'switch-inner-on' : ''}`}>\r\n\r\n        </div>\r\n    </div>\r\n}","import { useState, useEffect,memo } from 'react'\r\nimport Switch from 'components/Switch'\r\nexport default memo(function SettingsRow({ data, update, objKey, changeVolume }) {\r\n    const [valueHook, setter] = useState(data.value)\r\n    const [volumeHook, setterVolume] = useState(data.volume)\r\n    useEffect(() => {\r\n        setter(data.value)\r\n    },[data.value])\r\n\r\n    function handleChange(e) {\r\n        const el = e.target\r\n        let value = el.value\r\n        if (data.type === \"number\") {\r\n            value = Number(value)\r\n            el.value = \"\" //have to do this to remove a react bug that adds a 0 at the start\r\n            if (value < data.threshold[0] || value > data.threshold[1])  return\r\n        }\r\n        setter(value)\r\n    }\r\n\r\n    function handleCheckbox(value){\r\n        update({\r\n            key: objKey,\r\n            data: {...data, value}\r\n        }) \r\n        setter(value)\r\n    }\r\n\r\n    function sendChange() {\r\n        if (data.value === valueHook) return\r\n        let obj = {\r\n            key: objKey,\r\n            data: {...data, value: valueHook}\r\n        }\r\n        update(obj)\r\n    }\r\n    function sendChangeSelect(e) {\r\n        let value = e.target.value\r\n        let obj = {\r\n            key: objKey,\r\n            data: {...data, value}\r\n        }\r\n        update(obj)\r\n    }\r\n\r\n    function handleVolume(e) {\r\n        setterVolume(Number(e.target.value))\r\n    }\r\n\r\n    function sendVolumeChange() {\r\n        changeVolume({\r\n            key: objKey,\r\n            value: volumeHook\r\n        })\r\n    }\r\n\r\n    if (objKey === \"settingVesion\") return null\r\n    return <div className=\"settings-row\">\r\n        <div>\r\n            {data.name}\r\n        </div>\r\n\r\n        {data.type === \"select\"\r\n            && <select value={data.value}\r\n                onChange={sendChangeSelect}\r\n            >\r\n                {data.options.map(e => {\r\n                    return <option value={e} key={e}>{e}</option>\r\n                })}\r\n            </select>\r\n        }\r\n\r\n        {[\"number\", \"text\"].includes(data.type) &&\r\n            <input\r\n                type={data.type}\r\n                value={valueHook}\r\n                placeholder={data.placeholder || \"\"}\r\n                onBlur={sendChange}\r\n                onChange={handleChange}\r\n            />\r\n        }\r\n\r\n        {data.type === 'checkbox' && \r\n            <Switch \r\n                checked={valueHook}\r\n                onChange={handleCheckbox}\r\n            />\r\n        }\r\n\r\n        {data.type === \"instrument\" &&\r\n            <div className=\"instrument-picker\">\r\n                <select value={data.value}\r\n                    onChange={sendChangeSelect}\r\n                >\r\n                    {data.options.map(e => {\r\n                        return <option value={e} key={e}>{e}</option>\r\n                    })}\r\n                </select>\r\n                <input\r\n                    type=\"range\"\r\n                    min={1}\r\n                    max={100}\r\n                    value={volumeHook}\r\n                    onChange={handleVolume}\r\n                    onPointerUp={sendVolumeChange}\r\n                />\r\n            </div>\r\n        }\r\n    </div>\r\n},(p,n) => {\r\n    return p.data.value === n.data.value\r\n        && p.data.volume === n.data.volume\r\n        && p.update === n.update\r\n})","export default function DonateButton(props){\r\n    return <div className=\"donate-button\" onClick={() => props.onClick(\"Donate\")}>\r\n        Donate\r\n    </div>\r\n}","import { useState } from 'react'\r\nimport { FaDownload, FaSpinner } from 'react-icons/fa';\r\nimport { LoggerEvent, prepareSongImport } from \"lib/Utils\"\r\n\r\nexport default function SearchedSong(props) {\r\n    const { functions, data, songStore } = props\r\n    const { importSong } = functions\r\n    const [fetching, setFetching] = useState(false)\r\n    const [cache, setCache] = useState(undefined)\r\n    const download = async function () {\r\n        if (fetching) return\r\n        try {\r\n            if (cache) return importSong(cache)\r\n            setFetching(true)\r\n            let song = await fetch('https://sky-music.herokuapp.com/api/songs?get=' + encodeURI(data.file)).then(data => data.json())\r\n            setFetching(false)\r\n            song = prepareSongImport(song)\r\n            setCache(song)\r\n            importSong(song)\r\n        } catch (e) {\r\n            setFetching(false)\r\n            console.error(e)\r\n            new LoggerEvent(\"Error\", \"Error downloading song\").trigger()\r\n        }\r\n    }\r\n    const play = async function () {\r\n        if (fetching) return\r\n        try {\r\n            if (cache) {\r\n                return songStore.data = {\r\n                    eventType: 'play',\r\n                    song: cache,\r\n                    start: 0\r\n                }\r\n            }\r\n            setFetching(true)\r\n            let song = await fetch('https://sky-music.herokuapp.com/api/songs?get=' + encodeURI(data.file)).then(data => data.json())\r\n            setFetching(false)\r\n            song = prepareSongImport(song)\r\n            setCache(song)\r\n            songStore.data = {\r\n                eventType: 'play',\r\n                song: song,\r\n                start: 0\r\n            }\r\n        } catch (e) {\r\n            console.error(e)\r\n            setFetching(false)\r\n            new LoggerEvent(\"Error\", \"Error downloading song\").trigger()\r\n        }\r\n    }\r\n    return <div className=\"song-row\">\r\n        <div className=\"song-name\" onClick={() => {\r\n            play(data)\r\n        }}>\r\n            {data.name}\r\n        </div>\r\n        <div className=\"song-buttons-wrapper\">\r\n            <button className=\"song-button\" onClick={download}>\r\n                {fetching ? <FaSpinner /> : <FaDownload />}\r\n            </button>\r\n        </div>\r\n    </div>\r\n}","import { Component } from 'react'\r\nimport { FaMusic, FaTimes, FaCog, FaTrash, FaCrosshairs, FaDownload, FaInfo, FaSearch, FaHome } from 'react-icons/fa';\r\nimport { FaDiscord, FaGithub } from 'react-icons/fa';\r\nimport { BsCircle } from 'react-icons/bs'\r\nimport { RiPlayListFill } from 'react-icons/ri'\r\nimport { FileDownloader, LoggerEvent, prepareSongImport, prepareSongDownload } from \"lib/Utils\"\r\nimport { FilePicker } from \"react-file-picker\"\r\nimport { appName, isTwa, isMidiAvailable } from \"appConfig\"\r\nimport { songStore } from '../SongStore'\r\nimport { HelpTab } from 'components/HelpTab'\r\nimport MenuItem from 'components/MenuItem'\r\nimport MenuPanel from 'components/MenuPanel'\r\nimport MenuClose from 'components/MenuClose'\r\nimport SettingsRow from 'components/SettingsRow'\r\nimport DonateButton from 'components/DonateButton'\r\nimport LibrarySearchedSong from 'components/LibrarySearchedSong'\r\nimport \"./menu.css\"\r\nimport Analytics from 'lib/Analytics';\r\nclass Menu extends Component {\r\n    constructor(props) {\r\n        super(props)\r\n        this.state = {\r\n            open: false,\r\n            selectedMenu: \"Songs\",\r\n            selectedSongType: \"recorded\",\r\n            searchInput: '',\r\n            searchedSongs: [],\r\n            searchStatus: 'Write a song name then search!',\r\n            isPersistentStorage: false\r\n        }\r\n    }\r\n    componentDidMount() {\r\n        this.checkPersistentStorage()\r\n        window.addEventListener(\"keydown\", this.handleKeyboard)\r\n    }\r\n    componentWillUnmount() {\r\n        window.removeEventListener(\"keydown\", this.handleKeyboard)\r\n    }\r\n    handleKeyboard = (event) => {\r\n        let key = event.code\r\n        if (document.activeElement.tagName === \"INPUT\") return\r\n        document.activeElement?.blur()\r\n        if (event.shiftKey) {\r\n            switch (key) {\r\n                case \"KeyM\": {\r\n                    this.setState({ open: !this.state.open })\r\n                    break\r\n                }\r\n                default: break;\r\n            }\r\n        } else {\r\n            switch (key) {\r\n                case \"Escape\": {\r\n                    this.setState({ open: false })\r\n                    break\r\n                }\r\n                default: break;\r\n            }\r\n        }\r\n\r\n    }\r\n    checkPersistentStorage = async () => {\r\n        if (navigator.storage && navigator.storage.persist) {\r\n            let isPersisted = await navigator.storage.persisted()\r\n            if (!isPersisted) isPersisted = await navigator.storage.persist()\r\n            this.setState({ isPersistentStorage: isPersisted })\r\n        }\r\n    }\r\n    handleSearchInput = (text) => {\r\n        this.setState({\r\n            searchInput: text\r\n        })\r\n    }\r\n    clearSearch = () => {\r\n        this.setState({\r\n            searchInput: '',\r\n            searchedSongs: [],\r\n            searchStatus: 'Write a song name then search!'\r\n        })\r\n    }\r\n    searchSongs = async () => {\r\n        const { searchInput, searchStatus } = this.state\r\n        if (searchStatus === \"Searching...\") return\r\n        if (searchInput.trim().length === 0) {\r\n            return this.setState({\r\n                searchStatus: 'Please write a non empty name'\r\n            })\r\n        }\r\n        this.setState({\r\n            searchStatus: 'Searching...'\r\n        })\r\n        let fetchedSongs = await fetch('https://sky-music.herokuapp.com/api/songs?search=' + encodeURI(searchInput)).then(data => data.json())\r\n        if (fetchedSongs.error) {\r\n            this.setState({\r\n                searchStatus: 'Please write a non empty name'\r\n            })\r\n            return new LoggerEvent(\"Error\", fetchedSongs.error).trigger()\r\n        }\r\n        this.setState({\r\n            searchedSongs: fetchedSongs,\r\n            searchStatus: 'success'\r\n        })\r\n\t\tAnalytics.songSearch({name: searchInput})\r\n\r\n    }\r\n    toggleMenu = (override) => {\r\n        if (typeof override !== \"boolean\") override = undefined\r\n        let newState = override !== undefined ? override : !this.state.open\r\n        this.setState({\r\n            open: newState,\r\n        })\r\n    }\r\n    selectSideMenu = (selection) => {\r\n        if (selection === this.state.selectedMenu && this.state.open) {\r\n            return this.setState({\r\n                open: false,\r\n            })\r\n        }\r\n        this.clearSearch()\r\n        this.setState({\r\n            selectedMenu: selection,\r\n            open: true\r\n        })\r\n        Analytics.UIEvent('menu',{tab: selection})\r\n    }\r\n    changeSelectedSongType = (name) => {\r\n        this.setState({\r\n            selectedSongType: name\r\n        })\r\n    }\r\n    importSong = (file) => {\r\n        const reader = new FileReader();\r\n        reader.addEventListener('load', async (event) => {\r\n            try {\r\n                let songsInput = JSON.parse(event.target.result)\r\n                if (!Array.isArray(songsInput)) songsInput = [songsInput]\r\n                for (let song of songsInput) {\r\n                    song = prepareSongImport(song)\r\n                    await this.props.functions.addSong(song)\r\n                    Analytics.userSongs({name: song?.name, page: 'player'},'import')\r\n                }\r\n            } catch (e) {\r\n                console.error(e)\r\n                if (file?.name?.includes?.(\".mid\")) {\r\n                    return new LoggerEvent(\"Error\", \"Midi files should be imported in the composer\").trigger()\r\n                }\r\n                new LoggerEvent(\"Error\", \"Error importing song, invalid format\").trigger()\r\n\r\n            }\r\n        })\r\n        reader.readAsText(file)\r\n    }\r\n    downloadSong = (song) => {\r\n        if (song._id) delete song._id\r\n        let songName = song.name\r\n        if (appName === \"Sky\") {\r\n            //adds old format into the sheet\r\n            song = prepareSongDownload(song)\r\n        }\r\n        if (!Array.isArray(song)) song = [song]\r\n        song.forEach(song1 => {\r\n            song1.data.appName = appName\r\n        })\r\n        let json = JSON.stringify(song)\r\n        let fileDownloader = new FileDownloader()\r\n        fileDownloader.download(json, `${songName}.${appName.toLowerCase()}sheet.json`)\r\n        new LoggerEvent(\"Success\", \"Song downloaded\").trigger()\r\n        Analytics.userSongs({name: song?.name, page: 'player'},'download')\r\n    }\r\n\r\n    downloadAllSongs = () => {\r\n        let toDownload = []\r\n        this.props.data.songs.forEach(song => {\r\n            if (song._id) delete song._id\r\n            if (appName === \"Sky\") {\r\n                song = prepareSongDownload(song)\r\n            }\r\n            Array.isArray(song) ? toDownload.push(...song) : toDownload.push(song)\r\n        })\r\n        let fileDownloader = new FileDownloader()\r\n        let json = JSON.stringify(toDownload)\r\n        let date = new Date().toISOString().split('T')[0]\r\n        fileDownloader.download(json, `${appName}_Backup_${date}.json`)\r\n        new LoggerEvent(\"Success\", \"Song backup downloaded\").trigger()\r\n    }\r\n\r\n    render() {\r\n        let sideClass = this.state.open ? \"side-menu menu-open\" : \"side-menu\"\r\n        const { data, functions } = this.props\r\n        const { handleSettingChange } = functions\r\n        functions.toggleMenu = this.toggleMenu\r\n        functions.downloadSong = this.downloadSong\r\n        let changePage = this.props.functions.changePage\r\n        let songs = data.songs.filter(song => !song.data.isComposedVersion)\r\n        let composedSongs = data.songs.filter(song => song.data.isComposedVersion)\r\n        const { searchStatus, searchedSongs, selectedMenu } = this.state\r\n        let searchedSongFunctions = {\r\n            importSong: functions.addSong,\r\n        }\r\n        return <div className=\"menu-wrapper\">\r\n            <div className=\"menu menu-visible menu-main-page\">\r\n                {this.state.open && <MenuClose action={this.toggleMenu} />}\r\n                <MenuItem type=\"Help\" action={this.selectSideMenu} className=\"margin-top-auto\">\r\n                    <FaInfo className=\"icon\" />\r\n                </MenuItem>\r\n                <MenuItem type=\"Library\" action={this.selectSideMenu}>\r\n                    <RiPlayListFill className='icon' />\r\n                </MenuItem>\r\n                <MenuItem type=\"Songs\" action={this.selectSideMenu} >\r\n                    <FaMusic className=\"icon\" />\r\n                </MenuItem>\r\n                <MenuItem type=\"Settings\" action={this.selectSideMenu}>\r\n                    <FaCog className=\"icon\" />\r\n                </MenuItem>\r\n                <MenuItem type=\"Home\" action={() => changePage(\"home\")}>\r\n                    <FaHome className=\"icon\" />\r\n                </MenuItem>\r\n            </div>\r\n            <div className={sideClass}>\r\n                <MenuPanel title=\"No selection\" visible={selectedMenu}>\r\n                </MenuPanel>\r\n                <MenuPanel title=\"Songs\" visible={selectedMenu}>\r\n                    <div className=\"songs-buttons-wrapper\">\r\n                        <button className=\"genshin-button\"\r\n                            onClick={() => changePage(\"Composer\")}\r\n                        >\r\n                            Compose song\r\n                        </button>\r\n                        <FilePicker\r\n                            onChange={(file) => this.importSong(file)}\r\n                        >\r\n                            <button className=\"genshin-button\">\r\n                                Import song\r\n                            </button>\r\n                        </FilePicker>\r\n\r\n                    </div>\r\n                    <div className=\"tab-selector-wrapper\">\r\n                        <button\r\n                            className={this.state.selectedSongType === \"recorded\" ? \"tab-selector tab-selected\" : \"tab-selector\"}\r\n                            onClick={() => this.changeSelectedSongType(\"recorded\")}\r\n                        >\r\n                            Recorded\r\n                        </button>\r\n                        <button\r\n                            className={this.state.selectedSongType === \"composed\" ? \"tab-selector tab-selected\" : \"tab-selector\"}\r\n                            onClick={() => this.changeSelectedSongType(\"composed\")}\r\n                        >\r\n                            Composed\r\n                        </button>\r\n                    </div>\r\n                    <div className=\"songs-wrapper\">\r\n                        {this.state.selectedSongType === \"recorded\"\r\n                            ? songs.map(song => {\r\n                                return <SongRow\r\n                                    data={song}\r\n                                    key={song.name}\r\n                                    functions={functions}\r\n                                >\r\n                                </SongRow>\r\n                            })\r\n                            : composedSongs.map(song => {\r\n                                return <SongRow\r\n                                    data={song}\r\n                                    key={song.name}\r\n                                    functions={functions}\r\n                                >\r\n                                </SongRow>\r\n                            })\r\n                        }\r\n                    </div>\r\n                    <div style={{ marginTop: \"auto\", paddingTop: '0.5rem', width: '100%', display: 'flex', justifyContent: 'flex-end' }}>\r\n                        <button\r\n                            className='genshin-button'\r\n                            style={{ marginLeft: 'auto' }}\r\n                            onClick={this.downloadAllSongs}\r\n                        >\r\n                            Download all songs (backup)\r\n                        </button>\r\n                    </div>\r\n                </MenuPanel>\r\n\r\n                <MenuPanel title=\"Settings\" visible={selectedMenu}>\r\n                    {Object.entries(data.settings).map(([key, data]) => {\r\n                        return <SettingsRow\r\n                            key={key}\r\n                            objKey={key}\r\n                            data={data}\r\n                            changeVolume={functions.changeVolume}\r\n                            update={handleSettingChange}\r\n                        />\r\n                    })}\r\n                    {isMidiAvailable && \r\n                        <button \r\n                            className='genshin-button' \r\n                            onClick={() => changePage('MidiSetup')} \r\n                            style={{marginTop: '0.4rem', width:'fit-content', marginLeft: 'auto'}}\r\n                        >\r\n                            Connect MIDI keyboard\r\n                        </button>\r\n                    }\r\n                    \r\n                    <div style={{ marginTop: '0.4rem', marginBottom: '0.6rem' }}>\r\n                        {this.state.isPersistentStorage ? \"Storage is persisted\" : \"Storage is not persisted\"}\r\n                    </div>\r\n                    {!isTwa() && <DonateButton onClick={changePage} />}\r\n\r\n                </MenuPanel>\r\n\r\n                <MenuPanel title=\"Library\" visible={selectedMenu}>\r\n                    <div>\r\n                        Here you can find songs to learn, they are provided by the sky-music library.\r\n                    </div>\r\n                    <div className='library-search-row' >\r\n                        <input\r\n                            className='library-search-input'\r\n                            placeholder='Song name'\r\n                            onKeyDown={(e) => {\r\n                                if (e.code === \"Enter\") this.searchSongs()\r\n                            }}\r\n                            onInput={(e) => this.handleSearchInput(e.target.value)}\r\n                            value={this.state.searchInput}\r\n                        />\r\n                        <button className='library-search-btn' onClick={this.clearSearch}>\r\n                            <FaTimes />\r\n                        </button>\r\n                        <button className='library-search-btn' onClick={this.searchSongs}>\r\n                            <FaSearch />\r\n                        </button>\r\n                    </div>\r\n                    <div className='library-search-songs-wrapper'>\r\n                        {searchStatus === \"success\" ?\r\n                            searchedSongs.length > 0\r\n                                ? searchedSongs.map(song =>\r\n                                    <LibrarySearchedSong\r\n                                        key={song.file}\r\n                                        data={song}\r\n                                        functions={searchedSongFunctions}\r\n                                        songStore={songStore}\r\n                                    >\r\n                                        {song.name}\r\n                                    </LibrarySearchedSong>)\r\n                                : <div className='library-search-result-text'>\r\n                                    No results\r\n                                </div>\r\n                            : <div className='library-search-result-text'>\r\n                                {searchStatus}\r\n                            </div>\r\n                        }\r\n                    </div>\r\n                </MenuPanel>\r\n                <MenuPanel title=\"Help\" visible={selectedMenu}>\r\n                    <div className='help-icon-wrapper'>\r\n                        <a href='https://discord.gg/Arsf65YYHq' >\r\n                            <FaDiscord className='help-icon' />\r\n                        </a>\r\n                        <a href='https://github.com/Specy/genshin-music' >\r\n                            <FaGithub className='help-icon' />\r\n                        </a>\r\n\r\n                    </div>\r\n                    <HelpTab />\r\n                    {!isTwa() && <DonateButton onClick={changePage} />}\r\n                </MenuPanel>\r\n            </div>\r\n        </div>\r\n    }\r\n}\r\nfunction SongRow(props) {\r\n    let data = props.data\r\n    let deleteSong = props.functions.removeSong\r\n    let toggleMenu = props.functions.toggleMenu\r\n    let downloadSong = props.functions.downloadSong\r\n\r\n    return <div className=\"song-row\">\r\n        <div className=\"song-name\" onClick={() => {\r\n            songStore.data = {\r\n                eventType: 'play',\r\n                song: data,\r\n                start: 0\r\n            }\r\n            toggleMenu(false)\r\n        }}>\r\n            {data.name}\r\n        </div>\r\n        <div className=\"song-buttons-wrapper\">\r\n            <button className=\"song-button\" onClick={() => {\r\n                songStore.data = {\r\n                    eventType: 'practice',\r\n                    song: data,\r\n                    start: 0\r\n                }\r\n                toggleMenu(false)\r\n            }}\r\n            >\r\n                <FaCrosshairs />\r\n            </button>\r\n\r\n            <button className=\"song-button\" onClick={() => {\r\n                songStore.data = {\r\n                    eventType: 'approaching',\r\n                    song: data,\r\n                    start: 0\r\n                }\r\n                toggleMenu(false)\r\n            }}\r\n            >\r\n                <BsCircle />\r\n            </button>\r\n            <button className=\"song-button\" onClick={() => downloadSong(data)}>\r\n                <FaDownload />\r\n\r\n            </button>\r\n            <button className=\"song-button\" onClick={() => deleteSong(data.name)}>\r\n                <FaTrash color=\"#ed4557\" />\r\n            </button>\r\n        </div>\r\n    </div>\r\n}\r\n\r\n\r\n\r\nexport default Menu","import ZangoDb from \"zangodb\"\r\nimport { appName } from \"appConfig\"\r\nclass Database{\r\n    db = new ZangoDb.Db(appName, { songs: [] })\r\n    constructor(){\r\n        this.collections = {\r\n            songs: this.db.collection(\"songs\")\r\n        }\r\n    }\r\n    async getSongs(){\r\n        return await this.collections.songs.find().toArray()\r\n    }\r\n    async getSongById(id){\r\n        return await this.collections.songs.findOne({_id: id})\r\n    }\r\n    async existsSong(query){\r\n        return await this.collections.songs.findOne(query) !== undefined\r\n    }\r\n    async updateSong(query,data){\r\n        return this.collections.songs.update(query, data)\r\n    }\r\n    addSong(song){\r\n        return this.collections.songs.insert(song)\r\n    }\r\n    removeSong(query){\r\n        return this.collections.songs.remove(query)\r\n    }\r\n}\r\n\r\nconst DB = new Database()\r\nexport {\r\n    Database,\r\n    DB\r\n}","import { instrumentsData, layoutData, instruments,audioContext } from \"appConfig\"\r\n\r\nexport default class Instrument {\r\n    constructor(instrumentName) {\r\n        this.instrumentName = instrumentName === undefined ? instruments[0] : instrumentName\r\n        if (!instruments.includes(this.instrumentName)) this.instrumentName = instruments[0] \r\n        this.layout = []\r\n        this.buffers = []\r\n        this.loaded = false\r\n        this.deleted = false\r\n        this.volumeNode = audioContext.createGain()\r\n        const instrumentData = instrumentsData[this.instrumentName]\r\n        this.keyboardLayout = layoutData[instrumentData.notes].keyboardLayout\r\n        this.mobileLayout = layoutData[instrumentData.notes].mobileLayout\r\n        this.keyboardCodes = layoutData[instrumentData.notes].keyboardCodes\r\n        \r\n        this.keyboardLayout.forEach((noteName, i) => {\r\n            let noteNames = {\r\n                keyboard: noteName,\r\n                mobile: this.mobileLayout[i]\r\n            }\r\n            let url = `./assets/audio/${this.instrumentName}/${i}.mp3`\r\n            this.layout.push(new NoteData(i, noteNames, url))\r\n        })\r\n\r\n        this.volumeNode.gain.value = 0.8\r\n    }\r\n    getNoteFromCode = (code) => {\r\n        let index = this.keyboardLayout.findIndex(e => e === String(code))\r\n        return index !== -1 ? index : null\r\n    }\r\n\r\n    changeVolume = (amount) => {\r\n        let newVolume = Number((amount / 135).toFixed(2))\r\n        if(amount < 5) newVolume = 0\r\n        this.volumeNode.gain.value = newVolume\r\n    }\r\n\r\n    play = (note, pitch) => {\r\n        if(this.deleted) return\r\n        let player = audioContext.createBufferSource()\r\n        player.buffer = this.buffers[note]\r\n        player.connect(this.volumeNode)\r\n        player.playbackRate.value = pitch\r\n        player.start(0)\r\n        player.onended = () => {\r\n            player.stop()\r\n            player.disconnect()\r\n        }\r\n    }\r\n    load = async () => {\r\n        let emptyBuffer = audioContext.createBuffer(2, audioContext.sampleRate, audioContext.sampleRate)\r\n        const requests = this.layout.map(note => {\r\n            return new Promise(resolve => {\r\n                fetch(note.url)\r\n                    .then(result => result.arrayBuffer())\r\n                    .then(buffer => {\r\n                        audioContext.decodeAudioData(buffer, resolve, () => {\r\n                            resolve(emptyBuffer)\r\n                        })\r\n                        .catch(e => {resolve(emptyBuffer)})\r\n                    }).catch(e => {resolve(emptyBuffer)})\r\n            })\r\n        })\r\n        this.buffers = await Promise.all(requests)\r\n        this.loaded = true\r\n        return true\r\n    }\r\n    disconnect = () =>{\r\n        this.volumeNode.disconnect()\r\n    }\r\n    connect = (node) => {\r\n        this.volumeNode.connect(node)\r\n    }\r\n    delete = () => {\r\n        this.disconnect()\r\n        this.deleted = true\r\n        this.buffers = null\r\n    }\r\n}\r\n\r\nclass NoteData {\r\n    constructor(index, noteNames, url) {\r\n        this.index = index\r\n        this.noteNames = noteNames\r\n        this.url = url\r\n        this.buffer = new ArrayBuffer(8)\r\n    }\r\n}","import { audioContext } from \"appConfig\";\r\nimport toWav from 'audiobuffer-to-wav'\r\nimport MediaRecorderPolyfill from 'audio-recorder-polyfill'\r\nexport default class AudioRecorder {\r\n    constructor() {\r\n        this.node = audioContext.createMediaStreamDestination()\r\n        if(!window.MediaRecorder){\r\n            console.log(\"Audio recorder Polyfill\")\r\n            this.recorder = new MediaRecorderPolyfill(this.node.stream)\r\n        }else{\r\n            this.recorder = new MediaRecorder(this.node.stream)\r\n        }\r\n    }\r\n    start() {\r\n        this.recorder.start()\r\n    }\r\n    stop() {\r\n        return new Promise(resolve => {\r\n            this.recorder.addEventListener('dataavailable', function (e) {\r\n                resolve({\r\n                    data: e.data,\r\n                    toUrl: () => {\r\n                        return URL.createObjectURL(e.data);\r\n                    }\r\n                })\r\n            }, { once: true })\r\n            this.recorder.stop()\r\n        })\r\n    }\r\n\r\n    async download(urlBlob, fileName) {\r\n        const anchor = document.createElement(\"a\")\r\n        const wav = toWav(await blobToAudio(urlBlob))\r\n        var blob = new Blob([new DataView(wav)], {\r\n            type: 'audio/wav'\r\n        })\r\n        anchor.download = fileName\r\n        anchor.href = URL.createObjectURL(blob)\r\n        anchor.click();\r\n    }\r\n}\r\n\r\nfunction blobToAudio(blob) {\r\n    return new Promise(resolve => {\r\n        const audioContext = new AudioContext();\r\n        const fileReader = new FileReader();\r\n        fileReader.onloadend = () => {\r\n            audioContext.decodeAudioData(fileReader.result, (audioBuffer) => {\r\n                resolve(audioBuffer)\r\n            });\r\n        };\r\n        fileReader.readAsArrayBuffer(blob);\r\n    })\r\n}","import { LoggerEvent } from \"lib/Utils\"\r\n\r\nasync function asyncPrompt(question) {\r\n    return new Promise(resolve => {\r\n        const overlay = document.createElement(\"div\")\r\n        const container = document.createElement(\"div\")\r\n        const text = document.createElement(\"div\")\r\n        const row = document.createElement(\"div\")\r\n        const cancel = document.createElement(\"button\")\r\n        const ok = document.createElement(\"button\")\r\n        const input = document.createElement(\"input\")\r\n\r\n        overlay.className = 'prompt-overlay'\r\n        input.type = \"text\"\r\n        container.className = \"floating-prompt\"\r\n        input.placeholder = \"Write here\"\r\n        input.className = \"prompt-input\"\r\n        cancel.className = \"prompt-button\"\r\n        ok.className = \"prompt-button disabled\"\r\n        row.className = \"prompt-row\"\r\n        ok.innerText = \"Ok\"\r\n        cancel.innerText = \"Cancel\"\r\n        text.innerText = question\r\n\r\n        row.append(cancel, ok)\r\n        container.append(text, input, row)\r\n        overlay.append(container)\r\n        document.body.appendChild(overlay)\r\n\r\n        let disposed = false\r\n        function inputListener(){\r\n            if(disposed) return\r\n            if (input.value.trim() === \"\") {\r\n                ok.classList.add(\"disabled\")\r\n            } else {\r\n                ok.classList.remove(\"disabled\")\r\n            }\r\n        }\r\n        function cancelListener(){\r\n            if(disposed) return\r\n            resolve(null)\r\n            dispose()\r\n        }\r\n        function okListener(){\r\n            if(disposed) return\r\n            if (input.value.trim() === '') return\r\n            if (input.value.trim() === \"Untitled\") {\r\n                input.value = \"\"\r\n                return new LoggerEvent(\"Warning\", '\"Untitled\" is a reserved word, use another').trigger()\r\n            }\r\n            resolve(input.value.trim())\r\n            dispose()\r\n        }\r\n\r\n        function handleKeyboard(event){\r\n            const key = event.code\r\n            if(key === 'Enter') okListener()\r\n            if(key === 'Escape') cancelListener()\r\n        }\r\n\r\n        function handleOverlay(e){\r\n            if(e?.path?.[0] === overlay) cancelListener()\r\n        }\r\n\r\n        input.focus()\r\n        overlay.addEventListener(\"click\",handleOverlay)\r\n        cancel.addEventListener(\"click\", cancelListener)\r\n        ok.addEventListener(\"click\", okListener)\r\n        window.addEventListener('keydown',handleKeyboard)\r\n        input.addEventListener(\"input\", inputListener)\r\n\r\n        function dispose(){\r\n            overlay.removeEventListener(\"click\",handleOverlay)\r\n            ok.removeEventListener('click',okListener)\r\n            cancel.removeEventListener('click',cancelListener)\r\n            window.removeEventListener('keydown',handleKeyboard)\r\n            input.removeEventListener('input',inputListener)\r\n            disposed = true\r\n            overlay.classList.add(\"prompt-overlay-hidden\")\r\n            container.classList.add(\"floating-prompt-hidden\")\r\n            setTimeout(() => clearDOM(overlay), 200)\r\n        }\r\n    })\r\n}\r\n\r\nasync function asyncConfirm(question,cancellable = true) {\r\n    return new Promise(resolve => {\r\n        const overlay = document.createElement(\"div\")\r\n        const container = document.createElement(\"div\")\r\n        const text = document.createElement(\"div\")\r\n        const row = document.createElement(\"div\")\r\n        const cancel = document.createElement(\"button\")\r\n        const ok = document.createElement(\"button\")\r\n\r\n        overlay.className = 'prompt-overlay'\r\n        container.className = \"floating-prompt\"\r\n        text.innerText = question\r\n        cancel.className = \"prompt-button\"\r\n        ok.className = \"prompt-button\"\r\n        row.className = \"prompt-row\"\r\n        ok.innerText = \"Yes\"\r\n        ok.style.background = '#628c83'\r\n        cancel.style.background = '#a9525a'\r\n        cancel.innerText = \"No\"\r\n        \r\n        row.append(cancel, ok)\r\n        container.append(text,row)\r\n        overlay.append(container)\r\n        document.body.appendChild(overlay)\r\n\r\n        let disposed = false\r\n        function okListener(){\r\n            if(disposed) return\r\n            resolve(true)\r\n            dispose()\r\n        }\r\n        function cancelListener(){\r\n            if(disposed) return\r\n            resolve(false)\r\n            dispose()\r\n        }\r\n        function handleKeyboard(event){\r\n            const key = event.code\r\n            if(key === 'Enter') okListener()\r\n            if(key === 'Escape' && cancellable) cancelListener()\r\n        }\r\n        function handleOverlay(e){\r\n            if(e?.path?.[0] === overlay && cancellable) cancelListener()\r\n        }\r\n        overlay.addEventListener(\"click\",handleOverlay)\r\n        cancel.addEventListener(\"click\", cancelListener)\r\n        ok.addEventListener(\"click\", okListener)\r\n        window.addEventListener('keydown',handleKeyboard)\r\n        document.activeElement.blur()\r\n        function dispose(){\r\n            disposed = true\r\n            cancel.removeEventListener('click',cancelListener)\r\n            ok.removeEventListener('click',okListener)\r\n            window.removeEventListener('keydown',handleKeyboard)\r\n            overlay.removeEventListener(\"click\",handleOverlay)\r\n            overlay.classList.add(\"prompt-overlay-hidden\")\r\n            container.classList.add(\"floating-prompt-hidden\")\r\n            setTimeout(() => clearDOM(overlay), 200)\r\n        }\r\n    })\r\n}\r\n\r\nfunction clearDOM(element){\r\n    element.querySelectorAll('*').forEach(el => el.remove())\r\n    element.remove()\r\n}\r\n\r\nexport {\r\n    asyncConfirm,\r\n    asyncPrompt\r\n}","import React, { Component } from 'react';\r\nimport Keyboard from \"./Keyboard\"\r\nimport Menu from \"./Components/Menu\"\r\nimport { DB } from 'Database';\r\nimport { songStore } from './SongStore'\r\nimport { Song, Recording, LoggerEvent, prepareSongImport, getPitchChanger } from \"lib/Utils\"\r\nimport { MainPageSettings } from \"lib/SettingsObj\"\r\nimport Instrument from 'lib/Instrument';\r\nimport AudioRecorder from 'lib/AudioRecorder';\r\nimport { asyncConfirm, asyncPrompt } from \"components/AsyncPrompts\"\r\nimport { appName, audioContext , isTwa} from \"appConfig\"\r\nimport './App.css';\r\nimport Analytics from 'lib/Analytics';\r\nclass App extends Component {\r\n\tconstructor(props) {\r\n\t\tsuper(props)\r\n\t\tthis.recording = new Recording()\r\n\t\tlet settings = this.getSettings()\r\n\t\tthis.state = {\r\n\t\t\tinstrument: new Instrument(),\r\n\t\t\tisLoadingInstrument: true,\r\n\t\t\tisRecording: false,\r\n\t\t\tisRecordingAudio: false,\r\n\t\t\tsongs: [],\r\n\t\t\tsettings: settings,\r\n\t\t\tisDragging: false,\r\n\t\t\tthereIsSong: false\r\n\t\t}\r\n\t\tthis.mounted = false\r\n\t\tthis.reverbNode = undefined\r\n\t\tthis.reverbVolumeNode = undefined\r\n\t\tthis.audioContext = audioContext\r\n\t\tthis.recorder = new AudioRecorder()\r\n\t}\r\n\r\n\tinit = async () => {\r\n\t\tconst { settings } = this.state\r\n\t\tawait this.loadInstrument(settings.instrument.value)\r\n\t\tawait this.loadReverb()\r\n\t\tthis.toggleReverbNodes(settings.caveMode.value)\r\n\t}\r\n\tcomponentDidMount() {\r\n\t\tdocument.body.addEventListener('dragenter', this.handleDrag)\r\n\t\tdocument.body.addEventListener('dragleave', this.resetDrag)\r\n\t\tdocument.body.addEventListener('dragover', this.handleDragOver)\r\n\t\tdocument.body.addEventListener('drop', this.handleDrop)\r\n        window.addEventListener('keydown', this.handleKeyboard)\r\n\r\n\t\tthis.mounted = true\r\n\t\tthis.syncSongs()\r\n\t\tthis.init()\r\n\t}\r\n\tcomponentWillUnmount() {\r\n\t\tdocument.body.removeEventListener('dragenter', this.handleDrag)\r\n\t\tdocument.body.removeEventListener('dragleave', this.resetDrag)\r\n\t\tdocument.body.removeEventListener('drop', this.handleDrop)\r\n\t\tdocument.body.removeEventListener('dragover', this.handleDragOver)\r\n        window.removeEventListener('keydown', this.handleKeyboard)\r\n\r\n\t\tsongStore.data = {\r\n\t\t\tsong: {},\r\n\t\t\teventType: 'stop',\r\n\t\t\tstart: 0\r\n\t\t}\r\n\t\tthis.mounted = false\r\n\t\tthis.audioContext = undefined\r\n\t\tthis.recorder = undefined\r\n\t\tthis.reverbNode = undefined\r\n\t\tthis.reverbVolumeNode = undefined\r\n\t\tthis.state.instrument.delete()\r\n\t}\r\n\r\n\tcomponentDidCatch() {\r\n\t\tnew LoggerEvent(\"Warning\", \"There was an error with the song! Restoring default...\").trigger()\r\n\t\tsongStore.data = {\r\n\t\t\tsong: {}, eventType: 'stop', start: 0\r\n\t\t}\r\n\t}\r\n\t\r\n\thandleKeyboard =async (event) => {\r\n\t\tconst { thereIsSong } = this.state\r\n        if (event.repeat) return\r\n        if (document.activeElement.tagName === \"INPUT\") return\r\n        if(event.shiftKey){\r\n            switch(event.code){\r\n                case \"KeyC\" : {\r\n                    if(!thereIsSong){\r\n\t\t\t\t\t\tthis.toggleRecord()\r\n\t\t\t\t\t\tevent.preventDefault()\r\n\t\t\t\t\t}\r\n                    break;\r\n                }\r\n\t\t\t\tdefault: break;\r\n            }\r\n        }\r\n    }\r\n\r\n\tresetDrag = (e) => {\r\n\t\tthis.setState({\r\n\t\t\tisDragging: false\r\n\t\t})\r\n\t}\r\n\r\n\thandleDragOver = (e) => {\r\n\t\te.preventDefault()\r\n\t\tthis.setState({\r\n\t\t\tisDragging: true\r\n\t\t})\r\n\t}\r\n\r\n\thandleDrag = (e) => {\r\n\t\te.preventDefault()\r\n\t\tthis.setState({\r\n\t\t\tisDragging: true\r\n\t\t})\r\n\t}\r\n\r\n\tsetHasSong = (data) => {\r\n\t\tthis.setState({\r\n\t\t\tthereIsSong: data\r\n\t\t})\r\n\t}\r\n\r\n\thandleDrop = async (e) => {\r\n\t\tthis.resetDrag()\r\n\t\te.preventDefault()\r\n\t\tlet songs = await Promise.all(Array.from(e.dataTransfer.files).map(file => file.text()))\r\n\t\tfor (let i = 0; i < songs.length; i++) {\r\n\t\t\ttry {\r\n\t\t\t\tlet song = prepareSongImport(JSON.parse(songs[i]))\r\n\t\t\t\tawait this.addSong(song)\r\n\t\t\t} catch (e) {\r\n\t\t\t\tconsole.error(e)\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t}\r\n\r\n\ttoggleReverbNodes = (hasReverb) => {\r\n\t\tif(!this.mounted) return\r\n\t\tconst { instrument } = this.state\r\n\t\tif (hasReverb) {\r\n\t\t\tif (!this.reverbNode) return console.log(\"Couldn't connect to reverb\")\r\n\t\t\tinstrument.disconnect()\r\n\t\t\tinstrument.connect(this.reverbNode)\r\n\t\t} else {\r\n\t\t\tinstrument.disconnect()\r\n\t\t\tinstrument.connect(this.audioContext.destination)\r\n\t\t}\r\n\t}\r\n\r\n\tchangeVolume = (obj) => {\r\n        let settings = this.state.settings\r\n        if (obj.key === \"instrument\") {\r\n\t\t\tsettings.instrument = {...settings.instrument, volume: obj.value}\r\n            this.state.instrument.changeVolume(obj.value)\r\n        }\r\n        this.setState({\r\n            settings: settings\r\n        }, () => this.updateSettings())\r\n    }\r\n\r\n\tgetSettings = () => {\r\n\t\t//TODO export this into a function / class\r\n\t\tlet storedSettings = localStorage.getItem(appName + \"_Main_Settings\")\r\n\t\ttry {\r\n\t\t\tstoredSettings = JSON.parse(storedSettings)\r\n\t\t} catch (e) {\r\n\t\t\tstoredSettings = null\r\n\t\t}\r\n\t\tif (storedSettings !== null) {\r\n\t\t\tif (storedSettings.settingVesion !== MainPageSettings.settingVesion) {\r\n\t\t\t\tthis.updateSettings(MainPageSettings)\r\n\t\t\t\treturn MainPageSettings\r\n\t\t\t}\r\n\t\t\treturn storedSettings\r\n\t\t}\r\n\t\treturn MainPageSettings\r\n\t}\r\n\r\n\tloadInstrument = async (name) => {\r\n\t\tthis.state.instrument?.delete?.()\r\n\t\tlet newInstrument = new Instrument(name)\r\n\t\tnewInstrument.changeVolume(this.state.settings.instrument.volume || 100)\r\n\t\tthis.setState({ isLoadingInstrument: true })\r\n\t\tawait newInstrument.load()\r\n\t\tif(!this.mounted) return \r\n\t\tnewInstrument.connect(this.audioContext.destination)\r\n\t\tthis.setState({\r\n\t\t\tinstrument: newInstrument,\r\n\t\t\tisLoadingInstrument: false\r\n\t\t}, () => this.toggleReverbNodes(this.state.settings.caveMode.value))\r\n\t}\r\n\r\n\tloadReverb() {\r\n\t\t//TODO export this to a function \r\n\t\treturn new Promise(resolve => {\r\n\t\t\tfetch(\"./assets/audio/reverb4.wav\")\r\n\t\t\t\t.then(r => r.arrayBuffer())\r\n\t\t\t\t.then(b => {\r\n\t\t\t\t\tif(!this.mounted) return\r\n\t\t\t\t\tthis.audioContext.decodeAudioData(b, (impulse_response) => {\r\n\t\t\t\t\t\tif(!this.mounted) return\r\n\t\t\t\t\t\tlet convolver = this.audioContext.createConvolver()\r\n\t\t\t\t\t\tlet gainNode = this.audioContext.createGain()\r\n\t\t\t\t\t\tgainNode.gain.value = 2.5\r\n\t\t\t\t\t\tconvolver.buffer = impulse_response\r\n\t\t\t\t\t\tconvolver.connect(gainNode)\r\n\t\t\t\t\t\tgainNode.connect(this.audioContext.destination)\r\n\t\t\t\t\t\tthis.reverbVolumeNode = gainNode\r\n\t\t\t\t\t\tthis.reverbNode = convolver\r\n\t\t\t\t\t\tresolve()\r\n\t\t\t\t\t})\r\n\t\t\t\t}).catch((e) => {\r\n\t\t\t\t\tconsole.log(\"Error with reverb\", e)\r\n\t\t\t\t})\r\n\t\t})\r\n\t}\r\n\r\n\tplaySound = (note) => {\r\n\t\tconst { state } = this\r\n\t\tconst { settings } = state\r\n\t\tif (note === undefined) return\r\n\t\tif (state.isRecording) this.handleRecording(note)\r\n\t\tthis.state.instrument.play(note.index, getPitchChanger(settings.pitch.value))\r\n\t}\r\n\r\n\tupdateSettings = (override) => {\r\n\t\t//TODO make settings a global state and wrap it into a class to update it\r\n\t\tlet state\r\n\t\tif (override !== undefined) {\r\n\t\t\tstate = override\r\n\t\t} else {\r\n\t\t\tstate = this.state.settings\r\n\t\t}\r\n\t\tlocalStorage.setItem(appName + \"_Main_Settings\", JSON.stringify(state))\r\n\t}\r\n\r\n\thandleSettingChange = (setting) => {\r\n\t\tlet settings = this.state.settings\r\n\t\tlet data = setting.data\r\n\t\tsettings[setting.key] = {...settings[setting.key], value: data.value}\r\n\t\tif (setting.key === \"instrument\") {\r\n\t\t\tthis.loadInstrument(data.value)\r\n\t\t}\r\n\t\tif (setting.key === 'caveMode') {\r\n\t\t\tthis.toggleReverbNodes(data.value)\r\n\t\t}\r\n\t\tthis.setState({\r\n\t\t\tsettings: settings,\r\n\t\t}, this.updateSettings)\r\n\t}\r\n\r\n\tsyncSongs = async () => {\r\n\t\tthis.setState({\r\n\t\t\tsongs: await DB.getSongs()\r\n\t\t})\r\n\t}\r\n\r\n\tsongExists = async (name) => {\r\n\t\treturn await DB.existsSong({ name: name })\r\n\t}\r\n\r\n\taddSong = async (song) => {\r\n\t\ttry {\r\n\t\t\tif (await this.songExists(song.name)) {\r\n\t\t\t\treturn new LoggerEvent(\"Warning\", \"A song with this name already exists! \\n\" + song.name).trigger()\r\n\t\t\t}\r\n\t\t\tawait DB.addSong(song)\r\n\t\t\tthis.syncSongs()\r\n\t\t\tnew LoggerEvent(\"Success\", `Song added to the ${song.data.isComposedVersion ? \"Composed\" : \"Recorded\"} tab!`, 4000).trigger()\r\n\t\t} catch (e) {\r\n\t\t\tconsole.error(e)\r\n\t\t\treturn new LoggerEvent(\"Error\", 'There was an error importing the song').trigger()\r\n\t\t}\r\n\t}\r\n\t\r\n\tremoveSong = async (name) => {\r\n\t\tlet result = await asyncConfirm(`Are you sure you want to delete the song: \"${name}\" ?`)\r\n\t\tif(!this.mounted) return\r\n\t\tif (result) {\r\n\t\t\tawait DB.removeSong({ name: name })\r\n\t\t\tthis.syncSongs()\r\n\t\t}\r\n\t\tAnalytics.userSongs({name: name, page: 'player'},'delete')\r\n\t}\r\n\r\n\thandleRecording = (note) => {\r\n\t\tif (this.state.isRecording) {\r\n\t\t\tthis.recording.addNote(note.index)\r\n\t\t}\r\n\t}\r\n\r\n\taskForSongName = () => {\r\n\t\treturn new Promise(async resolve => {\r\n\t\t\tlet promptString = \"Write song name, press cancel to ignore\"\r\n\t\t\twhile (true) {\r\n\t\t\t\tlet songName = await asyncPrompt(promptString)\r\n\t\t\t\tif (songName === null) return resolve(null)\r\n\t\t\t\tif (songName !== \"\") {\r\n\t\t\t\t\tif (await this.songExists(songName)) {\r\n\t\t\t\t\t\tpromptString = \"This song already exists: \" + songName\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\treturn resolve(songName)\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tpromptString = \"Write song name, press cancel to ignore\"\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\r\n\ttoggleRecord = async (override) => {\r\n\t\tif (typeof override !== \"boolean\") override = undefined\r\n\t\tlet newState = override !== undefined ? override : !this.state.isRecording\r\n\t\tif (!newState && this.recording.notes.length > 0) { //if there was a song recording\r\n\t\t\tlet songName = await this.askForSongName()\r\n\t\t\tif(!this.mounted) return\r\n\t\t\tlet song = new Song(songName, this.recording.notes)\r\n\t\t\tsong.pitch = this.state.settings.pitch.value\r\n\t\t\tif (songName !== null){ \r\n\t\t\t\tthis.addSong(song)\r\n\t\t\t\tAnalytics.userSongs({name: songName, page: 'player'},'record')\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tthis.recording = new Recording()\r\n\t\t}\r\n\t\tthis.state.isRecording = newState\r\n\t\tthis.setState({\r\n\t\t\topen: this.state.isRecording\r\n\t\t})\r\n\r\n\t}\r\n\r\n\ttoggleRecordAudio = async (override) => {\r\n\t\tif(!this.mounted) return\r\n\t\tif (typeof override !== \"boolean\") override = undefined\r\n\t\tconst { instrument } = this.state\r\n\t\tconst { recorder } = this\r\n\t\tconst hasReverb = this.state.settings.caveMode.value\r\n\t\tconst newState = override !== undefined ? override : !this.state.isRecordingAudio\r\n\t\tif (newState) {\r\n\t\t\tif (hasReverb) {\r\n\t\t\t\tthis.reverbVolumeNode.connect(recorder.node)\r\n\t\t\t} else {\r\n\t\t\t\tinstrument.connect(recorder.node)\r\n\t\t\t}\r\n\t\t\trecorder.start()\r\n\t\t} else {\r\n\t\t\tlet recording = await recorder.stop()\r\n\t\t\tlet fileName = await asyncPrompt(\"Write the song name, press cancel to ignore\")\r\n\t\t\tif(!this.mounted) return\r\n\t\t\tif (fileName) recorder.download(recording.data, fileName + '.wav')\r\n\t\t\tthis.toggleReverbNodes(hasReverb)\r\n\t\t\tthis.reverbVolumeNode.disconnect()\r\n\t\t\tthis.reverbVolumeNode.connect(audioContext.destination)\r\n\r\n\t\t}\r\n\t\tthis.setState({\r\n\t\t\tisRecordingAudio: newState\r\n\t\t})\r\n\t}\r\n\r\n\trender() {\r\n\t\tconst { state } = this\r\n\t\tconst keyboardFunctions = {\r\n\t\t\tchangeSliderState: this.changeSliderState,\r\n\t\t\tplaySound: this.playSound,\r\n\t\t\tsetHasSong: this.setHasSong\r\n\t\t}\r\n\t\tconst keyboardData = {\r\n\t\t\tisLoading: state.isLoadingInstrument,\r\n\t\t\tkeyboard: state.instrument,\r\n\t\t\tpitch: state.settings.pitch.value,\r\n\t\t\tkeyboardSize: state.settings.keyboardSize.value,\r\n\t\t\tnoteNameType: state.settings.noteNameType.value,\r\n\t\t\thasSong: state.thereIsSong,\r\n\t\t\thasAnimation: state.settings.noteAnimation.value,\r\n\t\t\tapproachRate: state.settings.approachSpeed.value\r\n\t\t}\r\n\t\tconst menuFunctions = {\r\n\t\t\taddSong: this.addSong,\r\n\t\t\tremoveSong: this.removeSong,\r\n\t\t\tchangePage: this.props.changePage,\r\n\t\t\thandleSettingChange: this.handleSettingChange,\r\n\t\t\tchangeVolume: this.changeVolume\r\n\t\t}\r\n\t\tconst menuData = {\r\n\t\t\tsongs: state.songs,\r\n\t\t\tsettings: state.settings\r\n\t\t}\r\n\r\n\t\treturn <div className='app bg-image' style={{ backgroundImage: `url(${state.settings.backgroundImage.value})` }}>\r\n\t\t\t{songStore.data.eventType !== 'approaching' &&\r\n\t\t\t\t<div className='record-button'>\r\n\t\t\t\t\t<AppButton\r\n\t\t\t\t\t\tactive={state.isRecordingAudio}\r\n\t\t\t\t\t\tclick={this.toggleRecordAudio}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t{state.isRecordingAudio ? \"Finish recording\" : \"Record audio\"}\r\n\t\t\t\t\t</AppButton>\r\n\t\t\t\t</div>\r\n\t\t\t}\r\n\r\n\t\t\t{state.isDragging && <div className='drag-n-drop'>\r\n\t\t\t\tDrop file here\r\n\t\t\t</div>}\r\n\t\t\t<Menu functions={menuFunctions} data={menuData} />\r\n\t\t\t<div className=\"right-panel\">\r\n\t\t\t\t<div className=\"upper-right\">\r\n\t\t\t\t\t{!this.state.thereIsSong\r\n\t\t\t\t\t\t&&\r\n\t\t\t\t\t\t<AppButton\r\n\t\t\t\t\t\t\tactive={state.isRecording}\r\n\t\t\t\t\t\t\tclick={this.toggleRecord}\r\n\t\t\t\t\t\t\tstyle={{marginTop: \"0.8rem\"}}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t{state.isRecording ? \"Stop\" : \"Record\"}\r\n\t\t\t\t\t\t</AppButton>\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"keyboard-wrapper\" style={{marginBottom: '2vh'}}>\r\n\t\t\t\t\t<Keyboard\r\n\t\t\t\t\t\tkey={state.instrument.instrumentName}\r\n\t\t\t\t\t\tdata={keyboardData}\r\n\t\t\t\t\t\tfunctions={keyboardFunctions}\r\n\t\t\t\t\t/>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\r\n\r\n\t}\r\n}\r\n\r\n\r\nfunction setIfInTWA() {\r\n\tif (isTwa()) return console.log('inTWA')\r\n\tlet isInTwa = document.referrer.includes('android-app://')\r\n\tsessionStorage.setItem('isTwa', isInTwa)\r\n}\r\nsetIfInTWA()\r\nfunction AppButton(props) {\r\n\tlet className = \"genshin-button \" + (props.active ? \"selected\" : \"\")\r\n\treturn <button className={className} onClick={props.click} style={{ ...(props.style || {}) }}>\r\n\t\t{props.children}\r\n\t</button>\r\n}\r\nexport default App;\r\n","export default __webpack_public_path__ + \"static/media/addCell.73b6c8e9.svg\";","export default __webpack_public_path__ + \"static/media/removeCell.e266ba1a.svg\";","import { useState, useEffect } from 'react';\r\nfunction useDebounce(value, delay) {\r\n  const [debouncedValue, setDebouncedValue] = useState(value);\r\n  useEffect(\r\n    () => {\r\n      const handler = setTimeout(() => {\r\n        setDebouncedValue(value);\r\n      }, delay);\r\n      return () => {\r\n        clearTimeout(handler);\r\n      };\r\n    },\r\n    [value, delay]\r\n  );\r\n  return debouncedValue;\r\n}\r\nexport default useDebounce;","import React, { Component, useEffect, useState } from 'react'\r\nimport { FilePicker } from \"react-file-picker\"\r\nimport { Midi } from '@tonejs/midi'\r\nimport { LoggerEvent, pitchArr, ColumnNote, Column, numberToLayer, ComposedSong, groupByIndex, mergeLayers } from 'lib/Utils'\r\nimport { appName } from 'appConfig'\r\nimport { FaInfoCircle } from 'react-icons/fa'\r\nimport useDebounce from 'lib/hooks/useDebounce'\r\nclass MidiImport extends Component {\r\n    constructor(props) {\r\n        super(props)\r\n        this.state = {\r\n            fileName: '',\r\n            midi: null, \r\n            bpm: 220,\r\n            offset: 0,\r\n            pitch: 'C',\r\n            accidentals: 0,\r\n            outOfRange: 0,\r\n            totalNotes: 0,\r\n            includeAccidentals: true\r\n        }\r\n    }\r\n    handleFile = (file) => {\r\n        const reader = new FileReader();\r\n        reader.addEventListener('load', (event) => {\r\n            let midi\r\n            try {\r\n                midi = new Midi(event.target.result)\r\n            } catch (e) {\r\n                console.error(e)\r\n            }\r\n            if (!midi) return new LoggerEvent('Error', 'There was an error importing this file', 2000).trigger()\r\n            let bpm = midi.header.tempos[0]?.bpm\r\n            let key = midi.header.keySignatures[0]?.key\r\n            midi.tracks.forEach((track, i) => {\r\n                track.selected = true\r\n                track.layer = 0\r\n                track.name = track.name || `Track n.${i + 1}`\r\n                track.numberOfAccidentals = 0\r\n                track.numberOfOutOfRange = 0\r\n            })\r\n            this.setState({\r\n                midi: midi,\r\n                fileName: file.name,\r\n                bpm: Math.floor(bpm * 4) || 220,\r\n                offset: 0,\r\n                pitch: pitchArr.includes(key) ? key : 'C',\r\n            }, () => { if (this.state.midi !== null) this.convertMidi() })\r\n        })\r\n        reader.readAsArrayBuffer(file)\r\n    }\r\n\r\n    convertMidi = () => {\r\n        const { midi, bpm, offset, includeAccidentals, pitch } = this.state\r\n        let tracks = midi.tracks.filter(track => track.selected)\r\n        let notes = []\r\n        let numberOfAccidentals = 0\r\n        let outOfRange = 0\r\n        let totalNotes = 0\r\n        tracks.forEach(track => {\r\n            track.numberOfAccidentals = 0\r\n            track.numberOfOutOfRange = 0\r\n            track.notes.forEach(midiNote => {\r\n                totalNotes++\r\n                let convertedNote = convertMidiNote(midiNote.midi - offset)\r\n                let note = {\r\n                    time: Math.floor(midiNote.time * 1000),\r\n                    note: convertedNote.note,\r\n                    layer: track.layer\r\n                }\r\n                if (convertedNote.isAccidental) {\r\n                    numberOfAccidentals++\r\n                    track.numberOfAccidentals++\r\n                }\r\n                if (note.note !== null) {\r\n                    if (includeAccidentals || !convertedNote.isAccidental) {\r\n                        notes.push(note)\r\n                    }\r\n                } else {\r\n                    outOfRange++\r\n                    track.numberOfOutOfRange++\r\n                }\r\n            })\r\n        })\r\n        notes = notes.sort((a, b) => a.time - b.time)\r\n        let bpmToMs = Math.floor(60000 / bpm)\r\n        let groupedNotes = []\r\n        while (notes.length > 0) {\r\n            let row = [notes.shift()]\r\n            let amount = 0\r\n            for (let i = 0; i < notes.length; i++) {\r\n                if (row[0].time > notes[i].time - bpmToMs / 9) amount++\r\n            }\r\n            groupedNotes.push([...row, ...notes.splice(0, amount)])\r\n        }\r\n        let columns = []\r\n        let previousTime = 0\r\n        groupedNotes.forEach(notes => {\r\n            let note = notes[0]\r\n            if (!note) return\r\n            let elapsedTime = note.time - previousTime\r\n            previousTime = note.time\r\n            let emptyColumns = Math.floor((elapsedTime - bpmToMs) / bpmToMs)\r\n            if (emptyColumns > -1) new Array(emptyColumns).fill(0).forEach(() => columns.push(new Column())) // adds empty columns\r\n            let noteColumn = new Column()\r\n            noteColumn.notes = notes.map(note => {\r\n                return new ColumnNote(note.note, numberToLayer(note.layer))\r\n            })\r\n            columns.push(noteColumn)\r\n        })\r\n        columns.forEach(column => { //merges notes of different layer\r\n            let groupedNotes = groupByIndex(column)\r\n            column.notes = groupedNotes.map(group => {\r\n                group[0].layer = mergeLayers(group)\r\n                return group[0]\r\n            })\r\n        })\r\n        let song = new ComposedSong(\"Untitled\")\r\n        song.columns = columns\r\n        song.bpm = bpm\r\n        song.instruments = this.props.data.instruments\r\n        song.pitch = pitch\r\n        let lastColumn = this.props.data.selectedColumn\r\n        song.selected = lastColumn < song.columns.length ? lastColumn : 0\r\n        if (song.columns.length === 0) {\r\n            return new LoggerEvent(\"Error\", \"There are no notes\", 2000).trigger()\r\n        }\r\n        this.props.functions.loadSong(song)\r\n        this.setState({\r\n            accidentals: numberOfAccidentals,\r\n            totalNotes: totalNotes,\r\n            outOfRange: outOfRange\r\n        })\r\n    }\r\n\r\n    editTrack = (command, data) => {\r\n        let tracks = this.state.midi.tracks\r\n        if (command === 'index') {\r\n\r\n            tracks[data.index].selected = !tracks[data.index].selected\r\n        }\r\n        if (command === 'layer') {\r\n            tracks[data.index].layer = data.layer\r\n        }\r\n\r\n        this.setState({\r\n            midi: this.state.midi\r\n        }, () => { if (this.state.midi !== null) this.convertMidi() })\r\n    }\r\n    changeOffset = (value) => {\r\n        value = parseInt(value)\r\n        if (!Number.isInteger(value)) value = 0\r\n        if (this.state.offset === value) return\r\n        this.setState({\r\n            offset: value\r\n        }, () => { if (this.state.midi !== null) this.convertMidi() })\r\n    }\r\n    changePitch = (value) => {\r\n        this.props.functions.changePitch(value)\r\n        this.setState({\r\n            pitch: value\r\n        })\r\n    }\r\n    toggleAccidentals = () => {\r\n        this.setState({\r\n            includeAccidentals: !this.state.includeAccidentals\r\n        }, () => { if (this.state.midi !== null) this.convertMidi() })\r\n    }\r\n    changeBpm = (value) => {\r\n        value = parseInt(value)\r\n        if (!Number.isInteger(value)) value = 0\r\n        if (this.state.bpm === value) return\r\n        this.setState({\r\n            bpm: value\r\n        }, () => { if (this.state.midi !== null) this.convertMidi() })\r\n    }\r\n    render() {\r\n        const { handleFile, editTrack, state, changeBpm, changeOffset, changePitch } = this\r\n        const { fileName, midi, bpm, offset, pitch, accidentals, outOfRange, totalNotes, includeAccidentals } = state\r\n        const { functions } = this.props\r\n        const { changeMidiVisibility } = functions\r\n        return <div className='floating-midi'>\r\n            <div\r\n                className='midi-row separator-border'\r\n                style={{ width: '100%' }}\r\n            >\r\n                <FilePicker onChange={handleFile}>\r\n                    <button className=\"midi-btn\">\r\n                        Click to load midi file\r\n                    </button>\r\n                </FilePicker>\r\n                <div style={{ margin: '0 0.5rem', maxWidth: '8rem', textOverflow: 'ellipsis', overflow: 'hidden' }}>\r\n                    {fileName}\r\n                </div>\r\n                <button\r\n                    className='midi-btn'\r\n                    style={{ marginLeft: 'auto' }}\r\n                    onClick={() => changeMidiVisibility(false)}\r\n                >\r\n                    Close\r\n                </button>\r\n            </div>\r\n            <table className='separator-border' style={{ width: \"100%\" }}>\r\n                <tbody>\r\n                    <tr>\r\n                        <td>\r\n                            <div style={{ marginRight: '0.5rem' }}>Bpm:</div>\r\n                        </td>\r\n                        <td style={{ display: 'flex', justifyContent: 'flex-end', alignItems: \"center\" }}>\r\n                            <NumberInput\r\n                                value={bpm}\r\n                                changeValue={changeBpm}\r\n                                delay={600}\r\n                                step={5}\r\n                            />\r\n                        </td>\r\n                    </tr>\r\n                    <tr>\r\n                        <td>\r\n                            <div style={{ marginRight: '0.5rem' }}>Scale notes by: </div>\r\n                        </td>\r\n                        <td>\r\n                            <NumberInput\r\n                                value={offset}\r\n                                changeValue={changeOffset}\r\n                                delay={600}\r\n                                step={1}\r\n                            />\r\n                        </td>\r\n                    </tr>\r\n                    <tr>\r\n                        <td>\r\n                            <div style={{ marginRight: '0.5rem' }}>Pitch:</div>\r\n                        </td>\r\n                        <td style={{ display: 'flex', justifyContent: 'flex-end', alignItems: \"center\" }}>\r\n                            <select\r\n                                className='midi-select'\r\n                                value={pitch}\r\n                                onChange={(event) => changePitch(event.target.value)}\r\n                                style={{ backgroundColor: '#576377', width: '5rem' }}\r\n                            >\r\n                                <option value=\"C\">C</option>\r\n                                <option value=\"Db\">Db</option>\r\n                                <option value=\"D\">D</option>\r\n                                <option value=\"Eb\">Eb</option>\r\n                                <option value=\"E\">E</option>\r\n                                <option value=\"F\">F</option>\r\n                                <option value=\"Gb\">Gb</option>\r\n                                <option value=\"G\">G</option>\r\n                                <option value=\"Ab\">Ab</option>\r\n                                <option value=\"A\">A</option>\r\n                                <option value=\"Bb\">Bb</option>\r\n                                <option value=\"B\">B</option>\r\n                            </select>\r\n                        </td>\r\n                    </tr>\r\n                    <tr>\r\n                        <td>\r\n                            <div style={{ marginRight: '0.5rem' }}>Include accidentals:</div>\r\n                        </td>\r\n                        <td style={{ display: 'flex', justifyContent: 'flex-end' }}>\r\n                            <input type='checkbox'\r\n                                checked={includeAccidentals}\r\n                                onChange={this.toggleAccidentals}\r\n                            />\r\n                        </td>\r\n                    </tr>\r\n                </tbody>\r\n            </table>\r\n            {midi !== null && <div className='midi-column separator-border' style={{ width: '100%' }}>\r\n                <div className='midi-column' style={{ width: '100%' }}>\r\n                    <div>Select midi tracks</div>\r\n                    {midi?.tracks.map((track, i) =>\r\n                        <Track\r\n                            data={track}\r\n                            key={i}\r\n                            index={i}\r\n                            editTrack={editTrack}\r\n                        />\r\n                    )}\r\n                </div>\r\n            </div>\r\n            }\r\n            {midi !== null && <table>\r\n                <tbody>\r\n                    <tr>\r\n                        <td>Total notes: </td>\r\n                        <td />\r\n                        <td>{totalNotes}</td>\r\n                    </tr>\r\n                    <tr>\r\n                        <td>Accidentals: </td>\r\n                        <td />\r\n                        <td>{accidentals}</td>\r\n                    </tr>\r\n                    <tr>\r\n                        <td>Out of range: </td>\r\n                        <td />\r\n                        <td>{outOfRange}</td>\r\n                    </tr>\r\n                </tbody>\r\n            </table>\r\n            }\r\n        </div>\r\n    }\r\n}\r\n\r\nfunction Track(props) {\r\n    const { data, index, editTrack } = props\r\n    const [dataShown, setDataShown] = useState(false)\r\n    return <div className='midi-track-column'>\r\n        <div className='midi-track-wrapper'>\r\n            <div className='midi-track-center'>\r\n                <input type='checkbox' onChange={() => editTrack(\"index\", { index: index })} checked={data.selected} />\r\n                {data.name} ({data.notes.length})\r\n            </div>\r\n            <div className='midi-track-center'>\r\n                <div style={{ textAlign: 'center' }}>\r\n                    {data.instrument.family}\r\n                </div>\r\n                <select\r\n                    onChange={(event) => editTrack('layer', { index: index, layer: Number(event.target.value) })}\r\n                    value={data.layer}\r\n                    className='midi-select'\r\n                >\r\n                    <option value='0'>Layer 1</option>\r\n                    <option value='1'>Layer 2</option>\r\n                    <option value='2'>Layer 3</option>\r\n                </select>\r\n\r\n                <FaInfoCircle\r\n                    size={22}\r\n                    color={dataShown ? \"rgb(207, 122, 130)\" : \"white\"}\r\n                    onClick={() => setDataShown(!dataShown)}\r\n                    cursor='pointer'\r\n                />\r\n            </div>\r\n\r\n        </div>\r\n        <div className='midi-track-data' style={{ display: dataShown ? \"flex\" : \"none\" }}>\r\n            <div className='midi-track-data-row'>\r\n                <div>Instrument:</div>\r\n                <div>{data.instrument.name}</div>\r\n            </div>\r\n            <div className='midi-track-data-row'>\r\n                <div>Number of notes:</div>\r\n                <div>{data.notes.length}</div>\r\n            </div>\r\n            <div className='midi-track-data-row'>\r\n                <div>Accidentals:</div>\r\n                <div>{data.numberOfAccidentals}</div>\r\n            </div>\r\n            <div className='midi-track-data-row'>\r\n                <div>Out of range:</div>\r\n                <div>{data.numberOfOutOfRange}</div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n}\r\n\r\nexport default MidiImport\r\n\r\nfunction NumberInput(props) {\r\n    const { changeValue, value, delay = 500, step = 1 } = props\r\n    const [elementValue, setElementValue] = useState(value)\r\n    const debounced = useDebounce(elementValue, delay)\r\n    useEffect(() => {\r\n        changeValue(debounced)\r\n        // eslint-disable-next-line react-hooks/exhaustive-deps\r\n    }, [debounced]);\r\n    useEffect(() => {\r\n        setElementValue(value)\r\n    }, [value])\r\n    return <div style={{ display: 'flex', justifyContent: 'flex-end' }} >\r\n        <button\r\n            onClick={() => setElementValue(elementValue - step)}\r\n            className='midi-btn-small'\r\n        >-</button>\r\n        <input\r\n            type=\"text\"\r\n            value={elementValue}\r\n            onChange={(e) => setElementValue(e.target.value)}\r\n            className='midi-input'\r\n            style={{ margin: '0 0.3rem' }}\r\n        />\r\n        <button\r\n            onClick={() => setElementValue(elementValue + step)}\r\n            className='midi-btn-small'\r\n        >+</button>\r\n    </div>\r\n}\r\n\r\nfunction convertMidiNote(midiNote) {\r\n    let note = null\r\n    let isAccidental = false\r\n    if (appName === 'Sky') {\r\n        switch (midiNote) {\r\n            case 60: note = 0; break;\r\n            case 61: note = 0; isAccidental = true; break;\r\n            case 62: note = 1; break;\r\n            case 63: note = 1; isAccidental = true; break;\r\n            case 64: note = 2; break;\r\n            case 65: note = 3; break;\r\n            case 66: note = 3; isAccidental = true; break;\r\n            case 67: note = 4; break;\r\n            case 68: note = 4; isAccidental = true; break;\r\n            case 69: note = 5; break;\r\n            case 70: note = 5; isAccidental = true; break;\r\n            case 71: note = 6; break;\r\n            case 72: note = 7; break;\r\n            case 73: note = 7; isAccidental = true; break;\r\n            case 74: note = 8; break;\r\n            case 75: note = 8; isAccidental = true; break;\r\n            case 76: note = 9; break;\r\n            case 77: note = 10; break;\r\n            case 78: note = 10; isAccidental = true; break;\r\n            case 79: note = 11; break;\r\n            case 80: note = 11; isAccidental = true; break;\r\n            case 81: note = 12; break;\r\n            case 82: note = 12; isAccidental = true; break;\r\n            case 83: note = 13; break;\r\n            case 84: note = 14; break;\r\n            default: note = null;\r\n        }\r\n    }\r\n    if (appName === 'Genshin') {\r\n        switch (midiNote) {\r\n            case 48: note = 14; break;\r\n            case 49: note = 14; isAccidental = true; break;\r\n            case 50: note = 15; break;\r\n            case 51: note = 15; isAccidental = true; break;\r\n            case 52: note = 16; break;\r\n            case 53: note = 17; break;\r\n            case 54: note = 17; isAccidental = true; break;\r\n            case 55: note = 18; break;\r\n            case 56: note = 18; isAccidental = true; break;\r\n            case 57: note = 19; break;\r\n            case 58: note = 19; isAccidental = true; break;\r\n            case 59: note = 20; break;\r\n            case 60: note = 7; break;\r\n            case 61: note = 7; isAccidental = true; break;\r\n            case 62: note = 8; break;\r\n            case 63: note = 8; isAccidental = true; break;\r\n            case 64: note = 9; break;\r\n            case 65: note = 10; break;\r\n            case 66: note = 10; isAccidental = true; break;\r\n            case 67: note = 11; break;\r\n            case 68: note = 11; isAccidental = true; break;\r\n            case 69: note = 12; break;\r\n            case 70: note = 12; isAccidental = true; break;\r\n            case 71: note = 13; break;\r\n            case 72: note = 0; break;\r\n            case 73: note = 0; isAccidental = true; break;\r\n            case 74: note = 1; break;\r\n            case 75: note = 1; isAccidental = true; break;\r\n            case 76: note = 2; break;\r\n            case 77: note = 3; break;\r\n            case 78: note = 3; isAccidental = true; break;\r\n            case 79: note = 4; break;\r\n            case 80: note = 4; isAccidental = true; break;\r\n            case 81: note = 5; break;\r\n            case 82: note = 5; isAccidental = true; break;\r\n            case 83: note = 6; break;\r\n            default: note = null;\r\n        }\r\n    }\r\n    return {\r\n        note: note,\r\n        isAccidental: isAccidental\r\n    }\r\n}","\r\nexport default function ComposerTools(props) {\r\n    const { data, functions } = props\r\n    const { toggleTools, copyColumns, eraseColumns, pasteColumns, deleteColumns } = functions\r\n    const { visible, copiedColumns } = data\r\n\r\n    return <div className={visible ? \"floating-tools tools-visible\" : \"floating-tools\"}>\r\n        <div className=\"tools-row\">\r\n            <div>\r\n                Scroll to the left / right to select the columns\r\n            </div>\r\n            <button onClick={toggleTools}>\r\n                Close\r\n            </button>\r\n        </div>\r\n        <div className=\"tools-buttons-wrapper\">\r\n            <div className='tools-half'>\r\n                <button\r\n                    disabled={copiedColumns.length !== 0}\r\n                    onClick={(e) => {\r\n                        e.currentTarget.blur()\r\n                        copyColumns('all')\r\n                    }}\r\n                    className={copiedColumns.length !== 0 ? \"tools-button-highlighted\" : \"\"}\r\n                >\r\n                    Copy\r\n                </button>\r\n                <button\r\n                    disabled={copiedColumns.length !== 0}\r\n                    onClick={(e) => {\r\n                        e.currentTarget.blur()\r\n                        copyColumns(data.layer)\r\n                    }}\r\n                    className={copiedColumns.length !== 0 ? \"tools-button-highlighted\" : \"\"}\r\n                >\r\n                    Copy layer {data.layer}\r\n                </button>\r\n            </div>\r\n            <div className='tools-half'>\r\n                <button\r\n                    disabled={copiedColumns.length === 0}\r\n                    onClick={(e) => {\r\n                        e.currentTarget.blur()\r\n                        pasteColumns(false)\r\n                    }}\r\n                >\r\n                    Paste\r\n                </button>\r\n                <button\r\n                    disabled={copiedColumns.length === 0}\r\n                    onClick={(e) => {\r\n                        e.currentTarget.blur()\r\n                        pasteColumns(true)\r\n                    }}\r\n                >\r\n                    Insert\r\n                </button>\r\n            </div>\r\n            <div className='tools-half'>\r\n                <button\r\n                    disabled={copiedColumns.length !== 0}\r\n                    onClick={(e) => {\r\n                        e.currentTarget.blur()\r\n                        eraseColumns('all')\r\n                    }}\r\n                >\r\n                    Erase\r\n                </button>\r\n                <button\r\n                    disabled={copiedColumns.length !== 0}\r\n                    onClick={(e) => {\r\n                        e.currentTarget.blur()\r\n                        eraseColumns(data.layer)\r\n                    }}\r\n                >\r\n                    Erase layer {data.layer}\r\n                </button>\r\n            </div>\r\n\r\n            <button\r\n                disabled={copiedColumns.length !== 0}\r\n                onClick={deleteColumns}\r\n            >\r\n                Delete\r\n            </button>\r\n        </div>\r\n    </div>\r\n}","import React, { memo } from 'react'\r\nimport { cssClasses, appName, instrumentsData } from \"appConfig\"\r\nimport GenshinNoteBorder from 'components/GenshinNoteBorder'\r\n\r\nexport default memo(function ComposerNote({ data, layers, instrument, clickAction, noteText, noteImage }) {\r\n    let className = cssClasses.noteComposer\r\n    if (layers[0] === \"1\") className += \" layer-1\"\r\n    if (layers[1] === \"1\") className += \" layer-2\"\r\n    if (layers[2] === \"1\") className += \" layer-3\"\r\n    let layer3Class = \"Sky\" ? \"layer-3-ball-bigger\" : \"layer-3-ball\"\r\n    let effects = instrumentsData[instrument]?.effects || {}\r\n    return <button onPointerDown={() => clickAction(data)} className=\"button-hitbox\">\r\n        <div className={className} >\r\n            <img\r\n                draggable=\"false\"\r\n                alt={data.noteNames.mobile}\r\n                src={noteImage}\r\n                style={effects}\r\n            >\r\n\r\n            </img>\r\n            {appName === 'Genshin' && <GenshinNoteBorder\r\n                className='genshin-border'\r\n            />}\r\n            <div className={layer3Class}>\r\n            </div>\r\n            <div className={appName === \"Sky\" ? \"note-name-sky\" : \"note-name\"}>\r\n                {noteText}\r\n            </div>\r\n        </div>\r\n    </button>\r\n}, (p, n) => {\r\n    return p.noteText === n.noteText && p.clickAction === n.clickAction && p.noteImage === n.noteImage\r\n        && p.noteText === n.noteText && p.layers === n.layers && p.instrument === n.instrument\r\n})\r\n","import { memo } from \"react\"\r\nexport default memo(function MultiSwitch(props){\r\n    const { options, selected, selectedColor, buttonsClass, onSelect } = props\r\n    return <>\r\n        {options.map(e => {\r\n            return <button\r\n                style={{ backgroundColor: e === selected ? selectedColor : \"\" }}\r\n                className={buttonsClass}\r\n                onClick={() => onSelect(e)}\r\n                key={e}\r\n            >\r\n                {e}\r\n            </button>\r\n        })}\r\n    </>\r\n},(p,n)=>{\r\n    return p.options?.length === n.options?.length \r\n        && p.selected === n.selected\r\n        && p.onSelect === n.onSelect\r\n})","import ComposerNote from \"./Components/ComposerNote\"\r\nimport { getNoteText } from 'lib/Utils'\r\nimport MultiSwitch from \"./Components/MultiSwitch\"\r\nimport { layoutImages, layersIndexes } from \"appConfig\"\r\n\r\nexport default function ComposerKeyboard({ data, functions }) {\r\n    let notesIndexes = data.currentColumn.notes.map((e) => e.index)\r\n    let hiddenSideMenu = data.isPlaying ? \" hidden\" : \"\"\r\n    let keyboardClass = \"keyboard\"\r\n    if (data.keyboard.layout.length === 15) keyboardClass += \" keyboard-5\"\r\n    if (data.keyboard.layout.length === 8) keyboardClass += \" keyboard-4\"\r\n    return <div>\r\n        <div className={keyboardClass}>\r\n            {data.keyboard.layout.length === 0 ? <div className=\"loading\">Loading...</div> : null}\r\n            {data.keyboard.layout.map((note, i) => {\r\n                let index = notesIndexes.indexOf(i)\r\n                let noteText = \"\"\r\n                let noteImage = \"\"\r\n                try {\r\n                    noteImage = layoutImages[data.keyboard.layout.length][note.index]\r\n                    noteText = getNoteText(data.noteNameType, note.index, data.pitch, data.keyboard.layout.length)\r\n                } catch (e) { }\r\n                return <ComposerNote\r\n                    key={note.index}\r\n                    layers={index >= 0 ? data.currentColumn.notes[index].layer : \"000\"}\r\n                    data={note}\r\n                    noteText={noteText}\r\n                    instrument={data.keyboard.instrumentName}\r\n                    noteImage={`./assets/icons/keys/${noteImage}.svg`}\r\n                    clickAction={functions.handleClick}\r\n                />\r\n            })}\r\n        </div>\r\n        <div className={\"bottom-right-wrapper\" + hiddenSideMenu}>\r\n            <div className={\"layer-buttons-wrapper\"}>\r\n                <div className=\"bottom-right-text\">\r\n                    Layer\r\n                </div>\r\n                <MultiSwitch\r\n                    buttonsClass={\"layer-button\"}\r\n                    selectedColor={\"#63aea7\"}\r\n                    options={layersIndexes}\r\n                    onSelect={functions.changeLayer}\r\n                    selected={data.layer}\r\n                />\r\n            </div>\r\n            <div className=\"tempo-changers-wrapper\">\r\n                <div className=\"bottom-right-text\">\r\n                    Tempo\r\n                </div>\r\n                {data.TempoChangers.map((e) => {\r\n                    return <button\r\n                        key={e.id}\r\n                        onClick={() => functions.handleTempoChanger(e)}\r\n                        style={{ backgroundColor: \"#\" + e.color.toString(16) }}\r\n                    >\r\n                        {e.text}\r\n                    </button>\r\n                })}\r\n            </div>\r\n        </div>\r\n    </div>\r\n}","import { TempoChangers } from \"lib/Utils\"\r\nimport { cacheData, notesPerColumn } from \"appConfig\"\r\nconst { noteData, horizontalLineBreak, standards, layersCombination, breakpoints } = cacheData\r\n\r\nexport class ComposerCache {\r\n    constructor(width, height, margin = 4, timelineHeight = 30) {\r\n        this.width = width\r\n        this.height = height\r\n        this.cache = {\r\n            columns: [],\r\n            notes: {},\r\n            standard: [],\r\n            columnsLarger: [],\r\n            standardLarger: [],\r\n            breakpoints: []\r\n        }\r\n        this.notesFigures = []\r\n        this.timelineHeight = timelineHeight\r\n        this.margin = margin\r\n        this.noteWidth = this.width\r\n        this.noteHeight = this.height / notesPerColumn\r\n        //TODO reuse the same canvas instead of remaking one for each element\r\n        /*\r\n        this.app = new PIXI.Application({\r\n            width: width,\r\n            height: height,\r\n            resolution: 2\r\n        })\r\n        */\r\n        this.generate()\r\n    }\r\n    destroy = () => {\r\n        //this.app.destroy()\r\n    }\r\n    generate = () => {\r\n        TempoChangers.forEach(tempoChanger => {\r\n            let canvas = drawColumn(tempoChanger, this, 1)\r\n            this.cache.columns.push(canvas.toDataURL())\r\n        })\r\n        standards.forEach(standardColumn => {\r\n            let canvas = drawColumn(standardColumn, this, 1)\r\n            this.cache.standard.push(canvas.toDataURL())\r\n        })\r\n        standards.forEach(standardColumn => {\r\n            let canvas = drawColumn(standardColumn, this, 3)\r\n            this.cache.standardLarger.push(canvas.toDataURL())\r\n        })\r\n        layersCombination.forEach(note => {\r\n            let roundNess = this.noteWidth > 20 ? 4 : 2\r\n            let canvas = document.createElement(\"canvas\")\r\n            canvas.height = this.noteHeight\r\n            canvas.width = this.noteWidth\r\n            let ctx = canvas.getContext(\"2d\")\r\n            if (note[0] === \"1\") {\r\n                ctx.fillStyle = noteData.background\r\n                roundRect(\r\n                    ctx,\r\n                    this.margin / 2,\r\n                    this.margin / 2,\r\n                    Math.ceil(this.noteWidth - this.margin - 1),\r\n                    Math.floor(this.noteHeight - this.margin - 1),\r\n                    roundNess,\r\n                    true,\r\n                    false\r\n                )\r\n            }\r\n            if (note[1] === \"1\") {\r\n                ctx.strokeStyle = noteData.border\r\n                ctx.lineWidth = 2\r\n                roundRect(\r\n                    ctx,\r\n                    this.margin / 2,\r\n                    this.margin / 2,\r\n                    Math.ceil(this.noteWidth - this.margin - 1),\r\n                    Math.floor(this.noteHeight - this.margin - 1),\r\n                    roundNess,\r\n                    false,\r\n                    true\r\n                )\r\n            }\r\n            if (note[2] === \"1\") {\r\n                ctx.beginPath()\r\n                ctx.fillStyle = noteData.center\r\n                let ballHeight = this.noteHeight / 4\r\n                ctx.arc(this.noteWidth / 2 - 0.5, this.noteHeight / 2 - 0.5, ballHeight, 0, 2 * Math.PI);\r\n                ctx.fill()\r\n            }\r\n            this.cache.notes[note] = canvas.toDataURL()\r\n        })\r\n        TempoChangers.forEach(tempoChanger => {\r\n            let canvas = drawColumn(tempoChanger, this, 2)\r\n            this.cache.columnsLarger.push(canvas.toDataURL())\r\n        })\r\n        breakpoints.forEach(breakpoint => {\r\n            let canvas = document.createElement(\"canvas\")\r\n            if (breakpoint.type === \"short\") {\r\n                let size = this.timelineHeight / 6\r\n                canvas.height = this.timelineHeight\r\n                canvas.width = size * 2\r\n                let ctx = canvas.getContext(\"2d\")\r\n                ctx.fillStyle = breakpoint.color\r\n                ctx.arc(size, this.timelineHeight / 2, size, 0, 2 * Math.PI);\r\n                ctx.fill()\r\n                this.cache.breakpoints.push(canvas.toDataURL())\r\n            } else {\r\n                canvas.height = this.height\r\n                canvas.width = this.width\r\n                let ctx = canvas.getContext(\"2d\")\r\n                ctx.fillStyle = breakpoint.color\r\n                /*\r\n               ctx.strokeStyle = breakpoint.color\r\n               ctx.lineWidth = 3\r\n                ctx.strokeRect(1,1,this.width - 3,this.height - 2)\r\n                */\r\n                ctx.beginPath();\r\n                ctx.moveTo(0, this.height)\r\n                ctx.lineTo(this.noteWidth / 2, this.height)\r\n                ctx.lineTo(0, this.height - this.noteHeight)\r\n                ctx.fill();\r\n                ctx.beginPath();\r\n                ctx.moveTo(this.width, this.height)\r\n                ctx.lineTo(this.noteWidth / 2, this.height)\r\n                ctx.lineTo(this.width, this.height - this.noteHeight)\r\n                ctx.fill();\r\n                ctx.beginPath();\r\n                ctx.moveTo(0, 0)\r\n                ctx.lineTo(this.noteWidth / 2, 0)\r\n                ctx.lineTo(0, this.noteHeight)\r\n                ctx.fill();\r\n                ctx.beginPath();\r\n                ctx.moveTo(this.width, 0)\r\n                ctx.lineTo(this.noteWidth / 2, 0)\r\n                ctx.lineTo(this.width, this.noteHeight)\r\n                ctx.fill();\r\n\r\n                this.cache.breakpoints.push(canvas.toDataURL())\r\n            }\r\n        })\r\n    }\r\n}\r\n\r\n\r\nfunction drawColumn(tempoChanger, self, borderWidth) {\r\n    let canvas = document.createElement(\"canvas\")\r\n    canvas.height = self.height\r\n    canvas.width = self.width\r\n    let ctx = canvas.getContext(\"2d\")\r\n    ctx.fillStyle = \"#\" + tempoChanger.color.toString(16)\r\n    ctx.fillRect(0, 0, self.width, self.height)\r\n    ctx.strokeStyle = borderWidth === 2 ? \"black\" : \"#333333\"\r\n    ctx.lineWidth = borderWidth\r\n    ctx.beginPath()\r\n    ctx.moveTo(self.width, 0)\r\n    ctx.lineTo(self.width, self.height)\r\n    ctx.stroke()\r\n    ctx.strokeStyle = \"#333333\"\r\n    for (let i = 1; i < 3; i++) {\r\n        ctx.lineWidth = 1\r\n        let y = self.noteHeight * horizontalLineBreak * i\r\n        ctx.moveTo(0, y)\r\n        ctx.lineTo(self.width, y)\r\n    }\r\n    ctx.stroke()\r\n    return canvas\r\n}\r\n\r\nfunction roundRect(ctx, x, y, width, height, radius = 5, fill, stroke = true) {\r\n    if (typeof radius === 'number') {\r\n        radius = { tl: radius, tr: radius, br: radius, bl: radius };\r\n    } else {\r\n        var defaultRadius = { tl: 0, tr: 0, br: 0, bl: 0 };\r\n        for (var side in defaultRadius) {\r\n            radius[side] = radius[side] || defaultRadius[side];\r\n        }\r\n    }\r\n    ctx.beginPath();\r\n    ctx.moveTo(x + radius.tl, y);\r\n    ctx.lineTo(x + width - radius.tr, y);\r\n    ctx.quadraticCurveTo(x + width, y, x + width, y + radius.tr);\r\n    ctx.lineTo(x + width, y + height - radius.br);\r\n    ctx.quadraticCurveTo(x + width, y + height, x + width - radius.br, y + height);\r\n    ctx.lineTo(x + radius.bl, y + height);\r\n    ctx.quadraticCurveTo(x, y + height, x, y + height - radius.bl);\r\n    ctx.lineTo(x, y + radius.tl);\r\n    ctx.quadraticCurveTo(x, y, x + radius.tl, y);\r\n    ctx.closePath();\r\n    if (fill) {\r\n        ctx.fill();\r\n    }\r\n    if (stroke) {\r\n        ctx.stroke();\r\n    }\r\n\r\n}\r\n","import React, { Component } from 'react'\r\nimport { Stage, Container, Graphics, Sprite } from '@inlet/react-pixi';\r\nimport { FaStepBackward, FaStepForward, FaPlusCircle, FaMinusCircle } from 'react-icons/fa';\r\nimport isMobile from \"is-mobile\"\r\nimport \"./Composer.css\"\r\nimport { ComposerCache } from \"./Cache\"\r\n\r\nimport { composerNotePositions, notesPerColumn, appName } from \"../../appConfig\"\r\nimport Memoized from 'components/Memoized';\r\nlet NumOfColumnsPerCanvas = 35\r\n\r\nexport default class ComposerCanvas extends Component {\r\n    constructor(props) {\r\n        super(props)\r\n        let sizes = document.body.getBoundingClientRect()\r\n        this.sizes = sizes\r\n        NumOfColumnsPerCanvas = Number(this.props.data.settings.columnsPerCanvas.value)\r\n        let width = nearestEven(sizes.width * 0.84)\r\n        let height = nearestEven(sizes.height * 0.45)\r\n\r\n        if (window.screen.width < sizes.height) {\r\n            width = nearestEven(sizes.height * 0.84)\r\n            height = nearestEven(sizes.width * 0.45)\r\n        }\r\n        if (appName === \"Sky\") height = nearestEven(height * 0.95)\r\n        this.state = {\r\n            width: Math.floor(width),\r\n            height: Math.floor(height),\r\n            column: {\r\n                width: calcMinColumnWidth(nearestEven(width)),\r\n                height: height\r\n            },\r\n            timelineHeight: isMobile() ? 25 : 30,\r\n            currentBreakpoint: -1\r\n        }\r\n        this.canvasRef = React.createRef()\r\n        let margin = isMobile() ? 1 : 4\r\n        this.cache = new ComposerCache(this.state.column.width, height, margin, this.state.timelineHeight)\r\n        this.stageSelected = false\r\n        this.sliderSelected = false\r\n        this.hasSlided = false\r\n        this.stagePreviousPositon = 0\r\n        this.sliderOffset = 0\r\n        this.throttleScroll = 0\r\n        this.onSlider = false\r\n    }\r\n    resetPointerDown = (e) => {\r\n        this.stageSelected = false\r\n        this.sliderSelected = false\r\n        this.stagePreviousPositon = 0\r\n    }\r\n    componentDidMount() {\r\n        window.addEventListener(\"pointerup\", this.resetPointerDown)\r\n        window.addEventListener(\"keydown\", this.handleKeyboard)\r\n        this.canvasRef.current._canvas.addEventListener(\"wheel\", this.handleWheel)\r\n    }\r\n    componentWillUnmount() {\r\n        window.removeEventListener(\"pointerup\", this.resetPointerDown)\r\n        window.removeEventListener(\"keydown\", this.handleKeyboard)\r\n        this.canvasRef.current._canvas.removeEventListener(\"wheel\", this.handleWheel)\r\n        this.cache.destroy()\r\n    }\r\n    handleKeyboard = (event) => {\r\n        let key = event.code\r\n        switch (key) {\r\n            case \"ArrowRight\": this.handleBreakpoints(1)\r\n                break;\r\n            case \"ArrowLeft\": this.handleBreakpoints(-1)\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n    }\r\n    handleWheel = (e) => {\r\n        this.props.functions.selectColumn(this.props.data.selected + Math.sign(e.deltaY), true)\r\n    }\r\n    handleClick = (e, type) => {\r\n        const x = e.data.global.x\r\n        const { width } = this.state\r\n        const { data } = this.props\r\n        if (type === \"up\") {\r\n            this.sliderSelected = false\r\n        }\r\n        if (type === \"down\") {\r\n            this.sliderSelected = true\r\n            const relativeColumnWidth = width / data.columns.length\r\n            const stageSize = relativeColumnWidth * (NumOfColumnsPerCanvas + 1)\r\n            const stagePosition = relativeColumnWidth * data.selected - (NumOfColumnsPerCanvas / 2) * relativeColumnWidth\r\n            this.onSlider = x > stagePosition && x < stagePosition + stageSize\r\n            this.sliderOffset = stagePosition + stageSize / 2 - x\r\n            this.throttleScroll = Number.MAX_SAFE_INTEGER\r\n            this.handleSlide(e)\r\n        }\r\n        if (type === \"downStage\") {\r\n            this.stagePreviousPositon = x\r\n            this.stageSelected = true\r\n        }\r\n    }\r\n    handleStageSlide = (e) => {\r\n        let x = e.data.global.x\r\n        if (this.stageSelected === true) {\r\n            if (this.throttleScroll++ < 5) return\r\n            this.throttleScroll = 0\r\n            const { data, functions } = this.props\r\n            const amount = clamp(Math.ceil(Math.abs(this.stagePreviousPositon - x) / 8), 0, 4)\r\n            const sign = this.stagePreviousPositon < x ? -1 : 1\r\n            this.stagePreviousPositon = x\r\n            const newPosition = data.selected + sign * amount\r\n            if (data.selected === newPosition) return\r\n            functions.selectColumn(clamp(newPosition, 0, data.columns.length - 1), true)\r\n        }\r\n    }\r\n    handleBreakpoints = (direction) => {\r\n        const { selected, columns, breakpoints } = this.props.data\r\n        let breakpoint = direction === 1 //1 = right, -1 = left\r\n            ? breakpoints.filter((v) => v > selected).sort((a, b) => a - b)\r\n            : breakpoints.filter((v) => v < selected).sort((a, b) => b - a)\r\n        if (breakpoint.length === 0) return\r\n        if (columns.length >= breakpoint[0] && breakpoint[0] >= 0) {\r\n            this.props.functions.selectColumn(breakpoint[0])\r\n        }\r\n    }\r\n    handleSlide = (e) => {\r\n        const globalX = e.data.global.x\r\n        if (this.sliderSelected) {\r\n            if (this.throttleScroll++ < 4) return\r\n            const { width, column } = this.state\r\n            const { data } = this.props\r\n            this.hasSlided = true\r\n            this.throttleScroll = 0\r\n            const totalWidth = column.width * data.columns.length\r\n            const x = this.onSlider ? (globalX + this.sliderOffset) : globalX\r\n            let relativePos = Math.floor(x / width * totalWidth / column.width)\r\n            this.props.functions.selectColumn(relativePos, true)\r\n        }\r\n    }\r\n\r\n    render() {\r\n        const { width, timelineHeight, height } = this.state\r\n        const { data, functions } = this.props\r\n        const cache = this.cache.cache\r\n        const sizes = this.state.column\r\n        const xPos = (data.selected - NumOfColumnsPerCanvas / 2 + 1) * - sizes.width\r\n        const beatMarks = Number(data.settings.beatMarks.value)\r\n        const counterLimit = beatMarks === 0 ? 11 : 4 * beatMarks - 1\r\n        const relativeColumnWidth = width / data.columns.length\r\n        let switcher = false\r\n        let counter = 0\r\n        let stageSize = Math.floor(relativeColumnWidth * (NumOfColumnsPerCanvas + 1))\r\n        if (stageSize > width) stageSize = width\r\n        const stagePosition = relativeColumnWidth * data.selected - (NumOfColumnsPerCanvas / 2 - 1) * relativeColumnWidth\r\n        return <div className=\"canvas-wrapper\" style={{ width: width + 2 }}>\r\n            <Stage\r\n                width={width}\r\n                height={height}\r\n                raf={false}\r\n                renderOnComponentChange={true}\r\n                options={{\r\n                    backgroundColor: 0x495466,\r\n                }}\r\n                key={this.state.width}\r\n                ref={this.canvasRef}\r\n            >\r\n                <Container\r\n                    anchor={[0.5, 0.5]}\r\n                    x={xPos}\r\n                    interactive={true}\r\n                    pointerdown={(e) => this.handleClick(e, \"downStage\")}\r\n                    pointermove={(e) => this.handleStageSlide(e)}\r\n                >\r\n                    {data.columns.map((column, i) => {\r\n                        if (counter++ > counterLimit) {\r\n                            switcher = !switcher\r\n                            counter = 0\r\n                        }\r\n                        if (!isVisible(i, data.selected)) return null\r\n                        const tempoChangersCache = (i + 1) % 4 === 0 ? cache.columnsLarger : cache.columns\r\n                        const standardCache = (i + 1) % 4 === 0 ? cache.standardLarger : cache.standard\r\n                        const background = column.tempoChanger === 0 ? standardCache[Number(switcher)] : tempoChangersCache[column.tempoChanger]\r\n                        return <Column\r\n                            cache={cache}\r\n                            key={i}\r\n                            data={column}\r\n                            index={i}\r\n                            sizes={sizes}\r\n                            backgroundCache={background}\r\n                            isToolsSelected={data.toolsColumns.includes(i)}\r\n                            click={functions.selectColumn}\r\n                            isSelected={i === data.selected}\r\n                            isBreakpoint={data.breakpoints.includes(i)}\r\n                        />\r\n\r\n                    })}\r\n\r\n                </Container>\r\n            </Stage>\r\n            <div className=\"timeline-wrapper\" style={{ height: this.state.timelineHeight }}>\r\n                <div className=\"timeline-button\" onClick={() => this.handleBreakpoints(-1)}>\r\n                    <Memoized>\r\n                        <FaStepBackward />\r\n                    </Memoized>\r\n                </div>\r\n                <div className=\"timeline-button\" onClick={() => this.handleBreakpoints(1)} style={{ marginLeft: 0 }}>\r\n                    <Memoized>\r\n                        <FaStepForward />  \r\n                    </Memoized>\r\n                </div>\r\n                <div className='timeline-scroll'>\r\n                    <Stage\r\n                        width={width}\r\n                        height={timelineHeight}\r\n                        options={{ antialias: true, autoDensity: true, backgroundColor: 0x515c6f }}\r\n                        raf={false}\r\n                        renderOnComponentChange={true}\r\n                    >\r\n                        <Container\r\n                            width={width}\r\n                            height={timelineHeight}\r\n                            interactive={true}\r\n                            pointerdown={(e) => this.handleClick(e, \"down\")}\r\n                            pointerup={(e) => this.handleClick(e, \"up\")}\r\n                            pointermove={this.handleSlide}\r\n                        >\r\n                            <Graphics draw={(e) => { fillX(e, width, timelineHeight) }} />\r\n                            {data.breakpoints.map(breakpoint => {\r\n                                return <Sprite\r\n                                    image={cache.breakpoints[0]}\r\n                                    key={breakpoint}\r\n                                    x={relativeColumnWidth * breakpoint}\r\n                                >\r\n                                </Sprite>\r\n                            })}\r\n                        </Container>\r\n                        <Graphics draw={(e) => drawStage(e, stageSize, timelineHeight)} x={stagePosition} y={2} />\r\n                    </Stage>\r\n                </div>\r\n                <div className=\"timeline-button\" onClick={functions.toggleBreakpoint}>\r\n                    <Memoized>\r\n                        {data.breakpoints.includes(data.selected) \r\n                            ? <FaMinusCircle key='minus'/>\r\n                            : <FaPlusCircle key='plus'/>\r\n                        }   \r\n                    </Memoized>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    }\r\n}\r\n\r\nfunction fillX(g, width, height) {\r\n    g.clear()\r\n    g.beginFill(0x515c6f, 1)\r\n    g.drawRect(0, 0, width, height)\r\n}\r\n\r\nfunction drawStage(g, width, height) {\r\n    g.clear()\r\n    g.lineStyle(3, 0x1a968b, 0.8)\r\n    g.drawRoundedRect(0, 0, width - 2, height - 4, 6)\r\n}\r\n\r\nfunction Column({ data, index, sizes, click, cache, backgroundCache, isBreakpoint, isSelected, isToolsSelected }) {\r\n    return <Container\r\n        pointertap={() => click(index)}\r\n        interactive={true}\r\n        x={sizes.width * index}\r\n    >\r\n        <Sprite\r\n            image={backgroundCache}\r\n            interactiveChildren={false}\r\n        >\r\n            {isSelected || isToolsSelected ? <Sprite\r\n                image={isToolsSelected && !isSelected ? cache.standard[3] : cache.standard[2]}\r\n                alpha={isToolsSelected ? 0.4 : 0.6}\r\n                zIndex={1}\r\n            >\r\n            </Sprite> : null}\r\n            {isBreakpoint ? <Sprite\r\n                image={cache.breakpoints[1]}\r\n            >\r\n            </Sprite> : null}\r\n        </Sprite>\r\n        {data.notes.map((note) => {\r\n            return <Sprite\r\n                key={note.index}\r\n                image={cache.notes[note.layer]}\r\n                y={composerNotePositions[note.index] * sizes.height / notesPerColumn}\r\n            >\r\n            </Sprite>\r\n        })}\r\n\r\n    </Container>\r\n}\r\nconst clamp = (num, min, max) => Math.min(Math.max(num, min), max);\r\n\r\nfunction calcMinColumnWidth(parentWidth) {\r\n    return nearestEven(parentWidth / NumOfColumnsPerCanvas)\r\n}\r\n\r\nfunction nearestEven(num) {\r\n    return 2 * Math.round(num / 2);\r\n}\r\n\r\nfunction isVisible(pos, currentPos) {\r\n    let threshold = NumOfColumnsPerCanvas / 2 + 2\r\n    let boundaries = [currentPos - threshold, currentPos + threshold]\r\n    return boundaries[0] < pos && pos < boundaries[1]\r\n}","import React, { Component } from 'react'\r\nimport { FaMusic, FaSave, FaCog, FaHome, FaTrash, FaDownload } from 'react-icons/fa';\r\nimport { FileDownloader, LoggerEvent, ComposerSongSerialization, prepareSongDownload } from \"lib/Utils\"\r\nimport { appName, isTwa } from 'appConfig'\r\nimport MenuItem from 'components/MenuItem'\r\nimport MenuPanel from 'components/MenuPanel'\r\nimport MenuClose from 'components/MenuClose'\r\nimport SettingsRow from 'components/SettingsRow'\r\nimport DonateButton from 'components/DonateButton'\r\nimport Memoized from 'components/Memoized';\r\nimport { isMidiAvailable } from 'appConfig';\r\nimport Analytics from 'lib/Analytics';\r\nclass Menu extends Component {\r\n    constructor(props) {\r\n        super(props)\r\n        this.state = {\r\n            open: false,\r\n            selectedMenu: \"Settings\",\r\n            selectedSongType: \"composed\",\r\n        }\r\n    }\r\n    componentDidMount() {\r\n        window.addEventListener(\"keydown\", this.handleKeyboard)\r\n    }\r\n    componentWillUnmount() {\r\n        window.removeEventListener(\"keydown\", this.handleKeyboard)\r\n    }\r\n    handleKeyboard = (event) => {\r\n        let key = event.code\r\n        if (document.activeElement.tagName === \"INPUT\") return\r\n        document.activeElement?.blur()\r\n        switch (key) {\r\n            case \"Escape\": {\r\n                if (this.state.open) this.props.functions.toggleMenuVisible()\r\n                this.setState({ open: false })\r\n                break\r\n            }\r\n            default: break;\r\n        }\r\n    }\r\n    toggleMenu = (override) => {\r\n        if (typeof override !== \"boolean\") override = undefined\r\n        let newState = override !== undefined ? override : !this.state.open\r\n        this.setState({\r\n            open: newState,\r\n        })\r\n        if (newState === false) {\r\n            this.props.functions.toggleMenuVisible()\r\n        }\r\n    }\r\n    changeSelectedSongType = (name) => {\r\n        this.setState({\r\n            selectedSongType: name\r\n        })\r\n    }\r\n    selectSideMenu = (selection) => {\r\n        if (selection === this.state.selectedMenu && this.state.open) {\r\n            return this.setState({\r\n                open: false,\r\n            })\r\n        }\r\n        this.setState({\r\n            selectedMenu: selection,\r\n            open: true\r\n        })\r\n        Analytics.UIEvent('menu',{tab: selection})\r\n    }\r\n    downloadSong = (song) => {\r\n        if (song._id) delete song._id\r\n        if (song.data.isComposedVersion) {\r\n            song = ComposerSongSerialization(song)\r\n        }\r\n        let songName = song.name\r\n        if (appName === \"Sky\") {\r\n            //adds old format into the sheet\r\n            song = prepareSongDownload(song)\r\n        }\r\n        if (!Array.isArray(song)) song = [song]\r\n        song.forEach(song1 => {\r\n            song1.data.appName = appName\r\n        })\r\n        let json = JSON.stringify(song)\r\n        let fileDownloader = new FileDownloader()\r\n        fileDownloader.download(json, `${songName}.${appName.toLowerCase()}sheet.json`)\r\n        new LoggerEvent(\"Success\", \"Song downloaded\").trigger()\r\n        Analytics.userSongs({name: song?.name, page: 'composer'},'download')\r\n    }\r\n    updateSong = () => {\r\n        this.props.functions.updateSong(this.props.data.currentSong)\r\n    }\r\n    render() {\r\n        const { data, functions } = this.props\r\n        let sideClass = this.state.open ? \"side-menu menu-open\" : \"side-menu\"\r\n        let selectedMenu = this.state.selectedMenu\r\n        const { loadSong, removeSong, changePage, handleSettingChange, changeVolume, createNewSong, changeMidiVisibility } = functions\r\n        let songFunctions = {\r\n            loadSong: loadSong,\r\n            removeSong: removeSong,\r\n            toggleMenu: this.toggleMenu,\r\n            downloadSong: this.downloadSong\r\n        }\r\n        let songs = data.songs.filter(song => !song.data?.isComposedVersion)\r\n        let composedSongs = data.songs.filter(song => song.data?.isComposedVersion)\r\n        let hasUnsaved = data.hasChanges ? \"margin-top-auto not-saved\" : \"margin-top-auto\"\r\n        let menuClass = data.menuOpen ? \"menu menu-visible\" : \"menu\"\r\n        return <div className=\"menu-wrapper\">\r\n            <div className={menuClass}>\r\n                <MenuClose action={this.toggleMenu} />\r\n                <MenuItem type=\"Save\" action={this.updateSong} className={hasUnsaved}>\r\n                    <Memoized>\r\n                        <FaSave className=\"icon\" />\r\n                    </Memoized>\r\n                </MenuItem>\r\n                <MenuItem type=\"Songs\" action={this.selectSideMenu}>\r\n                    <Memoized>\r\n                        <FaMusic className=\"icon\" />\r\n                    </Memoized>\r\n                </MenuItem>\r\n                <MenuItem type=\"Settings\" action={this.selectSideMenu}>\r\n                    <Memoized>\r\n                        <FaCog className=\"icon\" />\r\n                    </Memoized>\r\n                </MenuItem>\r\n                <MenuItem type=\"Home\" action={() => changePage(\"home\")}>\r\n                    <Memoized>\r\n                        <FaHome className=\"icon\" />\r\n                    </Memoized>\r\n                </MenuItem>\r\n            </div>\r\n            <div className={sideClass}>\r\n                <MenuPanel title=\"No selection\" visible={selectedMenu}>\r\n                </MenuPanel>\r\n                <MenuPanel title=\"Songs\" visible={selectedMenu}>\r\n                    <div className=\"songs-buttons-wrapper\">\r\n                        <button className=\"genshin-button\" onClick={() => { changeMidiVisibility(true); this.toggleMenu() }}>\r\n                            Create from MIDI\r\n                        </button>\r\n                        <button className=\"genshin-button\" onClick={createNewSong}>\r\n                            Create new song\r\n                        </button>\r\n                    </div>\r\n                    <div className=\"tab-selector-wrapper\">\r\n                        <button\r\n                            className={this.state.selectedSongType === \"recorded\" ? \"tab-selector tab-selected\" : \"tab-selector\"}\r\n                            onClick={() => this.changeSelectedSongType(\"recorded\")}\r\n                        >\r\n                            Recorded\r\n                        </button>\r\n                        <button\r\n                            className={this.state.selectedSongType === \"composed\" ? \"tab-selector tab-selected\" : \"tab-selector\"}\r\n                            onClick={() => this.changeSelectedSongType(\"composed\")}\r\n                        >\r\n                            Composed\r\n                        </button>\r\n                    </div>\r\n                    <div className=\"songs-wrapper\" style={{ marginBottom: '0.5rem' }}>\r\n                        {this.state.selectedSongType === \"recorded\"\r\n                            ? songs.map(song => {\r\n                                return <SongRow\r\n                                    data={song}\r\n                                    key={song.name}\r\n                                    functions={songFunctions}\r\n                                >\r\n                                </SongRow>\r\n                            })\r\n\r\n                            : composedSongs.map(song => {\r\n                                return <SongRow\r\n                                    data={song}\r\n                                    key={song.name}\r\n                                    functions={songFunctions}\r\n                                >\r\n                                </SongRow>\r\n                            })\r\n                        }\r\n\r\n                    </div>\r\n                    <div className=\"songs-buttons-wrapper\" style={{ marginTop: 'auto' }}>\r\n                        <button\r\n                            className={`genshin-button record-btn ${data.isRecordingAudio ? \"selected\" : \"\"}`}\r\n                            onClick={() => functions.startRecordingAudio(!data.isRecordingAudio)}\r\n                        >\r\n                            {data.isRecordingAudio ? \"Stop recording audio\" : \"Start recording audio\"}\r\n                        </button>\r\n                    </div>\r\n\r\n                </MenuPanel>\r\n                <MenuPanel title=\"Settings\" visible={selectedMenu}>\r\n                    {Object.entries(data.settings).map(([key, data]) => {\r\n                        return <SettingsRow\r\n                            key={key}\r\n                            objKey={key}\r\n                            data={data}\r\n                            changeVolume={changeVolume}\r\n                            update={handleSettingChange}\r\n                        />\r\n                    })}\r\n                    {isMidiAvailable &&\r\n                        <button\r\n                            className='genshin-button'\r\n                            onClick={() => changePage('MidiSetup')}\r\n                            style={{ width: 'fit-content', margin: '0.4rem 0 0.7rem auto' }}\r\n                        >\r\n                            Connect MIDI keyboard\r\n                        </button>\r\n                    }\r\n                    {!isTwa() && <DonateButton onClick={changePage} />}\r\n                </MenuPanel>\r\n            </div>\r\n        </div>\r\n    }\r\n}\r\n\r\n\r\nfunction SongRow(props) {\r\n    const { data, functions } = props\r\n    const { removeSong, toggleMenu, loadSong, downloadSong } = functions\r\n    return <div className=\"song-row\">\r\n        <div className=\"song-name\" onClick={() => {\r\n            loadSong(data)\r\n            toggleMenu(false)\r\n        }}>\r\n            {data.name}\r\n        </div>\r\n        <div className=\"song-buttons-wrapper\">\r\n            <button className=\"song-button\" onClick={() => downloadSong(data)}>\r\n                <Memoized>\r\n                    <FaDownload />\r\n                </Memoized>\r\n            </button>\r\n            <button className=\"song-button\" onClick={() => removeSong(data.name)}>\r\n                <Memoized>\r\n                    <FaTrash color=\"#ed4557\" />\r\n                </Memoized>\r\n            </button>\r\n        </div>\r\n    </div>\r\n}\r\n\r\n\r\n\r\nexport default Menu","import React, { Component } from 'react'\r\nimport { FaPlay, FaPlus, FaPause, FaBars, FaChevronLeft, FaChevronRight, FaTools } from 'react-icons/fa';\r\n\r\nimport addCell from \"assets/icons/addCell.svg\"\r\nimport removeCell from \"assets/icons/removeCell.svg\"\r\nimport { appName, audioContext, MIDI_STATUS, layersIndexes } from \"appConfig\"\r\n\r\nimport MidiImport from \"./MidiParser\"\r\nimport ComposerTools from \"./Components/ComposerTools\"\r\nimport ComposerKeyboard from \"./ComposerKeyboard\"\r\nimport ComposerCanvas from \"./Canvas\"\r\nimport Menu from \"./Components/Menu\"\r\nimport Memoized from 'components/Memoized';\r\nimport { asyncConfirm, asyncPrompt } from \"components/AsyncPrompts\"\r\nimport { ComposerSettings, getMIDISettings } from \"lib/SettingsObj\"\r\nimport Instrument from \"lib/Instrument\"\r\nimport {\r\n    ComposedSong, LoggerEvent, ColumnNote, Column, TempoChangers,\r\n    ComposerSongSerialization, ComposerSongDeSerialization, getPitchChanger, RecordingToComposed, delayMs\r\n} from \"lib/Utils\"\r\nimport AudioRecorder from 'lib/AudioRecorder'\r\nimport { DB } from 'Database';\r\nimport Analytics from 'lib/Analytics';\r\n\r\nclass Composer extends Component {\r\n    constructor(props) {\r\n        super(props)\r\n\r\n        const settings = this.getSettings()\r\n        this.playbackInterval = undefined\r\n        this.audioContext = audioContext\r\n        this.reverbNode = undefined\r\n        this.reverbVolumeNode = undefined\r\n        this.recorder = new AudioRecorder()\r\n        this.state = {\r\n            instrument: new Instrument(),\r\n            layers: [new Instrument(), new Instrument()],\r\n            songs: [],\r\n            isPlaying: false,\r\n            song: new ComposedSong(\"Untitled\"),\r\n            settings: settings,\r\n            menuOpen: false,\r\n            layer: 1,\r\n            toolsColumns: [],\r\n            toolsVisible: false,\r\n            midiVisible: false,\r\n            isRecordingAudio: false\r\n        }\r\n        this.MIDISettings = getMIDISettings()\r\n        this.MidiAccess = undefined\r\n        this.currentMidiSource = undefined\r\n        this.state.song.bpm = settings.bpm.value\r\n        this.state.song.instruments = [\r\n            settings.instrument.value,\r\n            settings.layer2.value,\r\n            settings.layer3.value\r\n        ]\r\n        this.mounted = false\r\n        this.copiedColums = []\r\n        this.changes = 0\r\n        this.broadcastChannel = {}\r\n    }\r\n\r\n    componentDidMount() {\r\n        this.mounted = true\r\n        this.init()\r\n        window.addEventListener(\"keydown\", this.handleKeyboard)\r\n        this.broadcastChannel = window.BroadcastChannel ? new BroadcastChannel(appName + '_composer') : {}\r\n        this.broadcastChannel.onmessage = (event) => {\r\n            if (!this.state.settings.syncTabs.value) return\r\n            if (!['play', 'stop'].includes(event?.data)) return\r\n            this.togglePlay(event.data === 'play')\r\n        }\r\n        if (window.location.hostname !== \"localhost\") {\r\n            window.addEventListener(\"beforeunload\", (event) => {\r\n                event.preventDefault()\r\n                event.returnValue = ''\r\n            })\r\n        }\r\n\r\n    }\r\n    componentWillUnmount() {\r\n        this.mounted = false\r\n        if (this.currentMidiSource) this.currentMidiSource.onmidimessage = null\r\n        if(this.MidiAccess) this.MidiAccess.onstatechange = null\r\n        window.removeEventListener('keydown', this.handleKeyboard)\r\n        const { instrument, layers } = this.state\r\n        this.broadcastChannel?.close?.()\r\n        const instruments = [instrument, layers[0], layers[1]]\r\n        instruments.forEach(instrument => instrument.delete())\r\n        this.reverbNode = undefined\r\n        this.reverbVolumeNode = undefined\r\n        this.audioContext = undefined\r\n        const state = this.state\r\n        state.isPlaying = false\r\n    }\r\n\r\n    init = async () => {\r\n        this.syncSongs()\r\n        const { settings } = this.state\r\n        const promises = [\r\n            this.loadInstrument(settings.instrument.value, 1),\r\n            this.loadInstrument(settings.layer2.value, 2),\r\n            this.loadInstrument(settings.layer3.value, 3)\r\n        ]\r\n        if (this.mounted) await Promise.all(promises)\r\n        if (this.mounted) await this.loadReverb()\r\n        if (this.mounted) this.setupAudioDestination(settings.caveMode.value)\r\n        if (this.MIDISettings.enabled) {\r\n            if (navigator.requestMIDIAccess) {\r\n                navigator.requestMIDIAccess().then(this.initMidi, () => {\r\n                    new LoggerEvent('Error', 'MIDI permission not accepted').trigger()\r\n                })\r\n            } else {\r\n                new LoggerEvent('Error', 'MIDI is not supported on this browser').trigger()\r\n            }\r\n        }\r\n    }\r\n    componentDidCatch() {\r\n        this.setState({\r\n            song: new ComposedSong(\"Untitled\")\r\n        })\r\n        new LoggerEvent(\"Warning\", \"There was an error with the song! Restoring default...\").trigger()\r\n    }\r\n    handleAutoSave = () => {\r\n        this.changes++\r\n        if (this.changes > 5 && this.state.settings.autosave.value) {\r\n            if (this.state.song.name !== \"Untitled\") {\r\n                this.updateSong(this.state.song)\r\n            }\r\n\r\n        }\r\n    }\r\n    initMidi = (e) => {\r\n        e.onstatechange = () => this.initMidi(this.MidiAccess)\r\n        this.MidiAccess = e\r\n        const midiInputs = this.MidiAccess.inputs.values()\r\n        const inputs = []\r\n        for (let input = midiInputs.next(); input && !input.done; input = midiInputs.next()) {\r\n            inputs.push(input.value)\r\n        }\r\n        if (this.currentMidiSource) this.currentMidiSource.onmidimessage = null\r\n        this.currentMidiSource = inputs.find(input => {\r\n            return input.name + \" \" + input.manufacturer === this.MIDISettings.currentSource\r\n        })\r\n        if(this.currentMidiSource) this.currentMidiSource.onmidimessage = this.handleMidi\r\n\r\n    }\r\n    handleMidi = (e) => {\r\n        if (!this.mounted) return\r\n        const { instrument, song, layer} = this.state\r\n        const { data } = e\r\n        const [eventType, note, velocity] = data\r\n\r\n        if (MIDI_STATUS.down === eventType && velocity !== 0) {\r\n            const keyboardNotes = this.MIDISettings.notes.filter(e => e.midi === note)\r\n            keyboardNotes.forEach(keyboardNote => {\r\n                this.handleClick(instrument.layout[keyboardNote.index])\r\n            })\r\n            const shortcut = this.MIDISettings.shortcuts.find(e => e.midi === note)\r\n            if(!shortcut) return\r\n            switch(shortcut.type){\r\n                case 'toggle_play': this.togglePlay(); break;\r\n                case 'next_column': this.selectColumn(song.selected + 1); break;\r\n                case 'previous_column': this.selectColumn(song.selected - 1); break;\r\n                case 'add_column': this.addColumns(1, song.selected); break;\r\n                case 'remove_column': this.removeColumns(1, song.selected); break;\r\n                case 'change_layer': {\r\n                    let nextLayer = layer + 1\r\n                    if(nextLayer > layersIndexes.length) nextLayer = 1\r\n                    this.changeLayer(nextLayer)\r\n                    break;\r\n                }\r\n                default: break;\r\n            }\r\n        }\r\n    }\r\n    loadReverb() {\r\n        return new Promise(resolve => {\r\n            fetch(\"./assets/audio/reverb4.wav\")\r\n                .then(r => r.arrayBuffer())\r\n                .then(b => {\r\n                    if (!this.mounted) return\r\n                    this.audioContext.decodeAudioData(b, (impulse_response) => {\r\n                        if (!this.mounted) return\r\n                        let convolver = this.audioContext.createConvolver()\r\n                        let gainNode = this.audioContext.createGain()\r\n                        gainNode.gain.value = 2.5\r\n                        convolver.buffer = impulse_response\r\n                        convolver.connect(gainNode)\r\n                        gainNode.connect(this.audioContext.destination)\r\n                        this.reverbNode = convolver\r\n                        this.reverbVolumeNode = gainNode\r\n                        resolve()\r\n                    })\r\n                }).catch((e) => {\r\n                    console.log(\"Error with reverb\", e)\r\n                })\r\n        })\r\n    }\r\n    getSettings = () => {\r\n        let storedSettings = localStorage.getItem(appName + \"_Composer_Settings\")\r\n        try {\r\n            storedSettings = JSON.parse(storedSettings)\r\n        } catch (e) {\r\n            storedSettings = null\r\n        }\r\n        if (storedSettings !== null) {\r\n            if (storedSettings.settingVesion !== ComposerSettings.settingVesion) {\r\n                this.updateSettings(ComposerSettings)\r\n                return ComposerSettings\r\n            }\r\n            return storedSettings\r\n        }\r\n        return ComposerSettings\r\n    }\r\n\r\n    updateSettings = (override) => {\r\n        let state\r\n        if (override !== undefined) {\r\n            state = override\r\n        } else {\r\n            state = this.state.settings\r\n        }\r\n        localStorage.setItem(appName + \"_Composer_Settings\", JSON.stringify(state))\r\n    }\r\n\r\n    handleSettingChange = (setting) => {\r\n        const { state } = this\r\n        let settings = state.settings\r\n        let data = setting.data\r\n        settings[setting.key] = { ...settings[setting.key], value: data.value }\r\n        if (data.songSetting) {\r\n            state.song[setting.key] = data.value\r\n        }\r\n        if (setting.key === \"instrument\") this.loadInstrument(data.value, 1)\r\n        if (setting.key === \"layer2\") this.loadInstrument(data.value, 2)\r\n        if (setting.key === \"layer3\") this.loadInstrument(data.value, 3)\r\n        if (setting.key === \"caveMode\") this.setupAudioDestination(data.value)\r\n        this.setState({\r\n            settings: settings,\r\n            song: this.state.song\r\n        }, () => {\r\n            this.updateSettings()\r\n        })\r\n    }\r\n\r\n    loadInstrument = async (name, layer) => {\r\n        if (!this.mounted) return\r\n        const { settings } = this.state\r\n        if (layer === 1) {\r\n            this.state.instrument.delete()\r\n            let newInstrument = new Instrument(name)\r\n            await newInstrument.load()\r\n            if (!this.mounted) return\r\n            newInstrument.changeVolume(settings.instrument.volume)\r\n            this.setState({\r\n                instrument: newInstrument\r\n            })\r\n        } else {\r\n            let newInstrument = new Instrument(name)\r\n            let layers = this.state.layers\r\n            layers[layer - 2].delete()\r\n            layers[layer - 2] = newInstrument\r\n            await newInstrument.load()\r\n            if (!this.mounted) return\r\n            newInstrument.changeVolume(settings[`layer${layer}`]?.volume)\r\n            this.setState({\r\n                layers: layers\r\n            })\r\n        }\r\n        this.setupAudioDestination(settings.caveMode.value)\r\n    }\r\n    changeVolume = (obj) => {\r\n        let settings = this.state.settings\r\n        if (obj.key === \"instrument\") {\r\n            settings.instrument = { ...settings.instrument, volume: obj.value }\r\n            this.state.instrument.changeVolume(obj.value)\r\n        }\r\n        if (obj.key === \"layer2\") {\r\n            settings.layer2 = { ...settings.layer2, volume: obj.value }\r\n            this.state.layers[0].changeVolume(obj.value)\r\n        }\r\n        if (obj.key === \"layer3\") {\r\n            settings.layer3 = { ...settings.layer3, volume: obj.value }\r\n            this.state.layers[1].changeVolume(obj.value)\r\n        }\r\n        this.setState({\r\n            settings: settings\r\n        }, () => this.updateSettings())\r\n    }\r\n    setupAudioDestination = (hasReverb) => {\r\n        if (!this.mounted) return\r\n        const { instrument, layers } = this.state\r\n        const instruments = [instrument, layers[0], layers[1]]\r\n        instruments.forEach(ins => {\r\n            if (hasReverb) {\r\n                if (!this.reverbNode) return console.log(\"Couldn't connect to reverb\")\r\n                ins.disconnect()\r\n                ins.connect(this.reverbNode)\r\n            } else {\r\n                ins.disconnect()\r\n                ins.connect(this.audioContext.destination)\r\n            }\r\n        })\r\n    }\r\n    startRecordingAudio = async (override) => { //will record untill the song stops\r\n        if (!this.mounted) return\r\n        if (!override) {\r\n            this.setState({ isRecordingAudio: false })\r\n            return this.togglePlay(false)\r\n        }\r\n        const { instrument, layers } = this.state\r\n        const instruments = [instrument, layers[0], layers[1]]\r\n        const hasReverb = this.state.settings.caveMode.value\r\n        const { recorder } = this\r\n        if (hasReverb) {\r\n            this.reverbVolumeNode.connect(recorder.node)\r\n        } else {\r\n            instruments.forEach(instrument => {\r\n                instrument.connect(recorder.node)\r\n            })\r\n        }\r\n        recorder.start()\r\n        this.setState({ isRecordingAudio: true })\r\n        await this.togglePlay(true) //wait till song finishes\r\n        if (!this.mounted) return\r\n        let recording = await recorder.stop()\r\n        this.setState({ isRecordingAudio: false })\r\n        let fileName = await asyncPrompt(\"Write the song name, press cancel to ignore\")\r\n        if (fileName) recorder.download(recording.data, fileName + '.wav')\r\n        if (!this.mounted) return\r\n        this.reverbVolumeNode.disconnect()\r\n        this.reverbVolumeNode.connect(audioContext.destination)\r\n        this.setupAudioDestination(hasReverb)\r\n    }\r\n    handleKeyboard = (event) => {\r\n        if (document.activeElement.tagName === \"INPUT\") return\r\n        const { instrument, layer, layers, isPlaying, song } = this.state\r\n        let key = event.code\r\n        const shouldEditKeyboard = isPlaying || event.shiftKey\r\n        if (shouldEditKeyboard) {\r\n            let letter = key?.replace(\"Key\", \"\")\r\n            let note = instrument.getNoteFromCode(letter)\r\n            if (note !== null) this.handleClick(instrument.layout[note])\r\n            switch (key) {\r\n                case \"Space\": {\r\n                    this.togglePlay()\r\n                    if (!this.state.settings.syncTabs.value) break;\r\n                    this.broadcastChannel?.postMessage?.(\"stop\")\r\n                    break;\r\n                }\r\n                default: break;\r\n            }\r\n        } else {\r\n            switch (key) {\r\n                case \"KeyD\": this.selectColumn(this.state.song.selected + 1); break;\r\n                case \"KeyA\": this.selectColumn(this.state.song.selected - 1); break;\r\n                case \"Digit1\": this.handleTempoChanger(TempoChangers[0]); break;\r\n                case \"Digit2\": this.handleTempoChanger(TempoChangers[1]); break;\r\n                case \"Digit3\": this.handleTempoChanger(TempoChangers[2]); break;\r\n                case \"Digit4\": this.handleTempoChanger(TempoChangers[3]); break;\r\n                case \"Space\": {\r\n                    this.togglePlay()\r\n                    if (!this.state.settings.syncTabs.value) break;\r\n                    this.broadcastChannel?.postMessage?.(\"play\")\r\n                    break;\r\n                }\r\n                case \"ArrowUp\": {\r\n                    let nextLayer = layer - 1\r\n                    if (nextLayer > 0) this.changeLayer(nextLayer)\r\n                    break;\r\n                }\r\n                case \"ArrowDown\": {\r\n                    let nextLayer = layer + 1\r\n                    if (nextLayer < layers.length + 2) this.changeLayer(nextLayer)\r\n                    break;\r\n                }\r\n                case \"KeyQ\": this.removeColumns(1, song.selected); break;\r\n                case \"KeyE\": this.addColumns(1, song.selected); break;\r\n                default: break;\r\n            }\r\n        }\r\n\r\n    }\r\n    playSound = (instrument, index) => {\r\n        try {\r\n            let note = instrument.layout[index]\r\n            if (note === undefined) return\r\n            instrument.play(note.index, getPitchChanger(this.state.settings.pitch.value))\r\n        } catch (e) {\r\n\r\n        }\r\n    }\r\n    changePitch = (value) => {\r\n        const { settings } = this.state\r\n        settings.pitch = { ...settings.pitch, value }\r\n        this.setState({\r\n            settings: settings\r\n        }, () => this.updateSettings())\r\n    }\r\n    handleClick = (note) => {\r\n        let column = this.state.song.columns[this.state.song.selected]\r\n        let index = column.notes.findIndex((n) => {\r\n            return note.index === n.index\r\n        })\r\n        let layerIndex = this.state.layer - 1\r\n        if (index < 0) { //if it doesn't exist, create a new one\r\n            let columnNote = new ColumnNote(note.index)\r\n            columnNote.layer = replaceAt(columnNote.layer, layerIndex, \"1\")\r\n            column.notes.push(columnNote)\r\n        } else { //if it exists, toggle the current layer and if it's 000 delete it\r\n            let currentNote = column.notes[index]\r\n            currentNote.layer = replaceAt(currentNote.layer, layerIndex, currentNote.layer[layerIndex] === \"0\" ? \"1\" : \"0\")\r\n            if (currentNote.layer === \"000\") column.notes.splice(index, 1)\r\n        }\r\n        this.setState({\r\n            song: this.state.song\r\n        })\r\n        this.handleAutoSave()\r\n        let instrument = this.state.instrument\r\n        if (this.state.layer > 1) {\r\n            instrument = this.state.layers[this.state.layer - 2]\r\n        }\r\n        this.playSound(instrument, note.index)\r\n    }\r\n    syncSongs = async () => {\r\n        let songs = await DB.getSongs()\r\n        if (!this.mounted) return\r\n        songs = songs.map(song => {\r\n            if (song.data.isComposedVersion) {\r\n                return ComposerSongDeSerialization(song)\r\n            }\r\n            return song\r\n        })\r\n        this.setState({\r\n            composedSongs: songs,\r\n            songs: songs\r\n        })\r\n    }\r\n    addSong = async (song) => {\r\n        if (await this.songExists(song.name)) {\r\n            return new LoggerEvent(\"Warning\", \"A song with this name already exists! \\n\" + song.name).trigger()\r\n        }\r\n        await DB.addSong(ComposerSongSerialization(song))\r\n        this.syncSongs()\r\n    }\r\n    updateSong = async (song) => {\r\n        if (song.name === \"Untitled\") {\r\n            let name = await this.askForSongName()\r\n            if (name === null || !this.mounted) return\r\n            song.name = name\r\n            this.changes = 0\r\n            return this.addSong(song)\r\n        }\r\n        return new Promise(async resolve => {\r\n            let settings = this.state.settings\r\n            if (await this.songExists(song.name)) {\r\n                song.instruments[0] = settings.instrument.value\r\n                song.instruments[1] = settings.layer2.value\r\n                song.instruments[2] = settings.layer3.value\r\n                await DB.updateSong({ name: song.name }, ComposerSongSerialization(song))\r\n                console.log(\"song saved:\", song.name)\r\n                this.changes = 0\r\n                this.syncSongs()\r\n            } else {\r\n                if (song.name.includes(\"- Composed\")) {\r\n                    let name = await this.askForSongName(\"Write composed song name, press cancel to ignore\")\r\n                    if (name === null) return resolve()\r\n                    song.name = name\r\n                    await DB.addSong(ComposerSongSerialization(song))\r\n                    this.syncSongs()\r\n                    return resolve()\r\n                }\r\n                console.log(\"song doesn't exist\")\r\n                song.name = \"Untitled\"\r\n                this.updateSong(song)\r\n            }\r\n            resolve()\r\n        })\r\n    }\r\n    askForSongName = (question) => {\r\n        return new Promise(async resolve => {\r\n            let promptString = question || \"Write song name, press cancel to ignore\"\r\n            while (true) {\r\n                let songName = await asyncPrompt(promptString)\r\n                if (songName === null) return resolve(null)\r\n                if (songName !== \"\") {\r\n                    if (await this.songExists(songName)) {\r\n                        promptString = \"This song already exists: \" + songName\r\n                    } else {\r\n                        return resolve(songName)\r\n                    }\r\n                } else {\r\n                    promptString = question || \"Write song name, press cancel to ignore\"\r\n                }\r\n            }\r\n        })\r\n\r\n    }\r\n    askForSongUpdate = () => {\r\n        return new Promise(async resolve => {\r\n            let result = await asyncConfirm(`You have unsaved changes to the song: \"${this.state.song.name}\" do you want to save now?`)\r\n            resolve(result)\r\n        })\r\n    }\r\n    songExists = async (name) => {\r\n        return await DB.existsSong({ name: name })\r\n    }\r\n    createNewSong = async () => {\r\n        if (this.state.song.name !== \"Untitled\" && this.changes > 0) {\r\n            let wantsToSave = await this.askForSongUpdate()\r\n            if (wantsToSave) {\r\n                await this.updateSong(this.state.song)\r\n            }\r\n        }\r\n        let name = await this.askForSongName(\"Write new song name, press cancel to ignore\")\r\n        if (name === null) return\r\n        let song = new ComposedSong(name)\r\n        this.changes = 0\r\n        if (!this.mounted) return\r\n        this.setState({\r\n            song: song\r\n        }, () => this.addSong(song))\r\n        Analytics.songEvent({type: 'create'})\r\n    }\r\n    removeSong = async (name) => {\r\n        let confirm = await asyncConfirm(\"Are you sure you want to delete the song: \" + name)\r\n        if (confirm) await DB.removeSong({ name: name })\r\n        this.syncSongs()\r\n\t\tAnalytics.userSongs({name: name, page: 'composer'},'delete')\r\n    }\r\n\r\n    loadSong = async (song) => {\r\n        const state = this.state\r\n        song = JSON.parse(JSON.stringify(song)) //lose reference\r\n        if (!song.data.isComposedVersion) {\r\n            //if(song.bpm <= 220)  song.bpm *= 2\r\n            song = RecordingToComposed(song, 4)\r\n            song.name += \" - Composed\"\r\n        }\r\n        if (this.changes !== 0) {\r\n            let confirm = state.settings.autosave.value && state.song.name !== \"Untitled\"\r\n            if (!confirm && state.song.columns.length > 0) {\r\n                confirm = await asyncConfirm(`You have unsaved changes to the song: \"${state.song.name}\" do you want to save? UNSAVED CHANGES WILL BE LOST`)\r\n            }\r\n            if (confirm) await this.updateSong(state.song)\r\n        }\r\n        let settings = this.state.settings\r\n        settings.bpm = { ...settings.bpm, value: song.bpm }\r\n        settings.pitch = { ...settings.pitch, value: song.pitch }\r\n        if (!this.mounted) return\r\n        if (settings.instrument.value !== song.instruments[0]) {\r\n            this.loadInstrument(song.instruments[0], 1)\r\n            settings.instrument = { ...settings.instrument, value: song.instruments[0] }\r\n        }\r\n        if (settings.layer2.value !== song.instruments[1]) {\r\n            this.loadInstrument(song.instruments[1], 2)\r\n            settings.layer2 = { ...settings.layer2, value: song.instruments[1] }\r\n        }\r\n        if (settings.layer3.value !== song.instruments[2]) {\r\n            this.loadInstrument(song.instruments[2], 3)\r\n            settings.layer3 = { ...settings.layer3, value: song.instruments[2] }\r\n        }\r\n        this.changes = 0\r\n        console.log(\"song loaded\")\r\n        this.setState({\r\n            song: song,\r\n            settings: settings,\r\n            toolsColumns: []\r\n        })\r\n    }\r\n\r\n    addColumns = (amount = 1, position = \"end\") => {\r\n        return new Promise(resolve => {\r\n            let columns = new Array(amount).fill().map(() => new Column())\r\n            let songColumns = this.state.song.columns\r\n            if (position === \"end\") {\r\n                songColumns.push(...columns)\r\n            } else {\r\n                songColumns.splice(position + 1, 0, ...columns)\r\n            }\r\n            if (amount === 1) this.selectColumn(this.state.song.selected + 1)\r\n            this.handleAutoSave()\r\n            this.setState({ song: this.state.song }, resolve)\r\n        })\r\n\r\n    }\r\n    \r\n    removeColumns = (amount, position) => {\r\n        let song = this.state.song\r\n        if (song.columns.length < 16) return\r\n        let indexes = new Array(amount).fill().map((e, i) => position + i)\r\n        indexes.forEach(index => {\r\n            if (song.breakpoints.includes(index)) this.toggleBreakpoint(index)\r\n        })\r\n        song.columns.splice(position, amount)\r\n        if (song.columns.length <= song.selected) this.selectColumn(song.selected - 1)\r\n        this.handleAutoSave()\r\n        this.setState({ song: song })\r\n    }\r\n    //----------------------------------------------//\r\n\r\n    togglePlay = async (override) => {\r\n        return new Promise(resolve => {\r\n            let newState = typeof override === \"boolean\" ? override : !this.state.isPlaying\r\n            this.setState({\r\n                isPlaying: newState\r\n            }, async () => {\r\n                if (this.state.isPlaying) this.selectColumn(this.state.song.selected)\r\n                let pastError = 0\r\n                let previousTime = new Date().getTime()\r\n                while (this.state.isPlaying) {\r\n                    const { song, settings } = this.state\r\n                    let tempoChanger = TempoChangers[song.columns[song.selected].tempoChanger]\r\n                    let msPerBPM = Math.floor(60000 / settings.bpm.value * tempoChanger.changer) + pastError\r\n                    previousTime = new Date().getTime()\r\n                    await delayMs(msPerBPM)\r\n                    if (!this.state.isPlaying || !this.mounted) break\r\n                    this.handleTick()\r\n                    pastError = previousTime + msPerBPM - new Date().getTime()\r\n                }\r\n                resolve()\r\n            })\r\n        })\r\n    }\r\n\r\n\r\n    handleTick = () => {\r\n        let newIndex = this.state.song.selected + 1\r\n        if (this.state.isPlaying && newIndex > this.state.song.columns.length - 1) {\r\n            return this.togglePlay(false)\r\n        }\r\n        this.selectColumn(this.state.song.selected + 1)\r\n\r\n    }\r\n    toggleMenuVisible = () => {\r\n        this.setState({ menuOpen: !this.state.menuOpen })\r\n    }\r\n    toggleBreakpoint = (override) => {\r\n        let song = this.state.song\r\n        let index = typeof override === \"number\" ? override : song.selected\r\n        let indexOfBreakpoint = song.breakpoints.indexOf(index)\r\n        if (indexOfBreakpoint >= 0 && song.columns.length > index) {\r\n            song.breakpoints.splice(indexOfBreakpoint, 1)\r\n        } else if (song.columns.length > index) {\r\n            song.breakpoints.push(index)\r\n        }\r\n        this.validateBreakpoints()\r\n        this.setState({ song: song })\r\n    }\r\n    handleTempoChanger = (changer) => {\r\n        let song = this.state.song\r\n        song.columns[this.state.song.selected].tempoChanger = changer.id\r\n        this.handleAutoSave()\r\n        this.setState({ song: song })\r\n    }\r\n    changePage = async (page) => {\r\n        if (this.changes !== 0) {\r\n            if (this.state.settings.autosave.value) {\r\n                await this.updateSong(this.state.song)\r\n            } else {\r\n                let confirm = await asyncConfirm(`You have unsaved changes to the song: \"${this.state.song.name}\" do you want to save? UNSAVED CHANGES WILL BE LOST`, false)\r\n                if (confirm) {\r\n                    await this.updateSong(this.state.song)\r\n                }\r\n            }\r\n\r\n        }\r\n        this.props.changePage(page)\r\n    }\r\n    selectColumn = (index, ignoreAudio) => {\r\n        const state = this.state\r\n        let song = state.song\r\n        if (index < 0 || index > song.columns.length - 1) return\r\n        let currentColumn = state.song.columns[index]\r\n        song.selected = index\r\n        let toolsColumns = state.toolsColumns\r\n        if (state.toolsVisible && this.copiedColums.length === 0) {\r\n            toolsColumns.push(index)\r\n            let min = Math.min(...toolsColumns)\r\n            let max = Math.max(...toolsColumns)\r\n            toolsColumns = new Array(max - min + 1).fill().map((e, i) => min + i)\r\n        }\r\n        this.setState({\r\n            song: song,\r\n            toolsColumns: toolsColumns\r\n        })\r\n\r\n        if (ignoreAudio) return\r\n        currentColumn.notes.forEach(note => {\r\n            if (note.layer[0] === \"1\") this.playSound(state.instrument, note.index)\r\n            if (note.layer[1] === \"1\") this.playSound(state.layers[0], note.index)\r\n            if (note.layer[2] === \"1\") this.playSound(state.layers[1], note.index)\r\n        })\r\n    }\r\n    changeLayer = (layer) => {\r\n        this.setState({\r\n            layer: layer\r\n        })\r\n    }\r\n    //-----------------------TOOLS---------------------//\r\n    toggleTools = () => {\r\n        this.setState({\r\n            toolsVisible: !this.state.toolsVisible,\r\n            toolsColumns: this.state.toolsVisible ? [] : [this.state.song.selected]\r\n        })\r\n        this.copiedColums = []\r\n    }\r\n    copyColumns = (layer) => {\r\n        this.copiedColums = []\r\n        this.state.toolsColumns.forEach((index) => {\r\n            let column = this.state.song.columns[index]\r\n            if (column !== undefined) this.copiedColums.push(column)\r\n        })\r\n        this.copiedColums = JSON.parse(JSON.stringify(this.copiedColums)) // removing reference\r\n        if (layer !== 'all') {\r\n            this.copiedColums = this.copiedColums.map(column => {\r\n                column.notes = column.notes.filter(e => e.layer[layer - 1] === '1')\r\n                column.notes = column.notes.map(e => {\r\n                    e.layer = '000'\r\n                    e.layer = replaceAt(e.layer, layer - 1, '1')\r\n                    return e\r\n                })\r\n                return column\r\n            })\r\n        }\r\n        this.setState({ toolsColumns: [] })\r\n    }\r\n    pasteColumns = async (insert) => {\r\n        let song = this.state.song\r\n        let copiedColumns = JSON.parse(JSON.stringify(this.copiedColums))\r\n        if (!insert) {\r\n            song.columns.splice(song.selected, 0, ...copiedColumns)\r\n        } else {\r\n            copiedColumns.forEach((copiedColumn, i) => {\r\n                let column = song.columns[song.selected + i]\r\n                if (column !== undefined) {\r\n                    copiedColumn.notes.forEach(copiedNote => {\r\n                        let index = column.notes.findIndex(note => copiedNote.index === note.index)\r\n                        if (index < 0) {\r\n                            column.notes.push(copiedNote)\r\n                        } else {\r\n                            for (let j = 0; j < 3; j++) {\r\n                                if (copiedNote.layer[j] === '1') {\r\n                                    column.notes[index].layer = replaceAt(column.notes[index].layer, j, 1)\r\n                                }\r\n                            }\r\n                        }\r\n                    })\r\n                }\r\n            })\r\n        }\r\n        this.setState({ song: song })\r\n    }\r\n    eraseColumns = (layer) => {\r\n        let song = this.state.song\r\n        if (layer === 'all') {\r\n            this.state.toolsColumns.forEach(columnIndex => {\r\n                let column = song.columns[columnIndex]\r\n                if (column !== undefined) song.columns[columnIndex].notes = []\r\n            })\r\n        } else {\r\n            this.state.toolsColumns.forEach(columnIndex => {\r\n                let column = song.columns[columnIndex]\r\n                if (column !== undefined) {\r\n                    song.columns[columnIndex].notes.forEach(note => {\r\n                        note.layer = replaceAt(note.layer, layer - 1, '0')\r\n                    })\r\n                }\r\n            })\r\n        }\r\n\r\n        this.setState({ song: song })\r\n    }\r\n    validateBreakpoints = () => {\r\n        const breakpoints = this.state.song.breakpoints.filter(breakpoint => breakpoint < this.state.song.columns.length)\r\n        const song = this.state.song\r\n        song.breakpoints = breakpoints\r\n        this.setState({ song: song })\r\n    }\r\n    deleteColumns = async () => {\r\n        const song = this.state.song\r\n        song.columns = song.columns.filter((e, i) => !this.state.toolsColumns.includes(i))\r\n        if (song.selected > song.columns.length - 1) song.selected = song.columns.length - 1\r\n        if (song.selected <= 0) song.selected = 0\r\n        if (song.columns.length === 0) await this.addColumns(12, 0)\r\n        this.setState({\r\n            song: song,\r\n            toolsColumns: []\r\n        }, this.validateBreakpoints)\r\n    }\r\n    changeMidiVisibility = (visibility) => {\r\n        this.setState({ midiVisible: visibility })\r\n        if(visibility) Analytics.songEvent({type: 'create_MIDI'})\r\n    }\r\n    render() {\r\n        const { state } = this\r\n        const { midiVisible, song } = state\r\n        //TODO export the menu outside this component so it doesnt get re rendered at every change\r\n        const songLength = calculateLength(song.columns, state.settings.bpm.value, song.selected)\r\n        const menuData = {\r\n            songs: state.songs,\r\n            currentSong: state.song,\r\n            settings: state.settings,\r\n            hasChanges: this.changes,\r\n            menuOpen: state.menuOpen,\r\n            isRecordingAudio: state.isRecordingAudio\r\n        }\r\n        const menuFunctions = {\r\n            loadSong: this.loadSong,\r\n            removeSong: this.removeSong,\r\n            createNewSong: this.createNewSong,\r\n            changePage: this.changePage,\r\n            updateSong: this.updateSong,\r\n            handleSettingChange: this.handleSettingChange,\r\n            toggleMenuVisible: this.toggleMenuVisible,\r\n            changeVolume: this.changeVolume,\r\n            changeMidiVisibility: this.changeMidiVisibility,\r\n            startRecordingAudio: this.startRecordingAudio\r\n        }\r\n        const keyboardFunctions = {\r\n            handleClick: this.handleClick,\r\n            handleTempoChanger: this.handleTempoChanger,\r\n            changeLayer: this.changeLayer\r\n        }\r\n        const keyboardData = {\r\n            keyboard: state.instrument,\r\n            currentColumn: state.song.columns[state.song.selected],\r\n            TempoChangers: TempoChangers,\r\n            layer: state.layer,\r\n            pitch: state.settings.pitch.value,\r\n            isPlaying: state.isPlaying,\r\n            noteNameType: state.settings.noteNameType.value,\r\n        }\r\n        const canvasFunctions = {\r\n            selectColumn: this.selectColumn,\r\n            toggleBreakpoint: this.toggleBreakpoint\r\n        }\r\n        const canvasData = {\r\n            columns: song.columns,\r\n            selected: song.selected,\r\n            settings: state.settings,\r\n            breakpoints: state.song.breakpoints,\r\n            toolsColumns: state.toolsColumns\r\n        }\r\n        const toolsData = {\r\n            visible: this.state.toolsVisible,\r\n            copiedColumns: this.copiedColums,\r\n            layer: this.state.layer\r\n        }\r\n        const toolsFunctions = {\r\n            toggleTools: this.toggleTools,\r\n            eraseColumns: this.eraseColumns,\r\n            deleteColumns: this.deleteColumns,\r\n            copyColumns: this.copyColumns,\r\n            pasteColumns: this.pasteColumns\r\n        }\r\n        const midiParserFunctions = {\r\n            loadSong: this.loadSong,\r\n            changeMidiVisibility: this.changeMidiVisibility,\r\n            changePitch: this.changePitch,\r\n        }\r\n        const midiParserData = {\r\n            instruments: [state.instrument, ...state.layers].map(layer => layer.instrumentName),\r\n            selectedColumn: song.selected,\r\n\r\n        }\r\n        return <div className=\"app bg-image\" style={{ backgroundImage: `url(${state.settings.backgroundImage.value})` }}>\r\n            {midiVisible && <MidiImport functions={midiParserFunctions} data={midiParserData} />}\r\n            <div className=\"hamburger\" onClick={this.toggleMenuVisible}>\r\n                <Memoized>\r\n                    <FaBars />\r\n                </Memoized>\r\n            </div>\r\n            <div className=\"right-panel-composer\">\r\n                <div className=\"column fill-x\">\r\n                    <div className=\"top-panel-composer\">\r\n                        <div className=\"buttons-composer-wrapper\">\r\n                            <div className=\"tool\" onPointerDown={() => this.selectColumn(song.selected + 1)}>\r\n                                <Memoized>\r\n                                    <FaChevronRight />\r\n\r\n                                </Memoized>\r\n                            </div>\r\n                            <div className=\"tool\" onClick={() => this.selectColumn(song.selected - 1)}>\r\n                                <Memoized>\r\n                                    <FaChevronLeft />\r\n                                </Memoized>\r\n                            </div>\r\n\r\n                            <div className=\"tool\" onClick={this.togglePlay}>\r\n                                <Memoized>\r\n                                    {this.state.isPlaying\r\n                                        ? <FaPause key='pause' />\r\n                                        : <FaPlay key='play' />\r\n                                    }\r\n                                </Memoized>\r\n                            </div>\r\n                        </div>\r\n                        <ComposerCanvas\r\n                            key={this.state.settings.columnsPerCanvas.value}\r\n                            functions={canvasFunctions}\r\n                            data={canvasData}\r\n                        />\r\n                        <div className=\"buttons-composer-wrapper-right\">\r\n\r\n                            <div className=\"tool\" onClick={() => this.addColumns(1, song.selected)}>\r\n                                <img src={addCell} className=\"tool-icon\" alt=\"Add a new cell\" />\r\n                            </div>\r\n                            <div className=\"tool\" onClick={() => this.removeColumns(1, song.selected)}>\r\n                                <img src={removeCell} className=\"tool-icon\" alt=\"Remove a cell\" />\r\n                            </div>\r\n                            <div className=\"tool\" onClick={() => this.addColumns(this.state.settings.beatMarks.value * 4, \"end\")}>\r\n                                <Memoized>\r\n                                    <FaPlus />\r\n                                </Memoized>\r\n                            </div>\r\n                            <div className=\"tool\" onClick={this.toggleTools}>\r\n                                <Memoized>\r\n                                    <FaTools />\r\n                                </Memoized>\r\n                            </div>\r\n\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <ComposerKeyboard\r\n                    functions={keyboardFunctions}\r\n                    data={keyboardData}\r\n                />\r\n            </div>\r\n            <Menu\r\n                data={menuData}\r\n                functions={menuFunctions}\r\n            />\r\n            <ComposerTools\r\n                data={toolsData}\r\n                functions={toolsFunctions}\r\n            />\r\n            <div className=\"song-info\">\r\n                <div>\r\n                    {song.name}\r\n                </div>\r\n                <div>\r\n                    {formatMillis(songLength.current)}\r\n                    /\r\n                    {formatMillis(songLength.total)}\r\n                </div>\r\n            </div>\r\n        </div>\r\n    }\r\n}\r\nfunction formatMillis(millis) {\r\n    let minutes = Math.floor(millis / 60000);\r\n    let seconds = ((millis % 60000) / 1000).toFixed(0);\r\n    return (\r\n        seconds === 60\r\n            ? (minutes + 1) + \":00\"\r\n            : minutes + \":\" + (seconds < 10 ? \"0\" : \"\") + seconds\r\n    )\r\n}\r\nfunction calculateLength(columns, bpm, end) {\r\n    const bpmPerMs = Math.floor(60000 / bpm)\r\n    let totalLength = 0\r\n    let currentLength = 0\r\n    let increment = 0\r\n    for (let i = 0; i < columns.length; i++) {\r\n        increment = bpmPerMs * TempoChangers[columns[i].tempoChanger].changer\r\n        if (i < end) currentLength += increment\r\n        totalLength += increment\r\n    }\r\n    return {\r\n        total: totalLength,\r\n        current: currentLength\r\n    }\r\n}\r\n\r\nfunction replaceAt(string, index, replacement) {\r\n    if (index >= string.length) {\r\n        return string.valueOf();\r\n    }\r\n    return string.substring(0, index) + replacement + string.substring(index + 1);\r\n}\r\nexport default Composer\r\n\r\n","import { useState} from 'react'\r\nimport { FaHome, FaDiscord } from 'react-icons/fa';\r\n\r\nimport MenuItem from 'components/MenuItem'\r\nimport MenuPanel from 'components/MenuPanel'\r\n\r\n\r\nexport function SimpleMenu({functions, children, className}) {\r\n    const [open, setOpen] = useState(false)\r\n    const [selectedMenu, setSelectedMenu] = useState(\"Settings\")\r\n    const { changePage, toggleMenuVisible } = functions\r\n    // eslint-disable-next-line\r\n    const toggleMenu = (override) => {\r\n        if (typeof override !== \"boolean\") override = undefined\r\n        let newState = override !== undefined ? override : !open\r\n        setOpen(newState)\r\n        if (newState === false) toggleMenuVisible()\r\n    }\r\n    // eslint-disable-next-line\r\n    const selectSideMenu = (selection) => {\r\n        if (selection === selectedMenu && open) {\r\n            return setOpen(false)\r\n        }\r\n        setSelectedMenu(selection)\r\n        setOpen(true)\r\n    }\r\n\r\n\r\n    return <div className={\"menu-wrapper \" + (className ? className : '')} >\r\n        <div className=\"menu menu-visible\" style={{ justifyContent: 'flex-end' }}>\r\n\r\n            {children}\r\n\r\n            <MenuItem type='Discord'>\r\n                <a href='https://discord.gg/Arsf65YYHq' target='_blank' rel='noreferrer' >\r\n                    <FaDiscord className=\"icon\" />\r\n                </a>\r\n            </MenuItem>\r\n\r\n            <MenuItem type=\"Home\" action={() => changePage(\"home\")}>\r\n                <FaHome className=\"icon\" />\r\n            </MenuItem>\r\n\r\n        </div>\r\n        <div className={open ? \"side-menu menu-open\" : \"side-menu\"}>\r\n            <MenuPanel title=\"No selection\" visible={selectedMenu}>\r\n            </MenuPanel>\r\n        </div>\r\n    </div>\r\n}","import React, { Component } from 'react'\r\nimport { FaTrash, FaDownload} from 'react-icons/fa';\r\nimport { DB } from 'Database';\r\nimport { FileDownloader, LoggerEvent,prepareSongDownload } from \"lib/Utils\"\r\nimport { asyncConfirm } from \"components/AsyncPrompts\"\r\nimport { appName } from \"appConfig\"\r\nimport { SimpleMenu } from 'components/SimpleMenu'\r\nimport './ErrorPage.css'\r\n\r\nclass ErrorPage extends Component {\r\n    constructor(props) {\r\n        super(props)\r\n        this.state = {\r\n            songs: []\r\n        }\r\n    }\r\n    componentDidMount(){\r\n        this.syncSongs()\r\n    }\r\n    downloadAllSongs = () => {\r\n        let toDownload = []\r\n        const { songs } = this.state\r\n        songs.forEach(song => {\r\n            if (song._id) delete song._id\r\n            if(appName === \"Sky\"){\r\n                song = prepareSongDownload(song)\r\n            }\r\n            Array.isArray(song) ? toDownload.push(...song) : toDownload.push(song)\r\n        })\r\n        let fileDownloader = new FileDownloader()\r\n        let json = JSON.stringify(toDownload)\r\n        let date = new Date().toISOString().split('T')[0]\r\n        fileDownloader.download(json,`${appName}_Backup_${date}.json`)\r\n        new LoggerEvent(\"Success\", \"Song backup downloaded\").trigger()\r\n    }\r\n    syncSongs = async () => {\r\n        this.setState({\r\n            songs: await DB.getSongs()\r\n        })\r\n    }\r\n    deleteSong = async (name) => {\r\n        if (await asyncConfirm(\"Are you sure you want to delete the song: \" + name)) {\r\n            await DB.removeSong({ name: name })\r\n            this.syncSongs()\r\n        }\r\n\r\n    }\r\n    deleteAllSongs = async () =>{\r\n        if (await asyncConfirm(\"Are you sure you want to delete ALL SONGS?\")) {\r\n            await DB.removeSong({})\r\n            this.syncSongs()\r\n        }\r\n    }\r\n    resetSettings = () => {\r\n        localStorage.removeItem(appName+\"_Composer_Settings\")\r\n        localStorage.removeItem(appName+\"_Main_Settings\")\r\n        new LoggerEvent(\"Success\", \"Settings have been reset\").trigger()\r\n    }\r\n    downloadSong = (song) => {\r\n        if (song._id) delete song._id\r\n        let songName = song.name\r\n        if(appName === \"Sky\"){\r\n            song = prepareSongDownload(song)\r\n        }\r\n        if(!Array.isArray(song)) song = [song]\r\n        song.forEach(song1 => {\r\n            song1.data.appName = appName\r\n        })\r\n        let json = JSON.stringify(song)\r\n        let fileDownloader = new FileDownloader()\r\n        fileDownloader.download(json,`${songName}.${appName.toLowerCase()}sheet.json`)\r\n        new LoggerEvent(\"Success\", \"Song downloaded\").trigger()\r\n    }\r\n    render() {\r\n        return <div className=\"error-page app\">\r\n            <SimpleMenu functions={{changePage: this.props.changePage}}/>\r\n            <div className=\"error-text-wrapper\">\r\n                There seems to be an error. <br />\r\n                Here you can download or delete your songs,\r\n                try to find what song caused the error and remove it.\r\n            </div>\r\n            <div className=\"error-buttons-wrapper\">\r\n                <button className=\"genshin-button\" onClick={this.resetSettings}>\r\n                    Reset settings\r\n                </button>\r\n                <button className=\"genshin-button\" onClick={this.deleteAllSongs}>\r\n                    Delete all songs\r\n                </button>\r\n            </div>\r\n            <div className=\"error-songs-wrapper\">\r\n                {this.state.songs.map(song => \r\n                    <SongRow\r\n                        key={song?.name}\r\n                        data={song}\r\n                        functions={{\r\n                            deleteSong: this.deleteSong,\r\n                            downloadSong: this.downloadSong\r\n                        }}\r\n                    />\r\n                )}\r\n            </div>\r\n        </div>\r\n    }\r\n}\r\n\r\nfunction SongRow(props) {\r\n    let data = props.data\r\n    let deleteSong = props.functions.deleteSong\r\n    let downloadSong = props.functions.downloadSong\r\n    return <div className=\"song-row\">\r\n        <div className=\"song-name\">\r\n            {data.name}\r\n        </div>\r\n        <div className=\"song-buttons-wrapper\">\r\n            <button className=\"song-button\" onClick={() => downloadSong(data)}>\r\n                <FaDownload />\r\n\r\n            </button>\r\n            <button className=\"song-button\" onClick={() => deleteSong(data.name)}>\r\n                <FaTrash color=\"#ed4557\" />\r\n            </button>\r\n        </div>\r\n    </div>\r\n}\r\n\r\nexport default ErrorPage","import { SimpleMenu } from 'components/SimpleMenu'\r\nimport MenuItem from 'components/MenuItem'\r\nimport { FaGithub } from 'react-icons/fa'\r\nimport './Changelog.css'\r\n\r\nexport default function Changelogpage(props) {\r\n    return <div className='default-page'>\r\n        <div className='changelog-page-title'>\r\n            Changelog\r\n        </div>\r\n        <SimpleMenu functions={{changePage: props.changePage}}>\r\n            <MenuItem>\r\n                <a href='https://github.com/Specy/genshin-music' className='icon' target=\"_blank\" rel='noreferrer'>\r\n                    <FaGithub />\r\n                </a>\r\n            </MenuItem>\r\n        </SimpleMenu>\r\n        {changelogs.map(e => <ChangelogRow\r\n            data={e}\r\n            key={e.version}\r\n        />)}\r\n        <div className='changelog-ending'>\r\n\r\n        </div>\r\n    </div>\r\n}\r\n\r\nfunction ChangelogRow(props) {\r\n    const { version, title, changes, date } = props.data\r\n    return <div>\r\n        <div className='changelog-title'>\r\n            <div className='clt-1'>\r\n                {version}\r\n            </div>\r\n            <div className='clt-2'>\r\n                {date}\r\n            </div>\r\n        </div>\r\n        <div className='changelog-list'>\r\n            <div className='cll-1'>\r\n                {title}\r\n            </div>\r\n            <ul>\r\n                {changes.map((e, i) =>\r\n                    <li key={i}>\r\n                        {e.split('$l').map((item, i, arr) => {\r\n                            if (i === 0) {\r\n                                return <div key={i}>{item}</div>\r\n                            }\r\n                            return <p key={i} className='cll-new-line'>\r\n                                {item}\r\n                            </p>\r\n                        })}\r\n                    </li>\r\n                )}\r\n            </ul>\r\n        </div>\r\n\r\n    </div>\r\n}\r\nconst changelogs = [\r\n    {\r\n        version: '2.3',\r\n        title: 'MIDI Keyboard and Performance',\r\n        date: '2022 - 3/02',\r\n        changes: [\r\n            'Added MIDI Keyboard support on all pages with custom layouts and shortcuts',\r\n            'Big performance improvements of main page',\r\n            'Added note names to sheet visualizer and empty cells',\r\n            'Added ABC format',\r\n            'Added Panflute (Sky)',\r\n            'UI improvements and bug fixes'\r\n        ]\r\n    },{\r\n        version: '2.2',\r\n        title: 'Sheet visualizer',\r\n        date: '2022 - 17/01',\r\n        changes: [\r\n            'Added sheet visualizer',\r\n            'Changed timeline behaviour when dragging the scroll bar',\r\n            'Improved performance by 2 times in some places',\r\n            'UI improvements and bug fixes'\r\n        ]\r\n    },\r\n    {\r\n        version: '2.1.1',\r\n        title: 'Zither and icons',\r\n        date: '2021 - 16/12',\r\n        changes: [\r\n            'Changed note icon and animation (Genshin)',\r\n            'Added Help page',\r\n            'Changed zither audio (Genshin)',\r\n            'UI improvements'\r\n        ]\r\n    },\r\n    {\r\n        version: '2.1',\r\n        title: 'Home menu and pages',\r\n        date: '2021 - 11/12',\r\n        changes: [\r\n            'Restructured code',\r\n            'Added opacity to some elements',\r\n            'Changed margins and padding of some elements',\r\n            'Added home page',\r\n            'Added Partners page',\r\n            'Added shortcuts for main page',\r\n            'Fixed loading bug in composer and main page',\r\n            'Added Donate page'\r\n        ]\r\n    },\r\n    {\r\n        version: '2.0',\r\n        title: 'Approaching circles',\r\n        date: '2021 - 28/11',\r\n        changes: [\r\n            `Added Approaching cirlces mode, a new way to learn a song, or a way to challange yourself.\r\n            You can find it in the main page, next to the practice button`,\r\n            `Rewrite of the main page to increase overall performance`,\r\n            `Added changelog page`,\r\n            `Added audio recording feature in main page and composer`,\r\n            `Added tabs autoplay (composer) on pc as a setting`,\r\n            `Added note animations when pressing the note`,\r\n            `Added possibility to change background image from URL`,\r\n            `Updated info page`,\r\n            `In the composer you can now press shift + note name to add a note`,\r\n            `In the composer you can press up/down keys to change layer`,\r\n            `While in the composer on PC, you can now add new notes by simply pressing the PC keyboard while in \"playing\" mode`\r\n        ]\r\n    }, {\r\n        version: '1.7',\r\n        title: 'Zither',\r\n        date: '2021 - 20/10',\r\n        changes: [\r\n            '(For genshin) Added Zither',\r\n            'Added back \"do re mi\" format'\r\n        ]\r\n    }, {\r\n        version: '1.6',\r\n        title: 'Performance tweaks',\r\n        date: '2021 - 17/10',\r\n        changes: [\r\n            'Performance of composer improved by 2x',\r\n            'Added note names for genshin (made it a setting)',\r\n            'Fixed instrument volume bug',\r\n            'Fixed keyboard layout issues',\r\n            'Fixed other small bugs'\r\n        ]\r\n    }, {\r\n        version: '1.5',\r\n        title: 'MIDI import',\r\n        date: '2021 - 14/10',\r\n        changes: [\r\n            `Added to both Sky and Genshin music nightly the MIDI import feature $l\r\n            - Music track selection (select or deselect which tracks to include) $l\r\n            - Instrument track selection (select what instrument to give to each track) $l\r\n            - Track info (get info on how successful your parsing was, accidentals and notes out of range) $l\r\n            - Change note offset (in case that the song is outside of the octaves available) \r\n            `\r\n        ]\r\n    }, {\r\n        version: '1.4',\r\n        title: 'Song library',\r\n        date: '2021 - 28/08',\r\n        changes: [\r\n            'Added song library integration, directly import songs from the app (700+ songs)',\r\n            'Bug fixes'\r\n        ]\r\n    }, {\r\n        version: '1.3',\r\n        title: 'New audio files',\r\n        date: '2021 - 25/08',\r\n        changes: [\r\n            'Changed audio files',\r\n            'Added ocarina',\r\n            'Removed support button in TWA',\r\n            'Bug fixes'\r\n        ]\r\n    }, {\r\n        version: '1.2',\r\n        title: 'Bug fixes and PWA',\r\n        date: '2021 - 18/08',\r\n        changes: [\r\n            \"(For sky) Fixed bug where sheets couldn't be imported in sky studio\",\r\n            'Changed app install to more modern approach with description and images'\r\n        ]\r\n    }, {\r\n        version: '1.1',\r\n        title: 'Sheets compatibility',\r\n        date: '2021 - 07/08',\r\n        changes: [\r\n            '(For sky) Added backwards compatibility for sheets, now sheets made in sky music nightly can be imported into sky music and sky studio (with some losses)',\r\n            'Bug fixes',\r\n            'General improvement in performance'\r\n        ]\r\n    }, {\r\n        version: '1.0',\r\n        title: 'Release',\r\n        date: '2021 - 22/05',\r\n        changes: [\r\n            '3 Instruments composition',\r\n            'Better performance than previous version',\r\n            'Better practice tool',\r\n            'Better interface',\r\n            'Breakpoints for the composer',\r\n            'New features for both composer and main page',\r\n            'Feature rich customisability to make learning and composition easier'\r\n        ]\r\n    }\r\n]\r\n","export default __webpack_public_path__ + \"static/media/windsong-db.e533a22d.jpg\";","import './Partners.css'\r\nimport { SimpleMenu } from 'components/SimpleMenu'\r\nimport WindsongDBImg from 'assets/images/partners/windsong-db.jpg'\r\n\r\nexport default function Partners(props) {\r\n    return <div className='partners-page'>\r\n        <SimpleMenu functions={{ changePage: props.changePage }} />\r\n        <div className='partner-wrapper'>\r\n            <Partner\r\n                name='Specy'\r\n                description='The youtube channel that collects videos created by users of this app'\r\n            >\r\n                <Iframe\r\n                    src='https://www.youtube.com/embed/Sh7kqYVMjwM'\r\n                    title=\"Specy\"\r\n                />\r\n            </Partner>\r\n            <Partner\r\n                name='ChaconneScott_ACG'\r\n                description='YouTube pianist and arranger, features Genshin Impact OST'\r\n            >\r\n                <Iframe\r\n                    src='https://www.youtube.com/embed/ltE8zfGfUVo'\r\n                    title=\"ChaconneScott_ACG\"\r\n                />\r\n            </Partner>\r\n            <Partner\r\n                name='uma✿'\r\n                description={`Arranges music, primarily from anime and games for Sky and Genshin.`}\r\n            >\r\n                <Iframe\r\n                    src='https://www.youtube.com/embed/7aIkAGvp9Y0'\r\n                    title=\"uma\"\r\n                />\r\n            </Partner>\r\n            <Partner\r\n                name='Windsong DB'\r\n                description='A Genshin Impact Database for Instrument Gadget Keymaps'\r\n            >\r\n                <PartnerImg \r\n                    img={WindsongDBImg}\r\n                    to='https://genshin-lyre.notion.site/genshin-lyre/Windsong-DB-8012b5f6939b486d857552c7b60e917f'\r\n                    alt='Windsong DB'\r\n                />\r\n\r\n            </Partner>\r\n        </div>\r\n\r\n    </div>\r\n}\r\n\r\nfunction PartnerImg(props){\r\n    return <a \r\n        href={props.to}\r\n        style={{width: '18.8rem', height: '10.5rem', overflow: 'hidden', borderRadius: '0.3rem'}}\r\n        target='_blank'\r\n        rel='noreferrer'\r\n    >\r\n        <img \r\n            src={props.img} \r\n            style={{width: '100%', objectFit: 'cover'}}\r\n            alt={props.alt}\r\n        />\r\n    </a>\r\n}\r\nfunction Iframe(props) {\r\n    return <iframe\r\n        src={props.src}\r\n        title={props.src}\r\n        frameBorder=\"0\"\r\n        allow=\"autoplay; picture-in-picture\"\r\n        allowFullScreen\r\n    >\r\n    </iframe>\r\n}\r\nfunction Partner(props) {\r\n    return <div className='partner'>\r\n        <div className='partner-title'>\r\n            {props.name}\r\n        </div>\r\n        <div className='partner-description'>\r\n            {props.description}\r\n        </div>\r\n        {props.children}\r\n    </div>\r\n}\r\n","import './Home.css'\r\nimport { FaCompactDisc, FaTimes } from 'react-icons/fa'\r\nimport { BsMusicPlayerFill } from 'react-icons/bs'\r\nimport { appName, isTwa } from 'appConfig'\r\n\r\nexport default function Home({changePage,data, askForStorage, hasVisited, toggleHome, currentPage, setDontShowHome}) {\r\n    const to = changePage\r\n    const homeClass = data.isInPosition ? \"home\" : \"home home-visible\"\r\n    const breakpoint = window.innerWidth > 900\r\n    return <div className={homeClass}>\r\n        <FaTimes className='close-home' onClick={() => toggleHome(false)} />\r\n        {(breakpoint || !hasVisited) && <div className='home-top'>\r\n            <div className='home-title'>\r\n                {appName} Music Nightly\r\n            </div>\r\n            <div className='home-top-text'>\r\n                An app where you can create, practice and play songs for {appName}\r\n            </div>\r\n        </div>  \r\n        }\r\n\r\n        {!hasVisited && <div className='home-welcome'>\r\n            <div>\r\n                {!isTwa() && <div className='home-spacing'>\r\n                    To have the webapp fullscreen and better view, please add the website to the home screen\r\n                </div>}\r\n                <div  className='home-spacing'>\r\n                    <div className=\"red-text\">WARNING</div>:\r\n                    Clearing your browser cache / storage might delete your songs, make sure you make backups\r\n                </div>\r\n                {data.hasPersistentStorage ?\r\n                    <div>\r\n                        <div className=\"red-text\">WARNING</div>: Click the button below to make sure that your browser won't delete your songs if you\r\n                        lack storage\r\n                    </div>\r\n                    : null\r\n                }\r\n            </div>\r\n            <div style={{display:'flex', justifyContent:'flex-end'}}>\r\n                <button className=\"home-accept-storage\" onClick={askForStorage}>\r\n                    Confirm\r\n                </button>\r\n            </div>\r\n\r\n        </div>}\r\n        <div className='home-content'>\r\n            <MainContentelement\r\n                icon={<FaCompactDisc />}\r\n                title='Composer'\r\n                background={`./manifestData/composer.png`}\r\n                onClick={() => to(\"Composer\")}\r\n                current={currentPage === 'Composer'}\r\n            >\r\n                Create or edit songs with a fully fledged music composer. Also with MIDI.\r\n            </MainContentelement>\r\n            <MainContentelement\r\n                icon={<BsMusicPlayerFill />}\r\n                title='Player'\r\n                background={`./manifestData/main.png`}\r\n                onClick={() => to(\"\")}\r\n                current={currentPage === '' || currentPage === 'Player' }\r\n            >\r\n                Play, download, record and import songs. Learn a song with approaching circle\r\n                mode and practice mode.\r\n            </MainContentelement>\r\n        </div>\r\n        <Separator> Other pages </Separator>\r\n        <div className='page-redirect-wrapper'>\r\n            <PageRedirect onClick={() => to(\"Changelog\")} current={currentPage === 'Changelog'}>\r\n                Changelog\r\n            </PageRedirect>\r\n            {!isTwa() &&\r\n                <PageRedirect onClick={() => to(\"Donate\")} current={currentPage === 'Donate'}>\r\n                    Donate\r\n                </PageRedirect>\r\n            }\r\n            <PageRedirect onClick={() => to(\"Partners\")} current={currentPage === 'Partners'}>\r\n                Partners\r\n            </PageRedirect>\r\n            <PageRedirect onClick={() => to(\"Help\")} current={currentPage === 'Help'}>\r\n                Help\r\n            </PageRedirect>\r\n            <PageRedirect onClick={() => to(\"SheetVisualizer\")} current={currentPage === 'SheetVisualizer'}>\r\n                Sheet visualizer\r\n            </PageRedirect>\r\n        </div>\r\n        <div className='home-dont-show-again' onClick={() => setDontShowHome(!data.canShow)}>\r\n            <input type='checkbox' checked={!data.canShow} readOnly />\r\n            Hide on open\r\n        </div>\r\n        <div className='home-bottom'> \r\n            <div>\r\n                © All rights reserved by {appName === 'Genshin' ? 'miHoYo' : 'TGC'}. Other properties belong to their respective owners. \r\n            </div>\r\n        </div>\r\n\r\n    </div>\r\n}\r\n\r\nfunction PageRedirect({children, onClick, current}) {\r\n    return <button onClick={onClick} className={current ? 'current-page' : ''}>\r\n        {children}\r\n    </button>\r\n}\r\n\r\nfunction MainContentelement({title, icon, children, background, onClick, current}) {\r\n    return <div className={`home-content-element ${current ? 'current-page' : ''}`} onClick={onClick}>\r\n        <div className='home-content-background' style={{ backgroundImage: `url(${background})` }}>\r\n        </div>\r\n        <div className='home-content-main'>\r\n            <div className='home-content-title'>\r\n                {icon} {title}\r\n            </div>\r\n            <div className='home-content-text'>\r\n                {children}\r\n            </div>\r\n            <div className='home-content-open'>\r\n                <button>\r\n                    OPEN\r\n                </button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n}\r\n\r\nfunction Separator({children}) {\r\n    return <div className='home-separator'>\r\n        {children}\r\n    </div>\r\n}","import { HelpTab } from \"components/HelpTab\"\r\nimport { SimpleMenu } from \"components/SimpleMenu\"\r\n\r\nexport default function Help(props){\r\n    return <div className=\"default-page\">\r\n        <SimpleMenu functions={{changePage: props.changePage}}/>\r\n        <div>\r\n            <div style={{fontSize: '2rem', margin: '1rem 0'}}>\r\n                Info about the app\r\n            </div>\r\n            <div style={{marginLeft: '1rem'}}>\r\n                In this page you will find an explaination for what all the buttons in the app do and\r\n                how to use them.\r\n                <br/><br/>\r\n                If you Have issues, bugs, or suggestions, please join our \r\n                <a href=\"https://discord.gg/Arsf65YYHq\" style={{color: 'var(--note-text)'}}>\r\n                <>&nbsp;</> Discord server\r\n                </a>\r\n                . <br/>\r\n            </div>\r\n            <HelpTab />\r\n        </div>\r\n    </div>\r\n}","import './SheetVisualizer.css'\r\nimport { useEffect, useState } from 'react'\r\nimport { SimpleMenu } from 'components/SimpleMenu'\r\nimport { DB } from 'Database'\r\nimport { appName } from 'appConfig'\r\nimport { ComposerToRecording, getNoteText } from 'lib/Utils'\r\nimport Switch from 'components/Switch'\r\nimport Analytics from 'lib/Analytics'\r\n\r\nconst THRESHOLDS = {\r\n    joined: 50,\r\n    pause: 400,\r\n}\r\n\r\n\r\nexport default function SheetVisualizer(props) {\r\n    const [songs, setSongs] = useState([])\r\n    const [sheet, setSheet] = useState([])\r\n    const [framesPerRow, setFramesPerRow] = useState(7)\r\n    const [currentSong, setCurrentSong] = useState({})\r\n    const [selectedSongType, setSelectedSongType] = useState('recorded')\r\n    const [hasText, setHasText] = useState(false)\r\n    const [songAsText, setSongAstext] = useState('')\r\n    function setFrames(amount) {\r\n        const newAmount = framesPerRow + amount\r\n        const frame = document.querySelector('.frame-outer')\r\n        if (!frame || newAmount < 1) return\r\n        const width = frame.getBoundingClientRect().width\r\n        if (width < 50 && amount === 1) return\r\n        setFramesPerRow(newAmount)\r\n    }\r\n\r\n    useEffect(() => {\r\n        async function load() {\r\n            setSongs(await DB.getSongs())\r\n        }\r\n        load()\r\n    }, [])\r\n\r\n    function getChunkNoteText(i) {  \r\n        const text = getNoteText(appName === 'Genshin' ? 'Keyboard layout' : 'ABC', i, 'C', appName === \"Genshin\" ? 21 : 15)\r\n        return appName === 'Genshin' ? text.toLowerCase() : text.toUpperCase()\r\n    }\r\n    function handleClick(song) {\r\n        setCurrentSong(song)\r\n        let lostReference = JSON.parse(JSON.stringify(song))\r\n        if (lostReference.data?.isComposedVersion) {\r\n            lostReference = ComposerToRecording(lostReference)\r\n        }\r\n        const notes = lostReference.notes\r\n        const chunks = []\r\n        let previousChunkDelay = 0\r\n        let sheetText = ''\r\n        for (let i = 0; notes.length > 0; i++) {\r\n            const chunk = new Chunk([notes.shift()])\r\n            const startTime = chunk.notes.length > 0 ? chunk.notes[0][1] : 0\r\n            for (let j = 0; j < notes.length && j < 20; j++) {\r\n                let difference = notes[j][1] - chunk.notes[0][1] - THRESHOLDS.joined //TODO add threshold here\r\n                if (difference < 0) {\r\n                    chunk.notes.push(notes.shift())\r\n                    j--\r\n                }\r\n            }\r\n            chunk.delay = previousChunkDelay\r\n            previousChunkDelay = notes.length > 0 ? notes[0][1] - startTime : 0\r\n            const emptyChunks = Math.floor(chunk.delay / THRESHOLDS.pause)\r\n            chunks.push(...new Array(emptyChunks).fill(0).map(() => new Chunk()))\r\n            chunks.push(chunk)\r\n            sheetText += emptyChunks > 2 ? ' \\n\\n' : \"- \".repeat(emptyChunks)\r\n            if (chunk.notes.length > 1) {\r\n                const text = chunk.notes.map(e => getChunkNoteText(e[0])).join('')\r\n                sheetText += appName === \"Genshin\" ? `[${text}] ` : `${text} `\r\n            } else if (chunk.notes.length > 0) {\r\n                sheetText += `${getChunkNoteText(chunk.notes[0][0])} `\r\n            }\r\n        }\r\n        setSongAstext(sheetText)\r\n        setSheet(chunks)\r\n        Analytics.songEvent({type:'visualize'})\r\n    }\r\n\r\n    return <div className='default-page'>\r\n        <div style={{ display: 'flex', alignItems: 'center', flexDirection: 'column' }}>\r\n            <SimpleMenu functions={{ changePage: props.changePage }} className='noprint' />\r\n            <div>\r\n                <div className='displayer-songs-wrapper noprint' style={{ marginTop: '0' }}>\r\n                    <div className=\"tab-selector-wrapper\">\r\n                        <button\r\n                            className={selectedSongType === \"recorded\" ? \"tab-selector tab-selected\" : \"tab-selector\"}\r\n                            onClick={() => setSelectedSongType(\"recorded\")}\r\n                        >\r\n                            Recorded\r\n                        </button>\r\n                        <button\r\n                            className={selectedSongType === \"composed\" ? \"tab-selector tab-selected\" : \"tab-selector\"}\r\n                            onClick={() => setSelectedSongType(\"composed\")}\r\n                        >\r\n                            Composed\r\n                        </button>\r\n                    </div>\r\n                    <div className=\"songs-wrapper\">\r\n                        {songs.filter((song) => selectedSongType === 'composed' ? song.data?.isComposedVersion : !song.data?.isComposedVersion\r\n                        ).map((song) =>\r\n                            <SongRow\r\n                                key={song?.name}\r\n                                current={song === currentSong}\r\n                                data={song}\r\n                                functions={{\r\n                                    click: handleClick\r\n                                }}\r\n                            />\r\n                        )}\r\n\r\n                    </div>\r\n                </div>\r\n                <div className='displayer-buttons-wrapper noprint'>\r\n                    <div style={{ display: 'flex', alignItems: 'center' }}>\r\n                        <div style={{ marginRight: '0.5rem' }}>Note names</div>\r\n                        <Switch checked={hasText} onChange={setHasText} />\r\n                    </div>\r\n                    <div style={{ display: 'flex', alignItems: 'center' }}>\r\n                        Per row: {framesPerRow}\r\n                        <button className='displayer-plus-minus'\r\n                            onClick={() => setFrames(-1)}>\r\n                            -\r\n                        </button>\r\n                        <button className='displayer-plus-minus'\r\n                            onClick={() => setFrames(1)}>\r\n                            +\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <h1 className='onprint'>\r\n                {currentSong?.name}\r\n            </h1>\r\n            <div style={{ color: 'var(--whitish)', width: '100%' }} className='noprint'>\r\n                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>\r\n                    <h2>{currentSong.name || 'No song selected'}</h2>\r\n                    <button onClick={() => window.print()} className='genshin-button'>\r\n                        Print as PDF\r\n                    </button>\r\n                </div>\r\n                <div style={{ color: 'var(--hint-main)' }}>\r\n                    Remember that you can learn a song with the interactive\r\n                    practice tool in the main page\r\n                </div>\r\n            </div>\r\n            <div\r\n                className='displayer-frame-wrapper'\r\n                style={{ gridTemplateColumns: `repeat(${framesPerRow},1fr)` }}\r\n            >\r\n\r\n                {sheet.map((frame, i) =>\r\n                    <SheetFrame\r\n                        key={i}\r\n                        framesPerRow={framesPerRow}\r\n                        frame={frame}\r\n                        rows={3}\r\n                        hasText={hasText}\r\n                    />\r\n                )}\r\n            </div>\r\n            {songAsText.trim().length > 0 && <pre className='text-notation-wrapper'>\r\n                {songAsText}\r\n            </pre>}\r\n\r\n        </div>\r\n    </div>\r\n}\r\n\r\nclass Chunk {\r\n    notes = []\r\n    delay = 0\r\n    constructor(notes = [], delay = 0) {\r\n        this.notes = notes\r\n        this.delay = delay\r\n    }\r\n}\r\nfunction SheetFrame({ frame, rows, hasText }) {\r\n    const columnsPerRow = appName === 'Genshin' ? 7 : 5\r\n    const notes = new Array(columnsPerRow * rows).fill(0)\r\n    frame.notes.forEach(note => {\r\n        notes[note[0]] = 1\r\n    })\r\n    return frame.notes.length === 0\r\n        ? <div className='frame-outer displayer-ball'>\r\n            <div></div>\r\n        </div>\r\n        : <div className='frame-outer'>\r\n            <div className='displayer-frame' style={{ gridTemplateColumns: `repeat(${columnsPerRow},1fr)` }}>\r\n                {notes.map((exists, i) => {\r\n                    return <div className={exists ? 'frame-note-s' : 'frame-note-ns'} key={i}>\r\n                        {(exists && hasText) \r\n                            ? getNoteText(appName === 'Genshin' ? 'Keyboard layout' : 'ABC', i, 'C', appName === 'Genshin' ? 21 : 15) \r\n                            : null\r\n                        }\r\n                    </div>\r\n                })}\r\n            </div>\r\n        </div>\r\n}\r\n\r\n\r\nfunction SongRow(props) {\r\n    const { data, current } = props\r\n    const selectedStyle = current ? { backgroundColor: 'rgb(124, 116, 106)' } : {}\r\n    return <div\r\n        className=\"song-row\"\r\n        style={selectedStyle}\r\n        onClick={() => props.functions.click(data)}>\r\n        <div className=\"song-name\">\r\n            {data.name}\r\n        </div>\r\n    </div>\r\n}","import { cssClasses, appName } from \"appConfig\"\r\nimport GenshinNoteBorder from 'components/GenshinNoteBorder'\r\nexport default function BaseNote( { data, noteText = 'A', handleClick, noteImage }){\r\n    const className = parseClass(data.status)\r\n    return <button\r\n        onPointerDown={(e) => {\r\n            e.preventDefault()\r\n            handleClick(data)\r\n        }}\r\n        className=\"button-hitbox-bigger\"\r\n    >\r\n        <div\r\n            className={className}\r\n            style={{borderColor: parseBorderColor(data.status)}}\r\n        >\r\n            <img\r\n                draggable=\"false\"\r\n                alt=''\r\n                src={noteImage}\r\n            />\r\n            {appName === 'Genshin' && <GenshinNoteBorder\r\n                className='genshin-border'\r\n                fill={parseBorderColor(data.status)}\r\n            />}\r\n            <div className={cssClasses.noteName}>\r\n                {noteText}\r\n            </div>\r\n        </div>\r\n    </button>\r\n}\r\n\r\nfunction parseClass(status) {\r\n    let className = cssClasses.note\r\n    switch (status) {\r\n        case 'clicked': className += \" click-event\"; break;\r\n        default: break;\r\n    }\r\n    return className\r\n}\r\n\r\nfunction parseBorderColor(status) {\r\n    let fill = '#eae5ce'\r\n    if (status === \"clicked\") fill = \"transparent\"\r\n    else if (status === 'wrong') fill = \"#d66969\"\r\n    else if (status === 'right') fill = \"#358a55\"\r\n\r\n    return fill\r\n}","export default function Shortcut({status, onClick, type, selected, midi}){\r\n    return <div className={`genshin-button midi-shortcut ${status} ${selected ? 'selected' : ''}`} onClick={() => onClick(type)}>\r\n        {prepareText(type) + ` (${midi === -1 ? 'NA': midi})`}\r\n    </div>\r\n}\r\n\r\nfunction prepareText(text){\r\n    return (text[0]?.toUpperCase() + text.substring(1)).split('_').join(' ')\r\n}","\r\nimport { SimpleMenu } from \"components/SimpleMenu\"\r\nimport './MidiSetup.css'\r\nimport { appName } from \"appConfig\"\r\nimport { LoggerEvent } from \"lib/Utils\"\r\nimport { getMIDISettings } from \"lib/SettingsObj\"\r\nimport BaseNote from \"components/BaseNote\"\r\nimport { layoutImages, MIDI_STATUS } from \"appConfig\"\r\nimport React, { Component } from 'react'\r\nimport { audioContext, instruments, isMidiAvailable } from \"appConfig\"\r\nimport Instrument from \"lib/Instrument\"\r\nimport Shortcut from \"./Shortcut\"\r\nexport default class MidiSetup extends Component {\r\n    constructor(props) {\r\n        super(props)\r\n        this.state = {\r\n            settings: getMIDISettings(),\r\n            instrument: new Instrument(),\r\n            selectedNote: null,\r\n            selectedShortcut: null,\r\n            sources: [],\r\n            selectedSource: undefined\r\n        }\r\n        this.audioContext = audioContext\r\n        this.mounted = true\r\n        this.MidiAccess = undefined\r\n    }\r\n\r\n    componentDidMount() {\r\n        this.init()\r\n    }\r\n    componentWillUnmount() {\r\n        const { sources } = this.state\r\n        this.mounted = false\r\n        if (this.MidiAccess) this.MidiAccess.onstatechange = null\r\n        //TODO connect to saved up keyboard\r\n        sources?.forEach(source => {\r\n            source.onmidimessage = null\r\n        })\r\n        if (this.selectedSource) this.selectedSource.onmidimessage = null\r\n    }\r\n    init = () => {\r\n        this.loadInstrument(instruments[0])\r\n        if (isMidiAvailable) {\r\n            navigator.requestMIDIAccess().then(this.initMidi, () => {\r\n                new LoggerEvent('Error', 'MIDI permission not accepted').trigger()\r\n            })\r\n        } else {\r\n            new LoggerEvent('Error', 'MIDI is not supported on this browser').trigger()\r\n        }\r\n    }\r\n    initMidi = (e) => {\r\n        if (!this.mounted) return\r\n        e.onstatechange = this.midiStateChange\r\n        this.MidiAccess = e\r\n        const midiInputs = this.MidiAccess.inputs.values()\r\n        const inputs = []\r\n        for (let input = midiInputs.next(); input && !input.done; input = midiInputs.next()) {\r\n            inputs.push(input.value)\r\n        }\r\n        this.setState({ sources: inputs })\r\n    }\r\n    midiStateChange = (e) => {\r\n        if (!this.mounted) return\r\n        const { sources } = this.state\r\n        const midiInputs = this.MidiAccess.inputs.values()\r\n        const inputs = []\r\n        for (let input = midiInputs.next(); input && !input.done; input = midiInputs.next()) {\r\n            inputs.push(input.value)\r\n        }\r\n        this.setState({ sources: inputs })\r\n\r\n        if (sources.length > inputs.length)\r\n            new LoggerEvent('Warning', 'Device disconnected').trigger()\r\n        else if (inputs.length > 0)\r\n            new LoggerEvent('Warning', 'Device connected').trigger()\r\n    }\r\n    selectMidi = (e) => {\r\n        if (!this.mounted) return\r\n        const { sources, selectedSource, settings } = this.state\r\n        const nextSource = sources.find(s => s.id === e.target.value)\r\n        if (selectedSource) selectedSource.onmidimessage = null\r\n        if (!nextSource) return\r\n        nextSource.onmidimessage = this.handleMidi\r\n        settings.currentSource = nextSource.name + \" \" + nextSource.manufacturer\r\n        this.setState({ selectedSource: nextSource, settings })\r\n        this.saveLayout()\r\n    }\r\n    deselectNotes = () => {\r\n        const { settings } = this.state\r\n        settings.notes.forEach(note => {\r\n            note.status = note.midi < 0 ? 'wrong' : 'right'\r\n        })\r\n        this.setState({ settings })\r\n    }\r\n    saveLayout = () => {\r\n        const { settings } = this.state\r\n        settings.enabled = true\r\n        this.setState({ settings })\r\n        localStorage.setItem(appName + '_MIDI_Settings', JSON.stringify(this.state.settings))\r\n    }\r\n    loadInstrument = async (name) => {\r\n        this.state.instrument?.delete?.()\r\n        const newInstrument = new Instrument(name)\r\n        await newInstrument.load()\r\n        if (!this.mounted) return\r\n        newInstrument.connect(this.audioContext.destination)\r\n        this.setState({\r\n            instrument: newInstrument\r\n        })\r\n    }\r\n    checkIfUsed = (midi, type) => {\r\n        const { shortcuts, notes } = this.state.settings\r\n        if (shortcuts.find(e => e.midi === midi) && ['all','shortcuts'].includes(type) ) return true\r\n        if(notes.find(e => e.midi === midi) && ['all','notes'].includes(type) ) return true\r\n        return false\r\n    }\r\n    handleMidi = (event) => {\r\n        const { selectedNote, settings, selectedShortcut } = this.state\r\n        const [eventType, note, velocity] = event.data\r\n\r\n        if (MIDI_STATUS.down === eventType && velocity !== 0) {\r\n            if (selectedNote) {\r\n                if(this.checkIfUsed(note,'shortcuts')) return new LoggerEvent('Warning', 'Key already used').trigger()\r\n                selectedNote.midi = note\r\n                this.deselectNotes()\r\n                this.setState({ selectedNote: null })\r\n                this.saveLayout()\r\n            }\r\n            \r\n            if (selectedShortcut) {\r\n                const shortcut = settings.shortcuts.find(e => e.type === selectedShortcut)\r\n                if(this.checkIfUsed(note,'all')) return new LoggerEvent('Warning', 'Key already used').trigger()\r\n                if (shortcut) {\r\n                    shortcut.midi = note\r\n                    shortcut.status = note < 0 ? 'wrong' : 'right'\r\n                    this.setState({ settings: settings })\r\n                    this.saveLayout()\r\n                }\r\n            }\r\n            const shortcut = settings.shortcuts.find(e => e.midi === note)\r\n            if(shortcut){\r\n                shortcut.status = 'clicked'\r\n                setTimeout(() => {\r\n                    shortcut.status = note < 0 ? 'wrong' : 'right'\r\n                    this.setState({ settings: settings })\r\n                },150)\r\n                this.setState({ settings: settings })\r\n\r\n            }\r\n            const keyboardNotes = settings.notes.filter(e => e.midi === note)\r\n            keyboardNotes.forEach(keyboardNote => {\r\n                this.handleClick(keyboardNote, true)\r\n            })\r\n        }\r\n    }\r\n    handleClick = (note, animate = false) => {\r\n        const { settings } = this.state\r\n        if (!animate) this.deselectNotes()\r\n        note.status = 'clicked'\r\n        if (animate) {\r\n            setTimeout(() => {\r\n                note.status = note.midi < 0 ? 'wrong' : 'right'\r\n                this.setState({ settings })\r\n            }, 200)\r\n            this.setState({ settings, selectedShortcut: null })\r\n        } else {\r\n            this.setState({ settings, selectedNote: note, selectedShortcut: null })\r\n        }\r\n        this.playSound(note)\r\n    }\r\n    handleShortcutClick = (shortcut) => {\r\n        this.deselectNotes()\r\n        if (this.state.selectedShortcut === shortcut) {\r\n            return this.setState({ selectedShortcut: null, selectedNote: null })\r\n        }\r\n        this.setState({ selectedShortcut: shortcut, selectedNote: null })\r\n    }\r\n    playSound = (note) => {\r\n        if (note === undefined) return\r\n        this.state.instrument.play(note.index, 1)\r\n    }\r\n\r\n    render() {\r\n        const { settings, sources, selectedShortcut } = this.state\r\n        const { changePage } = this.props\r\n        return <div className=\"default-page\">\r\n            <SimpleMenu functions={{ changePage: changePage }} />\r\n            <div className=\"default-content\" style={{ alignItems: 'center' }}>\r\n                <div className=\"column midi-setup-column\">\r\n                    <div>\r\n                        Select MIDI device:\r\n                        <select\r\n                            className=\"midi-select\"\r\n                            defaultValue={'None'}\r\n                            onChange={this.selectMidi}\r\n                        >\r\n                            <option disabled value={'None'}> None</option>\r\n                            {sources.map((e, i) => <option value={e.id} key={i}>\r\n                                {e.name}\r\n                            </option>)\r\n                            }\r\n                        </select>\r\n                    </div>\r\n                    <div style={{ margin: '0.5rem 0' }}>\r\n                        Click on the note to map, then press your MIDI keyboard\r\n                    </div>\r\n                </div>\r\n                <div className=\"midi-setup-content\">\r\n                    <div\r\n                        className={appName === 'Genshin' ? \"keyboard\" : \"keyboard keyboard-5\"}\r\n                        style={{ marginTop: 'auto', width: 'fit-content' }}\r\n                    >\r\n                        {settings.notes.map((note, i) => {\r\n                            const noteImage = layoutImages[settings.notes.length][note.index]\r\n                            return <BaseNote\r\n                                key={i}\r\n                                handleClick={this.handleClick}\r\n                                data={note}\r\n                                noteImage={`./assets/icons/keys/${noteImage}.svg`}\r\n                                noteText={note.midi < 0 ? 'NA' : note.midi}\r\n                            />\r\n                        })}\r\n                    </div>\r\n                    <div className=\"midi-shortcuts-wrapper\">\r\n                        <div style={{ fontSize: '1.5rem' }}>\r\n                            Shortcuts\r\n                        </div>\r\n                        <div className=\"midi-shortcuts\">\r\n                            {settings.shortcuts.map(shortcut =>\r\n                                <Shortcut\r\n                                    key={shortcut.type}\r\n                                    type={shortcut.type}\r\n                                    status={shortcut.status}\r\n                                    midi={shortcut.midi}\r\n                                    selected={selectedShortcut === shortcut.type}\r\n                                    onClick={this.handleShortcutClick}\r\n                                />\r\n                            )}\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    }\r\n}","// This optional code is used to register a service worker.\r\n// register() is not called by default.\r\n\r\n// This lets the app load faster on subsequent visits in production, and gives\r\n// it offline capabilities. However, it also means that developers (and users)\r\n// will only see deployed updates on subsequent visits to a page, after all the\r\n// existing tabs open on the page have been closed, since previously cached\r\n// resources are updated in the background.\r\n\r\n// To learn more about the benefits of this model and instructions on how to\r\n// opt-in, read https://cra.link/PWA\r\n\r\nconst isLocalhost = Boolean(\r\n  window.location.hostname === 'localhost' ||\r\n    // [::1] is the IPv6 localhost address.\r\n    window.location.hostname === '[::1]' ||\r\n    // 127.0.0.0/8 are considered localhost for IPv4.\r\n    window.location.hostname.match(/^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/)\r\n);\r\n\r\nexport function register(config) {\r\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\r\n    // The URL constructor is available in all browsers that support SW.\r\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\r\n    if (publicUrl.origin !== window.location.origin) {\r\n      // Our service worker won't work if PUBLIC_URL is on a different origin\r\n      // from what our page is served on. This might happen if a CDN is used to\r\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\r\n      return;\r\n    }\r\n\r\n    window.addEventListener('load', () => {\r\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\r\n      if (isLocalhost) {\r\n        // This is running on localhost. Let's check if a service worker still exists or not.\r\n        checkValidServiceWorker(swUrl, config);\r\n\r\n        // Add some additional logging to localhost, pointing developers to the\r\n        // service worker/PWA documentation.\r\n        navigator.serviceWorker.ready.then(() => {\r\n          console.log(\r\n            'This web app is being served cache-first by a service ' +\r\n              'worker. To learn more, visit https://cra.link/PWA'\r\n          );\r\n        });\r\n      } else {\r\n        // Is not localhost. Just register service worker\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction registerValidSW(swUrl, config) {\r\n  navigator.serviceWorker\r\n    .register(swUrl)\r\n    .then((registration) => {\r\n      registration.onupdatefound = () => {\r\n        const installingWorker = registration.installing;\r\n        if (installingWorker == null) {\r\n          return;\r\n        }\r\n        installingWorker.onstatechange = () => {\r\n          if (installingWorker.state === 'installed') {\r\n            if (navigator.serviceWorker.controller) {\r\n              // At this point, the updated precached content has been fetched,\r\n              // but the previous service worker will still serve the older\r\n              // content until all client tabs are closed.\r\n              console.log(\r\n                'New content is available and will be used when all ' +\r\n                  'tabs for this page are closed. See https://cra.link/PWA.'\r\n              );\r\n\r\n              // Execute callback\r\n              if (config && config.onUpdate) {\r\n                config.onUpdate(registration);\r\n              }\r\n            } else {\r\n              // At this point, everything has been precached.\r\n              // It's the perfect time to display a\r\n              // \"Content is cached for offline use.\" message.\r\n              console.log('Content is cached for offline use.');\r\n\r\n              // Execute callback\r\n              if (config && config.onSuccess) {\r\n                config.onSuccess(registration);\r\n              }\r\n            }\r\n          }\r\n        };\r\n      };\r\n    })\r\n    .catch((error) => {\r\n      console.error('Error during service worker registration:', error);\r\n    });\r\n}\r\n\r\nfunction checkValidServiceWorker(swUrl, config) {\r\n  // Check if the service worker can be found. If it can't reload the page.\r\n  fetch(swUrl, {\r\n    headers: { 'Service-Worker': 'script' },\r\n  })\r\n    .then((response) => {\r\n      // Ensure service worker exists, and that we really are getting a JS file.\r\n      const contentType = response.headers.get('content-type');\r\n      if (\r\n        response.status === 404 ||\r\n        (contentType != null && contentType.indexOf('javascript') === -1)\r\n      ) {\r\n        // No service worker found. Probably a different app. Reload the page.\r\n        navigator.serviceWorker.ready.then((registration) => {\r\n          registration.unregister().then(() => {\r\n            window.location.reload();\r\n          });\r\n        });\r\n      } else {\r\n        // Service worker found. Proceed as normal.\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    })\r\n    .catch(() => {\r\n      console.log('No internet connection found. App is running in offline mode.');\r\n    });\r\n}\r\n\r\nexport function unregister() {\r\n  if ('serviceWorker' in navigator) {\r\n    navigator.serviceWorker.ready\r\n      .then((registration) => {\r\n        registration.unregister();\r\n      })\r\n      .catch((error) => {\r\n        console.error(error.message);\r\n      });\r\n  }\r\n}\r\n","export default function FloatingMessage(props){\r\n    const { title, text, visible, onClick} = props\r\n\tlet classes = visible ? \"floating-message floating-message-visible\" : \"floating-message\"\r\n    return <div className={classes} onClick={onClick}>\r\n    <div className=\"floating-message-title\">\r\n        {title}\r\n    </div>\r\n    <div className=\"floating-message-text\">\r\n        {text}\r\n    </div>\r\n</div>\r\n}","export default __webpack_public_path__ + \"static/media/paypalme.45abe55e.png\";","export default __webpack_public_path__ + \"static/media/buymeacoffee.b124acdd.svg\";","import './Donate.css'\r\nimport paypalImg from 'assets/images/paypalme.png'\r\nimport buyMeACoffeeImg from 'assets/images/buymeacoffee.svg'\r\nimport kofiImg from 'assets/images/kofi.png'\r\nimport { SimpleMenu } from 'components/SimpleMenu'\r\nexport default function Donate(props) {\r\n    return <div className='default-page'>\r\n        <SimpleMenu functions={{changePage: props.changePage}}/>\r\n        <div className=\"donate-text\">\r\n            Each App I make takes months of learning and development. Added to that\r\n            are also the costs of hosting. With a higher budget I can afford to not\r\n            worry so much about how much I spend on the server, giving you the best\r\n            possible experience.<br />\r\n            I care about giving users all features without\r\n            having to pay for it, neither having intrusive ads which can be annoying.\r\n            For this same reason, there is no source of income except donations.\r\n            <br /><br />\r\n            I would be really thankful if you could consider donating in order to fund\r\n            development and costs.\r\n        </div>\r\n        <div className=\"donation-wrapper\">\r\n            <a href=\"https://paypal.me/specyDev\" target=\"_blank\" className=\"paypal\" rel=\"noreferrer\">\r\n                <img src={paypalImg} alt=\"paypalme\" style={{ height: \"3rem\" }} />\r\n            </a>\r\n            <a href=\"https://ko-fi.com/specy\" target=\"_blank\" className=\"kofi\" rel=\"noreferrer\">\r\n                <img src={kofiImg} alt=\"kofi\" style={{ height: \"2rem\" }} />\r\n            </a>\r\n            <a href=\"https://www.buymeacoffee.com/specy\" target=\"_blank\" rel=\"noreferrer\">\r\n                <img src={buyMeACoffeeImg} alt=\"buymeacoffee\" style={{ height: \"3rem\" }} />\r\n            </a>\r\n        </div>\r\n    </div>\r\n}","export default \"data:image/png;base64,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\"","export default __webpack_public_path__ + \"static/media/rotate.e7c0f107.svg\";","import React, { Component } from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport App from 'pages/Main';\r\nimport Composer from \"pages/Composer\"\r\nimport ErrorPage from \"pages/ErrorPage\"\r\nimport Changelogpage from 'pages/Changelog'\r\nimport Partners from 'pages/Partners';\r\nimport Home from 'pages/Home';\r\nimport Help from 'pages/Help';\r\nimport SheetVisualizer from 'pages/SheetVisualizer';\r\nimport MidiSetup from 'pages/MidiSetup';\r\nimport * as serviceWorkerRegistration from './serviceWorkerRegistration';\r\nimport { HashRouter, Route, Redirect } from \"react-router-dom\";\r\nimport { LoggerEvent, delayMs } from \"lib/Utils\"\r\nimport { appName, appVersion, pages, isTwa, updateMessage } from \"appConfig\"\r\nimport FloatingMessage from 'components/FloatingMessage'\r\nimport Donate from 'pages/Donate';\r\nimport rotateImg from \"assets/icons/rotate.svg\"\r\nimport Analytics from 'lib/Analytics';\r\nclass Index extends Component {\r\n\tconstructor(props) {\r\n\t\tsuper(props)\r\n\t\tlet path = window.location.href.split(\"/\")\r\n\t\tpath = path.length === 0 ? \"\" : path = path[path.length - 1]\r\n\t\tif (!pages.includes(path)) path = \"\"\r\n\t\tconst hasVisited = localStorage.getItem(appName + \"_Visited\")\r\n\t\tlet canShowHome = localStorage.getItem(appName + \"_ShowHome\")\r\n\t\tcanShowHome = canShowHome === null ? 'true' : canShowHome\r\n\t\tthis.state = {\r\n\t\t\tfloatingMessage: {\r\n\t\t\t\ttimestamp: 0,\r\n\t\t\t\tvisible: false,\r\n\t\t\t\ttext: \"Text\",\r\n\t\t\t\ttitle: \"Title\"\r\n\t\t\t},\r\n\t\t\thomeData: {\r\n\t\t\t\tcanShow: canShowHome === 'true',\r\n\t\t\t\tvisible: canShowHome === 'true',\r\n\t\t\t\tisInPosition: false,\r\n\t\t\t\thasPersistentStorage: Boolean(navigator.storage && navigator.storage.persist)\r\n\t\t\t},\r\n\t\t\tselectedPage: path,\r\n\t\t\thasVisited: hasVisited === 'true'\r\n\t\t}\r\n\t\tthis.updateChecked = false\r\n\t\tthis.pageHeight = 0\r\n\t}\r\n\tcomponentDidMount() {\r\n\t\twindow.addEventListener('logEvent', this.logEvent);\r\n\t\twindow.addEventListener('resize', this.handleResize)\r\n\t\twindow.addEventListener('blur', this.handleBlur)\r\n\t\tthis.checkUpdate()\r\n\t\tAnalytics.UIEvent('version', { version: appVersion })\r\n\t\tthis.pageHeight = window.innerHeight\r\n\t\tdocument.title = this.state.selectedPage\r\n\t}\r\n\r\n\thandleResize = () => {\r\n\t\tif (document.activeElement?.tagName === 'INPUT') {\r\n\t\t\tif (this.pageHeight === window.innerHeight || this.pageHeight !== 0) return\r\n\t\t\treturn this.setHeight(this.pageHeight)\r\n\t\t}\r\n\t\tthis.pageHeight = window.innerHeight\r\n\t\tthis.resetHeight()\r\n\t}\r\n\t\r\n\tsetHeight = (h) => {\r\n\t\tdocument.body.style.minHeight = h + 'px'\r\n\t}\r\n\r\n\tresetHeight = () => {\r\n\t\tdocument.body.style = ''\r\n\t}\r\n\r\n\thandleBlur = () => {\r\n\t\tconst active = document.activeElement\r\n\t\tif (active.tagName === 'INPUT') active?.blur()\r\n\t\tthis.resetHeight()\r\n\t}\r\n\r\n\tcomponentWillUnmount() {\r\n\t\twindow.removeEventListener('logEvent', this.logEvent);\r\n\t\twindow.removeEventListener('resize', this.handleResize)\r\n\t\twindow.removeEventListener('blur', this.handleBlur)\r\n\t}\r\n\r\n\tchangePage = (page) => {\r\n\t\t//TODO manually changing page doesnt actually change page at next reroute\r\n\t\tif (page === 'home') return this.toggleHome(true)\r\n\t\tif (this.state.homeData.visible) this.toggleHome(false)\r\n\t\tthis.setState({\r\n\t\t\tselectedPage: page,\r\n\t\t\thomeVisible: false\r\n\t\t})\r\n\t\tAnalytics.pageView({\r\n\t\t\tpage_title: page\r\n\t\t})\r\n\t\tdocument.title = page === '' ? 'Player' : page\r\n\t}\r\n\ttoggleHome = (override = false) => {\r\n\t\t//TODO please refactor this\r\n\t\tconst lastState = this.state.homeData\r\n\t\tif (override) { //if its to be shown then just show it\r\n\t\t\treturn this.setState({\r\n\t\t\t\thomeData: { ...lastState, visible: true, isInPosition: false }\r\n\t\t\t})\r\n\t\t}\r\n\t\tthis.setState({ //if it needs to be hidden, first trigger the animation\r\n\t\t\thomeData: { ...lastState, isInPosition: true }\r\n\t\t}, () => {\r\n\t\t\tsetTimeout(() => { //then demount it\r\n\t\t\t\tthis.setState({\r\n\t\t\t\t\thomeData: { ...lastState, visible: false }\r\n\t\t\t\t})\r\n\t\t\t}, 150)\r\n\t\t})\r\n\t}\r\n\tsetDontShowHome = (override = false) => {\r\n\t\tlocalStorage.setItem(appName + \"_ShowHome\", override)\r\n\t\tconst lastState = this.state.homeData\r\n\t\tthis.setState({\r\n\t\t\thomeData: { ...lastState, canShow: override }\r\n\t\t})\r\n\t}\r\n\tcomponentDidCatch() {\r\n\t\tthis.setState({\r\n\t\t\tselectedPage: \"ErrorPage\"\r\n\t\t})\r\n\t}\r\n\r\n\taskForStorage = async () => {\r\n\t\ttry {\r\n\t\t\tif (navigator.storage && navigator.storage.persist) {\r\n\t\t\t\tlet result = await navigator.storage.persist()\r\n\t\t\t\tif (result) {\r\n\t\t\t\t\tnew LoggerEvent(\"Success\", \"Storage permission allowed\").trigger()\r\n\t\t\t\t} else {\r\n\t\t\t\t\t//new LoggerEvent(\"Warning\", \"Storage permission refused, will try next time\", 6000).trigger()\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} catch (e) {\r\n\t\t\tconsole.log(e)\r\n\t\t\tnew LoggerEvent(\"Error\", \"There was an error with setting up persistent storage\").trigger()\r\n\t\t}\r\n\t\tthis.closeWelcomeScreen()\r\n\t}\r\n\tcloseWelcomeScreen = () => {\r\n\t\tlocalStorage.setItem(appName + \"_Visited\", true)\r\n\t\tthis.setState({\r\n\t\t\thasVisited: true\r\n\t\t})\r\n\t}\r\n\thideMessage = () => {\r\n\t\tlet state = this.state\r\n\t\tstate.floatingMessage.visible = false\r\n\t\tthis.setState({\r\n\t\t\tfloatingMessage: state.floatingMessage\r\n\t\t})\r\n\t}\r\n\tcheckUpdate = async () => {\r\n\t\tawait delayMs(1000)\r\n\t\tif (this.updateChecked) return\r\n\t\tlet storedVersion = localStorage.getItem(appName + \"_Version\")\r\n\t\tif (!this.state.hasVisited) {\r\n\t\t\treturn localStorage.setItem(appName + \"_Version\", appVersion)\r\n\t\t}\r\n\r\n\t\tif (appVersion !== storedVersion) {\r\n\t\t\tnew LoggerEvent(\"Update V\" + appVersion, updateMessage, 6000).trigger()\r\n\t\t\tlocalStorage.setItem(appName + \"_Version\", appVersion)\r\n\t\t}\r\n\t\tthis.updateChecked = true\r\n\t\tif (!this.state.hasVisited) return\r\n\t\tif (navigator.storage && navigator.storage.persist) {\r\n\t\t\tlet isPersisted = await navigator.storage.persisted()\r\n\t\t\tif (!isPersisted) isPersisted = await navigator.storage.persist()\r\n\t\t\tconsole.log(isPersisted ? \"Storage Persisted\" : \"Storage Not persisted\")\r\n\t\t}\r\n\t}\r\n\r\n\tlogEvent = (error) => {\r\n\t\terror = error.detail\r\n\t\terror.timestamp = new Date().getTime()\r\n\t\tif (typeof error !== \"object\") return\r\n\t\tthis.setState({\r\n\t\t\tfloatingMessage: {\r\n\t\t\t\ttimestamp: error.timestamp,\r\n\t\t\t\tvisible: true,\r\n\t\t\t\ttext: error.text,\r\n\t\t\t\ttitle: error.title\r\n\t\t\t}\r\n\t\t})\r\n\t\tsetTimeout(() => {\r\n\t\t\tif (this.state.floatingMessage.timestamp !== error.timestamp) return\r\n\t\t\tthis.setState({\r\n\t\t\t\tfloatingMessage: {\r\n\t\t\t\t\ttimestamp: 0,\r\n\t\t\t\t\tvisible: false,\r\n\t\t\t\t\ttext: \"\",\r\n\t\t\t\t\ttitle: \"\"\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t}, error.timeout)\r\n\t}\r\n\trender() {\r\n\t\tconst { floatingMessage, hasVisited, homeData, selectedPage } = this.state\r\n\t\treturn <div className=\"index\">\r\n\r\n\t\t\t<FloatingMessage\r\n\t\t\t\ttitle={floatingMessage.title}\r\n\t\t\t\tvisible={floatingMessage.visible}\r\n\t\t\t\tonClick={this.hideMessage}\r\n\t\t\t\ttext={floatingMessage.text}\r\n\t\t\t/>\r\n\t\t\t{homeData.visible && <Home\r\n\t\t\t\ttoggleHome={this.toggleHome}\r\n\t\t\t\tchangePage={this.changePage}\r\n\t\t\t\tsetDontShowHome={this.setDontShowHome}\r\n\t\t\t\taskForStorage={this.askForStorage}\r\n\t\t\t\thasVisited={hasVisited}\r\n\t\t\t\tdata={homeData}\r\n\t\t\t\tcurrentPage={selectedPage}\r\n\t\t\t/>}\r\n\t\t\t<HashRouter>\r\n\t\t\t\t<Redirect to={\"/\" + this.state.selectedPage}></Redirect>\r\n\t\t\t\t{this.state.selectedPage === \"ErrorPage\"\r\n\t\t\t\t\t? <Route exact path={\"/ErrorPage\"}>\r\n\t\t\t\t\t\t<ErrorPage changePage={this.changePage} />\r\n\t\t\t\t\t</Route>\r\n\t\t\t\t\t: <>\r\n\t\t\t\t\t\t<Route exact path={\"/ErrorPage\"}>\r\n\t\t\t\t\t\t\t<ErrorPage changePage={this.changePage} />\r\n\t\t\t\t\t\t</Route>\r\n\t\t\t\t\t\t<Route exact path=\"/\">\r\n\t\t\t\t\t\t\t<App changePage={this.changePage} />\r\n\t\t\t\t\t\t</Route>\r\n\r\n\t\t\t\t\t\t<Route exact path=\"/Composer\">\r\n\t\t\t\t\t\t\t<Composer changePage={this.changePage} />\r\n\t\t\t\t\t\t</Route>\r\n\r\n\t\t\t\t\t\t<Route exact path=\"/Donate\">\r\n\t\t\t\t\t\t\t<Donate changePage={this.changePage} />\r\n\t\t\t\t\t\t</Route>\r\n\r\n\t\t\t\t\t\t<Route exact path=\"/Changelog\">\r\n\t\t\t\t\t\t\t<Changelogpage changePage={this.changePage} />\r\n\t\t\t\t\t\t</Route>\r\n\r\n\t\t\t\t\t\t<Route exact path=\"/Partners\">\r\n\t\t\t\t\t\t\t<Partners changePage={this.changePage} />\r\n\t\t\t\t\t\t</Route>\r\n\r\n\t\t\t\t\t\t<Route exact path='/Help'>\r\n\t\t\t\t\t\t\t<Help changePage={this.changePage} />\r\n\t\t\t\t\t\t</Route>\r\n\t\t\t\t\t\t<Route exact path='/SheetVisualizer'>\r\n\t\t\t\t\t\t\t<SheetVisualizer changePage={this.changePage} />\r\n\t\t\t\t\t\t</Route>\r\n\t\t\t\t\t\t<Route exact path='/MidiSetup'>\r\n\t\t\t\t\t\t\t<MidiSetup changePage={this.changePage} />\r\n\t\t\t\t\t\t</Route>\r\n\t\t\t\t\t</>\r\n\t\t\t\t}\r\n\t\t\t</HashRouter>\r\n\t\t\t<div className=\"rotate-screen\">\r\n\t\t\t\t<img src={rotateImg} alt=\"icon for the rotating screen\">\r\n\t\t\t\t</img>\r\n\t\t\t\tFor a better experience, add the website to the home screen, and rotate your device\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t}\r\n}\r\n\r\nReactDOM.render(\r\n\t<React.StrictMode>\r\n\t\t<Index />\r\n\t</React.StrictMode>,\r\n\tdocument.getElementById('root')\r\n);\r\n\r\n\r\nfunction setIfInTWA() {\r\n\tif (isTwa()) return console.log('inTWA')\r\n\tlet isInTwa = document.referrer.includes('android-app://')\r\n\tsessionStorage.setItem('isTwa', isInTwa)\r\n}\r\n\r\n\r\nsetIfInTWA()\r\nserviceWorkerRegistration.register();"],"sourceRoot":""}